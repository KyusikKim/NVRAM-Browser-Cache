cscope 15 /qt/qt4.7.4/src/3rdparty/webkit/WebCore/loader               0001079939
	@Cache.cpp

2 #ifdeà
SSLAB__DEBUG


3 #iâdeà
SSLAB__QDATETIME


4 
	#SSLAB__QDATETIME


	)

5 
	~<QD©eTime
>

9 #ifdeà
SSLAB__DEBUG


10 #iâdeà
SSLAB__QTHREAD


11 
	#SSLAB__QTHREAD


	)

12 
	~<QTh»ad
>

37 
	~"cÚfig.h
"

38 
	~"Cache.h
"

40 
	~"CachedCSSStyËSh“t.h
"

41 
	~"CachedFÚt.h
"

42 
	~"CachedImage.h
"

43 
	~"CachedSüt.h
"

44 
	~"CachedXSLStyËSh“t.h
"

45 
	~"DocLßd”.h
"

46 
	~"Docum’t.h
"

47 
	~"F¿meLßd”.h
"

48 
	~"F¿meLßd”Ty³s.h
"

49 
	~"F¿meV›w.h
"

50 
	~"Image.h
"

51 
	~"ResourûHªdË.h
"

52 
	~"Secur™yOrigš.h
"

53 
	~<¡dio.h
>

54 
	~<wtf/Cu¼’tTime.h
>

66 
usšg
 
Çme¥aû
 
	g¡d
;

68 
Çme¥aû
 
	gWebCÜe
 {

72 cÚ¡ 
	gcDeçuÉCacheC­ac™y
 = 8192 * 1024;

73 cÚ¡ 
	gcMšD–ayBefÜeLiveDecodedPruÃ
 = 1;

74 cÚ¡ 
	gcT¬g‘PruÃP”ûÁage
 = .95f;

75 cÚ¡ 
	gcDeçuÉDecodedD©aD–‘iÚIÁ”v®
 = 0;

77 
Cache
* 
ÿche
()

79 #ifdeà
SSLAB__DEBUG


80 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

83 
Cache
* 
	g¡©icCache
 = 
Ãw
 Cache;

84  
	g¡©icCache
;

87 
	gCache
::
Cache
()

88 : 
m_di§bËd
(
çl£
)

90 , 
m_´uÃEÇbËd
(
Œue
)

91 , 
m_šPruÃD—dResourûs
(
çl£
)

92 , 
m_ÿ·c™y
(
cDeçuÉCacheC­ac™y
)

93 , 
m_mšD—dC­ac™y
(0)

94 , 
m_maxD—dC­ac™y
(
cDeçuÉCacheC­ac™y
)

95 , 
m_d—dDecodedD©aD–‘iÚIÁ”v®
(
cDeçuÉDecodedD©aD–‘iÚIÁ”v®
)

96 , 
m_liveSize
(0)

97 , 
m_d—dSize
(0)

99 #ifdeà
SSLAB__DEBUG


100 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

105 
CachedResourû
* 
ü—‹Resourû
(CachedResourû::
Ty³
 
ty³
, cÚ¡ 
KURL
& 
u¾
, cÚ¡ 
SŒšg
& 
ch¬£t
)

107 #ifdeà
SSLAB__DEBUG


108 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

111 
	gty³
) {

112 
	gCachedResourû
::
ImageResourû
:

113  
Ãw
 
CachedImage
(
u¾
.
¡ršg
());

114 
	gCachedResourû
::
CSSStyËSh“t
:

115  
Ãw
 
CachedCSSStyËSh“t
(
u¾
.
¡ršg
(), 
ch¬£t
);

116 
	gCachedResourû
::
Süt
:

117  
Ãw
 
CachedSüt
(
u¾
.
¡ršg
(), 
ch¬£t
);

118 
	gCachedResourû
::
FÚtResourû
:

119  
Ãw
 
CachedFÚt
(
u¾
.
¡ršg
());

120 #ià
ENABLE
(
XSLT
)

121 
	gCachedResourû
::
XSLStyËSh“t
:

122  
Ãw
 
CachedXSLStyËSh“t
(
u¾
.
¡ršg
());

124 #ià
ENABLE
(
XBL
)

125 
	gCachedResourû
::
XBLStyËSh“t
:

126  
Ãw
 
CachedXBLDocum’t
(
u¾
.
¡ršg
());

135 
CachedResourû
* 
	gCache
::
»que¡Resourû
(
DocLßd”
* 
docLßd”
, CachedResourû::
Ty³
 
ty³
, cÚ¡ 
KURL
& 
u¾
, cÚ¡ 
SŒšg
& 
ch¬£t
, 
boŞ
 
»que¡IsP»lßd
)

137 #ifdeà
SSLAB__DEBUG


138 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

143 ià(
	gu¾
.
isEm±y
())

147 
CachedResourû
* 
	g»sourû
 = 
»sourûFÜURL
(
u¾
.
¡ršg
());

149 ià(
	g»sourû
 && 
	g»que¡IsP»lßd
 && !»sourû->
isP»lßded
())

152 ià(
	gSecur™yOrigš
::
»¡riùAcûssToLoÿl
(è&& !
Secur™yOrigš
::
ÿnLßd
(
u¾
, 
SŒšg
(), 
docLßd”
->
doc
())) {

153 
Docum’t
* 
	gdoc
 = 
docLßd”
->
doc
();

154 ià(
	gdoc
 && !
	g»que¡IsP»lßd
)

155 
	gF¿meLßd”
::
»pÜtLoÿlLßdFaed
(
doc
->
äame
(), 
u¾
.
¡ršg
());

159 ià(!
	g»sourû
) {

161 
	g»sourû
 = 
ü—‹Resourû
(
ty³
, 
u¾
, 
ch¬£t
);

162 
ASSERT
(
»sourû
);

166 
	g»sourû
->
£tInCache
(
Œue
);

261 
	g»sourû
->
lßd
(
docLßd”
);

264 ià(
	g»sourû
->
”rÜOccu¼ed
()) {

268 
	g»sourû
->
£tInCache
(
çl£
);

269 
d–‘e
 
	g»sourû
;

273 ià(!
di§bËd
())

274 
	gm_»sourûs
.
£t
(
u¾
.
¡ršg
(), 
»sourû
);

277 
	g»sourû
->
£tInCache
(
çl£
);

278 
	g»sourû
->
£tDocLßd”
(
docLßd”
);

282 ià(
	g»sourû
->
ty³
() !=ype)

285 ià(!
di§bËd
()) {

287 
»sourûAcûs£d
(
»sourû
);

290  
	g»sourû
;

293 
CachedCSSStyËSh“t
* 
	gCache
::
»que¡U£rCSSStyËSh“t
(
DocLßd”
* 
docLßd”
, cÚ¡ 
SŒšg
& 
u¾
, cÚ¡ SŒšg& 
ch¬£t
)

295 #ifdeà
SSLAB__DEBUG


296 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

299 
CachedCSSStyËSh“t
* 
	gu£rSh“t
;

300 ià(
CachedResourû
* 
	gexi¡šg
 = 
»sourûFÜURL
(
u¾
)) {

301 ià(
exi¡šg
->
ty³
(è!ğ
CachedResourû
::
CSSStyËSh“t
)

303 
	gu£rSh“t
 = 
¡©ic_ÿ¡
<
CachedCSSStyËSh“t
*>(
exi¡šg
);

305 
	gu£rSh“t
 = 
Ãw
 
CachedCSSStyËSh“t
(
u¾
, 
ch¬£t
);

309 
	gu£rSh“t
->
£tInCache
(
Œue
);

311 
	gu£rSh“t
->
lßd
(
docLßd”
, 
çl£
, 
SkSecur™yCheck
, false);

312 ià(!
di§bËd
())

313 
	gm_»sourûs
.
£t
(
u¾
, 
u£rSh“t
);

315 
	gu£rSh“t
->
£tInCache
(
çl£
);

318 ià(!
di§bËd
()) {

320 
»sourûAcûs£d
(
u£rSh“t
);

323  
	gu£rSh“t
;

326 
	gCache
::
»v®id©eResourû
(
CachedResourû
* 
»sourû
, 
DocLßd”
* 
docLßd”
)

328 #ifdeà
SSLAB__DEBUG


329 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

332 
ASSERT
(
»sourû
);

333 
ASSERT
(
»sourû
->
šCache
());

334 
ASSERT
(
»sourû
 =ğ
m_»sourûs
.
g‘
Ôesourû->
u¾
()));

335 
ASSERT
(!
di§bËd
());

336 ià(
	g»sourû
->
»sourûToRev®id©e
())

338 ià(!
	g»sourû
->
ÿnU£CacheV®id©Ü
()) {

339 
eviù
(
»sourû
);

342 cÚ¡ 
	gSŒšg
& 
	gu¾
 = 
»sourû
->
u¾
();

343 
CachedResourû
* 
	gÃwResourû
 = 
ü—‹Resourû
(
»sourû
->
ty³
(), 
KURL
(
P¬£dURLSŒšg
, 
u¾
),„esourû->
’codšg
());

344 
	gÃwResourû
->
£tResourûToRev®id©e
(
»sourû
);

345 
eviù
(
»sourû
);

346 
	gm_»sourûs
.
£t
(
u¾
, 
ÃwResourû
);

347 
	gÃwResourû
->
£tInCache
(
Œue
);

348 
»sourûAcûs£d
(
ÃwResourû
);

349 
	gÃwResourû
->
lßd
(
docLßd”
);

352 
	gCache
::
»v®id©iÚSucûeded
(
CachedResourû
* 
»v®id©šgResourû
, cÚ¡ 
ResourûRe¥Ú£
& 
»¥Ú£
)

354 #ifdeà
SSLAB__DEBUG


355 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

358 
CachedResourû
* 
	g»sourû
 = 
»v®id©šgResourû
->
»sourûToRev®id©e
();

359 
ASSERT
(
»sourû
);

360 
ASSERT
(!
»sourû
->
šCache
());

361 
ASSERT
(
»sourû
->
isLßded
());

362 
ASSERT
(
»v®id©šgResourû
->
šCache
());

364 
eviù
(
»v®id©šgResourû
);

366 
ASSERT
(!
m_»sourûs
.
g‘
(
»sourû
->
u¾
()));

367 
	gm_»sourûs
.
£t
(
»sourû
->
u¾
(),„esource);

368 
	g»sourû
->
£tInCache
(
Œue
);

369 
	g»sourû
->
upd©eRe¥Ú£Aá”Rev®id©iÚ
(
»¥Ú£
);

370 
š£¹InLRULi¡
(
»sourû
);

371 
	gd–
 = 
»sourû
->
size
();

372 ià(
	g»sourû
->
decodedSize
(è&&„esourû->
hasCl›Ás
())

373 
š£¹InLiveDecodedResourûsLi¡
(
»sourû
);

374 ià(
	gd–
)

375 
adju¡Size
(
»sourû
->
hasCl›Ás
(), 
d–
);

377 
	g»v®id©šgResourû
->
sw™chCl›ÁsToRev®id©edResourû
();

379 
	g»v®id©šgResourû
->
ş—rResourûToRev®id©e
();

382 
	gCache
::
»v®id©iÚFaed
(
CachedResourû
* 
»v®id©šgResourû
)

384 #ifdeà
SSLAB__DEBUG


385 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

388 
ASSERT
(
»v®id©šgResourû
->
»sourûToRev®id©e
());

389 
	g»v®id©šgResourû
->
ş—rResourûToRev®id©e
();

392 
CachedResourû
* 
	gCache
::
»sourûFÜURL
(cÚ¡ 
SŒšg
& 
u¾
)

394 #ifdeà
SSLAB__DEBUG


395 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

398 
CachedResourû
* 
	g»sourû
 = 
m_»sourûs
.
g‘
(
u¾
);

399 ià(
	g»sourû
 && !»sourû->
makePurg—bË
(
çl£
)) {

400 
ASSERT
(!
»sourû
->
hasCl›Ás
());

401 
eviù
(
»sourû
);

404  
	g»sourû
;

407 
	gCache
::
d—dC­ac™y
() const

409 #ifdeà
SSLAB__DEBUG


410 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

414 
	gÿ·c™y
 = 
m_ÿ·c™y
 - 
mš
(
m_liveSize
, m_capacity);

415 
	gÿ·c™y
 = 
max
(
ÿ·c™y
, 
m_mšD—dC­ac™y
);

416 
	gÿ·c™y
 = 
mš
(
ÿ·c™y
, 
m_maxD—dC­ac™y
);

417  
	gÿ·c™y
;

420 
	gCache
::
liveC­ac™y
() const

422 #ifdeà
SSLAB__DEBUG


423 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

427  
	gm_ÿ·c™y
 - 
d—dC­ac™y
();

430 
	gCache
::
´uÃLiveResourûs
()

432 #ifdeà
SSLAB__DEBUG


433 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

436 ià(!
	gm_´uÃEÇbËd
)

439 
	gÿ·c™y
 = 
liveC­ac™y
();

440 ià(
	gÿ·c™y
 && 
	gm_liveSize
 <ğ
ÿ·c™y
)

443 
	grg‘Size
 = 
¡©ic_ÿ¡
<>(
ÿ·c™y
 * 
cT¬g‘PruÃP”ûÁage
);

444 
	gcu¼’tTime
 = 
F¿meV›w
::
cu¼’tPaštTimeSmp
();

445 ià(!
	gcu¼’tTime
)

446 
	gcu¼’tTime
 = 
WTF
::
cu¼’tTime
();

456 
CachedResourû
* 
	gcu¼’t
 = 
m_liveDecodedResourûs
.
m_
;

457 
	gcu¼’t
) {

458 
CachedResourû
* 
	g´ev
 = 
cu¼’t
->
m_´evInLiveResourûsLi¡
;

459 
ASSERT
(
cu¼’t
->
hasCl›Ás
());

460 ià(
	gcu¼’t
->
isLßded
(è&& cu¼’t->
decodedSize
()) {

462 
	g–­£dTime
 = 
cu¼’tTime
 - 
cu¼’t
->
m_Ï¡DecodedAcûssTime
;

463 ià(
	g–­£dTime
 < 
	gcMšD–ayBefÜeLiveDecodedPruÃ
)

469 
	gcu¼’t
->
de¡royDecodedD©a
();

471 ià(
	grg‘Size
 && 
	gm_liveSize
 <ğ
rg‘Size
)

474 
	gcu¼’t
 = 
´ev
;

478 
	gCache
::
´uÃD—dResourûs
()

480 #ifdeà
SSLAB__DEBUG


481 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

484 ià(!
	gm_´uÃEÇbËd
)

487 
	gÿ·c™y
 = 
d—dC­ac™y
();

488 ià(
	gÿ·c™y
 && 
	gm_d—dSize
 <ğ
ÿ·c™y
)

491 
	grg‘Size
 = 
¡©ic_ÿ¡
<>(
ÿ·c™y
 * 
cT¬g‘PruÃP”ûÁage
);

492 
	gsize
 = 
m_®lResourûs
.
size
();

494 ià(!
	gm_šPruÃD—dResourûs
) {

496 
	gi
 = 0; i < 
	gsize
; i++) {

497 
CachedResourû
* 
	gcu¼’t
 = 
m_®lResourûs
[
i
].
m_
;

498 
	gcu¼’t
) {

499 
CachedResourû
* 
	g´ev
 = 
cu¼’t
->
m_´evInAÎResourûsLi¡
;

500 ià(
	gcu¼’t
->
wasPurged
()) {

501 
ASSERT
(!
cu¼’t
->
hasCl›Ás
());

502 
ASSERT
(!
cu¼’t
->
isP»lßded
());

503 
eviù
(
cu¼’t
);

505 
	gcu¼’t
 = 
´ev
;

508 ià(
	grg‘Size
 && 
	gm_d—dSize
 <ğ
rg‘Size
)

512 
boŞ
 
	gÿnShrškLRULi¡s
 = 
Œue
;

513 
	gm_šPruÃD—dResourûs
 = 
Œue
;

514 
	gi
 = 
size
 - 1; i >= 0; i--) {

516 
CachedResourû
* 
	gcu¼’t
 = 
m_®lResourûs
[
i
].
m_
;

519 
	gcu¼’t
) {

520 
CachedResourû
* 
	g´ev
 = 
cu¼’t
->
m_´evInAÎResourûsLi¡
;

521 ià(!
	gcu¼’t
->
hasCl›Ás
(è&& !cu¼’t->
isP»lßded
(è&& cu¼’t->
isLßded
()) {

525 
	gcu¼’t
->
de¡royDecodedD©a
();

527 ià(
	grg‘Size
 && 
	gm_d—dSize
 <ğ
rg‘Size
) {

528 
m_šPruÃD—dResourûs
 = 
çl£
;

532 
	gcu¼’t
 = 
´ev
;

536 
	gcu¼’t
 = 
m_®lResourûs
[
i
].
m_
;

537 
	gcu¼’t
) {

538 
CachedResourû
* 
	g´ev
 = 
cu¼’t
->
m_´evInAÎResourûsLi¡
;

539 ià(!
	gcu¼’t
->
hasCl›Ás
(è&& !cu¼’t->
isP»lßded
(è&& !cu¼’t->
isCacheV®id©Ü
()) {

540 
eviù
(
cu¼’t
);

543 ià(!
	gm_šPruÃD—dResourûs
)

546 ià(
	grg‘Size
 && 
	gm_d—dSize
 <ğ
rg‘Size
) {

547 
m_šPruÃD—dResourûs
 = 
çl£
;

551 
	gcu¼’t
 = 
´ev
;

556 ià(
	gm_®lResourûs
[
i
].
	gm_h—d
)

557 
	gÿnShrškLRULi¡s
 = 
çl£
;

558 ià(
	gÿnShrškLRULi¡s
)

559 
	gm_®lResourûs
.
»size
(
i
);

561 
	gm_šPruÃD—dResourûs
 = 
çl£
;

564 
	gCache
::
£tC­ac™›s
(
mšD—dBy‹s
, 
maxD—dBy‹s
, 
tÙ®By‹s
)

566 #ifdeà
SSLAB__DEBUG


567 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

570 
ASSERT
(
mšD—dBy‹s
 <ğ
maxD—dBy‹s
);

571 
ASSERT
(
maxD—dBy‹s
 <ğ
tÙ®By‹s
);

572 
	gm_mšD—dC­ac™y
 = 
mšD—dBy‹s
;

573 
	gm_maxD—dC­ac™y
 = 
maxD—dBy‹s
;

574 
	gm_ÿ·c™y
 = 
tÙ®By‹s
;

575 
´uÃ
();

578 
	gCache
::
eviù
(
CachedResourû
* 
»sourû
)

580 #ifdeà
SSLAB__DEBUG


581 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

586 ià(
	g»sourû
->
šCache
()) {

588 
	gm_»sourûs
.
»move
(
»sourû
->
u¾
());

589 
	g»sourû
->
£tInCache
(
çl£
);

592 
»moveFromLRULi¡
(
»sourû
);

593 
»moveFromLiveDecodedResourûsLi¡
(
»sourû
);

596 
	gd–
 = -
¡©ic_ÿ¡
<>(
»sourû
->
size
());

597 ià(
	gd–
)

598 
adju¡Size
(
»sourû
->
hasCl›Ás
(), 
d–
);

600 
ASSERT
(
m_»sourûs
.
g‘
(
»sourû
->
u¾
()) !=„esource);

610 ià(
	g»sourû
->
ÿnD–‘e
())

611 
d–‘e
 
	g»sourû
;

614 
	gCache
::
addDocLßd”
(
DocLßd”
* 
docLßd”
)

616 #ifdeà
SSLAB__DEBUG


617 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

620 
	gm_docLßd”s
.
add
(
docLßd”
);

623 
	gCache
::
»moveDocLßd”
(
DocLßd”
* 
docLßd”
)

625 #ifdeà
SSLAB__DEBUG


626 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

629 
	gm_docLßd”s
.
»move
(
docLßd”
);

632 
šlše
 
ç¡Log2
(
i
)

634 #ifdeà
SSLAB__DEBUG


635 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

638 
	glog2
 = 0;

639 ià(
	gi
 & (i - 1))

640 
	glog2
 += 1;

641 ià(
	gi
 >> 16)

642 
	glog2
 +ğ16, 
	gi
 >>= 16;

643 ià(
	gi
 >> 8)

644 
	glog2
 +ğ8, 
	gi
 >>= 8;

645 ià(
	gi
 >> 4)

646 
	glog2
 +ğ4, 
	gi
 >>= 4;

647 ià(
	gi
 >> 2)

648 
	glog2
 +ğ2, 
	gi
 >>= 2;

649 ià(
	gi
 >> 1)

650 
	glog2
 += 1;

651  
	glog2
;

654 
	gCache
::
LRULi¡
* 
Cache
::
ÌuLi¡FÜ
(
CachedResourû
* 
»sourû
)

656 #ifdeà
SSLAB__DEBUG


657 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

660 
	gacûssCouÁ
 = 
max
(
»sourû
->
acûssCouÁ
(), 1U);

661 
	gqueueIndex
 = 
ç¡Log2
(
»sourû
->
size
(è/ 
acûssCouÁ
);

662 #iâdeà
NDEBUG


663 
	g»sourû
->
	gm_ÌuIndex
 = 
queueIndex
;

665 ià(
	gm_®lResourûs
.
size
(è<ğ
queueIndex
)

666 
m_®lResourûs
.
grow
(
queueIndex
 + 1);

667  &
	gm_®lResourûs
[
queueIndex
];

670 
	gCache
::
»moveFromLRULi¡
(
CachedResourû
* 
»sourû
)

672 #ifdeà
SSLAB__DEBUG


673 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

677 ià(
	g»sourû
->
acûssCouÁ
() == 0)

680 #ià!
ASSERT_DISABLED


681 
	gŞdLi¡Index
 = 
»sourû
->
m_ÌuIndex
;

684 
LRULi¡
* 
	gli¡
 = 
ÌuLi¡FÜ
(
»sourû
);

686 #ià!
ASSERT_DISABLED


688 
ASSERT
(
»sourû
->
m_ÌuIndex
 =ğ
ŞdLi¡Index
);

691 
boŞ
 
	gfound
 = 
çl£
;

692 
CachedResourû
* 
	gcu¼’t
 = 
li¡
->
m_h—d
; cu¼’t; cu¼’ˆğ
cu¼’t
->
m_ÃxtInAÎResourûsLi¡
) {

693 ià(
cu¼’t
 =ğ
»sourû
) {

694 
found
 = 
Œue
;

698 
ASSERT
(
found
);

701 
CachedResourû
* 
	gÃxt
 = 
»sourû
->
m_ÃxtInAÎResourûsLi¡
;

702 
CachedResourû
* 
	g´ev
 = 
»sourû
->
m_´evInAÎResourûsLi¡
;

704 ià(
	gÃxt
 =ğ0 && 
´ev
 =ğ0 && 
li¡
->
m_h—d
 !ğ
»sourû
)

707 
	g»sourû
->
	gm_ÃxtInAÎResourûsLi¡
 = 0;

708 
	g»sourû
->
	gm_´evInAÎResourûsLi¡
 = 0;

710 ià(
	gÃxt
)

711 
	gÃxt
->
	gm_´evInAÎResourûsLi¡
 = 
´ev
;

712 ià(
	gli¡
->
	gm_
 =ğ
»sourû
)

713 
li¡
->
m_
 = 
´ev
;

715 ià(
	g´ev
)

716 
	g´ev
->
	gm_ÃxtInAÎResourûsLi¡
 = 
Ãxt
;

717 ià(
	gli¡
->
	gm_h—d
 =ğ
»sourû
)

718 
li¡
->
m_h—d
 = 
Ãxt
;

721 
	gCache
::
š£¹InLRULi¡
(
CachedResourû
* 
»sourû
)

723 #ifdeà
SSLAB__DEBUG


724 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

728 
ASSERT
(!
»sourû
->
m_ÃxtInAÎResourûsLi¡
 && !»sourû->
m_´evInAÎResourûsLi¡
);

729 
ASSERT
(
»sourû
->
šCache
());

730 
ASSERT
(
»sourû
->
acûssCouÁ
() > 0);

732 
LRULi¡
* 
	gli¡
 = 
ÌuLi¡FÜ
(
»sourû
);

734 
	g»sourû
->
	gm_ÃxtInAÎResourûsLi¡
 = 
li¡
->
m_h—d
;

735 ià(
	gli¡
->
	gm_h—d
)

736 
	gli¡
->
	gm_h—d
->
	gm_´evInAÎResourûsLi¡
 = 
»sourû
;

737 
	gli¡
->
	gm_h—d
 = 
»sourû
;

739 ià(!
	g»sourû
->
	gm_ÃxtInAÎResourûsLi¡
)

740 
	gli¡
->
	gm_
 = 
»sourû
;

742 #iâdeà
NDEBUG


744 
	gli¡
 = 
ÌuLi¡FÜ
(
»sourû
);

745 
boŞ
 
	gfound
 = 
çl£
;

746 
CachedResourû
* 
	gcu¼’t
 = 
li¡
->
m_h—d
; cu¼’t; cu¼’ˆğ
cu¼’t
->
m_ÃxtInAÎResourûsLi¡
) {

747 ià(
cu¼’t
 =ğ
»sourû
) {

748 
found
 = 
Œue
;

752 
ASSERT
(
found
);

757 
	gCache
::
»sourûAcûs£d
(
CachedResourû
* 
»sourû
)

759 #ifdeà
SSLAB__DEBUG


760 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

763 
ASSERT
(
»sourû
->
šCache
());

767 
»moveFromLRULi¡
(
»sourû
);

770 ià(!
	g»sourû
->
acûssCouÁ
())

771 
adju¡Size
(
»sourû
->
hasCl›Ás
(),„esourû->
size
());

774 
	g»sourû
->
šü—£AcûssCouÁ
();

777 
š£¹InLRULi¡
(
»sourû
);

780 
	gCache
::
»moveFromLiveDecodedResourûsLi¡
(
CachedResourû
* 
»sourû
)

782 #ifdeà
SSLAB__DEBUG


783 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

787 ià(!
	g»sourû
->
	gm_šLiveDecodedResourûsLi¡
)

789 
	g»sourû
->
	gm_šLiveDecodedResourûsLi¡
 = 
çl£
;

791 #iâdeà
NDEBUG


793 
boŞ
 
	gfound
 = 
çl£
;

794 
CachedResourû
* 
	gcu¼’t
 = 
m_liveDecodedResourûs
.
m_h—d
; cu¼’t; cu¼’ˆğ
cu¼’t
->
m_ÃxtInLiveResourûsLi¡
) {

795 ià(
cu¼’t
 =ğ
»sourû
) {

796 
found
 = 
Œue
;

800 
ASSERT
(
found
);

803 
CachedResourû
* 
	gÃxt
 = 
»sourû
->
m_ÃxtInLiveResourûsLi¡
;

804 
CachedResourû
* 
	g´ev
 = 
»sourû
->
m_´evInLiveResourûsLi¡
;

806 ià(
	gÃxt
 =ğ0 && 
´ev
 =ğ0 && 
m_liveDecodedResourûs
.
m_h—d
 !ğ
»sourû
)

809 
	g»sourû
->
	gm_ÃxtInLiveResourûsLi¡
 = 0;

810 
	g»sourû
->
	gm_´evInLiveResourûsLi¡
 = 0;

812 ià(
	gÃxt
)

813 
	gÃxt
->
	gm_´evInLiveResourûsLi¡
 = 
´ev
;

814 ià(
	gm_liveDecodedResourûs
.
	gm_
 =ğ
»sourû
)

815 
m_liveDecodedResourûs
.
m_
 = 
´ev
;

817 ià(
	g´ev
)

818 
	g´ev
->
	gm_ÃxtInLiveResourûsLi¡
 = 
Ãxt
;

819 ià(
	gm_liveDecodedResourûs
.
	gm_h—d
 =ğ
»sourû
)

820 
m_liveDecodedResourûs
.
m_h—d
 = 
Ãxt
;

823 
	gCache
::
š£¹InLiveDecodedResourûsLi¡
(
CachedResourû
* 
»sourû
)

825 #ifdeà
SSLAB__DEBUG


826 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

830 
ASSERT
(!
»sourû
->
m_ÃxtInLiveResourûsLi¡
 && !»sourû->
m_´evInLiveResourûsLi¡
 && !»sourû->
m_šLiveDecodedResourûsLi¡
);

831 
	g»sourû
->
	gm_šLiveDecodedResourûsLi¡
 = 
Œue
;

833 
	g»sourû
->
	gm_ÃxtInLiveResourûsLi¡
 = 
m_liveDecodedResourûs
.
m_h—d
;

834 ià(
	gm_liveDecodedResourûs
.
	gm_h—d
)

835 
	gm_liveDecodedResourûs
.
	gm_h—d
->
	gm_´evInLiveResourûsLi¡
 = 
»sourû
;

836 
	gm_liveDecodedResourûs
.
	gm_h—d
 = 
»sourû
;

838 ià(!
	g»sourû
->
	gm_ÃxtInLiveResourûsLi¡
)

839 
	gm_liveDecodedResourûs
.
	gm_
 = 
»sourû
;

841 #iâdeà
NDEBUG


843 
boŞ
 
	gfound
 = 
çl£
;

844 
CachedResourû
* 
	gcu¼’t
 = 
m_liveDecodedResourûs
.
m_h—d
; cu¼’t; cu¼’ˆğ
cu¼’t
->
m_ÃxtInLiveResourûsLi¡
) {

845 ià(
cu¼’t
 =ğ
»sourû
) {

846 
found
 = 
Œue
;

850 
ASSERT
(
found
);

855 
	gCache
::
addToLiveResourûsSize
(
CachedResourû
* 
»sourû
)

857 #ifdeà
SSLAB__DEBUG


858 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

861 
	gm_liveSize
 +ğ
»sourû
->
size
();

862 
	gm_d—dSize
 -ğ
»sourû
->
size
();

865 
	gCache
::
»moveFromLiveResourûsSize
(
CachedResourû
* 
»sourû
)

867 #ifdeà
SSLAB__DEBUG


868 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

871 
	gm_liveSize
 -ğ
»sourû
->
size
();

872 
	gm_d—dSize
 +ğ
»sourû
->
size
();

875 
	gCache
::
adju¡Size
(
boŞ
 
live
, 
d–
)

877 #ifdeà
SSLAB__DEBUG


878 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

881 ià(
	glive
) {

882 
ASSERT
(
d–
 >ğ0 || (()
m_liveSize
 + delta >= 0));

883 
	gm_liveSize
 +ğ
d–
;

885 
ASSERT
(
d–
 >ğ0 || (()
m_d—dSize
 + delta >= 0));

886 
	gm_d—dSize
 +ğ
d–
;

890 
	gCache
::
Ty³Sti¡ic
::
addResourû
(
CachedResourû
* 
o
)

892 #ifdeà
SSLAB__DEBUG


893 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

896 
boŞ
 
	gpurged
 = 
o
->
wasPurged
();

897 
boŞ
 
	gpurg—bË
 = 
o
->
isPurg—bË
(è&& !
purged
;

898 
	g·geSize
 = (
o
->
’codedSize
(è+ o->
ov”h—dSize
() + 4095) & ~4095;

899 
	gcouÁ
++;

900 
	gsize
 +ğ
purged
 ? 0 : 
o
->
size
();

901 
	gliveSize
 +ğ
o
->
hasCl›Ás
(è? o->
size
() : 0;

902 
	gdecodedSize
 +ğ
o
->
decodedSize
();

903 
	gpurg—bËSize
 +ğ
purg—bË
 ? 
·geSize
 : 0;

904 
	gpurgedSize
 +ğ
purged
 ? 
·geSize
 : 0;

907 
	gCache
::
Sti¡ics
 
Cache
::
g‘Sti¡ics
()

909 #ifdeà
SSLAB__DEBUG


910 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

913 
Sti¡ics
 
	g¡©s
;

914 
	gCachedResourûM­
::
™”©Ü
 
e
 = 
m_»sourûs
.
’d
();

915 
	gCachedResourûM­
::
™”©Ü
 
i
 = 
m_»sourûs
.
begš
(); 
	gi
 !ğ
e
; ++i) {

916 
CachedResourû
* 
	g»sourû
 = 
i
->
£cÚd
;

917 
	g»sourû
->
ty³
()) {

918 
	gCachedResourû
::
ImageResourû
:

919 
¡©s
.
images
.
addResourû
(
»sourû
);

921 
	gCachedResourû
::
CSSStyËSh“t
:

922 
¡©s
.
cssStyËSh“ts
.
addResourû
(
»sourû
);

924 
	gCachedResourû
::
Süt
:

925 
¡©s
.
süts
.
addResourû
(
»sourû
);

927 #ià
ENABLE
(
XSLT
)

928 
	gCachedResourû
::
XSLStyËSh“t
:

929 
¡©s
.
x¦StyËSh“ts
.
addResourû
(
»sourû
);

932 
	gCachedResourû
::
FÚtResourû
:

933 
¡©s
.
fÚts
.
addResourû
(
»sourû
);

935 #ià
ENABLE
(
XBL
)

936 
	gCachedResourû
::
XBL
:

937 
¡©s
.
xblDocs
.
addResourû
(
»sourû
)

944  
	g¡©s
;

947 
	gCache
::
£tDi§bËd
(
boŞ
 
di§bËd
)

949 #ifdeà
SSLAB__DEBUG


950 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

953 
	gm_di§bËd
 = 
di§bËd
;

954 ià(!
	gm_di§bËd
)

958 
	gCachedResourûM­
::
™”©Ü
 
i
 = 
m_»sourûs
.
begš
();

959 ià(
	gi
 =ğ
m_»sourûs
.
’d
())

961 
eviù
(
i
->
£cÚd
);

965 #iâdeà
NDEBUG


966 
	gCache
::
dumpSts
()

968 #ifdeà
SSLAB__DEBUG


969 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

972 
Sti¡ics
 
	gs
 = 
g‘Sti¡ics
();

973 
´štf
("%-11s %-11s %-11s %-11s %-11s %-11s %-11s\n", "", "Count", "Size", "LiveSize", "DecodedSize", "PurgeableSize", "PurgedSize");

974 
´štf
("%-11s %-11s %-11s %-11s %-11s %-11s %-11s\n", "-----------", "-----------", "-----------", "-----------", "-----------", "-----------", "-----------");

975 
´štf
("%-11 %11d %11d %11d %11d %11d %11d\n", "Images", 
s
.
images
.
couÁ
, s.images.
size
, s.images.
liveSize
, s.images.
decodedSize
, s.images.
purg—bËSize
, s.images.
purgedSize
);

976 
´štf
("%-11 %11d %11d %11d %11d %11d %11d\n", "CSS", 
s
.
cssStyËSh“ts
.
couÁ
, s.cssStyËSh“ts.
size
, s.cssStyËSh“ts.
liveSize
, s.cssStyËSh“ts.
decodedSize
, s.cssStyËSh“ts.
purg—bËSize
, s.cssStyËSh“ts.
purgedSize
);

977 #ià
ENABLE
(
XSLT
)

978 
´štf
("%-11 %11d %11d %11d %11d %11d %11d\n", "XSL", 
s
.
x¦StyËSh“ts
.
couÁ
, s.x¦StyËSh“ts.
size
, s.x¦StyËSh“ts.
liveSize
, s.x¦StyËSh“ts.
decodedSize
, s.x¦StyËSh“ts.
purg—bËSize
, s.x¦StyËSh“ts.
purgedSize
);

980 
´štf
("%-11 %11d %11d %11d %11d %11d %11d\n", "JavaSüt", 
s
.
süts
.
couÁ
, s.süts.
size
, s.süts.
liveSize
, s.süts.
decodedSize
, s.süts.
purg—bËSize
, s.süts.
purgedSize
);

981 
´štf
("%-11 %11d %11d %11d %11d %11d %11d\n", "FÚts", 
s
.
fÚts
.
couÁ
, s.fÚts.
size
, s.fÚts.
liveSize
, s.fÚts.
decodedSize
, s.fÚts.
purg—bËSize
, s.fÚts.
purgedSize
);

982 
´štf
("%-11s %-11s %-11s %-11s %-11s %-11s %-11s\n\n", "-----------", "-----------", "-----------", "-----------", "-----------", "-----------", "-----------");

985 
	gCache
::
dumpLRULi¡s
(
boŞ
 
šşudeLive
) const

987 #ifdeà
SSLAB__DEBUG


988 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

991 
´štf
("LRU-SP†ists inƒviction order (Kilobytes decoded, Kilobytesƒncoded, Access count, Referenced):\n");

993 
	gsize
 = 
m_®lResourûs
.
size
();

994 
	gi
 = 
size
 - 1; i >= 0; i--) {

995 
´štf
("\n\nLi¡ %d: ", 
i
);

996 
CachedResourû
* 
	gcu¼’t
 = 
m_®lResourûs
[
i
].
m_
;

997 
	gcu¼’t
) {

998 
CachedResourû
* 
	g´ev
 = 
cu¼’t
->
m_´evInAÎResourûsLi¡
;

999 ià(
	gšşudeLive
 || !
	gcu¼’t
->
hasCl›Ás
())

1000 
´štf
("(%.1fK, %.1fK, %uA, %dR); ", 
cu¼’t
->
decodedSize
(è/ 1024.0f, (cu¼’t->
’codedSize
(è+ cu¼’t->
ov”h—dSize
()è/ 1024.0f, cu¼’t->
acûssCouÁ
(), cu¼’t->
hasCl›Ás
());

1001 
	gcu¼’t
 = 
´ev
;

	@Cache.h

25 #iâdeà
Cache_h


26 
	#Cache_h


	)

28 
	~"CachePŞicy.h
"

29 
	~"CachedResourû.h
"

30 
	~"PÏtfÜmSŒšg.h
"

31 
	~"SŒšgHash.h
"

32 
	~"lßd”.h
"

33 
	~<wtf/HashM­.h
>

34 
	~<wtf/HashS‘.h
>

35 
	~<wtf/NÚcİyabË.h
>

36 
	~<wtf/VeùÜ.h
>

38 
Çme¥aû
 
	gWebCÜe
 {

40 
şass
 
	gCachedCSSStyËSh“t
;

41 
şass
 
	gCachedResourû
;

42 
şass
 
	gDocLßd”
;

43 
şass
 
	gKURL
;

58 şas 
	cCache
 : 
public
 
NÚcİyabË
 {

59 
public
:

60 
ä›nd
 
Cache
* 
ÿche
();

62 
	gHashM­
<
	tSŒšg
, 
	tCachedResourû
*> 
	tCachedResourûM­
;

64 
	sLRULi¡
 {

65 
CachedResourû
* 
	gm_h—d
;

66 
CachedResourû
* 
	gm_
;

67 
LRULi¡
(è: 
m_h—d
(0), 
m_
(0) { }

70 
	sTy³Sti¡ic
 {

71 
	gcouÁ
;

72 
	gsize
;

73 
	gliveSize
;

74 
	gdecodedSize
;

75 
	gpurg—bËSize
;

76 
	gpurgedSize
;

77 
Ty³Sti¡ic
(è: 
couÁ
(0), 
size
(0), 
liveSize
(0), 
decodedSize
(0), 
purg—bËSize
(0), 
purgedSize
(0) { }

78 
addResourû
(
CachedResourû
*);

81 
	sSti¡ics
 {

82 
Ty³Sti¡ic
 
	gimages
;

83 
Ty³Sti¡ic
 
	gcssStyËSh“ts
;

84 
Ty³Sti¡ic
 
	gsüts
;

85 #ià
ENABLE
(
XSLT
)

86 
Ty³Sti¡ic
 
	gx¦StyËSh“ts
;

88 #ià
ENABLE
(
XBL
)

89 
Ty³Sti¡ic
 
	gxblDocs
;

91 
Ty³Sti¡ic
 
	gfÚts
;

95 
Lßd”
* 
lßd”
(è{  &
	gm_lßd”
; }

99 
CachedResourû
* 
»que¡Resourû
(
DocLßd”
*, CachedResourû::
Ty³
, cÚ¡ 
KURL
& 
u¾
, cÚ¡ 
SŒšg
& 
ch¬£t
, 
boŞ
 
isP»lßd
 = 
çl£
);

101 
CachedCSSStyËSh“t
* 
»que¡U£rCSSStyËSh“t
(
DocLßd”
*, cÚ¡ 
SŒšg
& 
u¾
, cÚ¡ SŒšg& 
ch¬£t
);

103 
»v®id©eResourû
(
CachedResourû
*, 
DocLßd”
*);

104 
»v®id©iÚSucûeded
(
CachedResourû
* 
»v®id©šgResourû
, cÚ¡ 
ResourûRe¥Ú£
&);

105 
»v®id©iÚFaed
(
CachedResourû
* 
»v®id©šgResourû
);

112 
£tC­ac™›s
(
mšD—dBy‹s
, 
maxD—dBy‹s
, 
tÙ®By‹s
);

116 
£tDi§bËd
(
boŞ
);

117 
boŞ
 
di§bËd
(ècÚ¡ {  
	gm_di§bËd
; }

119 
£tPruÃEÇbËd
(
boŞ
 
’abËd
è{ 
	gm_´uÃEÇbËd
 =ƒnabled; }

120 
´uÃ
()

122 ià(
	gm_liveSize
 + 
	gm_d—dSize
 <ğ
m_ÿ·c™y
 && 
m_maxD—dC­ac™y
 && 
m_d—dSize
 <= m_maxDeadCapacity)

125 
´uÃD—dResourûs
();

126 
´uÃLiveResourûs
();

129 
£tD—dDecodedD©aD–‘iÚIÁ”v®
(
š‹rv®
è{ 
	gm_d—dDecodedD©aD–‘iÚIÁ”v®
 = interval; }

130 
d—dDecodedD©aD–‘iÚIÁ”v®
(ècÚ¡ {  
	gm_d—dDecodedD©aD–‘iÚIÁ”v®
; }

133 
»move
(
CachedResourû
* 
»sourû
è{ 
eviù
(resource); }

135 
addDocLßd”
(
DocLßd”
*);

136 
»moveDocLßd”
(
DocLßd”
*);

138 
CachedResourû
* 
»sourûFÜURL
(cÚ¡ 
SŒšg
&);

141 
š£¹InLRULi¡
(
CachedResourû
*);

142 
»moveFromLRULi¡
(
CachedResourû
*);

145 
adju¡Size
(
boŞ
 
live
, 
d–
);

148 
š£¹InLiveDecodedResourûsLi¡
(
CachedResourû
*);

149 
»moveFromLiveDecodedResourûsLi¡
(
CachedResourû
*);

151 
addToLiveResourûsSize
(
CachedResourû
*);

152 
»moveFromLiveResourûsSize
(
CachedResourû
*);

155 
Sti¡ics
 
g‘Sti¡ics
();

157 
	g´iv©e
:

158 
Cache
();

159 ~
Cache
();

161 
LRULi¡
* 
ÌuLi¡FÜ
(
CachedResourû
*);

162 
»sourûAcûs£d
(
CachedResourû
*);

163 #iâdeà
NDEBUG


164 
dumpSts
();

165 
dumpLRULi¡s
(
boŞ
 
šşudeLive
) const;

168 
liveC­ac™y
() const;

169 
d—dC­ac™y
() const;

171 
´uÃD—dResourûs
();

172 
´uÃLiveResourûs
();

174 
eviù
(
CachedResourû
*);

177 
	gHashS‘
<
	gDocLßd”
*> 
	gm_docLßd”s
;

178 
Lßd”
 
	gm_lßd”
;

180 
boŞ
 
	gm_di§bËd
;

181 
boŞ
 
	gm_´uÃEÇbËd
;

182 
boŞ
 
	gm_šPruÃD—dResourûs
;

184 
	gm_ÿ·c™y
;

185 
	gm_mšD—dC­ac™y
;

186 
	gm_maxD—dC­ac™y
;

187 
	gm_d—dDecodedD©aD–‘iÚIÁ”v®
;

189 
	gm_liveSize
;

190 
	gm_d—dSize
;

195 
	gVeùÜ
<
	gLRULi¡
, 32> 
	gm_®lResourûs
;

198 
LRULi¡
 
	gm_liveDecodedResourûs
;

202 
	gHashM­
<
	gSŒšg
, 
	gCachedResourû
*> 
	gm_»sourûs
;

208 
Cache
* 
ÿche
();

	@CachePolicy.h

26 #iâdeà
CachePŞicy_h


27 
	#CachePŞicy_h


	)

29 
Çme¥aû
 
	gWebCÜe
 {

31 
	eCachePŞicy
 {

32 
	gCachePŞicyCache
,

33 
	gCachePŞicyV”ify
,

34 
	gCachePŞicyRev®id©e
,

35 
	gCachePŞicyR–ßd
,

36 
	gCachePŞicyAÎowSË


	@CachedCSSStyleSheet.cpp

2 #ifdeà
SSLAB__DEBUG


3 #iâdeà
SSLAB__QDATETIME


4 
	#SSLAB__QDATETIME


	)

5 
	~<QD©eTime
>

9 #ifdeà
SSLAB__DEBUG


10 #iâdeà
SSLAB__QTHREAD


11 
	#SSLAB__QTHREAD


	)

12 
	~<QTh»ad
>

41 
	~"cÚfig.h
"

42 
	~"CachedCSSStyËSh“t.h
"

44 
	~"CachedResourûCl›Á.h
"

45 
	~"CachedResourûCl›ÁW®k”.h
"

46 
	~"HTTPP¬£rs.h
"

47 
	~"TextResourûDecod”.h
"

48 
	~"Sh¬edBufãr.h
"

49 
	~"lßd”.h
"

50 
	~<wtf/VeùÜ.h
>

52 
Çme¥aû
 
	gWebCÜe
 {

54 
	gCachedCSSStyËSh“t
::
CachedCSSStyËSh“t
(cÚ¡ 
SŒšg
& 
u¾
, cÚ¡ SŒšg& 
ch¬£t
)

55 : 
CachedResourû
(
u¾
, 
CSSStyËSh“t
)

56 , 
m_decod”
(
TextResourûDecod”
::
ü—‹
("‹xt/css", 
ch¬£t
))

60 
£tAcû±
("text/css,*/*;q=0.1");

63 
	gCachedCSSStyËSh“t
::~
CachedCSSStyËSh“t
()

65 #ifdeà
SSLAB__DEBUG


66 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

71 
	gCachedCSSStyËSh“t
::
didAddCl›Á
(
CachedResourûCl›Á
 *
c
)

73 #ifdeà
SSLAB__DEBUG


74 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

77 ià(!
	gm_lßdšg
)

78 
	gc
->
£tCSSStyËSh“t
(
m_u¾
, 
m_»¥Ú£
.
u¾
(), 
m_decod”
->
’codšg
().
Çme
(), 
this
);

81 
	gCachedCSSStyËSh“t
::
®lCl›ÁsRemoved
()

83 #ifdeà
SSLAB__DEBUG


84 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

87 ià(
isSaãToMakePurg—bË
())

88 
makePurg—bË
(
Œue
);

91 
	gCachedCSSStyËSh“t
::
£tEncodšg
(cÚ¡ 
SŒšg
& 
chs
)

93 #ifdeà
SSLAB__DEBUG


94 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

97 
	gm_decod”
->
£tEncodšg
(
chs
, 
TextResourûDecod”
::
EncodšgFromHTTPH—d”
);

100 
SŒšg
 
	gCachedCSSStyËSh“t
::
’codšg
() const

102 #ifdeà
SSLAB__DEBUG


103 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

106  
	gm_decod”
->
’codšg
().
Çme
();

109 cÚ¡ 
SŒšg
 
	gCachedCSSStyËSh“t
::
sh“tText
(
boŞ
 
’fÜûMIMETy³
, boŞ* 
hasV®idMIMETy³
) const

111 #ifdeà
SSLAB__DEBUG


112 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

115 
ASSERT
(!
isPurg—bË
());

117 ià(!
	gm_d©a
 || m_d©a->
isEm±y
(è|| !
ÿnU£Sh“t
(
’fÜûMIMETy³
, 
hasV®idMIMETy³
))

118  
SŒšg
();

120 ià(!
	gm_decodedSh“tText
.
isNuÎ
())

121  
	gm_decodedSh“tText
;

124 
SŒšg
 
	gsh“tText
 = 
m_decod”
->
decode
(
m_d©a
->
d©a
(), m_d©a->
size
());

125 
	gsh“tText
 +ğ
m_decod”
->
æush
();

126  
	gsh“tText
;

129 
	gCachedCSSStyËSh“t
::
d©a
(
PassRefPŒ
<
Sh¬edBufãr
> d©a, 
boŞ
 
®lD©aReûived
)

131 #ifdeà
SSLAB__DEBUG


132 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

135 ià(!
	g®lD©aReûived
)

138 
	gm_d©a
 = 
d©a
;

139 
£tEncodedSize
(
m_d©a
.
g‘
(è? m_d©a->
size
() : 0);

141 ià(
	gm_d©a
) {

142 
	gm_decodedSh“tText
 = 
m_decod”
->
decode
(
m_d©a
->
d©a
(), m_d©a->
size
());

143 
	gm_decodedSh“tText
 +ğ
m_decod”
->
æush
();

145 
	gm_lßdšg
 = 
çl£
;

146 
checkNÙify
();

148 
	gm_decodedSh“tText
 = 
SŒšg
();

151 
	gCachedCSSStyËSh“t
::
checkNÙify
()

153 #ifdeà
SSLAB__DEBUG


154 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

157 ià(
	gm_lßdšg
)

160 
CachedResourûCl›ÁW®k”
 
w
(
m_ş›Ás
);

161 
CachedResourûCl›Á
 *
	gc
 = 
w
.
Ãxt
())

162 
c
->
£tCSSStyËSh“t
(
m_u¾
, 
m_»¥Ú£
.
u¾
(), 
m_decod”
->
’codšg
().
Çme
(), 
this
);

165 
	gCachedCSSStyËSh“t
::
”rÜ
()

167 #ifdeà
SSLAB__DEBUG


168 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

171 
	gm_lßdšg
 = 
çl£
;

172 
	gm_”rÜOccu¼ed
 = 
Œue
;

173 
checkNÙify
();

176 
boŞ
 
	gCachedCSSStyËSh“t
::
ÿnU£Sh“t
(boŞ 
’fÜûMIMETy³
, boŞ* 
hasV®idMIMETy³
) const

178 #ifdeà
SSLAB__DEBUG


179 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

182 ià(
”rÜOccu¼ed
())

183  
	gçl£
;

185 ià(!
	g’fÜûMIMETy³
 && !
	ghasV®idMIMETy³
)

186  
	gŒue
;

195 
SŒšg
 
	gmimeTy³
 = 
exŒaùMIMETy³FromMedŸTy³
(
»¥Ú£
().
h‰pH—d”F›ld
("Content-Type"));

196 
boŞ
 
	gty³OK
 = 
mimeTy³
.
isEm±y
(è|| 
equ®IgnÜšgCa£
(mimeType, "text/css") ||ƒqualIgnoringCase(mimeType, "application/x-unknown-content-type");

197 ià(
	ghasV®idMIMETy³
)

198 *
	ghasV®idMIMETy³
 = 
ty³OK
;

199 ià(!
	g’fÜûMIMETy³
)

200  
	gŒue
;

201  
	gty³OK
;

	@CachedCSSStyleSheet.h

26 #iâdeà
CachedCSSStyËSh“t_h


27 
	#CachedCSSStyËSh“t_h


	)

29 
	~"CachedResourû.h
"

30 
	~"TextEncodšg.h
"

31 
	~<wtf/VeùÜ.h
>

33 
Çme¥aû
 
	gWebCÜe
 {

35 
şass
 
	gDocLßd”
;

36 
şass
 
	gTextResourûDecod”
;

38 şas 
	cCachedCSSStyËSh“t
 : 
public
 
CachedResourû
 {

39 
public
:

40 
CachedCSSStyËSh“t
(cÚ¡ 
SŒšg
& 
URL
, cÚ¡ SŒšg& 
ch¬£t
);

41 
	gvœtu®
 ~
CachedCSSStyËSh“t
();

43 cÚ¡ 
SŒšg
 
sh“tText
(
boŞ
 
’fÜûMIMETy³
 = 
Œue
, boŞ* 
hasV®idMIMETy³
 = 0) const;

45 
vœtu®
 
didAddCl›Á
(
CachedResourûCl›Á
*);

47 
vœtu®
 
®lCl›ÁsRemoved
();

49 
vœtu®
 
£tEncodšg
(cÚ¡ 
SŒšg
&);

50 
vœtu®
 
SŒšg
 
’codšg
() const;

51 
vœtu®
 
d©a
(
PassRefPŒ
<
Sh¬edBufãr
> d©a, 
boŞ
 
®lD©aReûived
);

52 
vœtu®
 
”rÜ
();

54 
vœtu®
 
boŞ
 
scheduË
(ècÚ¡ {  
	gŒue
; }

56 
checkNÙify
();

58 
	g´iv©e
:

59 
boŞ
 
ÿnU£Sh“t
(boŞ 
’fÜûMIMETy³
, boŞ* 
hasV®idMIMETy³
) const;

61 
	g´Ùeùed
:

62 
RefPŒ
<
TextResourûDecod”
> 
m_decod”
;

63 
SŒšg
 
	gm_decodedSh“tText
;

	@CachedFont.cpp

2 #ifdeà
SSLAB__DEBUG


3 #iâdeà
SSLAB__QDATETIME


4 
	#SSLAB__QDATETIME


	)

5 
	~<QD©eTime
>

9 #ifdeà
SSLAB__DEBUG


10 #iâdeà
SSLAB__QTHREAD


11 
	#SSLAB__QTHREAD


	)

12 
	~<QTh»ad
>

41 
	~"cÚfig.h
"

42 
	~"CachedFÚt.h
"

44 #ià
PLATFORM
(
CG
è|| PLATFORM(
QT
è|| PLATFORM(
GTK
è|| (PLATFORM(
CHROMIUM
è&& (
OS
(
WINDOWS
è|| OS(
LINUX
))è|| PLATFORM(
HAIKU
è|| OS(
WINCE
)

45 
	#STORE_FONT_CUSTOM_PLATFORM_DATA


	)

48 
	~"Cache.h
"

49 
	~"CachedResourûCl›Á.h
"

50 
	~"CachedResourûCl›ÁW®k”.h
"

51 
	~"FÚtPÏtfÜmD©a.h
"

52 
	~"Sh¬edBufãr.h
"

53 
	~"TextResourûDecod”.h
"

54 
	~"lßd”.h
"

55 
	~<wtf/VeùÜ.h
>

57 #ifdeà
STORE_FONT_CUSTOM_PLATFORM_DATA


58 
	~"FÚtCu¡omPÏtfÜmD©a.h
"

61 #ià
ENABLE
(
SVG_FONTS
)

62 
	~"HTMLNames.h
"

63 
	~"NodeLi¡.h
"

64 
	~"SVGEËm’t.h
"

65 
	~"SVGFÚtEËm’t.h
"

66 
	~"SVGGEËm’t.h
"

69 
Çme¥aû
 
	gWebCÜe
 {

71 
	gCachedFÚt
::
CachedFÚt
(cÚ¡ 
SŒšg
 &
u¾
)

72 : 
CachedResourû
(
u¾
, 
FÚtResourû
)

73 , 
m_fÚtD©a
(0)

74 , 
m_lßdIn™Ÿ‹d
(
çl£
)

75 #ià
ENABLE
(
SVG_FONTS
)

76 , 
m_isSVGFÚt
(
çl£
)

81 
	gCachedFÚt
::~
CachedFÚt
()

83 #ifdeà
SSLAB__DEBUG


84 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

87 #ifdeà
STORE_FONT_CUSTOM_PLATFORM_DATA


88 
d–‘e
 
	gm_fÚtD©a
;

92 
	gCachedFÚt
::
lßd
(
DocLßd”
*)

94 #ifdeà
SSLAB__DEBUG


95 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

99 
	gm_lßdšg
 = 
Œue
;

102 
	gCachedFÚt
::
didAddCl›Á
(
CachedResourûCl›Á
* 
c
)

104 #ifdeà
SSLAB__DEBUG


105 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

108 ià(!
	gm_lßdšg
)

109 
	gc
->
fÚtLßded
(
this
);

112 
	gCachedFÚt
::
d©a
(
PassRefPŒ
<
Sh¬edBufãr
> d©a, 
boŞ
 
®lD©aReûived
)

114 #ifdeà
SSLAB__DEBUG


115 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

118 ià(!
	g®lD©aReûived
)

121 
	gm_d©a
 = 
d©a
;

122 
£tEncodedSize
(
m_d©a
.
g‘
(è? m_d©a->
size
() : 0);

123 
	gm_lßdšg
 = 
çl£
;

124 
checkNÙify
();

127 
	gCachedFÚt
::
begšLßdIfN“ded
(
DocLßd”
* 
dl
)

129 #ifdeà
SSLAB__DEBUG


130 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

133 ià(!
	gm_lßdIn™Ÿ‹d
) {

134 
	gm_lßdIn™Ÿ‹d
 = 
Œue
;

135 
ÿche
()->
lßd”
()->
lßd
(
dl
, 
this
, 
çl£
);

139 
boŞ
 
	gCachedFÚt
::
’su»Cu¡omFÚtD©a
()

141 #ifdeà
SSLAB__DEBUG


142 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

145 #ifdeà
STORE_FONT_CUSTOM_PLATFORM_DATA


146 #ià
ENABLE
(
SVG_FONTS
)

147 
ASSERT
(!
m_isSVGFÚt
);

149 ià(!
	gm_fÚtD©a
 && !
	gm_”rÜOccu¼ed
 && !
	gm_lßdšg
 && 
	gm_d©a
) {

150 
	gm_fÚtD©a
 = 
ü—‹FÚtCu¡omPÏtfÜmD©a
(
m_d©a
.
g‘
());

151 ià(!
	gm_fÚtD©a
)

152 
	gm_”rÜOccu¼ed
 = 
Œue
;

155  
	gm_fÚtD©a
;

158 
FÚtPÏtfÜmD©a
 
	gCachedFÚt
::
¶©fÜmD©aFromCu¡omD©a
(
size
, 
boŞ
 
bŞd
, boŞ 
™®ic
, 
FÚtR’d”šgMode
 
»nd”šgMode
)

160 #ifdeà
SSLAB__DEBUG


161 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

164 #ià
ENABLE
(
SVG_FONTS
)

165 ià(
	gm_ex‹º®SVGDocum’t
)

166  
FÚtPÏtfÜmD©a
(
size
, 
bŞd
, 
™®ic
);

168 #ifdeà
STORE_FONT_CUSTOM_PLATFORM_DATA


169 
ASSERT
(
m_fÚtD©a
);

170  
	gm_fÚtD©a
->
fÚtPÏtfÜmD©a
(
¡©ic_ÿ¡
<>(
size
), 
bŞd
, 
™®ic
, 
»nd”šgMode
);

172  
FÚtPÏtfÜmD©a
();

176 #ià
ENABLE
(
SVG_FONTS
)

177 
boŞ
 
	gCachedFÚt
::
’su»SVGFÚtD©a
()

179 #ifdeà
SSLAB__DEBUG


180 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

183 
ASSERT
(
m_isSVGFÚt
);

184 ià(!
	gm_ex‹º®SVGDocum’t
 && !
	gm_”rÜOccu¼ed
 && !
	gm_lßdšg
 && 
	gm_d©a
) {

185 
	gm_ex‹º®SVGDocum’t
 = 
SVGDocum’t
::
ü—‹
(0);

186 
	gm_ex‹º®SVGDocum’t
->
İ’
();

188 
	gRefPŒ
<
	gTextResourûDecod”
> 
	gdecod”
 = 
TextResourûDecod”
::
ü—‹
("application/xml");

189 
	gm_ex‹º®SVGDocum’t
->
wr™e
(
decod”
->
decode
(
m_d©a
->
d©a
(), m_d©a->
size
()));

190 
	gm_ex‹º®SVGDocum’t
->
wr™e
(
decod”
->
æush
());

191 ià(
	gdecod”
->
§wE¼Ü
()) {

192 
	gm_ex‹º®SVGDocum’t
.
ş—r
();

196 
	gm_ex‹º®SVGDocum’t
->
fšishP¬sšg
();

197 
	gm_ex‹º®SVGDocum’t
->
şo£
();

200  
	gm_ex‹º®SVGDocum’t
;

203 
SVGFÚtEËm’t
* 
	gCachedFÚt
::
g‘SVGFÚtById
(cÚ¡ 
SŒšg
& 
fÚtName
) const

205 #ifdeà
SSLAB__DEBUG


206 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

209 
ASSERT
(
m_isSVGFÚt
);

210 
	gRefPŒ
<
	gNodeLi¡
> 
	gli¡
 = 
m_ex‹º®SVGDocum’t
->
g‘EËm’tsByTagName
(
SVGNames
::
fÚtTag
.
loÿlName
());

211 ià(!
	gli¡
)

214 
	gfÚts
 = 
li¡
->
Ëngth
();

215 
	gi
 = 0; i < 
	gfÚts
; ++i) {

216 
Node
* 
	gnode
 = 
li¡
->
™em
(
i
);

217 
ASSERT
(
node
);

219 ià(
	g¡©ic_ÿ¡
<
	gEËm’t
*>(
	gnode
)->
g‘A‰ribu‹
(
¡©ic_ÿ¡
<
EËm’t
*>(
node
)->
idA‰ribu‹Name
()è!ğ
fÚtName
)

222 
ASSERT
(
node
->
hasTagName
(
SVGNames
::
fÚtTag
));

223  
	g¡©ic_ÿ¡
<
	gSVGFÚtEËm’t
*>(
	gnode
);

230 
	gCachedFÚt
::
®lCl›ÁsRemoved
()

232 #ifdeà
SSLAB__DEBUG


233 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

236 #ifdeà
STORE_FONT_CUSTOM_PLATFORM_DATA


237 ià(
	gm_fÚtD©a
) {

238 
d–‘e
 
	gm_fÚtD©a
;

239 
	gm_fÚtD©a
 = 0;

244 
	gCachedFÚt
::
checkNÙify
()

246 #ifdeà
SSLAB__DEBUG


247 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

250 ià(
	gm_lßdšg
)

253 
CachedResourûCl›ÁW®k”
 
w
(
m_ş›Ás
);

254 
CachedResourûCl›Á
 *
	gc
 = 
w
.
Ãxt
())

255 
c
->
fÚtLßded
(
this
);

259 
	gCachedFÚt
::
”rÜ
()

261 #ifdeà
SSLAB__DEBUG


262 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

265 
	gm_lßdšg
 = 
çl£
;

266 
	gm_”rÜOccu¼ed
 = 
Œue
;

267 
checkNÙify
();

	@CachedFont.h

26 #iâdeà
CachedFÚt_h


27 
	#CachedFÚt_h


	)

29 
	~"CachedResourû.h
"

30 
	~"FÚtR’d”šgMode.h
"

31 
	~<wtf/VeùÜ.h
>

33 #ià
ENABLE
(
SVG_FONTS
)

34 
	~"SVGEËm’t.h
"

35 
	~"SVGDocum’t.h
"

38 
Çme¥aû
 
	gWebCÜe
 {

40 
şass
 
	gDocLßd”
;

41 
şass
 
	gCache
;

42 
şass
 
	gFÚtPÏtfÜmD©a
;

43 
şass
 
	gSVGFÚtEËm’t
;

45 
	gFÚtCu¡omPÏtfÜmD©a
;

47 şas 
	cCachedFÚt
 : 
public
 
CachedResourû
 {

48 
public
:

49 
CachedFÚt
(cÚ¡ 
SŒšg
& 
u¾
);

50 
	gvœtu®
 ~
CachedFÚt
();

52 
vœtu®
 
lßd
(
DocLßd”
* 
docLßd”
);

54 
vœtu®
 
didAddCl›Á
(
CachedResourûCl›Á
*);

55 
vœtu®
 
d©a
(
PassRefPŒ
<
Sh¬edBufãr
> d©a, 
boŞ
 
®lD©aReûived
);

56 
vœtu®
 
”rÜ
();

58 
vœtu®
 
®lCl›ÁsRemoved
();

60 
vœtu®
 
boŞ
 
scheduË
(ècÚ¡ {  
	gŒue
; }

62 
checkNÙify
();

64 
begšLßdIfN“ded
(
DocLßd”
* 
dl
);

66 
boŞ
 
’su»Cu¡omFÚtD©a
();

67 
FÚtPÏtfÜmD©a
 
¶©fÜmD©aFromCu¡omD©a
(
size
, 
boŞ
 
bŞd
, boŞ 
™®ic
, 
FÚtR’d”šgMode
 = 
NÜm®R’d”šgMode
);

69 #ià
ENABLE
(
SVG_FONTS
)

70 
boŞ
 
isSVGFÚt
(ècÚ¡ {  
	gm_isSVGFÚt
; }

71 
£tSVGFÚt
(
boŞ
 
isSVG
è{ 
	gm_isSVGFÚt
 = isSVG; }

72 
boŞ
 
’su»SVGFÚtD©a
();

73 
SVGFÚtEËm’t
* 
g‘SVGFÚtById
(cÚ¡ 
SŒšg
&) const;

76 
	g´iv©e
:

77 
FÚtCu¡omPÏtfÜmD©a
* 
m_fÚtD©a
;

78 
boŞ
 
	gm_lßdIn™Ÿ‹d
;

80 #ià
ENABLE
(
SVG_FONTS
)

81 
boŞ
 
	gm_isSVGFÚt
;

82 
	gRefPŒ
<
	gSVGDocum’t
> 
	gm_ex‹º®SVGDocum’t
;

85 
ä›nd
 
şass
 
	gCache
;

	@CachedImage.cpp

2 #ifdeà
SSLAB__DEBUG


3 #iâdeà
SSLAB__QDATETIME


4 
	#SSLAB__QDATETIME


	)

5 
	~<QD©eTime
>

9 #ifdeà
SSLAB__DEBUG


10 #iâdeà
SSLAB__QTHREAD


11 
	#SSLAB__QTHREAD


	)

12 
	~<QTh»ad
>

38 
	~"cÚfig.h
"

39 
	~"CachedImage.h
"

41 
	~"B™m­Image.h
"

42 
	~"Cache.h
"

43 
	~"CachedResourûCl›Á.h
"

44 
	~"CachedResourûCl›ÁW®k”.h
"

45 
	~"DocLßd”.h
"

46 
	~"F¿me.h
"

47 
	~"F¿meLßd”Ty³s.h
"

48 
	~"F¿meV›w.h
"

49 
	~"Reque¡.h
"

50 
	~"S‘tšgs.h
"

51 
	~"Sh¬edBufãr.h
"

52 
	~<wtf/Cu¼’tTime.h
>

53 
	~<wtf/StdLibExŒas.h
>

54 
	~<wtf/VeùÜ.h
>

56 #ià
PLATFORM
(
CG
)

57 
	~"PDFDocum’tImage.h
"

60 #ià
ENABLE
(
SVG_AS_IMAGE
)

61 
	~"SVGImage.h
"

64 
usšg
 
	g¡d
::
max
;

66 
Çme¥aû
 
	gWebCÜe
 {

68 
	gCachedImage
::
CachedImage
(cÚ¡ 
SŒšg
& 
u¾
)

69 : 
CachedResourû
(
u¾
, 
ImageResourû
)

70 , 
m_image
(0)

71 , 
m_decodedD©aD–‘iÚTim”
(
this
, &
CachedImage
::
decodedD©aD–‘iÚTim”Fœed
)

72 , 
m_h‰pStusCodeE¼ÜOccu¼ed
(
çl£
)

74 #ifdeà
SSLAB__DEBUG


75 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

78 
	gm_¡©us
 = 
Unknown
;

81 
	gCachedImage
::
CachedImage
(
Image
* 
image
)

82 : 
CachedResourû
(
SŒšg
(), 
ImageResourû
)

83 , 
m_image
(
image
)

84 , 
m_decodedD©aD–‘iÚTim”
(
this
, &
CachedImage
::
decodedD©aD–‘iÚTim”Fœed
)

85 , 
m_h‰pStusCodeE¼ÜOccu¼ed
(
çl£
)

87 #ifdeà
SSLAB__DEBUG


88 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

91 
	gm_¡©us
 = 
Cached
;

92 
	gm_lßdšg
 = 
çl£
;

95 
	gCachedImage
::~
CachedImage
()

97 #ifdeà
SSLAB__DEBUG


98 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

103 
	gCachedImage
::
decodedD©aD–‘iÚTim”Fœed
(
Tim”
<
CachedImage
>*)

105 #ifdeà
SSLAB__DEBUG


106 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

109 
ASSERT
(!
hasCl›Ás
());

110 
de¡royDecodedD©a
();

113 
	gCachedImage
::
lßd
(
DocLßd”
* 
docLßd”
)

115 #ifdeà
SSLAB__DEBUG


116 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

119 ià(!
	gdocLßd”
 || docLßd”->
autoLßdImages
())

120 
	gCachedResourû
::
lßd
(
docLßd”
, 
Œue
, 
DoSecur™yCheck
,rue);

122 
	gm_lßdšg
 = 
çl£
;

125 
	gCachedImage
::
didAddCl›Á
(
CachedResourûCl›Á
* 
c
)

127 #ifdeà
SSLAB__DEBUG


128 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

131 ià(
	gm_decodedD©aD–‘iÚTim”
.
isAùive
())

132 
	gm_decodedD©aD–‘iÚTim”
.
¡İ
();

134 ià(
	gm_d©a
 && !
	gm_image
 && !
	gm_”rÜOccu¼ed
) {

135 
ü—‹Image
();

136 
	gm_image
->
£tD©a
(
m_d©a
, 
Œue
);

139 ià(
	gm_image
 && !m_image->
isNuÎ
())

140 
	gc
->
imageChªged
(
this
);

142 ià(!
	gm_lßdšg
)

143 
	gc
->
nÙifyFšished
(
this
);

146 
	gCachedImage
::
®lCl›ÁsRemoved
()

148 #ifdeà
SSLAB__DEBUG


149 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

152 ià(
	gm_image
 && !
	gm_”rÜOccu¼ed
)

153 
	gm_image
->
»£tAnim©iÚ
();

154 ià(
	gš‹rv®
 = 
ÿche
()->
d—dDecodedD©aD–‘iÚIÁ”v®
())

155 
m_decodedD©aD–‘iÚTim”
.
¡¬tOÃShÙ
(
š‹rv®
);

158 
Image
* 
brok’Image
()

160 #ifdeà
SSLAB__DEBUG


161 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

164 
DEFINE_STATIC_LOCAL
(
RefPŒ
<
Image
>, 
brok’Image
, (Image::
lßdPÏtfÜmResourû
("missingImage")));

165  
	gbrok’Image
.
g‘
();

168 
Image
* 
nuÎImage
()

170 #ifdeà
SSLAB__DEBUG


171 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

174 
DEFINE_STATIC_LOCAL
(
RefPŒ
<
B™m­Image
>, 
nuÎImage
, (B™m­Image::
ü—‹
()));

175  
	gnuÎImage
.
g‘
();

178 
Image
* 
	gCachedImage
::
image
() const

180 #ifdeà
SSLAB__DEBUG


181 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

184 
ASSERT
(!
isPurg—bË
());

186 ià(
	gm_”rÜOccu¼ed
)

187  
brok’Image
();

189 ià(
	gm_image
)

190  
	gm_image
.
g‘
();

192  
nuÎImage
();

195 
	gCachedImage
::
£tImageCÚš”Size
(cÚ¡ 
IÁSize
& 
cÚš”Size
)

197 #ifdeà
SSLAB__DEBUG


198 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

201 ià(
	gm_image
)

202 
	gm_image
->
£tCÚš”Size
(
cÚš”Size
);

205 
boŞ
 
	gCachedImage
::
u£sImageCÚš”Size
() const

207 #ifdeà
SSLAB__DEBUG


208 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

211 ià(
	gm_image
)

212  
	gm_image
->
u£sCÚš”Size
();

214  
	gçl£
;

217 
boŞ
 
	gCachedImage
::
imageHasR–©iveWidth
() const

219 #ifdeà
SSLAB__DEBUG


220 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

223 ià(
	gm_image
)

224  
	gm_image
->
hasR–©iveWidth
();

226  
	gçl£
;

229 
boŞ
 
	gCachedImage
::
imageHasR–©iveHeight
() const

231 #ifdeà
SSLAB__DEBUG


232 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

235 ià(
	gm_image
)

236  
	gm_image
->
hasR–©iveHeight
();

238  
	gçl£
;

241 
IÁSize
 
	gCachedImage
::
imageSize
(
muÉl›r
) const

243 #ifdeà
SSLAB__DEBUG


244 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

247 
ASSERT
(!
isPurg—bË
());

249 ià(!
	gm_image
)

250  
IÁSize
();

251 ià(
	gmuÉl›r
 == 1.0f)

252  
m_image
->
size
();

255 
boŞ
 
	ghasWidth
 = 
m_image
->
size
().
width
() > 0;

256 
boŞ
 
	ghasHeight
 = 
m_image
->
size
().
height
() > 0;

257 
	gwidth
 = 
m_image
->
size
().
width
(è* (m_image->
hasR–©iveWidth
(è? 1.0à: 
muÉl›r
);

258 
	gheight
 = 
m_image
->
size
().
height
(è* (m_image->
hasR–©iveHeight
(è? 1.0à: 
muÉl›r
);

259 ià(
	ghasWidth
)

260 
	gwidth
 = 
max
(1, 
width
);

261 ià(
	ghasHeight
)

262 
	gheight
 = 
max
(1, 
height
);

263  
IÁSize
(
width
, 
height
);

266 
IÁReù
 
	gCachedImage
::
imageReù
(
muÉl›r
) const

268 #ifdeà
SSLAB__DEBUG


269 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

272 
ASSERT
(!
isPurg—bË
());

274 ià(!
	gm_image
)

275  
IÁReù
();

276 ià(
	gmuÉl›r
 =ğ1.0à|| (!
m_image
->
hasR–©iveWidth
(è&& !m_image->
hasR–©iveHeight
()))

277  
m_image
->
»ù
();

279 
	gwidthMuÉl›r
 = (
m_image
->
hasR–©iveWidth
(è? 1.0à: 
muÉl›r
);

280 
	gheightMuÉl›r
 = (
m_image
->
hasR–©iveHeight
(è? 1.0à: 
muÉl›r
);

283 
boŞ
 
	ghasWidth
 = 
m_image
->
»ù
().
width
() > 0;

284 
boŞ
 
	ghasHeight
 = 
m_image
->
»ù
().
height
() > 0;

286 
	gwidth
 = 
¡©ic_ÿ¡
<>(
m_image
->
»ù
().
width
(è* 
widthMuÉl›r
);

287 
	gheight
 = 
¡©ic_ÿ¡
<>(
m_image
->
»ù
().
height
(è* 
heightMuÉl›r
);

288 ià(
	ghasWidth
)

289 
	gwidth
 = 
max
(1, 
width
);

290 ià(
	ghasHeight
)

291 
	gheight
 = 
max
(1, 
height
);

293 
	gx
 = 
¡©ic_ÿ¡
<>(
m_image
->
»ù
().
x
(è* 
widthMuÉl›r
);

294 
	gy
 = 
¡©ic_ÿ¡
<>(
m_image
->
»ù
().
y
(è* 
heightMuÉl›r
);

296  
IÁReù
(
x
, 
y
, 
width
, 
height
);

299 
	gCachedImage
::
nÙifyOb£rv”s
(cÚ¡ 
IÁReù
* 
chªgeReù
)

301 #ifdeà
SSLAB__DEBUG


302 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

305 
CachedResourûCl›ÁW®k”
 
w
(
m_ş›Ás
);

306 
CachedResourûCl›Á
* 
	gc
 = 
w
.
Ãxt
())

307 
c
->
imageChªged
(
this
, 
chªgeReù
);

310 
	gCachedImage
::
ş—r
()

312 #ifdeà
SSLAB__DEBUG


313 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

316 
de¡royDecodedD©a
();

317 
	gm_image
 = 0;

318 
£tEncodedSize
(0);

321 
šlše
 
	gCachedImage
::
ü—‹Image
()

323 #ifdeà
SSLAB__DEBUG


324 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

328 ià(
	gm_image
)

330 #ià
PLATFORM
(
CG
)

331 ià(
	gm_»¥Ú£
.
mimeTy³
() == "application/pdf") {

332 
m_image
 = 
PDFDocum’tImage
::
ü—‹
();

336 #ià
ENABLE
(
SVG_AS_IMAGE
)

337 ià(
	gm_»¥Ú£
.
mimeTy³
() == "image/svg+xml") {

338 
m_image
 = 
SVGImage
::
ü—‹
(
this
);

342 
	gm_image
 = 
B™m­Image
::
ü—‹
(
this
);

345 
size_t
 
	gCachedImage
::
maximumDecodedImageSize
()

347 #ifdeà
SSLAB__DEBUG


348 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

351 
F¿me
* 
	gäame
 = 
m_»que¡
 ? m_»que¡->
docLßd”
()->
äame
() : 0;

352 ià(!
	gäame
)

354 
S‘tšgs
* 
	g£‰šgs
 = 
äame
->
£‰šgs
();

355  
	g£‰šgs
 ? s‘tšgs->
maximumDecodedImageSize
() : 0;

358 
	gCachedImage
::
d©a
(
PassRefPŒ
<
Sh¬edBufãr
> d©a, 
boŞ
 
®lD©aReûived
)

360 #ifdeà
SSLAB__DEBUG


361 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

364 
	gm_d©a
 = 
d©a
;

366 
ü—‹Image
();

368 
boŞ
 
	gsizeAvaabË
 = 
çl£
;

373 
	gsizeAvaabË
 = 
m_image
->
£tD©a
(
m_d©a
, 
®lD©aReûived
);

379 ià(
	gsizeAvaabË
 || 
	g®lD©aReûived
) {

380 
size_t
 
	gmaxDecodedImageSize
 = 
maximumDecodedImageSize
();

381 
IÁSize
 
	gs
 = 
imageSize
(1.0f);

382 
size_t
 
	ge¡im©edDecodedImageSize
 = 
s
.
width
(è* s.
height
() * 4;

384 ià(
	gm_image
->
isNuÎ
(è|| (
	gmaxDecodedImageSize
 > 0 && 
	ge¡im©edDecodedImageSize
 > maxDecodedImageSize)) {

385 
”rÜ
();

386 ià(
šCache
())

387 
ÿche
()->
»move
(
this
);

393 
nÙifyOb£rv”s
();

395 ià(
	gm_image
)

396 
£tEncodedSize
(
m_image
->
d©a
(è? m_image->d©a()->
size
() : 0);

399 ià(
	g®lD©aReûived
) {

400 
	gm_lßdšg
 = 
çl£
;

401 
checkNÙify
();

405 
	gCachedImage
::
”rÜ
()

407 #ifdeà
SSLAB__DEBUG


408 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

411 
ş—r
();

412 
	gm_”rÜOccu¼ed
 = 
Œue
;

413 
	gm_d©a
.
ş—r
();

414 
nÙifyOb£rv”s
();

415 
	gm_lßdšg
 = 
çl£
;

416 
checkNÙify
();

419 
	gCachedImage
::
checkNÙify
()

421 #ifdeà
SSLAB__DEBUG


422 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

425 ià(
	gm_lßdšg
)

428 
CachedResourûCl›ÁW®k”
 
w
(
m_ş›Ás
);

429 
CachedResourûCl›Á
* 
	gc
 = 
w
.
Ãxt
())

430 
c
->
nÙifyFšished
(
this
);

433 
	gCachedImage
::
de¡royDecodedD©a
()

435 #ifdeà
SSLAB__DEBUG


436 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

439 
boŞ
 
	gÿnD–‘eImage
 = !
m_image
 || (m_image->
hasOÃRef
(è&& m_image->
isB™m­Image
());

440 ià(
isSaãToMakePurg—bË
(è&& 
	gÿnD–‘eImage
 && !
	gm_lßdšg
) {

443 
	gm_image
 = 0;

444 
£tDecodedSize
(0);

445 
makePurg—bË
(
Œue
);

446 } ià(
	gm_image
 && !
	gm_”rÜOccu¼ed
)

447 
	gm_image
->
de¡royDecodedD©a
();

450 
	gCachedImage
::
decodedSizeChªged
(cÚ¡ 
Image
* 
image
, 
d–
)

452 #ifdeà
SSLAB__DEBUG


453 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

456 ià(
	gimage
 !ğ
m_image
)

459 
£tDecodedSize
(
decodedSize
(è+ 
d–
);

462 
	gCachedImage
::
didD¿w
(cÚ¡ 
Image
* 
image
)

464 #ifdeà
SSLAB__DEBUG


465 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

468 ià(
	gimage
 !ğ
m_image
)

471 
	gtimeSmp
 = 
F¿meV›w
::
cu¼’tPaštTimeSmp
();

472 ià(!
	gtimeSmp
)

473 
	gtimeSmp
 = 
cu¼’tTime
();

475 
	gCachedResourû
::
didAcûssDecodedD©a
(
timeSmp
);

478 
boŞ
 
	gCachedImage
::
shouldPau£Anim©iÚ
(cÚ¡ 
Image
* 
image
)

480 #ifdeà
SSLAB__DEBUG


481 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

484 ià(
	gimage
 !ğ
m_image
)

485  
çl£
;

487 
CachedResourûCl›ÁW®k”
 
w
(
m_ş›Ás
);

488 
CachedResourûCl›Á
* 
	gc
 = 
w
.
Ãxt
()) {

489 ià(
c
->
wlR’d”Image
(
this
))

490  
çl£
;

493  
	gŒue
;

496 
	gCachedImage
::
ªim©iÚAdvªûd
(cÚ¡ 
Image
* 
image
)

498 #ifdeà
SSLAB__DEBUG


499 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

502 ià(
	gimage
 =ğ
m_image
)

503 
nÙifyOb£rv”s
();

506 
	gCachedImage
::
chªgedInReù
(cÚ¡ 
Image
* 
image
, cÚ¡ 
IÁReù
& 
»ù
)

508 #ifdeà
SSLAB__DEBUG


509 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

512 ià(
	gimage
 =ğ
m_image
)

513 
nÙifyOb£rv”s
(&
»ù
);

	@CachedImage.h

23 #iâdeà
CachedImage_h


24 
	#CachedImage_h


	)

26 
	~"CachedResourû.h
"

27 
	~"ImageOb£rv”.h
"

28 
	~"IÁReù.h
"

29 
	~"Tim”.h
"

30 
	~<wtf/VeùÜ.h
>

32 
Çme¥aû
 
	gWebCÜe
 {

34 
şass
 
	gDocLßd”
;

35 
şass
 
	gCache
;

37 
şass
 
	gCachedImage
 : 
public
 
CachedResourû
,…ubliø
	gImageOb£rv”
 {

38 
ä›nd
 
şass
 
	gCache
;

40 
	gpublic
:

41 
CachedImage
(cÚ¡ 
SŒšg
& 
u¾
);

42 
CachedImage
(
Image
*);

43 
	gvœtu®
 ~
CachedImage
();

45 
vœtu®
 
lßd
(
DocLßd”
* 
docLßd”
);

47 
Image
* 
image
() const;

49 
boŞ
 
ÿnR’d”
(
muÉl›r
ècÚ¡ {  !
”rÜOccu¼ed
(è&& !
imageSize
(muÉl›r).
isEm±y
(); }

52 
£tImageCÚš”Size
(cÚ¡ 
IÁSize
&);

53 
boŞ
 
u£sImageCÚš”Size
() const;

54 
boŞ
 
imageHasR–©iveWidth
() const;

55 
boŞ
 
imageHasR–©iveHeight
() const;

59 
IÁSize
 
imageSize
(
muÉl›r
) const;

60 
IÁReù
 
imageReù
(
muÉl›r
) const;

62 
vœtu®
 
didAddCl›Á
(
CachedResourûCl›Á
*);

64 
vœtu®
 
®lCl›ÁsRemoved
();

65 
vœtu®
 
de¡royDecodedD©a
();

67 
vœtu®
 
d©a
(
PassRefPŒ
<
Sh¬edBufãr
> d©a, 
boŞ
 
®lD©aReûived
);

68 
vœtu®
 
”rÜ
();

70 
vœtu®
 
h‰pStusCodeE¼Ü
(è{ 
	gm_h‰pStusCodeE¼ÜOccu¼ed
 = 
Œue
; }

71 
boŞ
 
h‰pStusCodeE¼ÜOccu¼ed
(ècÚ¡ {  
	gm_h‰pStusCodeE¼ÜOccu¼ed
; }

73 
vœtu®
 
boŞ
 
scheduË
(ècÚ¡ {  
	gŒue
; }

75 
checkNÙify
();

77 
vœtu®
 
boŞ
 
isImage
(ècÚ¡ {  
	gŒue
; }

79 
ş—r
();

81 
boŞ
 
¡lN“dsLßd
(ècÚ¡ {  !
	gm_”rÜOccu¼ed
 && 
	gm_¡©us
 =ğ
Unknown
 && 
m_lßdšg
 =ğ
çl£
; }

82 
lßd
();

85 
vœtu®
 
decodedSizeChªged
(cÚ¡ 
Image
* 
image
, 
d–
);

86 
vœtu®
 
didD¿w
(cÚ¡ 
Image
*);

88 
vœtu®
 
boŞ
 
shouldPau£Anim©iÚ
(cÚ¡ 
Image
*);

89 
vœtu®
 
ªim©iÚAdvªûd
(cÚ¡ 
Image
*);

90 
vœtu®
 
chªgedInReù
(cÚ¡ 
Image
*, cÚ¡ 
IÁReù
&);

92 
	g´iv©e
:

93 
ü—‹Image
();

94 
size_t
 
maximumDecodedImageSize
();

96 
nÙifyOb£rv”s
(cÚ¡ 
IÁReù
* 
chªgeReù
 = 0);

97 
decodedD©aD–‘iÚTim”Fœed
(
Tim”
<
CachedImage
>*);

99 
	gRefPŒ
<
	gImage
> 
	gm_image
;

100 
	gTim”
<
	gCachedImage
> 
	gm_decodedD©aD–‘iÚTim”
;

101 
boŞ
 
	gm_h‰pStusCodeE¼ÜOccu¼ed
;

	@CachedResource.cpp

2 #ifdeà
SSLAB__DEBUG


3 #iâdeà
SSLAB__QDATETIME


4 
	#SSLAB__QDATETIME


	)

5 
	~<QD©eTime
>

9 #ifdeà
SSLAB__DEBUG


10 #iâdeà
SSLAB__QTHREAD


11 
	#SSLAB__QTHREAD


	)

12 
	~<QTh»ad
>

38 
	~"cÚfig.h
"

39 
	~"CachedResourû.h
"

41 
	~"Cache.h
"

42 
	~"CachedResourûHªdË.h
"

43 
	~"DocLßd”.h
"

44 
	~"F¿me.h
"

45 
	~"F¿meLßd”.h
"

46 
	~"KURL.h
"

47 
	~"Purg—bËBufãr.h
"

48 
	~"Reque¡.h
"

49 
	~"Sh¬edBufãr.h
"

50 
	~<wtf/Cu¼’tTime.h
>

51 
	~<wtf/M©hExŒas.h
>

52 
	~<wtf/RefCouÁedL—kCouÁ”.h
>

53 
	~<wtf/StdLibExŒas.h
>

54 
	~<wtf/VeùÜ.h
>

56 
usšg
 
Çme¥aû
 
	gWTF
;

58 
Çme¥aû
 
	gWebCÜe
 {

60 #iâdeà
NDEBUG


61 
RefCouÁedL—kCouÁ”
 
ÿchedResourûL—kCouÁ”
("CachedResource");

64 
	gCachedResourû
::
CachedResourû
(cÚ¡ 
SŒšg
& 
u¾
, 
Ty³
 
ty³
)

65 : 
m_u¾
(
u¾
)

66 , 
m_»¥Ú£Time¡amp
(
cu¼’tTime
())

67 , 
m_Ï¡DecodedAcûssTime
(0)

68 , 
m_£ndResourûLßdC®lbacks
(
Œue
)

69 , 
m_´–ßdCouÁ
(0)

70 , 
m_´–ßdResuÉ
(
P»lßdNÙReã»nûd
)

71 , 
m_»que¡edFromN‘wÜkšgLay”
(
çl£
)

72 , 
m_šCache
(
çl£
)

73 , 
m_lßdšg
(
çl£
)

74 , 
m_docLßd”
(0)

75 , 
m_hªdËCouÁ
(0)

76 , 
m_»sourûToRev®id©e
(0)

77 , 
m_´oxyResourû
(0)

79 #ifdeà
SSLAB__DEBUG


80 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

83 #iâdeà
NDEBUG


84 
	gÿchedResourûL—kCouÁ”
.
šüem’t
();

87 
	gm_ty³
 = 
ty³
;

88 
	gm_¡©us
 = 
P’dšg
;

89 
	gm_’codedSize
 = 0;

90 
	gm_decodedSize
 = 0;

91 
	gm_»que¡
 = 0;

93 
	gm_acûssCouÁ
 = 0;

94 
	gm_šLiveDecodedResourûsLi¡
 = 
çl£
;

96 
	gm_ÃxtInAÎResourûsLi¡
 = 0;

97 
	gm_´evInAÎResourûsLi¡
 = 0;

99 
	gm_ÃxtInLiveResourûsLi¡
 = 0;

100 
	gm_´evInLiveResourûsLi¡
 = 0;

102 #iâdeà
NDEBUG


103 
	gm_d–‘ed
 = 
çl£
;

104 
	gm_ÌuIndex
 = 0;

106 
	gm_”rÜOccu¼ed
 = 
çl£
;

109 
	gCachedResourû
::~
CachedResourû
()

111 #ifdeà
SSLAB__DEBUG


112 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

115 
ASSERT
(!
m_»sourûToRev®id©e
);

116 
ASSERT
(
ÿnD–‘e
());

117 
ASSERT
(!
šCache
());

118 
ASSERT
(!
m_d–‘ed
);

119 
ASSERT
(
u¾
().
isNuÎ
(è|| 
ÿche
()->
»sourûFÜURL
(u¾()è!ğ
this
);

120 #iâdeà
NDEBUG


121 
	gm_d–‘ed
 = 
Œue
;

122 
	gÿchedResourûL—kCouÁ”
.
deüem’t
();

125 ià(
	gm_docLßd”
)

126 
	gm_docLßd”
->
»moveCachedResourû
(
this
);

129 
	gCachedResourû
::
lßd
(
DocLßd”
* 
docLßd”
, 
boŞ
 
šüem’l
, 
Secur™yCheckPŞicy
 
£cur™yCheck
, boŞ 
£ndResourûLßdC®lbacks
)

131 #ifdeà
SSLAB__DEBUG


132 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

135 
	gm_£ndResourûLßdC®lbacks
 = 
£ndResourûLßdC®lbacks
;

136 
ÿche
()->
lßd”
()->
lßd
(
docLßd”
, 
this
, 
šüem’l
, 
£cur™yCheck
, 
£ndResourûLßdC®lbacks
);

137 
	gm_lßdšg
 = 
Œue
;

140 
	gCachedResourû
::
fšish
()

142 #ifdeà
SSLAB__DEBUG


143 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

146 
	gm_¡©us
 = 
Cached
;

149 
boŞ
 
	gCachedResourû
::
isExpœed
() const

151 #ifdeà
SSLAB__DEBUG


152 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

155 ià(
	gm_»¥Ú£
.
isNuÎ
()) {

157  
	gçl£
;

161  
cu¼’tAge
(è> 
äeshÃssLiãtime
();

164 
	gCachedResourû
::
cu¼’tAge
() const

166 #ifdeà
SSLAB__DEBUG


167 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

172 
	gd©eV®ue
 = 
m_»¥Ú£
.
d©e
();

173 
	g­·»ÁAge
 = 
isfš™e
(
d©eV®ue
è? 
max
(0., 
m_»¥Ú£Time¡amp
 - dateValue) : 0;

174 
	gageV®ue
 = 
m_»¥Ú£
.
age
();

175 
	gcÜ»ùedReûivedAge
 = 
isfš™e
(
ageV®ue
è? 
max
(
­·»ÁAge
,‡geValue) :‡pparentAge;

176 
	g»sid’tTime
 = 
cu¼’tTime
(è- 
m_»¥Ú£Time¡amp
;

177  
	gcÜ»ùedReûivedAge
 + 
	g»sid’tTime
;

180 
	gCachedResourû
::
äeshÃssLiãtime
() const

182 #ifdeà
SSLAB__DEBUG


183 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

187 ià(!
	gm_»¥Ú£
.
u¾
().
´ÙocŞInHTTPFamy
())

188  
	g¡d
::
num”ic_lim™s
<>::
max
();

191 
	gmaxAgeV®ue
 = 
m_»¥Ú£
.
ÿcheCÚŒŞMaxAge
();

192 ià(
isfš™e
(
maxAgeV®ue
))

193  
	gmaxAgeV®ue
;

194 
	gexpœesV®ue
 = 
m_»¥Ú£
.
expœes
();

195 
	gd©eV®ue
 = 
m_»¥Ú£
.
d©e
();

196 
	gü—tiÚTime
 = 
isfš™e
(
d©eV®ue
è? d©eV®u: 
m_»¥Ú£Time¡amp
;

197 ià(
isfš™e
(
expœesV®ue
))

198  
	gexpœesV®ue
 - 
	gü—tiÚTime
;

199 
	gÏ¡Modif›dV®ue
 = 
m_»¥Ú£
.
Ï¡Modif›d
();

200 ià(
isfš™e
(
Ï¡Modif›dV®ue
))

201  (
	gü—tiÚTime
 - 
	gÏ¡Modif›dV®ue
) * 0.1;

206 
	gCachedResourû
::
£tRe¥Ú£
(cÚ¡ 
ResourûRe¥Ú£
& 
»¥Ú£
)

208 #ifdeà
SSLAB__DEBUG


209 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

212 
	gm_»¥Ú£
 = 
»¥Ú£
;

213 
	gm_»¥Ú£Time¡amp
 = 
cu¼’tTime
();

216 
	gCachedResourû
::
£tReque¡
(
Reque¡
* 
»que¡
)

218 #ifdeà
SSLAB__DEBUG


219 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

222 ià(
	g»que¡
 && !
	gm_»que¡
)

223 
	gm_¡©us
 = 
P’dšg
;

224 
	gm_»que¡
 = 
»que¡
;

225 ià(
ÿnD–‘e
(è&& !
šCache
())

226 
d–‘e
 
	gthis
;

229 
	gCachedResourû
::
addCl›Á
(
CachedResourûCl›Á
* 
ş›Á
)

231 #ifdeà
SSLAB__DEBUG


232 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

235 
addCl›ÁToS‘
(
ş›Á
);

236 
didAddCl›Á
(
ş›Á
);

239 
	gCachedResourû
::
addCl›ÁToS‘
(
CachedResourûCl›Á
* 
ş›Á
)

241 #ifdeà
SSLAB__DEBUG


242 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

245 
ASSERT
(!
isPurg—bË
());

247 ià(
	gm_´–ßdResuÉ
 =ğ
P»lßdNÙReã»nûd
) {

248 ià(
isLßded
())

249 
m_´–ßdResuÉ
 = 
P»lßdReã»nûdWheCom¶‘e
;

250 ià(
	gm_»que¡edFromN‘wÜkšgLay”
)

251 
	gm_´–ßdResuÉ
 = 
P»lßdReã»nûdWheLßdšg
;

253 
	gm_´–ßdResuÉ
 = 
P»lßdReã»nûd
;

255 ià(!
hasCl›Ás
(è&& 
šCache
())

256 
ÿche
()->
addToLiveResourûsSize
(
this
);

257 
	gm_ş›Ás
.
add
(
ş›Á
);

260 
	gCachedResourû
::
»moveCl›Á
(
CachedResourûCl›Á
* 
ş›Á
)

262 #ifdeà
SSLAB__DEBUG


263 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

266 
ASSERT
(
m_ş›Ás
.
cÚšs
(
ş›Á
));

267 
	gm_ş›Ás
.
»move
(
ş›Á
);

269 ià(
ÿnD–‘e
(è&& !
šCache
())

270 
d–‘e
 
	gthis
;

271 ià(!
hasCl›Ás
(è&& 
šCache
()) {

272 
ÿche
()->
»moveFromLiveResourûsSize
(
this
);

273 
ÿche
()->
»moveFromLiveDecodedResourûsLi¡
(
this
);

274 
®lCl›ÁsRemoved
();

275 ià(
»¥Ú£
().
ÿcheCÚŒŞCÚšsNoStÜe
()) {

278 
ÿche
()->
»move
(
this
);

280 
ÿche
()->
´uÃ
();

285 
	gCachedResourû
::
d–‘eIfPossibË
()

287 #ifdeà
SSLAB__DEBUG


288 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

291 ià(
ÿnD–‘e
(è&& !
šCache
())

292 
d–‘e
 
	gthis
;

295 
	gCachedResourû
::
£tDecodedSize
(
size
)

297 #ifdeà
SSLAB__DEBUG


298 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

301 ià(
	gsize
 =ğ
m_decodedSize
)

304 
	gd–
 = 
size
 - 
m_decodedSize
;

309 ià(
šCache
())

310 
ÿche
()->
»moveFromLRULi¡
(
this
);

312 
	gm_decodedSize
 = 
size
;

314 ià(
šCache
()) {

316 
ÿche
()->
š£¹InLRULi¡
(
this
);

325 ià(
	gm_decodedSize
 && !
	gm_šLiveDecodedResourûsLi¡
 && 
hasCl›Ás
())

326 
ÿche
()->
š£¹InLiveDecodedResourûsLi¡
(
this
);

327 ià(!
	gm_decodedSize
 && 
	gm_šLiveDecodedResourûsLi¡
)

328 
ÿche
()->
»moveFromLiveDecodedResourûsLi¡
(
this
);

331 
ÿche
()->
adju¡Size
(
hasCl›Ás
(), 
d–
);

335 
	gCachedResourû
::
£tEncodedSize
(
size
)

337 #ifdeà
SSLAB__DEBUG


338 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

341 ià(
	gsize
 =ğ
m_’codedSize
)

345 
ASSERT
(
size
 =ğ0 || siz>ğ
m_’codedSize
);

347 
	gd–
 = 
size
 - 
m_’codedSize
;

352 ià(
šCache
())

353 
ÿche
()->
»moveFromLRULi¡
(
this
);

355 
	gm_’codedSize
 = 
size
;

357 ià(
šCache
()) {

359 
ÿche
()->
š£¹InLRULi¡
(
this
);

362 
ÿche
()->
adju¡Size
(
hasCl›Ás
(), 
d–
);

366 
	gCachedResourû
::
didAcûssDecodedD©a
(
timeSmp
)

368 #ifdeà
SSLAB__DEBUG


369 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

372 
	gm_Ï¡DecodedAcûssTime
 = 
timeSmp
;

374 ià(
šCache
()) {

375 ià(
	gm_šLiveDecodedResourûsLi¡
) {

376 
ÿche
()->
»moveFromLiveDecodedResourûsLi¡
(
this
);

377 
ÿche
()->
š£¹InLiveDecodedResourûsLi¡
(
this
);

379 
ÿche
()->
´uÃ
();

383 
	gCachedResourû
::
£tResourûToRev®id©e
(
CachedResourû
* 
»sourû
)

385 #ifdeà
SSLAB__DEBUG


386 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

389 
ASSERT
(
»sourû
);

390 
ASSERT
(!
m_»sourûToRev®id©e
);

391 
ASSERT
(
»sourû
 !ğ
this
);

392 
ASSERT
(
m_hªdËsToRev®id©e
.
isEm±y
());

393 
ASSERT
(
»sourû
->
ty³
() ==ype());

398 
ASSERT
(!
»sourû
->
m_´oxyResourû
);

400 
	g»sourû
->
	gm_´oxyResourû
 = 
this
;

401 
	gm_»sourûToRev®id©e
 = 
»sourû
;

404 
	gCachedResourû
::
ş—rResourûToRev®id©e
()

406 #ifdeà
SSLAB__DEBUG


407 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

410 
ASSERT
(
m_»sourûToRev®id©e
);

412 ià(
	gm_»sourûToRev®id©e
->
	gm_´oxyResourû
 =ğ
this
) {

413 
m_»sourûToRev®id©e
->
m_´oxyResourû
 = 0;

414 
	gm_»sourûToRev®id©e
->
d–‘eIfPossibË
();

416 
	gm_hªdËsToRev®id©e
.
ş—r
();

417 
	gm_»sourûToRev®id©e
 = 0;

418 
d–‘eIfPossibË
();

421 
	gCachedResourû
::
sw™chCl›ÁsToRev®id©edResourû
()

423 #ifdeà
SSLAB__DEBUG


424 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

427 
ASSERT
(
m_»sourûToRev®id©e
);

428 
ASSERT
(
m_»sourûToRev®id©e
->
šCache
());

429 
ASSERT
(!
šCache
());

431 
	gHashS‘
<
	gCachedResourûHªdËBa£
*>::
™”©Ü
 
’d
 = 
m_hªdËsToRev®id©e
.end();

432 
	gHashS‘
<
	gCachedResourûHªdËBa£
*>::
™”©Ü
 
™
 = 
m_hªdËsToRev®id©e
.
begš
(); 
	g™
 !ğ
’d
; ++it) {

433 
CachedResourûHªdËBa£
* 
	ghªdË
 = *
™
;

434 
	ghªdË
->
	gm_»sourû
 = 
m_»sourûToRev®id©e
;

435 
	gm_»sourûToRev®id©e
->
»gi¡”HªdË
(
hªdË
);

436 --
	gm_hªdËCouÁ
;

438 
ASSERT
(!
m_hªdËCouÁ
);

439 
	gm_hªdËsToRev®id©e
.
ş—r
();

441 
	gVeùÜ
<
	gCachedResourûCl›Á
*> 
	gş›ÁsToMove
;

442 
	gHashCouÁedS‘
<
	gCachedResourûCl›Á
*>::
™”©Ü
 
’d2
 = 
m_ş›Ás
.
’d
();

443 
	gHashCouÁedS‘
<
	gCachedResourûCl›Á
*>::
™”©Ü
 
™
 = 
m_ş›Ás
.
begš
(); 
	g™
 !ğ
’d2
; ++it) {

444 
CachedResourûCl›Á
* 
	gş›Á
 = 
™
->
fœ¡
;

445 
	gcouÁ
 = 
™
->
£cÚd
;

446 
	gcouÁ
) {

447 
	gş›ÁsToMove
.
­³nd
(
ş›Á
);

448 --
	gcouÁ
;

452 
	gm_ş›Ás
.
ş—r
();

454 
	gmoveCouÁ
 = 
ş›ÁsToMove
.
size
();

455 
	gn
 = 0;‚ < 
	gmoveCouÁ
; ++n)

456 
	gm_»sourûToRev®id©e
->
addCl›ÁToS‘
(
ş›ÁsToMove
[
n
]);

457 
	gn
 = 0;‚ < 
	gmoveCouÁ
; ++n) {

459 ià(
	gm_»sourûToRev®id©e
->
	gm_ş›Ás
.
cÚšs
(
ş›ÁsToMove
[
n
]))

460 
	gm_»sourûToRev®id©e
->
didAddCl›Á
(
ş›ÁsToMove
[
n
]);

464 
	gCachedResourû
::
upd©eRe¥Ú£Aá”Rev®id©iÚ
(cÚ¡ 
ResourûRe¥Ú£
& 
v®id©šgRe¥Ú£
)

466 #ifdeà
SSLAB__DEBUG


467 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

470 
	gm_»¥Ú£Time¡amp
 = 
cu¼’tTime
();

472 
DEFINE_STATIC_LOCAL
(cÚ¡ 
AtomicSŒšg
, 
cÚ‹ÁH—d”P»fix
, ("content-"));

475 cÚ¡ 
	gHTTPH—d”M­
& 
	gÃwH—d”s
 = 
v®id©šgRe¥Ú£
.
h‰pH—d”F›lds
();

476 
	gHTTPH—d”M­
::
cÚ¡_™”©Ü
 
’d
 = 
ÃwH—d”s
.end();

477 
	gHTTPH—d”M­
::
cÚ¡_™”©Ü
 
™
 = 
ÃwH—d”s
.
begš
(); 
	g™
 !ğ
’d
; ++it) {

479 ià(
	g™
->
	gfœ¡
.
¡¬tsW™h
(
cÚ‹ÁH—d”P»fix
, 
çl£
))

481 
	gm_»¥Ú£
.
£tHTTPH—d”F›ld
(
™
->
fœ¡
, it->
£cÚd
);

485 
boŞ
 
	gCachedResourû
::
ÿnU£CacheV®id©Ü
() const

487 #ifdeà
SSLAB__DEBUG


488 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

491 ià(
	gm_lßdšg
 || 
	gm_”rÜOccu¼ed
)

492  
	gçl£
;

494 ià(
	gm_»¥Ú£
.
ÿcheCÚŒŞCÚšsNoStÜe
())

495  
	gçl£
;

497 
DEFINE_STATIC_LOCAL
(cÚ¡ 
AtomicSŒšg
, 
Ï¡Modif›dH—d”
, ("last-modified"));

498 
DEFINE_STATIC_LOCAL
(cÚ¡ 
AtomicSŒšg
, 
eTagH—d”
, ("etag"));

499  !
	gm_»¥Ú£
.
h‰pH—d”F›ld
(
Ï¡Modif›dH—d”
).
isEm±y
(è|| !m_»¥Ú£.h‰pH—d”F›ld(
eTagH—d”
).isEmpty();

502 
boŞ
 
	gCachedResourû
::
mu¡Rev®id©e
(
CachePŞicy
 
ÿchePŞicy
) const

504 #ifdeà
SSLAB__DEBUG


505 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

508 ià(
	gm_”rÜOccu¼ed
) {

510  
	gŒue
;

513 ià(
	gm_lßdšg
) {

515  
	gçl£
;

518 ià(
	gm_»¥Ú£
.
ÿcheCÚŒŞCÚšsNoCache
(è|| m_»¥Ú£.
ÿcheCÚŒŞCÚšsNoStÜe
()) {

520  
	gŒue
;

523 ià(
	gÿchePŞicy
 =ğ
CachePŞicyCache
) {

525  
m_»¥Ú£
.
ÿcheCÚŒŞCÚšsMu¡Rev®id©e
(è&& 
isExpœed
();

529  
isExpœed
();

532 
boŞ
 
	gCachedResourû
::
isSaãToMakePurg—bË
() const

534 #ifdeà
SSLAB__DEBUG


535 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

538  !
hasCl›Ás
(è&& !
	gm_´oxyResourû
 && !
	gm_»sourûToRev®id©e
;

541 
boŞ
 
	gCachedResourû
::
makePurg—bË
(boŞ 
purg—bË
)

543 #ifdeà
SSLAB__DEBUG


544 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

547 ià(
	gpurg—bË
) {

548 
ASSERT
(
isSaãToMakePurg—bË
());

550 ià(
	gm_purg—bËD©a
) {

551 
ASSERT
(!
m_d©a
);

552  
	gŒue
;

554 ià(!
	gm_d©a
)

555  
	gçl£
;

558 ià(!
	gm_d©a
->
hasOÃRef
())

559  
	gçl£
;

562 cÚ¡ 
size_t
 
	gpurg—bËTh»shŞd
 = 4 * 4096;

563 ià(
	gm_d©a
->
size
(è< 
	gpurg—bËTh»shŞd
)

564  
	gçl£
;

566 ià(
	gm_d©a
->
hasPurg—bËBufãr
()) {

567 
	gm_purg—bËD©a
.
£t
(
m_d©a
->
»Ëa£Purg—bËBufãr
());

569 
	gm_purg—bËD©a
.
£t
(
Purg—bËBufãr
::
ü—‹
(
m_d©a
->
d©a
(), m_d©a->
size
()));

570 ià(!
	gm_purg—bËD©a
)

571  
	gçl£
;

574 
	gm_purg—bËD©a
->
makePurg—bË
(
Œue
);

575 
	gm_d©a
.
ş—r
();

576  
	gŒue
;

579 ià(!
	gm_purg—bËD©a
)

580  
	gŒue
;

581 
ASSERT
(!
m_d©a
);

582 
ASSERT
(!
hasCl›Ás
());

584 ià(!
	gm_purg—bËD©a
->
makePurg—bË
(
çl£
))

585  
	gçl£
;

587 
	gm_d©a
 = 
Sh¬edBufãr
::
adİtPurg—bËBufãr
(
m_purg—bËD©a
.
»Ëa£
());

588  
	gŒue
;

591 
boŞ
 
	gCachedResourû
::
isPurg—bË
() const

593 #ifdeà
SSLAB__DEBUG


594 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

597  
	gm_purg—bËD©a
 && m_purg—bËD©a->
isPurg—bË
();

600 
boŞ
 
	gCachedResourû
::
wasPurged
() const

602 #ifdeà
SSLAB__DEBUG


603 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

606  
	gm_purg—bËD©a
 && m_purg—bËD©a->
wasPurged
();

609 
	gCachedResourû
::
ov”h—dSize
() const

611 #ifdeà
SSLAB__DEBUG


612 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

615  (
	gCachedResourû
è+ 
	gm_»¥Ú£
.
memÜyU§ge
() + 576;

	@CachedResource.h

23 #iâdeà
CachedResourû_h


24 
	#CachedResourû_h


	)

26 
	~"CachePŞicy.h
"

27 
	~"F¿meLßd”Ty³s.h
"

28 
	~"PÏtfÜmSŒšg.h
"

29 
	~"ResourûRe¥Ú£.h
"

30 
	~<wtf/HashCouÁedS‘.h
>

31 
	~<wtf/HashS‘.h
>

32 
	~<wtf/OwnPŒ.h
>

33 
	~<wtf/VeùÜ.h
>

34 
	~<time.h
>

36 
Çme¥aû
 
	gWebCÜe
 {

38 
şass
 
	gCache
;

39 
şass
 
	gCachedResourûCl›Á
;

40 
şass
 
	gCachedResourûHªdËBa£
;

41 
şass
 
	gDocLßd”
;

42 
şass
 
	gIn¥eùÜResourû
;

43 
şass
 
	gReque¡
;

44 
şass
 
	gPurg—bËBufãr
;

49 şas 
	cCachedResourû
 : 
public
 
NÚcİyabË
 {

50 
ä›nd
 
şass
 
Cache
;

51 
ä›nd
 
şass
 
	gIn¥eùÜResourû
;

53 
	gpublic
:

54 
	eTy³
 {

55 
ImageResourû
,

56 
	gCSSStyËSh“t
,

57 
	gSüt
,

58 
	gFÚtResourû


59 #ià
ENABLE
(
XSLT
)

60 , 
	gXSLStyËSh“t


62 #ià
ENABLE
(
XBL
)

63 , 
	gXBL


67 
	eStus
 {

68 
	gNÙCached
,

69 
	gUnknown
,

70 
	gNew
,

71 
	gP’dšg
,

72 
	gCached


75 
CachedResourû
(cÚ¡ 
SŒšg
& 
u¾
, 
Ty³
);

76 
	gvœtu®
 ~
CachedResourû
();

78 
vœtu®
 
lßd
(
DocLßd”
* 
docLßd”
è{†ßd(docLßd”, 
çl£
, 
DoSecur™yCheck
, 
Œue
); }

79 
lßd
(
DocLßd”
*, 
boŞ
 
šüem’l
, 
Secur™yCheckPŞicy
, boŞ 
£ndResourûLßdC®lbacks
);

81 
vœtu®
 
£tEncodšg
(cÚ¡ 
SŒšg
&) { }

82 
vœtu®
 
SŒšg
 
’codšg
() const {  String(); }

83 
vœtu®
 
d©a
(
PassRefPŒ
<
Sh¬edBufãr
> d©a, 
boŞ
 
®lD©aReûived
) = 0;

84 
vœtu®
 
”rÜ
() = 0;

85 
vœtu®
 
h‰pStusCodeE¼Ü
(è{ 
”rÜ
(); }

87 cÚ¡ 
	gSŒšg
 &
u¾
(ècÚ¡ {  
	gm_u¾
; }

88 
Ty³
 
ty³
(ècÚ¡ {  
	gm_ty³
; }

90 
addCl›Á
(
CachedResourûCl›Á
*);

91 
»moveCl›Á
(
CachedResourûCl›Á
*);

92 
boŞ
 
hasCl›Ás
(ècÚ¡ {  !
	gm_ş›Ás
.
isEm±y
(); }

93 
d–‘eIfPossibË
();

95 
	eP»lßdResuÉ
 {

96 
	gP»lßdNÙReã»nûd
,

97 
	gP»lßdReã»nûd
,

98 
	gP»lßdReã»nûdWheLßdšg
,

99 
	gP»lßdReã»nûdWheCom¶‘e


101 
P»lßdResuÉ
 
´–ßdResuÉ
(ècÚ¡ {  
	gm_´–ßdResuÉ
; }

102 
£tReque¡edFromN‘wÜkšgLay”
(è{ 
	gm_»que¡edFromN‘wÜkšgLay”
 = 
Œue
; }

104 
vœtu®
 
didAddCl›Á
(
CachedResourûCl›Á
*) = 0;

105 
vœtu®
 
®lCl›ÁsRemoved
() { }

107 
couÁ
(ècÚ¡ {  
	gm_ş›Ás
.
size
(); }

109 
Stus
 
¡©us
(ècÚ¡ {  
	gm_¡©us
; }

111 
size
(ècÚ¡ {  
’codedSize
(è+ 
decodedSize
(è+ 
ov”h—dSize
(); }

112 
’codedSize
(ècÚ¡ {  
	gm_’codedSize
; }

113 
decodedSize
(ècÚ¡ {  
	gm_decodedSize
; }

114 
ov”h—dSize
() const;

116 
boŞ
 
isLßded
(ècÚ¡ {  !
	gm_lßdšg
; }

117 
£tLßdšg
(
boŞ
 
b
è{ 
	gm_lßdšg
 = b; }

119 
vœtu®
 
boŞ
 
isImage
(ècÚ¡ {  
	gçl£
; }

121 
acûssCouÁ
(ècÚ¡ {  
	gm_acûssCouÁ
; }

122 
šü—£AcûssCouÁ
(è{ 
	gm_acûssCouÁ
++; }

126 
fšish
();

132 
£tInCache
(
boŞ
 
šCache
è{ 
	gm_šCache
 = inCache; }

133 
boŞ
 
šCache
(ècÚ¡ {  
	gm_šCache
; }

135 
£tInLiveDecodedResourûsLi¡
(
boŞ
 
b
è{ 
	gm_šLiveDecodedResourûsLi¡
 = b; }

136 
boŞ
 
šLiveDecodedResourûsLi¡
(è{  
	gm_šLiveDecodedResourûsLi¡
; }

138 
£tReque¡
(
Reque¡
*);

140 
Sh¬edBufãr
* 
d©a
(ècÚ¡ { 
ASSERT
(!
m_purg—bËD©a
);  
	gm_d©a
.
g‘
(); }

142 
£tRe¥Ú£
(cÚ¡ 
ResourûRe¥Ú£
&);

143 cÚ¡ 
	gResourûRe¥Ú£
& 
»¥Ú£
(ècÚ¡ {  
	gm_»¥Ú£
; }

145 
boŞ
 
ÿnD–‘e
(ècÚ¡ {  !
hasCl›Ás
(è&& !
	gm_»que¡
 && !
	gm_´–ßdCouÁ
 && !
	gm_hªdËCouÁ
 && !
	gm_»sourûToRev®id©e
 && !
	gm_´oxyResourû
; }

147 
boŞ
 
isExpœed
() const;

149 
vœtu®
 
boŞ
 
scheduË
(ècÚ¡ {  
	gçl£
; }

153 
SŒšg
 
acû±
(ècÚ¡ {  
	gm_acû±
; }

154 
£tAcû±
(cÚ¡ 
SŒšg
& 
acû±
è{ 
	gm_acû±
 =‡ccept; }

156 
boŞ
 
”rÜOccu¼ed
(ècÚ¡ {  
	gm_”rÜOccu¼ed
; }

157 
boŞ
 
£ndResourûLßdC®lbacks
(ècÚ¡ {  
	gm_£ndResourûLßdC®lbacks
; }

159 
vœtu®
 
de¡royDecodedD©a
() { }

161 
£tDocLßd”
(
DocLßd”
* 
docLßd”
è{ 
	gm_docLßd”
 = docLoader; }

163 
boŞ
 
isP»lßded
(ècÚ¡ {  
	gm_´–ßdCouÁ
; }

164 
šü—£P»lßdCouÁ
(è{ ++
	gm_´–ßdCouÁ
; }

165 
deü—£P»lßdCouÁ
(è{ 
ASSERT
(
m_´–ßdCouÁ
); --
	gm_´–ßdCouÁ
; }

167 
»gi¡”HªdË
(
CachedResourûHªdËBa£
* 
h
è{ ++
	gm_hªdËCouÁ
; ià(
	gm_»sourûToRev®id©e
è
	gm_hªdËsToRev®id©e
.
add
(h); }

168 
uÄegi¡”HªdË
(
CachedResourûHªdËBa£
* 
h
è{ 
ASSERT
(
m_hªdËCouÁ
 > 0); --
	gm_hªdËCouÁ
; ià(
	gm_»sourûToRev®id©e
è
	gm_hªdËsToRev®id©e
.
»move
(h); ià(!m_hªdËCouÁè
d–‘eIfPossibË
(); }

170 
boŞ
 
ÿnU£CacheV®id©Ü
() const;

171 
boŞ
 
mu¡Rev®id©e
(
CachePŞicy
) const;

172 
boŞ
 
isCacheV®id©Ü
(ècÚ¡ {  
	gm_»sourûToRev®id©e
; }

173 
CachedResourû
* 
»sourûToRev®id©e
(ècÚ¡ {  
	gm_»sourûToRev®id©e
; }

175 
boŞ
 
isPurg—bË
() const;

176 
boŞ
 
wasPurged
() const;

181 
boŞ
 
makePurg—bË
(boŞ 
purg—bË
);

183 
toNuÎReque¡
(è{ 
	gm_»que¡
 = 0; }

184 
boŞ
 
g‘Reque¡
(è{  
	gm_»que¡
; }

186 
	g´Ùeùed
:

187 
£tEncodedSize
();

188 
£tDecodedSize
();

189 
didAcûssDecodedD©a
(
timeSmp
);

191 
boŞ
 
isSaãToMakePurg—bË
() const;

193 
	gHashCouÁedS‘
<
	gCachedResourûCl›Á
*> 
	gm_ş›Ás
;

195 
SŒšg
 
	gm_u¾
;

196 
SŒšg
 
	gm_acû±
;

197 
Reque¡
* 
	gm_»que¡
;

199 
ResourûRe¥Ú£
 
	gm_»¥Ú£
;

200 
	gm_»¥Ú£Time¡amp
;

202 
	gRefPŒ
<
	gSh¬edBufãr
> 
	gm_d©a
;

203 
	gOwnPŒ
<
	gPurg—bËBufãr
> 
	gm_purg—bËD©a
;

205 
Ty³
 
	gm_ty³
;

206 
Stus
 
	gm_¡©us
;

208 
boŞ
 
	gm_”rÜOccu¼ed
;

210 
	g´iv©e
:

211 
addCl›ÁToS‘
(
CachedResourûCl›Á
*);

214 
£tResourûToRev®id©e
(
CachedResourû
*);

215 
sw™chCl›ÁsToRev®id©edResourû
();

216 
ş—rResourûToRev®id©e
();

217 
upd©eRe¥Ú£Aá”Rev®id©iÚ
(cÚ¡ 
ResourûRe¥Ú£
& 
v®id©šgRe¥Ú£
);

219 
cu¼’tAge
() const;

220 
äeshÃssLiãtime
() const;

222 
	gm_’codedSize
;

223 
	gm_decodedSize
;

224 
	gm_acûssCouÁ
;

225 
	gm_šLiveDecodedResourûsLi¡
;

226 
	gm_Ï¡DecodedAcûssTime
;

228 
boŞ
 
	gm_£ndResourûLßdC®lbacks
;

230 
	gm_´–ßdCouÁ
;

231 
P»lßdResuÉ
 
	gm_´–ßdResuÉ
;

232 
boŞ
 
	gm_»que¡edFromN‘wÜkšgLay”
;

234 
	g´Ùeùed
:

235 
boŞ
 
m_šCache
;

236 
boŞ
 
	gm_lßdšg
;

237 #iâdeà
NDEBUG


238 
boŞ
 
	gm_d–‘ed
;

239 
	gm_ÌuIndex
;

242 
	g´iv©e
:

243 
CachedResourû
* 
m_ÃxtInAÎResourûsLi¡
;

244 
CachedResourû
* 
	gm_´evInAÎResourûsLi¡
;

246 
CachedResourû
* 
	gm_ÃxtInLiveResourûsLi¡
;

247 
CachedResourû
* 
	gm_´evInLiveResourûsLi¡
;

249 
DocLßd”
* 
	gm_docLßd”
;

251 
	gm_hªdËCouÁ
;

256 
CachedResourû
* 
	gm_»sourûToRev®id©e
;

259 
CachedResourû
* 
	gm_´oxyResourû
;

262 
	gHashS‘
<
	gCachedResourûHªdËBa£
*> 
	gm_hªdËsToRev®id©e
;

	@CachedResourceClient.h

25 #iâdeà
CachedResourûCl›Á_h


26 
	#CachedResourûCl›Á_h


	)

28 
	~<wtf/Fa¡AÎocBa£.h
>

30 #ià
ENABLE
(
XBL
)

31 
Çme¥aû
 
	gXBL
 {

32 
şass
 
	gXBLDocum’t
;

36 
Çme¥aû
 
	gWebCÜe
 {

38 
şass
 
	gCachedCSSStyËSh“t
;

39 
şass
 
	gCachedFÚt
;

40 
şass
 
	gCachedResourû
;

41 
şass
 
	gCachedImage
;

42 
şass
 
	gSŒšg
;

43 
şass
 
	gImage
;

44 
şass
 
	gIÁReù
;

45 
şass
 
	gKURL
;

54 şas 
	cCachedResourûCl›Á
 : 
public
 
Fa¡AÎocBa£


56 
public
:

57 
vœtu®
 ~
CachedResourûCl›Á
() { }

61 
vœtu®
 
imageChªged
(
CachedImage
*, cÚ¡ 
IÁReù
* = 0) { };

67 
vœtu®
 
boŞ
 
wlR’d”Image
(
CachedImage
*è{  
	gçl£
; }

69 
vœtu®
 
£tCSSStyËSh“t
(cÚ¡ 
SŒšg
& , cÚ¡ 
KURL
& , cÚ¡ SŒšg& , cÚ¡ 
CachedCSSStyËSh“t
*) { }

70 
vœtu®
 
£tXSLStyËSh“t
(cÚ¡ 
SŒšg
& , cÚ¡ 
KURL
& , const String& ) { }

72 
vœtu®
 
fÚtLßded
(
CachedFÚt
*) {};

74 #ià
ENABLE
(
XBL
)

75 
vœtu®
 
£tXBLDocum’t
(cÚ¡ 
SŒšg
& , 
XBL
::
XBLDocum’t
*) { }

78 
vœtu®
 
nÙifyFšished
(
CachedResourû
*) { }

	@CachedResourceClientWalker.cpp

2 #ifdeà
SSLAB__DEBUG


3 #iâdeà
SSLAB__QDATETIME


4 
	#SSLAB__QDATETIME


	)

5 
	~<QD©eTime
>

9 #ifdeà
SSLAB__DEBUG


10 #iâdeà
SSLAB__QTHREAD


11 
	#SSLAB__QTHREAD


	)

12 
	~<QTh»ad
>

40 
	~"cÚfig.h
"

41 
	~"CachedResourûCl›ÁW®k”.h
"

43 
Çme¥aû
 
	gWebCÜe
 {

45 
	gCachedResourûCl›ÁW®k”
::
CachedResourûCl›ÁW®k”
(cÚ¡ 
HashCouÁedS‘
<
CachedResourûCl›Á
*>& 
£t
)

46 : 
m_ş›ÁS‘
(
£t
), 
m_ş›ÁVeùÜ
(£t.
size
()), 
m_šdex
(0)

48 #ifdeà
SSLAB__DEBUG


49 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

52 
	gHashCouÁedS‘
<
	tCachedResourûCl›Á
*>::
	tcÚ¡_™”©Ü
 
	tI‹¿tÜ
;

53 
I‹¿tÜ
 
	g’d
 = 
£t
.
’d
();

54 
size_t
 
	gş›ÁIndex
 = 0;

55 
I‹¿tÜ
 
	gcu¼’t
 = 
£t
.
begš
(); cu¼’ˆ!ğ
’d
; ++current)

56 
	gm_ş›ÁVeùÜ
[
ş›ÁIndex
++] = 
cu¼’t
->
fœ¡
;

59 
CachedResourûCl›Á
* 
	gCachedResourûCl›ÁW®k”
::
Ãxt
()

61 #ifdeà
SSLAB__DEBUG


62 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

65 
size_t
 
	gsize
 = 
m_ş›ÁVeùÜ
.
size
();

66 
	gm_šdex
 < 
	gsize
) {

67 
CachedResourûCl›Á
* 
	gÃxt
 = 
m_ş›ÁVeùÜ
[
m_šdex
++];

68 ià(
	gm_ş›ÁS‘
.
cÚšs
(
Ãxt
))

69  
	gÃxt
;

	@CachedResourceClientWalker.h

25 #iâdeà
CachedResourûCl›ÁW®k”_h


26 
	#CachedResourûCl›ÁW®k”_h


	)

28 
	~<wtf/HashCouÁedS‘.h
>

29 
	~<wtf/VeùÜ.h
>

31 
Çme¥aû
 
	gWebCÜe
 {

33 
şass
 
	gCachedResourûCl›Á
;

37 şas 
	cCachedResourûCl›ÁW®k”
 {

38 
	gpublic
:

39 
CachedResourûCl›ÁW®k”
(cÚ¡ 
HashCouÁedS‘
<
CachedResourûCl›Á
*>&);

40 
CachedResourûCl›Á
* 
Ãxt
();

41 
	g´iv©e
:

42 cÚ¡ 
HashCouÁedS‘
<
CachedResourûCl›Á
*>& 
m_ş›ÁS‘
;

43 
	gVeùÜ
<
	gCachedResourûCl›Á
*> 
	gm_ş›ÁVeùÜ
;

44 
size_t
 
	gm_šdex
;

	@CachedResourceHandle.cpp

2 #ifdeà
SSLAB__DEBUG


3 #iâdeà
SSLAB__QDATETIME


4 
	#SSLAB__QDATETIME


	)

5 
	~<QD©eTime
>

9 #ifdeà
SSLAB__DEBUG


10 #iâdeà
SSLAB__QTHREAD


11 
	#SSLAB__QTHREAD


	)

12 
	~<QTh»ad
>

40 
	~"cÚfig.h
"

41 
	~"CachedResourûHªdË.h
"

43 
Çme¥aû
 
	gWebCÜe
 {

45 
	gCachedResourûHªdËBa£
::
£tResourû
(
CachedResourû
* 
»sourû
)

47 #ifdeà
SSLAB__DEBUG


48 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

51 ià(
	g»sourû
 =ğ
m_»sourû
)

53 ià(
	gm_»sourû
)

54 
	gm_»sourû
->
uÄegi¡”HªdË
(
this
);

55 
	gm_»sourû
 = 
»sourû
;

56 ià(
	gm_»sourû
)

57 
	gm_»sourû
->
»gi¡”HªdË
(
this
);

	@CachedResourceHandle.h

26 #iâdeà
CachedResourûHªdË_h


27 
	#CachedResourûHªdË_h


	)

29 
	~"CachedResourû.h
"

31 
Çme¥aû
 
	gWebCÜe
 {

33 şas 
	cCachedResourûHªdËBa£
 {

34 
	gpublic
:

35 ~
CachedResourûHªdËBa£
(è{ ià(
m_»sourû
èm_»sourû->
uÄegi¡”HªdË
(
this
); }

36 
CachedResourû
* 
g‘
(ècÚ¡ {  
	gm_»sourû
; }

38 
boŞ
 
	gİ”©Ü
!(ècÚ¡ {  !
	gm_»sourû
; }

42 
	gCachedResourû
* (
	tCachedResourûHªdËBa£
::*
	tUn¥ecif›dBoŞTy³
);

43 
İ”©Ü
 
Un¥ecif›dBoŞTy³
(ècÚ¡ {  
	gm_»sourû
 ? &
	gCachedResourûHªdËBa£
::
m_»sourû
 : 0; }

45 
	g´Ùeùed
:

46 
CachedResourûHªdËBa£
(è: 
m_»sourû
(0) {}

47 
CachedResourûHªdËBa£
(
CachedResourû
* 
»s
è{ 
m_»sourû
 =„es; ià(
	gm_»sourû
èm_»sourû->
»gi¡”HªdË
(
this
); }

48 
CachedResourûHªdËBa£
(cÚ¡ CachedResourûHªdËBa£& 
o
è: 
m_»sourû
(o.m_»sourûè{ ià(m_»sourûèm_»sourû->
»gi¡”HªdË
(
this
); }

50 
£tResourû
(
CachedResourû
*);

52 
	g´iv©e
:

53 
CachedResourûHªdËBa£
& 
İ”©Ü
=(cÚ¡ CachedResourûHªdËBa£&è{  *
this
; }

55 
ä›nd
 
şass
 
	gCachedResourû
;

57 
CachedResourû
* 
	gm_»sourû
;

60 
	g‹m¶©e
 <
şass
 
	gR
> cÏs 
	cCachedResourûHªdË
 : 
public
 
CachedResourûHªdËBa£
 {

61 
public
:

62 
CachedResourûHªdË
() { }

63 
CachedResourûHªdË
(
R
* 
»s
);

64 
CachedResourûHªdË
(cÚ¡ CachedResourûHªdË<
R
>& 
o
è: 
CachedResourûHªdËBa£
(o) { }

66 
R
* 
g‘
(ècÚ¡ {  
»š‹½»t_ÿ¡
<R*>(
CachedResourûHªdËBa£
::get()); }

67 
R
* 
	gİ”©Ü
->(ècÚ¡ {  
g‘
(); }

69 
	gCachedResourûHªdË
& 
	gİ”©Ü
=(
R
* 
»s
è{ 
£tResourû
Ôes);  *
	gthis
; }

70 
	gCachedResourûHªdË
& 
	gİ”©Ü
=(cÚ¡ 
CachedResourûHªdË
& 
o
è{ 
£tResourû
(o.
g‘
());  *
	gthis
; }

71 
boŞ
 
	gİ”©Ü
==(cÚ¡ 
CachedResourûHªdËBa£
& 
o
ècÚ¡ {  
g‘
() == o.get(); }

72 
boŞ
 
	gİ”©Ü
!=(cÚ¡ 
CachedResourûHªdËBa£
& 
o
ècÚ¡ {  
g‘
() != o.get(); }

78 
	g‹m¶©e
 <
şass
 
	gR
>

79 #ià!
	$COMPILER
(
WINSCW
)

80 
šlše


82 
CachedResourûHªdË
<
R
>::
	$CachedResourûHªdË
(
R
* 
»s
è: 
	$CachedResourûHªdËBa£
(
»s
)

84 
	}
}

86 
‹m¶©e
 <
şass
 
R
, cÏs 
	gRR
> 
boŞ
 
	gİ”©Ü
==(cÚ¡ 
CachedResourûHªdË
<R>& 
h
, cÚ¡ 
RR
* 
	g»s
)

88  
	gh
.
g‘
(è=ğ
»s
;

90 
	g‹m¶©e
 <
şass
 
	gR
, cÏs 
	gRR
> 
boŞ
 
	gİ”©Ü
==(cÚ¡ 
RR
* 
»s
, cÚ¡ 
	gCachedResourûHªdË
<R>& 
	gh
)

92  
	gh
.
g‘
(è=ğ
»s
;

94 
	g‹m¶©e
 <
şass
 
	gR
, cÏs 
	gRR
> 
boŞ
 
	gİ”©Ü
!=(cÚ¡ 
CachedResourûHªdË
<
R
>& 
h
, cÚ¡ 
RR
* 
	g»s
)

96  
	gh
.
g‘
(è!ğ
»s
;

98 
	g‹m¶©e
 <
şass
 
	gR
, cÏs 
	gRR
> 
boŞ
 
	gİ”©Ü
!=(cÚ¡ 
RR
* 
»s
, cÚ¡ 
	gCachedResourûHªdË
<R>& 
	gh
)

100  
	gh
.
g‘
(è!ğ
»s
;

	@CachedScript.cpp

2 #ifdeà
SSLAB__DEBUG


3 #iâdeà
SSLAB__QDATETIME


4 
	#SSLAB__QDATETIME


	)

5 
	~<QD©eTime
>

9 #ifdeà
SSLAB__DEBUG


10 #iâdeà
SSLAB__QTHREAD


11 
	#SSLAB__QTHREAD


	)

12 
	~<QTh»ad
>

41 
	~"cÚfig.h
"

42 
	~"CachedSüt.h
"

44 
	~"CachedResourûCl›Á.h
"

45 
	~"CachedResourûCl›ÁW®k”.h
"

46 
	~"Sh¬edBufãr.h
"

47 
	~"TextResourûDecod”.h
"

48 
	~<wtf/VeùÜ.h
>

50 
Çme¥aû
 
	gWebCÜe
 {

52 
	gCachedSüt
::
CachedSüt
(cÚ¡ 
SŒšg
& 
u¾
, cÚ¡ SŒšg& 
ch¬£t
)

53 : 
CachedResourû
(
u¾
, 
Süt
)

54 , 
m_decod”
(
TextResourûDecod”
::
ü—‹
("­¶iÿtiÚ/javasüt", 
ch¬£t
))

55 , 
m_decodedD©aD–‘iÚTim”
(
this
, &
CachedSüt
::
decodedD©aD–‘iÚTim”Fœed
)

60 
£tAcû±
("*/*");

63 
	gCachedSüt
::~
CachedSüt
()

65 #ifdeà
SSLAB__DEBUG


66 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

71 
	gCachedSüt
::
didAddCl›Á
(
CachedResourûCl›Á
* 
c
)

73 #ifdeà
SSLAB__DEBUG


74 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

77 ià(!
	gm_lßdšg
)

78 
	gc
->
nÙifyFšished
(
this
);

81 
	gCachedSüt
::
®lCl›ÁsRemoved
()

83 #ifdeà
SSLAB__DEBUG


84 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

87 
	gm_decodedD©aD–‘iÚTim”
.
¡¬tOÃShÙ
(0);

90 
	gCachedSüt
::
£tEncodšg
(cÚ¡ 
SŒšg
& 
chs
)

92 #ifdeà
SSLAB__DEBUG


93 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

96 
	gm_decod”
->
£tEncodšg
(
chs
, 
TextResourûDecod”
::
EncodšgFromHTTPH—d”
);

99 
SŒšg
 
	gCachedSüt
::
’codšg
() const

101 #ifdeà
SSLAB__DEBUG


102 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

105  
	gm_decod”
->
’codšg
().
Çme
();

108 cÚ¡ 
	gSŒšg
& 
	gCachedSüt
::
süt
()

110 #ifdeà
SSLAB__DEBUG


111 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

114 
ASSERT
(!
isPurg—bË
());

116 ià(!
	gm_süt
 && 
	gm_d©a
) {

117 
	gm_süt
 = 
m_decod”
->
decode
(
m_d©a
->
d©a
(), 
’codedSize
());

118 
	gm_süt
 +ğ
m_decod”
->
æush
();

119 
£tDecodedSize
(
m_süt
.
Ëngth
(è* (
UCh¬
));

122 
	gm_decodedD©aD–‘iÚTim”
.
¡¬tOÃShÙ
(0);

123  
	gm_süt
;

126 
	gCachedSüt
::
d©a
(
PassRefPŒ
<
Sh¬edBufãr
> d©a, 
boŞ
 
®lD©aReûived
)

128 #ifdeà
SSLAB__DEBUG


129 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

132 ià(!
	g®lD©aReûived
)

135 
	gm_d©a
 = 
d©a
;

136 
£tEncodedSize
(
m_d©a
.
g‘
(è? m_d©a->
size
() : 0);

137 
	gm_lßdšg
 = 
çl£
;

138 
checkNÙify
();

141 
	gCachedSüt
::
checkNÙify
()

143 #ifdeà
SSLAB__DEBUG


144 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

147 ià(
	gm_lßdšg
)

150 
CachedResourûCl›ÁW®k”
 
w
(
m_ş›Ás
);

151 
CachedResourûCl›Á
* 
	gc
 = 
w
.
Ãxt
())

152 
c
->
nÙifyFšished
(
this
);

155 
	gCachedSüt
::
”rÜ
()

157 #ifdeà
SSLAB__DEBUG


158 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

161 
	gm_lßdšg
 = 
çl£
;

162 
	gm_”rÜOccu¼ed
 = 
Œue
;

163 
checkNÙify
();

166 
	gCachedSüt
::
de¡royDecodedD©a
()

168 #ifdeà
SSLAB__DEBUG


169 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

172 
	gm_süt
 = 
SŒšg
();

173 
£tDecodedSize
(0);

174 ià(
isSaãToMakePurg—bË
())

175 
makePurg—bË
(
Œue
);

178 
	gCachedSüt
::
decodedD©aD–‘iÚTim”Fœed
(
Tim”
<
CachedSüt
>*)

180 #ifdeà
SSLAB__DEBUG


181 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

184 
de¡royDecodedD©a
();

	@CachedScript.h

26 #iâdeà
CachedSüt_h


27 
	#CachedSüt_h


	)

29 
	~"CachedResourû.h
"

30 
	~"Tim”.h
"

32 
Çme¥aû
 
	gWebCÜe
 {

34 
şass
 
	gDocLßd”
;

35 
şass
 
	gTextResourûDecod”
;

37 şas 
	cCachedSüt
 : 
public
 
CachedResourû
 {

38 
public
:

39 
CachedSüt
(cÚ¡ 
SŒšg
& 
u¾
, cÚ¡ SŒšg& 
ch¬£t
);

40 
	gvœtu®
 ~
CachedSüt
();

42 cÚ¡ 
	gSŒšg
& 
süt
();

44 
vœtu®
 
didAddCl›Á
(
CachedResourûCl›Á
*);

45 
vœtu®
 
®lCl›ÁsRemoved
();

47 
vœtu®
 
£tEncodšg
(cÚ¡ 
SŒšg
&);

48 
vœtu®
 
SŒšg
 
’codšg
() const;

49 
vœtu®
 
d©a
(
PassRefPŒ
<
Sh¬edBufãr
> d©a, 
boŞ
 
®lD©aReûived
);

50 
vœtu®
 
”rÜ
();

52 
vœtu®
 
boŞ
 
scheduË
(ècÚ¡ {  
	gçl£
; }

54 
checkNÙify
();

56 
vœtu®
 
de¡royDecodedD©a
();

58 
	g´iv©e
:

59 
decodedD©aD–‘iÚTim”Fœed
(
Tim”
<
CachedSüt
>*);

61 
SŒšg
 
	gm_süt
;

62 
	gRefPŒ
<
	gTextResourûDecod”
> 
	gm_decod”
;

63 
	gTim”
<
	gCachedSüt
> 
	gm_decodedD©aD–‘iÚTim”
;

	@CachedXBLDocument.cpp

2 #ifdeà
SSLAB__DEBUG


3 #iâdeà
SSLAB__QDATETIME


4 
	#SSLAB__QDATETIME


	)

5 
	~<QD©eTime
>

9 #ifdeà
SSLAB__DEBUG


10 #iâdeà
SSLAB__QTHREAD


11 
	#SSLAB__QTHREAD


	)

12 
	~<QTh»ad
>

41 
	~"cÚfig.h
"

43 #ià
ENABLE
(
XBL
)

45 
	~"CachedXBLDocum’t.h
"

47 
	~"CachedResourûCl›ÁW®k”.h
"

48 
	~"TextResourûDecod”.h
"

49 
	~<wtf/VeùÜ.h
>

51 
Çme¥aû
 
	gWebCÜe
 {

53 
	gCachedXBLDocum’t
::
CachedXBLDocum’t
(cÚ¡ 
SŒšg
 &
u¾
)

54 : 
CachedResourû
(
u¾
, 
XBL
), 
m_docum’t
(0)

56 #ifdeà
SSLAB__DEBUG


57 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

61 
£tAcû±
("text/xml,‡pplication/xml,‡pplication/xhtml+xml,ext/xsl,‡pplication/rss+xml,‡pplication/atom+xml");

63 
	gm_decod”
 = 
Ãw
 
TextResourûDecod”
("application/xml");

66 
	gCachedXBLDocum’t
::~
CachedXBLDocum’t
()

68 #ifdeà
SSLAB__DEBUG


69 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

72 ià(
	gm_docum’t
)

73 
	gm_docum’t
->
d”ef
();

76 
	gCachedXBLDocum’t
::
»f
(
CachedResourûCl›Á
 *
c
)

78 #ifdeà
SSLAB__DEBUG


79 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

82 
	gCachedResourû
::
»f
(
c
);

83 ià(!
	gm_lßdšg
)

84 
	gc
->
£tXBLDocum’t
(
m_u¾
, 
m_docum’t
);

87 
	gCachedXBLDocum’t
::
£tEncodšg
(cÚ¡ 
SŒšg
& 
chs
)

89 #ifdeà
SSLAB__DEBUG


90 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

93 
	gm_decod”
->
£tEncodšg
(
chs
, 
TextResourûDecod”
::
EncodšgFromHTTPH—d”
);

96 
SŒšg
 
	gCachedXBLDocum’t
::
’codšg
() const

98 #ifdeà
SSLAB__DEBUG


99 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

102  
	gm_decod”
->
’codšg
().
Çme
();

105 
	gCachedXBLDocum’t
::
d©a
(
VeùÜ
<>& d©a, 
boŞ
 )

107 #ifdeà
SSLAB__DEBUG


108 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

111 ià(!
	g®lD©aReûived
)

114 
ASSERT
(!
m_docum’t
);

116 
	gm_docum’t
 = 
Ãw
 
XBL
::
XBLDocum’t
();

117 
	gm_docum’t
->
»f
();

118 
	gm_docum’t
->
İ’
();

120 
	gm_docum’t
->
wr™e
(
m_decod”
->
decode
(
d©a
.d©a(), d©a.
size
()));

121 
£tSize
(
d©a
.
size
());

123 
	gm_docum’t
->
fšishP¬sšg
();

124 
	gm_docum’t
->
şo£
();

125 
	gm_lßdšg
 = 
çl£
;

126 
checkNÙify
();

129 
	gCachedXBLDocum’t
::
checkNÙify
()

131 #ifdeà
SSLAB__DEBUG


132 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

135 ià(
	gm_lßdšg
)

138 
CachedResourûCl›ÁW®k”
 
w
(
m_ş›Ás
);

139 
CachedResourûCl›Á
 *
	gc
 = 
w
.
Ãxt
())

140 
c
->
£tXBLDocum’t
(
m_u¾
, 
m_docum’t
);

143 
	gCachedXBLDocum’t
::
”rÜ
()

145 #ifdeà
SSLAB__DEBUG


146 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

149 
	gm_lßdšg
 = 
çl£
;

150 
	gm_”rÜOccu¼ed
 = 
Œue
;

151 
checkNÙify
();

	@CachedXBLDocument.h

26 #iâdeà
CachedXBLDocum’t_h


27 
	#CachedXBLDocum’t_h


	)

29 
	~"CachedResourû.h
"

30 
	~<wtf/VeùÜ.h
>

32 
Çme¥aû
 
	gWebCÜe
 {

33 
şass
 
	gCachedResourû
;

34 
şass
 
	gReque¡
;

35 
şass
 
	gDocLßd”
;

36 
şass
 
	gTextResourûDecod”
;

37 
şass
 
	gCachedResourûCl›Á
;

39 #ià
ENABLE
(
XBL
)

40 şas 
	cCachedXBLDocum’t
 : 
public
 
CachedResourû
 {

41 
public
:

42 
CachedXBLDocum’t
(cÚ¡ 
SŒšg
& 
u¾
);

43 
	gvœtu®
 ~
CachedXBLDocum’t
();

45 
	gXBL
::
XBLDocum’t
* 
docum’t
(ècÚ¡ {  
m_docum’t
; }

47 
vœtu®
 
addCl›Á
(
CachedResourûCl›Á
*);

49 
vœtu®
 
£tEncodšg
(cÚ¡ 
SŒšg
&);

50 
vœtu®
 
SŒšg
 
’codšg
() const;

51 
vœtu®
 
d©a
(
VeùÜ
<>&, 
boŞ
 
®lD©aReûived
);

52 
vœtu®
 
”rÜ
();

54 
vœtu®
 
boŞ
 
scheduË
(ècÚ¡ {  
	gŒue
; }

56 
checkNÙify
();

58 
	g´Ùeùed
:

59 
XBL
::
XBLDocum’t
* 
m_docum’t
;

60 
	gRefPŒ
<
	gTextResourûDecod”
> 
	gm_decod”
;

	@CachedXSLStyleSheet.cpp

2 #ifdeà
SSLAB__DEBUG


3 #iâdeà
SSLAB__QDATETIME


4 
	#SSLAB__QDATETIME


	)

5 
	~<QD©eTime
>

9 #ifdeà
SSLAB__DEBUG


10 #iâdeà
SSLAB__QTHREAD


11 
	#SSLAB__QTHREAD


	)

12 
	~<QTh»ad
>

41 
	~"cÚfig.h
"

42 
	~"CachedXSLStyËSh“t.h
"

44 
	~"CachedResourûCl›Á.h
"

45 
	~"CachedResourûCl›ÁW®k”.h
"

46 
	~"Sh¬edBufãr.h
"

47 
	~"TextResourûDecod”.h
"

48 
	~<wtf/VeùÜ.h
>

50 
Çme¥aû
 
	gWebCÜe
 {

52 #ià
ENABLE
(
XSLT
)

54 
	gCachedXSLStyËSh“t
::
CachedXSLStyËSh“t
(cÚ¡ 
SŒšg
 &
u¾
)

55 : 
CachedResourû
(
u¾
, 
XSLStyËSh“t
)

56 , 
m_decod”
(
TextResourûDecod”
::
ü—‹
("text/xsl"))

60 
£tAcû±
("text/xml,‡pplication/xml,‡pplication/xhtml+xml,ext/xsl,‡pplication/rss+xml,‡pplication/atom+xml");

63 
	gCachedXSLStyËSh“t
::
didAddCl›Á
(
CachedResourûCl›Á
* 
c
)

65 #ifdeà
SSLAB__DEBUG


66 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

69 ià(!
	gm_lßdšg
)

70 
	gc
->
£tXSLStyËSh“t
(
m_u¾
, 
m_»¥Ú£
.
u¾
(), 
m_sh“t
);

73 
	gCachedXSLStyËSh“t
::
£tEncodšg
(cÚ¡ 
SŒšg
& 
chs
)

75 #ifdeà
SSLAB__DEBUG


76 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

79 
	gm_decod”
->
£tEncodšg
(
chs
, 
TextResourûDecod”
::
EncodšgFromHTTPH—d”
);

82 
SŒšg
 
	gCachedXSLStyËSh“t
::
’codšg
() const

84 #ifdeà
SSLAB__DEBUG


85 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

88  
	gm_decod”
->
’codšg
().
Çme
();

91 
	gCachedXSLStyËSh“t
::
d©a
(
PassRefPŒ
<
Sh¬edBufãr
> d©a, 
boŞ
 
®lD©aReûived
)

93 #ifdeà
SSLAB__DEBUG


94 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

97 ià(!
	g®lD©aReûived
)

100 
	gm_d©a
 = 
d©a
;

101 
£tEncodedSize
(
m_d©a
.
g‘
(è? m_d©a->
size
() : 0);

102 ià(
	gm_d©a
.
g‘
()) {

103 
	gm_sh“t
 = 
SŒšg
(
m_decod”
->
decode
(
m_d©a
->
d©a
(), 
’codedSize
()));

104 
	gm_sh“t
 +ğ
m_decod”
->
æush
();

106 
	gm_lßdšg
 = 
çl£
;

107 
checkNÙify
();

110 
	gCachedXSLStyËSh“t
::
checkNÙify
()

112 #ifdeà
SSLAB__DEBUG


113 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

116 ià(
	gm_lßdšg
)

119 
CachedResourûCl›ÁW®k”
 
w
(
m_ş›Ás
);

120 
CachedResourûCl›Á
 *
	gc
 = 
w
.
Ãxt
())

121 
c
->
£tXSLStyËSh“t
(
m_u¾
, 
m_»¥Ú£
.
u¾
(), 
m_sh“t
);

124 
	gCachedXSLStyËSh“t
::
”rÜ
()

126 #ifdeà
SSLAB__DEBUG


127 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

130 
	gm_lßdšg
 = 
çl£
;

131 
	gm_”rÜOccu¼ed
 = 
Œue
;

132 
checkNÙify
();

	@CachedXSLStyleSheet.h

26 #iâdeà
CachedXSLStyËSh“t_h


27 
	#CachedXSLStyËSh“t_h


	)

29 
	~"CachedResourû.h
"

30 
	~<wtf/VeùÜ.h
>

32 
Çme¥aû
 
	gWebCÜe
 {

34 
şass
 
	gDocLßd”
;

35 
şass
 
	gTextResourûDecod”
;

37 #ià
ENABLE
(
XSLT
)

38 şas 
	cCachedXSLStyËSh“t
 : 
public
 
CachedResourû
 {

39 
public
:

40 
CachedXSLStyËSh“t
(cÚ¡ 
SŒšg
& 
u¾
);

42 cÚ¡ 
	gSŒšg
& 
sh“t
(ècÚ¡ {  
	gm_sh“t
; }

44 
vœtu®
 
didAddCl›Á
(
CachedResourûCl›Á
*);

46 
vœtu®
 
£tEncodšg
(cÚ¡ 
SŒšg
&);

47 
vœtu®
 
SŒšg
 
’codšg
() const;

48 
vœtu®
 
d©a
(
PassRefPŒ
<
Sh¬edBufãr
> d©a, 
boŞ
 
®lD©aReûived
);

49 
vœtu®
 
”rÜ
();

51 
vœtu®
 
boŞ
 
scheduË
(ècÚ¡ {  
	gŒue
; }

53 
checkNÙify
();

55 
	g´Ùeùed
:

56 
SŒšg
 
m_sh“t
;

57 
	gRefPŒ
<
	gTextResourûDecod”
> 
	gm_decod”
;

	@CrossOriginAccessControl.cpp

2 #ifdeà
SSLAB__DEBUG


3 #iâdeà
SSLAB__QDATETIME


4 
	#SSLAB__QDATETIME


	)

5 
	~<QD©eTime
>

9 #ifdeà
SSLAB__DEBUG


10 #iâdeà
SSLAB__QTHREAD


11 
	#SSLAB__QTHREAD


	)

12 
	~<QTh»ad
>

41 
	~"cÚfig.h
"

42 
	~"CrossOrigšAcûssCÚŒŞ.h
"

44 
	~"AtomicSŒšg.h
"

45 
	~"HTTPP¬£rs.h
"

46 
	~"ResourûRe¥Ú£.h
"

47 
	~"Secur™yOrigš.h
"

48 
	~<wtf/Th»adšg.h
>

50 
Çme¥aû
 
	gWebCÜe
 {

52 
boŞ
 
isOnAcûssCÚŒŞSim¶eReque¡M‘hodWh™–i¡
(cÚ¡ 
SŒšg
& 
m‘hod
)

54 #ifdeà
SSLAB__DEBUG


55 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

58  
	gm‘hod
 =ğ"GET" || 
m‘hod
 == "HEAD" || method == "POST";

61 
boŞ
 
isOnAcûssCÚŒŞSim¶eReque¡H—d”Wh™–i¡
(cÚ¡ 
SŒšg
& 
Çme
, cÚ¡ SŒšg& 
v®ue
)

63 #ifdeà
SSLAB__DEBUG


64 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

67 ià(
equ®IgnÜšgCa£
(
Çme
, "accept") ||ƒqualIgnoringCase(name, "accept-language") ||ƒqualIgnoringCase(name, "content-language"))

68  
	gŒue
;

71 ià(
equ®IgnÜšgCa£
(
Çme
, "content-type")) {

72 
SŒšg
 
	gmimeTy³
 = 
exŒaùMIMETy³FromMedŸTy³
(
v®ue
);

73  
equ®IgnÜšgCa£
(
mimeTy³
, "application/x-www-form-urlencoded")

74 || 
equ®IgnÜšgCa£
(
mimeTy³
, "multipart/form-data")

75 || 
equ®IgnÜšgCa£
(
mimeTy³
, "text/plain");

78  
	gçl£
;

81 
boŞ
 
isSim¶eCrossOrigšAcûssReque¡
(cÚ¡ 
SŒšg
& 
m‘hod
, cÚ¡ 
HTTPH—d”M­
& 
h—d”M­
)

83 #ifdeà
SSLAB__DEBUG


84 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

87 ià(!
isOnAcûssCÚŒŞSim¶eReque¡M‘hodWh™–i¡
(
m‘hod
))

88  
	gçl£
;

90 
	gHTTPH—d”M­
::
cÚ¡_™”©Ü
 
’d
 = 
h—d”M­
.end();

91 
	gHTTPH—d”M­
::
cÚ¡_™”©Ü
 
™
 = 
h—d”M­
.
begš
(); 
	g™
 !ğ
’d
; ++it) {

92 ià(!
isOnAcûssCÚŒŞSim¶eReque¡H—d”Wh™–i¡
(
™
->
fœ¡
, it->
£cÚd
))

93  
	gçl£
;

96  
	gŒue
;

99 
	gHashS‘
<
	tSŒšg
, 
	tCa£FŞdšgHash
> 
	tHTTPH—d”S‘
;

100 
HTTPH—d”S‘
* 
ü—‹AÎowedCrossOrigšRe¥Ú£H—d”sS‘
()

102 #ifdeà
SSLAB__DEBUG


103 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

106 
HTTPH—d”S‘
* 
	gh—d”S‘
 = 
Ãw
 
HashS‘
<
SŒšg
, 
	gCa£FŞdšgHash
>;

108 
	gh—d”S‘
->
add
("cache-control");

109 
	gh—d”S‘
->
add
("content-language");

110 
	gh—d”S‘
->
add
("content-type");

111 
	gh—d”S‘
->
add
("expires");

112 
	gh—d”S‘
->
add
("last-modified");

113 
	gh—d”S‘
->
add
("pragma");

115  
	gh—d”S‘
;

118 
boŞ
 
isOnAcûssCÚŒŞRe¥Ú£H—d”Wh™–i¡
(cÚ¡ 
SŒšg
& 
Çme
)

120 #ifdeà
SSLAB__DEBUG


121 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

124 
AtomiÿÎyIn™ŸlizedStic
(
HTTPH—d”S‘
*, 
®lowedCrossOrigšRe¥Ú£H—d”s
 = 
ü—‹AÎowedCrossOrigšRe¥Ú£H—d”sS‘
());

126  
	g®lowedCrossOrigšRe¥Ú£H—d”s
->
cÚšs
(
Çme
);

129 
boŞ
 
·s£sAcûssCÚŒŞCheck
(cÚ¡ 
ResourûRe¥Ú£
& 
»¥Ú£
, boŞ 
šşudeC»d’tŸls
, 
Secur™yOrigš
* 
£cur™yOrigš
)

131 #ifdeà
SSLAB__DEBUG


132 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

137 cÚ¡ 
	gSŒšg
& 
	gacûssCÚŒŞOrigšSŒšg
 = 
»¥Ú£
.
h‰pH—d”F›ld
("Access-Control-Allow-Origin");

138 ià(
	gacûssCÚŒŞOrigšSŒšg
 =ğ"*" && !
šşudeC»d’tŸls
)

139  
Œue
;

141 ià(
	g£cur™yOrigš
->
isUnique
())

142  
	gçl£
;

144 
	gRefPŒ
<
	gSecur™yOrigš
> 
	gacûssCÚŒŞOrigš
 = 
Secur™yOrigš
::
ü—‹FromSŒšg
(
acûssCÚŒŞOrigšSŒšg
);

145 ià(!
	gacûssCÚŒŞOrigš
->
isSameSchemeHo¡PÜt
(
£cur™yOrigš
))

146  
	gçl£
;

148 ià(
	gšşudeC»d’tŸls
) {

149 cÚ¡ 
	gSŒšg
& 
	gacûssCÚŒŞC»d’tŸlsSŒšg
 = 
»¥Ú£
.
h‰pH—d”F›ld
("Access-Control-Allow-Credentials");

150 ià(
	gacûssCÚŒŞC»d’tŸlsSŒšg
 != "true")

151  
çl£
;

154  
	gŒue
;

	@CrossOriginAccessControl.h

27 
Çme¥aû
 
	gWebCÜe
 {

29 
şass
 
	gHTTPH—d”M­
;

30 
şass
 
	gResourûRe¥Ú£
;

31 
şass
 
	gSecur™yOrigš
;

32 
şass
 
	gSŒšg
;

34 
boŞ
 
isSim¶eCrossOrigšAcûssReque¡
(cÚ¡ 
SŒšg
& 
m‘hod
, cÚ¡ 
HTTPH—d”M­
&);

35 
boŞ
 
isOnAcûssCÚŒŞSim¶eReque¡M‘hodWh™–i¡
(cÚ¡ 
SŒšg
&);

36 
boŞ
 
isOnAcûssCÚŒŞSim¶eReque¡H—d”Wh™–i¡
(cÚ¡ 
SŒšg
& 
Çme
, cÚ¡ SŒšg& 
v®ue
);

37 
boŞ
 
isOnAcûssCÚŒŞRe¥Ú£H—d”Wh™–i¡
(cÚ¡ 
SŒšg
&);

39 
boŞ
 
·s£sAcûssCÚŒŞCheck
(cÚ¡ 
ResourûRe¥Ú£
&, boŞ 
šşudeC»d’tŸls
, 
Secur™yOrigš
*);

	@CrossOriginPreflightResultCache.cpp

2 #ifdeà
SSLAB__DEBUG


3 #iâdeà
SSLAB__QDATETIME


4 
	#SSLAB__QDATETIME


	)

5 
	~<QD©eTime
>

9 #ifdeà
SSLAB__DEBUG


10 #iâdeà
SSLAB__QTHREAD


11 
	#SSLAB__QTHREAD


	)

12 
	~<QTh»ad
>

41 
	~"cÚfig.h
"

42 
	~"CrossOrigšP»æightResuÉCache.h
"

44 
	~"CrossOrigšAcûssCÚŒŞ.h
"

45 
	~"ResourûRe¥Ú£.h
"

46 
	~<wtf/Cu¼’tTime.h
>

47 
	~<wtf/StdLibExŒas.h
>

48 
	~<wtf/Th»adšg.h
>

50 
Çme¥aû
 
	gWebCÜe
 {

53 cÚ¡ 
	gdeçuÉP»æightCacheTimeoutSecÚds
 = 5;

54 cÚ¡ 
	gmaxP»æightCacheTimeoutSecÚds
 = 600;

56 
boŞ
 
·r£AcûssCÚŒŞMaxAge
(cÚ¡ 
SŒšg
& 
¡ršg
, & 
expœyD–
)

58 #ifdeà
SSLAB__DEBUG


59 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

63 
boŞ
 
	gok
 = 
çl£
;

64 
	gexpœyD–
 = 
¡ršg
.
toUIÁSŒiù
(&
ok
);

65  
	gok
;

68 
	g‹m¶©e
<
şass
 
	gHashTy³
>

69 
addToAcûssCÚŒŞAÎowLi¡
(cÚ¡ 
SŒšg
& 
¡ršg
, 
¡¬t
, 
’d
, 
HashS‘
<SŒšg, 
HashTy³
>& 
£t
)

71 #ifdeà
SSLAB__DEBUG


72 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

75 
SŒšgIm¶
* 
	g¡ršgIm¶
 = 
¡ršg
.
im¶
();

76 ià(!
	g¡ršgIm¶
)

80 
	g¡¬t
 <ğ
’d
 && 
isS·ûOrNewlše
((*
¡ršgIm¶
)[
¡¬t
]))

81 ++
¡¬t
;

84 ià(
	g¡¬t
 > 
	g’d
)

88 
	g’d
 && 
isS·ûOrNewlše
((*
¡ršgIm¶
)[
’d
]))

89 --
	g’d
;

91 
	g£t
.
add
(
¡ršg
.
sub¡ršg
(
¡¬t
, 
’d
 - start + 1));

94 
	g‹m¶©e
<
şass
 
	gHashTy³
>

95 
boŞ
 
·r£AcûssCÚŒŞAÎowLi¡
(cÚ¡ 
SŒšg
& 
¡ršg
, 
HashS‘
<SŒšg, 
HashTy³
>& 
£t
)

97 #ifdeà
SSLAB__DEBUG


98 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

101 
	g¡¬t
 = 0;

102 
	g’d
;

103 (
	g’d
 = 
¡ršg
.
fšd
(',', 
¡¬t
)) != -1) {

104 ià(
¡¬t
 =ğ
’d
)

105  
çl£
;

107 
addToAcûssCÚŒŞAÎowLi¡
(
¡ršg
, 
¡¬t
, 
’d
 - 1, 
£t
);

108 
	g¡¬t
 = 
’d
 + 1;

110 ià(
	g¡¬t
 !ğ
¡©ic_ÿ¡
<>(
¡ršg
.
Ëngth
()))

111 
addToAcûssCÚŒŞAÎowLi¡
(
¡ršg
, 
¡¬t
, sŒšg.
Ëngth
(è- 1, 
£t
);

113  
	gŒue
;

116 
boŞ
 
	gCrossOrigšP»æightResuÉCacheI‹m
::
·r£
(cÚ¡ 
ResourûRe¥Ú£
& 
»¥Ú£
)

118 #ifdeà
SSLAB__DEBUG


119 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

122 
	gm_m‘hods
.
ş—r
();

123 ià(!
·r£AcûssCÚŒŞAÎowLi¡
(
»¥Ú£
.
h‰pH—d”F›ld
("Acûss-CÚŒŞ-AÎow-M‘hods"), 
m_m‘hods
))

124  
	gçl£
;

126 
	gm_h—d”s
.
ş—r
();

127 ià(!
·r£AcûssCÚŒŞAÎowLi¡
(
»¥Ú£
.
h‰pH—d”F›ld
("Acûss-CÚŒŞ-AÎow-H—d”s"), 
m_h—d”s
))

128  
	gçl£
;

130 
	gexpœyD–
;

131 ià(
·r£AcûssCÚŒŞMaxAge
(
»¥Ú£
.
h‰pH—d”F›ld
("Acûss-CÚŒŞ-Max-Age"), 
expœyD–
)) {

132 ià(
	gexpœyD–
 > 
	gmaxP»æightCacheTimeoutSecÚds
)

133 
	gexpœyD–
 = 
maxP»æightCacheTimeoutSecÚds
;

135 
	gexpœyD–
 = 
deçuÉP»æightCacheTimeoutSecÚds
;

137 
	gm_absŞu‹ExpœyTime
 = 
cu¼’tTime
(è+ 
expœyD–
;

138  
	gŒue
;

141 
boŞ
 
	gCrossOrigšP»æightResuÉCacheI‹m
::
®lowsCrossOrigšM‘hod
(cÚ¡ 
SŒšg
& 
m‘hod
) const

143 #ifdeà
SSLAB__DEBUG


144 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

147  
	gm_m‘hods
.
cÚšs
(
m‘hod
è|| 
isOnAcûssCÚŒŞSim¶eReque¡M‘hodWh™–i¡
(method);

150 
boŞ
 
	gCrossOrigšP»æightResuÉCacheI‹m
::
®lowsCrossOrigšH—d”s
(cÚ¡ 
HTTPH—d”M­
& 
»que¡H—d”s
) const

152 #ifdeà
SSLAB__DEBUG


153 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

156 
	gHTTPH—d”M­
::
cÚ¡_™”©Ü
 
’d
 = 
»que¡H—d”s
.end();

157 
	gHTTPH—d”M­
::
cÚ¡_™”©Ü
 
™
 = 
»que¡H—d”s
.
begš
(); 
	g™
 !ğ
’d
; ++it) {

158 ià(!
	gm_h—d”s
.
cÚšs
(
™
->
fœ¡
è&& !
isOnAcûssCÚŒŞSim¶eReque¡H—d”Wh™–i¡
(™->fœ¡, it->
£cÚd
))

159  
	gçl£
;

161  
	gŒue
;

164 
boŞ
 
	gCrossOrigšP»æightResuÉCacheI‹m
::
®lowsReque¡
(boŞ 
šşudeC»d’tŸls
, cÚ¡ 
SŒšg
& 
m‘hod
, cÚ¡ 
HTTPH—d”M­
& 
»que¡H—d”s
) const

166 #ifdeà
SSLAB__DEBUG


167 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

170 ià(
	gm_absŞu‹ExpœyTime
 < 
cu¼’tTime
())

171  
	gçl£
;

172 ià(
	gšşudeC»d’tŸls
 && !
	gm_üed’tŸls
)

173  
	gçl£
;

174 ià(!
®lowsCrossOrigšM‘hod
(
m‘hod
))

175  
	gçl£
;

176 ià(!
®lowsCrossOrigšH—d”s
(
»que¡H—d”s
))

177  
	gçl£
;

178  
	gŒue
;

181 
	gCrossOrigšP»æightResuÉCache
& CrossOrigšP»æightResuÉCache::
sh¬ed
()

183 #ifdeà
SSLAB__DEBUG


184 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

187 
DEFINE_STATIC_LOCAL
(
CrossOrigšP»æightResuÉCache
, 
ÿche
, ());

188 
ASSERT
(
isMašTh»ad
());

189  
	gÿche
;

192 
	gCrossOrigšP»æightResuÉCache
::
­³ndEÁry
(cÚ¡ 
SŒšg
& 
Üigš
, cÚ¡ 
KURL
& 
u¾
, 
CrossOrigšP»æightResuÉCacheI‹m
* 
´eæightResuÉ
)

194 #ifdeà
SSLAB__DEBUG


195 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

198 
ASSERT
(
isMašTh»ad
());

199 
	gm_´eæightHashM­
.
£t
(
¡d
::
make_·œ
(
Üigš
, 
u¾
), 
´eæightResuÉ
);

202 
boŞ
 
	gCrossOrigšP»æightResuÉCache
::
ÿnSkP»æight
(cÚ¡ 
SŒšg
& 
Üigš
, cÚ¡ 
KURL
& 
u¾
, boŞ 
šşudeC»d’tŸls
, cÚ¡ SŒšg& 
m‘hod
, cÚ¡ 
HTTPH—d”M­
& 
»que¡H—d”s
)

204 #ifdeà
SSLAB__DEBUG


205 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

208 
ASSERT
(
isMašTh»ad
());

209 
	gCrossOrigšP»æightResuÉHashM­
::
™”©Ü
 
ÿcheIt
 = 
m_´eæightHashM­
.
fšd
(
¡d
::
make_·œ
(
Üigš
, 
u¾
));

210 ià(
	gÿcheIt
 =ğ
m_´eæightHashM­
.
’d
())

211  
çl£
;

213 ià(
	gÿcheIt
->
	g£cÚd
->
®lowsReque¡
(
šşudeC»d’tŸls
, 
m‘hod
, 
»que¡H—d”s
))

214  
	gŒue
;

216 
d–‘e
 
	gÿcheIt
->
	g£cÚd
;

217 
	gm_´eæightHashM­
.
»move
(
ÿcheIt
);

218  
	gçl£
;

221 
	gCrossOrigšP»æightResuÉCache
::
em±y
()

223 #ifdeà
SSLAB__DEBUG


224 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

227 
ASSERT
(
isMašTh»ad
());

228 
d–‘eAÎV®ues
(
m_´eæightHashM­
);

229 
	gm_´eæightHashM­
.
ş—r
();

	@CrossOriginPreflightResultCache.h

27 #iâdeà
CrossOrigšP»æightResuÉCacheI‹m_h


28 
	#CrossOrigšP»æightResuÉCacheI‹m_h


	)

30 
	~"KURLHash.h
"

31 
	~"SŒšgHash.h
"

32 
	~<wtf/HashM­.h
>

33 
	~<wtf/HashS‘.h
>

35 
Çme¥aû
 
	gWebCÜe
 {

37 
şass
 
	gHTTPH—d”M­
;

38 
şass
 
	gResourûRe¥Ú£
;

40 şas 
	cCrossOrigšP»æightResuÉCacheI‹m
 : 
public
 
NÚcİyabË
 {

41 
public
:

42 
CrossOrigšP»æightResuÉCacheI‹m
(
boŞ
 
üed’tŸls
)

43 : 
m_absŞu‹ExpœyTime
(0)

44 , 
m_üed’tŸls
(
üed’tŸls
)

48 
boŞ
 
·r£
(cÚ¡ 
ResourûRe¥Ú£
&);

49 
boŞ
 
®lowsCrossOrigšM‘hod
(cÚ¡ 
SŒšg
&) const;

50 
boŞ
 
®lowsCrossOrigšH—d”s
(cÚ¡ 
HTTPH—d”M­
&) const;

51 
boŞ
 
®lowsReque¡
(boŞ 
šşudeC»d’tŸls
, cÚ¡ 
SŒšg
& 
m‘hod
, cÚ¡ 
HTTPH—d”M­
& 
»que¡H—d”s
) const;

53 
	g´iv©e
:

54 
HashS‘
<
	tSŒšg
, 
	tCa£FŞdšgHash
> 
	tH—d”sS‘
;

59 
	gm_absŞu‹ExpœyTime
;

60 
boŞ
 
	gm_üed’tŸls
;

61 
	gHashS‘
<
	gSŒšg
> 
	gm_m‘hods
;

62 
H—d”sS‘
 
	gm_h—d”s
;

65 şas 
	cCrossOrigšP»æightResuÉCache
 : 
public
 
NÚcİyabË
 {

66 
public
:

67 
CrossOrigšP»æightResuÉCache
& 
sh¬ed
();

69 
­³ndEÁry
(cÚ¡ 
SŒšg
& 
Üigš
, cÚ¡ 
KURL
&, 
CrossOrigšP»æightResuÉCacheI‹m
*);

70 
boŞ
 
ÿnSkP»æight
(cÚ¡ 
SŒšg
& 
Üigš
, cÚ¡ 
KURL
&, boŞ 
šşudeC»d’tŸls
, cÚ¡ SŒšg& 
m‘hod
, cÚ¡ 
HTTPH—d”M­
& 
»que¡H—d”s
);

72 
em±y
();

74 
	g´iv©e
:

75 
CrossOrigšP»æightResuÉCache
() { }

77 
HashM­
<
	t¡d
::
	t·œ
<
	tSŒšg
, 
	tKURL
>, 
	tCrossOrigšP»æightResuÉCacheI‹m
*> 
	tCrossOrigšP»æightResuÉHashM­
;

79 
CrossOrigšP»æightResuÉHashM­
 
	gm_´eæightHashM­
;

	@DocLoader.cpp

2 #ifdeà
SSLAB__DEBUG


3 #iâdeà
SSLAB__QDATETIME


4 
	#SSLAB__QDATETIME


	)

5 
	~<QD©eTime
>

9 #ifdeà
SSLAB__DEBUG


10 #iâdeà
SSLAB__QTHREAD


11 
	#SSLAB__QTHREAD


	)

12 
	~<QTh»ad
>

41 
	~"cÚfig.h
"

42 
	~"DocLßd”.h
"

44 
	~"Cache.h
"

45 
	~"CachedCSSStyËSh“t.h
"

46 
	~"CachedFÚt.h
"

47 
	~"CachedImage.h
"

48 
	~"CachedSüt.h
"

49 
	~"CachedXSLStyËSh“t.h
"

50 
	~"CÚsŞe.h
"

51 
	~"CSŒšg.h
"

52 
	~"Docum’t.h
"

53 
	~"DOMWšdow.h
"

54 
	~"HTMLEËm’t.h
"

55 
	~"F¿me.h
"

56 
	~"F¿meLßd”.h
"

57 
	~"F¿meLßd”Cl›Á.h
"

58 
	~"lßd”.h
"

59 
	~"Secur™yOrigš.h
"

60 
	~"S‘tšgs.h
"

62 
	#PRELOAD_DEBUG
 0

	)

64 
Çme¥aû
 
	gWebCÜe
 {

66 
	gDocLßd”
::
DocLßd”
(
Docum’t
* 
doc
)

67 : 
m_ÿche
(
ÿche
())

68 , 
m_doc
(
doc
)

69 , 
m_»que¡CouÁ
(0)

70 , 
m_autoLßdImages
(
Œue
)

71 , 
m_lßdInProg»ss
(
çl£
)

72 , 
m_®lowSËResourûs
(
çl£
)

74 #ifdeà
SSLAB__DEBUG


75 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

78 
	gm_ÿche
->
addDocLßd”
(
this
);

81 
	gDocLßd”
::~
DocLßd”
()

83 #ifdeà
SSLAB__DEBUG


84 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

87 ià(
	gm_»que¡CouÁ
)

88 
	gm_ÿche
->
lßd”
()->
ÿnûlReque¡s
(
this
);

90 
ş—rP»lßds
();

91 
	gDocum’tResourûM­
::
™”©Ü
 
’d
 = 
m_docum’tResourûs
.end();

92 
	gDocum’tResourûM­
::
™”©Ü
 
™
 = 
m_docum’tResourûs
.
begš
(); 
	g™
 !ğ
’d
; ++it)

93 
	g™
->
	g£cÚd
->
£tDocLßd”
(0);

94 
	gm_ÿche
->
»moveDocLßd”
(
this
);

97 
ASSERT
(
m_»que¡CouÁ
 == 0);

100 
F¿me
* 
	gDocLßd”
::
äame
() const

102 #ifdeà
SSLAB__DEBUG


103 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

106  
	gm_doc
->
äame
();

109 
	gDocLßd”
::
checkFÜR–ßd
(cÚ¡ 
KURL
& 
fuÎURL
)

111 #ifdeà
SSLAB__DEBUG


112 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

115 ià(
	gm_®lowSËResourûs
)

118 ià(
	gfuÎURL
.
isEm±y
())

121 ià(
	gm_»lßdedURLs
.
cÚšs
(
fuÎURL
.
¡ršg
()))

124 
CachedResourû
* 
	gexi¡šg
 = 
ÿche
()->
»sourûFÜURL
(
fuÎURL
.
¡ršg
());

125 ià(!
	gexi¡šg
 ||ƒxi¡šg->
isP»lßded
())

129 
ÿchePŞicy
()) {

130 
	gCachePŞicyV”ify
:

132 ià(!
exi¡šg
->
mu¡Rev®id©e
(
CachePŞicyV”ify
))

135 
ÿche
()->
»v®id©eResourû
(
exi¡šg
, 
this
);

137 
	gCachePŞicyCache
:

139 ià(!
exi¡šg
->
mu¡Rev®id©e
(
CachePŞicyCache
))

142 
ÿche
()->
»v®id©eResourû
(
exi¡šg
, 
this
);

144 
	gCachePŞicyR–ßd
:

146 
ÿche
()->
»move
(
exi¡šg
);

148 
	gCachePŞicyRev®id©e
:

150 
ÿche
()->
»v®id©eResourû
(
exi¡šg
, 
this
);

152 
	gCachePŞicyAÎowSË
:

157 
	gm_»lßdedURLs
.
add
(
fuÎURL
.
¡ršg
());

160 
CachedImage
* 
	gDocLßd”
::
»que¡Image
(cÚ¡ 
SŒšg
& 
u¾
)

162 #ifdeà
SSLAB__DEBUG


163 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

166 ià(
F¿me
* 
	gf
 = 
äame
()) {

167 
S‘tšgs
* 
£‰šgs
 = 
f
->settings();

168 ià(!
	gf
->
lßd”
()->
ş›Á
()->
®lowImages
(!
£‰šgs
 || s‘tšgs->
¬eImagesEÇbËd
()))

171 
CachedImage
* 
	g»sourû
 = 
¡©ic_ÿ¡
<CachedImage*>(
»que¡Resourû
(
CachedResourû
::
ImageResourû
, 
u¾
, 
SŒšg
()));

172 ià(
autoLßdImages
(è&& 
	g»sourû
 &&„esourû->
¡lN“dsLßd
()) {

173 
	g»sourû
->
£tLßdšg
(
Œue
);

174 
ÿche
()->
lßd”
()->
lßd
(
this
, 
»sourû
, 
Œue
);

176  
	g»sourû
;

179 
CachedFÚt
* 
	gDocLßd”
::
»que¡FÚt
(cÚ¡ 
SŒšg
& 
u¾
)

181 #ifdeà
SSLAB__DEBUG


182 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

185  
	g¡©ic_ÿ¡
<
	gCachedFÚt
*>(
»que¡Resourû
(
CachedResourû
::
FÚtResourû
, 
u¾
, 
SŒšg
()));

188 
CachedCSSStyËSh“t
* 
	gDocLßd”
::
»que¡CSSStyËSh“t
(cÚ¡ 
SŒšg
& 
u¾
, cÚ¡ SŒšg& 
ch¬£t
)

190 #ifdeà
SSLAB__DEBUG


191 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

194  
	g¡©ic_ÿ¡
<
	gCachedCSSStyËSh“t
*>(
»que¡Resourû
(
CachedResourû
::
CSSStyËSh“t
, 
u¾
, 
ch¬£t
));

197 
CachedCSSStyËSh“t
* 
	gDocLßd”
::
»que¡U£rCSSStyËSh“t
(cÚ¡ 
SŒšg
& 
u¾
, cÚ¡ SŒšg& 
ch¬£t
)

199 #ifdeà
SSLAB__DEBUG


200 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

203  
ÿche
()->
»que¡U£rCSSStyËSh“t
(
this
, 
u¾
, 
ch¬£t
);

206 
CachedSüt
* 
	gDocLßd”
::
»que¡Süt
(cÚ¡ 
SŒšg
& 
u¾
, cÚ¡ SŒšg& 
ch¬£t
)

208 #ifdeà
SSLAB__DEBUG


209 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

212  
	g¡©ic_ÿ¡
<
	gCachedSüt
*>(
»que¡Resourû
(
CachedResourû
::
Süt
, 
u¾
, 
ch¬£t
));

215 #ià
ENABLE
(
XSLT
)

216 
CachedXSLStyËSh“t
* 
	gDocLßd”
::
»que¡XSLStyËSh“t
(cÚ¡ 
SŒšg
& 
u¾
)

218 #ifdeà
SSLAB__DEBUG


219 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

222  
	g¡©ic_ÿ¡
<
	gCachedXSLStyËSh“t
*>(
»que¡Resourû
(
CachedResourû
::
XSLStyËSh“t
, 
u¾
, 
SŒšg
()));

226 #ià
ENABLE
(
XBL
)

227 
CachedXBLDocum’t
* 
	gDocLßd”
::
»que¡XBLDocum’t
(cÚ¡ 
SŒšg
& 
u¾
)

229 #ifdeà
SSLAB__DEBUG


230 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

233  
	g¡©ic_ÿ¡
<
	gCachedXSLStyËSh“t
*>(
»que¡Resourû
(
CachedResourû
::
XBL
, 
u¾
, 
SŒšg
()));

237 
boŞ
 
	gDocLßd”
::
ÿnReque¡
(
CachedResourû
::
Ty³
 
ty³
, cÚ¡ 
KURL
& 
u¾
)

239 #ifdeà
SSLAB__DEBUG


240 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

246 
	gty³
) {

247 
	gCachedResourû
::
ImageResourû
:

248 
CachedResourû
::
CSSStyËSh“t
:

249 
CachedResourû
::
Süt
:

250 
CachedResourû
::
FÚtResourû
:

254 #ià
ENABLE
(
XSLT
)

255 
	gCachedResourû
::
XSLStyËSh“t
:

257 #ià
ENABLE
(
XBL
)

258 
CachedResourû
::
XBL
:

260 #ià
ENABLE
(
XSLT
è|| ENABLE(
XBL
)

261 ià(!
m_doc
->
£cur™yOrigš
()->
ÿnReque¡
(
u¾
)) {

262 
´štAcûssD’›dMes§ge
(
u¾
);

263  
	gçl£
;

268 
ASSERT_NOT_REACHED
();

279 
	gty³
) {

280 
	gCachedResourû
::
Süt
:

281 #ià
ENABLE
(
XSLT
)

282 
CachedResourû
::
XSLStyËSh“t
:

284 #ià
ENABLE
(
XBL
)

285 
CachedResourû
::
XBL
:

288 ià(
F¿me
* 
f
 = 
äame
())

289 
f
->
lßd”
()->
checkIfRunIn£cu»CÚ‹Á
(
m_doc
->
£cur™yOrigš
(), 
u¾
);

291 
	gCachedResourû
::
ImageResourû
:

292 
CachedResourû
::
CSSStyËSh“t
:

293 
CachedResourû
::
FÚtResourû
: {

295 ià(
F¿me
* 
f
 = 
äame
()) {

296 
F¿me
* 
tİ
 = 
f
->
Œ“
()->top();

297 
	gtİ
->
lßd”
()->
checkIfDi¥ÏyIn£cu»CÚ‹Á
(
tİ
->
docum’t
()->
£cur™yOrigš
(), 
u¾
);

302 
ASSERT_NOT_REACHED
();

306  
	gŒue
;

309 
CachedResourû
* 
	gDocLßd”
::
»que¡Resourû
(CachedResourû::
Ty³
 
ty³
, cÚ¡ 
SŒšg
& 
u¾
, cÚ¡ SŒšg& 
ch¬£t
, 
boŞ
 
isP»lßd
)

311 #ifdeà
SSLAB__DEBUG


312 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

315 
KURL
 
	gfuÎURL
 = 
m_doc
->
com¶‘eURL
(
u¾
);

317 ià(!
	gfuÎURL
.
isV®id
(è|| !
ÿnReque¡
(
ty³
, 
fuÎURL
))

320 ià(
ÿche
()->
di§bËd
()) {

321 
	gDocum’tResourûM­
::
™”©Ü
 
™
 = 
m_docum’tResourûs
.
fšd
(
fuÎURL
.
¡ršg
());

323 ià(
	g™
 !ğ
m_docum’tResourûs
.
’d
()) {

324 
™
->
£cÚd
->
£tDocLßd”
(0);

325 
	gm_docum’tResourûs
.
»move
(
™
);

329 
checkFÜR–ßd
(
fuÎURL
);

330 
CachedResourû
* 
	g»sourû
 = 
ÿche
()->
»que¡Resourû
(
this
, 
ty³
, 
fuÎURL
, 
ch¬£t
, 
isP»lßd
);

331 ià(
	g»sourû
) {

334 ià(
	gfuÎURL
 !ğ
»sourû
->
u¾
(è&& !
ÿnReque¡
(
ty³
, 
KURL
(
P¬£dURLSŒšg
,„esource->url())))

337 
	gm_docum’tResourûs
.
£t
(
»sourû
->
u¾
(),„esource);

338 
checkCacheObjeùStus
(
»sourû
);

340  
	g»sourû
;

343 
	gDocLßd”
::
´štAcûssD’›dMes§ge
(cÚ¡ 
KURL
& 
u¾
) const

345 #ifdeà
SSLAB__DEBUG


346 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

349 ià(
	gu¾
.
isNuÎ
())

352 ià(!
äame
())

355 
S‘tšgs
* 
	g£‰šgs
 = 
äame
()->
£‰šgs
();

356 ià(!
	g£‰šgs
 || s‘tšgs->
´iv©eBrowsšgEÇbËd
())

359 
SŒšg
 
	gmes§ge
 = 
m_doc
->
u¾
().
isNuÎ
() ?

360 
SŒšg
::
fÜm©
("Unsafe‡ttempto†oad URL %s.",

361 
u¾
.
¡ršg
().
utf8
().
d©a
()) :

362 
SŒšg
::
fÜm©
("Unsafe‡ttempto†oad URL %s from frame with URL %s. "

364 
u¾
.
¡ršg
().
utf8
().
d©a
(),

365 
m_doc
->
u¾
().
¡ršg
().
utf8
().
d©a
());

368 
äame
()->
domWšdow
()->
cÚsŞe
()->
addMes§ge
(
Oth”Mes§geSourû
, 
LogMes§geTy³
, 
E¼ÜMes§geLev–
, 
mes§ge
, 1, 
SŒšg
());

371 
	gDocLßd”
::
£tAutoLßdImages
(
boŞ
 
’abË
)

373 #ifdeà
SSLAB__DEBUG


374 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

377 ià(
	g’abË
 =ğ
m_autoLßdImages
)

380 
	gm_autoLßdImages
 = 
’abË
;

382 ià(!
	gm_autoLßdImages
)

385 
	gDocum’tResourûM­
::
™”©Ü
 
’d
 = 
m_docum’tResourûs
.end();

386 
	gDocum’tResourûM­
::
™”©Ü
 
™
 = 
m_docum’tResourûs
.
begš
(); 
	g™
 !ğ
’d
; ++it) {

387 
CachedResourû
* 
	g»sourû
 = 
™
->
£cÚd
.
g‘
();

388 ià(
	g»sourû
->
ty³
(è=ğ
CachedResourû
::
ImageResourû
) {

389 
CachedImage
* 
image
 = 
cÚ¡_ÿ¡
<CachedImage*>(
¡©ic_ÿ¡
<cÚ¡ CachedImage*>(
»sourû
));

391 ià(
	gimage
->
¡lN“dsLßd
())

392 
ÿche
()->
lßd”
()->
lßd
(
this
, 
image
, 
Œue
);

397 
CachePŞicy
 
	gDocLßd”
::
ÿchePŞicy
() const

399 #ifdeà
SSLAB__DEBUG


400 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

403  
äame
(è? f¿me()->
lßd”
()->
sub»sourûCachePŞicy
(è: 
CachePŞicyV”ify
;

406 
	gDocLßd”
::
»moveCachedResourû
(
CachedResourû
* 
»sourû
) const

408 #ifdeà
SSLAB__DEBUG


409 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

412 #iâdeà
NDEBUG


413 
	gDocum’tResourûM­
::
™”©Ü
 
™
 = 
m_docum’tResourûs
.
fšd
(
»sourû
->
u¾
());

414 ià(
	g™
 !ğ
m_docum’tResourûs
.
’d
())

415 
ASSERT
(
™
->
£cÚd
.
g‘
(è=ğ
»sourû
);

417 
	gm_docum’tResourûs
.
»move
(
»sourû
->
u¾
());

420 
	gDocLßd”
::
£tLßdInProg»ss
(
boŞ
 
lßd
)

422 #ifdeà
SSLAB__DEBUG


423 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

426 
	gm_lßdInProg»ss
 = 
lßd
;

427 ià(!
	glßd
 && 
äame
())

428 
äame
()->
lßd”
()->
lßdDÚe
();

431 
	gDocLßd”
::
checkCacheObjeùStus
(
CachedResourû
* 
»sourû
)

433 #ifdeà
SSLAB__DEBUG


434 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

438 ià(!
	g»sourû
 || !
äame
())

441 
	g»sourû
->
¡©us
()) {

442 
	gCachedResourû
::
Cached
:

444 
	gCachedResourû
::
NÙCached
:

445 
CachedResourû
::
Unknown
:

446 
CachedResourû
::
New
:

447 
CachedResourû
::
P’dšg
:

452 
äame
()->
lßd”
()->
lßdedResourûFromMemÜyCache
(
»sourû
);

455 
	gDocLßd”
::
šüem’tReque¡CouÁ
()

457 #ifdeà
SSLAB__DEBUG


458 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

461 ++
	gm_»que¡CouÁ
;

464 
	gDocLßd”
::
deüem’tReque¡CouÁ
()

466 #ifdeà
SSLAB__DEBUG


467 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

470 --
	gm_»que¡CouÁ
;

471 
ASSERT
(
m_»que¡CouÁ
 > -1);

474 
	gDocLßd”
::
»que¡CouÁ
()

476 #ifdeà
SSLAB__DEBUG


477 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

480 ià(
lßdInProg»ss
())

481  
	gm_»que¡CouÁ
 + 1;

482  
	gm_»que¡CouÁ
;

485 
	gDocLßd”
::
´–ßd
(
CachedResourû
::
Ty³
 
ty³
, cÚ¡ 
SŒšg
& 
u¾
, cÚ¡ SŒšg& 
ch¬£t
, 
boŞ
 
»ã»nûdFromBody
)

487 #ifdeà
SSLAB__DEBUG


488 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

491 
boŞ
 
	ghasR’d”šg
 = 
m_doc
->
body
(è&& m_doc->body()->
»nd””
();

492 ià(!
	ghasR’d”šg
 && (
	g»ã»nûdFromBody
 || 
	gty³
 =ğ
CachedResourû
::
ImageResourû
)) {

495 
P’dšgP»lßd
 
³ndšgP»lßd
 = { 
ty³
, 
u¾
, 
ch¬£t
 };

496 
	gm_³ndšgP»lßds
.
­³nd
(
³ndšgP»lßd
);

499 
»que¡P»lßd
(
ty³
, 
u¾
, 
ch¬£t
);

502 
	gDocLßd”
::
checkFÜP’dšgP»lßds
()

504 #ifdeà
SSLAB__DEBUG


505 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

508 
	gcouÁ
 = 
m_³ndšgP»lßds
.
size
();

509 ià(!
	gcouÁ
 || !
	gm_doc
->
body
(è|| !m_doc->body()->
»nd””
())

511 
	gi
 = 0; i < 
	gcouÁ
; ++i) {

512 
	gP’dšgP»lßd
& 
	g´–ßd
 = 
m_³ndšgP»lßds
[
i
];

514 ià(!
ÿchedResourû
(
m_doc
->
com¶‘eURL
(
´–ßd
.
m_u¾
)))

515 
»que¡P»lßd
(
´–ßd
.
m_ty³
,…»lßd.
m_u¾
,…»lßd.
m_ch¬£t
);

517 
	gm_³ndšgP»lßds
.
ş—r
();

520 
	gDocLßd”
::
»que¡P»lßd
(
CachedResourû
::
Ty³
 
ty³
, cÚ¡ 
SŒšg
& 
u¾
, cÚ¡ SŒšg& 
ch¬£t
)

522 #ifdeà
SSLAB__DEBUG


523 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

526 
SŒšg
 
	g’codšg
;

527 ià(
	gty³
 =ğ
CachedResourû
::
Süt
 || 
ty³
 =ğCachedResourû::
CSSStyËSh“t
)

528 
’codšg
 = 
ch¬£t
.
isEm±y
(è? 
m_doc
->
äame
()->
lßd”
()->encoding() : charset;

530 
CachedResourû
* 
	g»sourû
 = 
»que¡Resourû
(
ty³
, 
u¾
, 
’codšg
, 
Œue
);

531 ià(!
	g»sourû
 || (
	gm_´–ßds
 && m_´–ßds->
cÚšs
(
»sourû
)))

533 
	g»sourû
->
šü—£P»lßdCouÁ
();

535 ià(!
	gm_´–ßds
)

536 
	gm_´–ßds
.
£t
(
Ãw
 
Li¡HashS‘
<
CachedResourû
*>);

537 
	gm_´–ßds
->
add
(
»sourû
);

539 #ià
PRELOAD_DEBUG


540 
´štf
("PRELOADING %s\n", 
»sourû
->
u¾
().
Ïtš1
().
d©a
());

544 
	gDocLßd”
::
ş—rP»lßds
()

546 #ifdeà
SSLAB__DEBUG


547 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

550 #ià
PRELOAD_DEBUG


551 
´štP»lßdSts
();

553 ià(!
	gm_´–ßds
)

556 
	gLi¡HashS‘
<
	gCachedResourû
*>::
™”©Ü
 
’d
 = 
m_´–ßds
->end();

557 
	gLi¡HashS‘
<
	gCachedResourû
*>::
™”©Ü
 
™
 = 
m_´–ßds
->
begš
(); 
	g™
 !ğ
’d
; ++it) {

558 
CachedResourû
* 
	g»s
 = *
™
;

559 
	g»s
->
deü—£P»lßdCouÁ
();

560 ià(
	g»s
->
ÿnD–‘e
(è&& !»s->
šCache
())

561 
d–‘e
 
	g»s
;

562 ià(
	g»s
->
´–ßdResuÉ
(è=ğ
CachedResourû
::
P»lßdNÙReã»nûd
)

563 
ÿche
()->
»move
(
»s
);

565 
	gm_´–ßds
.
ş—r
();

568 
	gDocLßd”
::
ş—rP’dšgP»lßds
()

570 #ifdeà
SSLAB__DEBUG


571 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

574 
	gm_³ndšgP»lßds
.
ş—r
();

577 #ià
PRELOAD_DEBUG


578 
	gDocLßd”
::
´štP»lßdSts
()

580 #ifdeà
SSLAB__DEBUG


581 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

584 
	gsüts
 = 0;

585 
	gsütMis£s
 = 0;

586 
	g¡yËsh“ts
 = 0;

587 
	g¡yËsh“tMis£s
 = 0;

588 
	gimages
 = 0;

589 
	gimageMis£s
 = 0;

590 
	gLi¡HashS‘
<
	gCachedResourû
*>::
™”©Ü
 
’d
 = 
m_´–ßds
.end();

591 
	gLi¡HashS‘
<
	gCachedResourû
*>::
™”©Ü
 
™
 = 
m_´–ßds
.
begš
(); 
	g™
 !ğ
’d
; ++it) {

592 
CachedResourû
* 
	g»s
 = *
™
;

593 ià(
	g»s
->
´–ßdResuÉ
(è=ğ
CachedResourû
::
P»lßdNÙReã»nûd
)

594 
´štf
("!! UNREFERENCED PRELOAD %s\n", 
»s
->
u¾
().
Ïtš1
().
d©a
());

595 ià(
	g»s
->
´–ßdResuÉ
(è=ğ
CachedResourû
::
P»lßdReã»nûdWheCom¶‘e
)

596 
´štf
("HIT COMPLETE PRELOAD %s\n", 
»s
->
u¾
().
Ïtš1
().
d©a
());

597 ià(
	g»s
->
´–ßdResuÉ
(è=ğ
CachedResourû
::
P»lßdReã»nûdWheLßdšg
)

598 
´štf
("HIT LOADING PRELOAD %s\n", 
»s
->
u¾
().
Ïtš1
().
d©a
());

600 ià(
	g»s
->
ty³
(è=ğ
CachedResourû
::
Süt
) {

601 
süts
++;

602 ià(
	g»s
->
´–ßdResuÉ
(è< 
	gCachedResourû
::
P»lßdReã»nûdWheLßdšg
)

603 
sütMis£s
++;

604 } ià(
	g»s
->
ty³
(è=ğ
CachedResourû
::
CSSStyËSh“t
) {

605 
¡yËsh“ts
++;

606 ià(
	g»s
->
´–ßdResuÉ
(è< 
	gCachedResourû
::
P»lßdReã»nûdWheLßdšg
)

607 
¡yËsh“tMis£s
++;

609 
	gimages
++;

610 ià(
	g»s
->
´–ßdResuÉ
(è< 
	gCachedResourû
::
P»lßdReã»nûdWheLßdšg
)

611 
imageMis£s
++;

614 ià(
	g»s
->
”rÜOccu¼ed
())

615 
ÿche
()->
»move
(
»s
);

617 
	g»s
->
deü—£P»lßdCouÁ
();

619 
	gm_´–ßds
.
ş—r
();

621 ià(
	gsüts
)

622 
´štf
("SCRIPTS: %d (%d h™s, h™„©%d%%)\n", 
süts
, süt - 
sütMis£s
, (scripts - scriptMisses) * 100 / scripts);

623 ià(
	g¡yËsh“ts
)

624 
´štf
("STYLESHEETS: %d (%d h™s, h™„©%d%%)\n", 
¡yËsh“ts
, styËsh“t - 
¡yËsh“tMis£s
, (stylesheets - stylesheetMisses) * 100 / stylesheets);

625 ià(
	gimages
)

626 
´štf
("IMAGES: %d (%d h™s, h™„©%d%%)\n", 
images
, image - 
imageMis£s
, (images - imageMisses) * 100 / images);

	@DocLoader.h

26 #iâdeà
DocLßd”_h


27 
	#DocLßd”_h


	)

29 
	~"CachedResourû.h
"

30 
	~"CachedResourûHªdË.h
"

31 
	~"CachePŞicy.h
"

32 
	~"SŒšgHash.h
"

33 
	~<wtf/HashM­.h
>

34 
	~<wtf/HashS‘.h
>

35 
	~<wtf/Li¡HashS‘.h
>

37 
Çme¥aû
 
	gWebCÜe
 {

39 
şass
 
	gCachedCSSStyËSh“t
;

40 
şass
 
	gCachedFÚt
;

41 
şass
 
	gCachedImage
;

42 
şass
 
	gCachedSüt
;

43 
şass
 
	gCachedXSLStyËSh“t
;

44 
şass
 
	gDocum’t
;

45 
şass
 
	gF¿me
;

46 
şass
 
	gImageLßd”
;

47 
şass
 
	gKURL
;

50 şas 
	cDocLßd”
 : 
public
 
NÚcİyabË
 {

51 
ä›nd
 
şass
 
Cache
;

52 
ä›nd
 
şass
 
	gImageLßd”
;

54 
	gpublic
:

55 
DocLßd”
(
Docum’t
*);

56 ~
DocLßd”
();

58 
CachedImage
* 
»que¡Image
(cÚ¡ 
SŒšg
& 
u¾
);

59 
CachedCSSStyËSh“t
* 
»que¡CSSStyËSh“t
(cÚ¡ 
SŒšg
& 
u¾
, cÚ¡ SŒšg& 
ch¬£t
);

60 
CachedCSSStyËSh“t
* 
»que¡U£rCSSStyËSh“t
(cÚ¡ 
SŒšg
& 
u¾
, cÚ¡ SŒšg& 
ch¬£t
);

61 
CachedSüt
* 
»que¡Süt
(cÚ¡ 
SŒšg
& 
u¾
, cÚ¡ SŒšg& 
ch¬£t
);

62 
CachedFÚt
* 
»que¡FÚt
(cÚ¡ 
SŒšg
& 
u¾
);

64 #ià
ENABLE
(
XSLT
)

65 
CachedXSLStyËSh“t
* 
»que¡XSLStyËSh“t
(cÚ¡ 
SŒšg
& 
u¾
);

67 #ià
ENABLE
(
XBL
)

68 
CachedXBLDocum’t
* 
»que¡XBLDocum’t
(cÚ¡ 
SŒšg
 &
u¾
);

72 
´štAcûssD’›dMes§ge
(cÚ¡ 
KURL
& 
u¾
) const;

74 
CachedResourû
* 
ÿchedResourû
(cÚ¡ 
SŒšg
& 
u¾
ècÚ¡ {  
	gm_docum’tResourûs
.
g‘
(url).get(); }

76 
	gHashM­
<
	tSŒšg
, 
	tCachedResourûHªdË
<
	tCachedResourû
> > 
	tDocum’tResourûM­
;

77 cÚ¡ 
	gDocum’tResourûM­
& 
®lCachedResourûs
(ècÚ¡ {  
	gm_docum’tResourûs
; }

79 
boŞ
 
autoLßdImages
(ècÚ¡ {  
	gm_autoLßdImages
; }

80 
£tAutoLßdImages
(
boŞ
);

82 
CachePŞicy
 
ÿchePŞicy
() const;

84 
F¿me
* 
äame
() const;

85 
Docum’t
* 
doc
(ècÚ¡ {  
	gm_doc
; }

87 
»moveCachedResourû
(
CachedResourû
*) const;

89 
£tLßdInProg»ss
(
boŞ
);

90 
boŞ
 
lßdInProg»ss
(ècÚ¡ {  
	gm_lßdInProg»ss
; }

92 
£tAÎowSËResourûs
(
boŞ
 
®lowSËResourûs
è{ 
	gm_®lowSËResourûs
 =‡llowStaleResources; }

94 
šüem’tReque¡CouÁ
();

95 
deüem’tReque¡CouÁ
();

96 
»que¡CouÁ
();

98 
ş—rP»lßds
();

99 
ş—rP’dšgP»lßds
();

100 
´–ßd
(
CachedResourû
::
Ty³
, cÚ¡ 
SŒšg
& 
u¾
, cÚ¡ SŒšg& 
ch¬£t
, 
boŞ
 
»ã»nûdFromBody
);

101 
checkFÜP’dšgP»lßds
();

102 
´štP»lßdSts
();

104 
	g´iv©e
:

105 
CachedResourû
* 
»que¡Resourû
(CachedResourû::
Ty³
, cÚ¡ 
SŒšg
& 
u¾
, cÚ¡ SŒšg& 
ch¬£t
, 
boŞ
 
isP»lßd
 = 
çl£
);

106 
»que¡P»lßd
(
CachedResourû
::
Ty³
, cÚ¡ 
SŒšg
& 
u¾
, cÚ¡ SŒšg& 
ch¬£t
);

108 
checkFÜR–ßd
(cÚ¡ 
KURL
&);

109 
checkCacheObjeùStus
(
CachedResourû
*);

110 
boŞ
 
ÿnReque¡
(
CachedResourû
::
Ty³
, cÚ¡ 
KURL
&);

112 
Cache
* 
	gm_ÿche
;

113 
	gHashS‘
<
	gSŒšg
> 
	gm_»lßdedURLs
;

114 
mubË
 
Docum’tResourûM­
 
	gm_docum’tResourûs
;

115 
Docum’t
* 
	gm_doc
;

117 
	gm_»que¡CouÁ
;

119 
	gOwnPŒ
<
	gLi¡HashS‘
<
	gCachedResourû
*> > 
	gm_´–ßds
;

120 
	sP’dšgP»lßd
 {

121 
	gCachedResourû
::
Ty³
 
m_ty³
;

122 
SŒšg
 
	gm_u¾
;

123 
SŒšg
 
	gm_ch¬£t
;

125 
	gVeùÜ
<
	gP’dšgP»lßd
> 
	gm_³ndšgP»lßds
;

128 
boŞ
 
	gm_autoLßdImages
 : 1;

129 
boŞ
 
	gm_lßdInProg»ss
 : 1;

130 
boŞ
 
	gm_®lowSËResourûs
 : 1;

	@DocumentLoader.cpp

2 #ifdeà
SSLAB__DEBUG


3 #iâdeà
SSLAB__QDATETIME


4 
	#SSLAB__QDATETIME


	)

5 
	~<QD©eTime
>

9 #ifdeà
SSLAB__DEBUG


10 #iâdeà
SSLAB__QTHREAD


11 
	#SSLAB__QTHREAD


	)

12 
	~<QTh»ad
>

43 
	~"cÚfig.h
"

44 
	~"Docum’tLßd”.h
"

46 
	~"AµliÿtiÚCacheHo¡.h
"

47 
	~"ArchiveFaùÜy.h
"

48 
	~"ArchiveResourûCŞËùiÚ.h
"

49 
	~"CachedPage.h
"

50 
	~"DocLßd”.h
"

51 
	~"Docum’t.h
"

52 
	~"Ev’t.h
"

53 
	~"F¿me.h
"

54 
	~"F¿meLßd”.h
"

55 
	~"F¿meT»e.h
"

56 
	~"Hi¡ÜyI‹m.h
"

57 
	~"Loggšg.h
"

58 
	~"MašResourûLßd”.h
"

59 
	~"Page.h
"

60 
	~"PÏtfÜmSŒšg.h
"

61 
	~"S‘tšgs.h
"

62 
	~"Sh¬edBufãr.h
"

63 
	~"XMLTok’iz”.h
"

65 
	~<wtf/As£¹iÚs.h
>

66 
	~<wtf/unicode/Unicode.h
>

68 
Çme¥aû
 
	gWebCÜe
 {

70 
ÿnûlAÎ
(cÚ¡ 
ResourûLßd”S‘
& 
lßd”s
)

72 #ifdeà
SSLAB__DEBUG


73 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

76 cÚ¡ 
ResourûLßd”S‘
 
	gcİy
 = 
lßd”s
;

77 
	gResourûLßd”S‘
::
cÚ¡_™”©Ü
 
’d
 = 
cİy
.end();

78 
	gResourûLßd”S‘
::
cÚ¡_™”©Ü
 
™
 = 
cİy
.
begš
(); 
	g™
 !ğ
’d
; ++it)

79 (*
	g™
)->
ÿnûl
();

82 
£tAÎDeãrsLßdšg
(cÚ¡ 
ResourûLßd”S‘
& 
lßd”s
, 
boŞ
 
deãrs
)

84 #ifdeà
SSLAB__DEBUG


85 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

88 cÚ¡ 
ResourûLßd”S‘
 
	gcİy
 = 
lßd”s
;

89 
	gResourûLßd”S‘
::
cÚ¡_™”©Ü
 
’d
 = 
cİy
.end();

90 
	gResourûLßd”S‘
::
cÚ¡_™”©Ü
 
™
 = 
cİy
.
begš
(); 
	g™
 !ğ
’d
; ++it)

91 (*
	g™
)->
£tDeãrsLßdšg
(
deãrs
);

94 
	gDocum’tLßd”
::
Docum’tLßd”
(cÚ¡ 
ResourûReque¡
& 
»q
, cÚ¡ 
Sub¡™u‹D©a
& 
sub¡™u‹D©a
)

95 : 
m_deãrMašResourûD©aLßd
(
Œue
)

96 , 
m_äame
(0)

97 , 
m_Üigš®Reque¡
(
»q
)

98 , 
m_sub¡™u‹D©a
(
sub¡™u‹D©a
)

99 , 
m_Üigš®Reque¡Cİy
(
»q
)

100 , 
m_»que¡
(
»q
)

101 , 
m_comm™‹d
(
çl£
)

102 , 
m_isStİpšg
(
çl£
)

103 , 
m_lßdšg
(
çl£
)

104 , 
m_gÙFœ¡By‹
(
çl£
)

105 , 
m_´im¬yLßdCom¶‘e
(
çl£
)

106 , 
m_isCl›ÁRedœeù
(
çl£
)

107 , 
m_¡İRecÜdšgRe¥Ú£s
(
çl£
)

108 , 
m_sub¡™u‹ResourûD–iv”yTim”
(
this
, &
Docum’tLßd”
::
sub¡™u‹ResourûD–iv”yTim”Fœed
)

109 , 
m_didC»©eGlob®Hi¡ÜyEÁry
(
çl£
)

110 #ià
ENABLE
(
OFFLINE_WEB_APPLICATIONS
)

111 , 
m_­¶iÿtiÚCacheHo¡
(
Ãw
 
AµliÿtiÚCacheHo¡
(
this
))

116 
F¿meLßd”
* 
	gDocum’tLßd”
::
äameLßd”
() const

118 #ifdeà
SSLAB__DEBUG


119 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

122 ià(!
	gm_äame
)

124  
	gm_äame
->
lßd”
();

127 
	gDocum’tLßd”
::~
Docum’tLßd”
()

129 #ifdeà
SSLAB__DEBUG


130 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

133 
ASSERT
(!
m_äame
 || 
äameLßd”
()->
aùiveDocum’tLßd”
(è!ğ
this
 || !äameLßd”()->
isLßdšg
());

136 
	gPassRefPŒ
<
	gSh¬edBufãr
> 
	gDocum’tLßd”
::
mašResourûD©a
() const

138 #ifdeà
SSLAB__DEBUG


139 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

142 ià(
	gm_mašResourûD©a
)

143  
	gm_mašResourûD©a
;

144 ià(
	gm_mašResourûLßd”
)

145  
	gm_mašResourûLßd”
->
»sourûD©a
();

149 cÚ¡ 
	gResourûReque¡
& 
	gDocum’tLßd”
::
Üigš®Reque¡
() const

151 #ifdeà
SSLAB__DEBUG


152 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

155  
	gm_Üigš®Reque¡
;

158 cÚ¡ 
	gResourûReque¡
& 
	gDocum’tLßd”
::
Üigš®Reque¡Cİy
() const

160 #ifdeà
SSLAB__DEBUG


161 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

164  
	gm_Üigš®Reque¡Cİy
;

167 cÚ¡ 
	gResourûReque¡
& 
	gDocum’tLßd”
::
»que¡
() const

169 #ifdeà
SSLAB__DEBUG


170 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

173  
	gm_»que¡
;

176 
	gResourûReque¡
& 
	gDocum’tLßd”
::
»que¡
()

178 #ifdeà
SSLAB__DEBUG


179 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

182  
	gm_»que¡
;

185 cÚ¡ 
	gKURL
& 
	gDocum’tLßd”
::
u¾
() const

187 #ifdeà
SSLAB__DEBUG


188 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

191  
»que¡
().
u¾
();

194 
	gDocum’tLßd”
::
»¶aûReque¡URLFÜSameDocum’tNavig©iÚ
(cÚ¡ 
KURL
& 
u¾
)

196 #ifdeà
SSLAB__DEBUG


197 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

200 
	gm_Üigš®Reque¡Cİy
.
£tURL
(
u¾
);

201 
	gm_»que¡
.
£tURL
(
u¾
);

204 
	gDocum’tLßd”
::
£tReque¡
(cÚ¡ 
ResourûReque¡
& 
»q
)

206 #ifdeà
SSLAB__DEBUG


207 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

212 
boŞ
 
	ghªdlšgUÄ—chabËURL
 = 
çl£
;

214 
	ghªdlšgUÄ—chabËURL
 = 
m_sub¡™u‹D©a
.
isV®id
(è&& !m_sub¡™u‹D©a.
çšgURL
().
isEm±y
();

216 ià(
	ghªdlšgUÄ—chabËURL
)

217 
	gm_comm™‹d
 = 
çl£
;

222 
ASSERT
(!
m_comm™‹d
);

224 
KURL
 
	gŞdURL
 = 
m_»que¡
.
u¾
();

225 
	gm_»que¡
 = 
»q
;

229 ià(!
	ghªdlšgUÄ—chabËURL
 && 
	gŞdURL
 !ğ
»q
.
u¾
())

230 
äameLßd”
()->
didReûiveS”v”RedœeùFÜProvisiÚ®LßdFÜF¿me
();

233 
	gDocum’tLßd”
::
£tMašDocum’tE¼Ü
(cÚ¡ 
ResourûE¼Ü
& 
”rÜ
)

235 #ifdeà
SSLAB__DEBUG


236 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

239 
	gm_mašDocum’tE¼Ü
 = 
”rÜ
;

240 
äameLßd”
()->
£tMašDocum’tE¼Ü
(
this
, 
”rÜ
);

243 
	gDocum’tLßd”
::
ş—rE¼Üs
()

245 #ifdeà
SSLAB__DEBUG


246 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

249 
	gm_mašDocum’tE¼Ü
 = 
ResourûE¼Ü
();

252 
	gDocum’tLßd”
::
mašReûivedE¼Ü
(cÚ¡ 
ResourûE¼Ü
& 
”rÜ
, 
boŞ
 
isCom¶‘e
)

254 #ifdeà
SSLAB__DEBUG


255 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

258 
ASSERT
(!
”rÜ
.
isNuÎ
());

260 #ià
ENABLE
(
OFFLINE_WEB_APPLICATIONS
)

261 
	gm_­¶iÿtiÚCacheHo¡
->
çedLßdšgMašResourû
();

264 ià(!
äameLßd”
())

266 
£tMašDocum’tE¼Ü
(
”rÜ
);

267 ià(
	gisCom¶‘e
)

268 
äameLßd”
()->
mašReûivedCom¶‘eE¼Ü
(
this
, 
”rÜ
);

275 
	gDocum’tLßd”
::
¡İLßdšg
(
D©aba£PŞicy
 
d©aba£PŞicy
)

277 #ifdeà
SSLAB__DEBUG


278 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

284 
boŞ
 
	glßdšg
 = 
m_lßdšg
;

286 ià(
	gm_comm™‹d
) {

289 
Docum’t
* 
	gdoc
 = 
m_äame
->
docum’t
();

291 ià(
	glßdšg
 || 
	gdoc
->
·rsšg
())

292 
	gm_äame
->
lßd”
()->
¡İLßdšg
(
UÆßdEv’tPŞicyNÚe
, 
d©aba£PŞicy
);

296 
ÿnûlAÎ
(
m_muÉ¬tSub»sourûLßd”s
);

298 ià(!
	glßdšg
)

301 
	gRefPŒ
<
	gF¿me
> 
´ÙeùF¿me
(
m_äame
);

302 
	gRefPŒ
<
	gDocum’tLßd”
> 
´ÙeùLßd”
(
this
);

304 
	gm_isStİpšg
 = 
Œue
;

306 
F¿meLßd”
* 
	gäameLßd”
 = 
Docum’tLßd”
::
äameLßd”
();

308 ià(
	gm_mašResourûLßd”
)

310 
	gm_mašResourûLßd”
->
ÿnûl
();

311 ià(!
	gm_sub»sourûLßd”s
.
isEm±y
())

314 
£tMašDocum’tE¼Ü
(
äameLßd”
->
ÿnûÎedE¼Ü
(
m_»que¡
));

318 
mašReûivedE¼Ü
(
äameLßd”
->
ÿnûÎedE¼Ü
(
m_»que¡
), 
Œue
);

320 
¡İLßdšgSub»sourûs
();

321 
¡İLßdšgPlugIns
();

323 
	gm_isStİpšg
 = 
çl£
;

326 
	gDocum’tLßd”
::
£tupFÜR•Ïû
()

328 #ifdeà
SSLAB__DEBUG


329 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

332 
äameLßd”
()->
£tupFÜR•Ïû
();

333 
	gm_comm™‹d
 = 
çl£
;

336 
	gDocum’tLßd”
::
comm™IfR—dy
()

338 #ifdeà
SSLAB__DEBUG


339 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

342 ià(
	gm_gÙFœ¡By‹
 && !
	gm_comm™‹d
) {

343 
	gm_comm™‹d
 = 
Œue
;

344 
äameLßd”
()->
comm™ProvisiÚ®Lßd
(0);

348 
	gDocum’tLßd”
::
fšishedLßdšg
()

350 #ifdeà
SSLAB__DEBUG


351 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

354 
	gm_gÙFœ¡By‹
 = 
Œue
;

355 
comm™IfR—dy
();

356 ià(
F¿meLßd”
* 
	glßd”
 = 
äameLßd”
()) {

357 
lßd”
->
fšishedLßdšgDocum’t
(
this
);

358 
	glßd”
->
’d
();

362 
	gDocum’tLßd”
::
comm™Lßd
(cÚ¡ * 
d©a
, 
Ëngth
)

364 #ifdeà
SSLAB__DEBUG


365 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

370 
	gRefPŒ
<
	gDocum’tLßd”
> 
´Ùeù
(
this
);

372 
comm™IfR—dy
();

373 ià(
F¿meLßd”
* 
	gäameLßd”
 = 
Docum’tLßd”
::
äameLßd”
())

374 
äameLßd”
->
comm™‹dLßd
(
this
, 
d©a
, 
Ëngth
);

377 
boŞ
 
	gDocum’tLßd”
::
dÛsProg»ssiveLßd
(cÚ¡ 
SŒšg
& 
MIMETy³
) const

379 #ifdeà
SSLAB__DEBUG


380 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

383  !
äameLßd”
()->
isR•Ïcšg
(è|| 
	gMIMETy³
 == "text/html";

386 
	gDocum’tLßd”
::
»ûivedD©a
(cÚ¡ * 
d©a
, 
Ëngth
)

388 #ifdeà
SSLAB__DEBUG


389 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

392 
	gm_gÙFœ¡By‹
 = 
Œue
;

393 ià(
dÛsProg»ssiveLßd
(
m_»¥Ú£
.
mimeTy³
()))

394 
comm™Lßd
(
d©a
, 
Ëngth
);

397 
	gDocum’tLßd”
::
£tupFÜR•ÏûByMIMETy³
(cÚ¡ 
SŒšg
& 
ÃwMIMETy³
)

399 #ifdeà
SSLAB__DEBUG


400 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

403 ià(!
	gm_gÙFœ¡By‹
)

406 
SŒšg
 
	gŞdMIMETy³
 = 
m_»¥Ú£
.
mimeTy³
();

408 ià(!
dÛsProg»ssiveLßd
(
ŞdMIMETy³
)) {

409 
äameLßd”
()->
»v”tToProvisiÚ®
(
this
);

410 
£tupFÜR•Ïû
();

411 
	gRefPŒ
<
	gSh¬edBufãr
> 
	g»sourûD©a
 = 
mašResourûD©a
();

412 
comm™Lßd
(
»sourûD©a
->
d©a
(),„esourûD©a->
size
());

415 
äameLßd”
()->
fšishedLßdšgDocum’t
(
this
);

416 
	gm_äame
->
lßd”
()->
’d
();

418 
äameLßd”
()->
£tR•Ïcšg
();

419 
	gm_gÙFœ¡By‹
 = 
çl£
;

421 ià(
dÛsProg»ssiveLßd
(
ÃwMIMETy³
)) {

422 
äameLßd”
()->
»v”tToProvisiÚ®
(
this
);

423 
£tupFÜR•Ïû
();

426 
¡İLßdšgSub»sourûs
();

427 
¡İLßdšgPlugIns
();

428 
ş—rArchiveResourûs
();

431 
	gDocum’tLßd”
::
upd©eLßdšg
()

433 #ifdeà
SSLAB__DEBUG


434 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

437 ià(!
	gm_äame
) {

438 
£tLßdšg
(
çl£
);

441 
ASSERT
(
this
 =ğ
äameLßd”
()->
aùiveDocum’tLßd”
());

442 
£tLßdšg
(
äameLßd”
()->
isLßdšg
());

445 
	gDocum’tLßd”
::
£tF¿me
(
F¿me
* 
äame
)

447 #ifdeà
SSLAB__DEBUG


448 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

451 ià(
	gm_äame
 =ğ
äame
)

453 
ASSERT
(
äame
 && !
m_äame
);

454 
	gm_äame
 = 
äame
;

455 
©chToF¿me
();

458 
	gDocum’tLßd”
::
©chToF¿me
()

460 #ifdeà
SSLAB__DEBUG


461 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

464 
ASSERT
(
m_äame
);

467 
	gDocum’tLßd”
::
d‘achFromF¿me
()

469 #ifdeà
SSLAB__DEBUG


470 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

473 
ASSERT
(
m_äame
);

474 #ià
ENABLE
(
OFFLINE_WEB_APPLICATIONS
)

475 
	gm_­¶iÿtiÚCacheHo¡
->
£tDOMAµliÿtiÚCache
(0);

477 
	gm_äame
 = 0;

480 
	gDocum’tLßd”
::
´•¬eFÜLßdS¹
()

482 #ifdeà
SSLAB__DEBUG


483 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

486 
ASSERT
(!
m_isStİpšg
);

487 
£tPrim¬yLßdCom¶‘e
(
çl£
);

488 
ASSERT
(
äameLßd”
());

489 
ş—rE¼Üs
();

491 
£tLßdšg
(
Œue
);

493 
äameLßd”
()->
´•¬eFÜLßdS¹
();

496 
	gDocum’tLßd”
::
£tPrim¬yLßdCom¶‘e
(
boŞ
 
æag
)

498 #ifdeà
SSLAB__DEBUG


499 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

502 
	gm_´im¬yLßdCom¶‘e
 = 
æag
;

503 ià(
	gæag
) {

504 ià(
	gm_mašResourûLßd”
) {

505 
	gm_mašResourûD©a
 = 
m_mašResourûLßd”
->
»sourûD©a
();

506 
	gm_mašResourûLßd”
 = 0;

509 ià(
	gthis
 =ğ
äameLßd”
()->
aùiveDocum’tLßd”
())

510 
upd©eLßdšg
();

514 
boŞ
 
	gDocum’tLßd”
::
isLßdšgInAPIS’£
() const

516 #ifdeà
SSLAB__DEBUG


517 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

522 ià(
äameLßd”
()->
¡©e
(è!ğ
F¿meS‹Com¶‘e
) {

523 ià(!
m_´im¬yLßdCom¶‘e
 && 
isLßdšg
())

524  
Œue
;

525 ià(!
	gm_sub»sourûLßd”s
.
isEm±y
())

526  
	gŒue
;

527 
Docum’t
* 
	gdoc
 = 
m_äame
->
docum’t
();

528 ià(
	gdoc
->
docLßd”
()->
»que¡CouÁ
())

529  
	gŒue
;

530 ià(
Tok’iz”
* 
	gtok
 = 
doc
->
tok’iz”
())

531 ià(
tok
->
´oûssšgD©a
())

532  
Œue
;

534  
äameLßd”
()->
subäameIsLßdšg
();

537 
	gDocum’tLßd”
::
addAÎArchiveResourûs
(
Archive
* 
¬chive
)

539 #ifdeà
SSLAB__DEBUG


540 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

543 ià(!
	gm_¬chiveResourûCŞËùiÚ
)

544 
	gm_¬chiveResourûCŞËùiÚ
.
£t
(
Ãw
 
ArchiveResourûCŞËùiÚ
);

546 
ASSERT
(
¬chive
);

547 ià(!
	g¬chive
)

550 
	gm_¬chiveResourûCŞËùiÚ
->
addAÎResourûs
(
¬chive
);

555 
	gDocum’tLßd”
::
addArchiveResourû
(
PassRefPŒ
<
ArchiveResourû
> 
»sourû
)

557 #ifdeà
SSLAB__DEBUG


558 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

561 ià(!
	gm_¬chiveResourûCŞËùiÚ
)

562 
	gm_¬chiveResourûCŞËùiÚ
.
£t
(
Ãw
 
ArchiveResourûCŞËùiÚ
);

564 
ASSERT
(
»sourû
);

565 ià(!
	g»sourû
)

568 
	gm_¬chiveResourûCŞËùiÚ
->
addResourû
(
»sourû
);

571 
ArchiveResourû
* 
	gDocum’tLßd”
::
¬chiveResourûFÜURL
(cÚ¡ 
KURL
& 
u¾
) const

573 #ifdeà
SSLAB__DEBUG


574 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

577 ià(!
	gm_¬chiveResourûCŞËùiÚ
)

580 
ArchiveResourû
* 
	g»sourû
 = 
m_¬chiveResourûCŞËùiÚ
->
¬chiveResourûFÜURL
(
u¾
);

582  
	g»sourû
 && !»sourû->
shouldIgnÜeWh’UÇrchivšg
() ?„esource : 0;

585 
	gPassRefPŒ
<
	gArchive
> 
	gDocum’tLßd”
::
pİArchiveFÜSubäame
(cÚ¡ 
SŒšg
& 
äameName
)

587 #ifdeà
SSLAB__DEBUG


588 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

591  
	gm_¬chiveResourûCŞËùiÚ
 ? m_¬chiveResourûCŞËùiÚ->
pİSubäameArchive
(
äameName
) : 0;

594 
	gDocum’tLßd”
::
ş—rArchiveResourûs
()

596 #ifdeà
SSLAB__DEBUG


597 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

600 
	gm_¬chiveResourûCŞËùiÚ
.
ş—r
();

601 
	gm_sub¡™u‹ResourûD–iv”yTim”
.
¡İ
();

604 
	gDocum’tLßd”
::
£tP¬£dArchiveD©a
(
PassRefPŒ
<
Sh¬edBufãr
> 
d©a
)

606 #ifdeà
SSLAB__DEBUG


607 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

610 
	gm_·r£dArchiveD©a
 = 
d©a
;

613 
Sh¬edBufãr
* 
	gDocum’tLßd”
::
·r£dArchiveD©a
() const

615 #ifdeà
SSLAB__DEBUG


616 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

619  
	gm_·r£dArchiveD©a
.
g‘
();

622 
	gPassRefPŒ
<
	gArchiveResourû
> 
	gDocum’tLßd”
::
mašResourû
() const

624 #ifdeà
SSLAB__DEBUG


625 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

628 cÚ¡ 
	gResourûRe¥Ú£
& 
	gr
 = 
»¥Ú£
();

629 
	gRefPŒ
<
	gSh¬edBufãr
> 
	gmašResourûBufãr
 = 
mašResourûD©a
();

630 ià(!
	gmašResourûBufãr
)

631 
	gmašResourûBufãr
 = 
Sh¬edBufãr
::
ü—‹
();

633  
	gArchiveResourû
::
ü—‹
(
mašResourûBufãr
, 
r
.
u¾
(),„.
mimeTy³
(),„.
‹xtEncodšgName
(), 
äame
()->
Œ“
()->
Çme
());

636 
	gPassRefPŒ
<
	gArchiveResourû
> 
	gDocum’tLßd”
::
sub»sourû
(cÚ¡ 
KURL
& 
u¾
) const

638 #ifdeà
SSLAB__DEBUG


639 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

642 ià(!
isComm™‹d
())

645 
CachedResourû
* 
	g»sourû
 = 
m_äame
->
docum’t
()->
docLßd”
()->
ÿchedResourû
(
u¾
);

646 ià(!
	g»sourû
 || !»sourû->
isLßded
())

647  
¬chiveResourûFÜURL
(
u¾
);

651 ià(!
	g»sourû
->
makePurg—bË
(
çl£
))

654 
	gRefPŒ
<
	gSh¬edBufãr
> 
	gd©a
 = 
»sourû
->
d©a
();

655 ià(!
	gd©a
)

658  
	gArchiveResourû
::
ü—‹
(
d©a
.
»Ëa£
(), 
u¾
, 
»sourû
->
»¥Ú£
());

661 
	gDocum’tLßd”
::
g‘Sub»sourûs
(
VeùÜ
<
PassRefPŒ
<
ArchiveResourû
> >& 
sub»sourûs
) const

663 #ifdeà
SSLAB__DEBUG


664 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

667 ià(!
isComm™‹d
())

670 
Docum’t
* 
	gdocum’t
 = 
m_äame
->
docum’t
();

672 cÚ¡ 
	gDocLßd”
::
Docum’tResourûM­
& 
®lResourûs
 = 
docum’t
->
docLßd”
()->
®lCachedResourûs
();

673 
	gDocLßd”
::
Docum’tResourûM­
::
cÚ¡_™”©Ü
 
’d
 = 
®lResourûs
.end();

674 
	gDocLßd”
::
Docum’tResourûM­
::
cÚ¡_™”©Ü
 
™
 = 
®lResourûs
.
begš
(); 
	g™
 !ğ
’d
; ++it) {

675 
	gRefPŒ
<
	gArchiveResourû
> 
	gsub»sourû
 = 
this
->
sub»sourû
(
KURL
(
P¬£dURLSŒšg
, 
™
->
£cÚd
->
u¾
()));

676 ià(
	gsub»sourû
)

677 
	gsub»sourûs
.
­³nd
(
sub»sourû
.
»Ëa£
());

683 
	gDocum’tLßd”
::
d–iv”Sub¡™u‹ResourûsAá”D–ay
()

685 #ifdeà
SSLAB__DEBUG


686 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

689 ià(
	gm_³ndšgSub¡™u‹Resourûs
.
isEm±y
())

691 
ASSERT
(
m_äame
 && m_äame->
·ge
());

692 ià(
	gm_äame
->
·ge
()->
deãrsLßdšg
())

694 ià(!
	gm_sub¡™u‹ResourûD–iv”yTim”
.
isAùive
())

695 
	gm_sub¡™u‹ResourûD–iv”yTim”
.
¡¬tOÃShÙ
(0);

698 
	gDocum’tLßd”
::
sub¡™u‹ResourûD–iv”yTim”Fœed
(
Tim”
<
Docum’tLßd”
>*)

700 #ifdeà
SSLAB__DEBUG


701 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

704 ià(
	gm_³ndšgSub¡™u‹Resourûs
.
isEm±y
())

706 
ASSERT
(
m_äame
 && m_äame->
·ge
());

707 ià(
	gm_äame
->
·ge
()->
deãrsLßdšg
())

710 
Sub¡™u‹ResourûM­
 
	gcİy
;

711 
	gcİy
.
sw­
(
m_³ndšgSub¡™u‹Resourûs
);

713 
	gSub¡™u‹ResourûM­
::
cÚ¡_™”©Ü
 
’d
 = 
cİy
.end();

714 
	gSub¡™u‹ResourûM­
::
cÚ¡_™”©Ü
 
™
 = 
cİy
.
begš
(); 
	g™
 !ğ
’d
; ++it) {

715 
	gRefPŒ
<
	gResourûLßd”
> 
	glßd”
 = 
™
->
fœ¡
;

716 
Sub¡™u‹Resourû
* 
	g»sourû
 = 
™
->
£cÚd
.
g‘
();

718 ià(
	g»sourû
) {

719 
Sh¬edBufãr
* 
	gd©a
 = 
»sourû
->
d©a
();

721 
	glßd”
->
didReûiveRe¥Ú£
(
»sourû
->
»¥Ú£
());

722 
	glßd”
->
didReûiveD©a
(
d©a
->d©a(), d©a->
size
(), d©a->size(), 
Œue
);

723 
	glßd”
->
didFšishLßdšg
();

727 
	glßd”
->
didFa
(
lßd”
->
ÿÂÙShowURLE¼Ü
());

732 #iâdeà
NDEBUG


733 
boŞ
 
	gDocum’tLßd”
::
isSub¡™u‹LßdP’dšg
(
ResourûLßd”
* 
lßd”
) const

735 #ifdeà
SSLAB__DEBUG


736 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

739  
	gm_³ndšgSub¡™u‹Resourûs
.
cÚšs
(
lßd”
);

743 
	gDocum’tLßd”
::
ÿnûlP’dšgSub¡™u‹Lßd
(
ResourûLßd”
* 
lßd”
)

745 #ifdeà
SSLAB__DEBUG


746 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

749 ià(
	gm_³ndšgSub¡™u‹Resourûs
.
isEm±y
())

751 
	gm_³ndšgSub¡™u‹Resourûs
.
»move
(
lßd”
);

752 ià(
	gm_³ndšgSub¡™u‹Resourûs
.
isEm±y
())

753 
	gm_sub¡™u‹ResourûD–iv”yTim”
.
¡İ
();

756 
boŞ
 
	gDocum’tLßd”
::
scheduËArchiveLßd
(
ResourûLßd”
* 
lßd”
, cÚ¡ 
ResourûReque¡
& 
»que¡
, cÚ¡ 
KURL
& 
Üigš®URL
)

758 #ifdeà
SSLAB__DEBUG


759 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

762 
ArchiveResourû
* 
	g»sourû
 = 0;

764 ià(
	g»que¡
.
u¾
(è=ğ
Üigš®URL
)

765 
»sourû
 = 
¬chiveResourûFÜURL
(
Üigš®URL
);

767 ià(!
	g»sourû
) {

769 
boŞ
 
	gshouldFaLßd
 = 
m_äame
->
£‰šgs
()->
webArchiveDebugModeEÇbËd
(è&& 
ArchiveFaùÜy
::
isArchiveMimeTy³
(
»¥Ú£MIMETy³
());

771 ià(!
	gshouldFaLßd
)

772  
	gçl£
;

775 
	gm_³ndšgSub¡™u‹Resourûs
.
£t
(
lßd”
, 
»sourû
);

776 
d–iv”Sub¡™u‹ResourûsAá”D–ay
();

778  
	gŒue
;

781 
	gDocum’tLßd”
::
addRe¥Ú£
(cÚ¡ 
ResourûRe¥Ú£
& 
r
)

783 #ifdeà
SSLAB__DEBUG


784 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

787 ià(!
	gm_¡İRecÜdšgRe¥Ú£s
)

788 
	gm_»¥Ú£s
.
­³nd
(
r
);

791 
	gDocum’tLßd”
::
¡İRecÜdšgRe¥Ú£s
()

793 #ifdeà
SSLAB__DEBUG


794 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

797 
	gm_¡İRecÜdšgRe¥Ú£s
 = 
Œue
;

800 
	gDocum’tLßd”
::
£tT™Ë
(cÚ¡ 
SŒšg
& 
t™Ë
)

802 #ifdeà
SSLAB__DEBUG


803 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

806 ià(
	gt™Ë
.
isEm±y
())

809 ià(
	gm_·geT™Ë
 !ğ
t™Ë
) {

810 
äameLßd”
()->
wlChªgeT™Ë
(
this
);

811 
	gm_·geT™Ë
 = 
t™Ë
;

812 
äameLßd”
()->
didChªgeT™Ë
(
this
);

816 
KURL
 
	gDocum’tLßd”
::
u¾FÜHi¡Üy
() const

818 #ifdeà
SSLAB__DEBUG


819 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

825 ià(
	gm_sub¡™u‹D©a
.
isV®id
())

826  
uÄ—chabËURL
();

828  
	gm_Üigš®Reque¡Cİy
.
u¾
();

831 
boŞ
 
	gDocum’tLßd”
::
u¾FÜHi¡ÜyReæeùsFau»
() const

833 #ifdeà
SSLAB__DEBUG


834 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

837  
	gm_sub¡™u‹D©a
.
isV®id
(è|| 
	gm_»¥Ú£
.
h‰pStusCode
() >= 400;

840 cÚ¡ 
	gKURL
& 
	gDocum’tLßd”
::
Üigš®URL
() const

842 #ifdeà
SSLAB__DEBUG


843 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

846  
	gm_Üigš®Reque¡Cİy
.
u¾
();

849 cÚ¡ 
	gKURL
& 
	gDocum’tLßd”
::
»que¡URL
() const

851 #ifdeà
SSLAB__DEBUG


852 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

855  
»que¡
().
u¾
();

858 cÚ¡ 
	gKURL
& 
	gDocum’tLßd”
::
»¥Ú£URL
() const

860 #ifdeà
SSLAB__DEBUG


861 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

864  
	gm_»¥Ú£
.
u¾
();

867 cÚ¡ 
	gSŒšg
& 
	gDocum’tLßd”
::
»¥Ú£MIMETy³
() const

869 #ifdeà
SSLAB__DEBUG


870 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

873  
	gm_»¥Ú£
.
mimeTy³
();

876 cÚ¡ 
	gKURL
& 
	gDocum’tLßd”
::
uÄ—chabËURL
() const

878 #ifdeà
SSLAB__DEBUG


879 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

882  
	gm_sub¡™u‹D©a
.
çšgURL
();

885 
	gDocum’tLßd”
::
£tDeãrsLßdšg
(
boŞ
 
deãrs
)

887 #ifdeà
SSLAB__DEBUG


888 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

891 ià(
	gm_mašResourûLßd”
)

892 
	gm_mašResourûLßd”
->
£tDeãrsLßdšg
(
deãrs
);

893 
£tAÎDeãrsLßdšg
(
m_sub»sourûLßd”s
, 
deãrs
);

894 
£tAÎDeãrsLßdšg
(
m_¶ugInSŒ—mLßd”s
, 
deãrs
);

895 ià(!
	gdeãrs
)

896 
d–iv”Sub¡™u‹ResourûsAá”D–ay
();

899 
	gDocum’tLßd”
::
¡İLßdšgPlugIns
()

901 #ifdeà
SSLAB__DEBUG


902 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

905 
ÿnûlAÎ
(
m_¶ugInSŒ—mLßd”s
);

908 
	gDocum’tLßd”
::
¡İLßdšgSub»sourûs
()

910 #ifdeà
SSLAB__DEBUG


911 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

914 
ÿnûlAÎ
(
m_sub»sourûLßd”s
);

917 
	gDocum’tLßd”
::
addSub»sourûLßd”
(
ResourûLßd”
* 
lßd”
)

919 #ifdeà
SSLAB__DEBUG


920 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

923 
	gm_sub»sourûLßd”s
.
add
(
lßd”
);

924 
£tLßdšg
(
Œue
);

927 
	gDocum’tLßd”
::
»moveSub»sourûLßd”
(
ResourûLßd”
* 
lßd”
)

929 #ifdeà
SSLAB__DEBUG


930 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

933 
	gm_sub»sourûLßd”s
.
»move
(
lßd”
);

934 
upd©eLßdšg
();

935 ià(
F¿me
* 
	gäame
 = 
m_äame
)

936 
äame
->
lßd”
()->
checkLßdCom¶‘e
();

939 
	gDocum’tLßd”
::
addPlugInSŒ—mLßd”
(
ResourûLßd”
* 
lßd”
)

941 #ifdeà
SSLAB__DEBUG


942 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

945 
	gm_¶ugInSŒ—mLßd”s
.
add
(
lßd”
);

946 
£tLßdšg
(
Œue
);

949 
	gDocum’tLßd”
::
»movePlugInSŒ—mLßd”
(
ResourûLßd”
* 
lßd”
)

951 #ifdeà
SSLAB__DEBUG


952 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

955 
	gm_¶ugInSŒ—mLßd”s
.
»move
(
lßd”
);

956 
upd©eLßdšg
();

959 
boŞ
 
	gDocum’tLßd”
::
isLßdšgMašResourû
() const

961 #ifdeà
SSLAB__DEBUG


962 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

965  !!
	gm_mašResourûLßd”
;

968 
boŞ
 
	gDocum’tLßd”
::
isLßdšgSub»sourûs
() const

970 #ifdeà
SSLAB__DEBUG


971 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

974  !
	gm_sub»sourûLßd”s
.
isEm±y
();

977 
boŞ
 
	gDocum’tLßd”
::
isLßdšgPlugIns
() const

979 #ifdeà
SSLAB__DEBUG


980 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

983  !
	gm_¶ugInSŒ—mLßd”s
.
isEm±y
();

986 
boŞ
 
	gDocum’tLßd”
::
isLßdšgMuÉ¬tCÚ‹Á
() const

988 #ifdeà
SSLAB__DEBUG


989 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

992  
	gm_mašResourûLßd”
 && m_mašResourûLßd”->
isLßdšgMuÉ¬tCÚ‹Á
();

995 
boŞ
 
	gDocum’tLßd”
::
¡¬tLßdšgMašResourû
(
id’tif›r
)

997 #ifdeà
SSLAB__DEBUG


998 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

1001 
ASSERT
(!
m_mašResourûLßd”
);

1002 
	gm_mašResourûLßd”
 = 
MašResourûLßd”
::
ü—‹
(
m_äame
);

1003 
	gm_mašResourûLßd”
->
£tId’tif›r
(
id’tif›r
);

1007 
äameLßd”
()->
addExŒaF›ldsToMašResourûReque¡
(
m_»que¡
);

1009 ià(!
	gm_mašResourûLßd”
->
lßd
(
m_»que¡
, 
m_sub¡™u‹D©a
)) {

1012 
LOG_ERROR
("could‚Ù c»©WebResourûHªdË fÜ URL % -- should bÿughˆby…Şicy hªdË¸Ëv–", 
m_»que¡
.
u¾
().
¡ršg
().
ascii
().
d©a
());

1013 
	gm_mašResourûLßd”
 = 0;

1014  
	gçl£
;

1017  
	gŒue
;

1020 
	gDocum’tLßd”
::
ÿnûlMašResourûLßd
(cÚ¡ 
ResourûE¼Ü
& 
”rÜ
)

1022 #ifdeà
SSLAB__DEBUG


1023 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

1026 
	gm_mašResourûLßd”
->
ÿnûl
(
”rÜ
);

1029 
	gDocum’tLßd”
::
sub»sourûLßd”FšishedLßdšgOÃP¬t
(
ResourûLßd”
* 
lßd”
)

1031 #ifdeà
SSLAB__DEBUG


1032 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

1035 
	gm_muÉ¬tSub»sourûLßd”s
.
add
(
lßd”
);

1036 
	gm_sub»sourûLßd”s
.
»move
(
lßd”
);

1037 
upd©eLßdšg
();

1038 ià(
F¿me
* 
	gäame
 = 
m_äame
)

1039 
äame
->
lßd”
()->
checkLßdCom¶‘e
();

1042 
	gDocum’tLßd”
::
icÚLßdDecisiÚAvaabË
()

1044 #ifdeà
SSLAB__DEBUG


1045 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

1048 ià(
	gm_äame
)

1049 
	gm_äame
->
lßd”
()->
icÚLßdDecisiÚAvaabË
();

	@DocumentLoader.h

29 #iâdeà
Docum’tLßd”_h


30 
	#Docum’tLßd”_h


	)

32 
	~"Navig©iÚAùiÚ.h
"

33 
	~"ResourûE¼Ü.h
"

34 
	~"ResourûReque¡.h
"

35 
	~"ResourûRe¥Ú£.h
"

36 
	~"Sub¡™u‹D©a.h
"

37 
	~"Tim”.h
"

39 
Çme¥aû
 
	gWebCÜe
 {

41 
şass
 
	gAµliÿtiÚCacheHo¡
;

42 
şass
 
	gArchive
;

43 
şass
 
	gArchiveResourû
;

44 
şass
 
	gArchiveResourûCŞËùiÚ
;

45 
şass
 
	gF¿me
;

46 
şass
 
	gF¿meLßd”
;

47 
şass
 
	gMašResourûLßd”
;

48 
şass
 
	gResourûLßd”
;

49 
şass
 
	gScheduËPaœ
;

50 
şass
 
	gSh¬edBufãr
;

51 
şass
 
	gSub¡™u‹Resourû
;

53 
	gHashS‘
<
	tRefPŒ
<
	tResourûLßd”
> > 
	tResourûLßd”S‘
;

54 
	gVeùÜ
<
	tResourûRe¥Ú£
> 
	tRe¥Ú£VeùÜ
;

56 
şass
 
	gDocum’tLßd”
 : 
public
 
RefCouÁed
<
Docum’tLßd”
> {

57 
public
:

58 
PassRefPŒ
<
Docum’tLßd”
> 
ü—‹
(cÚ¡ 
ResourûReque¡
& 
»que¡
, cÚ¡ 
Sub¡™u‹D©a
& 
d©a
)

60  
adİtRef
(
Ãw
 
Docum’tLßd”
(
»que¡
, 
d©a
));

62 
	gvœtu®
 ~
Docum’tLßd”
();

64 
£tF¿me
(
F¿me
*);

65 
F¿me
* 
äame
(ècÚ¡ {  
	gm_äame
; }

67 
vœtu®
 
©chToF¿me
();

68 
vœtu®
 
d‘achFromF¿me
();

70 
F¿meLßd”
* 
äameLßd”
() const;

71 
MašResourûLßd”
* 
mašResourûLßd”
(ècÚ¡ {  
	gm_mašResourûLßd”
.
g‘
(); }

72 
	gPassRefPŒ
<
	gSh¬edBufãr
> 
mašResourûD©a
() const;

74 cÚ¡ 
	gResourûReque¡
& 
Üigš®Reque¡
() const;

75 cÚ¡ 
	gResourûReque¡
& 
Üigš®Reque¡Cİy
() const;

77 cÚ¡ 
	gResourûReque¡
& 
»que¡
() const;

78 
	gResourûReque¡
& 
»que¡
();

79 
£tReque¡
(cÚ¡ 
ResourûReque¡
&);

81 cÚ¡ 
	gSub¡™u‹D©a
& 
sub¡™u‹D©a
(ècÚ¡ {  
	gm_sub¡™u‹D©a
; }

83 cÚ¡ 
	gKURL
& 
u¾
() const;

84 cÚ¡ 
	gKURL
& 
uÄ—chabËURL
() const;

86 cÚ¡ 
	gKURL
& 
Üigš®URL
() const;

87 cÚ¡ 
	gKURL
& 
»que¡URL
() const;

88 cÚ¡ 
	gKURL
& 
»¥Ú£URL
() const;

89 cÚ¡ 
	gSŒšg
& 
»¥Ú£MIMETy³
() const;

91 
»¶aûReque¡URLFÜSameDocum’tNavig©iÚ
(cÚ¡ 
KURL
&);

92 
boŞ
 
isStİpšg
(ècÚ¡ {  
	gm_isStİpšg
; }

93 
¡İLßdšg
(
D©aba£PŞicy
 = 
D©aba£PŞicyStİ
);

94 
£tComm™‹d
(
boŞ
 
comm™‹d
è{ 
	gm_comm™‹d
 = committed; }

95 
boŞ
 
isComm™‹d
(ècÚ¡ {  
	gm_comm™‹d
; }

96 
boŞ
 
isLßdšg
(ècÚ¡ {  
	gm_lßdšg
; }

97 
£tLßdšg
(
boŞ
 
lßdšg
è{ 
	gm_lßdšg
 =†oading; }

98 
upd©eLßdšg
();

99 
»ûivedD©a
(const *, );

100 
£tupFÜR•ÏûByMIMETy³
(cÚ¡ 
SŒšg
& 
ÃwMIMETy³
);

101 
fšishedLßdšg
();

102 cÚ¡ 
	gResourûRe¥Ú£
& 
»¥Ú£
(ècÚ¡ {  
	gm_»¥Ú£
; }

103 cÚ¡ 
	gResourûE¼Ü
& 
mašDocum’tE¼Ü
(ècÚ¡ {  
	gm_mašDocum’tE¼Ü
; }

104 
mašReûivedE¼Ü
(cÚ¡ 
ResourûE¼Ü
&, 
boŞ
 
isCom¶‘e
);

105 
£tRe¥Ú£
(cÚ¡ 
ResourûRe¥Ú£
& 
»¥Ú£
è{ 
	gm_»¥Ú£
 =„esponse; }

106 
´•¬eFÜLßdS¹
();

107 
boŞ
 
isCl›ÁRedœeù
(ècÚ¡ {  
	gm_isCl›ÁRedœeù
; }

108 
£tIsCl›ÁRedœeù
(
boŞ
 
isCl›ÁRedœeù
è{ 
	gm_isCl›ÁRedœeù
 = isClientRedirect; }

109 
boŞ
 
isLßdšgInAPIS’£
() const;

110 
£tPrim¬yLßdCom¶‘e
(
boŞ
);

111 
£tT™Ë
(cÚ¡ 
SŒšg
&);

112 cÚ¡ 
	gSŒšg
& 
ov”rideEncodšg
(ècÚ¡ {  
	gm_ov”rideEncodšg
; }

114 #ià
PLATFORM
(
MAC
)

115 
scheduË
(
ScheduËPaœ
*);

116 
unscheduË
(
ScheduËPaœ
*);

119 
addAÎArchiveResourûs
(
Archive
*);

120 
addArchiveResourû
(
PassRefPŒ
<
ArchiveResourû
>);

124 
	gPassRefPŒ
<
	gArchiveResourû
> 
sub»sourû
(cÚ¡ 
KURL
&) const;

126 
ArchiveResourû
* 
¬chiveResourûFÜURL
(cÚ¡ 
KURL
&) const;

128 
	gPassRefPŒ
<
	gArchive
> 
pİArchiveFÜSubäame
(cÚ¡ 
SŒšg
& 
äameName
);

129 
ş—rArchiveResourûs
();

130 
£tP¬£dArchiveD©a
(
PassRefPŒ
<
Sh¬edBufãr
>);

131 
Sh¬edBufãr
* 
·r£dArchiveD©a
() const;

133 
	gPassRefPŒ
<
	gArchiveResourû
> 
mašResourû
() const;

134 
g‘Sub»sourûs
(
VeùÜ
<
PassRefPŒ
<
ArchiveResourû
> >&) const;

136 
boŞ
 
scheduËArchiveLßd
(
ResourûLßd”
*, cÚ¡ 
ResourûReque¡
&, cÚ¡ 
KURL
&);

137 #iâdeà
NDEBUG


138 
boŞ
 
isSub¡™u‹LßdP’dšg
(
ResourûLßd”
*) const;

140 
ÿnûlP’dšgSub¡™u‹Lßd
(
ResourûLßd”
*);

142 
addRe¥Ú£
(cÚ¡ 
ResourûRe¥Ú£
&);

143 cÚ¡ 
	gRe¥Ú£VeùÜ
& 
»¥Ú£s
(ècÚ¡ {  
	gm_»¥Ú£s
; }

145 cÚ¡ 
	gNavig©iÚAùiÚ
& 
Œigg”šgAùiÚ
(ècÚ¡ {  
	gm_Œigg”šgAùiÚ
; }

146 
£tTrigg”šgAùiÚ
(cÚ¡ 
Navig©iÚAùiÚ
& 
aùiÚ
è{ 
	gm_Œigg”šgAùiÚ
 =‡ction; }

147 
£tOv”rideEncodšg
(cÚ¡ 
SŒšg
& 
’codšg
è{ 
	gm_ov”rideEncodšg
 =ƒncoding; }

148 
£tLa¡CheckedReque¡
(cÚ¡ 
ResourûReque¡
& 
»que¡
è{ 
	gm_Ï¡CheckedReque¡
 =„equest; }

149 cÚ¡ 
	gResourûReque¡
& 
Ï¡CheckedReque¡
(è{  
	gm_Ï¡CheckedReque¡
; }

151 
¡İRecÜdšgRe¥Ú£s
();

152 cÚ¡ 
	gSŒšg
& 
t™Ë
(ècÚ¡ {  
	gm_·geT™Ë
; }

154 
KURL
 
u¾FÜHi¡Üy
() const;

155 
boŞ
 
u¾FÜHi¡ÜyReæeùsFau»
() const;

162 
SŒšg
 
ş›ÁRedœeùSourûFÜHi¡Üy
(ècÚ¡ {  
	gm_ş›ÁRedœeùSourûFÜHi¡Üy
; }

163 
SŒšg
 
ş›ÁRedœeùDe¡š©iÚFÜHi¡Üy
(ècÚ¡ {  
u¾FÜHi¡Üy
(); }

164 
£tCl›ÁRedœeùSourûFÜHi¡Üy
(cÚ¡ 
SŒšg
& 
ş›ÁedœeùSourûFÜHi¡Üy
è{ 
	gm_ş›ÁRedœeùSourûFÜHi¡Üy
 = clientedirectSourceForHistory; }

166 
SŒšg
 
£rv”RedœeùSourûFÜHi¡Üy
(ècÚ¡ {  
u¾FÜHi¡Üy
(è=ğ
u¾
() ? String() : urlForHistory(); }

167 
SŒšg
 
£rv”RedœeùDe¡š©iÚFÜHi¡Üy
(ècÚ¡ {  
u¾
(); }

169 
boŞ
 
didC»©eGlob®Hi¡ÜyEÁry
(ècÚ¡ {  
	gm_didC»©eGlob®Hi¡ÜyEÁry
; }

170 
£tDidC»©eGlob®Hi¡ÜyEÁry
(
boŞ
 
didC»©eGlob®Hi¡ÜyEÁry
è{ 
	gm_didC»©eGlob®Hi¡ÜyEÁry
 = didCreateGlobalHistoryEntry; }

172 
£tDeãrsLßdšg
(
boŞ
);

174 
boŞ
 
¡¬tLßdšgMašResourû
(
id’tif›r
);

175 
ÿnûlMašResourûLßd
(cÚ¡ 
ResourûE¼Ü
&);

177 
icÚLßdDecisiÚAvaabË
();

179 
boŞ
 
isLßdšgMašResourû
() const;

180 
boŞ
 
isLßdšgSub»sourûs
() const;

181 
boŞ
 
isLßdšgPlugIns
() const;

182 
boŞ
 
isLßdšgMuÉ¬tCÚ‹Á
() const;

184 
¡İLßdšgPlugIns
();

185 
¡İLßdšgSub»sourûs
();

187 
addSub»sourûLßd”
(
ResourûLßd”
*);

188 
»moveSub»sourûLßd”
(
ResourûLßd”
*);

189 
addPlugInSŒ—mLßd”
(
ResourûLßd”
*);

190 
»movePlugInSŒ—mLßd”
(
ResourûLßd”
*);

192 
sub»sourûLßd”FšishedLßdšgOÃP¬t
(
ResourûLßd”
*);

194 
£tDeãrMašResourûD©aLßd
(
boŞ
 
deãr
è{ 
	gm_deãrMašResourûD©aLßd
 = defer; }

195 
boŞ
 
deãrMašResourûD©aLßd
(ècÚ¡ {  
	gm_deãrMašResourûD©aLßd
; }

197 
didT–lCl›ÁAboutLßd
(cÚ¡ 
SŒšg
& 
u¾
è{ 
	gm_»sourûsCl›ÁKnowsAbout
.
add
(url); }

198 
boŞ
 
haveTŞdCl›ÁAboutLßd
(cÚ¡ 
SŒšg
& 
u¾
è{  
	gm_»sourûsCl›ÁKnowsAbout
.
cÚšs
(url); }

199 
»cÜdMemÜyCacheLßdFÜFutu»Cl›ÁNÙifiÿtiÚ
(cÚ¡ 
SŒšg
& 
u¾
);

200 
keMemÜyCacheLßdsFÜCl›ÁNÙifiÿtiÚ
(
VeùÜ
<
SŒšg
>& 
lßds
);

202 #ià
ENABLE
(
OFFLINE_WEB_APPLICATIONS
)

203 
AµliÿtiÚCacheHo¡
* 
­¶iÿtiÚCacheHo¡
(ècÚ¡ {  
	gm_­¶iÿtiÚCacheHo¡
.
g‘
(); }

206 
	g´Ùeùed
:

207 
Docum’tLßd”
(cÚ¡ 
ResourûReque¡
&, cÚ¡ 
Sub¡™u‹D©a
&);

209 
boŞ
 
	gm_deãrMašResourûD©aLßd
;

211 
	g´iv©e
:

212 
£tupFÜR•Ïû
();

213 
comm™IfR—dy
();

214 
ş—rE¼Üs
();

215 
£tMašDocum’tE¼Ü
(cÚ¡ 
ResourûE¼Ü
&);

216 
comm™Lßd
(const *, );

217 
boŞ
 
dÛsProg»ssiveLßd
(cÚ¡ 
SŒšg
& 
MIMETy³
) const;

219 
d–iv”Sub¡™u‹ResourûsAá”D–ay
();

220 
sub¡™u‹ResourûD–iv”yTim”Fœed
(
Tim”
<
Docum’tLßd”
>*);

222 
F¿me
* 
	gm_äame
;

224 
	gRefPŒ
<
	gMašResourûLßd”
> 
	gm_mašResourûLßd”
;

225 
ResourûLßd”S‘
 
	gm_sub»sourûLßd”s
;

226 
ResourûLßd”S‘
 
	gm_muÉ¬tSub»sourûLßd”s
;

227 
ResourûLßd”S‘
 
	gm_¶ugInSŒ—mLßd”s
;

229 
	gRefPŒ
<
	gSh¬edBufãr
> 
	gm_mašResourûD©a
;

235 
ResourûReque¡
 
	gm_Üigš®Reque¡
;

237 
Sub¡™u‹D©a
 
	gm_sub¡™u‹D©a
;

241 
ResourûReque¡
 
	gm_Üigš®Reque¡Cİy
;

246 
ResourûReque¡
 
	gm_»que¡
;

248 
ResourûRe¥Ú£
 
	gm_»¥Ú£
;

250 
ResourûE¼Ü
 
	gm_mašDocum’tE¼Ü
;

252 
boŞ
 
	gm_comm™‹d
;

253 
boŞ
 
	gm_isStİpšg
;

254 
boŞ
 
	gm_lßdšg
;

255 
boŞ
 
	gm_gÙFœ¡By‹
;

256 
boŞ
 
	gm_´im¬yLßdCom¶‘e
;

257 
boŞ
 
	gm_isCl›ÁRedœeù
;

259 
SŒšg
 
	gm_·geT™Ë
;

261 
SŒšg
 
	gm_ov”rideEncodšg
;

265 
Navig©iÚAùiÚ
 
	gm_Œigg”šgAùiÚ
;

269 
ResourûReque¡
 
	gm_Ï¡CheckedReque¡
;

274 
Re¥Ú£VeùÜ
 
	gm_»¥Ú£s
;

275 
boŞ
 
	gm_¡İRecÜdšgRe¥Ú£s
;

277 
	gHashM­
<
	tRefPŒ
<
	tResourûLßd”
>, RefPŒ<
	tSub¡™u‹Resourû
> > 
	tSub¡™u‹ResourûM­
;

278 
Sub¡™u‹ResourûM­
 
	gm_³ndšgSub¡™u‹Resourûs
;

279 
	gTim”
<
	gDocum’tLßd”
> 
	gm_sub¡™u‹ResourûD–iv”yTim”
;

281 
	gOwnPŒ
<
	gArchiveResourûCŞËùiÚ
> 
	gm_¬chiveResourûCŞËùiÚ
;

282 
	gRefPŒ
<
	gSh¬edBufãr
> 
	gm_·r£dArchiveD©a
;

284 
	gHashS‘
<
	gSŒšg
> 
	gm_»sourûsCl›ÁKnowsAbout
;

285 
	gVeùÜ
<
	gSŒšg
> 
	gm_»sourûsLßdedFromMemÜyCacheFÜCl›ÁNÙifiÿtiÚ
;

287 
SŒšg
 
	gm_ş›ÁRedœeùSourûFÜHi¡Üy
;

288 
boŞ
 
	gm_didC»©eGlob®Hi¡ÜyEÁry
;

290 #ià
ENABLE
(
OFFLINE_WEB_APPLICATIONS
)

291 
ä›nd
 
şass
 
	gAµliÿtiÚCacheHo¡
;

292 
	gOwnPŒ
<
	gAµliÿtiÚCacheHo¡
> 
	gm_­¶iÿtiÚCacheHo¡
;

296 
šlše
 
	gDocum’tLßd”
::
»cÜdMemÜyCacheLßdFÜFutu»Cl›ÁNÙifiÿtiÚ
(cÚ¡ 
SŒšg
& 
u¾
)

298 
m_»sourûsLßdedFromMemÜyCacheFÜCl›ÁNÙifiÿtiÚ
.
­³nd
(
u¾
);

301 
šlše
 
	gDocum’tLßd”
::
keMemÜyCacheLßdsFÜCl›ÁNÙifiÿtiÚ
(
VeùÜ
<
SŒšg
>& 
lßdsS‘
)

303 
lßdsS‘
.
sw­
(
m_»sourûsLßdedFromMemÜyCacheFÜCl›ÁNÙifiÿtiÚ
);

304 
	gm_»sourûsLßdedFromMemÜyCacheFÜCl›ÁNÙifiÿtiÚ
.
ş—r
();

	@DocumentThreadableLoader.cpp

2 #ifdeà
SSLAB__DEBUG


3 #iâdeà
SSLAB__QDATETIME


4 
	#SSLAB__QDATETIME


	)

5 
	~<QD©eTime
>

9 #ifdeà
SSLAB__DEBUG


10 #iâdeà
SSLAB__QTHREAD


11 
	#SSLAB__QTHREAD


	)

12 
	~<QTh»ad
>

45 
	~"cÚfig.h
"

46 
	~"Docum’tTh»adabËLßd”.h
"

48 
	~"Auth’tiÿtiÚCh®Ënge.h
"

49 
	~"CrossOrigšAcûssCÚŒŞ.h
"

50 
	~"CrossOrigšP»æightResuÉCache.h
"

51 
	~"Docum’t.h
"

52 
	~"F¿me.h
"

53 
	~"F¿meLßd”.h
"

54 
	~"ResourûReque¡.h
"

55 
	~"Secur™yOrigš.h
"

56 
	~"Sub»sourûLßd”.h
"

57 
	~"Th»adabËLßd”Cl›Á.h
"

59 
Çme¥aû
 
	gWebCÜe
 {

61 
	gDocum’tTh»adabËLßd”
::
lßdResourûSynchrÚou¦y
(
Docum’t
* 
docum’t
, cÚ¡ 
ResourûReque¡
& 
»que¡
, 
Th»adabËLßd”Cl›Á
& 
ş›Á
, cÚ¡ 
Th»adabËLßd”O±iÚs
& 
İtiÚs
)

63 #ifdeà
SSLAB__DEBUG


64 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

68 
	gRefPŒ
<
	gDocum’tTh»adabËLßd”
> 
	glßd”
 = 
adİtRef
(
Ãw
 
Docum’tTh»adabËLßd”
(
docum’t
, &
ş›Á
, 
LßdSynchrÚou¦y
, 
»que¡
, 
İtiÚs
));

69 
ASSERT
(
lßd”
->
hasOÃRef
());

72 
	gPassRefPŒ
<
	gDocum’tTh»adabËLßd”
> Docum’tTh»adabËLßd”::
ü—‹
(
Docum’t
* 
docum’t
, 
Th»adabËLßd”Cl›Á
* 
ş›Á
, cÚ¡ 
ResourûReque¡
& 
»que¡
, cÚ¡ 
Th»adabËLßd”O±iÚs
& 
İtiÚs
)

74 #ifdeà
SSLAB__DEBUG


75 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

78 
	gRefPŒ
<
	gDocum’tTh»adabËLßd”
> 
	glßd”
 = 
adİtRef
(
Ãw
 
Docum’tTh»adabËLßd”
(
docum’t
, 
ş›Á
, 
LßdAsynchrÚou¦y
, 
»que¡
, 
İtiÚs
));

79 ià(!
	glßd”
->
	gm_lßd”
)

80 
	glßd”
 = 0;

81  
	glßd”
.
»Ëa£
();

84 
	gDocum’tTh»adabËLßd”
::
Docum’tTh»adabËLßd”
(
Docum’t
* 
docum’t
, 
Th»adabËLßd”Cl›Á
* 
ş›Á
, 
BlockšgBehaviÜ
 
blockšgBehaviÜ
, cÚ¡ 
ResourûReque¡
& 
»que¡
, cÚ¡ 
Th»adabËLßd”O±iÚs
& 
İtiÚs
)

85 : 
m_ş›Á
(
ş›Á
)

86 , 
m_docum’t
(
docum’t
)

87 , 
m_İtiÚs
(
İtiÚs
)

88 , 
m_§meOrigšReque¡
(
docum’t
->
£cur™yOrigš
()->
ÿnReque¡
(
»que¡
.
u¾
()))

89 , 
m_async
(
blockšgBehaviÜ
 =ğ
LßdAsynchrÚou¦y
)

91 
ASSERT
(
docum’t
);

92 
ASSERT
(
ş›Á
);

94 ià(
	gm_§meOrigšReque¡
 || 
	gm_İtiÚs
.
	güossOrigšReque¡PŞicy
 =ğ
AÎowCrossOrigšReque¡s
) {

95 
lßdReque¡
(
»que¡
, 
DoSecur™yCheck
);

99 ià(
	gm_İtiÚs
.
	güossOrigšReque¡PŞicy
 =ğ
D’yCrossOrigšReque¡s
) {

100 
m_ş›Á
->
didFa
(
ResourûE¼Ü
());

104 
ASSERT
(
m_İtiÚs
.
üossOrigšReque¡PŞicy
 =ğ
U£AcûssCÚŒŞ
);

106 
	gOwnPŒ
<
	gResourûReque¡
> 
üossOrigšReque¡
(
Ãw
 
ResourûReque¡
(
»que¡
));

107 
	güossOrigšReque¡
->
»moveC»d’tŸls
();

108 
	güossOrigšReque¡
->
£tAÎowCook›s
(
m_İtiÚs
.
®lowC»d’tŸls
);

110 ià(!
	gm_İtiÚs
.
	gfÜûP»æight
 && 
isSim¶eCrossOrigšAcûssReque¡
(
üossOrigšReque¡
->
h‰pM‘hod
(), crossOrigšReque¡->
h‰pH—d”F›lds
()))

111 
makeSim¶eCrossOrigšAcûssReque¡
(*
üossOrigšReque¡
);

113 
	gm_aùu®Reque¡
.
£t
(
üossOrigšReque¡
.
»Ëa£
());

115 ià(
	gCrossOrigšP»æightResuÉCache
::
sh¬ed
().
ÿnSkP»æight
(
docum’t
->
£cur™yOrigš
()->
toSŒšg
(), 
m_aùu®Reque¡
->
u¾
(), 
m_İtiÚs
.
®lowC»d’tŸls
, m_aùu®Reque¡->
h‰pM‘hod
(), m_aùu®Reque¡->
h‰pH—d”F›lds
()))

116 
´eæightSucûss
();

118 
makeCrossOrigšAcûssReque¡W™hP»æight
(*
m_aùu®Reque¡
);

122 
	gDocum’tTh»adabËLßd”
::
makeSim¶eCrossOrigšAcûssReque¡
(cÚ¡ 
ResourûReque¡
& 
»que¡
)

124 #ifdeà
SSLAB__DEBUG


125 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

128 
ASSERT
(
isSim¶eCrossOrigšAcûssReque¡
(
»que¡
.
h‰pM‘hod
(),„eque¡.
h‰pH—d”F›lds
()));

131 ià(!
	g»que¡
.
u¾
().
´ÙocŞInHTTPFamy
()) {

132 
	gm_ş›Á
->
didFa
(
ResourûE¼Ü
());

137 
ResourûReque¡
 
üossOrigšReque¡
(
»que¡
);

138 
	güossOrigšReque¡
.
£tHTTPOrigš
(
m_docum’t
->
£cur™yOrigš
()->
toSŒšg
());

140 
lßdReque¡
(
üossOrigšReque¡
, 
DoSecur™yCheck
);

143 
	gDocum’tTh»adabËLßd”
::
makeCrossOrigšAcûssReque¡W™hP»æight
(cÚ¡ 
ResourûReque¡
& 
»que¡
)

145 #ifdeà
SSLAB__DEBUG


146 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

149 
ResourûReque¡
 
´eæightReque¡
(
»que¡
.
u¾
());

150 
	g´eæightReque¡
.
»moveC»d’tŸls
();

151 
	g´eæightReque¡
.
£tHTTPOrigš
(
m_docum’t
->
£cur™yOrigš
()->
toSŒšg
());

152 
	g´eæightReque¡
.
£tAÎowCook›s
(
m_İtiÚs
.
®lowC»d’tŸls
);

153 
	g´eæightReque¡
.
£tHTTPM‘hod
("OPTIONS");

154 
	g´eæightReque¡
.
£tHTTPH—d”F›ld
("Acûss-CÚŒŞ-Reque¡-M‘hod", 
»que¡
.
h‰pM‘hod
());

156 cÚ¡ 
	gHTTPH—d”M­
& 
	g»que¡H—d”F›lds
 = 
»que¡
.
h‰pH—d”F›lds
();

158 ià(
	g»que¡H—d”F›lds
.
size
() > 0) {

159 
	gVeùÜ
<
	gUCh¬
> 
	gh—d”Bufãr
;

160 
	gHTTPH—d”M­
::
cÚ¡_™”©Ü
 
™
 = 
»que¡H—d”F›lds
.
begš
();

161 
­³nd
(
h—d”Bufãr
, 
™
->
fœ¡
);

162 ++
	g™
;

164 
	gHTTPH—d”M­
::
cÚ¡_™”©Ü
 
’d
 = 
»que¡H—d”F›lds
.end();

165 ; 
	g™
 !ğ
’d
; ++it) {

166 
	gh—d”Bufãr
.
­³nd
(',');

167 
	gh—d”Bufãr
.
­³nd
(' ');

168 
­³nd
(
h—d”Bufãr
, 
™
->
fœ¡
);

171 
	g´eæightReque¡
.
£tHTTPH—d”F›ld
("Acûss-CÚŒŞ-Reque¡-H—d”s", 
SŒšg
::
adİt
(
h—d”Bufãr
));

174 
lßdReque¡
(
´eæightReque¡
, 
DoSecur™yCheck
);

177 
	gDocum’tTh»adabËLßd”
::~
Docum’tTh»adabËLßd”
()

179 #ifdeà
SSLAB__DEBUG


180 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

183 ià(
	gm_lßd”
)

184 
	gm_lßd”
->
ş—rCl›Á
();

187 
	gDocum’tTh»adabËLßd”
::
ÿnûl
()

189 #ifdeà
SSLAB__DEBUG


190 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

193 ià(!
	gm_lßd”
)

196 
	gm_lßd”
->
ÿnûl
();

197 
	gm_lßd”
->
ş—rCl›Á
();

198 
	gm_lßd”
 = 0;

199 
	gm_ş›Á
 = 0;

202 
	gDocum’tTh»adabËLßd”
::
wlS’dReque¡
(
Sub»sourûLßd”
* 
lßd”
, 
ResourûReque¡
& 
»que¡
, cÚ¡ 
ResourûRe¥Ú£
&)

204 #ifdeà
SSLAB__DEBUG


205 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

208 
ASSERT
(
m_ş›Á
);

209 
ASSERT_UNUSED
(
lßd”
,†ßd” =ğ
m_lßd”
);

211 ià(!
isAÎowedRedœeù
(
»que¡
.
u¾
())) {

212 
	gRefPŒ
<
	gDocum’tTh»adabËLßd”
> 
´Ùeù
(
this
);

213 
	gm_ş›Á
->
didFaRedœeùCheck
();

214 
	g»que¡
 = 
ResourûReque¡
();

218 
	gDocum’tTh»adabËLßd”
::
didS’dD©a
(
Sub»sourûLßd”
* 
lßd”
, 
by‹sS’t
, 
tÙ®By‹sToBeS’t
)

220 #ifdeà
SSLAB__DEBUG


221 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

224 
ASSERT
(
m_ş›Á
);

225 
ASSERT_UNUSED
(
lßd”
,†ßd” =ğ
m_lßd”
);

227 
	gm_ş›Á
->
didS’dD©a
(
by‹sS’t
, 
tÙ®By‹sToBeS’t
);

230 
	gDocum’tTh»adabËLßd”
::
didReûiveRe¥Ú£
(
Sub»sourûLßd”
* 
lßd”
, cÚ¡ 
ResourûRe¥Ú£
& 
»¥Ú£
)

232 #ifdeà
SSLAB__DEBUG


233 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

236 
ASSERT
(
m_ş›Á
);

237 
ASSERT_UNUSED
(
lßd”
,†ßd” =ğ
m_lßd”
);

239 ià(
	gm_aùu®Reque¡
) {

240 ià(!
·s£sAcûssCÚŒŞCheck
(
»¥Ú£
, 
m_İtiÚs
.
®lowC»d’tŸls
, 
m_docum’t
->
£cur™yOrigš
())) {

241 
´eæightFau»
();

245 
	gOwnPŒ
<
	gCrossOrigšP»æightResuÉCacheI‹m
> 
´eæightResuÉ
(
Ãw
 
CrossOrigšP»æightResuÉCacheI‹m
(
m_İtiÚs
.
®lowC»d’tŸls
));

246 ià(!
	g´eæightResuÉ
->
·r£
(
»¥Ú£
)

247 || !
	g´eæightResuÉ
->
®lowsCrossOrigšM‘hod
(
m_aùu®Reque¡
->
h‰pM‘hod
())

248 || !
	g´eæightResuÉ
->
®lowsCrossOrigšH—d”s
(
m_aùu®Reque¡
->
h‰pH—d”F›lds
())) {

249 
´eæightFau»
();

253 
	gCrossOrigšP»æightResuÉCache
::
sh¬ed
().
­³ndEÁry
(
m_docum’t
->
£cur™yOrigš
()->
toSŒšg
(), 
m_aùu®Reque¡
->
u¾
(), 
´eæightResuÉ
.
»Ëa£
());

255 ià(!
	gm_§meOrigšReque¡
 && 
	gm_İtiÚs
.
	güossOrigšReque¡PŞicy
 =ğ
U£AcûssCÚŒŞ
) {

256 ià(!
·s£sAcûssCÚŒŞCheck
(
»¥Ú£
, 
m_İtiÚs
.
®lowC»d’tŸls
, 
m_docum’t
->
£cur™yOrigš
())) {

257 
m_ş›Á
->
didFa
(
ResourûE¼Ü
());

262 
	gm_ş›Á
->
didReûiveRe¥Ú£
(
»¥Ú£
);

266 
	gDocum’tTh»adabËLßd”
::
didReûiveD©a
(
Sub»sourûLßd”
* 
lßd”
, cÚ¡ * 
d©a
, 
ËngthReûived
)

268 #ifdeà
SSLAB__DEBUG


269 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

272 
ASSERT
(
m_ş›Á
);

273 
ASSERT_UNUSED
(
lßd”
,†ßd” =ğ
m_lßd”
);

275 
	gm_ş›Á
->
didReûiveD©a
(
d©a
, 
ËngthReûived
);

278 
	gDocum’tTh»adabËLßd”
::
didFšishLßdšg
(
Sub»sourûLßd”
* 
lßd”
)

280 #ifdeà
SSLAB__DEBUG


281 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

284 
ASSERT
(
lßd”
 =ğ
m_lßd”
);

285 
ASSERT
(
m_ş›Á
);

286 
didFšishLßdšg
(
lßd”
->
id’tif›r
());

289 
	gDocum’tTh»adabËLßd”
::
didFšishLßdšg
(
id’tif›r
)

291 #ifdeà
SSLAB__DEBUG


292 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

295 ià(
	gm_aùu®Reque¡
) {

296 
ASSERT
(!
m_§meOrigšReque¡
);

297 
ASSERT
(
m_İtiÚs
.
üossOrigšReque¡PŞicy
 =ğ
U£AcûssCÚŒŞ
);

298 
´eæightSucûss
();

300 
	gm_ş›Á
->
didFšishLßdšg
(
id’tif›r
);

303 
	gDocum’tTh»adabËLßd”
::
didFa
(
Sub»sourûLßd”
* 
lßd”
, cÚ¡ 
ResourûE¼Ü
& 
”rÜ
)

305 #ifdeà
SSLAB__DEBUG


306 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

309 
ASSERT
(
m_ş›Á
);

311 
ASSERT_UNUSED
(
lßd”
,†ßd” =ğ
m_lßd”
 || !m_loader);

313 
	gm_ş›Á
->
didFa
(
”rÜ
);

316 
boŞ
 
	gDocum’tTh»adabËLßd”
::
g‘ShouldU£C»d’tŸlStÜage
(
Sub»sourûLßd”
* 
lßd”
, boŞ& 
shouldU£C»d’tŸlStÜage
)

318 #ifdeà
SSLAB__DEBUG


319 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

322 
ASSERT_UNUSED
(
lßd”
,†ßd” =ğ
m_lßd”
 || !m_loader);

324 ià(!
	gm_İtiÚs
.
	g®lowC»d’tŸls
) {

325 
	gshouldU£C»d’tŸlStÜage
 = 
çl£
;

326  
	gŒue
;

329  
	gçl£
;

332 
	gDocum’tTh»adabËLßd”
::
didReûiveAuth’tiÿtiÚCh®Ënge
(
Sub»sourûLßd”
* 
lßd”
, cÚ¡ 
Auth’tiÿtiÚCh®Ënge
&)

334 #ifdeà
SSLAB__DEBUG


335 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

338 
ASSERT
(
lßd”
 =ğ
m_lßd”
);

340 ià(!
	gm_§meOrigšReque¡
) {

341 
	gRefPŒ
<
	gDocum’tTh»adabËLßd”
> 
´Ùeù
(
this
);

342 
	gm_ş›Á
->
didFa
(
lßd”
->
blockedE¼Ü
());

343 
ÿnûl
();

347 
	gDocum’tTh»adabËLßd”
::
»ûivedCªûÎ©iÚ
(
Sub»sourûLßd”
* 
lßd”
, cÚ¡ 
Auth’tiÿtiÚCh®Ënge
& 
ch®Ënge
)

349 #ifdeà
SSLAB__DEBUG


350 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

353 
ASSERT
(
m_ş›Á
);

354 
ASSERT_UNUSED
(
lßd”
,†ßd” =ğ
m_lßd”
);

355 
	gm_ş›Á
->
didReûiveAuth’tiÿtiÚCªûÎ©iÚ
(
ch®Ënge
.
çu»Re¥Ú£
());

358 
	gDocum’tTh»adabËLßd”
::
´eæightSucûss
()

360 #ifdeà
SSLAB__DEBUG


361 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

364 
	gOwnPŒ
<
	gResourûReque¡
> 
	gaùu®Reque¡
;

365 
	gaùu®Reque¡
.
sw­
(
m_aùu®Reque¡
);

368 
lßdReque¡
(*
aùu®Reque¡
, 
SkSecur™yCheck
);

371 
	gDocum’tTh»adabËLßd”
::
´eæightFau»
()

373 #ifdeà
SSLAB__DEBUG


374 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

377 
	gm_aùu®Reque¡
 = 0;

378 
	gm_ş›Á
->
didFa
(
ResourûE¼Ü
());

381 
	gDocum’tTh»adabËLßd”
::
lßdReque¡
(cÚ¡ 
ResourûReque¡
& 
»que¡
, 
Secur™yCheckPŞicy
 
£cur™yCheck
)

383 #ifdeà
SSLAB__DEBUG


384 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

388 cÚ¡ 
	gKURL
& 
	g»que¡URL
 = 
»que¡
.
u¾
();

389 
ASSERT
(
m_§meOrigšReque¡
 || 
»que¡URL
.
u£r
().
isEm±y
());

390 
ASSERT
(
m_§meOrigšReque¡
 || 
»que¡URL
.
·ss
().
isEm±y
());

392 ià(
	gm_async
) {

394 
boŞ
 
	g£ndLßdC®lbacks
 = 
m_İtiÚs
.
£ndLßdC®lbacks
 && !
m_aùu®Reque¡
;

395 
boŞ
 
	g¢iffCÚ‹Á
 = 
m_İtiÚs
.
¢iffCÚ‹Á
 && !
m_aùu®Reque¡
;

398 
	gm_lßd”
 = 0;

399 
	gm_lßd”
 = 
Sub»sourûLßd”
::
ü—‹
(
m_docum’t
->
äame
(), 
this
, 
»que¡
, 
£cur™yCheck
, 
£ndLßdC®lbacks
, 
¢iffCÚ‹Á
);

404 
StÜedC»d’tŸls
 
	g¡ÜedC»d’tŸls
 = 
m_İtiÚs
.
®lowC»d’tŸls
 ? 
AÎowStÜedC»d’tŸls
 : 
DoNÙAÎowStÜedC»d’tŸls
;

406 
	gVeùÜ
<> 
	gd©a
;

407 
ResourûE¼Ü
 
	g”rÜ
;

408 
ResourûRe¥Ú£
 
	g»¥Ú£
;

409 
	gid’tif›r
 = 
¡d
::
num”ic_lim™s
<>::
max
();

410 ià(
	gm_docum’t
->
äame
())

411 
	gid’tif›r
 = 
m_docum’t
->
äame
()->
lßd”
()->
lßdResourûSynchrÚou¦y
(
»que¡
, 
¡ÜedC»d’tŸls
, 
”rÜ
, 
»¥Ú£
, 
d©a
);

415 ià(!
	g”rÜ
.
isNuÎ
(è&& !
	g»que¡URL
.
isLoÿlFe
(è&& 
	g»¥Ú£
.
h‰pStusCode
() <= 0) {

416 
m_ş›Á
->
didFa
(
”rÜ
);

423 ià(
	g»que¡URL
 !ğ
»¥Ú£
.
u¾
(è&& !
isAÎowedRedœeù
(response.url())) {

424 
m_ş›Á
->
didFaRedœeùCheck
();

428 
didReûiveRe¥Ú£
(0, 
»¥Ú£
);

430 cÚ¡ * 
	gby‹s
 = 
¡©ic_ÿ¡
<cÚ¡ *>(
d©a
.data());

431 
	gËn
 = 
¡©ic_ÿ¡
<>(
d©a
.
size
());

432 
didReûiveD©a
(0, 
by‹s
, 
Ën
);

434 
didFšishLßdšg
(
id’tif›r
);

437 
boŞ
 
	gDocum’tTh»adabËLßd”
::
isAÎowedRedœeù
(cÚ¡ 
KURL
& 
u¾
)

439 #ifdeà
SSLAB__DEBUG


440 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

443 ià(
	gm_İtiÚs
.
	güossOrigšReque¡PŞicy
 =ğ
AÎowCrossOrigšReque¡s
)

444  
Œue
;

449  
	gm_§meOrigšReque¡
 && 
	gm_docum’t
->
£cur™yOrigš
()->
ÿnReque¡
(
u¾
);

	@DocumentThreadableLoader.h

31 #iâdeà
Docum’tTh»adabËLßd”_h


32 
	#Docum’tTh»adabËLßd”_h


	)

34 
	~"F¿meLßd”Ty³s.h
"

35 
	~"Sub»sourûLßd”Cl›Á.h
"

36 
	~"Th»adabËLßd”.h
"

37 
	~<wtf/OwnPŒ.h
>

38 
	~<wtf/PassRefPŒ.h
>

39 
	~<wtf/RefCouÁed.h
>

40 
	~<wtf/RefPŒ.h
>

42 
Çme¥aû
 
	gWebCÜe
 {

43 
şass
 
	gDocum’t
;

44 
şass
 
	gKURL
;

45 
şass
 
	gResourûReque¡
;

46 
şass
 
	gTh»adabËLßd”Cl›Á
;

48 
şass
 
	gDocum’tTh»adabËLßd”
 : 
public
 
RefCouÁed
<
Docum’tTh»adabËLßd”
>,…ubliø
	gTh»adabËLßd”
, 
´iv©e
 
	gSub»sourûLßd”Cl›Á
 {

49 
	gpublic
:

50 
lßdResourûSynchrÚou¦y
(
Docum’t
*, cÚ¡ 
ResourûReque¡
&, 
Th»adabËLßd”Cl›Á
&, cÚ¡ 
Th»adabËLßd”O±iÚs
&);

51 
	gPassRefPŒ
<
	gDocum’tTh»adabËLßd”
> 
ü—‹
(
Docum’t
*, 
Th»adabËLßd”Cl›Á
*, cÚ¡ 
ResourûReque¡
&, cÚ¡ 
Th»adabËLßd”O±iÚs
&);

52 
	gvœtu®
 ~
Docum’tTh»adabËLßd”
();

54 
vœtu®
 
ÿnûl
();

56 
usšg
 
	gRefCouÁed
<
	gDocum’tTh»adabËLßd”
>::
»f
;

57 
usšg
 
	gRefCouÁed
<
	gDocum’tTh»adabËLßd”
>::
d”ef
;

59 
	g´Ùeùed
:

60 
vœtu®
 
»fTh»adabËLßd”
(è{ 
»f
(); }

61 
vœtu®
 
d”efTh»adabËLßd”
(è{ 
d”ef
(); }

63 
	g´iv©e
:

64 
	eBlockšgBehaviÜ
 {

65 
LßdSynchrÚou¦y
,

66 
	gLßdAsynchrÚou¦y


69 
Docum’tTh»adabËLßd”
(
Docum’t
*, 
Th»adabËLßd”Cl›Á
*, 
BlockšgBehaviÜ
 
blockšgBehaviÜ
, cÚ¡ 
ResourûReque¡
&, cÚ¡ 
Th»adabËLßd”O±iÚs
& 
İtiÚs
);

71 
vœtu®
 
wlS’dReque¡
(
Sub»sourûLßd”
*, 
ResourûReque¡
&, cÚ¡ 
ResourûRe¥Ú£
& 
»dœeùRe¥Ú£
);

72 
vœtu®
 
didS’dD©a
(
Sub»sourûLßd”
*, 
by‹sS’t
, 
tÙ®By‹sToBeS’t
);

74 
vœtu®
 
didReûiveRe¥Ú£
(
Sub»sourûLßd”
*, cÚ¡ 
ResourûRe¥Ú£
&);

75 
vœtu®
 
didReûiveD©a
(
Sub»sourûLßd”
*, cÚ¡ *, 
ËngthReûived
);

76 
vœtu®
 
didFšishLßdšg
(
Sub»sourûLßd”
*);

77 
vœtu®
 
didFa
(
Sub»sourûLßd”
*, cÚ¡ 
ResourûE¼Ü
&);

79 
vœtu®
 
boŞ
 
g‘ShouldU£C»d’tŸlStÜage
(
Sub»sourûLßd”
*, boŞ& 
shouldU£C»d’tŸlStÜage
);

80 
vœtu®
 
didReûiveAuth’tiÿtiÚCh®Ënge
(
Sub»sourûLßd”
*, cÚ¡ 
Auth’tiÿtiÚCh®Ënge
&);

81 
vœtu®
 
»ûivedCªûÎ©iÚ
(
Sub»sourûLßd”
*, cÚ¡ 
Auth’tiÿtiÚCh®Ënge
&);

83 
didFšishLßdšg
(
id’tif›r
);

84 
makeSim¶eCrossOrigšAcûssReque¡
(cÚ¡ 
ResourûReque¡
& 
»que¡
);

85 
makeCrossOrigšAcûssReque¡W™hP»æight
(cÚ¡ 
ResourûReque¡
& 
»que¡
);

86 
´eæightSucûss
();

87 
´eæightFau»
();

89 
lßdReque¡
(cÚ¡ 
ResourûReque¡
&, 
Secur™yCheckPŞicy
);

90 
boŞ
 
isAÎowedRedœeù
(cÚ¡ 
KURL
&);

92 
	gRefPŒ
<
	gSub»sourûLßd”
> 
	gm_lßd”
;

93 
Th»adabËLßd”Cl›Á
* 
	gm_ş›Á
;

94 
Docum’t
* 
	gm_docum’t
;

95 
Th»adabËLßd”O±iÚs
 
	gm_İtiÚs
;

96 
boŞ
 
	gm_§meOrigšReque¡
;

97 
boŞ
 
	gm_async
;

98 
	gOwnPŒ
<
	gResourûReque¡
> 
	gm_aùu®Reque¡
;

	@EmptyClients.h

27 #iâdeà
Em±yCl›Ás_h


28 
	#Em±yCl›Ás_h


	)

30 
	~"ChromeCl›Á.h
"

31 
	~"CÚ‹xtM’uCl›Á.h
"

32 
	~"CÚsŞe.h
"

33 
	~"Docum’tLßd”.h
"

34 
	~"D¿gCl›Á.h
"

35 
	~"Ed™Commªd.h
"

36 
	~"Ed™ÜCl›Á.h
"

37 
	~"FlßtReù.h
"

38 
	~"FocusDœeùiÚ.h
"

39 
	~"F¿meLßd”Cl›Á.h
"

40 
	~"In¥eùÜCl›Á.h
"

41 
	~"PlugšH®‹rCl›Á.h
"

42 
	~"ResourûE¼Ü.h
"

57 
Çme¥aû
 
	gWebCÜe
 {

59 şas 
	cEm±yChromeCl›Á
 : 
public
 
ChromeCl›Á
 {

60 
public
:

61 
vœtu®
 ~
Em±yChromeCl›Á
() { }

62 
vœtu®
 
chromeDe¡royed
() { }

64 
vœtu®
 
£tWšdowReù
(cÚ¡ 
FlßtReù
&) { }

65 
vœtu®
 
FlßtReù
 
wšdowReù
() {  FloatRect(); }

67 
vœtu®
 
FlßtReù
 
·geReù
() {  FloatRect(); }

69 
vœtu®
 
sÿËFaùÜ
() {  1.f; }

71 
vœtu®
 
focus
() { }

72 
vœtu®
 
unfocus
() { }

74 
vœtu®
 
boŞ
 
ÿnTakeFocus
(
FocusDœeùiÚ
è{  
	gçl£
; }

75 
vœtu®
 
keFocus
(
FocusDœeùiÚ
) { }

77 
vœtu®
 
focu£dNodeChªged
(
Node
*) { }

79 
vœtu®
 
Page
* 
ü—‹Wšdow
(
F¿me
*, cÚ¡ 
F¿meLßdReque¡
&, cÚ¡ 
WšdowF—tu»s
&) {  0; }

80 
vœtu®
 
show
() { }

82 
vœtu®
 
boŞ
 
ÿnRunMod®
(è{  
	gçl£
; }

83 
vœtu®
 
runMod®
() { }

85 
vœtu®
 
£tToŞb¬sVisibË
(
boŞ
) { }

86 
vœtu®
 
boŞ
 
toŞb¬sVisibË
(è{  
	gçl£
; }

88 
vœtu®
 
£tStusb¬VisibË
(
boŞ
) { }

89 
vœtu®
 
boŞ
 
¡©usb¬VisibË
(è{  
	gçl£
; }

91 
vœtu®
 
£tSüŞlb¬sVisibË
(
boŞ
) { }

92 
vœtu®
 
boŞ
 
süŞlb¬sVisibË
(è{  
	gçl£
; }

94 
vœtu®
 
£tM’ub¬VisibË
(
boŞ
) { }

95 
vœtu®
 
boŞ
 
m’ub¬VisibË
(è{  
	gçl£
; }

97 
vœtu®
 
£tResizabË
(
boŞ
) { }

99 
vœtu®
 
addMes§geToCÚsŞe
(
Mes§geSourû
, 
Mes§geTy³
, 
Mes§geLev–
, cÚ¡ 
SŒšg
&, , const String&) { }

101 
vœtu®
 
boŞ
 
ÿnRunBefÜeUÆßdCÚfœmPª–
(è{  
	gçl£
; }

102 
vœtu®
 
boŞ
 
runBefÜeUÆßdCÚfœmPª–
(cÚ¡ 
SŒšg
&, 
F¿me
*è{  
	gŒue
; }

104 
vœtu®
 
şo£WšdowSoÚ
() { }

106 
vœtu®
 
runJavaSütAË¹
(
F¿me
*, cÚ¡ 
SŒšg
&) { }

107 
vœtu®
 
boŞ
 
runJavaSütCÚfœm
(
F¿me
*, cÚ¡ 
SŒšg
&è{  
	gçl£
; }

108 
vœtu®
 
boŞ
 
runJavaSütProm±
(
F¿me
*, cÚ¡ 
SŒšg
&, cÚ¡ SŒšg&, SŒšg&è{  
	gçl£
; }

109 
vœtu®
 
boŞ
 
shouldIÁ”ru±JavaSüt
(è{  
	gçl£
; }

111 
vœtu®
 
£tStusb¬Text
(cÚ¡ 
SŒšg
&) { }

113 
vœtu®
 
boŞ
 
bsToLšks
(ècÚ¡ {  
	gçl£
; }

115 
vœtu®
 
IÁReù
 
wšdowResiz”Reù
() const {  IntRect(); }

117 
vœtu®
 
šv®id©eWšdow
(cÚ¡ 
IÁReù
&, 
boŞ
) { }

118 
vœtu®
 
šv®id©eCÚ‹ÁsAndWšdow
(cÚ¡ 
IÁReù
&, 
boŞ
) { }

119 
vœtu®
 
šv®id©eCÚ‹ÁsFÜSlowSüŞl
(cÚ¡ 
IÁReù
&, 
boŞ
) {};

120 
vœtu®
 
süŞl
(cÚ¡ 
IÁSize
&, cÚ¡ 
IÁReù
&, const IntRect&) { }

122 
vœtu®
 
IÁPošt
 
sü“nToWšdow
(cÚ¡ IÁPošt& 
p
ècÚ¡ {  
	gp
; }

123 
vœtu®
 
IÁReù
 
wšdowToSü“n
(cÚ¡ IÁReù& 
r
ècÚ¡ {  
	gr
; }

124 
vœtu®
 
PÏtfÜmPageCl›Á
 
¶©fÜmPageCl›Á
() const {  0; }

125 
vœtu®
 
cÚ‹ÁsSizeChªged
(
F¿me
*, cÚ¡ 
IÁSize
&) const { }

127 
vœtu®
 
süŞlb¬sModeDidChªge
() const { }

128 
vœtu®
 
mou£DidMoveOv”EËm’t
(cÚ¡ 
H™Te¡ResuÉ
&, ) { }

130 
vœtu®
 
£tToŞT
(cÚ¡ 
SŒšg
&, 
TextDœeùiÚ
) { }

132 
vœtu®
 
´št
(
F¿me
*) { }

134 #ià
ENABLE
(
DATABASE
)

135 
vœtu®
 
exûededD©aba£QuÙa
(
F¿me
*, cÚ¡ 
SŒšg
&) { }

138 #ià
ENABLE
(
OFFLINE_WEB_APPLICATIONS
)

139 
vœtu®
 
»achedMaxAµCacheSize
(
št64_t
) { }

142 #ià
ENABLE
(
NOTIFICATIONS
)

143 
vœtu®
 
NÙifiÿtiÚP»£Á”
* 
nÙifiÿtiÚP»£Á”
() const {  0; }

146 
vœtu®
 
runO³nPª–
(
F¿me
*, 
PassRefPŒ
<
FeChoo£r
>) { }

147 
vœtu®
 
choo£IcÚFÜFes
(cÚ¡ 
VeùÜ
<
SŒšg
>&, 
PassRefPŒ
<
FeChoo£r
>) { }

149 
vœtu®
 
fÜmS‹DidChªge
(cÚ¡ 
Node
*) { }

151 
vœtu®
 
fÜmDidFocus
(cÚ¡ 
Node
*) { }

152 
vœtu®
 
fÜmDidBlur
(cÚ¡ 
Node
*) { }

154 
vœtu®
 
	gPassOwnPŒ
<
	gHTMLP¬£rQuœks
> 
ü—‹HTMLP¬£rQuœks
() {  0; }

156 
vœtu®
 
boŞ
 
£tCursÜ
(
PÏtfÜmCursÜHªdË
è{  
	gçl£
; }

158 
vœtu®
 
süŞlReùIÁoV›w
(cÚ¡ 
IÁReù
&, cÚ¡ 
SüŞlV›w
*) const {}

160 
vœtu®
 
»que¡GeŞoÿtiÚP”missiÚFÜF¿me
(
F¿me
*, 
GeŞoÿtiÚ
*) {}

161 
vœtu®
 
ÿnûlGeŞoÿtiÚP”missiÚReque¡FÜF¿me
(
F¿me
*) {}

163 #ià
USE
(
ACCELERATED_COMPOSITING
)

164 
vœtu®
 
©chRoÙG¿phicsLay”
(
F¿me
*, 
G¿phicsLay”
*) {};

165 
vœtu®
 
£tN“dsOÃShÙD¿wšgSynchrÚiz©iÚ
() {};

166 
vœtu®
 
scheduËCompos™šgLay”Sync
() {};

169 #ià
ENABLE
(
TOUCH_EVENTS
)

170 
vœtu®
 
ÃedTouchEv’ts
(
boŞ
) { }

174 
şass
 
	gEm±yF¿meLßd”Cl›Á
 : 
public
 
F¿meLßd”Cl›Á
,…ubliø
	gNÚcİyabË
 {

175 
	gpublic
:

176 
vœtu®
 ~
Em±yF¿meLßd”Cl›Á
() { }

177 
vœtu®
 
äameLßd”De¡royed
() { }

179 
vœtu®
 
boŞ
 
hasWebV›w
(ècÚ¡ {  
Œue
; }

181 
vœtu®
 
makeR•»£Á©iÚ
(
Docum’tLßd”
*) { }

182 
vœtu®
 
fÜûLayout
() { }

183 
vœtu®
 
fÜûLayoutFÜNÚHTML
() { }

185 
vœtu®
 
£tCİ›sOnSüŞl
() { }

187 
vœtu®
 
d‘achedFromP¬’t2
() { }

188 
vœtu®
 
d‘achedFromP¬’t3
() { }

190 
vœtu®
 
dowÆßd
(
ResourûHªdË
*, cÚ¡ 
ResourûReque¡
&, cÚ¡ ResourûReque¡&, cÚ¡ 
ResourûRe¥Ú£
&) { }

192 
vœtu®
 
assignId’tif›rToIn™ŸlReque¡
(, 
Docum’tLßd”
*, cÚ¡ 
ResourûReque¡
&) { }

193 
vœtu®
 
boŞ
 
shouldU£C»d’tŸlStÜage
(
Docum’tLßd”
*, è{  
	gçl£
; }

194 
vœtu®
 
di¥©chWlS’dReque¡
(
Docum’tLßd”
*, , 
ResourûReque¡
&, cÚ¡ 
ResourûRe¥Ú£
&) { }

195 
vœtu®
 
di¥©chDidReûiveAuth’tiÿtiÚCh®Ënge
(
Docum’tLßd”
*, , cÚ¡ 
Auth’tiÿtiÚCh®Ënge
&) { }

196 
vœtu®
 
di¥©chDidCªûlAuth’tiÿtiÚCh®Ënge
(
Docum’tLßd”
*, , cÚ¡ 
Auth’tiÿtiÚCh®Ënge
&) { }

197 
vœtu®
 
di¥©chDidReûiveRe¥Ú£
(
Docum’tLßd”
*, , cÚ¡ 
ResourûRe¥Ú£
&) { }

198 
vœtu®
 
di¥©chDidReûiveCÚ‹ÁL’gth
(
Docum’tLßd”
*, , ) { }

199 
vœtu®
 
di¥©chDidFšishLßdšg
(
Docum’tLßd”
*, ) { }

200 
vœtu®
 
di¥©chDidFaLßdšg
(
Docum’tLßd”
*, , cÚ¡ 
ResourûE¼Ü
&) { }

201 
vœtu®
 
boŞ
 
di¥©chDidLßdResourûFromMemÜyCache
(
Docum’tLßd”
*, cÚ¡ 
ResourûReque¡
&, cÚ¡ 
ResourûRe¥Ú£
&, è{  
	gçl£
; }

202 
vœtu®
 
di¥©chDidLßdResourûByXMLH‰pReque¡
(, cÚ¡ 
SütSŒšg
&) { }

204 
vœtu®
 
di¥©chDidHªdËOÆßdEv’ts
() { }

205 
vœtu®
 
di¥©chDidReûiveS”v”RedœeùFÜProvisiÚ®Lßd
() { }

206 
vœtu®
 
di¥©chDidCªûlCl›ÁRedœeù
() { }

207 
vœtu®
 
di¥©chWlP”fÜmCl›ÁRedœeù
(cÚ¡ 
KURL
&, , ) { }

208 
vœtu®
 
di¥©chDidChªgeLoÿtiÚW™hšPage
() { }

209 
vœtu®
 
di¥©chDidPushS‹W™hšPage
() { }

210 
vœtu®
 
di¥©chDidR•ÏûS‹W™hšPage
() { }

211 
vœtu®
 
di¥©chDidPİS‹W™hšPage
() { }

212 
vœtu®
 
di¥©chWlClo£
() { }

213 
vœtu®
 
di¥©chDidReûiveIcÚ
() { }

214 
vœtu®
 
di¥©chDidS¹ProvisiÚ®Lßd
() { }

215 
vœtu®
 
di¥©chDidReûiveT™Ë
(cÚ¡ 
SŒšg
&) { }

216 
vœtu®
 
di¥©chDidComm™Lßd
() { }

217 
vœtu®
 
di¥©chDidFaProvisiÚ®Lßd
(cÚ¡ 
ResourûE¼Ü
&) { }

218 
vœtu®
 
di¥©chDidFaLßd
(cÚ¡ 
ResourûE¼Ü
&) { }

219 
vœtu®
 
di¥©chDidFšishDocum’tLßd
() { }

220 
vœtu®
 
di¥©chDidFšishLßd
() { }

221 
vœtu®
 
di¥©chDidFœ¡Layout
() { }

222 
vœtu®
 
di¥©chDidFœ¡Visu®lyNÚEm±yLayout
() { }

224 
vœtu®
 
F¿me
* 
di¥©chC»©ePage
() {  0; }

225 
vœtu®
 
di¥©chShow
() { }

227 
vœtu®
 
di¥©chDecidePŞicyFÜMIMETy³
(
F¿mePŞicyFunùiÚ
, cÚ¡ 
SŒšg
&, cÚ¡ 
ResourûReque¡
&) { }

228 
vœtu®
 
di¥©chDecidePŞicyFÜNewWšdowAùiÚ
(
F¿mePŞicyFunùiÚ
, cÚ¡ 
Navig©iÚAùiÚ
&, cÚ¡ 
ResourûReque¡
&, 
PassRefPŒ
<
FÜmS‹
>, cÚ¡ 
SŒšg
&) { }

229 
vœtu®
 
di¥©chDecidePŞicyFÜNavig©iÚAùiÚ
(
F¿mePŞicyFunùiÚ
, cÚ¡ 
Navig©iÚAùiÚ
&, cÚ¡ 
ResourûReque¡
&, 
PassRefPŒ
<
FÜmS‹
>) { }

230 
vœtu®
 
ÿnûlPŞicyCheck
() { }

232 
vœtu®
 
di¥©chUÇbËToIm¶em’tPŞicy
(cÚ¡ 
ResourûE¼Ü
&) { }

234 
vœtu®
 
di¥©chWlSubm™FÜm
(
F¿mePŞicyFunùiÚ
, 
PassRefPŒ
<
FÜmS‹
>) { }

236 
vœtu®
 
di¥©chDidLßdMašResourû
(
Docum’tLßd”
*) { }

237 
vœtu®
 
»v”tToProvisiÚ®S‹
(
Docum’tLßd”
*) { }

238 
vœtu®
 
£tMašDocum’tE¼Ü
(
Docum’tLßd”
*, cÚ¡ 
ResourûE¼Ü
&) { }

240 
vœtu®
 
wlChªgeE¡im©edProg»ss
() { }

241 
vœtu®
 
didChªgeE¡im©edProg»ss
() { }

242 
vœtu®
 
po¡Prog»ssS¹edNÙifiÿtiÚ
() { }

243 
vœtu®
 
po¡Prog»ssE¡im©eChªgedNÙifiÿtiÚ
() { }

244 
vœtu®
 
po¡Prog»ssFšishedNÙifiÿtiÚ
() { }

246 
vœtu®
 
£tMašF¿meDocum’tR—dy
(
boŞ
) { }

248 
vœtu®
 
¡¬tDowÆßd
(cÚ¡ 
ResourûReque¡
&) { }

250 
vœtu®
 
wlChªgeT™Ë
(
Docum’tLßd”
*) { }

251 
vœtu®
 
didChªgeT™Ë
(
Docum’tLßd”
*) { }

253 
vœtu®
 
comm™‹dLßd
(
Docum’tLßd”
*, const *, ) { }

254 
vœtu®
 
fšishedLßdšg
(
Docum’tLßd”
*) { }

256 
vœtu®
 
ResourûE¼Ü
 
ÿnûÎedE¼Ü
(cÚ¡ 
ResourûReque¡
&è{ ResourûE¼Ü 
”rÜ
("", 0, "", ""); 
	g”rÜ
.
£tIsCªûÎ©iÚ
(
Œue
); ƒrror; }

257 
vœtu®
 
ResourûE¼Ü
 
blockedE¼Ü
(cÚ¡ 
ResourûReque¡
&) {  ResourceError("", 0, "", ""); }

258 
vœtu®
 
ResourûE¼Ü
 
ÿÂÙShowURLE¼Ü
(cÚ¡ 
ResourûReque¡
&) {  ResourceError("", 0, "", ""); }

259 
vœtu®
 
ResourûE¼Ü
 
š‹¼u±FÜPŞicyChªgeE¼Ü
(cÚ¡ 
ResourûReque¡
&) {  ResourceError("", 0, "", ""); }

261 
vœtu®
 
ResourûE¼Ü
 
ÿÂÙShowMIMETy³E¼Ü
(cÚ¡ 
ResourûRe¥Ú£
&) {  ResourceError("", 0, "", ""); }

262 
vœtu®
 
ResourûE¼Ü
 
feDÛsNÙExi¡E¼Ü
(cÚ¡ 
ResourûRe¥Ú£
&) {  ResourceError("", 0, "", ""); }

263 
vœtu®
 
ResourûE¼Ü
 
¶ugšWlHªdËLßdE¼Ü
(cÚ¡ 
ResourûRe¥Ú£
&) {  ResourceError("", 0, "", ""); }

265 
vœtu®
 
boŞ
 
shouldF®lBack
(cÚ¡ 
ResourûE¼Ü
&è{  
	gçl£
; }

267 
vœtu®
 
boŞ
 
ÿnHªdËReque¡
(cÚ¡ 
ResourûReque¡
&ècÚ¡ {  
	gçl£
; }

268 
vœtu®
 
boŞ
 
ÿnShowMIMETy³
(cÚ¡ 
SŒšg
&ècÚ¡ {  
	gçl£
; }

269 
vœtu®
 
boŞ
 
»´e£Á©iÚExi¡sFÜURLScheme
(cÚ¡ 
SŒšg
&ècÚ¡ {  
	gçl£
; }

270 
vœtu®
 
SŒšg
 
g’”©edMIMETy³FÜURLScheme
(const String&) const {  ""; }

272 
vœtu®
 
äameLßdCom¶‘ed
() { }

273 
vœtu®
 
»¡ÜeV›wS‹
() { }

274 
vœtu®
 
´ovisiÚ®LßdS¹ed
() { }

275 
vœtu®
 
boŞ
 
shouldT»©URLAsSameAsCu¼’t
(cÚ¡ 
KURL
&ècÚ¡ {  
	gçl£
; }

276 
vœtu®
 
didFšishLßd
() { }

277 
vœtu®
 
´•¬eFÜD©aSourûR•Ïûm’t
() { }

279 
vœtu®
 
	gPassRefPŒ
<
	gDocum’tLßd”
> 
ü—‹Docum’tLßd”
(cÚ¡ 
ResourûReque¡
& 
»que¡
, cÚ¡ 
Sub¡™u‹D©a
& 
sub¡™u‹D©a
è{  Docum’tLßd”::
ü—‹
(request, substituteData); }

280 
vœtu®
 
£tT™Ë
(cÚ¡ 
SŒšg
&, cÚ¡ 
KURL
&) { }

282 
vœtu®
 
SŒšg
 
u£rAg’t
(cÚ¡ 
KURL
&) {  ""; }

284 
vœtu®
 
§vePÏtfÜmD©aToCachedF¿me
(
CachedF¿me
*) { }

285 
vœtu®
 
Œªs™iÚToComm™‹dFromCachedF¿me
(
CachedF¿me
*) { }

286 
vœtu®
 
Œªs™iÚToComm™‹dFÜNewPage
() { }

288 
vœtu®
 
upd©eGlob®Hi¡Üy
() { }

289 
vœtu®
 
upd©eGlob®Hi¡ÜyRedœeùLšks
() { }

290 
vœtu®
 
boŞ
 
shouldGoToHi¡ÜyI‹m
(
Hi¡ÜyI‹m
*ècÚ¡ {  
	gçl£
; }

291 
vœtu®
 
di¥©chDidAddBackFÜw¬dI‹m
(
Hi¡ÜyI‹m
*) const { }

292 
vœtu®
 
di¥©chDidRemoveBackFÜw¬dI‹m
(
Hi¡ÜyI‹m
*) const { };

293 
vœtu®
 
di¥©chDidChªgeBackFÜw¬dIndex
() const { }

294 
vœtu®
 
§veV›wS‹ToI‹m
(
Hi¡ÜyI‹m
*) { }

295 
vœtu®
 
boŞ
 
ÿnCachePage
(ècÚ¡ {  
	gçl£
; }

296 
vœtu®
 
didDi¥ÏyIn£cu»CÚ‹Á
() { }

297 
vœtu®
 
didRunIn£cu»CÚ‹Á
(
Secur™yOrigš
*) { }

298 
vœtu®
 
	gPassRefPŒ
<
	gF¿me
> 
ü—‹F¿me
(cÚ¡ 
KURL
&, cÚ¡ 
SŒšg
&, 
HTMLF¿meOwÃrEËm’t
*, cÚ¡ SŒšg&, 
boŞ
, , ) {  0; }

299 
vœtu®
 
didT¿nsãrChdF¿meToNewDocum’t
() { }

300 
vœtu®
 
	gPassRefPŒ
<
	gWidg‘
> 
ü—‹Plugš
(cÚ¡ 
IÁSize
&, 
HTMLPlugInEËm’t
*, cÚ¡ 
KURL
&, cÚ¡ 
VeùÜ
<
SŒšg
>&, cÚ¡ VeùÜ<SŒšg>&, cÚ¡ SŒšg&, 
boŞ
) {  0; }

301 
vœtu®
 
	gPassRefPŒ
<
	gWidg‘
> 
ü—‹JavaAµËtWidg‘
(cÚ¡ 
IÁSize
&, 
HTMLAµËtEËm’t
*, cÚ¡ 
KURL
&, cÚ¡ 
VeùÜ
<
SŒšg
>&, const Vector<String>&) {  0; }

303 
vœtu®
 
ObjeùCÚ‹ÁTy³
 
objeùCÚ‹ÁTy³
(cÚ¡ 
KURL
&, cÚ¡ 
SŒšg
&) {  ObjectContentType(); }

304 
vœtu®
 
SŒšg
 
ov”rideMedŸTy³
() const {  String(); }

306 
vœtu®
 
»dœeùD©aToPlugš
(
Widg‘
*) { }

307 
vœtu®
 
di¥©chDidCË¬WšdowObjeùInWÜld
(
DOMW¿µ”WÜld
*) { }

308 
vœtu®
 
docum’tEËm’tAvaabË
() { }

309 
vœtu®
 
didP”fÜmFœ¡Navig©iÚ
() const { }

311 
vœtu®
 
»gi¡”FÜIcÚNÙifiÿtiÚ
(
boŞ
) { }

313 #ià
USE
(
V8
)

314 
vœtu®
 
didC»©eSütCÚ‹xtFÜF¿me
() { }

315 
vœtu®
 
didDe¡roySütCÚ‹xtFÜF¿me
() { }

316 
vœtu®
 
didC»©eIsŞ©edSütCÚ‹xt
() { }

319 #ià
PLATFORM
(
MAC
)

320 
vœtu®
 
NSCachedURLRe¥Ú£
* 
wlCacheRe¥Ú£
(
Docum’tLßd”
*, , NSCachedURLRe¥Ú£* 
»¥Ú£
ècÚ¡ {  
	g»¥Ú£
; }

322 #ià
USE
(
CFNETWORK
)

323 
vœtu®
 
boŞ
 
shouldCacheRe¥Ú£
(
Docum’tLßd”
*, , cÚ¡ 
ResourûRe¥Ú£
&, cÚ¡ *, è{  
	gŒue
; }

328 
şass
 
	gEm±yEd™ÜCl›Á
 : 
public
 
Ed™ÜCl›Á
,…ubliø
	gNÚcİyabË
 {

329 
	gpublic
:

330 
vœtu®
 ~
Em±yEd™ÜCl›Á
() { }

331 
vœtu®
 
·geDe¡royed
() { }

333 
vœtu®
 
boŞ
 
shouldD–‘eRªge
(
Rªge
*è{  
çl£
; }

334 
vœtu®
 
boŞ
 
shouldShowD–‘eIÁ”çû
(
HTMLEËm’t
*è{  
	gçl£
; }

335 
vœtu®
 
boŞ
 
sm¬tIn£¹D–‘eEÇbËd
(è{  
	gçl£
; }

336 
vœtu®
 
boŞ
 
isS–eùT¿šgWh™e¥aûEÇbËd
(è{  
	gçl£
; }

337 
vœtu®
 
boŞ
 
isCÚtšuousS³ÎCheckšgEÇbËd
(è{  
	gçl£
; }

338 
vœtu®
 
toggËCÚtšuousS³ÎCheckšg
() { }

339 
vœtu®
 
boŞ
 
isG¿mm¬CheckšgEÇbËd
(è{  
	gçl£
; }

340 
vœtu®
 
toggËG¿mm¬Checkšg
() { }

341 
vœtu®
 
¥–lCheck”Docum’tTag
() {  -1; }

343 
vœtu®
 
boŞ
 
£ËùWÜdBefÜeM’uEv’t
(è{  
	gçl£
; }

344 
vœtu®
 
boŞ
 
isEd™abË
(è{  
	gçl£
; }

346 
vœtu®
 
boŞ
 
shouldBegšEd™šg
(
Rªge
*è{  
	gçl£
; }

347 
vœtu®
 
boŞ
 
shouldEndEd™šg
(
Rªge
*è{  
	gçl£
; }

348 
vœtu®
 
boŞ
 
shouldIn£¹Node
(
Node
*, 
Rªge
*, 
Ed™ÜIn£¹AùiÚ
è{  
	gçl£
; }

350 
vœtu®
 
boŞ
 
shouldIn£¹Text
(cÚ¡ 
SŒšg
&, 
Rªge
*, 
Ed™ÜIn£¹AùiÚ
è{  
	gçl£
; }

351 
vœtu®
 
boŞ
 
shouldChªgeS–eùedRªge
(
Rªge
*, Rªge*, 
EAffš™y
, boŞè{  
	gçl£
; }

353 
vœtu®
 
boŞ
 
shouldAµlyStyË
(
CSSStyËDeş¬©iÚ
*, 
Rªge
*è{  
	gçl£
; }

354 
vœtu®
 
boŞ
 
shouldMoveRªgeAá”D–‘e
(
Rªge
*, Rªge*è{  
	gçl£
; }

358 
vœtu®
 
didBegšEd™šg
() { }

359 
vœtu®
 
»¥ÚdToChªgedCÚ‹Ás
() { }

360 
vœtu®
 
»¥ÚdToChªgedS–eùiÚ
() { }

361 
vœtu®
 
didEndEd™šg
() { }

362 
vœtu®
 
didWr™eS–eùiÚToPa¡ebßrd
() { }

363 
vœtu®
 
didS‘S–eùiÚTy³sFÜPa¡ebßrd
() { }

368 
vœtu®
 
»gi¡”CommªdFÜUndo
(
PassRefPŒ
<
Ed™Commªd
>) { }

369 
vœtu®
 
»gi¡”CommªdFÜRedo
(
PassRefPŒ
<
Ed™Commªd
>) { }

370 
vœtu®
 
ş—rUndoRedoO³¿tiÚs
() { }

372 
vœtu®
 
boŞ
 
ÿnUndo
(ècÚ¡ {  
	gçl£
; }

373 
vœtu®
 
boŞ
 
ÿnRedo
(ècÚ¡ {  
	gçl£
; }

375 
vœtu®
 
undo
() { }

376 
vœtu®
 
»do
() { }

378 
vœtu®
 
hªdËKeybßrdEv’t
(
KeybßrdEv’t
*) { }

379 
vœtu®
 
hªdËIÅutM‘hodKeydown
(
KeybßrdEv’t
*) { }

381 
vœtu®
 
‹xtF›ldDidBegšEd™šg
(
EËm’t
*) { }

382 
vœtu®
 
‹xtF›ldDidEndEd™šg
(
EËm’t
*) { }

383 
vœtu®
 
‹xtDidChªgeInTextF›ld
(
EËm’t
*) { }

384 
vœtu®
 
boŞ
 
doTextF›ldCommªdFromEv’t
(
EËm’t
*, 
KeybßrdEv’t
*è{  
	gçl£
; }

385 
vœtu®
 
‹xtWlBeD–‘edInTextF›ld
(
EËm’t
*) { }

386 
vœtu®
 
‹xtDidChªgeInTextA»a
(
EËm’t
*) { }

388 #ià
PLATFORM
(
MAC
)

389 
vœtu®
 
m¬kedTextAbªdÚed
(
F¿me
*) { }

391 
vœtu®
 
NSSŒšg
* 
u£rVisibËSŒšg
(
NSURL
*) {  0; }

392 #ifdeà
BUILDING_ON_TIGER


393 
vœtu®
 
NSA¼ay
* 
·¡ebßrdTy³sFÜS–eùiÚ
(
F¿me
*) {  0; }

396 #ià
PLATFORM
(
MAC
è&& !
defšed
(
BUILDING_ON_TIGER
è&& !defšed(
BUILDING_ON_LEOPARD
)

397 
vœtu®
 
uµ”ÿ£WÜd
() { }

398 
vœtu®
 
low”ÿ£WÜd
() { }

399 
vœtu®
 
ÿp™®izeWÜd
() { }

400 
vœtu®
 
showSub¡™utiÚsPª–
(
boŞ
) { }

401 
vœtu®
 
boŞ
 
sub¡™utiÚsPª–IsShowšg
(è{  
	gçl£
; }

402 
vœtu®
 
toggËSm¬tIn£¹D–‘e
() { }

403 
vœtu®
 
boŞ
 
isAutom©icQuÙeSub¡™utiÚEÇbËd
(è{  
	gçl£
; }

404 
vœtu®
 
toggËAutom©icQuÙeSub¡™utiÚ
() { }

405 
vœtu®
 
boŞ
 
isAutom©icLškD‘eùiÚEÇbËd
(è{  
	gçl£
; }

406 
vœtu®
 
toggËAutom©icLškD‘eùiÚ
() { }

407 
vœtu®
 
boŞ
 
isAutom©icDashSub¡™utiÚEÇbËd
(è{  
	gçl£
; }

408 
vœtu®
 
toggËAutom©icDashSub¡™utiÚ
() { }

409 
vœtu®
 
boŞ
 
isAutom©icTextR•Ïûm’tEÇbËd
(è{  
	gçl£
; }

410 
vœtu®
 
toggËAutom©icTextR•Ïûm’t
() { }

411 
vœtu®
 
boŞ
 
isAutom©icS³ÎšgCÜ»ùiÚEÇbËd
(è{  
	gçl£
; }

412 
vœtu®
 
toggËAutom©icS³ÎšgCÜ»ùiÚ
() { }

414 
vœtu®
 
ignÜeWÜdInS³ÎDocum’t
(cÚ¡ 
SŒšg
&) { }

415 
vœtu®
 
Ë¬nWÜd
(cÚ¡ 
SŒšg
&) { }

416 
vœtu®
 
checkS³ÎšgOfSŒšg
(cÚ¡ 
UCh¬
*, , *, *) { }

417 
vœtu®
 
SŒšg
 
g‘AutoCÜ»ùSugge¡iÚFÜMis¥–ËdWÜd
(const String&) {  String(); }

418 
vœtu®
 
checkG¿mm¬OfSŒšg
(cÚ¡ 
UCh¬
*, , 
VeùÜ
<
G¿mm¬D‘a
>&, *, *) { }

419 #ià
PLATFORM
(
MAC
è&& !
defšed
(
BUILDING_ON_TIGER
è&& !defšed(
BUILDING_ON_LEOPARD
)

420 
vœtu®
 
checkTextOfP¬ag¿ph
(cÚ¡ 
UCh¬
*, , 
ušt64_t
, 
VeùÜ
<
TextCheckšgResuÉ
>&) { };

422 
vœtu®
 
upd©eS³ÎšgUIW™hG¿mm¬SŒšg
(cÚ¡ 
SŒšg
&, cÚ¡ 
G¿mm¬D‘a
&) { }

423 
vœtu®
 
upd©eS³ÎšgUIW™hMis¥–ËdWÜd
(cÚ¡ 
SŒšg
&) { }

424 
vœtu®
 
showS³ÎšgUI
(
boŞ
) { }

425 
vœtu®
 
boŞ
 
¥–lšgUIIsShowšg
(è{  
	gçl£
; }

426 
vœtu®
 
g‘Gues£sFÜWÜd
(cÚ¡ 
SŒšg
&, 
VeùÜ
<String>&) { }

427 
vœtu®
 
£tIÅutM‘hodS‹
(
boŞ
) { }

432 #ià
	$ENABLE
(
CONTEXT_MENUS
)

433 
şass
 
Em±yCÚ‹xtM’uCl›Á
 : 
public
 
CÚ‹xtM’uCl›Á
,…ubliø
NÚcİyabË
 {

434 
public
:

435 
vœtu®
 ~
	`Em±yCÚ‹xtM’uCl›Á
() { }

436 
vœtu®
 
	`cÚ‹xtM’uDe¡royed
() { }

438 
vœtu®
 
PÏtfÜmM’uDesütiÚ
 
	`g‘Cu¡omM’uFromDeçuÉI‹ms
(
CÚ‹xtM’u
*) {  0; }

439 
vœtu®
 
	`cÚ‹xtM’uI‹mS–eùed
(
CÚ‹xtM’uI‹m
*, cÚ¡ 
CÚ‹xtM’u
*) { }

441 
vœtu®
 
	`dowÆßdURL
(cÚ¡ 
KURL
&) { }

442 
vœtu®
 
	`cİyImageToClbßrd
(cÚ¡ 
H™Te¡ResuÉ
&) { }

443 
vœtu®
 
	`£¬chW™hGoogË
(cÚ¡ 
F¿me
*) { }

444 
vœtu®
 
	`lookUpInDiùiÚ¬y
(
F¿me
*) { }

445 
vœtu®
 
boŞ
 
	`isS³akšg
(è{  
çl£
; }

446 
vœtu®
 
	`¥—k
(cÚ¡ 
SŒšg
&) { }

447 
vœtu®
 
	`¡İS³akšg
() { }

449 #ià
	`PLATFORM
(
MAC
)

450 
vœtu®
 
	`£¬chW™hSpÙlight
() { }

452 
	}
};

455 #ià
	$ENABLE
(
DRAG_SUPPORT
)

456 
şass
 
Em±yD¿gCl›Á
 : 
public
 
D¿gCl›Á
,…ubliø
NÚcİyabË
 {

457 
public
:

458 
vœtu®
 ~
	`Em±yD¿gCl›Á
() {}

459 
vœtu®
 
	`wlP”fÜmD¿gDe¡š©iÚAùiÚ
(
D¿gDe¡š©iÚAùiÚ
, 
D¿gD©a
*) { }

460 
vœtu®
 
	`wlP”fÜmD¿gSourûAùiÚ
(
D¿gSourûAùiÚ
, cÚ¡ 
IÁPošt
&, 
Clbßrd
*) { }

461 
vœtu®
 
D¿gDe¡š©iÚAùiÚ
 
	`aùiÚMaskFÜD¿g
(
D¿gD©a
*è{  
D¿gDe¡š©iÚAùiÚNÚe
; }

462 
vœtu®
 
D¿gSourûAùiÚ
 
	`d¿gSourûAùiÚMaskFÜPošt
(cÚ¡ 
IÁPošt
&è{  
D¿gSourûAùiÚNÚe
; }

463 
vœtu®
 
	`¡¬tD¿g
(
D¿gImageRef
, cÚ¡ 
IÁPošt
&, cÚ¡ IÁPošt&, 
Clbßrd
*, 
F¿me
*, 
boŞ
) { }

464 
vœtu®
 
D¿gImageRef
 
	`ü—‹D¿gImageFÜLšk
(
KURL
&, cÚ¡ 
SŒšg
&, 
F¿me
*) {  0; }

465 
vœtu®
 
	`d¿gCÚŒŞËrDe¡royed
() { }

466 
	}
};

469 
şass
 
	gEm±yIn¥eùÜCl›Á
 : 
public
 
In¥eùÜCl›Á
,…ubliø
	gNÚcİyabË
 {

470 
	gpublic
:

471 
vœtu®
 ~
Em±yIn¥eùÜCl›Á
() { }

473 
vœtu®
 
š¥eùÜDe¡royed
() { }

475 
vœtu®
 
İ’In¥eùÜFrÚ‹nd
(
In¥eùÜCÚŒŞËr
*) { }

477 
vœtu®
 
highlight
(
Node
*) { }

478 
vœtu®
 
hideHighlight
() { }

480 
vœtu®
 
pİuÏ‹S‘tšg
(cÚ¡ 
SŒšg
&, String*) { }

481 
vœtu®
 
¡ÜeS‘tšg
(cÚ¡ 
SŒšg
&, const String&) { }

	@FTPDirectoryDocument.cpp

2 #ifdeà
SSLAB__DEBUG


3 #iâdeà
SSLAB__QDATETIME


4 
	#SSLAB__QDATETIME


	)

5 
	~<QD©eTime
>

9 #ifdeà
SSLAB__DEBUG


10 #iâdeà
SSLAB__QTHREAD


11 
	#SSLAB__QTHREAD


	)

12 
	~<QTh»ad
>

39 
	~"cÚfig.h
"

40 #ià
ENABLE
(
FTPDIR
)

41 
	~"FTPDœeùÜyDocum’t.h
"

43 
	~"Ch¬aù”Names.h
"

44 
	~"CSŒšg.h
"

45 
	~"HTMLNames.h
"

46 
	~"HTMLTabËEËm’t.h
"

47 
	~"HTMLTok’iz”.h
"

48 
	~"LoÿlizedSŒšgs.h
"

49 
	~"Loggšg.h
"

50 
	~"FTPDœeùÜyP¬£r.h
"

51 
	~"Segm’‹dSŒšg.h
"

52 
	~"S‘tšgs.h
"

53 
	~"Sh¬edBufãr.h
"

54 
	~"Text.h
"

56 
	~<wtf/Cu¼’tTime.h
>

57 
	~<wtf/StdLibExŒas.h
>

59 
usšg
 
Çme¥aû
 
	g¡d
;

61 
Çme¥aû
 
	gWebCÜe
 {

63 
usšg
 
Çme¥aû
 
	gHTMLNames
;

65 şas 
	cFTPDœeùÜyTok’iz”
 : 
public
 
HTMLTok’iz”
 {

66 
public
:

67 
FTPDœeùÜyTok’iz”
(
HTMLDocum’t
*);

69 
vœtu®
 
wr™e
(cÚ¡ 
Segm’‹dSŒšg
&, 
boŞ
 
­³ndD©a
);

70 
vœtu®
 
fšish
();

72 
vœtu®
 
boŞ
 
isWa™šgFÜSüts
(ècÚ¡ {  
	gçl£
; }

74 
šlše
 
checkBufãr
(
Ën
 = 10)

76 ià((
m_de¡
 - 
m_bufãr
è> 
m_size
 - 
Ën
) {

78 
ÃwSize
 = 
max
(
m_size
 * 2, m_siz+ 
Ën
);

79 
	gŞdOff£t
 = 
m_de¡
 - 
m_bufãr
;

80 
	gm_bufãr
 = 
¡©ic_ÿ¡
<
UCh¬
*>(
ç¡R—Îoc
(
m_bufãr
, 
ÃwSize
 * (UChar)));

81 
	gm_de¡
 = 
m_bufãr
 + 
ŞdOff£t
;

82 
	gm_size
 = 
ÃwSize
;

86 
	g´iv©e
:

90 
boŞ
 
lßdDocum’tTem¶©e
();

91 
ü—‹BasicDocum’t
();

93 
·r£AndAµ’dOÃLše
(cÚ¡ 
SŒšg
&);

94 
­³ndEÁry
(cÚ¡ 
SŒšg
& 
Çme
, cÚ¡ SŒšg& 
size
, cÚ¡ SŒšg& 
d©e
, 
boŞ
 
isDœeùÜy
);

95 
	gPassRefPŒ
<
	gEËm’t
> 
ü—‹TDFÜF’ame
(cÚ¡ 
SŒšg
&);

97 
Docum’t
* 
	gm_doc
;

98 
	gRefPŒ
<
	gHTMLTabËEËm’t
> 
	gm_bËEËm’t
;

100 
boŞ
 
	gm_skLF
;

101 
boŞ
 
	gm_·r£dTem¶©e
;

103 
	gm_size
;

104 
UCh¬
* 
	gm_bufãr
;

105 
UCh¬
* 
	gm_de¡
;

106 
SŒšg
 
	gm_ÿ¼yOv”
;

108 
Li¡S‹
 
	gm_li¡S‹
;

111 
	gFTPDœeùÜyTok’iz”
::
	$FTPDœeùÜyTok’iz”
(
HTMLDocum’t
* 
doc
)

112 : 
	`HTMLTok’iz”
(
doc
, 
çl£
)

113 , 
	`m_doc
(
doc
)

114 , 
	`m_skLF
(
çl£
)

115 , 
	`m_·r£dTem¶©e
(
çl£
)

116 , 
	`m_size
(254)

117 , 
	`m_bufãr
(
¡©ic_ÿ¡
<
UCh¬
*>(
	`ç¡M®loc
((UCh¬è* 
m_size
)))

118 , 
	$m_de¡
(
m_bufãr
)

120 #ifdeà
SSLAB__DEBUG


121 
	`qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
	`cu¼’tD©eTime
().
	`toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
	`toAscii
().
	`d©a
(), 
QTh»ad
::
	`cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

124 
	}
}

126 
	gFTPDœeùÜyTok’iz”
::
	$­³ndEÁry
(cÚ¡ 
SŒšg
& 
f’ame
, cÚ¡ SŒšg& 
size
, cÚ¡ SŒšg& 
d©e
, 
boŞ
 
isDœeùÜy
)

128 #ifdeà
SSLAB__DEBUG


129 
	`qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
	`cu¼’tD©eTime
().
	`toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
	`toAscii
().
	`d©a
(), 
QTh»ad
::
	`cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

132 
Exû±iÚCode
 
ec
;

134 
RefPŒ
<
EËm’t
> 
rowEËm’t
 = 
m_bËEËm’t
->
	`š£¹Row
(-1, 
ec
);

135 
rowEËm’t
->
	`£tA‰ribu‹
("şass", "ápDœeùÜyEÁryRow", 
ec
);

137 
RefPŒ
<
EËm’t
> 
–em’t
 = 
m_doc
->
	`ü—‹EËm’t
(
tdTag
, 
çl£
);

138 
–em’t
->
	`­³ndChd
(
Text
::
	`ü—‹
(
m_doc
, 
	`SŒšg
(&
noB»akS·û
, 1)), 
ec
);

139 ià(
isDœeùÜy
)

140 
–em’t
->
	`£tA‰ribu‹
("şass", "ápDœeùÜyIcÚ fDœeùÜyTy³DœeùÜy", 
ec
);

142 
–em’t
->
	`£tA‰ribu‹
("şass", "ápDœeùÜyIcÚ fDœeùÜyTy³Fe", 
ec
);

143 
rowEËm’t
->
	`­³ndChd
(
–em’t
, 
ec
);

145 
–em’t
 = 
	`ü—‹TDFÜF’ame
(
f’ame
);

146 
–em’t
->
	`£tA‰ribu‹
("şass", "ápDœeùÜyFeName", 
ec
);

147 
rowEËm’t
->
	`­³ndChd
(
–em’t
, 
ec
);

149 
–em’t
 = 
m_doc
->
	`ü—‹EËm’t
(
tdTag
, 
çl£
);

150 
–em’t
->
	`­³ndChd
(
Text
::
	`ü—‹
(
m_doc
, 
d©e
), 
ec
);

151 
–em’t
->
	`£tA‰ribu‹
("şass", "ápDœeùÜyFeD©e", 
ec
);

152 
rowEËm’t
->
	`­³ndChd
(
–em’t
, 
ec
);

154 
–em’t
 = 
m_doc
->
	`ü—‹EËm’t
(
tdTag
, 
çl£
);

155 
–em’t
->
	`­³ndChd
(
Text
::
	`ü—‹
(
m_doc
, 
size
), 
ec
);

156 
–em’t
->
	`£tA‰ribu‹
("şass", "ápDœeùÜyFeSize", 
ec
);

157 
rowEËm’t
->
	`­³ndChd
(
–em’t
, 
ec
);

158 
	}
}

160 
	gPassRefPŒ
<
	gEËm’t
> 
	gFTPDœeùÜyTok’iz”
::
	$ü—‹TDFÜF’ame
(cÚ¡ 
SŒšg
& 
f’ame
)

162 #ifdeà
SSLAB__DEBUG


163 
	`qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
	`cu¼’tD©eTime
().
	`toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
	`toAscii
().
	`d©a
(), 
QTh»ad
::
	`cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

166 
Exû±iÚCode
 
ec
;

168 
SŒšg
 
fuÎURL
 = 
m_doc
->
	`ba£URL
().
	`¡ršg
();

169 ià(
fuÎURL
[fuÎURL.
	`Ëngth
() - 1] == '/')

170 
fuÎURL
.
	`­³nd
(
f’ame
);

172 
fuÎURL
.
	`­³nd
("/" + 
f’ame
);

174 
RefPŒ
<
EËm’t
> 
ªchÜEËm’t
 = 
m_doc
->
	`ü—‹EËm’t
(
aTag
, 
çl£
);

175 
ªchÜEËm’t
->
	`£tA‰ribu‹
("h»f", 
fuÎURL
, 
ec
);

176 
ªchÜEËm’t
->
	`­³ndChd
(
Text
::
	`ü—‹
(
m_doc
, 
f’ame
), 
ec
);

178 
RefPŒ
<
EËm’t
> 
tdEËm’t
 = 
m_doc
->
	`ü—‹EËm’t
(
tdTag
, 
çl£
);

179 
tdEËm’t
->
	`­³ndChd
(
ªchÜEËm’t
, 
ec
);

181  
tdEËm’t
.
	`»Ëa£
();

182 
	}
}

184 
SŒšg
 
	$´oûssFesizeSŒšg
(cÚ¡ 
SŒšg
& 
size
, 
boŞ
 
isDœeùÜy
)

186 #ifdeà
SSLAB__DEBUG


187 
	`qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
	`cu¼’tD©eTime
().
	`toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
	`toAscii
().
	`d©a
(), 
QTh»ad
::
	`cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

190 ià(
isDœeùÜy
)

193 
boŞ
 
v®id
;

194 
št64_t
 
by‹s
 = 
size
.
	`toUIÁ64
(&
v®id
);

195 ià(!
v®id
)

196  
	`unknownFeSizeText
();

198 ià(
by‹s
 < 1000000)

199  
SŒšg
::
	`fÜm©
("%.2àKB", 
¡©ic_ÿ¡
<>(
by‹s
)/1000);

201 ià(
by‹s
 < 1000000000)

202  
SŒšg
::
	`fÜm©
("%.2àMB", 
¡©ic_ÿ¡
<>(
by‹s
)/1000000);

204  
SŒšg
::
	`fÜm©
("%.2àGB", 
¡©ic_ÿ¡
<>(
by‹s
)/1000000000);

205 
	}
}

207 
boŞ
 
	$wasLa¡DayOfMÚth
(
y—r
, 
mÚth
, 
day
)

209 #ifdeà
SSLAB__DEBUG


210 
	`qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
	`cu¼’tD©eTime
().
	`toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
	`toAscii
().
	`d©a
(), 
QTh»ad
::
	`cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

213 
Ï¡Days
[] = { 31, 0, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31 };

214 ià(
mÚth
 < 0 || month > 11)

215  
çl£
;

217 ià(
mÚth
 == 2) {

218 ià(
y—r
 % 4 == 0 && (year % 100 || year % 400 == 0)) {

219 ià(
day
 == 29)

220  
Œue
;

221  
çl£
;

224 ià(
day
 == 28)

225  
Œue
;

226  
çl£
;

229  
Ï¡Days
[
mÚth
] =ğ
day
;

230 
	}
}

232 
SŒšg
 
	$´oûssFeD©eSŒšg
(cÚ¡ 
FTPTime
& 
feTime
)

234 #ifdeà
SSLAB__DEBUG


235 
	`qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
	`cu¼’tD©eTime
().
	`toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
	`toAscii
().
	`d©a
(), 
QTh»ad
::
	`cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

240 
SŒšg
 
timeOfDay
;

242 ià(!(
feTime
.
tm_hour
 =ğ0 && feTime.
tm_mš
 =ğ0 && feTime.
tm_£c
 == 0)) {

243 
hour
 = 
feTime
.
tm_hour
;

244 
	`ASSERT
(
hour
 >= 0 && hour < 24);

246 ià(
hour
 < 12) {

247 ià(
hour
 == 0)

248 
hour
 = 12;

249 
timeOfDay
 = 
SŒšg
::
	`fÜm©
(", %i:%02˜AM", 
hour
, 
feTime
.
tm_mš
);

251 
hour
 = hour - 12;

252 ià(
hour
 == 0)

253 
hour
 = 12;

254 
timeOfDay
 = 
SŒšg
::
	`fÜm©
(", %i:%02˜PM", 
hour
, 
feTime
.
tm_mš
);

259 
tm
 
now
;

260 
time_t
 
now_t
 = 
	`time
(
NULL
);

261 
	`g‘LoÿlTime
(&
now_t
, &
now
);

264 
now
.
tm_y—r
 += 1900;

266 ià(
feTime
.
tm_y—r
 =ğ
now
.tm_year) {

267 ià(
feTime
.
tm_mÚ
 =ğ
now
.tm_mon) {

268 ià(
feTime
.
tm_mday
 =ğ
now
.tm_mday)

269  "Today" + 
timeOfDay
;

270 ià(
feTime
.
tm_mday
 =ğ
now
.tm_mday - 1)

271  "Ye¡”day" + 
timeOfDay
;

274 ià(
now
.
tm_mday
 =ğ1 && (now.
tm_mÚ
 =ğ
feTime
.tm_mon + 1 || (now.tm_mon == 0 && fileTime.tm_mon == 11)) &&

275 
	`wasLa¡DayOfMÚth
(
feTime
.
tm_y—r
, feTime.
tm_mÚ
, feTime.
tm_mday
))

276  "Ye¡”day" + 
timeOfDay
;

279 ià(
feTime
.
tm_y—r
 =ğ
now
.tm_y—¸- 1 && feTime.
tm_mÚ
 =ğ12 && feTime.
tm_mday
 == 31 &&‚ow.tm_mon == 1 &&‚ow.tm_mday == 1)

280  "Ye¡”day" + 
timeOfDay
;

282 cÚ¡ * 
mÚths
[] = { "Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec", "???" };

284 
mÚth
 = 
feTime
.
tm_mÚ
;

285 ià(
mÚth
 < 0 || month > 11)

286 
mÚth
 = 12;

288 
SŒšg
 
d©eSŒšg
;

290 ià(
feTime
.
tm_y—r
 > -1)

291 
d©eSŒšg
 = 
SŒšg
::
	`fÜm©
("% %i, %i", 
mÚths
[
mÚth
], 
feTime
.
tm_mday
, feTime.
tm_y—r
);

293 
d©eSŒšg
 = 
SŒšg
::
	`fÜm©
("% %i, %i", 
mÚths
[
mÚth
], 
feTime
.
tm_mday
, 
now
.
tm_y—r
);

295  
d©eSŒšg
 + 
timeOfDay
;

296 
	}
}

298 
	gFTPDœeùÜyTok’iz”
::
	$·r£AndAµ’dOÃLše
(cÚ¡ 
SŒšg
& 
šputLše
)

300 #ifdeà
SSLAB__DEBUG


301 
	`qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
	`cu¼’tD©eTime
().
	`toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
	`toAscii
().
	`d©a
(), 
QTh»ad
::
	`cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

304 
Li¡ResuÉ
 
»suÉ
;

305 
CSŒšg
 
Ïtš1IÅut
 = 
šputLše
.
	`Ïtš1
();

307 
FTPEÁryTy³
 
ty³ResuÉ
 = 
	`·r£OÃFTPLše
(
Ïtš1IÅut
.
	`d©a
(), 
m_li¡S‹
, 
»suÉ
);

310 ià(
ty³ResuÉ
 =ğ
FTPMiscEÁry
 ||y³ResuÉ =ğ
FTPJunkEÁry
)

313 
SŒšg
 
	`f’ame
(
»suÉ
.
f’ame
,„esuÉ.
f’ameL’gth
);

314 ià(
»suÉ
.
ty³
 =ğ
FTPDœeùÜyEÁry
) {

315 
f’ame
.
	`­³nd
("/");

318 ià(
f’ame
 == "./")

322 
	`LOG
(
FTP
, "Aµ’dšgƒÁry - %s, %s", 
f’ame
.
	`ascii
().
	`d©a
(), 
»suÉ
.
feSize
.ascii().data());

324 
	`­³ndEÁry
(
f’ame
, 
	`´oûssFesizeSŒšg
(
»suÉ
.
feSize
,„esuÉ.
ty³
 =ğ
FTPDœeùÜyEÁry
), 
	`´oûssFeD©eSŒšg
ÔesuÉ.
modif›dTime
),„esult.type == FTPDirectoryEntry);

325 
	}
}

327 
šlše
 
	gPassRefPŒ
<
	gSh¬edBufãr
> 
	$ü—‹Tem¶©eDocum’tD©a
(
S‘tšgs
* 
£‰šgs
)

329 #ifdeà
SSLAB__DEBUG


330 
	`qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
	`cu¼’tD©eTime
().
	`toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
	`toAscii
().
	`d©a
(), 
QTh»ad
::
	`cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

333 
RefPŒ
<
Sh¬edBufãr
> 
bufãr
 = 0;

334 ià(
£‰šgs
)

335 
bufãr
 = 
Sh¬edBufãr
::
	`ü—‹W™hCÚ‹ÁsOfFe
(
£‰šgs
->
	`ápDœeùÜyTem¶©eP©h
());

336 ià(
bufãr
)

337 
	`LOG
(
FTP
, "Lßded FTPDœeùÜyTem¶©oàËngth %i\n", 
bufãr
->
	`size
());

338  
bufãr
.
	`»Ëa£
();

339 
	}
}

341 
boŞ
 
	gFTPDœeùÜyTok’iz”
::
	$lßdDocum’tTem¶©e
()

343 #ifdeà
SSLAB__DEBUG


344 
	`qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
	`cu¼’tD©eTime
().
	`toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
	`toAscii
().
	`d©a
(), 
QTh»ad
::
	`cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

347 
	`DEFINE_STATIC_LOCAL
(
RefPŒ
<
Sh¬edBufãr
>, 
‹m¶©eDocum’tD©a
, (
	`ü—‹Tem¶©eDocum’tD©a
(
m_doc
->
	`£‰šgs
())));

352 ià(!
‹m¶©eDocum’tD©a
) {

353 
	`LOG_ERROR
("Could‚ot†oademplateData");

354  
çl£
;

358 
	`£tFÜûSynchrÚous
(
Œue
);

359 
HTMLTok’iz”
::
	`wr™e
(
	`SŒšg
(
‹m¶©eDocum’tD©a
->
	`d©a
(),em¶©eDocum’tD©a->
	`size
()), 
Œue
);

360 
	`£tFÜûSynchrÚous
(
çl£
);

362 
RefPŒ
<
EËm’t
> 
bËEËm’t
 = 
m_doc
->
	`g‘EËm’tById
("ftpDirectoryTable");

363 ià(!
bËEËm’t
)

364 
	`LOG_ERROR
("Unableo findƒlement by id \"ftpDirectoryTable\" inheemplate document.");

365 ià(!
bËEËm’t
->
	`hasTagName
(
bËTag
))

366 
	`LOG_ERROR
("Element of id \"ftpDirectoryTable\" is‚ot‡ableƒlement");

368 
m_bËEËm’t
 = 
¡©ic_ÿ¡
<
HTMLTabËEËm’t
*>(
bËEËm’t
.
	`g‘
());

371 ià(
m_bËEËm’t
)

372  
Œue
;

375 
bËEËm’t
 = 
m_doc
->
	`ü—‹EËm’t
(
bËTag
, 
çl£
);

376 
m_bËEËm’t
 = 
¡©ic_ÿ¡
<
HTMLTabËEËm’t
*>(
bËEËm’t
.
	`g‘
());

377 
Exû±iÚCode
 
ec
;

378 
m_bËEËm’t
->
	`£tA‰ribu‹
("id", "ápDœeùÜyTabË", 
ec
);

383 ià(
EËm’t
* 
body
 = 
m_doc
->
	`body
())

384 
body
->
	`­³ndChd
(
m_bËEËm’t
, 
ec
);

386 
m_doc
->
	`­³ndChd
(
m_bËEËm’t
, 
ec
);

388  
Œue
;

389 
	}
}

391 
	gFTPDœeùÜyTok’iz”
::
	$ü—‹BasicDocum’t
()

393 #ifdeà
SSLAB__DEBUG


394 
	`qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
	`cu¼’tD©eTime
().
	`toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
	`toAscii
().
	`d©a
(), 
QTh»ad
::
	`cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

397 
	`LOG
(
FTP
, "Creating‡ basic FTP document structure‡s‚oemplate was†oaded");

402 
RefPŒ
<
EËm’t
> 
bodyEËm’t
 = 
m_doc
->
	`ü—‹EËm’t
(
bodyTag
, 
çl£
);

404 
Exû±iÚCode
 
ec
;

405 
m_doc
->
	`­³ndChd
(
bodyEËm’t
, 
ec
);

407 
RefPŒ
<
EËm’t
> 
bËEËm’t
 = 
m_doc
->
	`ü—‹EËm’t
(
bËTag
, 
çl£
);

408 
m_bËEËm’t
 = 
¡©ic_ÿ¡
<
HTMLTabËEËm’t
*>(
bËEËm’t
.
	`g‘
());

409 
m_bËEËm’t
->
	`£tA‰ribu‹
("id", "ápDœeùÜyTabË", 
ec
);

411 
bodyEËm’t
->
	`­³ndChd
(
m_bËEËm’t
, 
ec
);

412 
	}
}

414 
	gFTPDœeùÜyTok’iz”
::
	$wr™e
(cÚ¡ 
Segm’‹dSŒšg
& 
s
, 
boŞ
 )

418 ià(!
m_bËEËm’t
) {

419 ià(!
	`lßdDocum’tTem¶©e
())

420 
	`ü—‹BasicDocum’t
();

421 
	`ASSERT
(
m_bËEËm’t
);

424 
boŞ
 
foundNewLše
 = 
çl£
;

426 
m_de¡
 = 
m_bufãr
;

427 
Segm’‹dSŒšg
 
¡r
 = 
s
;

428 !
¡r
.
	`isEm±y
()) {

429 
UCh¬
 
c
 = *
¡r
;

431 ià(
c
 == '\r') {

432 *
m_de¡
++ = '\n';

433 
foundNewLše
 = 
Œue
;

435 
m_skLF
 = 
Œue
;

436 } ià(
c
 == '\n') {

437 ià(!
m_skLF
)

438 *
m_de¡
++ = 
c
;

440 
m_skLF
 = 
çl£
;

442 *
m_de¡
++ = 
c
;

443 
m_skLF
 = 
çl£
;

446 
¡r
.
	`advªû
();

449 
	`checkBufãr
();

452 ià(!
foundNewLše
) {

453 
m_de¡
 = 
m_bufãr
;

457 
UCh¬
* 
¡¬t
 = 
m_bufãr
;

458 
UCh¬
* 
cursÜ
 = 
¡¬t
;

460 
cursÜ
 < 
m_de¡
) {

461 ià(*
cursÜ
 == '\n') {

462 
m_ÿ¼yOv”
.
	`­³nd
(
	`SŒšg
(
¡¬t
, 
cursÜ
 - start));

463 
	`LOG
(
FTP
, "%s", 
m_ÿ¼yOv”
.
	`ascii
().
	`d©a
());

464 
	`·r£AndAµ’dOÃLše
(
m_ÿ¼yOv”
);

465 
m_ÿ¼yOv”
 = 
	`SŒšg
();

467 
¡¬t
 = ++
cursÜ
;

469 
cursÜ
++;

473 ià(
cursÜ
 - 
¡¬t
 > 1)

474 
m_ÿ¼yOv”
.
	`­³nd
(
	`SŒšg
(
¡¬t
, 
cursÜ
 - start - 1));

475 
	}
}

477 
	gFTPDœeùÜyTok’iz”
::
	$fšish
()

479 #ifdeà
SSLAB__DEBUG


480 
	`qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
	`cu¼’tD©eTime
().
	`toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
	`toAscii
().
	`d©a
(), 
QTh»ad
::
	`cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

484 ià(!
m_ÿ¼yOv”
.
	`isEm±y
()) {

485 
	`·r£AndAµ’dOÃLše
(
m_ÿ¼yOv”
);

486 
m_ÿ¼yOv”
 = 
	`SŒšg
();

489 
m_bËEËm’t
 = 0;

490 
	`ç¡F»e
(
m_bufãr
);

492 
HTMLTok’iz”
::
	`fšish
();

493 
	}
}

495 
	gFTPDœeùÜyDocum’t
::
	$FTPDœeùÜyDocum’t
(
F¿me
* 
äame
)

496 : 
	$HTMLDocum’t
(
äame
)

498 #ifdeà
SSLAB__DEBUG


499 
	`qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
	`cu¼’tD©eTime
().
	`toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
	`toAscii
().
	`d©a
(), 
QTh»ad
::
	`cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

502 #iâdeà
NDEBUG


503 
LogFTP
.
¡©e
 = 
WTFLogChªÃlOn
;

505 
	}
}

507 
Tok’iz”
* 
	gFTPDœeùÜyDocum’t
::
	$ü—‹Tok’iz”
()

509 #ifdeà
SSLAB__DEBUG


510 
	`qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
	`cu¼’tD©eTime
().
	`toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
	`toAscii
().
	`d©a
(), 
QTh»ad
::
	`cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

513  
Ãw
 
	`FTPDœeùÜyTok’iz”
(
this
);

514 
	}
}

	@FTPDirectoryDocument.h

25 #iâdeà
FTPDœeùÜyDocum’t_h


26 
	#FTPDœeùÜyDocum’t_h


	)

28 
	~"HTMLDocum’t.h
"

30 
Çme¥aû
 
	gWebCÜe
 {

32 
şass
 
	gDOMIm¶em’tiÚ
;

34 şas 
	cFTPDœeùÜyDocum’t
 : 
public
 
HTMLDocum’t
 {

35 
public
:

36 
PassRefPŒ
<
FTPDœeùÜyDocum’t
> 
ü—‹
(
F¿me
* 
äame
)

38  
adİtRef
(
Ãw
 
FTPDœeùÜyDocum’t
(
äame
));

41 
	g´iv©e
:

42 
FTPDœeùÜyDocum’t
(
F¿me
*);

43 
vœtu®
 
Tok’iz”
* 
ü—‹Tok’iz”
();

	@FTPDirectoryParser.cpp

2 #ifdeà
SSLAB__DEBUG


3 #iâdeà
SSLAB__QDATETIME


4 
	#SSLAB__QDATETIME


	)

5 
	~<QD©eTime
>

9 #ifdeà
SSLAB__DEBUG


10 #iâdeà
SSLAB__QTHREAD


11 
	#SSLAB__QTHREAD


	)

12 
	~<QTh»ad
>

37 
	~"cÚfig.h
"

38 #ià
ENABLE
(
FTPDIR
)

39 
	~"FTPDœeùÜyP¬£r.h
"

41 #ià
PLATFORM
(
QT
)

42 
	~<QD©eTime
>

44 #–ià
OS
(
WINDOWS
è&& (
USE
(
PTHREADS
è|| 
HAVE
(
PTHREAD_H
))

45 
	~<±h»ad.h
>

48 
	~<wtf/ASCIICTy³.h
>

49 
	~<¡dio.h
>

51 
usšg
 
Çme¥aû
 
	gWTF
;

53 
Çme¥aû
 
	gWebCÜe
 {

54 #ià
PLATFORM
(
QT
è&& 
defšed
(
Q_WS_WIN32
)

58 
tm
 
gmtimeQt
(cÚ¡ 
QD©eTime
& 
šput
)

60 #ifdeà
SSLAB__DEBUG


61 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

64 
tm
 
	g»suÉ
;

66 
QD©e
 
d©e
(
šput
.date());

67 
	g»suÉ
.
	gtm_y—r
 = 
d©e
.
y—r
() - 1900;

68 
	g»suÉ
.
	gtm_mÚ
 = 
d©e
.
mÚth
();

69 
	g»suÉ
.
	gtm_mday
 = 
d©e
.
day
();

70 
	g»suÉ
.
	gtm_wday
 = 
d©e
.
dayOfW“k
();

71 
	g»suÉ
.
	gtm_yday
 = 
d©e
.
dayOfY—r
();

73 
QTime
 
time
(
šput
.time());

74 
	g»suÉ
.
	gtm_£c
 = 
time
.
£cÚd
();

75 
	g»suÉ
.
	gtm_mš
 = 
time
.
mšu‹
();

76 
	g»suÉ
.
	gtm_hour
 = 
time
.
hour
();

78  
	g»suÉ
;

81 
tm
 *
gmtimeQt
(cÚ¡ 
time_t
 *cÚ¡ 
tim•
, tm *
»suÉ
)

83 #ifdeà
SSLAB__DEBUG


84 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

87 cÚ¡ 
QD©eTime
 
dt
(QD©eTime::
äomTime_t
(*
tim•
));

88 *
	g»suÉ
 = 
WebCÜe
::
gmtimeQt
(
dt
);

89  
	g»suÉ
;

92 
	#gmtime_r
(
x
, 
y
è
	`gmtimeQt
(x, y)

	)

93 #–ià
OS
(
WINDOWS
è&& !
defšed
(
gmtime_r
)

94 #ià
defšed
(
_MSC_VER
) && (_MSC_VER >= 1400)

95 
	#gmtime_r
(
x
, 
y
è
	`gmtime_s
((y), (x))

	)

97 
	#gmtime_r
(
x
,
y
è(
	`gmtime
(x)?(*(y)=*gmtime(x),(y)):0)

	)

101 
šlše
 
FTPEÁryTy³
 
P¬sšgFaed
(
Li¡S‹
& 
¡©e
)

103 #ifdeà
SSLAB__DEBUG


104 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

107 ià(
	g¡©e
.
	g·r£dOÃ
 || s‹.
	gli¡StyË
)

108  
	gFTPJunkEÁry
;

109  
	gFTPMiscEÁry
;

112 
FTPEÁryTy³
 
·r£OÃFTPLše
(cÚ¡ * 
lše
, 
Li¡S‹
& 
¡©e
, 
Li¡ResuÉ
& 
»suÉ
)

114 #ifdeà
SSLAB__DEBUG


115 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

118 
	g»suÉ
.
ş—r
();

120 ià(!
	glše
)

121  
	gFTPJunkEÁry
;

123 
	g¡©e
.
	gnumLšes
++;

126 
	gÿ¼y_buf_Ën
 = 
¡©e
.
ÿ¼yBufãrL’gth
;

127 
	g¡©e
.
	gÿ¼yBufãrL’gth
 = 0;

129 
	glš–’
 = 0;

132 *
	glše
 =ğ' ' || *
lše
 == '\t')

133 
lše
++;

136 cÚ¡ * 
	gp
 = 
lše
;

137 *
	gp
 && *p != '\n')

138 
p
++;

139 
	glš–’
 = 
p
 - 
lše
;

141 ià(
	glš–’
 > 0 && *
	gp
 =ğ'\n' && *(
p
-1) == '\r')

142 
lš–’
--;

146 ià(
	glš–’
 > 0)

148 cÚ¡ *
	gmÚth_Çmes
 = "JanFebMarAprMayJunJulAugSepOctNovDec";

149 cÚ¡ *
	gtok’s
[16];

150 
	gtokËn
[((
tok’s
)/(tokens[0]))];

151 
	glš–’_§ns_w¥
;

152 
	gnumtoks
 = 0;

153 
	gtokm¬k”
 = 0;

154 
	gmÚth_num
 = 0;

155 
	gtbuf
[4];

156 
	gl¡yË
 = 0;

158 ià(
	gÿ¼y_buf_Ën
)

160 
	gtok’s
[0] = 
¡©e
.
ÿ¼yBufãr
;

161 
	gtokËn
[0] = 
ÿ¼y_buf_Ën
;

162 
	gnumtoks
++;

165 
	gpos
 = 0;

166 
	gpos
 < 
	glš–’
 && 
	gnumtoks
 < ((
	gtok’s
)/(tokens[0])) )

168 
	gpos
 < 
	glš–’
 &&

169 (
	glše
[
pos
] =ğ' ' || 
lše
[pos] == '\t' ||†ine[pos] == '\r'))

170 
pos
++;

171 ià(
	gpos
 < 
	glš–’
)

173 
	gtok’s
[
numtoks
] = &
lše
[
pos
];

174 
	gpos
 < 
	glš–’
 &&

175 (
	glše
[
pos
] !ğ' ' && 
lše
[pos] != '\t' &&†ine[pos] != '\r'))

176 
pos
++;

177 ià(
	gtok’s
[
numtoks
] !ğ&
lše
[
pos
])

179 
tokËn
[
numtoks
] = (&
lše
[
pos
] - 
tok’s
[numtoks]);

180 
	gnumtoks
++;

185 ià(!
	gnumtoks
)

186  
P¬sšgFaed
(
¡©e
);

188 
	glš–’_§ns_w¥
 = &(
tok’s
[
numtoks
-1][
tokËn
[numtoks-1]]) -okens[0];

189 ià(
	gnumtoks
 =ğ((
tok’s
)/(tokens[0])) )

191 
pos
 = 
lš–’
;

192 
	gpos
 > 0 && (
	glše
[
pos
-1] =ğ' ' || 
lše
[pos-1] == '\t'))

193 
pos
--;

194 
	glš–’_§ns_w¥
 = 
pos
;

198 #ià
defšed
(
SUPPORT_EPLF
)

200 ià(!
	gl¡yË
 && (!
	g¡©e
.
	gli¡StyË
 || state.listStyle == 'E'))

202 ià(*
lše
 =ğ'+' && 
lš–’
 > 4 && 
numtoks
 >= 2)

204 
pos
 = 1;

205 
	gpos
 < (
	glš–’
-1))

207 
	gp
 = &
lše
[
pos
++];

208 ià(*
	gp
 == '/')

209 
»suÉ
.
ty³
 = 
FTPDœeùÜyEÁry
;

210 ià(*
	gp
 == 'r')

211 
»suÉ
.
ty³
 = 
FTPFeEÁry
;

212 ià(*
	gp
 == 'm')

214 ià(
isASCIIDig™
(
lše
[
pos
]))

216 
pos
 < 
lš–’
 && 
isASCIIDig™
(
lše
[pos]))

217 
pos
++;

218 ià(
	gpos
 < 
	glš–’
 && 
	glše
[
pos
] == ',')

220 
£cÚds
 = 0;

221 
ssÿnf
(
p
 + 1, "%Îu", &
£cÚds
);

222 
time_t
 
	gt
 = 
¡©ic_ÿ¡
<time_t>(
£cÚds
);

225 
gmtime_r
(&
t
, &
»suÉ
.
modif›dTime
);

226 
	g»suÉ
.
	gmodif›dTime
.
	gtm_y—r
 += 1900;

230 ià(*
	gp
 == 's')

232 ià(
isASCIIDig™
(
lše
[
pos
]))

234 
pos
 < 
lš–’
 && 
isASCIIDig™
(
lše
[pos]))

235 
pos
++;

236 ià(
	gpos
 < 
	glš–’
 && 
	glše
[
pos
] == ',')

237 
»suÉ
.
feSize
 = 
SŒšg
(
p
 + 1, &
lše
[
pos
] -… + 1);

240 ià(
isASCIIAÍha
(*
p
))

242 
	gpos
 < 
	glš–’
 && *++
	gp
 != ',')

243 
pos
++;

245 ià(*
	gp
 !ğ'\t' || (
p
+1è!ğ
tok’s
[1])

251 
	g¡©e
.
	g·r£dOÃ
 = 
Œue
;

252 
	g¡©e
.
	gli¡StyË
 = 
l¡yË
 = 'E';

254 
	gp
 = &(
lše
[
lš–’_§ns_w¥
]);

255 
	g»suÉ
.
	gf’ame
 = 
tok’s
[1];

256 
	g»suÉ
.
	gf’ameL’gth
 = 
p
 - 
tok’s
[1];

258 ià(!
	g»suÉ
.
	gty³
)

260 
	g»suÉ
.
	gty³
 = 
FTPFeEÁry
;

261  
	gFTPJunkEÁry
;

263  
	g»suÉ
.
	gty³
;

265 ià(
	gpos
 >ğ(
lš–’
-1è|| 
lše
[
pos
] != ',')

267 
	gpos
++;

269 
	g»suÉ
.
ş—r
();

276 #ià
defšed
(
SUPPORT_VMS
)

277 ià(!
	gl¡yË
 && (!
	g¡©e
.
	gli¡StyË
 || state.listStyle == 'V'))

290 ià(!
¡©e
.
·r£dOÃ
 &&

291 (
numtoks
 =ğ1 || (numtok =ğ2 && 
tokËn
[0] == 9 &&

292 
memcmp
(
tok’s
[0], "Directory", 9)==0 )))

298 
p
 = 
tok’s
[0];

299 
	gpos
 = 
tokËn
[0];

300 ià(
	gnumtoks
 == 2)

302 
p
 = 
tok’s
[1];

303 
	gpos
 = 
tokËn
[1];

305 
	gpos
--;

306 ià(
	gpos
 >= 3)

308 
pos
 > 0 && 
p
[pos] != '[')

310 
pos
--;

311 ià(
	gp
[
pos
] =ğ'-' || 
p
[pos] == '$')

313 ià(
pos
 =ğ0 || 
p
[pos-1] == '[' ||…[pos-1] == '.' ||

314 (
p
[
pos
] == '-' && (p[pos+1] == ']' ||…[pos+1] == '.')))

317 ià(
	gp
[
pos
] !ğ'.' && 
p
[pos] != '~' &&

318 !
isASCIIDig™
(
p
[
pos
]è&& !
isASCIIAÍha
(p[pos]))

320 ià(
isASCIIAÍha
(
p
[
pos
]è&& 
	gp
[pos] !ğ
toASCIIUµ”
(p[pos]))

323 ià(
	gpos
 > 0)

325 
	gpos
--;

326 ià(
	gp
[
pos
] !ğ':' || 
p
[pos+1] != '[')

327 
pos
 = 0;

330 ià(
	gpos
 > 0 && 
	gp
[
pos
] == ':')

332 
pos
 > 0)

334 
pos
--;

335 ià(
	gp
[
pos
] !ğ'$' && 
p
[pos] != '_' &&…[pos] != '-' &&

336 
p
[
pos
] !ğ'~' && !
isASCIIDig™
Õ[pos]è&& !
isASCIIAÍha
(p[pos]))

338 ià(
isASCIIAÍha
(
p
[
pos
]è&& 
	gp
[pos] !ğ
toASCIIUµ”
(p[pos]))

341 ià(
	gpos
 == 0)

343 
¡©e
.
li¡StyË
 = 'V';

344  
	gFTPJunkEÁry
;

349 ià((
	gtok’s
[0][
tokËn
[0]-1]) != ';')

351 ià(
numtoks
 =ğ1 && (
¡©e
.
li¡StyË
 =ğ'V' && !
ÿ¼y_buf_Ën
))

352 
l¡yË
 = 'V';

353 ià(
	gnumtoks
 < 4)

355 ià(
	gtokËn
[1] >ğ10 && 
memcmp
(
tok’s
[1], "%RMS-E-PRV", 10) == 0)

356 
l¡yË
 = 'V';

357 ià((&
	glše
[
lš–’
] - 
	gtok’s
[1]) >= 22 &&

358 
memcmp
(
tok’s
[1], "insufficient…rivilege", 22) == 0)

359 
l¡yË
 = 'V';

360 ià(
	gnumtoks
 !ğ4 && 
numtoks
 != 6)

362 ià(
	gnumtoks
 == 6 && (

363 
tokËn
[5] < 4 || *
tok’s
[5] != '(' ||

364 (
tok’s
[5][
tokËn
[5]-1]) != ')' ))

366 iàĞ(
	gtokËn
[2] =ğ10 || 
tokËn
[2] == 11) &&

367 (
tok’s
[2][
tokËn
[2]-5]) == '-' &&

368 (
tok’s
[2][
tokËn
[2]-9]) == '-' &&

369 (((
tokËn
[3]==4 ||oklen[3]==5 ||oklen[3]==7 ||oklen[3]==8) &&

370 (
tok’s
[3][
tokËn
[3]-3]) == ':' ) ||

371 ((
tokËn
[3]==10 ||oklen[3]==11 ) &&

372 (
tok’s
[3][
tokËn
[3]-3]) == '.' )

374 
isASCIIDig™
(*
tok’s
[1]) &&

375 
isASCIIDig™
(*
tok’s
[2]) &&

376 
isASCIIDig™
(*
tok’s
[3])

379 
l¡yË
 = 'V';

381 ià(
	gl¡yË
 == 'V')

400 
tokm¬k”
 = 0;

401 
	gp
 = 
tok’s
[0];

402 
	gpos
 = 0;

403 ià(*
	gp
 =ğ'[' && 
tokËn
[0] >= 4)

405 ià(
p
[1] != ']')

407 
p
++;

408 
	gpos
++;

410 
	gl¡yË
 && 
	gpos
 < 
	gtokËn
[0] && *
	gp
 != ']')

412 ià(*
p
 != '$' && *p != '.' && *p != '_' && *p != '-' &&

413 *
p
 !ğ'~' && !
isASCIIDig™
(*pè&& !
isASCIIAÍha
(*p))

414 
l¡yË
 = 0;

415 
	gpos
++;

416 
	gp
++;

418 ià(
	gl¡yË
 && 
	gpos
 < (
	gtokËn
[0]-1))

421 
ASSERT
(*
p
 == ']');

422 
	gpos
++;

423 
	gp
++;

424 
	gtokm¬k”
 = 
pos
;

427 
	gl¡yË
 = 0;

430 
	gl¡yË
 && 
	gpos
 < 
	gtokËn
[0] && *
	gp
 != ';')

432 ià(*
p
 != '$' && *p != '.' && *p != '_' && *p != '-' &&

433 *
p
 !ğ'~' && !
isASCIIDig™
(*pè&& !
isASCIIAÍha
(*p))

434 
l¡yË
 = 0;

435 ià(
isASCIIAÍha
(*
p
è&& *
	gp
 !ğ
toASCIIUµ”
(*p))

436 
l¡yË
 = 0;

437 
	gp
++;

438 
	gpos
++;

440 ià(
	gl¡yË
 && *
	gp
 == ';')

442 ià(
pos
 =ğ0 ||…o =ğ(
tokËn
[0]-1))

443 
l¡yË
 = 0;

444 
	gpos
++;
	gl¡yË
 &&…o < 
	gtokËn
[0];pos++)

446 ià(!
isASCIIDig™
(
tok’s
[0][
pos
]))

447 
	gl¡yË
 = 0;

450 
	gpos
 = (
p
 - 
tok’s
[0]);

451 
	gpos
 -ğ
tokm¬k”
;

452 
	gp
 = &(
tok’s
[0][
tokm¬k”
]);

454 ià(!
	gl¡yË
 || 
	gpos
 =ğ0 || 
pos
 > 80)

456 
l¡yË
 = 0;

458 ià(
	gnumtoks
 == 1)

463 ià(
pos
 >ğ((
¡©e
.
ÿ¼yBufãr
)-1))

464 
pos
 = ((
¡©e
.
ÿ¼yBufãr
)-1);

465 
memıy
Ğ
¡©e
.
ÿ¼yBufãr
, 
p
, 
pos
 );

466 
	g¡©e
.
	gÿ¼yBufãrL’gth
 = 
pos
;

467  
	gFTPJunkEÁry
;

469 ià(
isASCIIDig™
(*
tok’s
[1]))

471 
	gpos
 = 0; 
	gl¡yË
 &&…o < (
	gtokËn
[1]);…os++)

473 ià(!
isASCIIDig™
((
tok’s
[1][
pos
])è&& (
	gtok’s
[1][pos]) != '/')

474 
l¡yË
 = 0;

476 ià(
	gl¡yË
 && 
	gnumtoks
 > 4)

478 
	gpos
 = 1; 
	gl¡yË
 &&…o < (
	gtokËn
[5]-1);…os++)

480 
	gp
 = &(
tok’s
[5][
pos
]);

481 ià(*
	gp
!='R' && *
p
!='W' && *p!='E' && *p!='D' && *p!=',')

482 
l¡yË
 = 0;

489 ià(
	gl¡yË
 == 'V')

491 
¡©e
.
·r£dOÃ
 = 
Œue
;

492 
	g¡©e
.
	gli¡StyË
 = 
l¡yË
;

494 ià(
isASCIIDig™
(*
tok’s
[1]))

497 ià(*
	gtok’s
[0] == '[')

499 
pos
 = 
tokËn
[0]-1;

500 
	gp
 = 
tok’s
[0]+1;

501 *
	gp
 != ']')

503 
p
++;

504 
	gpos
--;

506 
	gtokËn
[0] = --
pos
;

507 
	gtok’s
[0] = ++
p
;

509 
	gpos
 = 0;

510 
	gpos
 < 
	gtokËn
[0] && (
	gtok’s
[0][
pos
]) != ';')

511 
pos
++;

513 
	g»suÉ
.
	gÿ£S’s™ive
 = 
Œue
;

514 
	g»suÉ
.
	gty³
 = 
FTPFeEÁry
;

515 
	g»suÉ
.
	gf’ame
 = 
tok’s
[0];

516 
	g»suÉ
.
	gf’ameL’gth
 = 
pos
;

518 ià(
	gpos
 > 4)

520 
	gp
 = &(
tok’s
[0][
pos
-4]);

521 ià(
	gp
[0] =ğ'.' && 
p
[1] == 'D' &&…[2] == 'I' &&…[3] == 'R')

523 
»suÉ
.
f’ameL’gth
 -= 4;

524 
	g»suÉ
.
	gty³
 = 
FTPDœeùÜyEÁry
;

528 ià(
	g»suÉ
.
	gty³
 !ğ
FTPDœeùÜyEÁry
)

535 
pos
 = 0;

536 
	gpos
 < 
	gtokËn
[1] && (
	gtok’s
[1][
pos
]) != '/')

537 
pos
++;

546 ià(
	gpos
 < 
	gtokËn
[1] && ( (pos<<1) > (toklen[1]-1) ||

547 (
¡¹oul
(
tok’s
[1], (**)0, 10) >

548 
¡¹oul
(
tok’s
[1]+
pos
+1, (**)0, 10)) ))

550 ià(
	gpos
 > ((
	g»suÉ
.
	gã_size
)-1))

551 
	gpos
 = (
»suÉ
.
ã_size
)-1;

552 
memıy
Ğ
»suÉ
.
ã_size
, 
tok’s
[1], 
pos
 );

553 
	g»suÉ
.
	gã_size
[
pos
] = '\0';

575 
ušt64_t
 
	gsize
 = 
¡¹oul
(
tok’s
[1], 
NULL
, 10) * 512;

576 
	g»suÉ
.
	gfeSize
 = 
SŒšg
::
numb”
(
size
);

581 
	gp
 = 
tok’s
[2] + 2;

582 ià(*
	gp
 == '-')

583 
p
++;

584 
	gtbuf
[0] = 
p
[0];

585 
	gtbuf
[1] = 
toASCIILow”
(
p
[1]);

586 
	gtbuf
[2] = 
toASCIILow”
(
p
[2]);

587 
	gmÚth_num
 = 0;

588 
	gpos
 = 0;…os < (12*3);…os+=3)

590 ià(
tbuf
[0] =ğ
mÚth_Çmes
[
pos
+0] &&

591 
tbuf
[1] =ğ
mÚth_Çmes
[
pos
+1] &&

592 
tbuf
[2] =ğ
mÚth_Çmes
[
pos
+2])

594 
	gmÚth_num
++;

596 ià(
	gmÚth_num
 >= 12)

597 
mÚth_num
 = 0;

598 
	g»suÉ
.
	gmodif›dTime
.
	gtm_mÚ
 = 
mÚth_num
;

599 
	g»suÉ
.
	gmodif›dTime
.
	gtm_mday
 = 
©oi
(
tok’s
[2]);

600 
	g»suÉ
.
	gmodif›dTime
.
	gtm_y—r
 = 
©oi
(
p
+4);

602 
	gp
 = 
tok’s
[3] + 2;

603 ià(*
	gp
 == ':')

604 
p
++;

605 ià(
	gp
[2] == ':')

606 
»suÉ
.
modif›dTime
.
tm_£c
 = 
©oi
(
p
+3);

607 
	g»suÉ
.
	gmodif›dTime
.
	gtm_hour
 = 
©oi
(
tok’s
[3]);

608 
	g»suÉ
.
	gmodif›dTime
.
	gtm_mš
 = 
©oi
(
p
);

610  
	g»suÉ
.
	gty³
;

614  
	gFTPJunkEÁry
;

622 #ià
defšed
(
SUPPORT_CMS
)

624 ià(!
	gl¡yË
 && (!
	g¡©e
.
	gli¡StyË
 || state.listStyle == 'C'))

648 ià(
numtoks
 >ğ7 && (
tokËn
[0]+toklen[1]) <= 16)

650 
pos
 = 1; !
	gl¡yË
 && (
	gpos
+5è< 
	gnumtoks
;…os++)

652 
	gp
 = 
tok’s
[
pos
];

653 ià((
	gtokËn
[
pos
] =ğ1 && (*
p
 == 'F' || *p == 'V')) ||

654 (
tokËn
[
pos
] =ğ3 && *
p
 == 'D' &&…[1] == 'I' &&…[2] == 'R'))

656 ià(
tokËn
[
pos
+5] =ğ8 && (
tok’s
[pos+5][2]) == ':' &&

657 (
tok’s
[
pos
+5][5]) == ':' )

659 
p
 = 
tok’s
[
pos
+4];

660 ià((
	gtokËn
[
pos
+4] =ğ10 && 
p
[4] == '-' &&…[7] == '-') ||

661 (
tokËn
[
pos
+4] >= 7 &&oklen[pos+4] <= 9 &&

662 
p
[((p[1]!='/')?(2):(1))] == '/' &&

663 
p
[((p[1]!='/')?(5):(4))] == '/'))

666 iàĞ(*
tok’s
[
pos
+1] == '-' &&

667 *
tok’s
[
pos
+2] == '-' &&

668 *
tok’s
[
pos
+3] == '-') ||

669 (
isASCIIDig™
(*
tok’s
[
pos
+1]) &&

670 
isASCIIDig™
(*
tok’s
[
pos
+2]) &&

671 
isASCIIDig™
(*
tok’s
[
pos
+3])) )

673 
l¡yË
 = 'C';

674 
	gtokm¬k”
 = 
pos
;

683 ià(
	gl¡yË
 && !
	g¡©e
.
	gli¡StyË
)

685 
	gpos
 = 0, 
	gp
 = 
tok’s
[0]; 
	gl¡yË
 &&…o < 
	gtokËn
[0];…os++,…++)

687 ià(
isASCIIAÍha
(*
p
è&& 
toASCIIUµ”
(*p) != *p)

688 
l¡yË
 = 0;

690 
	gpos
 = 
tokm¬k”
+1;…os <=okmarker+3;…os++)

692 ià(!(
	gtokËn
[
pos
] =ğ1 && *
tok’s
[pos] == '-'))

694 
p
 = 
tok’s
[
pos
]; 
	gl¡yË
 && 
	gp
<(
	gtok’s
[pos]+
	gtokËn
[pos]);…++)

696 ià(!
isASCIIDig™
(*
p
))

697 
	gl¡yË
 = 0;

701 
	gpos
 = 0, 
	gp
 = 
tok’s
[
tokm¬k”
+4];

702 
	gl¡yË
 && 
	gpos
 < 
	gtokËn
[
tokm¬k”
+4];…os++, 
	gp
++)

704 ià(*
	gp
 == '/')

709 ià((
tok’s
[
tokm¬k”
+4][1]) == '/')

711 ià(
pos
 != 1 &&…os != 4)

712 
l¡yË
 = 0;

714 ià(
	gpos
 !ğ2 && 
pos
 != 5)

715 
l¡yË
 = 0;

717 ià(*
	gp
 !ğ'-' && !
isASCIIDig™
(*
p
))

718 
l¡yË
 = 0;

719 ià(*
	gp
 =ğ'-' && 
pos
 != 4 &&…os != 7)

720 
l¡yË
 = 0;

722 
	gpos
 = 0, 
	gp
 = 
tok’s
[
tokm¬k”
+5];

723 
	gl¡yË
 && 
	gpos
 < 
	gtokËn
[
tokm¬k”
+5];…os++, 
	gp
++)

725 ià(*
	gp
 !ğ':' && !
isASCIIDig™
(*
p
))

726 
l¡yË
 = 0;

727 ià(*
	gp
 =ğ':' && 
pos
 !ğ(
tokËn
[
tokm¬k”
+5]-3)

728 && 
pos
 !ğ(
tokËn
[
tokm¬k”
+5]-6))

729 
l¡yË
 = 0;

733 ià(
	gl¡yË
 == 'C')

735 
¡©e
.
·r£dOÃ
 = 
Œue
;

736 
	g¡©e
.
	gli¡StyË
 = 
l¡yË
;

738 
	gp
 = 
tok’s
[
tokm¬k”
+4];

739 ià(
	gtokËn
[
tokm¬k”
+4] == 10)

741 
»suÉ
.
modif›dTime
.
tm_y—r
 = 
©oi
(
p
+0) - 1900;

742 
	g»suÉ
.
	gmodif›dTime
.
	gtm_mÚ
 = 
©oi
(
p
+5) - 1;

743 
	g»suÉ
.
	gmodif›dTime
.
	gtm_mday
 = 
©oi
(
p
+8);

747 
	gpos
 = 
tokËn
[
tokm¬k”
+4];

748 
	g»suÉ
.
	gmodif›dTime
.
	gtm_mÚ
 = 
©oi
(
p
) - 1;

749 
	g»suÉ
.
	gmodif›dTime
.
	gtm_mday
 = 
©oi
((
p
+
pos
)-5);

750 
	g»suÉ
.
	gmodif›dTime
.
	gtm_y—r
 = 
©oi
((
p
+
pos
)-2);

751 ià(
	g»suÉ
.
	gmodif›dTime
.
	gtm_y—r
 < 70)

752 
	g»suÉ
.
	gmodif›dTime
.
	gtm_y—r
 += 100;

755 
	gp
 = 
tok’s
[
tokm¬k”
+5];

756 
	gpos
 = 
tokËn
[
tokm¬k”
+5];

757 
	g»suÉ
.
	gmodif›dTime
.
	gtm_hour
 = 
©oi
(
p
);

758 
	g»suÉ
.
	gmodif›dTime
.
	gtm_mš
 = 
©oi
((
p
+
pos
)-5);

759 
	g»suÉ
.
	gmodif›dTime
.
	gtm_£c
 = 
©oi
((
p
+
pos
)-2);

761 
	g»suÉ
.
	gÿ£S’s™ive
 = 
Œue
;

762 
	g»suÉ
.
	gf’ame
 = 
tok’s
[0];

763 
	g»suÉ
.
	gf’ameL’gth
 = 
tokËn
[0];

764 
	g»suÉ
.
	gty³
 = 
FTPFeEÁry
;

766 
	gp
 = 
tok’s
[
tokm¬k”
];

767 ià(
	gtokËn
[
tokm¬k”
] =ğ3 && *
p
=='D' &&…[1]=='I' &&…[2]=='R')

768 
»suÉ
.
ty³
 = 
FTPDœeùÜyEÁry
;

770 ià(Ğ
	gtokËn
[
tokm¬k”
+4] == 10 &&okmarker > 1) ||

771 Ğ
tokËn
[
tokm¬k”
+4] != 10 &&okmarker > 2))

773 *
dÙ
;

774 
	gp
 = &(
tok’s
[0][
tokËn
[0]]);

775 
memıy
Ğ&
dÙ
, &
p
, (dot) );

776 *
	gdÙ
++ = '.';

777 
	gp
 = 
tok’s
[1];

778 
	gpos
 = 0;…o < 
	gtokËn
[1];…os++)

779 *
	gdÙ
++ = *
p
++;

780 
	g»suÉ
.
	gf’ameL’gth
 +ğ1 + 
tokËn
[1];

792  
	g»suÉ
.
	gty³
;

800 #ià
defšed
(
SUPPORT_DOS
)

801 ià(!
	gl¡yË
 && (!
	g¡©e
.
	gli¡StyË
 || state.listStyle == 'W'))

811 ià((
numtoks
 >ğ4è&& 
tokËn
[0] == 8 &&oklen[1] == 7 &&

812 (*
tok’s
[2] =ğ'<' || 
isASCIIDig™
(*tokens[2])) )

814 
p
 = 
tok’s
[0];

815 iàĞ
isASCIIDig™
(
p
[0]è&& isASCIIDig™Õ[1]è&& 
	gp
[2]=='-' &&

816 
isASCIIDig™
(
p
[3]) && isASCIIDigit(p[4]) &&…[5]=='-' &&

817 
isASCIIDig™
(
p
[6]) && isASCIIDigit(p[7]) )

819 
p
 = 
tok’s
[1];

820 iàĞ
isASCIIDig™
(
p
[0]è&& isASCIIDig™Õ[1]è&& 
	gp
[2]==':' &&

821 
isASCIIDig™
(
p
[3]) && isASCIIDigit(p[4]) &&

822 (
p
[5]=='A' ||…[5]=='P') &&…[6]=='M')

824 
l¡yË
 = 'W';

825 ià(!
	g¡©e
.
	gli¡StyË
)

827 
	gp
 = 
tok’s
[2];

829 ià(*
	gp
 !ğ'<' || 
p
[
tokËn
[2]-1] != '>')

831 
pos
 = 1; (
	gl¡yË
 && 
	gpos
 < 
	gtokËn
[2]);…os++)

833 ià(!
isASCIIDig™
(*++
p
))

834 
	gl¡yË
 = 0;

842 ià(
	gl¡yË
 == 'W')

844 
¡©e
.
·r£dOÃ
 = 
Œue
;

845 
	g¡©e
.
	gli¡StyË
 = 
l¡yË
;

847 
	gp
 = &(
lše
[
lš–’
]);

848 
	g»suÉ
.
	gÿ£S’s™ive
 = 
Œue
;

849 
	g»suÉ
.
	gf’ame
 = 
tok’s
[3];

850 
	g»suÉ
.
	gf’ameL’gth
 = 
p
 - 
tok’s
[3];

851 
	g»suÉ
.
	gty³
 = 
FTPDœeùÜyEÁry
;

853 ià(*
	gtok’s
[2] != '<')

857 ià(
tok’s
[2] + 
tokËn
[2] - 
lše
 == 38) {

858 
»suÉ
.
f’ame
 = &(
lše
[39]);

859 
	g»suÉ
.
	gf’ameL’gth
 = 
p
 - 
»suÉ
.
f’ame
;

861 
	g»suÉ
.
	gty³
 = 
FTPFeEÁry
;

862 
	gpos
 = 
tokËn
[2];

863 
	g»suÉ
.
	gfeSize
 = 
SŒšg
(
tok’s
[2], 
pos
);

869 ià(
	gtok’s
[2] - 
	glše
 =ğ24 && (
tokËn
[2] == 5 ||oklen[2] == 10) &&

870 
tok’s
[3] - 
lše
 >= 39) {

871 
»suÉ
.
f’ame
 = &(
lše
[39]);

872 
	g»suÉ
.
	gf’ameL’gth
 = 
p
 - 
»suÉ
.
f’ame
;

875 ià((
	gtok’s
[2][1]) != 'D')

877 
»suÉ
.
ty³
 = 
FTPJunkEÁry
;

878 ià(
	g»suÉ
.
	gf’ameL’gth
 > 4)

880 
	gp
 = 
»suÉ
.
f’ame
;

881 
	gpos
 = 
»suÉ
.
f’ameL’gth
 - 4;…os > 0;…os--)

883 ià(
	gp
[0] =ğ' ' && 
p
[3] == ' ' &&…[2] == '>' &&

884 (
p
[1] == '=' ||…[1] == '-'))

886 
»suÉ
.
ty³
 = 
FTPLškEÁry
;

887 
	g»suÉ
.
	gf’ameL’gth
 = 
p
 - 
»suÉ
.
f’ame
;

888 
	g»suÉ
.
	glškÇme
 = 
p
 + 4;

889 
	g»suÉ
.
	glškÇmeL’gth
 = &(
lše
[
lš–’
])

890 - 
»suÉ
.
lškÇme
;

893 
	gp
++;

899 
	g»suÉ
.
	gmodif›dTime
.
	gtm_mÚ
 = 
©oi
(
tok’s
[0]+0);

900 ià(
	g»suÉ
.
	gmodif›dTime
.
	gtm_mÚ
 != 0)

902 
»suÉ
.
modif›dTime
.
tm_mÚ
--;

903 
	g»suÉ
.
	gmodif›dTime
.
	gtm_mday
 = 
©oi
(
tok’s
[0]+3);

904 
	g»suÉ
.
	gmodif›dTime
.
	gtm_y—r
 = 
©oi
(
tok’s
[0]+6);

908 ià(
	g»suÉ
.
	gmodif›dTime
.
	gtm_y—r
 < 80)

909 
	g»suÉ
.
	gmodif›dTime
.
	gtm_y—r
 += 2000;

910 ià(
	g»suÉ
.
	gmodif›dTime
.
	gtm_y—r
 < 100)

911 
	g»suÉ
.
	gmodif›dTime
.
	gtm_y—r
 += 1900;

914 
	g»suÉ
.
	gmodif›dTime
.
	gtm_hour
 = 
©oi
(
tok’s
[1]+0);

915 
	g»suÉ
.
	gmodif›dTime
.
	gtm_mš
 = 
©oi
(
tok’s
[1]+3);

916 ià((
	gtok’s
[1][5]è=ğ'P' && 
»suÉ
.
modif›dTime
.
tm_hour
 < 12)

917 
»suÉ
.
modif›dTime
.
tm_hour
 += 12;

926  
	g»suÉ
.
	gty³
;

933 #ià
defšed
(
SUPPORT_OS2
)

934 ià(!
	gl¡yË
 && (!
	g¡©e
.
	gli¡StyË
 || state.listStyle == 'O'))

957 
p
 = &(
lše
[
tokËn
[0]]);

959 ià(
	gnumtoks
 >ğ4 && 
tokËn
[0] <ğ18 && 
isASCIIDig™
(*
tok’s
[0]) &&

960 (
lš–’
 - 
tokËn
[0]) >= (53-18) &&

961 
p
[18-18] == ' ' &&…[34-18] == ' ' &&

962 
p
[37-18] == '-' &&…[40-18] == '-' &&…[43-18] == ' ' &&

963 
p
[45-18] == ' ' &&…[48-18] == ':' &&…[51-18] == ' ' &&

964 
isASCIIDig™
(
p
[35-18]) && isASCIIDigit(p[36-18]) &&

965 
isASCIIDig™
(
p
[38-18]) && isASCIIDigit(p[39-18]) &&

966 
isASCIIDig™
(
p
[41-18]) && isASCIIDigit(p[42-18]) &&

967 
isASCIIDig™
(
p
[46-18]) && isASCIIDigit(p[47-18]) &&

968 
isASCIIDig™
(
p
[49-18]) && isASCIIDigit(p[50-18])

971 
l¡yË
 = 'O';

972 ià(!
	g¡©e
.
	gli¡StyË
)

974 
	gpos
 = 1; 
	gl¡yË
 &&…o < 
	gtokËn
[0];…os++)

976 ià(!
isASCIIDig™
(
tok’s
[0][
pos
]))

977 
	gl¡yË
 = 0;

982 ià(
	gl¡yË
 == 'O')

984 
¡©e
.
·r£dOÃ
 = 
Œue
;

985 
	g¡©e
.
	gli¡StyË
 = 
l¡yË
;

987 
	gp
 = &(
lše
[
tokËn
[0]]);

989 
	g»suÉ
.
	gÿ£S’s™ive
 = 
Œue
;

990 
	g»suÉ
.
	gf’ame
 = &
p
[53-18];

991 
	g»suÉ
.
	gf’ameL’gth
 = (&(
lše
[
lš–’_§ns_w¥
]))

992 - (
»suÉ
.
f’ame
);

993 
	g»suÉ
.
	gty³
 = 
FTPFeEÁry
;

996 
	gpos
 = (18-18);…os < ((35-18)-4);…os++)

998 ià(
	gp
[
pos
+0] =ğ' ' && 
p
[pos+1] == 'D' &&

999 
p
[
pos
+2] == 'I' &&…[pos+3] == 'R')

1001 
»suÉ
.
ty³
 = 
FTPDœeùÜyEÁry
;

1006 ià(
	g»suÉ
.
	gty³
 !ğ
FTPDœeùÜyEÁry
)

1008 
pos
 = 
tokËn
[0];

1009 
	g»suÉ
.
	gfeSize
 = 
SŒšg
(
tok’s
[0], 
pos
);

1012 
	g»suÉ
.
	gmodif›dTime
.
	gtm_mÚ
 = 
©oi
(&
p
[35-18]) - 1;

1013 
	g»suÉ
.
	gmodif›dTime
.
	gtm_mday
 = 
©oi
(&
p
[38-18]);

1014 
	g»suÉ
.
	gmodif›dTime
.
	gtm_y—r
 = 
©oi
(&
p
[41-18]);

1015 ià(
	g»suÉ
.
	gmodif›dTime
.
	gtm_y—r
 < 80)

1016 
	g»suÉ
.
	gmodif›dTime
.
	gtm_y—r
 += 100;

1017 
	g»suÉ
.
	gmodif›dTime
.
	gtm_hour
 = 
©oi
(&
p
[46-18]);

1018 
	g»suÉ
.
	gmodif›dTime
.
	gtm_mš
 = 
©oi
(&
p
[49-18]);

1027  
	g»suÉ
.
	gty³
;

1035 #ià
defšed
(
SUPPORT_LSL
)

1036 ià(!
	gl¡yË
 && (!
	g¡©e
.
	gli¡StyË
 || state.listStyle == 'U'))

1063 
boŞ
 
isOldH–lsoá
 = 
çl£
;

1065 ià(
	gnumtoks
 >= 6)

1070 ià(
tokËn
[0] =ğ1 || (
tok’s
[0][1]) == '[')

1072 ià(*
tok’s
[0] == 'd' || *tokens[0] == '-')

1074 
pos
 = 
tokËn
[0]-1;

1075 
	gp
 = 
tok’s
[0] + 1;

1076 ià(
	gpos
 == 0)

1078 
p
 = 
tok’s
[1];

1079 
	gpos
 = 
tokËn
[1];

1081 ià((
	gpos
 =ğ9 || 
pos
 == 10) &&

1082 (*
p
 =ğ'[' &&…[
pos
-1] == ']') &&

1083 (
p
[1] == 'R' ||…[1] == '-') &&

1084 (
p
[2] == 'W' ||…[2] == '-') &&

1085 (
p
[3] == 'C' ||…[3] == '-') &&

1086 (
p
[4] == 'E' ||…[4] == '-'))

1089 
l¡yË
 = 'U';

1090 ià(
	gtokËn
[0] == 10)

1091 
isOldH–lsoá
 = 
Œue
;

1095 ià((
	gtokËn
[0] =ğ10 || 
tokËn
[0] == 11)

1096 && 
¡rchr
("-bcdÍsw?DFam", *
tok’s
[0]))

1098 
	gp
 = &(
tok’s
[0][1]);

1099 ià((
	gp
[0] =ğ'r' || 
p
[0] == '-') &&

1100 (
p
[1] == 'w' ||…[1] == '-') &&

1101 (
p
[3] == 'r' ||…[3] == '-') &&

1102 (
p
[4] == 'w' ||…[4] == '-') &&

1103 (
p
[6] == 'r' ||…[6] == '-') &&

1104 (
p
[7] == 'w' ||…[7] == '-'))

1107 
l¡yË
 = 'U';

1111 ià(
	gl¡yË
 == 'U')

1113 
l¡yË
 = 0;

1114 
	gpos
 = (
numtoks
-5); !
	gl¡yË
 &&…os > 1;…os--)

1120 ià(
isASCIIDig™
(*
tok’s
[
pos
])

1122 && 
	gtokËn
[
pos
+1] =ğ3 && 
isASCIIAÍha
(*
tok’s
[pos+1]) &&

1123 
isASCIIAÍha
(
tok’s
[
pos
+1][1]) && isASCIIAlpha(tokens[pos+1][2])

1125 && 
isASCIIDig™
(*
tok’s
[
pos
+2]) &&

1126 (
tokËn
[
pos
+2] == 1 ||

1127 (
tokËn
[
pos
+2] =ğ2 && 
isASCIIDig™
(
tok’s
[pos+2][1])))

1128 && 
tokËn
[
pos
+3] >ğ4 && 
isASCIIDig™
(*
tok’s
[pos+3])

1130 && (
tokËn
[
pos
+3] <= 5 || (

1131 (
tokËn
[
pos
+3] == 7 ||oklen[pos+3] == 8) &&

1132 (
tok’s
[
pos
+3][
tokËn
[pos+3]-3]) == ':'))

1133 && 
isASCIIDig™
(
tok’s
[
pos
+3][
tokËn
[pos+3]-2])

1134 && 
isASCIIDig™
(
tok’s
[
pos
+3][
tokËn
[pos+3]-1])

1137 ((
tokËn
[
pos
+3] == 4 ||oklen[pos+3] == 5) &&

1138 
isASCIIDig™
(
tok’s
[
pos
+3][1]) &&

1139 
isASCIIDig™
(
tok’s
[
pos
+3][2]) )

1141 || ((
tokËn
[
pos
+3] == 4 ||oklen[pos+3] == 7) &&

1142 (
tok’s
[
pos
+3][1]) == ':' &&

1143 
isASCIIDig™
(
tok’s
[
pos
+3][2]) && isASCIIDigit(tokens[pos+3][3]))

1145 || ((
tokËn
[
pos
+3] == 5 ||oklen[pos+3] == 8) &&

1146 
isASCIIDig™
(
tok’s
[
pos
+3][1]) && (tokens[pos+3][2]) == ':' &&

1147 
isASCIIDig™
(
tok’s
[
pos
+3][3]) && isASCIIDigit(tokens[pos+3][4]))

1151 
l¡yË
 = 'U';

1152 
	gtokm¬k”
 = 
pos
;

1155 
	gp
 = 
tok’s
[
tokm¬k”
];

1156 
	gi
 = 0; 
	gl¡yË
 && i < 
	gtokËn
[
tokm¬k”
]; ++i)

1158 ià(!
isASCIIDig™
(*
p
++))

1159 
	gl¡yË
 = 0;

1161 ià(
	gl¡yË
)

1163 
	gmÚth_num
 = 0;

1164 
	gp
 = 
tok’s
[
tokm¬k”
+1];

1165 
	gi
 = 0; i < (12*3); i+=3)

1167 ià(
p
[0] =ğ
mÚth_Çmes
[
i
+0] &&

1168 
p
[1] =ğ
mÚth_Çmes
[
i
+1] &&

1169 
p
[2] =ğ
mÚth_Çmes
[
i
+2])

1171 
	gmÚth_num
++;

1173 ià(
	gmÚth_num
 >= 12)

1174 
l¡yË
 = 0;

1180 ià(
	gl¡yË
 == 'U')

1182 
¡©e
.
·r£dOÃ
 = 
Œue
;

1183 
	g¡©e
.
	gli¡StyË
 = 
l¡yË
;

1185 
	g»suÉ
.
	gÿ£S’s™ive
 = 
çl£
;

1186 
	g»suÉ
.
	gty³
 = 
FTPJunkEÁry
;

1187 ià(*
	gtok’s
[0] =ğ'd' || *
tok’s
[0] == 'D')

1188 
»suÉ
.
ty³
 = 
FTPDœeùÜyEÁry
;

1189 ià(*
	gtok’s
[0] == 'l')

1190 
»suÉ
.
ty³
 = 
FTPLškEÁry
;

1191 ià(*
	gtok’s
[0] =ğ'-' || *
tok’s
[0] == 'F')

1192 
»suÉ
.
ty³
 = 
FTPFeEÁry
;

1194 ià(
	g»suÉ
.
	gty³
 !ğ
FTPDœeùÜyEÁry
)

1196 
pos
 = 
tokËn
[
tokm¬k”
];

1197 
	g»suÉ
.
	gfeSize
 = 
SŒšg
(
tok’s
[
tokm¬k”
], 
pos
);

1200 
	g»suÉ
.
	gmodif›dTime
.
	gtm_mÚ
 = 
mÚth_num
;

1201 
	g»suÉ
.
	gmodif›dTime
.
	gtm_mday
 = 
©oi
(
tok’s
[
tokm¬k”
+2]);

1202 ià(
	g»suÉ
.
	gmodif›dTime
.
	gtm_mday
 == 0)

1203 
»suÉ
.
modif›dTime
.
tm_mday
++;

1205 
	gp
 = 
tok’s
[
tokm¬k”
+3];

1206 
	gpos
 = ()
©oi
(
p
);

1207 ià(
	gp
[1] == ':')

1208 
p
--;

1209 ià(
	gp
[2] != ':')

1211 
»suÉ
.
modif›dTime
.
tm_y—r
 = 
pos
;

1215 
	g»suÉ
.
	gmodif›dTime
.
	gtm_hour
 = 
pos
;

1216 
	g»suÉ
.
	gmodif›dTime
.
	gtm_mš
 = 
©oi
(
p
+3);

1217 ià(
	gp
[5] == ':')

1218 
»suÉ
.
modif›dTime
.
tm_£c
 = 
©oi
(
p
+6);

1220 ià(!
	g¡©e
.
	gnow
)

1222 
time_t
 
	gnow
 = 
time
(
NULL
);

1223 
	g¡©e
.
	gnow
 = 
now
 * 1000000.0;

1226 
gmtime_r
(&
now
, &
¡©e
.
nowFTPTime
);

1227 
	g¡©e
.
	gnowFTPTime
.
	gtm_y—r
 += 1900;

1230 
	g»suÉ
.
	gmodif›dTime
.
	gtm_y—r
 = 
¡©e
.
nowFTPTime
.
tm_y—r
;

1231 iàĞ(Ğ
	g¡©e
.
	gnowFTPTime
.
	gtm_mÚ
 << 5è+ s‹.nowFTPTime.
	gtm_mday
) <

1232 ((
	g»suÉ
.
	gmodif›dTime
.
	gtm_mÚ
 << 5è+„esuÉ.modif›dTime.
	gtm_mday
) )

1233 
	g»suÉ
.
	gmodif›dTime
.
	gtm_y—r
--;

1239 ià(!
	gisOldH–lsoá
)

1240 
	g»suÉ
.
	gf’ame
 = 
tok’s
[
tokm¬k”
+3] + 
tokËn
[tokmarker+3] + 1;

1242 
	g»suÉ
.
	gf’ame
 = 
tok’s
[
tokm¬k”
+4];

1244 
	g»suÉ
.
	gf’ameL’gth
 = (&(
lše
[
lš–’
]))

1245 - (
»suÉ
.
f’ame
);

1247 ià(
	g»suÉ
.
	gty³
 =ğ
FTPLškEÁry
 && 
»suÉ
.
f’ameL’gth
 > 4)

1251 
feSize
 = 
»suÉ
.feSize.
toUIÁ
();

1253 ià(
	g»suÉ
.
	gf’ameL’gth
 > (
	gfeSize
 + 4) &&

1254 
¡ºcmp
(
»suÉ
.
f’ame
 +„esuÉ.
f’ameL’gth
 - 
feSize
 - 4, " -> ", 4) == 0)

1256 
»suÉ
.
lškÇme
 =„esuÉ.
f’ame
 + (»suÉ.
f’ameL’gth
 - 
feSize
);

1257 
	g»suÉ
.
	glškÇmeL’gth
 = (&(
lše
[
lš–’
])è- (
»suÉ
.
lškÇme
);

1258 
	g»suÉ
.
	gf’ameL’gth
 -ğ
feSize
 + 4;

1267 
	gp
 = 
»suÉ
.
f’ame
 + (»suÉ.
f’ameL’gth
 - 5);

1268 
	gpos
 = (
»suÉ
.
f’ameL’gth
 - 5);…os > 0;…os--)

1270 ià(
¡ºcmp
(
p
, " -> ", 4) == 0)

1272 
»suÉ
.
lškÇme
 = 
p
 + 4;

1273 
	g»suÉ
.
	glškÇmeL’gth
 = (&(
lše
[
lš–’
]))

1274 - (
»suÉ
.
lškÇme
);

1275 
	g»suÉ
.
	gf’ameL’gth
 = 
pos
;

1278 
	gp
--;

1283 #ià
defšed
(
SUPPORT_LSLF
)

1284 ià(
	g»suÉ
.
	gf’ameL’gth
 > 1)

1286 
	gp
 = 
»suÉ
.
f’ame
[»suÉ.
f’ameL’gth
-1];

1287 
	gpos
 = 
»suÉ
.
ty³
;

1288 ià(
	gpos
 == 'd') {

1289 ià(*
p
 =ğ'/'è
»suÉ
.
f’ameL’gth
--;

1290 } ià(
	gpos
 == 'l') {

1291 ià(*
p
 =ğ'@'è
»suÉ
.
f’ameL’gth
--;

1292 } ià(
	gpos
 == 'f') {

1293 ià(*
p
 =ğ'*'è
»suÉ
.
f’ameL’gth
--;

1294 } ià(*
	gp
 =ğ'=' || *
p
 == '%' || *p == '|') {

1295 
»suÉ
.
f’ameL’gth
--;

1307  
	g»suÉ
.
	gty³
;

1316 #ià
defšed
(
SUPPORT_W16
)

1317 ià(!
	gl¡yË
 && (!
	g¡©e
.
	gli¡StyË
 || state.listStyle == 'w'))

1342 ià(
numtoks
 >ğ4 && 
tokËn
[0] < 13 &&

1343 ((
tokËn
[1] =ğ5 && *
tok’s
[1] =ğ'<'è|| 
isASCIIDig™
(*tokens[1])) )

1345 ià(
numtoks
 == 4

1346 && (
tokËn
[2] == 8 ||oklen[2] == 9)

1347 && (((
tok’s
[2][2]) == '/' && (tokens[2][5]) == '/') ||

1348 ((
tok’s
[2][2]) == '-' && (tokens[2][5]) == '-'))

1349 && (
tokËn
[3] == 4 ||oklen[3] == 5)

1350 && (
tok’s
[3][
tokËn
[3]-3]) == ':'

1351 && 
isASCIIDig™
(
tok’s
[2][0]) && isASCIIDigit(tokens[2][1])

1352 && 
isASCIIDig™
(
tok’s
[2][3]) && isASCIIDigit(tokens[2][4])

1353 && 
isASCIIDig™
(
tok’s
[2][6]) && isASCIIDigit(tokens[2][7])

1354 && (
tokËn
[2] < 9 || 
isASCIIDig™
(
tok’s
[2][8]))

1355 && 
isASCIIDig™
(
tok’s
[3][
tokËn
[3]-1]) && isASCIIDigit(tokens[3][toklen[3]-2])

1356 && 
isASCIIDig™
(
tok’s
[3][
tokËn
[3]-4]) && isASCIIDigit(*tokens[3])

1359 
l¡yË
 = 'w';

1361 ià((
	gnumtoks
 =ğ6 || 
numtoks
 == 7)

1362 && 
tokËn
[2] == 3 &&oklen[3] == 2

1363 && 
tokËn
[4] == 4 &&oklen[5] == 5

1364 && (
tok’s
[5][2]) == ':'

1365 && 
isASCIIAÍha
(
tok’s
[2][0]) && isASCIIAlpha(tokens[2][1])

1366 && 
isASCIIAÍha
(
tok’s
[2][2])

1367 && 
isASCIIDig™
(
tok’s
[3][0]) && isASCIIDigit(tokens[3][1])

1368 && 
isASCIIDig™
(
tok’s
[4][0]) && isASCIIDigit(tokens[4][1])

1369 && 
isASCIIDig™
(
tok’s
[4][2]) && isASCIIDigit(tokens[4][3])

1370 && 
isASCIIDig™
(
tok’s
[5][0]) && isASCIIDigit(tokens[5][1])

1371 && 
isASCIIDig™
(
tok’s
[5][3]) && isASCIIDigit(tokens[5][4])

1375 
l¡yË
 = 'w';

1377 ià(
	gl¡yË
 && 
	g¡©e
.
	gli¡StyË
 !ğ
l¡yË
)

1379 
p
 = 
tok’s
[1];

1380 ià(
	gtokËn
[1] !ğ5 || 
p
[0] != '<' ||…[1] != 'D' ||

1381 
p
[2] != 'I' ||…[3] != 'R' ||…[4] != '>')

1383 
pos
 = 0; 
	gl¡yË
 && 
	gpos
 < 
	gtokËn
[1];…os++)

1385 ià(!
isASCIIDig™
(*
p
++))

1386 
	gl¡yË
 = 0;

1392 ià(
	gl¡yË
 == 'w')

1394 
¡©e
.
·r£dOÃ
 = 
Œue
;

1395 
	g¡©e
.
	gli¡StyË
 = 
l¡yË
;

1397 
	g»suÉ
.
	gÿ£S’s™ive
 = 
Œue
;

1398 
	g»suÉ
.
	gf’ame
 = 
tok’s
[0];

1399 
	g»suÉ
.
	gf’ameL’gth
 = 
tokËn
[0];

1400 
	g»suÉ
.
	gty³
 = 
FTPDœeùÜyEÁry
;

1402 
	gp
 = 
tok’s
[1];

1403 ià(
isASCIIDig™
(*
p
))

1405 
	g»suÉ
.
	gty³
 = 
FTPFeEÁry
;

1406 
	gpos
 = 
tokËn
[1];

1407 
	g»suÉ
.
	gfeSize
 = 
SŒšg
(
p
, 
pos
);

1410 
	gp
 = 
tok’s
[2];

1411 ià(
	gtokËn
[2] == 3)

1413 
tbuf
[0] = 
toASCIIUµ”
(
p
[0]);

1414 
	gtbuf
[1] = 
toASCIILow”
(
p
[1]);

1415 
	gtbuf
[2] = 
toASCIILow”
(
p
[2]);

1416 
	gpos
 = 0;…os < (12*3);…os+=3)

1418 ià(
tbuf
[0] =ğ
mÚth_Çmes
[
pos
+0] &&

1419 
tbuf
[1] =ğ
mÚth_Çmes
[
pos
+1] &&

1420 
tbuf
[2] =ğ
mÚth_Çmes
[
pos
+2])

1422 
»suÉ
.
modif›dTime
.
tm_mÚ
 = 
pos
/3;

1423 
	g»suÉ
.
	gmodif›dTime
.
	gtm_mday
 = 
©oi
(
tok’s
[3]);

1424 
	g»suÉ
.
	gmodif›dTime
.
	gtm_y—r
 = 
©oi
(
tok’s
[4]) - 1900;

1428 
	gpos
 = 5;

1432 
	g»suÉ
.
	gmodif›dTime
.
	gtm_mÚ
 = 
©oi
(
p
+0)-1;

1433 
	g»suÉ
.
	gmodif›dTime
.
	gtm_mday
 = 
©oi
(
p
+3);

1434 
	g»suÉ
.
	gmodif›dTime
.
	gtm_y—r
 = 
©oi
(
p
+6);

1435 ià(
	g»suÉ
.
	gmodif›dTime
.
	gtm_y—r
 < 80)

1436 
	g»suÉ
.
	gmodif›dTime
.
	gtm_y—r
 += 100;

1438 
	gpos
 = 3;

1441 
	g»suÉ
.
	gmodif›dTime
.
	gtm_hour
 = 
©oi
(
tok’s
[
pos
]);

1442 
	g»suÉ
.
	gmodif›dTime
.
	gtm_mš
 = 
©oi
(&(
tok’s
[
pos
][
tokËn
[pos]-2]));

1451  
	g»suÉ
.
	gty³
;

1459 #ià
defšed
(
SUPPORT_DLS
)

1460 ià(!
	gl¡yË
 &&

1461 (
	g¡©e
.
	gli¡StyË
 =ğ'D' || (!
¡©e
.
li¡StyË
 && s‹.
numLšes
 == 1)))

1498 ià(!
¡©e
.
li¡StyË
 && 
lše
[
lš–’
-1] == ':' &&

1499 
lš–’
 >ğ2 && 
tokËn
[
numtoks
-1] != 1)

1505 
pos
 = 0;

1506 
	gp
 = 
lše
;

1507 
	gpos
 < (
	glš–’
-1))

1510 ià(*
	gp
 =ğ'<' || *
p
 == '|' || *p == '>' ||

1511 *
p
 == '?' || *p == '*' || *p == '\\')

1513 ià(*
	gp
 =ğ'/' && 
pos
 < (
lš–’
-2è&& 
p
[1] == '/')

1515 
	gpos
++;

1516 
	gp
++;

1518 ià(
	gpos
 =ğ(
lš–’
-1))

1520 
¡©e
.
li¡StyË
 = 'D';

1521  
	gFTPJunkEÁry
;

1525 ià(!
	gl¡yË
 && 
	gnumtoks
 >= 2)

1527 
pos
 = 22;

1528 ià(
	g¡©e
.
	gli¡StyË
 && 
	gÿ¼y_buf_Ën
)

1529 
	gpos
 = 
tokËn
[1]-1;

1531 ià(
	glš–’
 > 
	gpos
)

1533 
	gp
 = &
lše
[
pos
];

1534 ià((*
	gp
 =ğ'-' || *
p
 =ğ'=' || 
isASCIIDig™
(*p)) &&

1535 ((
lš–’
 =ğ(
pos
+1)) ||

1536 (
lš–’
 >ğ(
pos
+3è&& 
p
[1] == ' ' &&…[2] == ' ')) )

1538 
tokm¬k”
 = 1;

1539 ià(!
	gÿ¼y_buf_Ën
)

1541 
	gpos
 = 1;

1542 
	gpos
 < 
	gnumtoks
 && (
	gtok’s
[
pos
]+
	gtokËn
[pos]è< (&
	glše
[23]))

1543 
	gpos
++;

1544 
	gtokm¬k”
 = 0;

1545 ià((
	gtok’s
[
pos
]+
	gtokËn
[pos]è=ğ(&
lše
[23]))

1546 
tokm¬k”
 = 
pos
;

1548 ià(
	gtokm¬k”
)

1550 
	gl¡yË
 = 'D';

1551 ià(*
	gtok’s
[
tokm¬k”
] =ğ'-' || *
tok’s
[tokmarker] == '=')

1553 ià(
tokËn
[
tokm¬k”
] != 1 ||

1554 (
tok’s
[
tokm¬k”
-1][
tokËn
[tokmarker-1]-1]) != '/')

1555 
l¡yË
 = 0;

1559 
	gpos
 = 0; 
	gl¡yË
 &&…o < 
	gtokËn
[
tokm¬k”
];…os++)

1561 ià(!
isASCIIDig™
(
tok’s
[
tokm¬k”
][
pos
]))

1562 
	gl¡yË
 = 0;

1565 ià(
	gl¡yË
 && !
	g¡©e
.
	gli¡StyË
)

1568 
	gp
 = 
tok’s
[0]; 
	gl¡yË
 &&

1569 
	gp
 < &(
	gtok’s
[
tokm¬k”
-1][
tokËn
[tokmarker-1]]);…++)

1571 ià(*
	gp
 =ğ'<' || *
p
 == '|' || *p == '>' ||

1572 *
p
 == '?' || *p == '*' || *p == '/' || *p == '\\')

1573 
l¡yË
 = 0;

1582 ià(!
	gl¡yË
 && 
	g¡©e
.
	gli¡StyË
 =ğ'D' && !
ÿ¼y_buf_Ën
)

1590 
pos
 = 
lš–’
;

1591 ià(
	gpos
 > ((
	g¡©e
.
	gÿ¼yBufãr
)-1))

1592 
	gpos
 = (
¡©e
.
ÿ¼yBufãr
)-1;

1593 
memıy
Ğ
¡©e
.
ÿ¼yBufãr
, 
lše
, 
pos
 );

1594 
	g¡©e
.
	gÿ¼yBufãrL’gth
 = 
pos
;

1595  
	gFTPJunkEÁry
;

1598 ià(
	gl¡yË
 == 'D')

1600 
¡©e
.
·r£dOÃ
 = 
Œue
;

1601 
	g¡©e
.
	gli¡StyË
 = 
l¡yË
;

1603 
	gp
 = &(
tok’s
[
tokm¬k”
-1][
tokËn
[tokmarker-1]]);

1604 
	g»suÉ
.
	gf’ame
 = 
tok’s
[0];

1605 
	g»suÉ
.
	gf’ameL’gth
 = 
p
 - 
tok’s
[0];

1606 
	g»suÉ
.
	gty³
 = 
FTPFeEÁry
;

1608 ià(
	g»suÉ
.
	gf’ame
[
»suÉ
.
f’ameL’gth
-1] == '/')

1610 ià(
»suÉ
.
lškÇmeL’gth
 == 1)

1611 
»suÉ
.
ty³
 = 
FTPJunkEÁry
;

1614 
	g»suÉ
.
	gf’ameL’gth
--;

1615 
	g»suÉ
.
	gty³
 = 
FTPDœeùÜyEÁry
;

1618 ià(
isASCIIDig™
(*
tok’s
[
tokm¬k”
]))

1620 
	gpos
 = 
tokËn
[
tokm¬k”
];

1621 
	g»suÉ
.
	gfeSize
 = 
SŒšg
(
tok’s
[
tokm¬k”
], 
pos
);

1624 ià((
	gtokm¬k”
+3è< 
	gnumtoks
 &&

1625 (&(
	gtok’s
[
numtoks
-1][
tokËn
[numtoks-1]]) -

1626 
	gtok’s
[
tokm¬k”
+1]) >= (1+1+3+1+4) )

1628 
pos
 = (
tokm¬k”
+3);

1629 
	gp
 = 
tok’s
[
pos
];

1630 
	gpos
 = 
tokËn
[
pos
];

1632 ià((
	gpos
 =ğ4 || 
pos
 == 5)

1633 && 
isASCIIDig™
(*
p
è&& isASCIIDig™Õ[
pos
-1]) && isASCIIDigit(p[pos-2])

1634 && ((
pos
 =ğ5 && 
p
[2] == ':') ||

1635 (
pos
 =ğ4 && (
isASCIIDig™
(
p
[1]) ||…[1] == ':')))

1638 
mÚth_num
 = 
tokm¬k”
+1;

1639 
	gpos
 = 
tokm¬k”
+2;

1640 ià(
isASCIIDig™
(*
tok’s
[
mÚth_num
]))

1642 
	gmÚth_num
++;

1643 
	gpos
--;

1645 
	gp
 = 
tok’s
[
mÚth_num
];

1646 ià(
isASCIIDig™
(*
tok’s
[
pos
])

1647 && (
	gtokËn
[
pos
] == 1 ||

1648 (
tokËn
[
pos
] =ğ2 && 
isASCIIDig™
(
tok’s
[pos][1])))

1649 && 
tokËn
[
mÚth_num
] == 3

1650 && 
isASCIIAÍha
(*
p
) && isASCIIAlpha(p[1]) && isASCIIAlpha(p[2]) )

1652 
pos
 = 
©oi
(
tok’s
[pos]);

1653 ià(
	gpos
 > 0 &&…os <= 31)

1655 
»suÉ
.
modif›dTime
.
tm_mday
 = 
pos
;

1656 
	gmÚth_num
 = 1;

1657 
	gpos
 = 0;…os < (12*3);…os+=3)

1659 ià(
p
[0] =ğ
mÚth_Çmes
[
pos
+0] &&

1660 
p
[1] =ğ
mÚth_Çmes
[
pos
+1] &&

1661 
p
[2] =ğ
mÚth_Çmes
[
pos
+2])

1663 
	gmÚth_num
++;

1665 ià(
	gmÚth_num
 > 12)

1666 
	g»suÉ
.
	gmodif›dTime
.
	gtm_mday
 = 0;

1668 
	g»suÉ
.
	gmodif›dTime
.
	gtm_mÚ
 = 
mÚth_num
 - 1;

1671 ià(
	g»suÉ
.
	gmodif›dTime
.
	gtm_mday
)

1673 
	gtokm¬k”
 += 3;

1674 
	gp
 = 
tok’s
[
tokm¬k”
];

1676 
	gpos
 = 
©oi
(
p
);

1677 ià(
	gpos
 > 24)

1678 
	g»suÉ
.
	gmodif›dTime
.
	gtm_y—r
 = 
pos
-1900;

1681 ià(
	gp
[1] == ':')

1682 
p
--;

1683 
	g»suÉ
.
	gmodif›dTime
.
	gtm_hour
 = 
pos
;

1684 
	g»suÉ
.
	gmodif›dTime
.
	gtm_mš
 = 
©oi
(
p
+3);

1685 ià(!
	g¡©e
.
	gnow
)

1687 
time_t
 
	gnow
 = 
time
(
NULL
);

1688 
	g¡©e
.
	gnow
 = 
now
 * 1000000.0;

1691 
gmtime_r
(&
now
, &
¡©e
.
nowFTPTime
);

1692 
	g¡©e
.
	gnowFTPTime
.
	gtm_y—r
 += 1900;

1694 
	g»suÉ
.
	gmodif›dTime
.
	gtm_y—r
 = 
¡©e
.
nowFTPTime
.
tm_y—r
;

1695 iàĞ(Ğ
	g¡©e
.
	gnowFTPTime
.
	gtm_mÚ
 << 4è+ s‹.nowFTPTime.
	gtm_mday
) <

1696 ((
	g»suÉ
.
	gmodif›dTime
.
	gtm_mÚ
 << 4è+„esuÉ.modif›dTime.
	gtm_mday
) )

1697 
	g»suÉ
.
	gmodif›dTime
.
	gtm_y—r
--;

1703 ià(
	gnumtoks
 > (
	gtokm¬k”
+2))

1705 
	gpos
 = 
tokm¬k”
+1;

1706 
	gp
 = 
tok’s
[
pos
];

1707 ià(
	gtokËn
[
pos
] =ğ2 && *
p
 == '-' &&…[1] == '>')

1709 
p
 = &(
tok’s
[
numtoks
-1][
tokËn
[numtoks-1]]);

1710 
	g»suÉ
.
	gty³
 = 
FTPLškEÁry
;

1711 
	g»suÉ
.
	glškÇme
 = 
tok’s
[
pos
+1];

1712 
	g»suÉ
.
	glškÇmeL’gth
 = 
p
 - 
»suÉ
.
lškÇme
;

1713 ià(
	g»suÉ
.
	glškÇmeL’gth
 > 1 &&

1714 
	g»suÉ
.
	glškÇme
[
»suÉ
.
lškÇmeL’gth
-1] == '/')

1715 
»suÉ
.
lškÇmeL’gth
--;

1726  
	g»suÉ
.
	gty³
;

1736  
P¬sšgFaed
(
¡©e
);

	@FTPDirectoryParser.h

71 #iâdeà
FTPDœeùÜyP¬£r_h


72 
	#FTPDœeùÜyP¬£r_h


	)

74 
	~"PÏtfÜmSŒšg.h
"

76 
	~<time.h
>

78 
	#SUPPORT_LSL


	)

79 
	#SUPPORT_DLS


	)

80 
	#SUPPORT_EPLF


	)

81 
	#SUPPORT_DOS


	)

82 
	#SUPPORT_VMS


	)

83 
	#SUPPORT_CMS


	)

84 
	#SUPPORT_OS2


	)

85 
	#SUPPORT_W16


	)

87 
Çme¥aû
 
	gWebCÜe
 {

89 
tm
 
	tFTPTime
;

91 
	sLi¡S‹
 {

92 
Li¡S‹
()

93 : 
now
(0)

94 , 
li¡StyË
(0)

95 , 
·r£dOÃ
(
çl£
)

96 , 
ÿ¼yBufãrL’gth
(0)

97 , 
numLšes
(0)

99 
mem£t
(&
nowFTPTime
, 0, (
FTPTime
));

102 
	gnow
;

103 
FTPTime
 
	gnowFTPTime
;

104 
	gli¡StyË
;

105 
boŞ
 
	g·r£dOÃ
;

106 
	gÿ¼yBufãr
[84];

107 
	gÿ¼yBufãrL’gth
;

108 
št64_t
 
	gnumLšes
;

111 
	eFTPEÁryTy³
 {

112 
	gFTPDœeùÜyEÁry
,

113 
	gFTPFeEÁry
,

114 
	gFTPLškEÁry
,

115 
	gFTPMiscEÁry
,

116 
	gFTPJunkEÁry


119 
	sLi¡ResuÉ


121 
Li¡ResuÉ
()

123 
ş—r
();

126 
ş—r
()

128 
	gv®id
 = 
çl£
;

129 
	gty³
 = 
FTPJunkEÁry
;

130 
	gf’ame
 = 0;

131 
	gf’ameL’gth
 = 0;

132 
	glškÇme
 = 0;

133 
	glškÇmeL’gth
 = 0;

134 
	gfeSize
.
Œunÿ‹
(0);

135 
	gÿ£S’s™ive
 = 
çl£
;

136 
mem£t
(&
modif›dTime
, 0, (
FTPTime
));

139 
boŞ
 
	gv®id
;

140 
FTPEÁryTy³
 
	gty³
;

142 cÚ¡ * 
	gf’ame
;

143 
ušt32_t
 
	gf’ameL’gth
;

145 cÚ¡ * 
	glškÇme
;

146 
ušt32_t
 
	glškÇmeL’gth
;

148 
SŒšg
 
	gfeSize
;

149 
FTPTime
 
	gmodif›dTime
;

150 
boŞ
 
	gÿ£S’s™ive
;

153 
FTPEÁryTy³
 
·r£OÃFTPLše
(cÚ¡ * 
šputLše
, 
Li¡S‹
&, 
Li¡ResuÉ
&);

	@FormState.cpp

2 #ifdeà
SSLAB__DEBUG


3 #iâdeà
SSLAB__QDATETIME


4 
	#SSLAB__QDATETIME


	)

5 
	~<QD©eTime
>

9 #ifdeà
SSLAB__DEBUG


10 #iâdeà
SSLAB__QTHREAD


11 
	#SSLAB__QTHREAD


	)

12 
	~<QTh»ad
>

43 
	~"cÚfig.h
"

44 
	~"FÜmS‹.h
"

46 
	~"F¿me.h
"

47 
	~"HTMLFÜmEËm’t.h
"

49 
Çme¥aû
 
	gWebCÜe
 {

51 
šlše
 
	gFÜmS‹
::
FÜmS‹
(
PassRefPŒ
<
HTMLFÜmEËm’t
> 
fÜm
, 
SŒšgPaœVeùÜ
& 
‹xtF›ldV®uesToAdİt
, PassRefPŒ<
F¿me
> 
sourûF¿me
, 
FÜmSubmissiÚTrigg”
 
fÜmSubmissiÚTrigg”
)

52 : 
m_fÜm
(
fÜm
)

53 , 
m_sourûF¿me
(
sourûF¿me
)

54 , 
m_fÜmSubmissiÚTrigg”
(
fÜmSubmissiÚTrigg”
)

56 #ifdeà
SSLAB__DEBUG


57 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

60 
	gm_‹xtF›ldV®ues
.
sw­
(
‹xtF›ldV®uesToAdİt
);

63 
	gPassRefPŒ
<
	gFÜmS‹
> FÜmS‹::
ü—‹
(
PassRefPŒ
<
HTMLFÜmEËm’t
> 
fÜm
, 
SŒšgPaœVeùÜ
& 
‹xtF›ldV®uesToAdİt
, PassRefPŒ<
F¿me
> 
sourûF¿me
, 
FÜmSubmissiÚTrigg”
 
fÜmSubmissiÚTrigg”
)

65 #ifdeà
SSLAB__DEBUG


66 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

69  
adİtRef
(
Ãw
 
FÜmS‹
(
fÜm
, 
‹xtF›ldV®uesToAdİt
, 
sourûF¿me
, 
fÜmSubmissiÚTrigg”
));

	@FormState.h

29 #iâdeà
FÜmS‹_h


30 
	#FÜmS‹_h


	)

32 
	~"PÏtfÜmSŒšg.h
"

34 
Çme¥aû
 
	gWebCÜe
 {

36 
şass
 
	gF¿me
;

37 
şass
 
	gHTMLFÜmEËm’t
;

39 
	eFÜmSubmissiÚTrigg”
 {

40 
	gSubm™‹dByJavaSüt
,

41 
	gNÙSubm™‹dByJavaSüt


44 
	gVeùÜ
<
	t¡d
::
	t·œ
<
	tSŒšg
, SŒšg> > 
	tSŒšgPaœVeùÜ
;

46 
şass
 
	gFÜmS‹
 : 
public
 
RefCouÁed
<
FÜmS‹
> {

47 
public
:

48 
PassRefPŒ
<
FÜmS‹
> 
ü—‹
(PassRefPŒ<
HTMLFÜmEËm’t
>, 
SŒšgPaœVeùÜ
& 
‹xtF›ldV®uesToAdİt
, PassRefPŒ<
F¿me
>, 
FÜmSubmissiÚTrigg”
);

50 
HTMLFÜmEËm’t
* 
fÜm
(ècÚ¡ {  
	gm_fÜm
.
g‘
(); }

51 cÚ¡ 
	gSŒšgPaœVeùÜ
& 
‹xtF›ldV®ues
(ècÚ¡ {  
	gm_‹xtF›ldV®ues
; }

52 
F¿me
* 
sourûF¿me
(ècÚ¡ {  
	gm_sourûF¿me
.
g‘
(); }

53 
FÜmSubmissiÚTrigg”
 
fÜmSubmissiÚTrigg”
(ècÚ¡ {  
	gm_fÜmSubmissiÚTrigg”
; }

55 
	g´iv©e
:

56 
FÜmS‹
(
PassRefPŒ
<
HTMLFÜmEËm’t
>, 
SŒšgPaœVeùÜ
& 
‹xtF›ldV®uesToAdİt
, PassRefPŒ<
F¿me
>, 
FÜmSubmissiÚTrigg”
);

58 
	gRefPŒ
<
	gHTMLFÜmEËm’t
> 
	gm_fÜm
;

59 
SŒšgPaœVeùÜ
 
	gm_‹xtF›ldV®ues
;

60 
	gRefPŒ
<
	gF¿me
> 
	gm_sourûF¿me
;

61 
FÜmSubmissiÚTrigg”
 
	gm_fÜmSubmissiÚTrigg”
;

	@FrameLoader.cpp

2 #ifdeà
SSLAB__DEBUG


3 #iâdeà
SSLAB__QDATETIME


4 
	#SSLAB__QDATETIME


	)

5 
	~<QD©eTime
>

9 #ifdeà
SSLAB__DEBUG


10 #iâdeà
SSLAB__QTHREAD


11 
	#SSLAB__QTHREAD


	)

12 
	~<QTh»ad
>

47 
	~"cÚfig.h
"

48 
	~"F¿meLßd”.h
"

50 
	~"AµliÿtiÚCacheHo¡.h
"

51 
	~"Archive.h
"

52 
	~"ArchiveFaùÜy.h
"

53 
	~"BackFÜw¬dLi¡.h
"

54 
	~"CSŒšg.h
"

55 
	~"Cache.h
"

56 
	~"CachedPage.h
"

57 
	~"Chrome.h
"

58 
	~"DOMIm¶em’tiÚ.h
"

59 
	~"DOMWšdow.h
"

60 
	~"DocLßd”.h
"

61 
	~"Docum’t.h
"

62 
	~"Docum’tLßd”.h
"

63 
	~"Ed™Ü.h
"

64 
	~"Ed™ÜCl›Á.h
"

65 
	~"EËm’t.h
"

66 
	~"Ev’t.h
"

67 
	~"Ev’tNames.h
"

68 
	~"FlßtReù.h
"

69 
	~"FÜmS‹.h
"

70 
	~"F¿me.h
"

71 
	~"F¿meLßdReque¡.h
"

72 
	~"F¿meLßd”Cl›Á.h
"

73 
	~"F¿meT»e.h
"

74 
	~"F¿meV›w.h
"

75 
	~"HTMLAnchÜEËm’t.h
"

76 
	~"HTMLAµËtEËm’t.h
"

77 
	~"HTMLFÜmEËm’t.h
"

78 
	~"HTMLF¿meEËm’t.h
"

79 
	~"HTMLNames.h
"

80 
	~"HTMLObjeùEËm’t.h
"

81 
	~"HTTPP¬£rs.h
"

82 
	~"Hi¡ÜyI‹m.h
"

83 
	~"IcÚD©aba£.h
"

84 
	~"IcÚLßd”.h
"

85 
	~"In¥eùÜCÚŒŞËr.h
"

86 
	~"Loggšg.h
"

87 
	~"MIMETy³Regi¡ry.h
"

88 
	~"MašResourûLßd”.h
"

89 
	~"Page.h
"

90 
	~"PageCache.h
"

91 
	~"PageGroup.h
"

92 
	~"PageT¿ns™iÚEv’t.h
"

93 
	~"PÏûhŞd”Docum’t.h
"

94 
	~"PlugšD©a.h
"

95 
	~"PlugšD©aba£.h
"

96 
	~"PlugšDocum’t.h
"

97 
	~"Prog»ssT¿ck”.h
"

98 
	~"R’d”EmbeddedObjeù.h
"

99 
	~"R’d”V›w.h
"

100 
	~"ResourûHªdË.h
"

101 
	~"ResourûReque¡.h
"

102 
	~"SütCÚŒŞËr.h
"

103 
	~"SütSourûCode.h
"

104 
	~"SütSŒšg.h
"

105 
	~"SütV®ue.h
"

106 
	~"Secur™yOrigš.h
"

107 
	~"Segm’‹dSŒšg.h
"

108 
	~"S‘tšgs.h
"

110 #ià
ENABLE
(
SHARED_WORKERS
)

111 
	~"Sh¬edWÜk”R•os™Üy.h
"

114 
	~"TextResourûDecod”.h
"

115 
	~"WšdowF—tu»s.h
"

116 
	~"XMLH‰pReque¡.h
"

117 
	~"XMLTok’iz”.h
"

118 
	~"XSSAud™Ü.h
"

119 
	~<wtf/Cu¼’tTime.h
>

120 
	~<wtf/StdLibExŒas.h
>

123 #ià
ENABLE
(
SVG
)

124 
	~"SVGDocum’t.h
"

125 
	~"SVGLoÿbË.h
"

126 
	~"SVGNames.h
"

127 
	~"SVGP»£rveA¥eùR©io.h
"

128 
	~"SVGSVGEËm’t.h
"

129 
	~"SVGV›wEËm’t.h
"

130 
	~"SVGV›wS³c.h
"

133 
Çme¥aû
 
	gWebCÜe
 {

135 #ià
ENABLE
(
SVG
)

136 
usšg
 
Çme¥aû
 
	gSVGNames
;

138 
usšg
 
Çme¥aû
 
	gHTMLNames
;

140 #ià
ENABLE
(
XHTMLMP
)

141 cÚ¡ 
	gdeçuÉAcû±H—d”
[] = "application/xml,application/vnd.wap.xhtml+xml,application/xhtml+xml;profile='http://www.wapforum.org/xhtml',text/html;q=0.9,text/plain;q=0.8,image/png,*/*;q=0.5";

143 cÚ¡ 
	gdeçuÉAcû±H—d”
[] = "application/xml,application/xhtml+xml,text/html;q=0.9,text/plain;q=0.8,image/png,*/*;q=0.5";

145 
	g¡ÜedTimeOfLa¡Com¶‘edLßd
;

147 
boŞ
 
isBackFÜw¬dLßdTy³
(
F¿meLßdTy³
 
ty³
)

149 #ifdeà
SSLAB__DEBUG


150 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

153 
	gty³
) {

154 
	gF¿meLßdTy³Snd¬d
:

155 
F¿meLßdTy³R–ßd
:

156 
F¿meLßdTy³R–ßdFromOrigš
:

157 
F¿meLßdTy³Same
:

158 
F¿meLßdTy³RedœeùW™hLockedBackFÜw¬dLi¡
:

159 
F¿meLßdTy³R•Ïû
:

160  
çl£
;

161 
	gF¿meLßdTy³Back
:

162 
F¿meLßdTy³BackWMLDeckNÙAcûssibË
:

163 
F¿meLßdTy³FÜw¬d
:

164 
F¿meLßdTy³IndexedBackFÜw¬d
:

165  
Œue
;

167 
ASSERT_NOT_REACHED
();

168  
	gçl£
;

171 
numReque¡s
(
Docum’t
* 
docum’t
)

173 #ifdeà
SSLAB__DEBUG


174 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

177 ià(!
	gdocum’t
)

180  
	gdocum’t
->
docLßd”
()->
»que¡CouÁ
();

183 
šlše
 
boŞ
 
ÿnReãrToP¬’tF¿meEncodšg
(cÚ¡ 
F¿me
* 
äame
, cÚ¡ F¿me* 
·»ÁF¿me
)

185 #ifdeà
SSLAB__DEBUG


186 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

189  
	g·»ÁF¿me
 &&…¬’tF¿me->
docum’t
()->
£cur™yOrigš
()->
ÿnAcûss
(
äame
->document()->securityOrigin());

192 
	gF¿meLßd”
::
F¿meLßd”
(
F¿me
* 
äame
, 
F¿meLßd”Cl›Á
* 
ş›Á
)

193 : 
m_äame
(
äame
)

194 , 
m_ş›Á
(
ş›Á
)

195 , 
m_pŞicyCheck”
(
äame
)

196 , 
m_hi¡Üy
(
äame
)

197 , 
m_nÙiãr
(
äame
)

198 , 
m_¡©e
(
F¿meS‹Comm™‹dPage
)

199 , 
m_lßdTy³
(
F¿meLßdTy³Snd¬d
)

200 , 
m_d–eg©eIsHªdlšgProvisiÚ®LßdE¼Ü
(
çl£
)

201 , 
m_fœ¡LayoutDÚe
(
çl£
)

202 , 
m_quickRedœeùComšg
(
çl£
)

203 , 
m_£ÁRedœeùNÙifiÿtiÚ
(
çl£
)

204 , 
m_šStİAÎLßd”s
(
çl£
)

205 , 
m_isExecutšgJavaSütFÜmAùiÚ
(
çl£
)

206 , 
m_didC®lIm¶ic™Clo£
(
çl£
)

207 , 
m_wasUÆßdEv’tEm™‹d
(
çl£
)

208 , 
m_uÆßdEv’tBešgDi¥©ched
(
çl£
)

209 , 
m_isCom¶‘e
(
çl£
)

210 , 
m_isLßdšgMašResourû
(
çl£
)

211 , 
m_ÃedsCË¬
(
çl£
)

212 , 
m_»ûivedD©a
(
çl£
)

213 , 
m_’codšgWasCho£nByU£r
(
çl£
)

214 , 
m_cÚšsPlugIns
(
çl£
)

215 , 
m_checkTim”
(
this
, &
F¿meLßd”
::
checkTim”Fœed
)

216 , 
m_shouldC®lCheckCom¶‘ed
(
çl£
)

217 , 
m_shouldC®lCheckLßdCom¶‘e
(
çl£
)

218 , 
m_İ’”
(0)

219 , 
m_ü—tšgIn™ŸlEm±yDocum’t
(
çl£
)

220 , 
m_isDi¥ÏyšgIn™ŸlEm±yDocum’t
(
çl£
)

221 , 
m_comm™‹dFœ¡R—lDocum’tLßd
(
çl£
)

222 , 
m_didP”fÜmFœ¡Navig©iÚ
(
çl£
)

223 , 
m_lßdšgFromCachedPage
(
çl£
)

224 , 
m_suµ»ssO³ÃrInNewF¿me
(
çl£
)

225 , 
m_§ndboxFÏgs
(
SªdboxAÎ
)

226 #iâdeà
NDEBUG


227 , 
m_didDi¥©chDidComm™Lßd
(
çl£
)

232 
	gF¿meLßd”
::~
F¿meLßd”
()

234 #ifdeà
SSLAB__DEBUG


235 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

238 
£tO³Ãr
(0);

240 
	gHashS‘
<
	gF¿me
*>::
™”©Ü
 
’d
 = 
m_İ’edF¿mes
.end();

241 
	gHashS‘
<
	gF¿me
*>::
™”©Ü
 
™
 = 
m_İ’edF¿mes
.
begš
(); 
	g™
 !ğ
’d
; ++it)

242 (*
	g™
)->
lßd”
()->
	gm_İ’”
 = 0;

244 
	gm_ş›Á
->
äameLßd”De¡royed
();

247 
	gF¿meLßd”
::
š™
()

249 #ifdeà
SSLAB__DEBUG


250 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

254 
	gm_isDi¥ÏyšgIn™ŸlEm±yDocum’t
 = 
çl£
;

255 
	gm_ü—tšgIn™ŸlEm±yDocum’t
 = 
Œue
;

256 
£tPŞicyDocum’tLßd”
(
m_ş›Á
->
ü—‹Docum’tLßd”
(
ResourûReque¡
(
KURL
(
P¬£dURLSŒšg
, "")), 
Sub¡™u‹D©a
()).
g‘
());

257 
£tProvisiÚ®Docum’tLßd”
(
m_pŞicyDocum’tLßd”
.
g‘
());

258 
£tS‹
(
F¿meS‹ProvisiÚ®
);

259 
	gm_´ovisiÚ®Docum’tLßd”
->
£tRe¥Ú£
(
ResourûRe¥Ú£
(
KURL
(), "‹xt/html", 0, 
SŒšg
(), String()));

260 
	gm_´ovisiÚ®Docum’tLßd”
->
fšishedLßdšg
();

261 
begš
(
KURL
(), 
çl£
);

262 
’d
();

263 
	gm_äame
->
docum’t
()->
ÿnûlP¬sšg
();

264 
	gm_ü—tšgIn™ŸlEm±yDocum’t
 = 
çl£
;

265 
	gm_didC®lIm¶ic™Clo£
 = 
Œue
;

268 
upd©eSªdboxFÏgs
();

271 
	gF¿meLßd”
::
£tDeãrsLßdšg
(
boŞ
 
deãrs
)

273 #ifdeà
SSLAB__DEBUG


274 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

277 ià(
	gm_docum’tLßd”
)

278 
	gm_docum’tLßd”
->
£tDeãrsLßdšg
(
deãrs
);

279 ià(
	gm_´ovisiÚ®Docum’tLßd”
)

280 
	gm_´ovisiÚ®Docum’tLßd”
->
£tDeãrsLßdšg
(
deãrs
);

281 ià(
	gm_pŞicyDocum’tLßd”
)

282 
	gm_pŞicyDocum’tLßd”
->
£tDeãrsLßdšg
(
deãrs
);

284 ià(!
	gdeãrs
) {

285 
	gm_äame
->
»dœeùScheduËr
()->
¡¬tTim”
();

286 
¡¬tCheckCom¶‘eTim”
();

290 
F¿me
* 
	gF¿meLßd”
::
ü—‹Wšdow
(
F¿meLßd”
* 
äameLßd”FÜF¿meLookup
, cÚ¡ 
F¿meLßdReque¡
& 
»que¡
, cÚ¡ 
WšdowF—tu»s
& 
ã©u»s
, 
boŞ
& 
ü—‹d
)

292 #ifdeà
SSLAB__DEBUG


293 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

296 
ASSERT
(!
ã©u»s
.
dŸlog
 || 
»que¡
.
äameName
().
isEm±y
());

298 ià(!
	g»que¡
.
äameName
().
isEm±y
() &&„equest.frameName() != "_blank") {

299 
F¿me
* 
äame
 = 
äameLßd”FÜF¿meLookup
->äame()->
Œ“
()->
fšd
(
»que¡
.
äameName
());

300 ià(
	gäame
 && 
shouldAÎowNavig©iÚ
(
äame
)) {

301 ià(!
	g»que¡
.
»sourûReque¡
().
u¾
().
isEm±y
())

302 
	gäame
->
lßd”
()->
lßdF¿meReque¡
(
»que¡
, 
çl£
, f®£, 0, 0, 
S’dReã¼”
);

303 ià(
Page
* 
	g·ge
 = 
äame
->
·ge
())

304 
·ge
->
chrome
()->
focus
();

305 
	gü—‹d
 = 
çl£
;

306  
	gäame
;

311 
F¿meLßdReque¡
 
	g»que¡W™hReã¼”
 = 
»que¡
;

312 
	g»que¡W™hReã¼”
.
»sourûReque¡
().
£tHTTPReã¼”
(
m_outgošgReã¼”
);

313 
addHTTPOrigšIfN“ded
(
»que¡W™hReã¼”
.
»sourûReque¡
(), 
outgošgOrigš
());

315 
Page
* 
	gŞdPage
 = 
m_äame
->
·ge
();

316 ià(!
	gŞdPage
)

319 
Page
* 
	g·ge
 = 
ŞdPage
->
chrome
()->
ü—‹Wšdow
(
m_äame
, 
»que¡W™hReã¼”
, 
ã©u»s
);

320 ià(!
	g·ge
)

323 
F¿me
* 
	gäame
 = 
·ge
->
mašF¿me
();

324 ià(
	g»que¡
.
äameName
() != "_blank")

325 
äame
->
Œ“
()->
£tName
(
»que¡
.
äameName
());

327 
	g·ge
->
chrome
()->
£tToŞb¬sVisibË
(
ã©u»s
.
toŞB¬VisibË
 || f—tu»s.
loÿtiÚB¬VisibË
);

328 
	g·ge
->
chrome
()->
£tStusb¬VisibË
(
ã©u»s
.
¡©usB¬VisibË
);

329 
	g·ge
->
chrome
()->
£tSüŞlb¬sVisibË
(
ã©u»s
.
süŞlb¬sVisibË
);

330 
	g·ge
->
chrome
()->
£tM’ub¬VisibË
(
ã©u»s
.
m’uB¬VisibË
);

331 
	g·ge
->
chrome
()->
£tResizabË
(
ã©u»s
.
»sizabË
);

337 
FlßtReù
 
	gwšdowReù
 = 
·ge
->
chrome
()->
wšdowReù
();

338 
FlßtSize
 
	g·geSize
 = 
·ge
->
chrome
()->
·geReù
().
size
();

339 ià(
	gã©u»s
.
	gxS‘
)

340 
	gwšdowReù
.
£tX
(
ã©u»s
.
x
);

341 ià(
	gã©u»s
.
	gyS‘
)

342 
	gwšdowReù
.
£tY
(
ã©u»s
.
y
);

343 ià(
	gã©u»s
.
	gwidthS‘
)

344 
	gwšdowReù
.
£tWidth
(
ã©u»s
.
width
 + (
wšdowReù
.width(è- 
·geSize
.width()));

345 ià(
	gã©u»s
.
	gheightS‘
)

346 
	gwšdowReù
.
£tHeight
(
ã©u»s
.
height
 + (
wšdowReù
.height(è- 
·geSize
.height()));

347 
	g·ge
->
chrome
()->
£tWšdowReù
(
wšdowReù
);

349 
	g·ge
->
chrome
()->
show
();

351 
	gü—‹d
 = 
Œue
;

352  
	gäame
;

355 
boŞ
 
	gF¿meLßd”
::
ÿnHªdËReque¡
(cÚ¡ 
ResourûReque¡
& 
»que¡
)

357 #ifdeà
SSLAB__DEBUG


358 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

361  
	gm_ş›Á
->
ÿnHªdËReque¡
(
»que¡
);

364 
	gF¿meLßd”
::
chªgeLoÿtiÚ
(cÚ¡ 
KURL
& 
u¾
, cÚ¡ 
SŒšg
& 
»ã¼”
, 
boŞ
 
lockHi¡Üy
, boŞ 
lockBackFÜw¬dLi¡
, boŞ 
u£rGe¡u»
, boŞ 
»äesh
)

366 #ifdeà
SSLAB__DEBUG


367 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

370 
	gRefPŒ
<
	gF¿me
> 
´Ùeù
(
m_äame
);

372 
ResourûReque¡
 
»que¡
(
u¾
, 
»ã¼”
, 
»äesh
 ? 
R–ßdIgnÜšgCacheD©a
 : 
U£PrÙocŞCachePŞicy
);

374 ià(
	gm_äame
->
süt
()->
execu‹IfJavaSütURL
(
»que¡
.
u¾
(), 
u£rGe¡u»
))

377 
u¾S–eùed
(
»que¡
, "_£lf", 0, 
lockHi¡Üy
, 
lockBackFÜw¬dLi¡
, 
u£rGe¡u»
, 
S’dReã¼”
);

380 
	gF¿meLßd”
::
u¾S–eùed
(cÚ¡ 
ResourûReque¡
& 
»que¡
, cÚ¡ 
SŒšg
& 
·s£dT¬g‘
, 
PassRefPŒ
<
Ev’t
> 
Œigg”šgEv’t
, 
boŞ
 
lockHi¡Üy
, boŞ 
lockBackFÜw¬dLi¡
, boŞ 
u£rGe¡u»
, 
Reã¼”PŞicy
 
»ã¼”PŞicy
)

382 #ifdeà
SSLAB__DEBUG


383 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

386 
ASSERT
(!
m_suµ»ssO³ÃrInNewF¿me
);

388 ià(
	gm_äame
->
süt
()->
execu‹IfJavaSütURL
(
»que¡
.
u¾
(), 
u£rGe¡u»
, 
çl£
))

391 
SŒšg
 
	grg‘
 = 
·s£dT¬g‘
;

392 ià(
	grg‘
.
isEm±y
())

393 
	grg‘
 = 
m_äame
->
docum’t
()->
ba£T¬g‘
();

395 
F¿meLßdReque¡
 
äameReque¡
(
»que¡
, 
rg‘
);

397 ià(
	g»ã¼”PŞicy
 =ğ
NoReã¼”
)

398 
m_suµ»ssO³ÃrInNewF¿me
 = 
Œue
;

399 ià(
	gäameReque¡
.
»sourûReque¡
().
h‰pReã¼”
().
isEm±y
())

400 
	gäameReque¡
.
»sourûReque¡
().
£tHTTPReã¼”
(
m_outgošgReã¼”
);

401 
addHTTPOrigšIfN“ded
(
äameReque¡
.
»sourûReque¡
(), 
outgošgOrigš
());

403 
lßdF¿meReque¡
(
äameReque¡
, 
lockHi¡Üy
, 
lockBackFÜw¬dLi¡
, 
Œigg”šgEv’t
, 0, 
»ã¼”PŞicy
);

405 
	gm_suµ»ssO³ÃrInNewF¿me
 = 
çl£
;

408 
boŞ
 
	gF¿meLßd”
::
»que¡F¿me
(
HTMLF¿meOwÃrEËm’t
* 
owÃrEËm’t
, cÚ¡ 
SŒšg
& 
u¾SŒšg
, cÚ¡ 
AtomicSŒšg
& 
äameName
, boŞ 
lockHi¡Üy
, boŞ 
lockBackFÜw¬dLi¡
)

410 #ifdeà
SSLAB__DEBUG


411 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

415 
KURL
 
	gsütURL
;

416 
KURL
 
	gu¾
;

417 ià(
´ÙocŞIsJavaSüt
(
u¾SŒšg
)) {

418 
	gsütURL
 = 
com¶‘eURL
(
u¾SŒšg
);

419 
	gu¾
 = 
bÏnkURL
();

421 
	gu¾
 = 
com¶‘eURL
(
u¾SŒšg
);

423 
F¿me
* 
	gäame
 = 
owÃrEËm’t
->
cÚ‹ÁF¿me
();

424 ià(
	gäame
)

425 
	gäame
->
»dœeùScheduËr
()->
scheduËLoÿtiÚChªge
(
u¾
.
¡ršg
(), 
m_outgošgReã¼”
, 
lockHi¡Üy
, 
lockBackFÜw¬dLi¡
, 
isProûssšgU£rGe¡u»
());

427 
	gäame
 = 
lßdSubäame
(
owÃrEËm’t
, 
u¾
, 
äameName
, 
m_outgošgReã¼”
);

429 ià(!
	gäame
)

430  
	gçl£
;

432 ià(!
	gsütURL
.
isEm±y
())

433 
	gäame
->
süt
()->
execu‹IfJavaSütURL
(
sütURL
);

435  
	gŒue
;

438 
F¿me
* 
	gF¿meLßd”
::
lßdSubäame
(
HTMLF¿meOwÃrEËm’t
* 
owÃrEËm’t
, cÚ¡ 
KURL
& 
u¾
, cÚ¡ 
SŒšg
& 
Çme
, cÚ¡ SŒšg& 
»ã¼”
)

440 #ifdeà
SSLAB__DEBUG


441 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

444 
boŞ
 
	g®lowsSüŞlšg
 = 
Œue
;

445 
	gm¬gšWidth
 = -1;

446 
	gm¬gšHeight
 = -1;

447 ià(
	gowÃrEËm’t
->
hasTagName
(
äameTag
è|| owÃrEËm’t->hasTagName(
iäameTag
)) {

448 
HTMLF¿meEËm’tBa£
* 
	go
 = 
¡©ic_ÿ¡
<HTMLF¿meEËm’tBa£*>(
owÃrEËm’t
);

449 
	g®lowsSüŞlšg
 = 
o
->
süŞlšgMode
(è!ğ
SüŞlb¬AlwaysOff
;

450 
	gm¬gšWidth
 = 
o
->
g‘M¬gšWidth
();

451 
	gm¬gšHeight
 = 
o
->
g‘M¬gšHeight
();

454 ià(!
	gSecur™yOrigš
::
ÿnLßd
(
u¾
, 
»ã¼”
, 0)) {

455 
	gF¿meLßd”
::
»pÜtLoÿlLßdFaed
(
m_äame
, 
u¾
.
¡ršg
());

459 
boŞ
 
	ghideReã¼”
 = 
Secur™yOrigš
::
shouldHideReã¼”
(
u¾
, 
»ã¼”
);

460 
	gRefPŒ
<
	gF¿me
> 
	gäame
 = 
m_ş›Á
->
ü—‹F¿me
(
u¾
, 
Çme
, 
owÃrEËm’t
, 
hideReã¼”
 ? 
SŒšg
(è: 
»ã¼”
, 
®lowsSüŞlšg
, 
m¬gšWidth
, 
m¬gšHeight
);

462 ià(!
	gäame
) {

463 
checkC®lIm¶ic™Clo£
();

473 
	gäame
->
lßd”
()->
	gm_isCom¶‘e
 = 
çl£
;

475 
R’d”Objeù
* 
	g»nd””
 = 
owÃrEËm’t
->
»nd””
();

476 
F¿meV›w
* 
	gv›w
 = 
äame
->
v›w
();

477 ià(
	g»nd””
 &&„’d””->
isWidg‘
(è&& 
	gv›w
)

478 
toR’d”Widg‘
(
»nd””
)->
£tWidg‘
(
v›w
);

480 
checkC®lIm¶ic™Clo£
();

491 ià(
	gäame
->
lßd”
()->
¡©e
(è=ğ
F¿meS‹Com¶‘e
)

492 
äame
->
lßd”
()->
checkCom¶‘ed
();

494  
	gäame
.
g‘
();

497 
	gF¿meLßd”
::
subm™FÜm
(cÚ¡ * 
aùiÚ
, cÚ¡ 
SŒšg
& 
u¾
, 
PassRefPŒ
<
FÜmD©a
> 
fÜmD©a
,

498 cÚ¡ 
SŒšg
& 
rg‘
, cÚ¡ SŒšg& 
cÚ‹ÁTy³
, cÚ¡ SŒšg& 
bound¬y
,

499 
boŞ
 
lockHi¡Üy
, 
PassRefPŒ
<
Ev’t
> 
ev’t
, PassRefPŒ<
FÜmS‹
> 
fÜmS‹
)

501 #ifdeà
SSLAB__DEBUG


502 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

505 
ASSERT
(
aùiÚ
);

506 
ASSERT
(
¡rcmp
(
aùiÚ
, "GET") == 0 || strcmp(action, "POST") == 0);

507 
ASSERT
(
fÜmD©a
);

508 
ASSERT
(
fÜmS‹
);

509 
ASSERT
(
fÜmS‹
->
sourûF¿me
(è=ğ
m_äame
);

511 ià(!
	gm_äame
->
·ge
())

514 
KURL
 
	gu
 = 
com¶‘eURL
(
u¾
.
isNuÎ
() ? "" : url);

515 ià(
	gu
.
isEm±y
())

518 ià(
isDocum’tSªdboxed
(
SªdboxFÜms
))

521 ià(
´ÙocŞIsJavaSüt
(
u
)) {

522 
	gm_isExecutšgJavaSütFÜmAùiÚ
 = 
Œue
;

523 
	gm_äame
->
süt
()->
execu‹IfJavaSütURL
(
u
, 
çl£
, false);

524 
	gm_isExecutšgJavaSütFÜmAùiÚ
 = 
çl£
;

528 
F¿meLßdReque¡
 
	gäameReque¡
;

530 
SŒšg
 
	grg‘OrBa£T¬g‘
 = 
rg‘
.
isEm±y
(è? 
m_äame
->
docum’t
()->
ba£T¬g‘
() :arget;

531 
F¿me
* 
	grg‘F¿me
 = 
m_äame
->
Œ“
()->
fšd
(
rg‘OrBa£T¬g‘
);

532 ià(!
shouldAÎowNavig©iÚ
(
rg‘F¿me
))

534 ià(!
	grg‘F¿me
) {

535 
	grg‘F¿me
 = 
m_äame
;

536 
	gäameReque¡
.
£tF¿meName
(
rg‘OrBa£T¬g‘
);

538 ià(!
	grg‘F¿me
->
·ge
())

553 ià(
	gm_äame
->
Œ“
()->
isDesûndªtOf
(
rg‘F¿me
)) {

554 ià(
	gm_subm™‹dFÜmURL
 =ğ
u
)

556 
	gm_subm™‹dFÜmURL
 = 
u
;

559 
	gfÜmD©a
->
g’”©eFes
(
m_äame
->
·ge
()->
chrome
()->
ş›Á
());

561 ià(!
	gm_outgošgReã¼”
.
isEm±y
())

562 
	gäameReque¡
.
»sourûReque¡
().
£tHTTPReã¼”
(
m_outgošgReã¼”
);

564 ià(
¡rcmp
(
aùiÚ
, "GET") == 0)

565 
u
.
£tQu”y
(
fÜmD©a
->
æ©‹nToSŒšg
());

567 
	gäameReque¡
.
»sourûReque¡
().
£tHTTPM‘hod
("POST");

568 
	gäameReque¡
.
»sourûReque¡
().
£tHTTPBody
(
fÜmD©a
);

571 ià(
	gcÚ‹ÁTy³
.
isNuÎ
() || contentType == "application/x-www-form-urlencoded")

572 
äameReque¡
.
»sourûReque¡
().
£tHTTPCÚ‹ÁTy³
(
cÚ‹ÁTy³
);

574 
	gäameReque¡
.
»sourûReque¡
().
£tHTTPCÚ‹ÁTy³
(
cÚ‹ÁTy³
 + "; bound¬y=" + 
bound¬y
);

577 
	gäameReque¡
.
»sourûReque¡
().
£tURL
(
u
);

578 
addHTTPOrigšIfN“ded
(
äameReque¡
.
»sourûReque¡
(), 
outgošgOrigš
());

580 
	grg‘F¿me
->
»dœeùScheduËr
()->
scheduËFÜmSubmissiÚ
(
äameReque¡
, 
lockHi¡Üy
, 
ev’t
, 
fÜmS‹
);

583 
	gF¿meLßd”
::
¡İLßdšg
(
UÆßdEv’tPŞicy
 
uÆßdEv’tPŞicy
, 
D©aba£PŞicy
 
d©aba£PŞicy
)

585 #ifdeà
SSLAB__DEBUG


586 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

589 ià(
	gm_äame
->
docum’t
(è&& m_äame->docum’t()->
tok’iz”
())

590 
	gm_äame
->
docum’t
()->
tok’iz”
()->
¡İP¬sšg
();

592 ià(
	guÆßdEv’tPŞicy
 !ğ
UÆßdEv’tPŞicyNÚe
) {

593 ià(
m_äame
->
docum’t
()) {

594 ià(
m_didC®lIm¶ic™Clo£
 && !
m_wasUÆßdEv’tEm™‹d
) {

595 
Node
* 
cu¼’tFocu£dNode
 = 
m_äame
->
docum’t
()->
focu£dNode
();

596 ià(
	gcu¼’tFocu£dNode
)

597 
	gcu¼’tFocu£dNode
->
aboutToUÆßd
();

598 
	gm_uÆßdEv’tBešgDi¥©ched
 = 
Œue
;

599 ià(
	gm_äame
->
domWšdow
()) {

600 ià(
	guÆßdEv’tPŞicy
 =ğ
UÆßdEv’tPŞicyUÆßdAndPageHide
)

601 
m_äame
->
domWšdow
()->
di¥©chEv’t
(
PageT¿ns™iÚEv’t
::
ü—‹
(
ev’tNames
().
·gehideEv’t
, m_äame->
docum’t
()->
šPageCache
()), m_frame->document());

602 ià(!
	gm_äame
->
docum’t
()->
šPageCache
())

603 
	gm_äame
->
domWšdow
()->
di¥©chEv’t
(
Ev’t
::
ü—‹
(
ev’tNames
().
uÆßdEv’t
, 
çl£
, f®£), 
m_äame
->domWšdow()->
docum’t
());

605 
	gm_uÆßdEv’tBešgDi¥©ched
 = 
çl£
;

606 ià(
	gm_äame
->
docum’t
())

607 
	gm_äame
->
docum’t
()->
upd©eStyËIfN“ded
();

608 
	gm_wasUÆßdEv’tEm™‹d
 = 
Œue
;

613 ià(
	gm_äame
->
docum’t
(è&& !m_äame->docum’t()->
šPageCache
()) {

615 
boŞ
 
	gk“pEv’tLi¡’”s
 = 
m_isDi¥ÏyšgIn™ŸlEm±yDocum’t
 && 
m_´ovisiÚ®Docum’tLßd”


616 && 
m_äame
->
docum’t
()->
£cur™yOrigš
()->
isSecu»T¿ns™iÚTo
(
m_´ovisiÚ®Docum’tLßd”
->
u¾
());

618 ià(!
	gk“pEv’tLi¡’”s
)

619 
	gm_äame
->
docum’t
()->
»moveAÎEv’tLi¡’”s
();

623 
	gm_isCom¶‘e
 = 
Œue
;

624 
	gm_isLßdšgMašResourû
 = 
çl£
;

625 
	gm_didC®lIm¶ic™Clo£
 = 
Œue
;

627 ià(
	gm_äame
->
docum’t
(è&& m_äame->docum’t()->
·rsšg
()) {

628 
fšishedP¬sšg
();

629 
	gm_äame
->
docum’t
()->
£tP¬sšg
(
çl£
);

632 
	gm_wÜkšgURL
 = 
KURL
();

634 ià(
Docum’t
* 
	gdoc
 = 
m_äame
->
docum’t
()) {

635 ià(
DocLßd”
* 
docLßd”
 = 
doc
->docLoader())

636 
ÿche
()->
lßd”
()->
ÿnûlReque¡s
(
docLßd”
);

638 #ià
ENABLE
(
DATABASE
)

639 ià(
	gd©aba£PŞicy
 =ğ
D©aba£PŞicyStİ
)

640 
doc
->
¡İD©aba£s
(0);

642 
UNUSED_PARAM
(
d©aba£PŞicy
);

647 
F¿me
* 
	gchd
 = 
m_äame
->
Œ“
()->
fœ¡Chd
(); chd; chd = 
chd
->Œ“()->
ÃxtSiblšg
())

648 
chd
->
lßd”
()->
¡İLßdšg
(
uÆßdEv’tPŞicy
);

650 
	gm_äame
->
»dœeùScheduËr
()->
ÿnûl
();

653 
	gF¿meLßd”
::
¡İ
()

655 #ifdeà
SSLAB__DEBUG


656 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

661 
	gRefPŒ
<
	gF¿me
> 
´ÙeùÜ
(
m_äame
);

663 ià(
	gm_äame
->
docum’t
()->
tok’iz”
())

664 
	gm_äame
->
docum’t
()->
tok’iz”
()->
¡İP¬sšg
();

665 
	gm_äame
->
docum’t
()->
fšishP¬sšg
();

667 ià(
	gm_icÚLßd”
)

668 
	gm_icÚLßd”
->
¡İLßdšg
();

671 
boŞ
 
	gF¿meLßd”
::
şo£URL
()

673 #ifdeà
SSLAB__DEBUG


674 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

677 
hi¡Üy
()->
§veDocum’tS‹
();

680 
Docum’t
* 
	gcu¼’tDocum’t
 = 
m_äame
->
docum’t
();

681 
¡İLßdšg
(
cu¼’tDocum’t
 && !cu¼’tDocum’t->
šPageCache
(è? 
UÆßdEv’tPŞicyUÆßdAndPageHide
 : 
UÆßdEv’tPŞicyUÆßdOÆy
);

683 
	gm_äame
->
ed™Ü
()->
ş—rUndoRedoO³¿tiÚs
();

684  
	gŒue
;

687 
KURL
 
	gF¿meLßd”
::
icÚURL
()

689 #ifdeà
SSLAB__DEBUG


690 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

694 ià(
	gm_äame
->
Œ“
(è&& m_äame->Œ“()->
·»Á
())

695  
KURL
();

698 ià(!
	gm_äame
->
docum’t
()->
icÚURL
().
isEm±y
())

699  
KURL
(
P¬£dURLSŒšg
, 
m_äame
->
docum’t
()->
icÚURL
());

702 ià(!
	gm_URL
.
´ÙocŞInHTTPFamy
())

703  
KURL
();

705 
KURL
 
	gu¾
;

706 
boŞ
 
	gcouldS‘PrÙocŞ
 = 
u¾
.
£tPrÙocŞ
(
m_URL
.
´ÙocŞ
());

707 
ASSERT_UNUSED
(
couldS‘PrÙocŞ
, couldSetProtocol);

708 
	gu¾
.
£tHo¡
(
m_URL
.
ho¡
());

709 ià(
	gm_URL
.
hasPÜt
())

710 
	gu¾
.
£tPÜt
(
m_URL
.
pÜt
());

711 
	gu¾
.
£tP©h
("/favicon.ico");

712  
	gu¾
;

715 
boŞ
 
	gF¿meLßd”
::
didO³nURL
(cÚ¡ 
KURL
& 
u¾
)

717 #ifdeà
SSLAB__DEBUG


718 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

721 ià(
	gm_äame
->
»dœeùScheduËr
()->
»dœeùScheduËdDuršgLßd
()) {

724  
	gçl£
;

727 
	gm_äame
->
»dœeùScheduËr
()->
ÿnûl
();

728 
	gm_äame
->
ed™Ü
()->
ş—rLa¡Ed™Commªd
();

730 
	gm_isCom¶‘e
 = 
çl£
;

731 
	gm_isLßdšgMašResourû
 = 
Œue
;

732 
	gm_didC®lIm¶ic™Clo£
 = 
çl£
;

737 ià(!
	gm_ü—tšgIn™ŸlEm±yDocum’t
) {

738 
	gm_äame
->
£tJSStusB¬Text
(
SŒšg
());

739 
	gm_äame
->
£tJSDeçuÉStusB¬Text
(
SŒšg
());

741 
	gm_URL
 = 
u¾
;

742 ià(
	gm_URL
.
´ÙocŞInHTTPFamy
(è&& !m_URL.
ho¡
().
isEm±y
(è&& m_URL.
·th
().isEmpty())

743 
	gm_URL
.
£tP©h
("/");

744 
	gm_wÜkšgURL
 = 
m_URL
;

746 
¡¬‹d
();

748  
	gŒue
;

751 
	gF¿meLßd”
::
didEx¶ic™O³n
()

753 #ifdeà
SSLAB__DEBUG


754 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

757 
	gm_isCom¶‘e
 = 
çl£
;

758 
	gm_didC®lIm¶ic™Clo£
 = 
çl£
;

761 
	gm_comm™‹dFœ¡R—lDocum’tLßd
 = 
Œue
;

767 
	gm_äame
->
»dœeùScheduËr
()->
ÿnûl
();

768 ià(
	gm_äame
->
docum’t
()->
u¾
(è!ğ
bÏnkURL
())

769 
m_URL
 = 
m_äame
->
docum’t
()->
u¾
();

773 
	gF¿meLßd”
::
ÿnûlAndCË¬
()

775 #ifdeà
SSLAB__DEBUG


776 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

779 
	gm_äame
->
»dœeùScheduËr
()->
ÿnûl
();

781 ià(!
	gm_isCom¶‘e
)

782 
şo£URL
();

784 
ş—r
(
çl£
);

785 
	gm_äame
->
süt
()->
upd©ePÏtfÜmSütObjeùs
();

788 
	gF¿meLßd”
::
»¶aûDocum’t
(cÚ¡ 
SŒšg
& 
html
)

790 #ifdeà
SSLAB__DEBUG


791 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

794 
¡İAÎLßd”s
();

795 
begš
(
m_URL
, 
Œue
, 
m_äame
->
docum’t
()->
£cur™yOrigš
());

796 
wr™e
(
html
);

797 
’d
();

800 
	gF¿meLßd”
::
ş—r
(
boŞ
 
ş—rWšdowPrİ”t›s
, boŞ 
ş—rSütObjeùs
, boŞ 
ş—rF¿meV›w
)

802 #ifdeà
SSLAB__DEBUG


803 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

806 
	gm_äame
->
ed™Ü
()->
ş—r
();

808 ià(!
	gm_ÃedsCË¬
)

810 
	gm_ÃedsCË¬
 = 
çl£
;

812 ià(!
	gm_äame
->
docum’t
()->
šPageCache
()) {

813 
	gm_äame
->
docum’t
()->
ÿnûlP¬sšg
();

814 
	gm_äame
->
docum’t
()->
¡İAùiveDOMObjeùs
();

815 ià(
	gm_äame
->
docum’t
()->
©ched
()) {

816 
	gm_äame
->
docum’t
()->
wlRemove
();

817 
	gm_äame
->
docum’t
()->
d‘ach
();

819 
	gm_äame
->
docum’t
()->
»moveFocu£dNodeOfSubŒ“
(
m_äame
->document());

824 ià(
	gş—rWšdowPrİ”t›s
) {

825 
	gm_äame
->
ş—rDOMWšdow
();

826 
	gm_äame
->
süt
()->
ş—rWšdowSh–l
();

829 
	gm_äame
->
£ËùiÚ
()->
ş—r
();

830 
	gm_äame
->
ev’tHªdËr
()->
ş—r
();

831 ià(
	gş—rF¿meV›w
 && 
	gm_äame
->
v›w
())

832 
	gm_äame
->
v›w
()->
ş—r
();

836 
	gm_äame
->
£tDocum’t
(0);

837 
	gm_decod”
 = 0;

839 
	gm_cÚšsPlugIns
 = 
çl£
;

841 ià(
	gş—rSütObjeùs
)

842 
	gm_äame
->
süt
()->
ş—rSütObjeùs
();

844 
	gm_äame
->
»dœeùScheduËr
()->
ş—r
();

846 
	gm_checkTim”
.
¡İ
();

847 
	gm_shouldC®lCheckCom¶‘ed
 = 
çl£
;

848 
	gm_shouldC®lCheckLßdCom¶‘e
 = 
çl£
;

850 
	gm_»ûivedD©a
 = 
çl£
;

851 
	gm_isDi¥ÏyšgIn™ŸlEm±yDocum’t
 = 
çl£
;

853 ià(!
	gm_’codšgWasCho£nByU£r
)

854 
	gm_’codšg
 = 
SŒšg
();

857 
	gF¿meLßd”
::
»ûivedFœ¡D©a
()

859 #ifdeà
SSLAB__DEBUG


860 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

863 
begš
(
m_wÜkšgURL
, 
çl£
);

865 
di¥©chDidComm™Lßd
();

866 
di¥©chDidCË¬WšdowObjeùsInAÎWÜlds
();

868 ià(
	gm_docum’tLßd”
) {

869 
SŒšg
 
	g±™Ë
 = 
m_docum’tLßd”
->
t™Ë
();

871 ià(!
	g±™Ë
.
isNuÎ
())

872 
	gm_ş›Á
->
di¥©chDidReûiveT™Ë
(
±™Ë
);

875 
	gm_wÜkšgURL
 = 
KURL
();

877 
	gd–ay
;

878 
SŒšg
 
	gu¾
;

879 ià(!
	gm_docum’tLßd”
)

881 ià(
	gm_äame
->
šV›wSourûMode
())

883 ià(!
·r£HTTPReäesh
(
m_docum’tLßd”
->
»¥Ú£
().
h‰pH—d”F›ld
("Reäesh"), 
çl£
, 
d–ay
, 
u¾
))

886 ià(
	gu¾
.
isEm±y
())

887 
	gu¾
 = 
m_URL
.
¡ršg
();

889 
	gu¾
 = 
m_äame
->
docum’t
()->
com¶‘eURL
(
u¾
).
¡ršg
();

891 
	gm_äame
->
»dœeùScheduËr
()->
scheduËRedœeù
(
d–ay
, 
u¾
);

894 cÚ¡ 
	gSŒšg
& 
	gF¿meLßd”
::
»¥Ú£MIMETy³
() const

896 #ifdeà
SSLAB__DEBUG


897 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

900  
	gm_»¥Ú£MIMETy³
;

903 
	gF¿meLßd”
::
£tRe¥Ú£MIMETy³
(cÚ¡ 
SŒšg
& 
ty³
)

905 #ifdeà
SSLAB__DEBUG


906 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

909 
	gm_»¥Ú£MIMETy³
 = 
ty³
;

912 
	gF¿meLßd”
::
begš
()

914 #ifdeà
SSLAB__DEBUG


915 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

918 
begš
(
KURL
());

921 
	gF¿meLßd”
::
begš
(cÚ¡ 
KURL
& 
u¾
, 
boŞ
 
di¥©ch
, 
Secur™yOrigš
* 
Üigš
)

923 #ifdeà
SSLAB__DEBUG


924 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

929 
	gRefPŒ
<
	gSecur™yOrigš
> 
	gfÜûdSecur™yOrigš
 = 
Üigš
;

931 
	gRefPŒ
<
	gDocum’t
> 
	gdocum’t
;

934 ià(!
	gm_isDi¥ÏyšgIn™ŸlEm±yDocum’t
 && 
	gm_ş›Á
->
shouldU£PlugšDocum’t
(
m_»¥Ú£MIMETy³
))

935 
	gdocum’t
 = 
PlugšDocum’t
::
ü—‹
(
m_äame
);

936 ià(!
	gm_ş›Á
->
hasHTMLV›w
())

937 
	gdocum’t
 = 
PÏûhŞd”Docum’t
::
ü—‹
(
m_äame
);

939 
	gdocum’t
 = 
DOMIm¶em’tiÚ
::
ü—‹Docum’t
(
m_»¥Ú£MIMETy³
, 
m_äame
, m_äame->
šV›wSourûMode
());

941 
boŞ
 
	g»£tSütšg
 = !(
m_isDi¥ÏyšgIn™ŸlEm±yDocum’t
 && 
m_äame
->
docum’t
()->
£cur™yOrigš
()->
isSecu»T¿ns™iÚTo
(
u¾
));

942 
ş—r
(
»£tSütšg
,„esetScripting);

943 ià(
	g»£tSütšg
)

944 
	gm_äame
->
süt
()->
upd©ePÏtfÜmSütObjeùs
();

946 
	gm_ÃedsCË¬
 = 
Œue
;

947 
	gm_isCom¶‘e
 = 
çl£
;

948 
	gm_didC®lIm¶ic™Clo£
 = 
çl£
;

949 
	gm_isLßdšgMašResourû
 = 
Œue
;

950 
	gm_isDi¥ÏyšgIn™ŸlEm±yDocum’t
 = 
m_ü—tšgIn™ŸlEm±yDocum’t
;

952 
KURL
 
»f
(
u¾
);

953 
	g»f
.
£tU£r
(
SŒšg
());

954 
	g»f
.
£tPass
(
SŒšg
());

955 
	g»f
.
»moveF¿gm’tId’tif›r
();

956 
	gm_outgošgReã¼”
 = 
»f
.
¡ršg
();

957 
	gm_URL
 = 
u¾
;

959 
	gdocum’t
->
£tURL
(
m_URL
);

960 
	gm_äame
->
£tDocum’t
(
docum’t
);

962 ià(
	gm_³ndšgS‹Objeù
) {

963 
	gdocum’t
->
¡©ePİ³d
(
m_³ndšgS‹Objeù
.
g‘
());

964 
	gm_³ndšgS‹Objeù
.
ş—r
();

967 ià(
	gm_decod”
)

968 
	gdocum’t
->
£tDecod”
(
m_decod”
.
g‘
());

969 ià(
	gfÜûdSecur™yOrigš
)

970 
	gdocum’t
->
£tSecur™yOrigš
(
fÜûdSecur™yOrigš
.
g‘
());

972 
	gm_äame
->
domWšdow
()->
£tURL
(
docum’t
->
u¾
());

973 
	gm_äame
->
domWšdow
()->
£tSecur™yOrigš
(
docum’t
->
£cur™yOrigš
());

975 ià(
	gdi¥©ch
)

976 
di¥©chDidCË¬WšdowObjeùsInAÎWÜlds
();

978 
upd©eFœ¡P¬tyFÜCook›s
();

980 
S‘tšgs
* 
	g£‰šgs
 = 
docum’t
->
£‰šgs
();

981 
	gdocum’t
->
docLßd”
()->
£tAutoLßdImages
(
£‰šgs
 && s‘tšgs->
lßdsImagesAutom©iÿÎy
());

983 ià(
	gm_docum’tLßd”
) {

984 
SŒšg
 
	gdnsP»ãtchCÚŒŞ
 = 
m_docum’tLßd”
->
»¥Ú£
().
h‰pH—d”F›ld
("X-DNS-Prefetch-Control");

985 ià(!
	gdnsP»ãtchCÚŒŞ
.
isEm±y
())

986 
	gdocum’t
->
·r£DNSP»ãtchCÚŒŞH—d”
(
dnsP»ãtchCÚŒŞ
);

989 
hi¡Üy
()->
»¡ÜeDocum’tS‹
();

991 
	gdocum’t
->
im¶ic™O³n
();

993 ià(
	gm_äame
->
v›w
(è&& 
	gm_ş›Á
->
hasHTMLV›w
())

994 
	gm_äame
->
v›w
()->
£tCÚ‹ÁsSize
(
IÁSize
());

997 
	gF¿meLßd”
::
wr™e
(cÚ¡ * 
¡r
, 
Ën
, 
boŞ
 
æush
)

999 #ifdeà
SSLAB__DEBUG


1000 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

1003 ià(
	gËn
 =ğ0 && !
æush
)

1006 ià(
	gËn
 == -1)

1007 
Ën
 = 
¡¾’
(
¡r
);

1009 
Tok’iz”
* 
	gtok’iz”
 = 
m_äame
->
docum’t
()->
tok’iz”
();

1010 ià(
	gtok’iz”
 &&ok’iz”->
wªtsRawD©a
()) {

1011 ià(
	gËn
 > 0)

1012 
	gtok’iz”
->
wr™eRawD©a
(
¡r
, 
Ën
);

1016 ià(!
	gm_decod”
) {

1017 ià(
S‘tšgs
* 
	g£‰šgs
 = 
m_äame
->
£‰šgs
()) {

1018 
m_decod”
 = 
TextResourûDecod”
::
ü—‹
(
m_»¥Ú£MIMETy³
,

1019 
£‰šgs
->
deçuÉTextEncodšgName
(),

1020 
£‰šgs
->
u£sEncodšgD‘eùÜ
());

1021 
F¿me
* 
	g·»ÁF¿me
 = 
m_äame
->
Œ“
()->
·»Á
();

1031 ià(
ÿnReãrToP¬’tF¿meEncodšg
(
m_äame
, 
·»ÁF¿me
))

1032 
	gm_decod”
->
£tHštEncodšg
(
·»ÁF¿me
->
docum’t
()->
decod”
());

1034 
	gm_decod”
 = 
TextResourûDecod”
::
ü—‹
(
m_»¥Ú£MIMETy³
, 
SŒšg
());

1035 
F¿me
* 
	g·»ÁF¿me
 = 
m_äame
->
Œ“
()->
·»Á
();

1036 ià(
	gm_’codšg
.
isEm±y
()) {

1037 ià(
ÿnReãrToP¬’tF¿meEncodšg
(
m_äame
, 
·»ÁF¿me
))

1038 
	gm_decod”
->
£tEncodšg
(
·»ÁF¿me
->
docum’t
()->
šputEncodšg
(), 
TextResourûDecod”
::
EncodšgFromP¬’tF¿me
);

1040 
	gm_decod”
->
£tEncodšg
(
m_’codšg
,

1041 
m_’codšgWasCho£nByU£r
 ? 
TextResourûDecod”
::
U£rCho£nEncodšg
 : TextResourûDecod”::
EncodšgFromHTTPH—d”
);

1043 
	gm_äame
->
docum’t
()->
£tDecod”
(
m_decod”
.
g‘
());

1046 
SŒšg
 
	gdecoded
 = 
m_decod”
->
decode
(
¡r
, 
Ën
);

1047 ià(
	gæush
)

1048 
	gdecoded
 +ğ
m_decod”
->
æush
();

1049 ià(
	gdecoded
.
isEm±y
())

1052 ià(!
	gm_»ûivedD©a
) {

1053 
	gm_»ûivedD©a
 = 
Œue
;

1054 ià(
	gm_decod”
->
’codšg
().
u£sVisu®Ord”šg
())

1055 
	gm_äame
->
docum’t
()->
£tVisu®lyOrd”ed
();

1056 
	gm_äame
->
docum’t
()->
»ÿlcStyË
(
Node
::
FÜû
);

1059 ià(
	gtok’iz”
) {

1060 
ASSERT
(!
tok’iz”
->
wªtsRawD©a
());

1061 
	gtok’iz”
->
wr™e
(
decoded
, 
Œue
);

1065 
	gF¿meLßd”
::
wr™e
(cÚ¡ 
SŒšg
& 
¡r
)

1067 #ifdeà
SSLAB__DEBUG


1068 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

1071 ià(
	g¡r
.
isNuÎ
())

1074 ià(!
	gm_»ûivedD©a
) {

1075 
	gm_»ûivedD©a
 = 
Œue
;

1076 
	gm_äame
->
docum’t
()->
£tP¬£Mode
(
Docum’t
::
SŒiù
);

1079 ià(
Tok’iz”
* 
	gtok’iz”
 = 
m_äame
->
docum’t
()->
tok’iz”
())

1080 
tok’iz”
->
wr™e
(
¡r
, 
Œue
);

1083 
	gF¿meLßd”
::
’d
()

1085 #ifdeà
SSLAB__DEBUG


1086 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

1089 
	gm_isLßdšgMašResourû
 = 
çl£
;

1090 
’dIfNÙLßdšgMašResourû
();

1093 
	gF¿meLßd”
::
’dIfNÙLßdšgMašResourû
()

1095 #ifdeà
SSLAB__DEBUG


1096 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

1099 ià(
	gm_isLßdšgMašResourû
 || !
	gm_äame
->
·ge
(è|| !m_äame->
docum’t
())

1105 
	gRefPŒ
<
	gF¿me
> 
´ÙeùÜ
(
m_äame
);

1108 
wr™e
(0, 0, 
Œue
);

1109 
	gm_äame
->
docum’t
()->
fšishP¬sšg
();

1112 
	gF¿meLßd”
::
icÚLßdDecisiÚAvaabË
()

1114 #ifdeà
SSLAB__DEBUG


1115 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

1118 ià(!
	gm_mayLßdIcÚL©”
)

1120 
LOG
(
IcÚD©aba£
, "F¿meLßd” %°wa tŞd‡†ßd decisiÚ i avaabË fÜ it icÚ", 
this
);

1121 
¡¬tIcÚLßd”
();

1122 
	gm_mayLßdIcÚL©”
 = 
çl£
;

1125 
	gF¿meLßd”
::
¡¬tIcÚLßd”
()

1127 #ifdeà
SSLAB__DEBUG


1128 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

1133 ià(!
isLßdšgMašF¿me
())

1136 ià(!
icÚD©aba£
(è|| !icÚD©aba£()->
isEÇbËd
())

1139 
KURL
 
u¾
(
icÚURL
());

1140 
SŒšg
 
u¾SŒšg
(
u¾
.
¡ršg
());

1141 ià(
	gu¾SŒšg
.
isEm±y
())

1145 ià(
lßdTy³
(è!ğ
F¿meLßdTy³R–ßd
 &&†ßdTy³(è!ğ
F¿meLßdTy³R–ßdFromOrigš
) {

1146 
IcÚLßdDecisiÚ
 
decisiÚ
 = 
icÚD©aba£
()->
lßdDecisiÚFÜIcÚURL
(
u¾SŒšg
, 
m_docum’tLßd”
.
g‘
());

1147 ià(
	gdecisiÚ
 =ğ
IcÚLßdNo
) {

1148 
LOG
(
IcÚD©aba£
, "F¿meLßd”::¡¬tIcÚLßd”(è- TŞd‚ÙØlßdhi icÚ, comm™tšg icÚURL % tØd©aba£ fÜ…ageURL m­pšg", 
u¾SŒšg
.
ascii
().
d©a
());

1149 
comm™IcÚURLToIcÚD©aba£
(
u¾
);

1155 ià(!
icÚD©aba£
()->
icÚD©aKnownFÜIcÚURL
(
u¾SŒšg
)) {

1156 
LOG
(
IcÚD©aba£
, "TŞd‚ÙØlßd icÚ % buˆicÚ d©¨i nÙ y‘‡vaabË -„egi¡”šg fÜ‚ÙifiÿtiÚ‡nd„eque¡šg†ßd from disk", 
u¾SŒšg
.
ascii
().
d©a
());

1157 
	gm_ş›Á
->
»gi¡”FÜIcÚNÙifiÿtiÚ
();

1158 
icÚD©aba£
()->
icÚFÜPageURL
(
m_URL
.
¡ršg
(), 
IÁSize
(0, 0));

1159 
icÚD©aba£
()->
icÚFÜPageURL
(
Üigš®Reque¡URL
().
¡ršg
(), 
IÁSize
(0, 0));

1161 
	gm_ş›Á
->
di¥©chDidReûiveIcÚ
();

1166 ià(
	gdecisiÚ
 =ğ
IcÚLßdUnknown
) {

1171 
LOG
(
IcÚD©aba£
, "F¿meLßd” %°mighˆlßd icÚ % Ï‹r", 
this
, 
u¾SŒšg
.
ascii
().
d©a
());

1172 
	gm_mayLßdIcÚL©”
 = 
Œue
;

1173 
	gm_ş›Á
->
»gi¡”FÜIcÚNÙifiÿtiÚ
();

1174 
comm™IcÚURLToIcÚD©aba£
(
u¾
);

1181 
S‘tšgs
* 
	g£‰šgs
 = 
m_äame
->
£‰šgs
();

1182 ià(
	g£‰šgs
 && !£‰šgs->
lßdsImagesAutom©iÿÎy
())

1186 ià(!
	gm_icÚLßd”
)

1187 
	gm_icÚLßd”
.
£t
(
IcÚLßd”
::
ü—‹
(
m_äame
).
»Ëa£
());

1189 
	gm_icÚLßd”
->
¡¬tLßdšg
();

1192 
	gF¿meLßd”
::
comm™IcÚURLToIcÚD©aba£
(cÚ¡ 
KURL
& 
icÚ
)

1194 #ifdeà
SSLAB__DEBUG


1195 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

1198 
ASSERT
(
icÚD©aba£
());

1199 
LOG
(
IcÚD©aba£
, "Comm™tšg icÚURL % tØd©aba£ fÜ…ageURL % ªd %s", 
icÚ
.
¡ršg
().
ascii
().
d©a
(), 
m_URL
.¡ršg().ascii().d©a(), 
Üigš®Reque¡URL
().string().ascii().data());

1200 
icÚD©aba£
()->
£tIcÚURLFÜPageURL
(
icÚ
.
¡ršg
(), 
m_URL
.string());

1201 
icÚD©aba£
()->
£tIcÚURLFÜPageURL
(
icÚ
.
¡ršg
(), 
Üigš®Reque¡URL
().string());

1204 
	gF¿meLßd”
::
fšishedP¬sšg
()

1206 #ifdeà
SSLAB__DEBUG


1207 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

1210 ià(
	gm_ü—tšgIn™ŸlEm±yDocum’t
)

1213 
	gm_äame
->
šjeùU£rSüts
(
InjeùAtDocum’tEnd
);

1218 
	gRefPŒ
<
	gF¿me
> 
	g´ÙeùÜ
 = 
m_äame
->
v›w
() ? m_frame : 0;

1220 
	gm_ş›Á
->
di¥©chDidFšishDocum’tLßd
();

1222 
checkCom¶‘ed
();

1224 ià(!
	gm_äame
->
v›w
())

1229 
	gm_äame
->
v›w
()->
»¡ÜeSüŞlb¬
();

1230 
	gm_äame
->
v›w
()->
süŞlToF¿gm’t
(
m_URL
);

1233 
	gF¿meLßd”
::
lßdDÚe
()

1235 #ifdeà
SSLAB__DEBUG


1236 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

1239 
checkCom¶‘ed
();

1242 
boŞ
 
	gF¿meLßd”
::
®lChd»nA»Com¶‘e
() const

1244 #ifdeà
SSLAB__DEBUG


1245 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

1248 
F¿me
* 
	gchd
 = 
m_äame
->
Œ“
()->
fœ¡Chd
(); chd; chd = 
chd
->Œ“()->
ÃxtSiblšg
()) {

1249 ià(!
chd
->
lßd”
()->
m_isCom¶‘e
)

1250  
çl£
;

1252  
	gŒue
;

1255 
boŞ
 
	gF¿meLßd”
::
®lAnû¡ÜsA»Com¶‘e
() const

1257 #ifdeà
SSLAB__DEBUG


1258 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

1261 
F¿me
* 
	gªû¡Ü
 = 
m_äame
;‡nû¡Ü;‡nû¡Ü = 
ªû¡Ü
->
Œ“
()->
·»Á
()) {

1262 ià(!
ªû¡Ü
->
lßd”
()->
m_isCom¶‘e
)

1263  
çl£
;

1265  
	gŒue
;

1268 
	gF¿meLßd”
::
checkCom¶‘ed
()

1270 #ifdeà
SSLAB__DEBUG


1271 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

1274 
	gm_shouldC®lCheckCom¶‘ed
 = 
çl£
;

1276 ià(
	gm_äame
->
v›w
())

1277 
	gm_äame
->
v›w
()->
checkStİD–ayšgDeã¼edR•ašts
();

1280 ià(!
®lChd»nA»Com¶‘e
())

1284 ià(
	gm_isCom¶‘e
)

1288 ià(
	gm_äame
->
docum’t
()->
·rsšg
())

1292 ià(
numReque¡s
(
m_äame
->
docum’t
()))

1296 
	gm_isCom¶‘e
 = 
Œue
;

1298 
	gRefPŒ
<
	gF¿me
> 
´Ùeù
(
m_äame
);

1299 
checkC®lIm¶ic™Clo£
();

1301 
	gm_äame
->
»dœeùScheduËr
()->
¡¬tTim”
();

1303 
com¶‘ed
();

1304 ià(
	gm_äame
->
·ge
())

1305 
checkLßdCom¶‘e
();

1308 
	gF¿meLßd”
::
checkTim”Fœed
(
Tim”
<
F¿meLßd”
>*)

1310 #ifdeà
SSLAB__DEBUG


1311 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

1314 ià(
Page
* 
	g·ge
 = 
m_äame
->
·ge
()) {

1315 ià(
·ge
->
deãrsLßdšg
())

1318 ià(
	gm_shouldC®lCheckCom¶‘ed
)

1319 
checkCom¶‘ed
();

1320 ià(
	gm_shouldC®lCheckLßdCom¶‘e
)

1321 
checkLßdCom¶‘e
();

1324 
	gF¿meLßd”
::
¡¬tCheckCom¶‘eTim”
()

1326 #ifdeà
SSLAB__DEBUG


1327 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

1330 ià(!(
	gm_shouldC®lCheckCom¶‘ed
 || 
	gm_shouldC®lCheckLßdCom¶‘e
))

1332 ià(
	gm_checkTim”
.
isAùive
())

1334 
	gm_checkTim”
.
¡¬tOÃShÙ
(0);

1337 
	gF¿meLßd”
::
scheduËCheckCom¶‘ed
()

1339 #ifdeà
SSLAB__DEBUG


1340 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

1343 
	gm_shouldC®lCheckCom¶‘ed
 = 
Œue
;

1344 
¡¬tCheckCom¶‘eTim”
();

1347 
	gF¿meLßd”
::
scheduËCheckLßdCom¶‘e
()

1349 #ifdeà
SSLAB__DEBUG


1350 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

1353 
	gm_shouldC®lCheckLßdCom¶‘e
 = 
Œue
;

1354 
¡¬tCheckCom¶‘eTim”
();

1357 
	gF¿meLßd”
::
checkC®lIm¶ic™Clo£
()

1359 #ifdeà
SSLAB__DEBUG


1360 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

1363 ià(
	gm_didC®lIm¶ic™Clo£
 || 
	gm_äame
->
docum’t
()->
·rsšg
())

1366 ià(!
®lChd»nA»Com¶‘e
())

1369 
	gm_didC®lIm¶ic™Clo£
 = 
Œue
;

1370 
	gm_wasUÆßdEv’tEm™‹d
 = 
çl£
;

1371 
	gm_äame
->
docum’t
()->
im¶ic™Clo£
();

1374 
KURL
 
	gF¿meLßd”
::
ba£URL
() const

1376 #ifdeà
SSLAB__DEBUG


1377 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

1380 
ASSERT
(
m_äame
->
docum’t
());

1381  
	gm_äame
->
docum’t
()->
ba£URL
();

1384 
KURL
 
	gF¿meLßd”
::
com¶‘eURL
(cÚ¡ 
SŒšg
& 
u¾
)

1386 #ifdeà
SSLAB__DEBUG


1387 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

1390 
ASSERT
(
m_äame
->
docum’t
());

1391  
	gm_äame
->
docum’t
()->
com¶‘eURL
(
u¾
);

1394 
	gF¿meLßd”
::
lßdURLIÁoChdF¿me
(cÚ¡ 
KURL
& 
u¾
, cÚ¡ 
SŒšg
& 
»ã»r
, 
F¿me
* 
chdF¿me
)

1396 #ifdeà
SSLAB__DEBUG


1397 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

1400 
ASSERT
(
chdF¿me
);

1402 
Hi¡ÜyI‹m
* 
	g·»ÁI‹m
 = 
hi¡Üy
()->
cu¼’tI‹m
();

1403 
F¿meLßdTy³
 
	glßdTy³
 = 
this
->
lßdTy³
();

1404 
F¿meLßdTy³
 
	gchdLßdTy³
 = 
F¿meLßdTy³RedœeùW™hLockedBackFÜw¬dLi¡
;

1406 
KURL
 
	gwÜkšgURL
 = 
u¾
;

1410 ià(
	g·»ÁI‹m
 &&…¬’tI‹m->
chd»n
().
size
(è&& 
isBackFÜw¬dLßdTy³
(
lßdTy³
)) {

1411 
Hi¡ÜyI‹m
* 
	gchdI‹m
 = 
·»ÁI‹m
->
chdI‹mW™hT¬g‘
(
chdF¿me
->
Œ“
()->
Çme
());

1412 ià(
	gchdI‹m
) {

1416 
	gwÜkšgURL
 = 
KURL
(
P¬£dURLSŒšg
, 
chdI‹m
->
Üigš®URLSŒšg
());

1417 
	gchdLßdTy³
 = 
lßdTy³
;

1418 
	gchdF¿me
->
lßd”
()->
hi¡Üy
()->
£tProvisiÚ®I‹m
(
chdI‹m
);

1422 
	gRefPŒ
<
	gArchive
> 
	gsubäameArchive
 = 
aùiveDocum’tLßd”
()->
pİArchiveFÜSubäame
(
chdF¿me
->
Œ“
()->
Çme
());

1424 ià(
	gsubäameArchive
)

1425 
	gchdF¿me
->
lßd”
()->
lßdArchive
(
subäameArchive
.
»Ëa£
());

1427 
	gchdF¿me
->
lßd”
()->
lßdURL
(
wÜkšgURL
, 
»ã»r
, 
SŒšg
(), 
çl£
, 
chdLßdTy³
, 0, 0);

1430 
	gF¿meLßd”
::
lßdArchive
(
PassRefPŒ
<
Archive
> 
´pArchive
)

1432 #ifdeà
SSLAB__DEBUG


1433 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

1436 
	gRefPŒ
<
	gArchive
> 
	g¬chive
 = 
´pArchive
;

1438 
ArchiveResourû
* 
	gmašResourû
 = 
¬chive
->
mašResourû
();

1439 
ASSERT
(
mašResourû
);

1440 ià(!
	gmašResourû
)

1443 
Sub¡™u‹D©a
 
sub¡™u‹D©a
(
mašResourû
->
d©a
(), mašResourû->
mimeTy³
(), mašResourû->
‹xtEncodšg
(), 
KURL
());

1445 
ResourûReque¡
 
»que¡
(
mašResourû
->
u¾
());

1446 #ià
PLATFORM
(
MAC
)

1447 
	g»que¡
.
­¶yWebArchiveHackFÜMa
();

1450 
	gRefPŒ
<
	gDocum’tLßd”
> 
	gdocum’tLßd”
 = 
m_ş›Á
->
ü—‹Docum’tLßd”
(
»que¡
, 
sub¡™u‹D©a
);

1451 
	gdocum’tLßd”
->
addAÎArchiveResourûs
(
¬chive
.
g‘
());

1452 
lßd
(
docum’tLßd”
.
g‘
());

1455 
SŒšg
 
	gF¿meLßd”
::
’codšg
() const

1457 #ifdeà
SSLAB__DEBUG


1458 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

1461 ià(
	gm_’codšgWasCho£nByU£r
 && !
	gm_’codšg
.
isEm±y
())

1462  
	gm_’codšg
;

1463 ià(
	gm_decod”
 && m_decod”->
’codšg
().
isV®id
())

1464  
	gm_decod”
->
’codšg
().
Çme
();

1465 
S‘tšgs
* 
	g£‰šgs
 = 
m_äame
->
£‰šgs
();

1466  
	g£‰šgs
 ? s‘tšgs->
deçuÉTextEncodšgName
(è: 
SŒšg
();

1469 
boŞ
 
	gF¿meLßd”
::
»que¡Objeù
(
R’d”EmbeddedObjeù
* 
»nd””
, cÚ¡ 
SŒšg
& 
u¾
, cÚ¡ 
AtomicSŒšg
& 
äameName
,

1470 cÚ¡ 
SŒšg
& 
mimeTy³
, cÚ¡ 
VeùÜ
<SŒšg>& 
·¿mNames
, cÚ¡ VeùÜ<SŒšg>& 
·¿mV®ues
)

1472 #ifdeà
SSLAB__DEBUG


1473 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

1476 ià(
	gu¾
.
isEm±y
(è&& 
	gmimeTy³
.isEmpty())

1477  
	gçl£
;

1479 ià(!
	gm_äame
->
süt
()->
xssAud™Ü
()->
ÿnLßdObjeù
(
u¾
)) {

1481  
	gçl£
;

1484 
KURL
 
	gcom¶‘edURL
;

1485 ià(!
	gu¾
.
isEm±y
())

1486 
	gcom¶‘edURL
 = 
com¶‘eURL
(
u¾
);

1488 
boŞ
 
	gu£F®lback
;

1489 ià(
shouldU£Plugš
(
com¶‘edURL
, 
mimeTy³
, 
»nd””
->
hasF®lbackCÚ‹Á
(), 
u£F®lback
)) {

1490 
S‘tšgs
* 
	g£‰šgs
 = 
m_äame
->
£‰šgs
();

1491 ià((!
®lowPlugšs
(
AboutToIn¡ªtŸ‹Plugš
)

1495 && !
	gMIMETy³Regi¡ry
::
isAµliÿtiÚPlugšMIMETy³
(
mimeTy³
))

1496 || (!
£‰šgs
->
isJavaEÇbËd
(è&& 
MIMETy³Regi¡ry
::
isJavaAµËtMIMETy³
(
mimeTy³
)))

1497  
çl£
;

1498 ià(
isDocum’tSªdboxed
(
SªdboxPlugšs
))

1499  
	gçl£
;

1500  
lßdPlugš
(
»nd””
, 
com¶‘edURL
, 
mimeTy³
, 
·¿mNames
, 
·¿mV®ues
, 
u£F®lback
);

1503 
ASSERT
(
»nd””
->
node
()->
hasTagName
(
objeùTag
è||„’d””->node()->hasTagName(
embedTag
));

1504 
HTMLPlugInEËm’t
* 
	g–em’t
 = 
¡©ic_ÿ¡
<HTMLPlugInEËm’t*>(
»nd””
->
node
());

1509  
»que¡F¿me
(
–em’t
, 
com¶‘edURL
, 
äameName
);

1512 
boŞ
 
	gF¿meLßd”
::
shouldU£Plugš
(cÚ¡ 
KURL
& 
u¾
, cÚ¡ 
SŒšg
& 
mimeTy³
, boŞ 
hasF®lback
, boŞ& 
u£F®lback
)

1514 #ifdeà
SSLAB__DEBUG


1515 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

1518 ià(
	gm_ş›Á
->
shouldU£PlugšDocum’t
(
mimeTy³
)) {

1519 
	gu£F®lback
 = 
çl£
;

1520  
	gŒue
;

1525 ià(
	gm_äame
->
·ge
(è&& (
	gmimeTy³
 =ğ"image/tiff" || 
mimeTy³
 == "image/tif" || mimeType == "image/x-tiff")) {

1526 cÚ¡ 
PlugšD©a
* 
¶ugšD©a
 = 
m_äame
->
·ge
()->pluginData();

1527 
SŒšg
 
	g¶ugšName
 = 
¶ugšD©a
 ?…lugšD©a->
¶ugšNameFÜMimeTy³
(
mimeTy³
) : String();

1528 ià(!
	g¶ugšName
.
isEm±y
(è&& !¶ugšName.
cÚšs
("QuickTime", 
çl£
))

1529  
	gŒue
;

1532 
ObjeùCÚ‹ÁTy³
 
	gobjeùTy³
 = 
m_ş›Á
->
objeùCÚ‹ÁTy³
(
u¾
, 
mimeTy³
);

1535 
	gu£F®lback
 = 
objeùTy³
 =ğ
ObjeùCÚ‹ÁNÚe
 && 
hasF®lback
;

1536  
	gobjeùTy³
 =ğ
ObjeùCÚ‹ÁNÚe
 || 
objeùTy³
 =ğ
ObjeùCÚ‹ÁN‘sÿ³Plugš
 || objeùTy³ =ğ
ObjeùCÚ‹ÁOth”Plugš
;

1539 
ObjeùCÚ‹ÁTy³
 
	gF¿meLßd”
::
deçuÉObjeùCÚ‹ÁTy³
(cÚ¡ 
KURL
& 
u¾
, cÚ¡ 
SŒšg
& 
mimeTy³In
)

1541 #ifdeà
SSLAB__DEBUG


1542 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

1545 
SŒšg
 
	gmimeTy³
 = 
mimeTy³In
;

1547 ià(
	gmimeTy³
.
isEm±y
())

1548 
	gmimeTy³
 = 
MIMETy³Regi¡ry
::
g‘MIMETy³FÜEx‹nsiÚ
(
u¾
.
·th
().
sub¡ršg
(u¾.·th().
»v”£Fšd
('.') + 1));

1550 ià(
	gmimeTy³
.
isEm±y
())

1551  
	gObjeùCÚ‹ÁF¿me
;

1553 ià(
	gMIMETy³Regi¡ry
::
isSuµÜ‹dImageMIMETy³
(
mimeTy³
))

1554  
WebCÜe
::
ObjeùCÚ‹ÁImage
;

1556 #ià!
PLATFORM
(
MAC
è&& !PLATFORM(
CHROMIUM
)

1557 ià(
	gPlugšD©aba£
::
š¡®ËdPlugšs
()->
isMIMETy³Regi¡”ed
(
mimeTy³
))

1558  
WebCÜe
::
ObjeùCÚ‹ÁN‘sÿ³Plugš
;

1561 ià(
	gMIMETy³Regi¡ry
::
isSuµÜ‹dNÚImageMIMETy³
(
mimeTy³
))

1562  
WebCÜe
::
ObjeùCÚ‹ÁF¿me
;

1564  
	gWebCÜe
::
ObjeùCÚ‹ÁNÚe
;

1567 
HTMLPlugInEËm’t
* 
toPlugInEËm’t
(
Node
* 
node
)

1569 #ifdeà
SSLAB__DEBUG


1570 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

1573 ià(!
	gnode
)

1576 #ià
ENABLE
(
PLUGIN_PROXY_FOR_VIDEO
)

1577 
ASSERT
(
node
->
hasTagName
(
objeùTag
è||‚ode->hasTagName(
embedTag
)

1578 || 
node
->
hasTagName
(
videoTag
è||‚ode->hasTagName(
audioTag
)

1579 || 
node
->
hasTagName
(
­¶‘Tag
));

1581 
ASSERT
(
node
->
hasTagName
(
objeùTag
è||‚ode->hasTagName(
embedTag
)

1582 || 
node
->
hasTagName
(
­¶‘Tag
));

1585  
	g¡©ic_ÿ¡
<
	gHTMLPlugInEËm’t
*>(
	gnode
);

1588 
boŞ
 
	gF¿meLßd”
::
lßdPlugš
(
R’d”EmbeddedObjeù
* 
»nd””
, cÚ¡ 
KURL
& 
u¾
, cÚ¡ 
SŒšg
& 
mimeTy³
,

1589 cÚ¡ 
VeùÜ
<
SŒšg
>& 
·¿mNames
, cÚ¡ VeùÜ<SŒšg>& 
·¿mV®ues
, 
boŞ
 
u£F®lback
)

1591 #ifdeà
SSLAB__DEBUG


1592 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

1595 
	gRefPŒ
<
	gWidg‘
> 
	gwidg‘
;

1597 ià(
	g»nd””
 && !
	gu£F®lback
) {

1598 
HTMLPlugInEËm’t
* 
	g–em’t
 = 
toPlugInEËm’t
(
»nd””
->
node
());

1600 ià(!
	gSecur™yOrigš
::
ÿnLßd
(
u¾
, 
SŒšg
(), 
äame
()->
docum’t
())) {

1601 
	gF¿meLßd”
::
»pÜtLoÿlLßdFaed
(
m_äame
, 
u¾
.
¡ršg
());

1602  
	gçl£
;

1605 
checkIfRunIn£cu»CÚ‹Á
(
m_äame
->
docum’t
()->
£cur™yOrigš
(), 
u¾
);

1607 
	gwidg‘
 = 
m_ş›Á
->
ü—‹Plugš
(
IÁSize
(
»nd””
->
cÚ‹ÁWidth
(),„’d””->
cÚ‹ÁHeight
()),

1608 
–em’t
, 
u¾
, 
·¿mNames
, 
·¿mV®ues
, 
mimeTy³
,

1609 
m_äame
->
docum’t
()->
isPlugšDocum’t
(è&& !
m_cÚšsPlugIns
);

1610 ià(
	gwidg‘
) {

1611 
	g»nd””
->
£tWidg‘
(
widg‘
);

1612 
	gm_cÚšsPlugIns
 = 
Œue
;

1614 
	g»nd””
->
£tShowsMissšgPlugšIndiÿtÜ
(
Œue
);

1617  
	gwidg‘
 != 0;

1620 
SŒšg
 
	gF¿meLßd”
::
outgošgReã¼”
() const

1622 #ifdeà
SSLAB__DEBUG


1623 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

1626  
	gm_outgošgReã¼”
;

1629 
SŒšg
 
	gF¿meLßd”
::
outgošgOrigš
() const

1631 #ifdeà
SSLAB__DEBUG


1632 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

1635  
	gm_äame
->
docum’t
()->
£cur™yOrigš
()->
toSŒšg
();

1638 
boŞ
 
	gF¿meLßd”
::
isMixedCÚ‹Á
(
Secur™yOrigš
* 
cÚ‹xt
, cÚ¡ 
KURL
& 
u¾
)

1640 #ifdeà
SSLAB__DEBUG


1641 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

1644 ià(
	gcÚ‹xt
->
´ÙocŞ
() != "https")

1645  
çl£
;

1647 ià(!
	gu¾
.
isV®id
(è|| 
	gSecur™yOrigš
::
shouldT»©URLSchemeAsSecu»
(
u¾
.
´ÙocŞ
()))

1648  
çl£
;

1650  
	gŒue
;

1653 
	gF¿meLßd”
::
checkIfDi¥ÏyIn£cu»CÚ‹Á
(
Secur™yOrigš
* 
cÚ‹xt
, cÚ¡ 
KURL
& 
u¾
)

1655 #ifdeà
SSLAB__DEBUG


1656 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

1659 ià(!
isMixedCÚ‹Á
(
cÚ‹xt
, 
u¾
))

1662 
SŒšg
 
	gmes§ge
 = SŒšg::
fÜm©
("The…age‡t %s displayed insecure content from %s.\n",

1663 
m_URL
.
¡ršg
().
utf8
().
d©a
(), 
u¾
.string().utf8().data());

1664 
	gm_äame
->
domWšdow
()->
cÚsŞe
()->
addMes§ge
(
HTMLMes§geSourû
, 
LogMes§geTy³
, 
W¬nšgMes§geLev–
, 
mes§ge
, 1, 
SŒšg
());

1666 
	gm_ş›Á
->
didDi¥ÏyIn£cu»CÚ‹Á
();

1669 
	gF¿meLßd”
::
checkIfRunIn£cu»CÚ‹Á
(
Secur™yOrigš
* 
cÚ‹xt
, cÚ¡ 
KURL
& 
u¾
)

1671 #ifdeà
SSLAB__DEBUG


1672 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

1675 ià(!
isMixedCÚ‹Á
(
cÚ‹xt
, 
u¾
))

1678 
SŒšg
 
	gmes§ge
 = SŒšg::
fÜm©
("The…age‡t %s„an insecure content from %s.\n",

1679 
m_URL
.
¡ršg
().
utf8
().
d©a
(), 
u¾
.string().utf8().data());

1680 
	gm_äame
->
domWšdow
()->
cÚsŞe
()->
addMes§ge
(
HTMLMes§geSourû
, 
LogMes§geTy³
, 
W¬nšgMes§geLev–
, 
mes§ge
, 1, 
SŒšg
());

1682 
	gm_ş›Á
->
didRunIn£cu»CÚ‹Á
(
cÚ‹xt
);

1685 
F¿me
* 
	gF¿meLßd”
::
İ’”
()

1687 #ifdeà
SSLAB__DEBUG


1688 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

1691  
	gm_İ’”
;

1694 
	gF¿meLßd”
::
£tO³Ãr
(
F¿me
* 
İ’”
)

1696 #ifdeà
SSLAB__DEBUG


1697 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

1700 ià(
	gm_İ’”
)

1701 
	gm_İ’”
->
lßd”
()->
	gm_İ’edF¿mes
.
»move
(
m_äame
);

1702 ià(
	gİ’”
)

1703 
	gİ’”
->
lßd”
()->
	gm_İ’edF¿mes
.
add
(
m_äame
);

1704 
	gm_İ’”
 = 
İ’”
;

1706 ià(
	gm_äame
->
docum’t
()) {

1707 
	gm_äame
->
docum’t
()->
š™Secur™yCÚ‹xt
();

1708 
	gm_äame
->
domWšdow
()->
£tSecur™yOrigš
(
m_äame
->
docum’t
()->
£cur™yOrigš
());

1712 
	gF¿meLßd”
::
hªdËF®lbackCÚ‹Á
()

1714 #ifdeà
SSLAB__DEBUG


1715 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

1718 
HTMLF¿meOwÃrEËm’t
* 
	gowÃr
 = 
m_äame
->
owÃrEËm’t
();

1719 ià(!
	gowÃr
 || !owÃr->
hasTagName
(
objeùTag
))

1721 
	g¡©ic_ÿ¡
<
	gHTMLObjeùEËm’t
*>(
	gowÃr
)->
»nd”F®lbackCÚ‹Á
();

1724 
	gF¿meLßd”
::
´ovisiÚ®LßdS¹ed
()

1726 #ifdeà
SSLAB__DEBUG


1727 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

1730 
	gm_fœ¡LayoutDÚe
 = 
çl£
;

1731 
	gm_äame
->
»dœeùScheduËr
()->
ÿnûl
(
Œue
);

1732 
	gm_ş›Á
->
´ovisiÚ®LßdS¹ed
();

1735 
boŞ
 
	gF¿meLßd”
::
isProûssšgU£rGe¡u»
()

1737 #ifdeà
SSLAB__DEBUG


1738 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

1741 
F¿me
* 
	gäame
 = 
m_äame
->
Œ“
()->
tİ
();

1742 ià(!
	gäame
->
süt
()->
ÿnExecu‹Süts
(
NÙAboutToExecu‹Süt
))

1743  
	gŒue
;

1744  
	gäame
->
süt
()->
´oûssšgU£rGe¡u»
(
mašTh»adNÜm®WÜld
());

1747 
	gF¿meLßd”
::
»£tMuÉËFÜmSubmissiÚPrÙeùiÚ
()

1749 #ifdeà
SSLAB__DEBUG


1750 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

1753 
	gm_subm™‹dFÜmURL
 = 
KURL
();

1756 
	gF¿meLßd”
::
£tEncodšg
(cÚ¡ 
SŒšg
& 
Çme
, 
boŞ
 
u£rCho£n
)

1758 #ifdeà
SSLAB__DEBUG


1759 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

1762 ià(!
	gm_wÜkšgURL
.
isEm±y
())

1763 
»ûivedFœ¡D©a
();

1764 
	gm_’codšg
 = 
Çme
;

1765 
	gm_’codšgWasCho£nByU£r
 = 
u£rCho£n
;

1768 
	gF¿meLßd”
::
addD©a
(cÚ¡ * 
by‹s
, 
Ëngth
)

1770 #ifdeà
SSLAB__DEBUG


1771 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

1774 
ASSERT
(
m_wÜkšgURL
.
isEm±y
());

1775 
ASSERT
(
m_äame
->
docum’t
());

1776 
ASSERT
(
m_äame
->
docum’t
()->
·rsšg
());

1777 
wr™e
(
by‹s
, 
Ëngth
);

1780 #ià
ENABLE
(
WML
)

1781 
šlše
 
boŞ
 
äameCÚšsWMLCÚ‹Á
(
F¿me
* 
äame
)

1783 #ifdeà
SSLAB__DEBUG


1784 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

1787 
Docum’t
* 
	gdocum’t
 = 
äame
 ? f¿me->
docum’t
() : 0;

1788 ià(!
	gdocum’t
)

1789  
	gçl£
;

1791  
	gdocum’t
->
cÚšsWMLCÚ‹Á
(è|| docum’t->
isWMLDocum’t
();

1795 
boŞ
 
	gF¿meLßd”
::
ÿnCachePageCÚššgThisF¿me
()

1797 #ifdeà
SSLAB__DEBUG


1798 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

1801 
F¿me
* 
	gchd
 = 
m_äame
->
Œ“
()->
fœ¡Chd
(); chd; chd = 
chd
->Œ“()->
ÃxtSiblšg
()) {

1802 ià(!
chd
->
lßd”
()->
ÿnCachePageCÚššgThisF¿me
())

1803  
çl£
;

1806  
	gm_docum’tLßd”


1807 && 
	gm_docum’tLßd”
->
mašDocum’tE¼Ü
().
isNuÎ
()

1813 && !
	gm_cÚšsPlugIns


1814 && !
	gm_URL
.
´ÙocŞIs
("https")

1815 && (!
	gm_äame
->
domWšdow
(è|| !m_äame->domWšdow()->
hasEv’tLi¡’”s
(
ev’tNames
().
uÆßdEv’t
))

1816 #ià
ENABLE
(
DATABASE
)

1817 && !
	gm_äame
->
docum’t
()->
hasO³nD©aba£s
()

1819 #ià
ENABLE
(
SHARED_WORKERS
)

1820 && !
	gSh¬edWÜk”R•os™Üy
::
hasSh¬edWÜk”s
(
m_äame
->
docum’t
())

1822 && !
m_äame
->
docum’t
()->
usšgGeŞoÿtiÚ
()

1823 && 
hi¡Üy
()->
cu¼’tI‹m
()

1824 && !
m_quickRedœeùComšg


1825 && !
m_docum’tLßd”
->
isLßdšgInAPIS’£
()

1826 && !
m_docum’tLßd”
->
isStİpšg
()

1827 && 
m_äame
->
docum’t
()->
ÿnSu¥’dAùiveDOMObjeùs
()

1828 #ià
ENABLE
(
OFFLINE_WEB_APPLICATIONS
)

1831 && 
m_docum’tLßd”
->
­¶iÿtiÚCacheHo¡
()->
ÿnCacheInPageCache
()

1833 #ià
ENABLE
(
WML
)

1834 && !
äameCÚšsWMLCÚ‹Á
(
m_äame
)

1836 && 
m_ş›Á
->
ÿnCachePage
()

1840 
boŞ
 
	gF¿meLßd”
::
ÿnCachePage
()

1842 #ifdeà
SSLAB__DEBUG


1843 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

1846 #iâdeà
NDEBUG


1847 
logCªCachePageDecisiÚ
();

1857 
F¿meLßdTy³
 
	glßdTy³
 = 
this
->
lßdTy³
();

1859  !
	gm_äame
->
Œ“
()->
·»Á
()

1860 && 
ÿnCachePageCÚššgThisF¿me
()

1861 && 
	gm_äame
->
·ge
()

1862 && 
	gm_äame
->
·ge
()->
backFÜw¬dLi¡
()->
’abËd
()

1863 && 
	gm_äame
->
·ge
()->
backFÜw¬dLi¡
()->
ÿ·c™y
() > 0

1864 && 
	gm_äame
->
·ge
()->
£‰šgs
()->
u£sPageCache
()

1865 && 
	glßdTy³
 !ğ
F¿meLßdTy³R–ßd


1866 && 
lßdTy³
 !ğ
F¿meLßdTy³R–ßdFromOrigš


1867 && 
lßdTy³
 !ğ
F¿meLßdTy³Same


1871 #iâdeà
NDEBUG


1872 
	gSŒšg
& 
·geCacheLogP»fix
(
šd’tLev–
)

1874 #ifdeà
SSLAB__DEBUG


1875 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

1878 
	g´eviousInd’t
 = -1;

1879 
DEFINE_STATIC_LOCAL
(
SŒšg
, 
´efix
, ());

1881 ià(
	gšd’tLev–
 !ğ
´eviousInd’t
) {

1882 
´eviousInd’t
 = 
šd’tLev–
;

1883 
	g´efix
.
Œunÿ‹
(0);

1884 
	gi
 = 0; i < 
	g´eviousInd’t
; ++i)

1885 
	g´efix
 += " ";

1888  
	g´efix
;

1891 
·geCacheLog
(cÚ¡ 
SŒšg
& 
´efix
, cÚ¡ SŒšg& 
mes§ge
)

1893 #ifdeà
SSLAB__DEBUG


1894 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

1897 
LOG
(
PageCache
, "%s%s", 
´efix
.
utf8
().
d©a
(), 
mes§ge
.utf8().data());

1900 
	#PCLOG
(...è
	`·geCacheLog
(
	`·geCacheLogP»fix
(
šd’tLev–
), 
SŒšg
::
	`fÜm©
(
__VA_ARGS__
))

	)

1902 
	gF¿meLßd”
::
logCªCachePageDecisiÚ
()

1904 #ifdeà
SSLAB__DEBUG


1905 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

1909 ià(
	gm_ü—tšgIn™ŸlEm±yDocum’t
)

1911 
KURL
 
	gcu¼’tURL
 = 
m_docum’tLßd”
 ? m_docum’tLßd”->
u¾
() : KURL();

1912 ià(
	gcu¼’tURL
.
isEm±y
())

1915 
	gšd’tLev–
 = 0;

1916 
PCLOG
("--------\n Determining if…age can be cached:");

1918 
boŞ
 
	gÿÂÙCache
 = !
logCªCacheF¿meDecisiÚ
(1);

1920 
F¿meLßdTy³
 
	glßdTy³
 = 
this
->
lßdTy³
();

1922 ià(
	gm_äame
->
Œ“
()->
·»Á
())

1923 { 
PCLOG
(" -F¿mha ¨·»Á f¿me"); 
	gÿÂÙCache
 = 
Œue
; }

1924 ià(!
	gm_äame
->
·ge
()) {

1925 
PCLOG
(" -There is‚o Page object");

1926 
	gÿÂÙCache
 = 
Œue
;

1929 ià(!
	gm_äame
->
·ge
()->
backFÜw¬dLi¡
()->
’abËd
())

1930 { 
PCLOG
(" -Thback/fÜw¬d†i¡ i di§bËd"); 
	gÿÂÙCache
 = 
Œue
; }

1931 ià(!(
	gm_äame
->
·ge
()->
backFÜw¬dLi¡
()->
ÿ·c™y
() > 0))

1932 { 
PCLOG
(" -Thback/fÜw¬d†i¡ ha ¨0 c­ac™y"); 
	gÿÂÙCache
 = 
Œue
; }

1933 ià(!
	gm_äame
->
·ge
()->
£‰šgs
()->
u£sPageCache
())

1934 { 
PCLOG
(" -Pag£‰šg §y b/àÿchdi§bËd"); 
	gÿÂÙCache
 = 
Œue
; }

1935 ià(
	glßdTy³
 =ğ
F¿meLßdTy³R–ßd
)

1936 { 
PCLOG
(" -Lßdy³ is: R–ßd"); 
	gÿÂÙCache
 = 
Œue
; }

1937 ià(
	glßdTy³
 =ğ
F¿meLßdTy³R–ßdFromOrigš
)

1938 { 
PCLOG
(" -Lßdy³ is: R–ßd from origš"); 
	gÿÂÙCache
 = 
Œue
; }

1939 ià(
	glßdTy³
 =ğ
F¿meLßdTy³Same
)

1940 { 
PCLOG
(" -Lßdy³ is: Same"); 
	gÿÂÙCache
 = 
Œue
; }

1941 } 
	gçl£
);

1943 
PCLOG
(
ÿÂÙCache
 ? " Page CANNOT be cached\n--------" : " Page CAN be cached\n--------");

1946 
boŞ
 
	gF¿meLßd”
::
logCªCacheF¿meDecisiÚ
(
šd’tLev–
)

1948 #ifdeà
SSLAB__DEBUG


1949 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

1953 ià(
	gm_ü—tšgIn™ŸlEm±yDocum’t
)

1954  
	gçl£
;

1955 
KURL
 
	gcu¼’tURL
 = 
m_docum’tLßd”
 ? m_docum’tLßd”->
u¾
() : KURL();

1956 ià(
	gcu¼’tURL
.
isEm±y
())

1957  
	gçl£
;

1959 
PCLOG
("+---");

1960 
KURL
 
	gÃwURL
 = 
m_´ovisiÚ®Docum’tLßd”
 ? m_´ovisiÚ®Docum’tLßd”->
u¾
() : KURL();

1961 ià(!
	gÃwURL
.
isEm±y
())

1962 
PCLOG
(" D‘”mššg iàäamÿÀbÿched‚avig©šg from (%sètØ(%s):", 
cu¼’tURL
.
¡ršg
().
utf8
().
d©a
(), 
ÃwURL
.string().utf8().data());

1964 
PCLOG
(" D‘”mššg iàsubäamw™h URL (%sèÿÀbÿched:", 
cu¼’tURL
.
¡ršg
().
utf8
().
d©a
());

1966 
boŞ
 
	gÿÂÙCache
 = 
çl£
;

1969 ià(!
	gm_docum’tLßd”
) {

1970 
PCLOG
(" -There is‚o DocumentLoader object");

1971 
	gÿÂÙCache
 = 
Œue
;

1974 ià(!
	gm_docum’tLßd”
->
mašDocum’tE¼Ü
().
isNuÎ
())

1975 { 
PCLOG
(" -Maš docum’ˆha ªƒ¼Ü"); 
	gÿÂÙCache
 = 
Œue
; }

1976 ià(
	gm_cÚšsPlugIns
)

1977 { 
PCLOG
(" -F¿mcÚš ¶ugšs"); 
	gÿÂÙCache
 = 
Œue
; }

1978 ià(
	gm_URL
.
´ÙocŞIs
("https"))

1979 { 
PCLOG
(" -F¿mi HTTPS"); 
	gÿÂÙCache
 = 
Œue
; }

1980 ià(
	gm_äame
->
domWšdow
(è&& m_äame->domWšdow()->
hasEv’tLi¡’”s
(
ev’tNames
().
uÆßdEv’t
))

1981 { 
PCLOG
(" -F¿mha ª uÆßdƒv’ˆli¡’”"); 
	gÿÂÙCache
 = 
Œue
; }

1982 #ià
ENABLE
(
DATABASE
)

1983 ià(
	gm_äame
->
docum’t
()->
hasO³nD©aba£s
())

1984 { 
PCLOG
(" -F¿mha İ’ d©aba£ hªdËs"); 
	gÿÂÙCache
 = 
Œue
; }

1986 #ià
ENABLE
(
SHARED_WORKERS
)

1987 ià(
	gSh¬edWÜk”R•os™Üy
::
hasSh¬edWÜk”s
(
m_äame
->
docum’t
()))

1988 { 
PCLOG
(" -F¿mha assocŸ‹d Sh¬edWÜk”s"); 
	gÿÂÙCache
 = 
Œue
; }

1990 ià(
	gm_äame
->
docum’t
()->
usšgGeŞoÿtiÚ
())

1991 { 
PCLOG
(" -F¿mu£ GeŞoÿtiÚ"); 
	gÿÂÙCache
 = 
Œue
; }

1992 ià(!
hi¡Üy
()->
cu¼’tI‹m
())

1993 { 
PCLOG
(" -NØcu¼’ˆhi¡Üy i‹m"); 
	gÿÂÙCache
 = 
Œue
; }

1994 ià(
	gm_quickRedœeùComšg
)

1995 { 
PCLOG
(" -Quick„edœeù i comšg"); 
	gÿÂÙCache
 = 
Œue
; }

1996 ià(
	gm_docum’tLßd”
->
isLßdšgInAPIS’£
())

1997 { 
PCLOG
(" -Docum’tLßd” i ¡Èlßdšg iÀAPI s’£"); 
	gÿÂÙCache
 = 
Œue
; }

1998 ià(
	gm_docum’tLßd”
->
isStİpšg
())

1999 { 
PCLOG
(" -Docum’tLßd” i šhmiddË oà¡İpšg"); 
	gÿÂÙCache
 = 
Œue
; }

2000 ià(!
	gm_äame
->
docum’t
()->
ÿnSu¥’dAùiveDOMObjeùs
())

2001 { 
PCLOG
(" -Thdocum’ˆÿÂÙ su¥eù it aùivDOM Objeùs"); 
	gÿÂÙCache
 = 
Œue
; }

2002 #ià
ENABLE
(
OFFLINE_WEB_APPLICATIONS
)

2003 ià(!
	gm_docum’tLßd”
->
­¶iÿtiÚCacheHo¡
()->
ÿnCacheInPageCache
())

2004 { 
PCLOG
(" -ThDocum’tLßd” u£ ª‡µliÿtiÚ cache"); 
	gÿÂÙCache
 = 
Œue
; }

2006 ià(!
	gm_ş›Á
->
ÿnCachePage
())

2007 { 
PCLOG
(" -Thş›Á say thi äamÿÂÙ bÿched"); 
	gÿÂÙCache
 = 
Œue
; }

2008 } 
	gçl£
);

2010 
F¿me
* 
	gchd
 = 
m_äame
->
Œ“
()->
fœ¡Chd
(); chd; chd = 
chd
->Œ“()->
ÃxtSiblšg
())

2011 ià(!
chd
->
lßd”
()->
logCªCacheF¿meDecisiÚ
(
šd’tLev–
 + 1))

2012 
ÿÂÙCache
 = 
Œue
;

2014 
PCLOG
(
ÿÂÙCache
 ? " Frame CANNOT be cached" : " Frame CAN be cached");

2015 
PCLOG
("+---");

2017  !
	gÿÂÙCache
;

2021 
	gF¿meLßd”
::
upd©eFœ¡P¬tyFÜCook›s
()

2023 #ifdeà
SSLAB__DEBUG


2024 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

2027 ià(
	gm_äame
->
Œ“
()->
·»Á
())

2028 
£tFœ¡P¬tyFÜCook›s
(
m_äame
->
Œ“
()->
·»Á
()->
docum’t
()->
fœ¡P¬tyFÜCook›s
());

2030 
£tFœ¡P¬tyFÜCook›s
(
m_URL
);

2033 
	gF¿meLßd”
::
£tFœ¡P¬tyFÜCook›s
(cÚ¡ 
KURL
& 
u¾
)

2035 #ifdeà
SSLAB__DEBUG


2036 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

2039 
	gm_äame
->
docum’t
()->
£tFœ¡P¬tyFÜCook›s
(
u¾
);

2040 
F¿me
* 
	gchd
 = 
m_äame
->
Œ“
()->
fœ¡Chd
(); chd; chd = 
chd
->Œ“()->
ÃxtSiblšg
())

2041 
chd
->
lßd”
()->
£tFœ¡P¬tyFÜCook›s
(
u¾
);

2046 
	gF¿meLßd”
::
lßdInSameDocum’t
(cÚ¡ 
KURL
& 
u¾
, 
S”ŸlizedSütV®ue
* 
¡©eObjeù
, 
boŞ
 
isNewNavig©iÚ
)

2048 #ifdeà
SSLAB__DEBUG


2049 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

2053 
ASSERT
(!
¡©eObjeù
 || (¡©eObjeù && !
isNewNavig©iÚ
));

2056 
	gm_äame
->
docum’t
()->
£tURL
(
u¾
);

2057 
docum’tLßd”
()->
»¶aûReque¡URLFÜSameDocum’tNavig©iÚ
(
u¾
);

2058 ià(
	gisNewNavig©iÚ
 && !
shouldT»©URLAsSameAsCu¼’t
(
u¾
è&& !
	g¡©eObjeù
) {

2070 
hi¡Üy
()->
upd©eBackFÜw¬dLi¡FÜF¿gm’tSüŞl
();

2073 
SŒšg
 
	gŞdURL
;

2074 
boŞ
 
	ghashChªge
 = 
equ®IgnÜšgF¿gm’tId’tif›r
(
u¾
, 
m_URL
è&& 
	gu¾
.
äagm’tId’tif›r
() != m_URL.fragmentIdentifier();

2075 
	gŞdURL
 = 
m_URL
;

2077 
	gm_URL
 = 
u¾
;

2078 
hi¡Üy
()->
upd©eFÜSameDocum’tNavig©iÚ
();

2081 ià(
	ghashChªge
)

2082 
	gm_äame
->
ev’tHªdËr
()->
¡İAutosüŞlTim”
();

2086 
¡¬‹d
();

2090 ià(
F¿meV›w
* 
	gv›w
 = 
m_äame
->
v›w
())

2091 
v›w
->
süŞlToF¿gm’t
(
m_URL
);

2093 
	gm_isCom¶‘e
 = 
çl£
;

2094 
checkCom¶‘ed
();

2096 ià(
	gisNewNavig©iÚ
) {

2100 
checkLßdCom¶‘e
();

2103 
	gm_ş›Á
->
di¥©chDidNavig©eW™hšPage
();

2105 ià(
	g¡©eObjeù
) {

2106 
	gm_äame
->
docum’t
()->
¡©ePİ³d
(
¡©eObjeù
);

2107 
	gm_ş›Á
->
di¥©chDidPİS‹W™hšPage
();

2110 ià(
	ghashChªge
) {

2111 
	gm_äame
->
docum’t
()->
’queueHashchªgeEv’t
(
ŞdURL
, 
m_URL
);

2112 
	gm_ş›Á
->
di¥©chDidChªgeLoÿtiÚW™hšPage
();

2116 
	gm_ş›Á
->
didFšishLßd
();

2119 
boŞ
 
	gF¿meLßd”
::
isCom¶‘e
() const

2121 #ifdeà
SSLAB__DEBUG


2122 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

2125  
	gm_isCom¶‘e
;

2128 
	gF¿meLßd”
::
com¶‘ed
()

2130 #ifdeà
SSLAB__DEBUG


2131 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

2134 
	gRefPŒ
<
	gF¿me
> 
´Ùeù
(
m_äame
);

2136 
F¿me
* 
	gdesûndªt
 = 
m_äame
->
Œ“
()->
Œav”£Next
(m_äame); desûndªt; desûndªˆğ
desûndªt
->tree()->traverseNext(m_frame))

2137 
desûndªt
->
»dœeùScheduËr
()->
¡¬tTim”
();

2139 ià(
F¿me
* 
	g·»Á
 = 
m_äame
->
Œ“
()->
·»Á
())

2140 
·»Á
->
lßd”
()->
checkCom¶‘ed
();

2142 ià(
	gm_äame
->
v›w
())

2143 
	gm_äame
->
v›w
()->
maššSüŞlPos™iÚAtAnchÜ
(0);

2146 
	gF¿meLßd”
::
¡¬‹d
()

2148 #ifdeà
SSLAB__DEBUG


2149 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

2152 
F¿me
* 
	gäame
 = 
m_äame
; f¿me; f¿mğ
äame
->
Œ“
()->
·»Á
())

2153 
äame
->
lßd”
()->
m_isCom¶‘e
 = 
çl£
;

2156 
boŞ
 
	gF¿meLßd”
::
®lowPlugšs
(
R—sÚFÜC®lšgAÎowPlugšs
 
»asÚ
)

2158 #ifdeà
SSLAB__DEBUG


2159 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

2162 
S‘tšgs
* 
	g£‰šgs
 = 
m_äame
->
£‰šgs
();

2163 
boŞ
 
	g®lowed
 = 
m_ş›Á
->
®lowPlugšs
(
£‰šgs
 && s‘tšgs->
¬ePlugšsEÇbËd
());

2164 ià(!
	g®lowed
 && 
	g»asÚ
 =ğ
AboutToIn¡ªtŸ‹Plugš
)

2165 
m_äame
->
lßd”
()->
ş›Á
()->
didNÙAÎowPlugšs
();

2166  
	g®lowed
;

2169 
boŞ
 
	gF¿meLßd”
::
cÚšsPlugšs
() const

2171 #ifdeà
SSLAB__DEBUG


2172 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

2175  
	gm_cÚšsPlugIns
;

2178 
	gF¿meLßd”
::
´•¬eFÜLßdS¹
()

2180 #ifdeà
SSLAB__DEBUG


2181 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

2184 ià(
Page
* 
	g·ge
 = 
m_äame
->
·ge
())

2185 
·ge
->
´og»ss
()->
´og»ssS¹ed
(
m_äame
);

2186 
	gm_ş›Á
->
di¥©chDidS¹ProvisiÚ®Lßd
();

2189 
	gF¿meLßd”
::
£tupFÜR•Ïû
()

2191 #ifdeà
SSLAB__DEBUG


2192 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

2195 
£tS‹
(
F¿meS‹ProvisiÚ®
);

2196 
	gm_´ovisiÚ®Docum’tLßd”
 = 
m_docum’tLßd”
;

2197 
	gm_docum’tLßd”
 = 0;

2198 
d‘achChd»n
();

2201 
	gF¿meLßd”
::
£tupFÜR•ÏûByMIMETy³
(cÚ¡ 
SŒšg
& 
ÃwMIMETy³
)

2203 #ifdeà
SSLAB__DEBUG


2204 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

2207 
aùiveDocum’tLßd”
()->
£tupFÜR•ÏûByMIMETy³
(
ÃwMIMETy³
);

2213 
boŞ
 
isF“dW™hNe¡edPrÙocŞInHTTPFamy
(cÚ¡ 
KURL
& 
u¾
)

2215 #ifdeà
SSLAB__DEBUG


2216 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

2219 cÚ¡ 
	gSŒšg
& 
	gu¾SŒšg
 = 
u¾
.
¡ršg
();

2220 ià(!
	gu¾SŒšg
.
¡¬tsW™h
("ãed", 
çl£
))

2221  
	gçl£
;

2223  
	gu¾SŒšg
.
¡¬tsW™h
("ãed://", 
çl£
)

2224 || 
	gu¾SŒšg
.
¡¬tsW™h
("ãed:h‰p:", 
çl£
) || urlString.startsWith("feed:https:", false)

2225 || 
	gu¾SŒšg
.
¡¬tsW™h
("ãeds:h‰p:", 
çl£
) || urlString.startsWith("feeds:https:", false)

2226 || 
	gu¾SŒšg
.
¡¬tsW™h
("ãed£¬ch:h‰p:", 
çl£
) || urlString.startsWith("feedsearch:https:", false);

2229 
	gF¿meLßd”
::
lßdF¿meReque¡
(cÚ¡ 
F¿meLßdReque¡
& 
»que¡
, 
boŞ
 
lockHi¡Üy
, boŞ 
lockBackFÜw¬dLi¡
,

2230 
PassRefPŒ
<
Ev’t
> 
ev’t
, PassRefPŒ<
FÜmS‹
> 
fÜmS‹
, 
Reã¼”PŞicy
 
»ã¼”PŞicy
)

2232 #ifdeà
SSLAB__DEBUG


2233 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

2236 
KURL
 
	gu¾
 = 
»que¡
.
»sourûReque¡
().
u¾
();

2238 
SŒšg
 
	g»ã¼”
;

2239 
SŒšg
 
	g¬gsReã¼”
 = 
»que¡
.
»sourûReque¡
().
h‰pReã¼”
();

2240 ià(!
	g¬gsReã¼”
.
isEm±y
())

2241 
	g»ã¼”
 = 
¬gsReã¼”
;

2243 
	g»ã¼”
 = 
m_outgošgReã¼”
;

2245 
ASSERT
(
äame
()->
docum’t
());

2246 ià(
	gSecur™yOrigš
::
shouldT»©URLAsLoÿl
(
u¾
.
¡ršg
()è&& !
isF“dW™hNe¡edPrÙocŞInHTTPFamy
(url)) {

2247 ià(!
Secur™yOrigš
::
ÿnLßd
(
u¾
, 
SŒšg
(), 
äame
()->
docum’t
()è&& !
	gSecur™yOrigš
::ÿnLßd(u¾, 
»ã¼”
, 0)) {

2248 
	gF¿meLßd”
::
»pÜtLoÿlLßdFaed
(
m_äame
, 
u¾
.
¡ršg
());

2253 ià(
	gSecur™yOrigš
::
shouldHideReã¼”
(
u¾
, 
»ã¼”
è|| 
	g»ã¼”PŞicy
 =ğ
NoReã¼”
)

2254 
»ã¼”
 = 
SŒšg
();

2256 
F¿meLßdTy³
 
	glßdTy³
;

2257 ià(
	g»que¡
.
»sourûReque¡
().
ÿchePŞicy
(è=ğ
R–ßdIgnÜšgCacheD©a
)

2258 
lßdTy³
 = 
F¿meLßdTy³R–ßd
;

2259 ià(
	glockBackFÜw¬dLi¡
)

2260 
	glßdTy³
 = 
F¿meLßdTy³RedœeùW™hLockedBackFÜw¬dLi¡
;

2262 
	glßdTy³
 = 
F¿meLßdTy³Snd¬d
;

2264 ià(
	g»que¡
.
»sourûReque¡
().
h‰pM‘hod
() == "POST")

2265 
lßdPo¡Reque¡
(
»que¡
.
»sourûReque¡
(), 
»ã¼”
,„eque¡.
äameName
(), 
lockHi¡Üy
, 
lßdTy³
, 
ev’t
, 
fÜmS‹
.
g‘
());

2267 
lßdURL
(
»que¡
.
»sourûReque¡
().
u¾
(), 
»ã¼”
,„eque¡.
äameName
(), 
lockHi¡Üy
, 
lßdTy³
, 
ev’t
, 
fÜmS‹
.
g‘
());

2271 
F¿me
* 
	gsourûF¿me
 = 
fÜmS‹
 ? fÜmS‹->
sourûF¿me
(è: 
m_äame
;

2272 
F¿me
* 
	grg‘F¿me
 = 
sourûF¿me
->
lßd”
()->
fšdF¿meFÜNavig©iÚ
(
»que¡
.
äameName
());

2273 ià(
	grg‘F¿me
 &&¬g‘F¿m!ğ
sourûF¿me
) {

2274 ià(
Page
* 
·ge
 = 
rg‘F¿me
->page())

2275 
·ge
->
chrome
()->
focus
();

2279 
	gF¿meLßd”
::
lßdURL
(cÚ¡ 
KURL
& 
ÃwURL
, cÚ¡ 
SŒšg
& 
»ã¼”
, cÚ¡ SŒšg& 
äameName
, 
boŞ
 
lockHi¡Üy
, 
F¿meLßdTy³
 
ÃwLßdTy³
,

2280 
PassRefPŒ
<
Ev’t
> 
ev’t
, PassRefPŒ<
FÜmS‹
> 
´pFÜmS‹
)

2282 #ifdeà
SSLAB__DEBUG


2283 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

2286 
	gRefPŒ
<
	gFÜmS‹
> 
	gfÜmS‹
 = 
´pFÜmS‹
;

2287 
boŞ
 
	gisFÜmSubmissiÚ
 = 
fÜmS‹
;

2289 
ResourûReque¡
 
»que¡
(
ÃwURL
);

2290 ià(!
	g»ã¼”
.
isEm±y
()) {

2291 
	g»que¡
.
£tHTTPReã¼”
(
»ã¼”
);

2292 
	gRefPŒ
<
	gSecur™yOrigš
> 
	g»ã¼”Origš
 = 
Secur™yOrigš
::
ü—‹FromSŒšg
(
»ã¼”
);

2293 
addHTTPOrigšIfN“ded
(
»que¡
, 
»ã¼”Origš
->
toSŒšg
());

2295 
addExŒaF›ldsToReque¡
(
»que¡
, 
ÃwLßdTy³
, 
Œue
, 
ev’t
 || 
isFÜmSubmissiÚ
);

2296 ià(
	gÃwLßdTy³
 =ğ
F¿meLßdTy³R–ßd
 || 
ÃwLßdTy³
 =ğ
F¿meLßdTy³R–ßdFromOrigš
)

2297 
»que¡
.
£tCachePŞicy
(
R–ßdIgnÜšgCacheD©a
);

2299 
ASSERT
(
ÃwLßdTy³
 !ğ
F¿meLßdTy³Same
);

2302 
F¿me
* 
	grg‘F¿me
 = 
isFÜmSubmissiÚ
 ? 0 : 
fšdF¿meFÜNavig©iÚ
(
äameName
);

2303 ià(
	grg‘F¿me
 &&¬g‘F¿m!ğ
m_äame
) {

2304 
rg‘F¿me
->
lßd”
()->
lßdURL
(
ÃwURL
, 
»ã¼”
, 
SŒšg
(), 
lockHi¡Üy
, 
ÃwLßdTy³
, 
ev’t
, 
fÜmS‹
.
»Ëa£
());

2308 ià(
	gm_uÆßdEv’tBešgDi¥©ched
)

2311 
Navig©iÚAùiÚ
 
aùiÚ
(
ÃwURL
, 
ÃwLßdTy³
, 
isFÜmSubmissiÚ
, 
ev’t
);

2313 ià(!
	grg‘F¿me
 && !
	gäameName
.
isEm±y
()) {

2314 
pŞicyCheck”
()->
checkNewWšdowPŞicy
(
aùiÚ
, 
F¿meLßd”
::
ÿÎCÚtšueLßdAá”NewWšdowPŞicy
,

2315 
»que¡
, 
fÜmS‹
.
»Ëa£
(), 
äameName
, 
this
);

2319 
	gRefPŒ
<
	gDocum’tLßd”
> 
	gŞdDocum’tLßd”
 = 
m_docum’tLßd”
;

2321 
boŞ
 
	g§meURL
 = 
shouldT»©URLAsSameAsCu¼’t
(
ÃwURL
);

2326 ià(
shouldSüŞlToAnchÜ
(
isFÜmSubmissiÚ
, 
ÃwLßdTy³
, 
ÃwURL
)) {

2327 
	gŞdDocum’tLßd”
->
£tTrigg”šgAùiÚ
(
aùiÚ
);

2328 
pŞicyCheck”
()->
¡İCheck
();

2329 
pŞicyCheck”
()->
£tLßdTy³
(
ÃwLßdTy³
);

2330 
pŞicyCheck”
()->
checkNavig©iÚPŞicy
(
»que¡
, 
ŞdDocum’tLßd”
.
g‘
(), 
fÜmS‹
.
»Ëa£
(),

2331 
ÿÎCÚtšueF¿gm’tSüŞlAá”Navig©iÚPŞicy
, 
this
);

2334 
boŞ
 
	gisRedœeù
 = 
m_quickRedœeùComšg
;

2335 
lßdW™hNavig©iÚAùiÚ
(
»que¡
, 
aùiÚ
, 
lockHi¡Üy
, 
ÃwLßdTy³
, 
fÜmS‹
.
»Ëa£
());

2336 ià(
	gisRedœeù
) {

2337 
	gm_quickRedœeùComšg
 = 
çl£
;

2338 ià(
	gm_´ovisiÚ®Docum’tLßd”
)

2339 
	gm_´ovisiÚ®Docum’tLßd”
->
£tIsCl›ÁRedœeù
(
Œue
);

2340 } ià(
	g§meURL
)

2344 
	gm_lßdTy³
 = 
F¿meLßdTy³Same
;

2348 
	gF¿meLßd”
::
lßd
(cÚ¡ 
ResourûReque¡
& 
»que¡
, 
boŞ
 
lockHi¡Üy
)

2350 #ifdeà
SSLAB__DEBUG


2351 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

2354 
lßd
(
»que¡
, 
Sub¡™u‹D©a
(), 
lockHi¡Üy
);

2357 
	gF¿meLßd”
::
lßd
(cÚ¡ 
ResourûReque¡
& 
»que¡
, cÚ¡ 
Sub¡™u‹D©a
& 
sub¡™u‹D©a
, 
boŞ
 
lockHi¡Üy
)

2359 #ifdeà
SSLAB__DEBUG


2360 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

2363 ià(
	gm_šStİAÎLßd”s
)

2367 
	gm_lßdTy³
 = 
F¿meLßdTy³Snd¬d
;

2368 
	gRefPŒ
<
	gDocum’tLßd”
> 
	glßd”
 = 
m_ş›Á
->
ü—‹Docum’tLßd”
(
»que¡
, 
sub¡™u‹D©a
);

2369 ià(
	glockHi¡Üy
 && 
	gm_docum’tLßd”
)

2370 
	glßd”
->
£tCl›ÁRedœeùSourûFÜHi¡Üy
(
m_docum’tLßd”
->
didC»©eGlob®Hi¡ÜyEÁry
(è? m_docum’tLßd”->
u¾FÜHi¡Üy
(è: m_docum’tLßd”->
ş›ÁRedœeùSourûFÜHi¡Üy
());

2371 
lßd
(
lßd”
.
g‘
());

2374 
	gF¿meLßd”
::
lßd
(cÚ¡ 
ResourûReque¡
& 
»que¡
, cÚ¡ 
SŒšg
& 
äameName
, 
boŞ
 
lockHi¡Üy
)

2376 #ifdeà
SSLAB__DEBUG


2377 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

2380 ià(
	gäameName
.
isEm±y
()) {

2381 
lßd
(
»que¡
, 
lockHi¡Üy
);

2385 
F¿me
* 
	gäame
 = 
fšdF¿meFÜNavig©iÚ
(
äameName
);

2386 ià(
	gäame
) {

2387 
	gäame
->
lßd”
()->
lßd
(
»que¡
, 
lockHi¡Üy
);

2391 
pŞicyCheck”
()->
checkNewWšdowPŞicy
(
Navig©iÚAùiÚ
(
»que¡
.
u¾
(), 
Navig©iÚTy³Oth”
), 
F¿meLßd”
::
ÿÎCÚtšueLßdAá”NewWšdowPŞicy
,„eque¡, 0, 
äameName
, 
this
);

2394 
	gF¿meLßd”
::
lßdW™hNavig©iÚAùiÚ
(cÚ¡ 
ResourûReque¡
& 
»que¡
, cÚ¡ 
Navig©iÚAùiÚ
& 
aùiÚ
, 
boŞ
 
lockHi¡Üy
, 
F¿meLßdTy³
 
ty³
, 
PassRefPŒ
<
FÜmS‹
> 
fÜmS‹
)

2396 #ifdeà
SSLAB__DEBUG


2397 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

2400 
	gRefPŒ
<
	gDocum’tLßd”
> 
	glßd”
 = 
m_ş›Á
->
ü—‹Docum’tLßd”
(
»que¡
, 
Sub¡™u‹D©a
());

2401 ià(
	glockHi¡Üy
 && 
	gm_docum’tLßd”
)

2402 
	glßd”
->
£tCl›ÁRedœeùSourûFÜHi¡Üy
(
m_docum’tLßd”
->
didC»©eGlob®Hi¡ÜyEÁry
(è? m_docum’tLßd”->
u¾FÜHi¡Üy
(è: m_docum’tLßd”->
ş›ÁRedœeùSourûFÜHi¡Üy
());

2404 
	glßd”
->
£tTrigg”šgAùiÚ
(
aùiÚ
);

2405 ià(
	gm_docum’tLßd”
)

2406 
	glßd”
->
£tOv”rideEncodšg
(
m_docum’tLßd”
->
ov”rideEncodšg
());

2408 
lßdW™hDocum’tLßd”
(
lßd”
.
g‘
(), 
ty³
, 
fÜmS‹
);

2411 
	gF¿meLßd”
::
lßd
(
Docum’tLßd”
* 
ÃwDocum’tLßd”
)

2413 #ifdeà
SSLAB__DEBUG


2414 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

2417 
	gResourûReque¡
& 
	gr
 = 
ÃwDocum’tLßd”
->
»que¡
();

2418 
addExŒaF›ldsToMašResourûReque¡
(
r
);

2419 
F¿meLßdTy³
 
	gty³
;

2421 ià(
shouldT»©URLAsSameAsCu¼’t
(
ÃwDocum’tLßd”
->
Üigš®Reque¡
().
u¾
())) {

2422 
	gr
.
£tCachePŞicy
(
R–ßdIgnÜšgCacheD©a
);

2423 
	gty³
 = 
F¿meLßdTy³Same
;

2425 
	gty³
 = 
F¿meLßdTy³Snd¬d
;

2427 ià(
	gm_docum’tLßd”
)

2428 
	gÃwDocum’tLßd”
->
£tOv”rideEncodšg
(
m_docum’tLßd”
->
ov”rideEncodšg
());

2437 ià(
shouldR–ßdToHªdËUÄ—chabËURL
(
ÃwDocum’tLßd”
)) {

2438 
ASSERT
(
ty³
 =ğ
F¿meLßdTy³Snd¬d
);

2439 
	gty³
 = 
F¿meLßdTy³R–ßd
;

2442 
lßdW™hDocum’tLßd”
(
ÃwDocum’tLßd”
, 
ty³
, 0);

2445 
	gF¿meLßd”
::
lßdW™hDocum’tLßd”
(
Docum’tLßd”
* 
lßd”
, 
F¿meLßdTy³
 
ty³
, 
PassRefPŒ
<
FÜmS‹
> 
´pFÜmS‹
)

2447 #ifdeà
SSLAB__DEBUG


2448 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

2451 
ASSERT
(
m_ş›Á
->
hasWebV›w
());

2456 
ASSERT
(
m_äame
->
v›w
());

2458 ià(
	gm_uÆßdEv’tBešgDi¥©ched
)

2461 
pŞicyCheck”
()->
£tLßdTy³
(
ty³
);

2462 
	gRefPŒ
<
	gFÜmS‹
> 
	gfÜmS‹
 = 
´pFÜmS‹
;

2463 
boŞ
 
	gisFÜmSubmissiÚ
 = 
fÜmS‹
;

2465 cÚ¡ 
	gKURL
& 
	gÃwURL
 = 
lßd”
->
»que¡
().
u¾
();

2467 ià(
shouldSüŞlToAnchÜ
(
isFÜmSubmissiÚ
, 
pŞicyCheck”
()->
lßdTy³
(), 
ÃwURL
)) {

2468 
	gRefPŒ
<
	gDocum’tLßd”
> 
	gŞdDocum’tLßd”
 = 
m_docum’tLßd”
;

2469 
Navig©iÚAùiÚ
 
aùiÚ
(
ÃwURL
, 
pŞicyCheck”
()->
lßdTy³
(), 
isFÜmSubmissiÚ
);

2471 
	gŞdDocum’tLßd”
->
£tTrigg”šgAùiÚ
(
aùiÚ
);

2472 
pŞicyCheck”
()->
¡İCheck
();

2473 
pŞicyCheck”
()->
checkNavig©iÚPŞicy
(
lßd”
->
»que¡
(), 
ŞdDocum’tLßd”
.
g‘
(), 
fÜmS‹
,

2474 
ÿÎCÚtšueF¿gm’tSüŞlAá”Navig©iÚPŞicy
, 
this
);

2476 ià(
F¿me
* 
	g·»Á
 = 
m_äame
->
Œ“
()->
·»Á
())

2477 
lßd”
->
£tOv”rideEncodšg
(
·»Á
->lßd”()->
docum’tLßd”
()->
ov”rideEncodšg
());

2479 
pŞicyCheck”
()->
¡İCheck
();

2480 
£tPŞicyDocum’tLßd”
(
lßd”
);

2481 ià(
	glßd”
->
Œigg”šgAùiÚ
().
isEm±y
())

2482 
	glßd”
->
£tTrigg”šgAùiÚ
(
Navig©iÚAùiÚ
(
ÃwURL
, 
pŞicyCheck”
()->
lßdTy³
(), 
isFÜmSubmissiÚ
));

2484 ià(
EËm’t
* 
	gowÃrEËm’t
 = 
m_äame
->
docum’t
()->
owÃrEËm’t
()) {

2485 ià(!
owÃrEËm’t
->
di¥©chBefÜeLßdEv’t
(
lßd”
->
»que¡
().
u¾
().
¡ršg
())) {

2486 
cÚtšueLßdAá”Navig©iÚPŞicy
(
lßd”
->
»que¡
(), 
fÜmS‹
, 
çl£
);

2491 
pŞicyCheck”
()->
checkNavig©iÚPŞicy
(
lßd”
->
»que¡
(),†ßd”, 
fÜmS‹
,

2492 
ÿÎCÚtšueLßdAá”Navig©iÚPŞicy
, 
this
);

2496 
	gF¿meLßd”
::
»pÜtLoÿlLßdFaed
(
F¿me
* 
äame
, cÚ¡ 
SŒšg
& 
u¾
)

2498 #ifdeà
SSLAB__DEBUG


2499 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

2502 
ASSERT
(!
u¾
.
isEm±y
());

2503 ià(!
	gäame
)

2506 
	gäame
->
domWšdow
()->
cÚsŞe
()->
addMes§ge
(
JSMes§geSourû
, 
LogMes§geTy³
, 
E¼ÜMes§geLev–
, "NÙ‡ÎowedØlßd†oÿÈ»sourû: " + 
u¾
, 0, 
SŒšg
());

2509 cÚ¡ 
	gResourûReque¡
& 
	gF¿meLßd”
::
š™ŸlReque¡
() const

2511 #ifdeà
SSLAB__DEBUG


2512 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

2515  
aùiveDocum’tLßd”
()->
Üigš®Reque¡
();

2518 
	gF¿meLßd”
::
»ûivedD©a
(cÚ¡ * 
d©a
, 
Ëngth
)

2520 #ifdeà
SSLAB__DEBUG


2521 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

2524 
aùiveDocum’tLßd”
()->
»ûivedD©a
(
d©a
, 
Ëngth
);

2527 
boŞ
 
	gF¿meLßd”
::
wlLßdMedŸEËm’tURL
(
KURL
& 
u¾
)

2529 #ifdeà
SSLAB__DEBUG


2530 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

2533 
ResourûReque¡
 
»que¡
(
u¾
);

2535 
	gid’tif›r
;

2536 
ResourûE¼Ü
 
	g”rÜ
;

2537 
»que¡FromD–eg©e
(
»que¡
, 
id’tif›r
, 
”rÜ
);

2538 
nÙif›r
()->
£ndRemaššgD–eg©eMes§ges
(
m_docum’tLßd”
.
g‘
(), 
id’tif›r
, 
ResourûRe¥Ú£
(
u¾
, 
SŒšg
(), -1, SŒšg(), SŒšg()), -1, 
”rÜ
);

2540 
	gu¾
 = 
»que¡
.
u¾
();

2542  
	g”rÜ
.
isNuÎ
();

2545 
ResourûE¼Ü
 
	gF¿meLßd”
::
š‹¼u±iÚFÜPŞicyChªgeE¼Ü
(cÚ¡ 
ResourûReque¡
& 
»que¡
)

2547 #ifdeà
SSLAB__DEBUG


2548 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

2551  
	gm_ş›Á
->
š‹¼u±FÜPŞicyChªgeE¼Ü
(
»que¡
);

2554 
boŞ
 
	gF¿meLßd”
::
shouldR–ßdToHªdËUÄ—chabËURL
(
Docum’tLßd”
* 
docLßd”
)

2556 #ifdeà
SSLAB__DEBUG


2557 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

2560 
KURL
 
	guÄ—chabËURL
 = 
docLßd”
->
uÄ—chabËURL
();

2562 ià(
	guÄ—chabËURL
.
isEm±y
())

2563  
	gçl£
;

2565 ià(!
isBackFÜw¬dLßdTy³
(
pŞicyCheck”
()->
lßdTy³
()))

2566  
	gçl£
;

2573 
Docum’tLßd”
* 
	gcom·»Docum’tLßd”
 = 0;

2574 ià(
pŞicyCheck”
()->
d–eg©eIsDecidšgNavig©iÚPŞicy
(è||…ŞicyCheck”()->
d–eg©eIsHªdlšgUnim¶em’bËPŞicy
())

2575 
	gcom·»Docum’tLßd”
 = 
m_pŞicyDocum’tLßd”
.
g‘
();

2576 ià(
	gm_d–eg©eIsHªdlšgProvisiÚ®LßdE¼Ü
)

2577 
	gcom·»Docum’tLßd”
 = 
m_´ovisiÚ®Docum’tLßd”
.
g‘
();

2579  
	gcom·»Docum’tLßd”
 && 
	guÄ—chabËURL
 =ğ
com·»Docum’tLßd”
->
»que¡
().
u¾
();

2582 
	gF¿meLßd”
::
»lßdW™hOv”rideEncodšg
(cÚ¡ 
SŒšg
& 
’codšg
)

2584 #ifdeà
SSLAB__DEBUG


2585 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

2588 ià(!
	gm_docum’tLßd”
)

2591 
ResourûReque¡
 
	g»que¡
 = 
m_docum’tLßd”
->
»que¡
();

2592 
KURL
 
	guÄ—chabËURL
 = 
m_docum’tLßd”
->
uÄ—chabËURL
();

2593 ià(!
	guÄ—chabËURL
.
isEm±y
())

2594 
	g»que¡
.
£tURL
(
uÄ—chabËURL
);

2596 
	g»que¡
.
£tCachePŞicy
(
R‘uºCacheD©aEl£Lßd
);

2598 
	gRefPŒ
<
	gDocum’tLßd”
> 
	glßd”
 = 
m_ş›Á
->
ü—‹Docum’tLßd”
(
»que¡
, 
Sub¡™u‹D©a
());

2599 
£tPŞicyDocum’tLßd”
(
lßd”
.
g‘
());

2601 
	glßd”
->
£tOv”rideEncodšg
(
’codšg
);

2603 
lßdW™hDocum’tLßd”
(
lßd”
.
g‘
(), 
F¿meLßdTy³R–ßd
, 0);

2606 
	gF¿meLßd”
::
»lßd
(
boŞ
 
’dToEndR–ßd
)

2608 #ifdeà
SSLAB__DEBUG


2609 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

2612 ià(!
	gm_docum’tLßd”
)

2617 ià(
	gm_docum’tLßd”
->
»que¡
().
u¾
().
isEm±y
())

2620 
ResourûReque¡
 
	gš™ŸlReque¡
 = 
m_docum’tLßd”
->
»que¡
();

2623 
KURL
 
	guÄ—chabËURL
 = 
m_docum’tLßd”
->
uÄ—chabËURL
();

2624 ià(!
	guÄ—chabËURL
.
isEm±y
())

2625 
	gš™ŸlReque¡
.
£tURL
(
uÄ—chabËURL
);

2629 
	gRefPŒ
<
	gDocum’tLßd”
> 
	glßd”
 = 
m_ş›Á
->
ü—‹Docum’tLßd”
(
š™ŸlReque¡
, 
Sub¡™u‹D©a
());

2631 
	gResourûReque¡
& 
	g»que¡
 = 
lßd”
->
»que¡
();

2634 
	g»que¡
.
£tCachePŞicy
(
R–ßdIgnÜšgCacheD©a
);

2637 ià(
	g»que¡
.
h‰pM‘hod
() == "POST")

2638 
lßd”
->
£tTrigg”šgAùiÚ
(
Navig©iÚAùiÚ
(
»que¡
.
u¾
(), 
Navig©iÚTy³FÜmResubm™‹d
));

2640 
	glßd”
->
£tOv”rideEncodšg
(
m_docum’tLßd”
->
ov”rideEncodšg
());

2642 
lßdW™hDocum’tLßd”
(
lßd”
.
g‘
(), 
’dToEndR–ßd
 ? 
F¿meLßdTy³R–ßdFromOrigš
 : 
F¿meLßdTy³R–ßd
, 0);

2645 
boŞ
 
ÿnAcûssAnû¡Ü
(cÚ¡ 
Secur™yOrigš
* 
aùiveSecur™yOrigš
, 
F¿me
* 
rg‘F¿me
)

2647 #ifdeà
SSLAB__DEBUG


2648 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

2653 ià(!
	grg‘F¿me
)

2654  
	gçl£
;

2656 
F¿me
* 
	gªû¡ÜF¿me
 = 
rg‘F¿me
;‡nû¡ÜF¿me;‡nû¡ÜF¿mğ
ªû¡ÜF¿me
->
Œ“
()->
·»Á
()) {

2657 
Docum’t
* 
ªû¡ÜDocum’t
 = 
ªû¡ÜF¿me
->
docum’t
();

2658 ià(!
	gªû¡ÜDocum’t
)

2659  
	gŒue
;

2661 cÚ¡ 
Secur™yOrigš
* 
	gªû¡ÜSecur™yOrigš
 = 
ªû¡ÜDocum’t
->
£cur™yOrigš
();

2662 ià(
	gaùiveSecur™yOrigš
->
ÿnAcûss
(
ªû¡ÜSecur™yOrigš
))

2663  
	gŒue
;

2666  
	gçl£
;

2669 
boŞ
 
	gF¿meLßd”
::
shouldAÎowNavig©iÚ
(
F¿me
* 
rg‘F¿me
) const

2671 #ifdeà
SSLAB__DEBUG


2672 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

2684 ià(!
	grg‘F¿me
)

2685  
	gŒue
;

2688 ià(
	gm_äame
 =ğ
rg‘F¿me
)

2689  
Œue
;

2692 ià(
isDocum’tSªdboxed
(
SªdboxNavig©iÚ
è&& !
	grg‘F¿me
->
Œ“
()->
isDesûndªtOf
(
m_äame
))

2693  
	gçl£
;

2698 ià(
	grg‘F¿me
 =ğ
m_äame
->
Œ“
()->
tİ
())

2699  
Œue
;

2702 ià(!
	grg‘F¿me
->
Œ“
()->
·»Á
(è&& 
	gm_äame
->
lßd”
()->
İ’”
(è=ğ
rg‘F¿me
)

2703  
Œue
;

2705 
Docum’t
* 
	gaùiveDocum’t
 = 
m_äame
->
docum’t
();

2706 
ASSERT
(
aùiveDocum’t
);

2707 cÚ¡ 
Secur™yOrigš
* 
	gaùiveSecur™yOrigš
 = 
aùiveDocum’t
->
£cur™yOrigš
();

2710 ià(!
	grg‘F¿me
->
Œ“
()->
·»Á
(è&& 
ÿnAcûssAnû¡Ü
(
aùiveSecur™yOrigš
, 
rg‘F¿me
->
lßd”
()->
İ’”
()))

2711  
	gŒue
;

2714 ià(
ÿnAcûssAnû¡Ü
(
aùiveSecur™yOrigš
, 
rg‘F¿me
))

2715  
	gŒue
;

2717 
S‘tšgs
* 
	g£‰šgs
 = 
rg‘F¿me
->
£‰šgs
();

2718 ià(
	g£‰šgs
 && !£‰šgs->
´iv©eBrowsšgEÇbËd
()) {

2719 
Docum’t
* 
	grg‘Docum’t
 = 
rg‘F¿me
->
docum’t
();

2721 
SŒšg
 
	gmes§ge
 = SŒšg::
fÜm©
("Unsafe JavaScript‡ttempto initiate‡‚avigation change for frame with URL %s from frame with URL %s.\n",

2722 
rg‘Docum’t
->
u¾
().
¡ršg
().
utf8
().
d©a
(), 
aùiveDocum’t
->url().string().utf8().data());

2725 
	grg‘F¿me
->
domWšdow
()->
cÚsŞe
()->
addMes§ge
(
JSMes§geSourû
, 
LogMes§geTy³
, 
E¼ÜMes§geLev–
, 
mes§ge
, 1, 
SŒšg
());

2728  
	gçl£
;

2731 
	gF¿meLßd”
::
¡İLßdšgSubäames
()

2733 #ifdeà
SSLAB__DEBUG


2734 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

2737 
	gRefPŒ
<
	gF¿me
> 
	gchd
 = 
m_äame
->
Œ“
()->
fœ¡Chd
(); chd; chd = 
chd
->Œ“()->
ÃxtSiblšg
())

2738 
chd
->
lßd”
()->
¡İAÎLßd”s
();

2741 
	gF¿meLßd”
::
¡İAÎLßd”s
(
D©aba£PŞicy
 
d©aba£PŞicy
)

2743 #ifdeà
SSLAB__DEBUG


2744 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

2747 
ASSERT
(!
m_äame
->
docum’t
(è|| !m_äame->docum’t()->
šPageCache
());

2748 ià(
	gm_uÆßdEv’tBešgDi¥©ched
)

2752 ià(
	gm_šStİAÎLßd”s
)

2755 
	gm_šStİAÎLßd”s
 = 
Œue
;

2757 
pŞicyCheck”
()->
¡İCheck
();

2759 
¡İLßdšgSubäames
();

2760 ià(
	gm_´ovisiÚ®Docum’tLßd”
)

2761 
	gm_´ovisiÚ®Docum’tLßd”
->
¡İLßdšg
(
d©aba£PŞicy
);

2762 ià(
	gm_docum’tLßd”
)

2763 
	gm_docum’tLßd”
->
¡İLßdšg
(
d©aba£PŞicy
);

2765 
£tProvisiÚ®Docum’tLßd”
(0);

2767 ià(
	gm_docum’tLßd”
)

2768 
	gm_docum’tLßd”
->
ş—rArchiveResourûs
();

2770 
	gm_checkTim”
.
¡İ
();

2772 
	gm_šStİAÎLßd”s
 = 
çl£
;

2775 
	gF¿meLßd”
::
¡İFÜU£rCªûl
(
boŞ
 
deãrCheckLßdCom¶‘e
)

2777 #ifdeà
SSLAB__DEBUG


2778 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

2781 
¡İAÎLßd”s
();

2783 ià(
	gdeãrCheckLßdCom¶‘e
)

2784 
scheduËCheckLßdCom¶‘e
();

2785 ià(
	gm_äame
->
·ge
())

2786 
checkLßdCom¶‘e
();

2789 
Docum’tLßd”
* 
	gF¿meLßd”
::
aùiveDocum’tLßd”
() const

2791 #ifdeà
SSLAB__DEBUG


2792 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

2795 ià(
	gm_¡©e
 =ğ
F¿meS‹ProvisiÚ®
)

2796  
m_´ovisiÚ®Docum’tLßd”
.
g‘
();

2797  
	gm_docum’tLßd”
.
g‘
();

2800 
boŞ
 
	gF¿meLßd”
::
isLßdšg
() const

2802 #ifdeà
SSLAB__DEBUG


2803 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

2806 
Docum’tLßd”
* 
	gdocLßd”
 = 
aùiveDocum’tLßd”
();

2807 ià(!
	gdocLßd”
)

2808  
	gçl£
;

2809  
	gdocLßd”
->
isLßdšgMašResourû
(è|| docLßd”->
isLßdšgSub»sourûs
(è|| docLßd”->
isLßdšgPlugIns
();

2812 
boŞ
 
	gF¿meLßd”
::
äameHasLßded
() const

2814 #ifdeà
SSLAB__DEBUG


2815 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

2818  
	gm_comm™‹dFœ¡R—lDocum’tLßd
 || (
	gm_´ovisiÚ®Docum’tLßd”
 && !
	gm_ü—tšgIn™ŸlEm±yDocum’t
);

2821 
	gF¿meLßd”
::
£tDocum’tLßd”
(
Docum’tLßd”
* 
lßd”
)

2823 #ifdeà
SSLAB__DEBUG


2824 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

2827 ià(!
	glßd”
 && !
	gm_docum’tLßd”
)

2830 
ASSERT
(
lßd”
 !ğ
m_docum’tLßd”
);

2831 
ASSERT
(!
lßd”
 ||†ßd”->
äameLßd”
(è=ğ
this
);

2833 
	gm_ş›Á
->
´•¬eFÜD©aSourûR•Ïûm’t
();

2834 
d‘achChd»n
();

2835 ià(
	gm_docum’tLßd”
)

2836 
	gm_docum’tLßd”
->
d‘achFromF¿me
();

2838 
	gm_docum’tLßd”
 = 
lßd”
;

2841 
	gF¿meLßd”
::
£tPŞicyDocum’tLßd”
(
Docum’tLßd”
* 
lßd”
)

2843 #ifdeà
SSLAB__DEBUG


2844 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

2847 ià(
	gm_pŞicyDocum’tLßd”
 =ğ
lßd”
)

2850 
ASSERT
(
m_äame
);

2851 ià(
	glßd”
)

2852 
	glßd”
->
£tF¿me
(
m_äame
);

2853 ià(
	gm_pŞicyDocum’tLßd”


2854 && 
	gm_pŞicyDocum’tLßd”
 !ğ
m_´ovisiÚ®Docum’tLßd”


2855 && 
m_pŞicyDocum’tLßd”
 !ğ
m_docum’tLßd”
)

2856 
m_pŞicyDocum’tLßd”
->
d‘achFromF¿me
();

2858 
	gm_pŞicyDocum’tLßd”
 = 
lßd”
;

2861 
	gF¿meLßd”
::
£tProvisiÚ®Docum’tLßd”
(
Docum’tLßd”
* 
lßd”
)

2863 #ifdeà
SSLAB__DEBUG


2864 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

2867 
ASSERT
(!
lßd”
 || !
m_´ovisiÚ®Docum’tLßd”
);

2868 
ASSERT
(!
lßd”
 ||†ßd”->
äameLßd”
(è=ğ
this
);

2870 ià(
	gm_´ovisiÚ®Docum’tLßd”
 && m_´ovisiÚ®Docum’tLßd” !ğ
m_docum’tLßd”
)

2871 
m_´ovisiÚ®Docum’tLßd”
->
d‘achFromF¿me
();

2873 
	gm_´ovisiÚ®Docum’tLßd”
 = 
lßd”
;

2876 
	gF¿meLßd”
::
timeOfLa¡Com¶‘edLßd
()

2878 #ifdeà
SSLAB__DEBUG


2879 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

2882  
	g¡ÜedTimeOfLa¡Com¶‘edLßd
;

2885 
	gF¿meLßd”
::
£tS‹
(
F¿meS‹
 
ÃwS‹
)

2887 #ifdeà
SSLAB__DEBUG


2888 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

2891 
	gm_¡©e
 = 
ÃwS‹
;

2893 ià(
	gÃwS‹
 =ğ
F¿meS‹ProvisiÚ®
)

2894 
´ovisiÚ®LßdS¹ed
();

2895 ià(
	gÃwS‹
 =ğ
F¿meS‹Com¶‘e
) {

2896 
äameLßdCom¶‘ed
();

2897 
	g¡ÜedTimeOfLa¡Com¶‘edLßd
 = 
cu¼’tTime
();

2898 ià(
	gm_docum’tLßd”
)

2899 
	gm_docum’tLßd”
->
¡İRecÜdšgRe¥Ú£s
();

2903 
	gF¿meLßd”
::
ş—rProvisiÚ®Lßd
()

2905 #ifdeà
SSLAB__DEBUG


2906 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

2909 
£tProvisiÚ®Docum’tLßd”
(0);

2910 ià(
Page
* 
	g·ge
 = 
m_äame
->
·ge
())

2911 
·ge
->
´og»ss
()->
´og»ssCom¶‘ed
(
m_äame
);

2912 
£tS‹
(
F¿meS‹Com¶‘e
);

2915 
	gF¿meLßd”
::
m¬kLßdCom¶‘e
()

2917 #ifdeà
SSLAB__DEBUG


2918 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

2921 
£tS‹
(
F¿meS‹Com¶‘e
);

2924 
	gF¿meLßd”
::
comm™ProvisiÚ®Lßd
(
PassRefPŒ
<
CachedPage
> 
´pCachedPage
)

2926 #ifdeà
SSLAB__DEBUG


2927 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

2930 
	gRefPŒ
<
	gCachedPage
> 
	gÿchedPage
 = 
´pCachedPage
;

2931 
	gRefPŒ
<
	gDocum’tLßd”
> 
	gpdl
 = 
m_´ovisiÚ®Docum’tLßd”
;

2933 
LOG
(
PageCache
, "WebCÜeLßdšg %s: AbouˆtØcomm™…rovisiÚ®†ßd from…»viou URL '%s'ØÃw URL '%s'", 
m_äame
->
Œ“
()->
Çme
().
¡ršg
().
utf8
().
d©a
(), 
m_URL
.string().utf8().data(),

2934 
pdl
 ?…dl->
u¾
().
¡ršg
().
utf8
().
d©a
() : "<no…rovisional DocumentLoader>");

2938 
ÿchePageFÜHi¡ÜyI‹m
(
hi¡Üy
()->
cu¼’tI‹m
());

2940 ià(
	gm_lßdTy³
 !ğ
F¿meLßdTy³R•Ïû
)

2941 
şo£OldD©aSourûs
();

2943 ià(!
	gÿchedPage
 && !
	gm_ü—tšgIn™ŸlEm±yDocum’t
)

2944 
	gm_ş›Á
->
makeR•»£Á©iÚ
(
pdl
.
g‘
());

2946 
Œªs™iÚToComm™‹d
(
ÿchedPage
);

2952 ià(
	gm_£ÁRedœeùNÙifiÿtiÚ
)

2953 
ş›ÁRedœeùCªûÎedOrFšished
(
çl£
);

2955 ià(
	gÿchedPage
 && cachedPage->
docum’t
())

2956 
İ’
(*
ÿchedPage
);

2958 
KURL
 
	gu¾
 = 
pdl
->
sub¡™u‹D©a
().
»¥Ú£URL
();

2959 ià(
	gu¾
.
isEm±y
())

2960 
	gu¾
 = 
pdl
->
u¾
();

2961 ià(
	gu¾
.
isEm±y
())

2962 
	gu¾
 = 
pdl
->
»¥Ú£URL
();

2963 ià(
	gu¾
.
isEm±y
())

2964 
	gu¾
 = 
bÏnkURL
();

2966 
didO³nURL
(
u¾
);

2969 
LOG
(
Lßdšg
, "WebCÜeLßdšg %s: Fšished comm™tšg…rovisiÚ®†ßdØURL %s", 
m_äame
->
Œ“
()->
Çme
().
¡ršg
().
utf8
().
d©a
(), 
m_URL
.string().utf8().data());

2971 ià(
	gm_lßdTy³
 =ğ
F¿meLßdTy³Snd¬d
 && 
m_docum’tLßd”
->
isCl›ÁRedœeù
())

2972 
hi¡Üy
()->
upd©eFÜCl›ÁRedœeù
();

2974 ià(
	gm_lßdšgFromCachedPage
) {

2975 
	gm_äame
->
docum’t
()->
docum’tDidBecomeAùive
();

2978 
	gm_äame
->
v›w
()->
fÜûLayout
();

2980 cÚ¡ 
	gRe¥Ú£VeùÜ
& 
	g»¥Ú£s
 = 
m_docum’tLßd”
->
»¥Ú£s
();

2981 
size_t
 
	gcouÁ
 = 
»¥Ú£s
.
size
();

2982 
size_t
 
	gi
 = 0; i < 
	gcouÁ
; i++) {

2983 cÚ¡ 
	gResourûRe¥Ú£
& 
	g»¥Ú£
 = 
»¥Ú£s
[
i
];

2985 
ResourûE¼Ü
 
	g”rÜ
;

2986 
	gid’tif›r
;

2987 
ResourûReque¡
 
»que¡
(
»¥Ú£
.
u¾
());

2988 
»que¡FromD–eg©e
(
»que¡
, 
id’tif›r
, 
”rÜ
);

2992 
nÙif›r
()->
£ndRemaššgD–eg©eMes§ges
(
m_docum’tLßd”
.
g‘
(), 
id’tif›r
, 
»¥Ú£
, 
¡©ic_ÿ¡
<>Ôe¥Ú£.
ex³ùedCÚ‹ÁL’gth
()), 
”rÜ
);

2995 
·geCache
()->
»move
(
hi¡Üy
()->
cu¼’tI‹m
());

2997 
	gm_docum’tLßd”
->
£tPrim¬yLßdCom¶‘e
(
Œue
);

3000 
checkLßdCom¶‘eFÜThisF¿me
();

3004 
	gF¿meLßd”
::
Œªs™iÚToComm™‹d
(
PassRefPŒ
<
CachedPage
> 
ÿchedPage
)

3006 #ifdeà
SSLAB__DEBUG


3007 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

3010 
ASSERT
(
m_ş›Á
->
hasWebV›w
());

3011 
ASSERT
(
m_¡©e
 =ğ
F¿meS‹ProvisiÚ®
);

3013 ià(
	gm_¡©e
 !ğ
F¿meS‹ProvisiÚ®
)

3016 
	gm_ş›Á
->
£tCİ›sOnSüŞl
();

3017 
hi¡Üy
()->
upd©eFÜComm™
();

3022 
Docum’tLßd”
* 
	gpdl
 = 
m_´ovisiÚ®Docum’tLßd”
.
g‘
();

3023 ià(
	gm_docum’tLßd”
)

3024 
şo£URL
();

3025 ià(
	gpdl
 !ğ
m_´ovisiÚ®Docum’tLßd”
)

3029 ià(
	gm_docum’tLßd”
)

3030 
	gm_docum’tLßd”
->
¡İLßdšgSub»sourûs
();

3031 ià(
	gm_docum’tLßd”
)

3032 
	gm_docum’tLßd”
->
¡İLßdšgPlugIns
();

3034 
£tDocum’tLßd”
(
m_´ovisiÚ®Docum’tLßd”
.
g‘
());

3035 
£tProvisiÚ®Docum’tLßd”
(0);

3036 
£tS‹
(
F¿meS‹Comm™‹dPage
);

3039 
Docum’tLßd”
* 
	gdl
 = 
m_docum’tLßd”
.
g‘
();

3040 
SŒšg
 
	g±™Ë
 = 
dl
->
t™Ë
();

3042 
	gm_lßdTy³
) {

3043 
	gF¿meLßdTy³FÜw¬d
:

3044 
F¿meLßdTy³Back
:

3045 
F¿meLßdTy³BackWMLDeckNÙAcûssibË
:

3046 
F¿meLßdTy³IndexedBackFÜw¬d
:

3047 ià(
Page
* 
·ge
 = 
m_äame
->page()) {

3048 ià(
·ge
->
backFÜw¬dLi¡
()) {

3049 
hi¡Üy
()->
upd©eFÜBackFÜw¬dNavig©iÚ
();

3051 ià(
hi¡Üy
()->
cu¼’tI‹m
())

3052 
	gm_³ndšgS‹Objeù
 = 
hi¡Üy
()->
cu¼’tI‹m
()->
¡©eObjeù
();

3055 ià(
	gÿchedPage
) {

3056 
Docum’tLßd”
* 
	gÿchedDocum’tLßd”
 = 
ÿchedPage
->
docum’tLßd”
();

3057 
ASSERT
(
ÿchedDocum’tLßd”
);

3058 
	gÿchedDocum’tLßd”
->
£tF¿me
(
m_äame
);

3059 
	gm_ş›Á
->
Œªs™iÚToComm™‹dFromCachedF¿me
(
ÿchedPage
->
ÿchedMašF¿me
());

3062 
	gm_ş›Á
->
Œªs™iÚToComm™‹dFÜNewPage
();

3067 
	gF¿meLßdTy³R–ßd
:

3068 
F¿meLßdTy³R–ßdFromOrigš
:

3069 
F¿meLßdTy³Same
:

3070 
F¿meLßdTy³R•Ïû
:

3071 
hi¡Üy
()->
upd©eFÜR–ßd
();

3072 
	gm_ş›Á
->
Œªs™iÚToComm™‹dFÜNewPage
();

3075 
	gF¿meLßdTy³Snd¬d
:

3076 
hi¡Üy
()->
upd©eFÜSnd¬dLßd
();

3077 #iâdeà
BUILDING_ON_TIGER


3080 ià(
	gm_äame
->
v›w
())

3081 
	gm_äame
->
v›w
()->
£tSüŞlb¬sSuµ»s£d
(
Œue
);

3083 
	gm_ş›Á
->
Œªs™iÚToComm™‹dFÜNewPage
();

3086 
	gF¿meLßdTy³RedœeùW™hLockedBackFÜw¬dLi¡
:

3087 
hi¡Üy
()->
upd©eFÜRedœeùW™hLockedBackFÜw¬dLi¡
();

3088 
	gm_ş›Á
->
Œªs™iÚToComm™‹dFÜNewPage
();

3094 
ASSERT_NOT_REACHED
();

3097 
	gm_»¥Ú£MIMETy³
 = 
dl
->
»¥Ú£MIMETy³
();

3100 
ASSERT
(
m_äame
->
v›w
());

3102 ià(
	gm_ü—tšgIn™ŸlEm±yDocum’t
)

3105 
	gm_comm™‹dFœ¡R—lDocum’tLßd
 = 
Œue
;

3107 ià(!
	gm_ş›Á
->
hasHTMLV›w
())

3108 
»ûivedFœ¡D©a
();

3109 ià(
	gÿchedPage
) {

3111 
di¥©chDidComm™Lßd
();

3114 ià(!
	g±™Ë
.
isNuÎ
())

3115 
	gm_ş›Á
->
di¥©chDidReûiveT™Ë
(
±™Ë
);

3119 
	gF¿meLßd”
::
ş›ÁRedœeùCªûÎedOrFšished
(
boŞ
 
ÿnûlW™hLßdInProg»ss
)

3121 #ifdeà
SSLAB__DEBUG


3122 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

3128 
	gm_ş›Á
->
di¥©chDidCªûlCl›ÁRedœeù
();

3130 ià(!
	gÿnûlW™hLßdInProg»ss
)

3131 
	gm_quickRedœeùComšg
 = 
çl£
;

3133 
	gm_£ÁRedœeùNÙifiÿtiÚ
 = 
çl£
;

3136 
	gF¿meLßd”
::
ş›ÁRedœeùed
(cÚ¡ 
KURL
& 
u¾
, 
£cÚds
, 
fœeD©e
, 
boŞ
 
lockBackFÜw¬dLi¡
)

3138 #ifdeà
SSLAB__DEBUG


3139 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

3142 
	gm_ş›Á
->
di¥©chWlP”fÜmCl›ÁRedœeù
(
u¾
, 
£cÚds
, 
fœeD©e
);

3146 
	gm_£ÁRedœeùNÙifiÿtiÚ
 = 
Œue
;

3152 
	gm_quickRedœeùComšg
 = 
lockBackFÜw¬dLi¡
 && 
m_docum’tLßd”
 && !
m_isExecutšgJavaSütFÜmAùiÚ
;

3155 
boŞ
 
	gF¿meLßd”
::
shouldR–ßd
(cÚ¡ 
KURL
& 
cu¼’tURL
, cÚ¡ KURL& 
de¡š©iÚURL
)

3157 #ifdeà
SSLAB__DEBUG


3158 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

3161 #ià
ENABLE
(
WML
)

3163 ià(
äameCÚšsWMLCÚ‹Á
(
m_äame
))

3164  
	gŒue
;

3170 ià(!
	gde¡š©iÚURL
.
hasF¿gm’tId’tif›r
())

3171  
	gŒue
;

3172  !
equ®IgnÜšgF¿gm’tId’tif›r
(
cu¼’tURL
, 
de¡š©iÚURL
);

3175 
	gF¿meLßd”
::
şo£OldD©aSourûs
()

3177 #ifdeà
SSLAB__DEBUG


3178 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

3184 
F¿me
* 
	gchd
 = 
m_äame
->
Œ“
()->
fœ¡Chd
(); chd; chd = 
chd
->Œ“()->
ÃxtSiblšg
())

3185 
chd
->
lßd”
()->
şo£OldD©aSourûs
();

3187 ià(
	gm_docum’tLßd”
)

3188 
	gm_ş›Á
->
di¥©chWlClo£
();

3190 
	gm_ş›Á
->
£tMašF¿meDocum’tR—dy
(
çl£
);

3193 
	gF¿meLßd”
::
İ’
(
CachedPage
& 
ÿchedPage
)

3195 #ifdeà
SSLAB__DEBUG


3196 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

3199 
ASSERT
(!
m_äame
->
Œ“
()->
·»Á
());

3200 
ASSERT
(
m_äame
->
·ge
());

3201 
ASSERT
(
m_äame
->
·ge
()->
mašF¿me
() == m_frame);

3203 
	gm_äame
->
»dœeùScheduËr
()->
ÿnûl
();

3206 
şo£URL
();

3209 ià(
	gm_äame
->
süt
()->
ÿnExecu‹Süts
(
NÙAboutToExecu‹Süt
)) {

3210 
	gm_äame
->
£tJSStusB¬Text
(
SŒšg
());

3211 
	gm_äame
->
£tJSDeçuÉStusB¬Text
(
SŒšg
());

3214 
	gÿchedPage
.
»¡Üe
(
m_äame
->
·ge
());

3216 
checkCom¶‘ed
();

3219 
	gF¿meLßd”
::
İ’
(
CachedF¿meBa£
& 
ÿchedF¿me
)

3221 #ifdeà
SSLAB__DEBUG


3222 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

3225 
	gm_isCom¶‘e
 = 
çl£
;

3228 
	gm_didC®lIm¶ic™Clo£
 = 
Œue
;

3230 
KURL
 
	gu¾
 = 
ÿchedF¿me
.
u¾
();

3232 ià(
	gu¾
.
´ÙocŞInHTTPFamy
(è&& !u¾.
ho¡
().
isEm±y
(è&& u¾.
·th
().isEmpty())

3233 
	gu¾
.
£tP©h
("/");

3235 
	gm_URL
 = 
u¾
;

3236 
	gm_wÜkšgURL
 = 
u¾
;

3238 
¡¬‹d
();

3239 
ş—r
(
Œue
,rue, 
ÿchedF¿me
.
isMašF¿me
());

3241 
Docum’t
* 
	gdocum’t
 = 
ÿchedF¿me
.
docum’t
();

3242 
ASSERT
(
docum’t
);

3243 
	gdocum’t
->
£tInPageCache
(
çl£
);

3245 
	gm_ÃedsCË¬
 = 
Œue
;

3246 
	gm_isCom¶‘e
 = 
çl£
;

3247 
	gm_didC®lIm¶ic™Clo£
 = 
çl£
;

3248 
	gm_outgošgReã¼”
 = 
u¾
.
¡ršg
();

3250 
F¿meV›w
* 
	gv›w
 = 
ÿchedF¿me
.
v›w
();

3253 
ASSERT
(
v›w
);

3254 
	gv›w
->
£tWasSüŞËdByU£r
(
çl£
);

3257 ià(
	gm_äame
->
v›w
())

3258 
	gv›w
->
£tF¿meReù
(
m_äame
->
v›w
()->
äameReù
());

3259 
	gm_äame
->
£tV›w
(
v›w
);

3261 
	gm_äame
->
£tDocum’t
(
docum’t
);

3262 
	gm_äame
->
£tDOMWšdow
(
ÿchedF¿me
.
domWšdow
());

3263 
	gm_äame
->
domWšdow
()->
£tURL
(
docum’t
->
u¾
());

3264 
	gm_äame
->
domWšdow
()->
£tSecur™yOrigš
(
docum’t
->
£cur™yOrigš
());

3266 
	gm_decod”
 = 
docum’t
->
decod”
();

3268 
upd©eFœ¡P¬tyFÜCook›s
();

3270 
	gÿchedF¿me
.
»¡Üe
();

3273 
boŞ
 
	gF¿meLßd”
::
isStİpšg
() const

3275 #ifdeà
SSLAB__DEBUG


3276 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

3279  
aùiveDocum’tLßd”
()->
isStİpšg
();

3282 
	gF¿meLßd”
::
fšishedLßdšg
()

3284 #ifdeà
SSLAB__DEBUG


3285 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

3289 
	gRefPŒ
<
	gF¿me
> 
´Ùeù
(
m_äame
);

3291 
	gRefPŒ
<
	gDocum’tLßd”
> 
	gdl
 = 
aùiveDocum’tLßd”
();

3292 
	gdl
->
fšishedLßdšg
();

3293 ià(!
	gdl
->
mašDocum’tE¼Ü
().
isNuÎ
(è|| !dl->
äameLßd”
())

3295 
	gdl
->
£tPrim¬yLßdCom¶‘e
(
Œue
);

3296 
	gm_ş›Á
->
di¥©chDidLßdMašResourû
(
dl
.
g‘
());

3297 
checkLßdCom¶‘e
();

3300 
boŞ
 
	gF¿meLßd”
::
isHo¡edByObjeùEËm’t
() const

3302 #ifdeà
SSLAB__DEBUG


3303 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

3306 
HTMLF¿meOwÃrEËm’t
* 
	gowÃr
 = 
m_äame
->
owÃrEËm’t
();

3307  
	gowÃr
 && owÃr->
hasTagName
(
objeùTag
);

3310 
boŞ
 
	gF¿meLßd”
::
isLßdšgMašF¿me
() const

3312 #ifdeà
SSLAB__DEBUG


3313 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

3316 
Page
* 
	g·ge
 = 
m_äame
->
·ge
();

3317  
	g·ge
 && 
	gm_äame
 =ğ
·ge
->
mašF¿me
();

3320 
boŞ
 
	gF¿meLßd”
::
ÿnShowMIMETy³
(cÚ¡ 
SŒšg
& 
MIMETy³
) const

3322 #ifdeà
SSLAB__DEBUG


3323 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

3326  
	gm_ş›Á
->
ÿnShowMIMETy³
(
MIMETy³
);

3329 
boŞ
 
	gF¿meLßd”
::
»´e£Á©iÚExi¡sFÜURLScheme
(cÚ¡ 
SŒšg
& 
URLScheme
)

3331 #ifdeà
SSLAB__DEBUG


3332 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

3335  
	gm_ş›Á
->
»´e£Á©iÚExi¡sFÜURLScheme
(
URLScheme
);

3338 
SŒšg
 
	gF¿meLßd”
::
g’”©edMIMETy³FÜURLScheme
(cÚ¡ SŒšg& 
URLScheme
)

3340 #ifdeà
SSLAB__DEBUG


3341 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

3344  
	gm_ş›Á
->
g’”©edMIMETy³FÜURLScheme
(
URLScheme
);

3347 
	gF¿meLßd”
::
didReûiveS”v”RedœeùFÜProvisiÚ®LßdFÜF¿me
()

3349 #ifdeà
SSLAB__DEBUG


3350 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

3353 
	gm_ş›Á
->
di¥©chDidReûiveS”v”RedœeùFÜProvisiÚ®Lßd
();

3356 
	gF¿meLßd”
::
fšishedLßdšgDocum’t
(
Docum’tLßd”
* 
lßd”
)

3358 #ifdeà
SSLAB__DEBUG


3359 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

3363 #ià
PLATFORM
(
WIN
è|| PLATFORM(
CHROMIUM
)

3364 ià(
	gm_ü—tšgIn™ŸlEm±yDocum’t
)

3369 cÚ¡ 
	gSŒšg
& 
	g»¥Ú£MIMETy³
 = 
lßd”
->
»¥Ú£MIMETy³
();

3374 #ià
PLATFORM
(
MAC
)

3375 
	gm_ş›Á
->
fšishedLßdšg
(
lßd”
);

3376 ià(!
	gArchiveFaùÜy
::
isArchiveMimeTy³
(
»¥Ú£MIMETy³
))

3379 ià(!
	gArchiveFaùÜy
::
isArchiveMimeTy³
(
»¥Ú£MIMETy³
)) {

3380 
m_ş›Á
->
fšishedLßdšg
(
lßd”
);

3385 
	gRefPŒ
<
	gArchive
> 
¬chive
(
ArchiveFaùÜy
::
ü—‹
(
lßd”
->
mašResourûD©a
().
g‘
(), 
»¥Ú£MIMETy³
));

3386 ià(!
	g¬chive
)

3389 
	glßd”
->
addAÎArchiveResourûs
(
¬chive
.
g‘
());

3391 
ArchiveResourû
* 
	gmašResourû
 = 
¬chive
->
mašResourû
();

3392 
	glßd”
->
£tP¬£dArchiveD©a
(
mašResourû
->
d©a
());

3394 
	gm_»¥Ú£MIMETy³
 = 
mašResourû
->
mimeTy³
();

3396 
şo£URL
();

3397 
didO³nURL
(
mašResourû
->
u¾
());

3399 
SŒšg
 
	gu£rCho£nEncodšg
 = 
docum’tLßd”
()->
ov”rideEncodšg
();

3400 
boŞ
 
	g’codšgIsU£rCho£n
 = !
u£rCho£nEncodšg
.
isNuÎ
();

3401 
£tEncodšg
(
’codšgIsU£rCho£n
 ? 
u£rCho£nEncodšg
 : 
mašResourû
->
‹xtEncodšg
(),ƒncodingIsUserChosen);

3403 
ASSERT
(
m_äame
->
docum’t
());

3405 
addD©a
(
mašResourû
->
d©a
()->d©a(), mašResourû->d©a()->
size
());

3408 
boŞ
 
	gF¿meLßd”
::
isR•Ïcšg
() const

3410 #ifdeà
SSLAB__DEBUG


3411 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

3414  
	gm_lßdTy³
 =ğ
F¿meLßdTy³R•Ïû
;

3417 
	gF¿meLßd”
::
£tR•Ïcšg
()

3419 #ifdeà
SSLAB__DEBUG


3420 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

3423 
	gm_lßdTy³
 = 
F¿meLßdTy³R•Ïû
;

3426 
	gF¿meLßd”
::
»v”tToProvisiÚ®
(
Docum’tLßd”
* 
lßd”
)

3428 #ifdeà
SSLAB__DEBUG


3429 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

3432 
	gm_ş›Á
->
»v”tToProvisiÚ®S‹
(
lßd”
);

3435 
boŞ
 
	gF¿meLßd”
::
subäameIsLßdšg
() const

3437 #ifdeà
SSLAB__DEBUG


3438 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

3442 
F¿me
* 
	gchd
 = 
m_äame
->
Œ“
()->
Ï¡Chd
(); chd; chd = 
chd
->Œ“()->
´eviousSiblšg
()) {

3443 
F¿meLßd”
* 
chdLßd”
 = 
chd
->
lßd”
();

3444 
Docum’tLßd”
* 
	gdocum’tLßd”
 = 
chdLßd”
->
docum’tLßd”
();

3445 ià(
	gdocum’tLßd”
 && docum’tLßd”->
isLßdšgInAPIS’£
())

3446  
	gŒue
;

3447 
	gdocum’tLßd”
 = 
chdLßd”
->
´ovisiÚ®Docum’tLßd”
();

3448 ià(
	gdocum’tLßd”
 && docum’tLßd”->
isLßdšgInAPIS’£
())

3449  
	gŒue
;

3451  
	gçl£
;

3454 
	gF¿meLßd”
::
wlChªgeT™Ë
(
Docum’tLßd”
* 
lßd”
)

3456 #ifdeà
SSLAB__DEBUG


3457 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

3460 
	gm_ş›Á
->
wlChªgeT™Ë
(
lßd”
);

3463 
F¿meLßdTy³
 
	gF¿meLßd”
::
lßdTy³
() const

3465 #ifdeà
SSLAB__DEBUG


3466 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

3469  
	gm_lßdTy³
;

3472 
CachePŞicy
 
	gF¿meLßd”
::
sub»sourûCachePŞicy
() const

3474 #ifdeà
SSLAB__DEBUG


3475 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

3478 ià(
	gm_isCom¶‘e
)

3479  
	gCachePŞicyV”ify
;

3481 ià(
	gm_lßdTy³
 =ğ
F¿meLßdTy³R–ßdFromOrigš
)

3482  
CachePŞicyR–ßd
;

3484 ià(
F¿me
* 
	g·»ÁF¿me
 = 
m_äame
->
Œ“
()->
·»Á
()) {

3485 
CachePŞicy
 
·»ÁCachePŞicy
 = 
·»ÁF¿me
->
lßd”
()->
sub»sourûCachePŞicy
();

3486 ià(
	g·»ÁCachePŞicy
 !ğ
CachePŞicyV”ify
)

3487  
·»ÁCachePŞicy
;

3494 cÚ¡ 
	gResourûReque¡
& 
»que¡
(
docum’tLßd”
()->request());

3495 ià(
	g»que¡
.
ÿchePŞicy
(è=ğ
R–ßdIgnÜšgCacheD©a
 && !
equ®IgnÜšgCa£
(
»que¡
.
h‰pM‘hod
(), "post"))

3496  
	gCachePŞicyRev®id©e
;

3498 ià(
	gm_lßdTy³
 =ğ
F¿meLßdTy³R–ßd
)

3499  
CachePŞicyRev®id©e
;

3501 ià(
	g»que¡
.
ÿchePŞicy
(è=ğ
R‘uºCacheD©aEl£Lßd
)

3502  
CachePŞicyAÎowSË
;

3504  
	gCachePŞicyV”ify
;

3507 
	gF¿meLßd”
::
checkLßdCom¶‘eFÜThisF¿me
()

3509 #ifdeà
SSLAB__DEBUG


3510 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

3513 
ASSERT
(
m_ş›Á
->
hasWebV›w
());

3515 
	gm_¡©e
) {

3516 
	gF¿meS‹ProvisiÚ®
: {

3517 ià(
m_d–eg©eIsHªdlšgProvisiÚ®LßdE¼Ü
)

3520 
	gRefPŒ
<
	gDocum’tLßd”
> 
	gpdl
 = 
m_´ovisiÚ®Docum’tLßd”
;

3521 ià(!
	gpdl
)

3525 cÚ¡ 
	gResourûE¼Ü
& 
	g”rÜ
 = 
pdl
->
mašDocum’tE¼Ü
();

3526 ià(
	g”rÜ
.
isNuÎ
())

3530 
	gRefPŒ
<
	gHi¡ÜyI‹m
> 
	g™em
;

3531 ià(
Page
* 
	g·ge
 = 
m_äame
->
·ge
())

3532 ià(
isBackFÜw¬dLßdTy³
(
lßdTy³
()è&& 
m_äame
 =ğ
·ge
->
mašF¿me
())

3533 
™em
 = 
hi¡Üy
()->
cu¼’tI‹m
();

3535 
boŞ
 
	gshouldRe£t
 = 
Œue
;

3536 ià(!(
	gpdl
->
isLßdšgInAPIS’£
(è&& !pdl->
isStİpšg
())) {

3537 
	gm_d–eg©eIsHªdlšgProvisiÚ®LßdE¼Ü
 = 
Œue
;

3538 
	gm_ş›Á
->
di¥©chDidFaProvisiÚ®Lßd
(
”rÜ
);

3539 
	gm_d–eg©eIsHªdlšgProvisiÚ®LßdE¼Ü
 = 
çl£
;

3544 
¡İLßdšgSubäames
();

3545 
	gpdl
->
¡İLßdšg
();

3548 ià(
isR•Ïcšg
(è&& !
	gm_docum’tLßd”
.
g‘
())

3549 
£tDocum’tLßd”
(
m_´ovisiÚ®Docum’tLßd”
.
g‘
());

3553 ià(
	gpdl
 =ğ
m_´ovisiÚ®Docum’tLßd”
)

3554 
ş—rProvisiÚ®Lßd
();

3555 ià(
aùiveDocum’tLßd”
()) {

3556 
KURL
 
	guÄ—chabËURL
 = 
aùiveDocum’tLßd”
()->
uÄ—chabËURL
();

3557 ià(!
	guÄ—chabËURL
.
isEm±y
(è&& uÄ—chabËURL =ğ
pdl
->
»que¡
().
u¾
())

3558 
shouldRe£t
 = 
çl£
;

3561 ià(
	gshouldRe£t
 && 
	g™em
)

3562 ià(
Page
* 
	g·ge
 = 
m_äame
->
·ge
()) {

3563 
·ge
->
backFÜw¬dLi¡
()->
goToI‹m
(
™em
.
g‘
());

3564 
S‘tšgs
* 
	g£‰šgs
 = 
m_äame
->
£‰šgs
();

3565 
	g·ge
->
£tGlob®Hi¡ÜyI‹m
((!
£‰šgs
 || s‘tšgs->
´iv©eBrowsšgEÇbËd
()è? 0 : 
™em
.
g‘
());

3570 
	gF¿meS‹Comm™‹dPage
: {

3571 
Docum’tLßd”
* 
dl
 = 
m_docum’tLßd”
.
g‘
();

3572 ià(!
	gdl
 || (dl->
isLßdšgInAPIS’£
(è&& !dl->
isStİpšg
()))

3575 
m¬kLßdCom¶‘e
();

3581 
	gm_ş›Á
->
fÜûLayoutFÜNÚHTML
();

3584 ià(
Page
* 
	g·ge
 = 
m_äame
->
·ge
())

3585 ià((
isBackFÜw¬dLßdTy³
(
m_lßdTy³
è|| m_lßdTy³ =ğ
F¿meLßdTy³R–ßd
 || m_lßdTy³ =ğ
F¿meLßdTy³R–ßdFromOrigš
è&& 
·ge
->
backFÜw¬dLi¡
())

3586 
hi¡Üy
()->
»¡ÜeSüŞlPos™iÚAndV›wS‹
();

3588 ià(
	gm_ü—tšgIn™ŸlEm±yDocum’t
 || !
	gm_comm™‹dFœ¡R—lDocum’tLßd
)

3591 cÚ¡ 
	gResourûE¼Ü
& 
	g”rÜ
 = 
dl
->
mašDocum’tE¼Ü
();

3592 #iâdeà
NDEBUG


3593 
	gm_didDi¥©chDidComm™Lßd
 = 
çl£
;

3595 ià(!
	g”rÜ
.
isNuÎ
())

3596 
	gm_ş›Á
->
di¥©chDidFaLßd
(
”rÜ
);

3598 
	gm_ş›Á
->
di¥©chDidFšishLßd
();

3600 ià(
Page
* 
	g·ge
 = 
m_äame
->
·ge
())

3601 
·ge
->
´og»ss
()->
´og»ssCom¶‘ed
(
m_äame
);

3605 
	gF¿meS‹Com¶‘e
:

3606 
äameLßdCom¶‘ed
();

3610 
ASSERT_NOT_REACHED
();

3613 
	gF¿meLßd”
::
cÚtšueLßdAá”WlSubm™FÜm
()

3615 #ifdeà
SSLAB__DEBUG


3616 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

3619 ià(!
	gm_´ovisiÚ®Docum’tLßd”
)

3623 
	gm_´ovisiÚ®Docum’tLßd”
->
´•¬eFÜLßdS¹
();

3627 ià(!
	gm_´ovisiÚ®Docum’tLßd”
)

3630 
Docum’tLßd”
* 
	gaùiveDocLßd”
 = 
aùiveDocum’tLßd”
();

3631 ià(
	gaùiveDocLßd”
 &&‡ùiveDocLßd”->
isLßdšgMašResourû
())

3634 
	gm_lßdšgFromCachedPage
 = 
çl£
;

3636 
	gid’tif›r
 = 0;

3638 ià(
Page
* 
	g·ge
 = 
m_äame
->
·ge
()) {

3639 
id’tif›r
 = 
·ge
->
´og»ss
()->
ü—‹UniqueId’tif›r
();

3640 
nÙif›r
()->
assignId’tif›rToIn™ŸlReque¡
(
id’tif›r
, 
m_´ovisiÚ®Docum’tLßd”
.
g‘
(), m_´ovisiÚ®Docum’tLßd”->
Üigš®Reque¡
());

3643 ià(!
	gm_´ovisiÚ®Docum’tLßd”
->
¡¬tLßdšgMašResourû
(
id’tif›r
))

3644 
	gm_´ovisiÚ®Docum’tLßd”
->
upd©eLßdšg
();

3647 
	gF¿meLßd”
::
didFœ¡Layout
()

3649 #ifdeà
SSLAB__DEBUG


3650 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

3653 ià(
Page
* 
	g·ge
 = 
m_äame
->
·ge
())

3654 ià(
isBackFÜw¬dLßdTy³
(
m_lßdTy³
è&& 
·ge
->
backFÜw¬dLi¡
())

3655 
hi¡Üy
()->
»¡ÜeSüŞlPos™iÚAndV›wS‹
();

3657 
	gm_fœ¡LayoutDÚe
 = 
Œue
;

3658 
	gm_ş›Á
->
di¥©chDidFœ¡Layout
();

3661 
	gF¿meLßd”
::
didFœ¡Visu®lyNÚEm±yLayout
()

3663 #ifdeà
SSLAB__DEBUG


3664 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

3667 
	gm_ş›Á
->
di¥©chDidFœ¡Visu®lyNÚEm±yLayout
();

3670 
	gF¿meLßd”
::
äameLßdCom¶‘ed
()

3672 #ifdeà
SSLAB__DEBUG


3673 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

3678 
	gm_ş›Á
->
äameLßdCom¶‘ed
();

3680 
hi¡Üy
()->
upd©eFÜF¿meLßdCom¶‘ed
();

3684 ià(
	gm_docum’tLßd”
)

3685 
	gm_fœ¡LayoutDÚe
 = 
Œue
;

3688 
boŞ
 
	gF¿meLßd”
::
fœ¡LayoutDÚe
() const

3690 #ifdeà
SSLAB__DEBUG


3691 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

3694  
	gm_fœ¡LayoutDÚe
;

3697 
	gF¿meLßd”
::
d‘achChd»n
()

3699 #ifdeà
SSLAB__DEBUG


3700 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

3704 
F¿me
* 
	g´evious
;

3705 
F¿me
* 
	gchd
 = 
m_äame
->
Œ“
()->
Ï¡Chd
(); chd; chd = 
´evious
) {

3706 
´evious
 = 
chd
->
Œ“
()->
´eviousSiblšg
();

3707 
	gchd
->
lßd”
()->
d‘achFromP¬’t
();

3711 
	gF¿meLßd”
::
şo£AndRemoveChd
(
F¿me
* 
chd
)

3713 #ifdeà
SSLAB__DEBUG


3714 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

3717 
	gchd
->
Œ“
()->
d‘achFromP¬’t
();

3719 
	gchd
->
£tV›w
(0);

3720 ià(
	gchd
->
owÃrEËm’t
(è&& chd->
·ge
())

3721 
	gchd
->
·ge
()->
deüem’tF¿meCouÁ
();

3722 
	gchd
->
·geDe¡royed
();

3724 
	gm_äame
->
Œ“
()->
»moveChd
(
chd
);

3727 
	gF¿meLßd”
::
»cursiveCheckLßdCom¶‘e
()

3729 #ifdeà
SSLAB__DEBUG


3730 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

3733 
	gVeùÜ
<
	gRefPŒ
<
	gF¿me
>, 10> 
	gäames
;

3735 
	gRefPŒ
<
	gF¿me
> 
	gäame
 = 
m_äame
->
Œ“
()->
fœ¡Chd
(); f¿me; f¿mğ
äame
->Œ“()->
ÃxtSiblšg
())

3736 
äames
.
­³nd
(
äame
);

3738 
	gsize
 = 
äames
.
size
();

3739 
	gi
 = 0; i < 
	gsize
; i++)

3740 
	gäames
[
i
]->
lßd”
()->
»cursiveCheckLßdCom¶‘e
();

3742 
checkLßdCom¶‘eFÜThisF¿me
();

3746 
	gF¿meLßd”
::
checkLßdCom¶‘e
()

3748 #ifdeà
SSLAB__DEBUG


3749 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

3752 
ASSERT
(
m_ş›Á
->
hasWebV›w
());

3754 
	gm_shouldC®lCheckLßdCom¶‘e
 = 
çl£
;

3758 ià(
Page
* 
	g·ge
 = 
m_äame
->
·ge
())

3759 
·ge
->
mašF¿me
()->
lßd”
()->
»cursiveCheckLßdCom¶‘e
();

3762 
	gF¿meLßd”
::
numP’dšgOrLßdšgReque¡s
(
boŞ
 
»cur£
) const

3764 #ifdeà
SSLAB__DEBUG


3765 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

3768 ià(!
	g»cur£
)

3769  
numReque¡s
(
m_äame
->
docum’t
());

3771 
	gcouÁ
 = 0;

3772 
F¿me
* 
	gäame
 = 
m_äame
; f¿me; f¿mğ
äame
->
Œ“
()->
Œav”£Next
(m_frame))

3773 
couÁ
 +ğ
numReque¡s
(
äame
->
docum’t
());

3774  
	gcouÁ
;

3777 
SŒšg
 
	gF¿meLßd”
::
u£rAg’t
(cÚ¡ 
KURL
& 
u¾
) const

3779 #ifdeà
SSLAB__DEBUG


3780 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

3783  
	gm_ş›Á
->
u£rAg’t
(
u¾
);

3786 
	gF¿meLßd”
::
tok’iz”Proûs£dD©a
()

3788 #ifdeà
SSLAB__DEBUG


3789 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

3792 
checkCom¶‘ed
();

3795 
	gF¿meLßd”
::
hªdËdOÆßdEv’ts
()

3797 #ifdeà
SSLAB__DEBUG


3798 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

3801 
	gm_ş›Á
->
di¥©chDidHªdËOÆßdEv’ts
();

3802 #ià
ENABLE
(
OFFLINE_WEB_APPLICATIONS
)

3803 ià(
docum’tLßd”
())

3804 
docum’tLßd”
()->
­¶iÿtiÚCacheHo¡
()->
¡İDeã¼šgEv’ts
();

3808 
	gF¿meLßd”
::
äameD‘ached
()

3810 #ifdeà
SSLAB__DEBUG


3811 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

3814 
¡İAÎLßd”s
();

3815 
	gm_äame
->
docum’t
()->
¡İAùiveDOMObjeùs
();

3816 
d‘achFromP¬’t
();

3819 
	gF¿meLßd”
::
d‘achFromP¬’t
()

3821 #ifdeà
SSLAB__DEBUG


3822 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

3825 
	gRefPŒ
<
	gF¿me
> 
´Ùeù
(
m_äame
);

3827 
şo£URL
();

3828 
¡İAÎLßd”s
();

3829 
hi¡Üy
()->
§veSüŞlPos™iÚAndV›wS‹ToI‹m
(hi¡Üy()->
cu¼’tI‹m
());

3830 
d‘achChd»n
();

3832 #ià
ENABLE
(
INSPECTOR
)

3833 ià(
Page
* 
	g·ge
 = 
m_äame
->
·ge
())

3834 
·ge
->
š¥eùÜCÚŒŞËr
()->
äameD‘achedFromP¬’t
(
m_äame
);

3837 
d‘achV›wsAndDocum’tLßd”
();

3839 ià(
F¿me
* 
	g·»Á
 = 
m_äame
->
Œ“
()->
·»Á
()) {

3840 
·»Á
->
lßd”
()->
şo£AndRemoveChd
(
m_äame
);

3841 
	g·»Á
->
lßd”
()->
scheduËCheckCom¶‘ed
();

3843 
	gm_äame
->
£tV›w
(0);

3844 
	gm_äame
->
·geDe¡royed
();

3848 
	gF¿meLßd”
::
d‘achV›wsAndDocum’tLßd”
()

3850 #ifdeà
SSLAB__DEBUG


3851 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

3854 
	gm_ş›Á
->
d‘achedFromP¬’t2
();

3855 
£tDocum’tLßd”
(0);

3856 
	gm_ş›Á
->
d‘achedFromP¬’t3
();

3859 
	gF¿meLßd”
::
addExŒaF›ldsToSub»sourûReque¡
(
ResourûReque¡
& 
»que¡
)

3861 #ifdeà
SSLAB__DEBUG


3862 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

3865 
addExŒaF›ldsToReque¡
(
»que¡
, 
m_lßdTy³
, 
çl£
, false);

3868 
	gF¿meLßd”
::
addExŒaF›ldsToMašResourûReque¡
(
ResourûReque¡
& 
»que¡
)

3870 #ifdeà
SSLAB__DEBUG


3871 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

3874 
addExŒaF›ldsToReque¡
(
»que¡
, 
m_lßdTy³
, 
Œue
, 
çl£
);

3877 
	gF¿meLßd”
::
addExŒaF›ldsToReque¡
(
ResourûReque¡
& 
»que¡
, 
F¿meLßdTy³
 
lßdTy³
, 
boŞ
 
mašResourû
, boŞ 
cook›PŞicyURLFromReque¡
)

3879 #ifdeà
SSLAB__DEBUG


3880 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

3885 ià(
	g»que¡
.
fœ¡P¬tyFÜCook›s
().
isEm±y
()) {

3886 ià(
	gmašResourû
 && (
isLßdšgMašF¿me
(è|| 
	gcook›PŞicyURLFromReque¡
))

3887 
	g»que¡
.
£tFœ¡P¬tyFÜCook›s
(
»que¡
.
u¾
());

3888 ià(
Docum’t
* 
	gdocum’t
 = 
m_äame
->
docum’t
())

3889 
»que¡
.
£tFœ¡P¬tyFÜCook›s
(
docum’t
->
fœ¡P¬tyFÜCook›s
());

3893 ià(!
	g»que¡
.
u¾
().
isEm±y
(è&& !»que¡.u¾().
´ÙocŞInHTTPFamy
())

3896 
­¶yU£rAg’t
(
»que¡
);

3898 ià(
	glßdTy³
 =ğ
F¿meLßdTy³R–ßd
) {

3899 
»que¡
.
£tCachePŞicy
(
R–ßdIgnÜšgCacheD©a
);

3900 
	g»que¡
.
£tHTTPH—d”F›ld
("Cache-Control", "max-age=0");

3901 } ià(
	glßdTy³
 =ğ
F¿meLßdTy³R–ßdFromOrigš
) {

3902 
»que¡
.
£tCachePŞicy
(
R–ßdIgnÜšgCacheD©a
);

3903 
	g»que¡
.
£tHTTPH—d”F›ld
("Cache-Control", "no-cache");

3904 
	g»que¡
.
£tHTTPH—d”F›ld
("Pragma", "no-cache");

3905 } ià(
isBackFÜw¬dLßdTy³
(
lßdTy³
è&& !
	g»que¡
.
u¾
().
´ÙocŞIs
("https"))

3906 
	g»que¡
.
£tCachePŞicy
(
R‘uºCacheD©aEl£Lßd
);

3908 ià(
	gmašResourû
)

3909 
	g»que¡
.
£tHTTPAcû±
(
deçuÉAcû±H—d”
);

3912 
addHTTPOrigšIfN“ded
(
»que¡
, 
SŒšg
());

3916 
S‘tšgs
* 
	g£‰šgs
 = 
m_äame
->
£‰šgs
();

3917 
	g»que¡
.
£tRe¥Ú£CÚ‹ÁDi¥os™iÚEncodšgF®lbackA¼ay
("UTF-8", 
m_URL
.
isEm±y
(è? 
m_’codšg
 : 
’codšg
(), 
£‰šgs
 ? s‘tšgs->
deçuÉTextEncodšgName
(è: 
SŒšg
());

3920 
	gF¿meLßd”
::
addHTTPOrigšIfN“ded
(
ResourûReque¡
& 
»que¡
, 
SŒšg
 
Üigš
)

3922 #ifdeà
SSLAB__DEBUG


3923 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

3926 ià(!
	g»que¡
.
h‰pOrigš
().
isEm±y
())

3935 ià(
	g»que¡
.
h‰pM‘hod
(è=ğ"GET" || 
»que¡
.httpMethod() == "HEAD")

3941 ià(
	gÜigš
.
isEm±y
()) {

3944 
	gÜigš
 = 
Secur™yOrigš
::
ü—‹Em±y
()->
toSŒšg
();

3947 
	g»que¡
.
£tHTTPOrigš
(
Üigš
);

3950 
	gF¿meLßd”
::
comm™‹dLßd
(
Docum’tLßd”
* 
lßd”
, cÚ¡ * 
d©a
, 
Ëngth
)

3952 #ifdeà
SSLAB__DEBUG


3953 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

3956 ià(
	gArchiveFaùÜy
::
isArchiveMimeTy³
(
lßd”
->
»¥Ú£
().
mimeTy³
()))

3958 
	gm_ş›Á
->
comm™‹dLßd
(
lßd”
, 
d©a
, 
Ëngth
);

3961 
	gF¿meLßd”
::
lßdPo¡Reque¡
(cÚ¡ 
ResourûReque¡
& 
šReque¡
, cÚ¡ 
SŒšg
& 
»ã¼”
, cÚ¡ SŒšg& 
äameName
, 
boŞ
 
lockHi¡Üy
, 
F¿meLßdTy³
 
lßdTy³
, 
PassRefPŒ
<
Ev’t
> 
ev’t
, PassRefPŒ<
FÜmS‹
> 
´pFÜmS‹
)

3963 #ifdeà
SSLAB__DEBUG


3964 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

3967 
	gRefPŒ
<
	gFÜmS‹
> 
	gfÜmS‹
 = 
´pFÜmS‹
;

3979 cÚ¡ 
	gKURL
& 
	gu¾
 = 
šReque¡
.
u¾
();

3980 
	gRefPŒ
<
	gFÜmD©a
> 
	gfÜmD©a
 = 
šReque¡
.
h‰pBody
();

3981 cÚ¡ 
	gSŒšg
& 
	gcÚ‹ÁTy³
 = 
šReque¡
.
h‰pCÚ‹ÁTy³
();

3982 
SŒšg
 
	gÜigš
 = 
šReque¡
.
h‰pOrigš
();

3984 
ResourûReque¡
 
wÜkšgResourûReque¡
(
u¾
);

3986 ià(!
	g»ã¼”
.
isEm±y
())

3987 
	gwÜkšgResourûReque¡
.
£tHTTPReã¼”
(
»ã¼”
);

3988 
	gwÜkšgResourûReque¡
.
£tHTTPOrigš
(
Üigš
);

3989 
	gwÜkšgResourûReque¡
.
£tHTTPM‘hod
("POST");

3990 
	gwÜkšgResourûReque¡
.
£tHTTPBody
(
fÜmD©a
);

3991 
	gwÜkšgResourûReque¡
.
£tHTTPCÚ‹ÁTy³
(
cÚ‹ÁTy³
);

3992 
addExŒaF›ldsToReque¡
(
wÜkšgResourûReque¡
, 
lßdTy³
, 
Œue
,rue);

3994 
Navig©iÚAùiÚ
 
aùiÚ
(
u¾
, 
lßdTy³
, 
Œue
, 
ev’t
);

3996 ià(!
	gäameName
.
isEm±y
()) {

3998 ià(
F¿me
* 
	grg‘F¿me
 = 
fÜmS‹
 ? 0 : 
fšdF¿meFÜNavig©iÚ
(
äameName
))

3999 
rg‘F¿me
->
lßd”
()->
lßdW™hNavig©iÚAùiÚ
(
wÜkšgResourûReque¡
, 
aùiÚ
, 
lockHi¡Üy
, 
lßdTy³
, 
fÜmS‹
.
»Ëa£
());

4001 
pŞicyCheck”
()->
checkNewWšdowPŞicy
(
aùiÚ
, 
F¿meLßd”
::
ÿÎCÚtšueLßdAá”NewWšdowPŞicy
, 
wÜkšgResourûReque¡
, 
fÜmS‹
.
»Ëa£
(), 
äameName
, 
this
);

4003 
lßdW™hNavig©iÚAùiÚ
(
wÜkšgResourûReque¡
, 
aùiÚ
, 
lockHi¡Üy
, 
lßdTy³
, 
fÜmS‹
.
»Ëa£
());

4006 
	gF¿meLßd”
::
lßdResourûSynchrÚou¦y
(cÚ¡ 
ResourûReque¡
& 
»que¡
, 
StÜedC»d’tŸls
 
¡ÜedC»d’tŸls
, 
ResourûE¼Ü
& 
”rÜ
, 
ResourûRe¥Ú£
& 
»¥Ú£
, 
VeùÜ
<>& 
d©a
)

4008 #ifdeà
SSLAB__DEBUG


4009 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

4012 
SŒšg
 
	g»ã¼”
 = 
m_outgošgReã¼”
;

4013 ià(
	gSecur™yOrigš
::
shouldHideReã¼”
(
»que¡
.
u¾
(), 
»ã¼”
))

4014 
	g»ã¼”
 = 
SŒšg
();

4016 
ResourûReque¡
 
	gš™ŸlReque¡
 = 
»que¡
;

4017 
	gš™ŸlReque¡
.
£tTimeoutIÁ”v®
(10);

4025 ià(
	gš™ŸlReque¡
.
isCÚd™iÚ®
())

4026 
	gš™ŸlReque¡
.
£tCachePŞicy
(
R–ßdIgnÜšgCacheD©a
);

4028 
	gš™ŸlReque¡
.
£tCachePŞicy
(
Üigš®Reque¡
().
ÿchePŞicy
());

4030 ià(!
	g»ã¼”
.
isEm±y
())

4031 
	gš™ŸlReque¡
.
£tHTTPReã¼”
(
»ã¼”
);

4032 
addHTTPOrigšIfN“ded
(
š™ŸlReque¡
, 
outgošgOrigš
());

4034 ià(
Page
* 
	g·ge
 = 
m_äame
->
·ge
())

4035 
š™ŸlReque¡
.
£tFœ¡P¬tyFÜCook›s
(
·ge
->
mašF¿me
()->
lßd”
()->
docum’tLßd”
()->
»que¡
().
u¾
());

4036 
	gš™ŸlReque¡
.
£tHTTPU£rAg’t
(
ş›Á
()->
u£rAg’t
(
»que¡
.
u¾
()));

4038 
	gid’tif›r
 = 0;

4039 
ResourûReque¡
 
ÃwReque¡
(
š™ŸlReque¡
);

4040 
»que¡FromD–eg©e
(
ÃwReque¡
, 
id’tif›r
, 
”rÜ
);

4042 ià(
	g”rÜ
.
isNuÎ
()) {

4043 
ASSERT
(!
ÃwReque¡
.
isNuÎ
());

4045 #ià
ENABLE
(
OFFLINE_WEB_APPLICATIONS
)

4046 ià(!
docum’tLßd”
()->
­¶iÿtiÚCacheHo¡
()->
maybeLßdSynchrÚou¦y
(
ÃwReque¡
, 
”rÜ
, 
»¥Ú£
, 
d©a
)) {

4048 
	gResourûHªdË
::
lßdResourûSynchrÚou¦y
(
ÃwReque¡
, 
¡ÜedC»d’tŸls
, 
”rÜ
, 
»¥Ú£
, 
d©a
, 
m_äame
);

4049 #ià
ENABLE
(
OFFLINE_WEB_APPLICATIONS
)

4050 
docum’tLßd”
()->
­¶iÿtiÚCacheHo¡
()->
maybeLßdF®lbackSynchrÚou¦y
(
ÃwReque¡
, 
”rÜ
, 
»¥Ú£
, 
d©a
);

4055 
nÙif›r
()->
£ndRemaššgD–eg©eMes§ges
(
m_docum’tLßd”
.
g‘
(), 
id’tif›r
, 
»¥Ú£
, 
d©a
.
size
(), 
”rÜ
);

4056  
	gid’tif›r
;

4059 cÚ¡ 
	gResourûReque¡
& 
	gF¿meLßd”
::
Üigš®Reque¡
() const

4061 #ifdeà
SSLAB__DEBUG


4062 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

4065  
aùiveDocum’tLßd”
()->
Üigš®Reque¡Cİy
();

4068 
	gF¿meLßd”
::
»ûivedMašResourûE¼Ü
(cÚ¡ 
ResourûE¼Ü
& 
”rÜ
, 
boŞ
 
isCom¶‘e
)

4070 #ifdeà
SSLAB__DEBUG


4071 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

4075 
	gRefPŒ
<
	gF¿me
> 
´Ùeù
(
m_äame
);

4077 
	gRefPŒ
<
	gDocum’tLßd”
> 
	glßd”
 = 
aùiveDocum’tLßd”
();

4079 ià(
	gisCom¶‘e
) {

4082 
¡İ
();

4083 ià(
	gm_ş›Á
->
shouldF®lBack
(
”rÜ
))

4084 
hªdËF®lbackCÚ‹Á
();

4087 ià(
	gm_¡©e
 =ğ
F¿meS‹ProvisiÚ®
 && 
m_´ovisiÚ®Docum’tLßd”
) {

4088 ià(
m_subm™‹dFÜmURL
 =ğ
m_´ovisiÚ®Docum’tLßd”
->
Üigš®Reque¡Cİy
().
u¾
())

4089 
m_subm™‹dFÜmURL
 = 
KURL
();

4094 
hi¡Üy
()->
šv®id©eCu¼’tI‹mCachedPage
();

4101 ià(
	gm_£ÁRedœeùNÙifiÿtiÚ
)

4102 
ş›ÁRedœeùCªûÎedOrFšished
(
çl£
);

4105 
	glßd”
->
mašReûivedE¼Ü
(
”rÜ
, 
isCom¶‘e
);

4108 
	gF¿meLßd”
::
ÿÎCÚtšueF¿gm’tSüŞlAá”Navig©iÚPŞicy
(* 
¬gum’t
,

4109 cÚ¡ 
ResourûReque¡
& 
»que¡
, 
PassRefPŒ
<
FÜmS‹
>, 
boŞ
 
shouldCÚtšue
)

4111 #ifdeà
SSLAB__DEBUG


4112 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

4115 
F¿meLßd”
* 
	glßd”
 = 
¡©ic_ÿ¡
<F¿meLßd”*>(
¬gum’t
);

4116 
	glßd”
->
cÚtšueF¿gm’tSüŞlAá”Navig©iÚPŞicy
(
»que¡
, 
shouldCÚtšue
);

4119 
	gF¿meLßd”
::
cÚtšueF¿gm’tSüŞlAá”Navig©iÚPŞicy
(cÚ¡ 
ResourûReque¡
& 
»que¡
, 
boŞ
 
shouldCÚtšue
)

4121 #ifdeà
SSLAB__DEBUG


4122 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

4125 
	gm_quickRedœeùComšg
 = 
çl£
;

4127 ià(!
	gshouldCÚtšue
)

4130 
boŞ
 
	gisRedœeù
 = 
m_quickRedœeùComšg
 || 
pŞicyCheck”
()->
lßdTy³
(è=ğ
F¿meLßdTy³RedœeùW™hLockedBackFÜw¬dLi¡
;

4131 
lßdInSameDocum’t
(
»que¡
.
u¾
(), 0, !
isRedœeù
);

4134 
boŞ
 
	gF¿meLßd”
::
shouldSüŞlToAnchÜ
(boŞ 
isFÜmSubmissiÚ
, 
F¿meLßdTy³
 
lßdTy³
, cÚ¡ 
KURL
& 
u¾
)

4136 #ifdeà
SSLAB__DEBUG


4137 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

4148  !
	gisFÜmSubmissiÚ


4149 && 
	glßdTy³
 !ğ
F¿meLßdTy³R–ßd


4150 && 
lßdTy³
 !ğ
F¿meLßdTy³R–ßdFromOrigš


4151 && 
lßdTy³
 !ğ
F¿meLßdTy³Same


4152 && !
shouldR–ßd
(
this
->
u¾
(), url)

4155 && !
	gm_äame
->
docum’t
()->
isF¿meS‘
();

4158 
	gF¿meLßd”
::
ÿÎCÚtšueLßdAá”Navig©iÚPŞicy
(* 
¬gum’t
,

4159 cÚ¡ 
ResourûReque¡
& 
»que¡
, 
PassRefPŒ
<
FÜmS‹
> 
fÜmS‹
, 
boŞ
 
shouldCÚtšue
)

4161 #ifdeà
SSLAB__DEBUG


4162 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

4165 
F¿meLßd”
* 
	glßd”
 = 
¡©ic_ÿ¡
<F¿meLßd”*>(
¬gum’t
);

4166 
	glßd”
->
cÚtšueLßdAá”Navig©iÚPŞicy
(
»que¡
, 
fÜmS‹
, 
shouldCÚtšue
);

4169 
	gF¿meLßd”
::
cÚtšueLßdAá”Navig©iÚPŞicy
(cÚ¡ 
ResourûReque¡
&, 
PassRefPŒ
<
FÜmS‹
> 
fÜmS‹
, 
boŞ
 
shouldCÚtšue
)

4171 #ifdeà
SSLAB__DEBUG


4172 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

4178 
ASSERT
(
m_pŞicyDocum’tLßd”
 || !
m_´ovisiÚ®Docum’tLßd”
->
uÄ—chabËURL
().
isEm±y
());

4180 
boŞ
 
	gisT¬g‘I‹m
 = 
hi¡Üy
()->
´ovisiÚ®I‹m
(è? hi¡Üy()->´ovisiÚ®I‹m()->
isT¬g‘I‹m
(è: 
çl£
;

4187 
boŞ
 
	gÿnCÚtšue
 = 
shouldCÚtšue
 && (!
isLßdšgMašF¿me
(è|| 
m_äame
->
shouldClo£
());

4189 ià(!
	gÿnCÚtšue
) {

4192 ià(
	gm_quickRedœeùComšg
)

4193 
ş›ÁRedœeùCªûÎedOrFšished
(
çl£
);

4195 
£tPŞicyDocum’tLßd”
(0);

4200 ià((
	gisT¬g‘I‹m
 || 
isLßdšgMašF¿me
()è&& 
isBackFÜw¬dLßdTy³
(
pŞicyCheck”
()->
lßdTy³
()))

4201 ià(
Page
* 
	g·ge
 = 
m_äame
->
·ge
()) {

4202 
F¿me
* 
mašF¿me
 = 
·ge
->mainFrame();

4203 ià(
Hi¡ÜyI‹m
* 
	g»£tI‹m
 = 
mašF¿me
->
lßd”
()->
hi¡Üy
()->
cu¼’tI‹m
()) {

4204 
·ge
->
backFÜw¬dLi¡
()->
goToI‹m
(
»£tI‹m
);

4205 
S‘tšgs
* 
	g£‰šgs
 = 
m_äame
->
£‰šgs
();

4206 
	g·ge
->
£tGlob®Hi¡ÜyI‹m
((!
£‰šgs
 || s‘tšgs->
´iv©eBrowsšgEÇbËd
()è? 0 : 
»£tI‹m
);

4212 
F¿meLßdTy³
 
	gty³
 = 
pŞicyCheck”
()->
lßdTy³
();

4213 
¡İAÎLßd”s
();

4217 ià(!
	gm_äame
->
·ge
())

4220 #ià
ENABLE
(
JAVASCRIPT_DEBUGGER
è&& ENABLE(
INSPECTOR
è&& 
USE
(
JSC
)

4221 ià(
Page
* 
	g·ge
 = 
m_äame
->
·ge
()) {

4222 ià(
·ge
->
mašF¿me
(è=ğ
m_äame
)

4223 
·ge
->
š¥eùÜCÚŒŞËr
()->
»sumeDebugg”
();

4227 
£tProvisiÚ®Docum’tLßd”
(
m_pŞicyDocum’tLßd”
.
g‘
());

4228 
	gm_lßdTy³
 = 
ty³
;

4229 
£tS‹
(
F¿meS‹ProvisiÚ®
);

4231 
£tPŞicyDocum’tLßd”
(0);

4233 ià(
isBackFÜw¬dLßdTy³
(
ty³
è&& 
lßdProvisiÚ®I‹mFromCachedPage
())

4236 ià(
	gfÜmS‹
)

4237 
	gm_ş›Á
->
di¥©chWlSubm™FÜm
(&
PŞicyCheck”
::
cÚtšueLßdAá”WlSubm™FÜm
, 
fÜmS‹
);

4239 
cÚtšueLßdAá”WlSubm™FÜm
();

4242 
	gF¿meLßd”
::
ÿÎCÚtšueLßdAá”NewWšdowPŞicy
(* 
¬gum’t
,

4243 cÚ¡ 
ResourûReque¡
& 
»que¡
, 
PassRefPŒ
<
FÜmS‹
> 
fÜmS‹
, cÚ¡ 
SŒšg
& 
äameName
, 
boŞ
 
shouldCÚtšue
)

4245 #ifdeà
SSLAB__DEBUG


4246 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

4249 
F¿meLßd”
* 
	glßd”
 = 
¡©ic_ÿ¡
<F¿meLßd”*>(
¬gum’t
);

4250 
	glßd”
->
cÚtšueLßdAá”NewWšdowPŞicy
(
»que¡
, 
fÜmS‹
, 
äameName
, 
shouldCÚtšue
);

4253 
	gF¿meLßd”
::
cÚtšueLßdAá”NewWšdowPŞicy
(cÚ¡ 
ResourûReque¡
& 
»que¡
,

4254 
PassRefPŒ
<
FÜmS‹
> 
fÜmS‹
, cÚ¡ 
SŒšg
& 
äameName
, 
boŞ
 
shouldCÚtšue
)

4256 #ifdeà
SSLAB__DEBUG


4257 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

4260 ià(!
	gshouldCÚtšue
)

4263 
	gRefPŒ
<
	gF¿me
> 
	gäame
 = 
m_äame
;

4264 
	gRefPŒ
<
	gF¿me
> 
	gmašF¿me
 = 
m_ş›Á
->
di¥©chC»©ePage
();

4265 ià(!
	gmašF¿me
)

4268 ià(
	gäameName
 != "_blank")

4269 
mašF¿me
->
Œ“
()->
£tName
(
äameName
);

4271 
	gmašF¿me
->
·ge
()->
£tO³ÃdByDOM
();

4272 
	gmašF¿me
->
lßd”
()->
	gm_ş›Á
->
di¥©chShow
();

4273 ià(!
	gm_suµ»ssO³ÃrInNewF¿me
)

4274 
	gmašF¿me
->
lßd”
()->
£tO³Ãr
(
äame
.
g‘
());

4275 
	gmašF¿me
->
lßd”
()->
lßdW™hNavig©iÚAùiÚ
(
»que¡
, 
Navig©iÚAùiÚ
(), 
çl£
, 
F¿meLßdTy³Snd¬d
, 
fÜmS‹
);

4278 
	gF¿meLßd”
::
»que¡FromD–eg©e
(
ResourûReque¡
& 
»que¡
, & 
id’tif›r
, 
ResourûE¼Ü
& 
”rÜ
)

4280 #ifdeà
SSLAB__DEBUG


4281 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

4284 
ASSERT
(!
»que¡
.
isNuÎ
());

4286 
	gid’tif›r
 = 0;

4287 ià(
Page
* 
	g·ge
 = 
m_äame
->
·ge
()) {

4288 
id’tif›r
 = 
·ge
->
´og»ss
()->
ü—‹UniqueId’tif›r
();

4289 
nÙif›r
()->
assignId’tif›rToIn™ŸlReque¡
(
id’tif›r
, 
m_docum’tLßd”
.
g‘
(), 
»que¡
);

4292 
ResourûReque¡
 
ÃwReque¡
(
»que¡
);

4293 
nÙif›r
()->
di¥©chWlS’dReque¡
(
m_docum’tLßd”
.
g‘
(), 
id’tif›r
, 
ÃwReque¡
, 
ResourûRe¥Ú£
());

4295 ià(
	gÃwReque¡
.
isNuÎ
())

4296 
	g”rÜ
 = 
ÿnûÎedE¼Ü
(
»que¡
);

4298 
	g”rÜ
 = 
ResourûE¼Ü
();

4300 
	g»que¡
 = 
ÃwReque¡
;

4303 
	gF¿meLßd”
::
lßdedResourûFromMemÜyCache
(cÚ¡ 
CachedResourû
* 
»sourû
)

4305 #ifdeà
SSLAB__DEBUG


4306 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

4309 
Page
* 
	g·ge
 = 
m_äame
->
·ge
();

4310 ià(!
	g·ge
)

4313 #ià
ENABLE
(
INSPECTOR
)

4314 
	g·ge
->
š¥eùÜCÚŒŞËr
()->
didLßdResourûFromMemÜyCache
(
m_docum’tLßd”
.
g‘
(), 
»sourû
);

4317 ià(!
	g»sourû
->
£ndResourûLßdC®lbacks
(è|| 
	gm_docum’tLßd”
->
haveTŞdCl›ÁAboutLßd
(
»sourû
->
u¾
()))

4320 ià(!
	g·ge
->
¬eMemÜyCacheCl›ÁC®lsEÇbËd
()) {

4321 
	gm_docum’tLßd”
->
»cÜdMemÜyCacheLßdFÜFutu»Cl›ÁNÙifiÿtiÚ
(
»sourû
->
u¾
());

4322 
	gm_docum’tLßd”
->
didT–lCl›ÁAboutLßd
(
»sourû
->
u¾
());

4326 
ResourûReque¡
 
»que¡
(
»sourû
->
u¾
());

4327 ià(
	gm_ş›Á
->
di¥©chDidLßdResourûFromMemÜyCache
(
m_docum’tLßd”
.
g‘
(), 
»que¡
, 
»sourû
->
»¥Ú£
(),„esourû->
’codedSize
())) {

4328 
	gm_docum’tLßd”
->
didT–lCl›ÁAboutLßd
(
»sourû
->
u¾
());

4332 
	gid’tif›r
;

4333 
ResourûE¼Ü
 
	g”rÜ
;

4334 
»que¡FromD–eg©e
(
»que¡
, 
id’tif›r
, 
”rÜ
);

4335 
nÙif›r
()->
£ndRemaššgD–eg©eMes§ges
(
m_docum’tLßd”
.
g‘
(), 
id’tif›r
, 
»sourû
->
»¥Ú£
(),„esourû->
’codedSize
(), 
”rÜ
);

4338 
	gF¿meLßd”
::
­¶yU£rAg’t
(
ResourûReque¡
& 
»que¡
)

4340 #ifdeà
SSLAB__DEBUG


4341 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

4344 
SŒšg
 
	gu£rAg’t
 = 
ş›Á
()->
u£rAg’t
(
»que¡
.
u¾
());

4345 
ASSERT
(!
u£rAg’t
.
isNuÎ
());

4346 
	g»que¡
.
£tHTTPU£rAg’t
(
u£rAg’t
);

4349 
boŞ
 
	gF¿meLßd”
::
shouldIÁ”ru±LßdFÜXF¿meO±iÚs
(cÚ¡ 
SŒšg
& 
cÚ‹Á
, cÚ¡ 
KURL
& 
u¾
)

4351 #ifdeà
SSLAB__DEBUG


4352 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

4355 
F¿me
* 
	gtİF¿me
 = 
m_äame
->
Œ“
()->
tİ
();

4356 ià(
	gm_äame
 =ğ
tİF¿me
)

4357  
çl£
;

4359 ià(
equ®IgnÜšgCa£
(
cÚ‹Á
, "deny"))

4360  
	gŒue
;

4362 ià(
equ®IgnÜšgCa£
(
cÚ‹Á
, "sameorigin")) {

4363 
	gRefPŒ
<
	gSecur™yOrigš
> 
	gÜigš
 = 
Secur™yOrigš
::
ü—‹
(
u¾
);

4364 ià(!
	gÜigš
->
isSameSchemeHo¡PÜt
(
tİF¿me
->
docum’t
()->
£cur™yOrigš
()))

4365  
	gŒue
;

4368  
	gçl£
;

4371 
boŞ
 
	gF¿meLßd”
::
lßdProvisiÚ®I‹mFromCachedPage
()

4373 #ifdeà
SSLAB__DEBUG


4374 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

4377 
	gRefPŒ
<
	gCachedPage
> 
	gÿchedPage
 = 
·geCache
()->
g‘
(
hi¡Üy
()->
´ovisiÚ®I‹m
());

4378 ià(!
	gÿchedPage
 || !ÿchedPage->
docum’t
())

4379  
	gçl£
;

4381 
Docum’tLßd”
 *
	g´ovisiÚ®Lßd”
 = 
´ovisiÚ®Docum’tLßd”
();

4382 
LOG
(
PageCache
, "WebCÜePageCache: F¿meLßd” %°lßdšg…rovisiÚ® Docum’tLßd” %°w™h URL '%s' from CachedPag%p", 
this
, 
´ovisiÚ®Lßd”
,…rovisiÚ®Lßd”->
u¾
().
¡ršg
().
utf8
().
d©a
(), 
ÿchedPage
.
g‘
());

4384 
	g´ovisiÚ®Lßd”
->
´•¬eFÜLßdS¹
();

4386 
	gm_lßdšgFromCachedPage
 = 
Œue
;

4388 
	g´ovisiÚ®Lßd”
->
£tComm™‹d
(
Œue
);

4389 
comm™ProvisiÚ®Lßd
(
ÿchedPage
);

4391  
	gŒue
;

4394 
	gF¿meLßd”
::
ÿchePageFÜHi¡ÜyI‹m
(
Hi¡ÜyI‹m
* 
™em
)

4396 #ifdeà
SSLAB__DEBUG


4397 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

4400 ià(!
ÿnCachePage
(è|| 
	g™em
->
isInPageCache
())

4403 
·geHidd’
();

4405 ià(
Page
* 
	g·ge
 = 
m_äame
->
·ge
()) {

4406 
RefPŒ
<
CachedPage
> 
ÿchedPage
 = CachedPage::
ü—‹
(
·ge
);

4407 
·geCache
()->
add
(
™em
, 
ÿchedPage
.
»Ëa£
());

4411 
	gF¿meLßd”
::
·geHidd’
()

4413 #ifdeà
SSLAB__DEBUG


4414 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

4417 
	gm_uÆßdEv’tBešgDi¥©ched
 = 
Œue
;

4418 ià(
	gm_äame
->
domWšdow
())

4419 
	gm_äame
->
domWšdow
()->
di¥©chEv’t
(
PageT¿ns™iÚEv’t
::
ü—‹
(
ev’tNames
().
·gehideEv’t
, 
Œue
), 
m_äame
->
docum’t
());

4420 
	gm_uÆßdEv’tBešgDi¥©ched
 = 
çl£
;

4423 
F¿me
* 
	gchd
 = 
m_äame
->
Œ“
()->
fœ¡Chd
(); chd; chd = 
chd
->Œ“()->
ÃxtSiblšg
())

4424 
chd
->
lßd”
()->
·geHidd’
();

4427 
boŞ
 
	gF¿meLßd”
::
shouldT»©URLAsSameAsCu¼’t
(cÚ¡ 
KURL
& 
u¾
) const

4429 #ifdeà
SSLAB__DEBUG


4430 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

4433 ià(!
hi¡Üy
()->
cu¼’tI‹m
())

4434  
	gçl£
;

4435  
	gu¾
 =ğ
hi¡Üy
()->
cu¼’tI‹m
()->
u¾
(è|| u¾ =ğhi¡Üy()->cu¼’tI‹m()->
Üigš®URL
();

4438 
	gF¿meLßd”
::
checkDidP”fÜmFœ¡Navig©iÚ
()

4440 #ifdeà
SSLAB__DEBUG


4441 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

4444 
Page
* 
	g·ge
 = 
m_äame
->
·ge
();

4445 ià(!
	g·ge
)

4448 ià(!
	gm_didP”fÜmFœ¡Navig©iÚ
 && 
	g·ge
->
backFÜw¬dLi¡
()->
’Œ›s
().
size
() == 1) {

4449 
m_didP”fÜmFœ¡Navig©iÚ
 = 
Œue
;

4450 
	gm_ş›Á
->
didP”fÜmFœ¡Navig©iÚ
();

4454 
F¿me
* 
	gF¿meLßd”
::
fšdF¿meFÜNavig©iÚ
(cÚ¡ 
AtomicSŒšg
& 
Çme
)

4456 #ifdeà
SSLAB__DEBUG


4457 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

4460 
F¿me
* 
	gäame
 = 
m_äame
->
Œ“
()->
fšd
(
Çme
);

4461 ià(!
shouldAÎowNavig©iÚ
(
äame
))

4463  
	gäame
;

4466 
	gF¿meLßd”
::
Çvig©eW™hšDocum’t
(
Hi¡ÜyI‹m
* 
™em
)

4468 #ifdeà
SSLAB__DEBUG


4469 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

4472 
ASSERT
(
™em
->
docum’tSequ’ûNumb”
(è=ğ
hi¡Üy
()->
cu¼’tI‹m
()->documentSequenceNumber());

4476 
hi¡Üy
()->
§veSüŞlPos™iÚAndV›wS‹ToI‹m
(hi¡Üy()->
cu¼’tI‹m
());

4477 ià(
F¿meV›w
* 
	gv›w
 = 
m_äame
->
v›w
())

4478 
v›w
->
£tWasSüŞËdByU£r
(
çl£
);

4480 
hi¡Üy
()->
£tCu¼’tI‹m
(
™em
);

4483 
lßdInSameDocum’t
(
™em
->
u¾
(), i‹m->
¡©eObjeù
(), 
çl£
);

4486 
hi¡Üy
()->
»¡ÜeSüŞlPos™iÚAndV›wS‹
();

4492 
	gF¿meLßd”
::
Çvig©eToDifã»ÁDocum’t
(
Hi¡ÜyI‹m
* 
™em
, 
F¿meLßdTy³
 
lßdTy³
)

4494 #ifdeà
SSLAB__DEBUG


4495 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

4499 
hi¡Üy
()->
£tProvisiÚ®I‹m
(
™em
);

4504 ià(
	gRefPŒ
<
	gCachedPage
> 
	gÿchedPage
 = 
·geCache
()->
g‘
(
™em
)) {

4508 ià(
cu¼’tTime
(è- 
ÿchedPage
->
timeSmp
() <= 1800) {

4509 
lßdW™hDocum’tLßd”
(
ÿchedPage
->
docum’tLßd”
(), 
lßdTy³
, 0);

4513 
LOG
(
PageCache
, "NÙ„e¡Üšg…agfÜ % äom back/fÜw¬d cachbeÿu£ cach’Œy ha expœed", 
hi¡Üy
()->
´ovisiÚ®I‹m
()->
u¾
().
¡ršg
().
ascii
().
d©a
());

4514 
·geCache
()->
»move
(
™em
);

4517 
KURL
 
	g™emURL
 = 
™em
->
u¾
();

4518 
KURL
 
	g™emOrigš®URL
 = 
™em
->
Üigš®URL
();

4519 
KURL
 
	gcu¼’tURL
;

4520 ià(
docum’tLßd”
())

4521 
	gcu¼’tURL
 = 
docum’tLßd”
()->
u¾
();

4522 
	gRefPŒ
<
	gFÜmD©a
> 
	gfÜmD©a
 = 
™em
->
fÜmD©a
();

4524 
boŞ
 
	gaddedExŒaF›lds
 = 
çl£
;

4525 
ResourûReque¡
 
»que¡
(
™emURL
);

4527 ià(!
	g™em
->
»ã¼”
().
isNuÎ
())

4528 
	g»que¡
.
£tHTTPReã¼”
(
™em
->
»ã¼”
());

4531 
Navig©iÚAùiÚ
 
	gaùiÚ
;

4532 ià(
	gfÜmD©a
) {

4533 
	gfÜmD©a
->
g’”©eFes
(
m_äame
->
·ge
()->
chrome
()->
ş›Á
());

4535 
	g»que¡
.
£tHTTPM‘hod
("POST");

4536 
	g»que¡
.
£tHTTPBody
(
fÜmD©a
);

4537 
	g»que¡
.
£tHTTPCÚ‹ÁTy³
(
™em
->
fÜmCÚ‹ÁTy³
());

4538 
	gRefPŒ
<
	gSecur™yOrigš
> 
	g£cur™yOrigš
 = 
Secur™yOrigš
::
ü—‹FromSŒšg
(
™em
->
»ã¼”
());

4539 
addHTTPOrigšIfN“ded
(
»que¡
, 
£cur™yOrigš
->
toSŒšg
());

4543 
addExŒaF›ldsToReque¡
(
»que¡
, 
m_lßdTy³
, 
Œue
, 
fÜmD©a
);

4544 
	gaddedExŒaF›lds
 = 
Œue
;

4554 ià(
	gResourûHªdË
::
wlLßdFromCache
(
»que¡
, 
m_äame
))

4555 
	gaùiÚ
 = 
Navig©iÚAùiÚ
(
™emURL
, 
lßdTy³
, 
çl£
);

4557 
	g»que¡
.
£tCachePŞicy
(
R–ßdIgnÜšgCacheD©a
);

4558 
	gaùiÚ
 = 
Navig©iÚAùiÚ
(
™emURL
, 
Navig©iÚTy³FÜmResubm™‹d
);

4561 
	glßdTy³
) {

4562 
	gF¿meLßdTy³R–ßd
:

4563 
F¿meLßdTy³R–ßdFromOrigš
:

4564 
»que¡
.
£tCachePŞicy
(
R–ßdIgnÜšgCacheD©a
);

4566 
	gF¿meLßdTy³Back
:

4567 
F¿meLßdTy³BackWMLDeckNÙAcûssibË
:

4568 
F¿meLßdTy³FÜw¬d
:

4569 
F¿meLßdTy³IndexedBackFÜw¬d
:

4570 ià(!
™emURL
.
´ÙocŞIs
("https"))

4571 
»que¡
.
£tCachePŞicy
(
R‘uºCacheD©aEl£Lßd
);

4573 
	gF¿meLßdTy³Snd¬d
:

4574 
F¿meLßdTy³RedœeùW™hLockedBackFÜw¬dLi¡
:

4576 
	gF¿meLßdTy³Same
:

4578 
ASSERT_NOT_REACHED
();

4581 
	gaùiÚ
 = 
Navig©iÚAùiÚ
(
™emOrigš®URL
, 
lßdTy³
, 
çl£
);

4584 ià(!
	gaddedExŒaF›lds
)

4585 
addExŒaF›ldsToReque¡
(
»que¡
, 
m_lßdTy³
, 
Œue
, 
fÜmD©a
);

4587 
lßdW™hNavig©iÚAùiÚ
(
»que¡
, 
aùiÚ
, 
çl£
, 
lßdTy³
, 0);

4591 
	gF¿meLßd”
::
lßdI‹m
(
Hi¡ÜyI‹m
* 
™em
, 
F¿meLßdTy³
 
lßdTy³
)

4593 #ifdeà
SSLAB__DEBUG


4594 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

4602 
Hi¡ÜyI‹m
* 
	gcu¼’tI‹m
 = 
hi¡Üy
()->
cu¼’tI‹m
();

4603 
boŞ
 
	g§meDocum’tNavig©iÚ
 = ((!
™em
->
fÜmD©a
(è&& !(
cu¼’tI‹m
 && cu¼’tI‹m->fÜmD©a()è&& 
hi¡Üy
()->
u¾sM©chI‹m
(item))

4604 || (
cu¼’tI‹m
 && 
™em
->
docum’tSequ’ûNumb”
() == currentItem->documentSequenceNumber()))

4605 && 
™em
 !ğ
cu¼’tI‹m
;

4607 #ià
ENABLE
(
WML
)

4614 ià(
äameCÚšsWMLCÚ‹Á
(
m_äame
))

4615 
	g§meDocum’tNavig©iÚ
 = 
çl£
;

4618 ià(
	g§meDocum’tNavig©iÚ
)

4619 
Çvig©eW™hšDocum’t
(
™em
);

4621 
Çvig©eToDifã»ÁDocum’t
(
™em
, 
lßdTy³
);

4624 
	gF¿meLßd”
::
£tMašDocum’tE¼Ü
(
Docum’tLßd”
* 
lßd”
, cÚ¡ 
ResourûE¼Ü
& 
”rÜ
)

4626 #ifdeà
SSLAB__DEBUG


4627 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

4630 
	gm_ş›Á
->
£tMašDocum’tE¼Ü
(
lßd”
, 
”rÜ
);

4633 
	gF¿meLßd”
::
mašReûivedCom¶‘eE¼Ü
(
Docum’tLßd”
* 
lßd”
, cÚ¡ 
ResourûE¼Ü
&)

4635 #ifdeà
SSLAB__DEBUG


4636 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

4639 
	glßd”
->
£tPrim¬yLßdCom¶‘e
(
Œue
);

4640 
	gm_ş›Á
->
di¥©chDidLßdMašResourû
(
aùiveDocum’tLßd”
());

4641 
checkCom¶‘ed
();

4642 ià(
	gm_äame
->
·ge
())

4643 
checkLßdCom¶‘e
();

4646 
	gF¿meLßd”
::
mašReûivedE¼Ü
(cÚ¡ 
ResourûE¼Ü
& 
”rÜ
, 
boŞ
 
isCom¶‘e
)

4648 #ifdeà
SSLAB__DEBUG


4649 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

4652 
aùiveDocum’tLßd”
()->
mašReûivedE¼Ü
(
”rÜ
, 
isCom¶‘e
);

4655 
ResourûE¼Ü
 
	gF¿meLßd”
::
ÿnûÎedE¼Ü
(cÚ¡ 
ResourûReque¡
& 
»que¡
) const

4657 #ifdeà
SSLAB__DEBUG


4658 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

4661 
ResourûE¼Ü
 
	g”rÜ
 = 
m_ş›Á
->
ÿnûÎedE¼Ü
(
»que¡
);

4662 
	g”rÜ
.
£tIsCªûÎ©iÚ
(
Œue
);

4663  
	g”rÜ
;

4666 
ResourûE¼Ü
 
	gF¿meLßd”
::
blockedE¼Ü
(cÚ¡ 
ResourûReque¡
& 
»que¡
) const

4668 #ifdeà
SSLAB__DEBUG


4669 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

4672  
	gm_ş›Á
->
blockedE¼Ü
(
»que¡
);

4675 
ResourûE¼Ü
 
	gF¿meLßd”
::
ÿÂÙShowURLE¼Ü
(cÚ¡ 
ResourûReque¡
& 
»que¡
) const

4677 #ifdeà
SSLAB__DEBUG


4678 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

4681  
	gm_ş›Á
->
ÿÂÙShowURLE¼Ü
(
»que¡
);

4684 
ResourûE¼Ü
 
	gF¿meLßd”
::
feDÛsNÙExi¡E¼Ü
(cÚ¡ 
ResourûRe¥Ú£
& 
»¥Ú£
) const

4686 #ifdeà
SSLAB__DEBUG


4687 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

4690  
	gm_ş›Á
->
feDÛsNÙExi¡E¼Ü
(
»¥Ú£
);

4693 
boŞ
 
	gF¿meLßd”
::
shouldU£C»d’tŸlStÜage
(
ResourûLßd”
* 
lßd”
)

4695 #ifdeà
SSLAB__DEBUG


4696 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

4699  
	gm_ş›Á
->
shouldU£C»d’tŸlStÜage
(
lßd”
->
docum’tLßd”
(),†ßd”->
id’tif›r
());

4702 
	gF¿meLßd”
::
£tT™Ë
(cÚ¡ 
SŒšg
& 
t™Ë
)

4704 #ifdeà
SSLAB__DEBUG


4705 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

4708 
docum’tLßd”
()->
£tT™Ë
(
t™Ë
);

4711 
KURL
 
	gF¿meLßd”
::
Üigš®Reque¡URL
() const

4713 #ifdeà
SSLAB__DEBUG


4714 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

4717  
aùiveDocum’tLßd”
()->
Üigš®Reque¡
().
u¾
();

4720 
SŒšg
 
	gF¿meLßd”
::
»ã¼”
() const

4722 #ifdeà
SSLAB__DEBUG


4723 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

4726  
docum’tLßd”
()->
»que¡
().
h‰pReã¼”
();

4729 
	gF¿meLßd”
::
di¥©chDocum’tEËm’tAvaabË
()

4731 #ifdeà
SSLAB__DEBUG


4732 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

4735 
	gm_äame
->
šjeùU£rSüts
(
InjeùAtDocum’tS¹
);

4736 
	gm_ş›Á
->
docum’tEËm’tAvaabË
();

4739 
	gF¿meLßd”
::
di¥©chDidCË¬WšdowObjeùsInAÎWÜlds
()

4741 #ifdeà
SSLAB__DEBUG


4742 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

4745 ià(!
	gm_äame
->
süt
()->
ÿnExecu‹Süts
(
NÙAboutToExecu‹Süt
))

4748 
	gVeùÜ
<
	gDOMW¿µ”WÜld
*> 
	gwÜlds
;

4749 
	gSütCÚŒŞËr
::
g‘AÎWÜlds
(
wÜlds
);

4750 
size_t
 
	gi
 = 0; i < 
	gwÜlds
.
size
(); ++i)

4751 
di¥©chDidCË¬WšdowObjeùInWÜld
(
wÜlds
[
i
]);

4754 
	gF¿meLßd”
::
di¥©chDidCË¬WšdowObjeùInWÜld
(
DOMW¿µ”WÜld
* 
wÜld
)

4756 #ifdeà
SSLAB__DEBUG


4757 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

4760 ià(!
	gm_äame
->
süt
()->
ÿnExecu‹Süts
(
NÙAboutToExecu‹Süt
è|| !m_äame->süt()->
exi¡šgWšdowSh–l
(
wÜld
))

4763 
	gm_ş›Á
->
di¥©chDidCË¬WšdowObjeùInWÜld
(
wÜld
);

4765 #ià
ENABLE
(
INSPECTOR
)

4766 ià(
	gwÜld
 !ğ
mašTh»adNÜm®WÜld
())

4769 ià(
Page
* 
	g·ge
 = 
m_äame
->
·ge
()) {

4770 ià(
In¥eùÜCÚŒŞËr
* 
š¥eùÜ
 = 
·ge
->
š¥eùÜCÚŒŞËr
())

4771 
š¥eùÜ
->
š¥eùedWšdowSütObjeùCË¬ed
(
m_äame
);

4776 
	gF¿meLßd”
::
upd©eSªdboxFÏgs
()

4778 #ifdeà
SSLAB__DEBUG


4779 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

4782 
SªdboxFÏgs
 
	gæags
 = 
SªdboxNÚe
;

4783 ià(
F¿me
* 
	g·»ÁF¿me
 = 
m_äame
->
Œ“
()->
·»Á
())

4784 
æags
 |ğ
·»ÁF¿me
->
lßd”
()->
§ndboxFÏgs
();

4785 ià(
HTMLF¿meOwÃrEËm’t
* 
	gowÃrEËm’t
 = 
m_äame
->
owÃrEËm’t
())

4786 
æags
 |ğ
owÃrEËm’t
->
§ndboxFÏgs
();

4788 ià(
	gm_§ndboxFÏgs
 =ğ
æags
)

4791 
	gm_§ndboxFÏgs
 = 
æags
;

4793 
F¿me
* 
	gchd
 = 
m_äame
->
Œ“
()->
fœ¡Chd
(); chd; chd = 
chd
->Œ“()->
ÃxtSiblšg
())

4794 
chd
->
lßd”
()->
upd©eSªdboxFÏgs
();

4797 
boŞ
 
	gF¿meLßd”
::
isDocum’tSªdboxed
(
SªdboxFÏgs
 
mask
) const

4799 #ifdeà
SSLAB__DEBUG


4800 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

4803  
	gm_äame
->
docum’t
(è&& m_äame->docum’t()->
£cur™yOrigš
()->
isSªdboxed
(
mask
);

4806 
	gPassRefPŒ
<
	gWidg‘
> 
	gF¿meLßd”
::
ü—‹JavaAµËtWidg‘
(cÚ¡ 
IÁSize
& 
size
, 
HTMLAµËtEËm’t
* 
–em’t
, cÚ¡ 
HashM­
<
SŒšg
, SŒšg>& 
¬gs
)

4808 #ifdeà
SSLAB__DEBUG


4809 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

4812 
SŒšg
 
	gba£URLSŒšg
;

4813 
SŒšg
 
	gcodeBa£URLSŒšg
;

4814 
	gVeùÜ
<
	gSŒšg
> 
	g·¿mNames
;

4815 
	gVeùÜ
<
	gSŒšg
> 
	g·¿mV®ues
;

4816 
	gHashM­
<
	gSŒšg
, SŒšg>::
cÚ¡_™”©Ü
 
’d
 = 
¬gs
.end();

4817 
	gHashM­
<
	gSŒšg
, SŒšg>::
cÚ¡_™”©Ü
 
™
 = 
¬gs
.
begš
(); 
	g™
 !ğ
’d
; ++it) {

4818 ià(
equ®IgnÜšgCa£
(
™
->
fœ¡
, "baseurl"))

4819 
	gba£URLSŒšg
 = 
™
->
£cÚd
;

4820 ià(
equ®IgnÜšgCa£
(
™
->
fœ¡
, "codebase"))

4821 
	gcodeBa£URLSŒšg
 = 
™
->
£cÚd
;

4822 
	g·¿mNames
.
­³nd
(
™
->
fœ¡
);

4823 
	g·¿mV®ues
.
­³nd
(
™
->
£cÚd
);

4826 ià(!
	gcodeBa£URLSŒšg
.
isEm±y
()) {

4827 
KURL
 
	gcodeBa£URL
 = 
com¶‘eURL
(
codeBa£URLSŒšg
);

4828 ià(!
	gSecur™yOrigš
::
ÿnLßd
(
codeBa£URL
, 
SŒšg
(), 
–em’t
->
docum’t
())) {

4829 
	gF¿meLßd”
::
»pÜtLoÿlLßdFaed
(
m_äame
, 
codeBa£URL
.
¡ršg
());

4834 ià(
	gba£URLSŒšg
.
isEm±y
())

4835 
	gba£URLSŒšg
 = 
m_äame
->
docum’t
()->
ba£URL
().
¡ršg
();

4836 
KURL
 
	gba£URL
 = 
com¶‘eURL
(
ba£URLSŒšg
);

4838 
	gRefPŒ
<
	gWidg‘
> 
	gwidg‘
 = 
m_ş›Á
->
ü—‹JavaAµËtWidg‘
(
size
, 
–em’t
, 
ba£URL
, 
·¿mNames
, 
·¿mV®ues
);

4839 ià(!
	gwidg‘
)

4842 
	gm_cÚšsPlugIns
 = 
Œue
;

4843  
	gwidg‘
;

4846 
	gF¿meLßd”
::
didChªgeT™Ë
(
Docum’tLßd”
* 
lßd”
)

4848 #ifdeà
SSLAB__DEBUG


4849 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

4852 
	gm_ş›Á
->
didChªgeT™Ë
(
lßd”
);

4854 ià(
	glßd”
 =ğ
m_docum’tLßd”
) {

4856 
hi¡Üy
()->
£tCu¼’tI‹mT™Ë
(
lßd”
->
t™Ë
());

4858 
	gm_ş›Á
->
£tT™Ë
(
lßd”
->
t™Ë
(),†ßd”->
u¾FÜHi¡Üy
());

4859 
	gm_ş›Á
->
£tMašF¿meDocum’tR—dy
(
Œue
);

4860 
	gm_ş›Á
->
di¥©chDidReûiveT™Ë
(
lßd”
->
t™Ë
());

4864 
	gF¿meLßd”
::
di¥©chDidComm™Lßd
()

4866 #ifdeà
SSLAB__DEBUG


4867 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

4870 ià(
	gm_ü—tšgIn™ŸlEm±yDocum’t
)

4873 #iâdeà
NDEBUG


4874 
	gm_didDi¥©chDidComm™Lßd
 = 
Œue
;

4877 
	gm_ş›Á
->
di¥©chDidComm™Lßd
();

4879 #ià
ENABLE
(
INSPECTOR
)

4880 ià(
Page
* 
	g·ge
 = 
m_äame
->
·ge
())

4881 
·ge
->
š¥eùÜCÚŒŞËr
()->
didComm™Lßd
(
m_docum’tLßd”
.
g‘
());

4885 
	gF¿meLßd”
::
‹ÎCl›ÁAboutPa¡MemÜyCacheLßds
()

4887 #ifdeà
SSLAB__DEBUG


4888 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

4891 
ASSERT
(
m_äame
->
·ge
());

4892 
ASSERT
(
m_äame
->
·ge
()->
¬eMemÜyCacheCl›ÁC®lsEÇbËd
());

4894 ià(!
	gm_docum’tLßd”
)

4897 
	gVeùÜ
<
	gSŒšg
> 
	g·¡Lßds
;

4898 
	gm_docum’tLßd”
->
keMemÜyCacheLßdsFÜCl›ÁNÙifiÿtiÚ
(
·¡Lßds
);

4900 
size_t
 
	gsize
 = 
·¡Lßds
.
size
();

4901 
size_t
 
	gi
 = 0; i < 
	gsize
; ++i) {

4902 
CachedResourû
* 
	g»sourû
 = 
ÿche
()->
»sourûFÜURL
(
·¡Lßds
[
i
]);

4908 ià(!
	g»sourû
)

4911 
ResourûReque¡
 
»que¡
(
»sourû
->
u¾
());

4912 
	gm_ş›Á
->
di¥©chDidLßdResourûFromMemÜyCache
(
m_docum’tLßd”
.
g‘
(), 
»que¡
, 
»sourû
->
»¥Ú£
(),„esourû->
’codedSize
());

4916 
boŞ
 
	gF¿meLßd”Cl›Á
::
hasHTMLV›w
() const

4918 #ifdeà
SSLAB__DEBUG


4919 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

4922  
	gŒue
;

	@FrameLoader.h

31 #iâdeà
F¿meLßd”_h


32 
	#F¿meLßd”_h


	)

34 
	~"CachePŞicy.h
"

35 
	~"F¿meLßd”Ty³s.h
"

36 
	~"Hi¡ÜyCÚŒŞËr.h
"

37 
	~"PŞicyC®lback.h
"

38 
	~"PŞicyCheck”.h
"

39 
	~"RedœeùScheduËr.h
"

40 
	~"ResourûLßdNÙif›r.h
"

41 
	~"ResourûReque¡.h
"

42 
	~"Th»adabËLßd”.h
"

43 
	~"Tim”.h
"

44 
	~<wtf/FÜw¬d.h
>

46 
Çme¥aû
 
	gWebCÜe
 {

48 
şass
 
	gArchive
;

49 
şass
 
	gAuth’tiÿtiÚCh®Ënge
;

50 
şass
 
	gCachedF¿meBa£
;

51 
şass
 
	gCachedPage
;

52 
şass
 
	gCachedResourû
;

53 
şass
 
	gDOMW¿µ”WÜld
;

54 
şass
 
	gDocum’t
;

55 
şass
 
	gDocum’tLßd”
;

56 
şass
 
	gEv’t
;

57 
şass
 
	gFÜmD©a
;

58 
şass
 
	gFÜmS‹
;

59 
şass
 
	gF¿me
;

60 
şass
 
	gF¿meLßd”Cl›Á
;

61 
şass
 
	gHi¡ÜyI‹m
;

62 
şass
 
	gHTMLAµËtEËm’t
;

63 
şass
 
	gHTMLFÜmEËm’t
;

64 
şass
 
	gHTMLF¿meOwÃrEËm’t
;

65 
şass
 
	gIcÚLßd”
;

66 
şass
 
	gIÁSize
;

67 
şass
 
	gNavig©iÚAùiÚ
;

68 
şass
 
	gR’d”EmbeddedObjeù
;

69 
şass
 
	gResourûE¼Ü
;

70 
şass
 
	gResourûLßd”
;

71 
şass
 
	gResourûRe¥Ú£
;

72 
şass
 
	gSütSourûCode
;

73 
şass
 
	gSütSŒšg
;

74 
şass
 
	gSütV®ue
;

75 
şass
 
	gSecur™yOrigš
;

76 
şass
 
	gS”ŸlizedSütV®ue
;

77 
şass
 
	gSh¬edBufãr
;

78 
şass
 
	gSub¡™u‹D©a
;

79 
şass
 
	gTextResourûDecod”
;

80 
şass
 
	gWidg‘
;

82 
	gF¿meLßdReque¡
;

83 
	gWšdowF—tu»s
;

85 
boŞ
 
isBackFÜw¬dLßdTy³
(
F¿meLßdTy³
);

87 şas 
	cF¿meLßd”
 : 
public
 
NÚcİyabË
 {

88 
public
:

89 
F¿meLßd”
(
F¿me
*, 
F¿meLßd”Cl›Á
*);

90 ~
F¿meLßd”
();

92 
š™
();

94 
F¿me
* 
äame
(ècÚ¡ {  
	gm_äame
; }

96 
PŞicyCheck”
* 
pŞicyCheck”
(ècÚ¡ {  &
	gm_pŞicyCheck”
; }

97 
Hi¡ÜyCÚŒŞËr
* 
hi¡Üy
(ècÚ¡ {  &
	gm_hi¡Üy
; }

98 
ResourûLßdNÙif›r
* 
nÙif›r
(ècÚ¡ {  &
	gm_nÙiãr
; }

104 
´•¬eFÜLßdS¹
();

105 
£tupFÜR•Ïû
();

106 
£tupFÜR•ÏûByMIMETy³
(cÚ¡ 
SŒšg
& 
ÃwMIMETy³
);

108 
lßdURLIÁoChdF¿me
(cÚ¡ 
KURL
&, cÚ¡ 
SŒšg
& 
»ã»r
, 
F¿me
*);

110 
lßdF¿meReque¡
(cÚ¡ 
F¿meLßdReque¡
&, 
boŞ
 
lockHi¡Üy
, boŞ 
lockBackFÜw¬dLi¡
,

111 
PassRefPŒ
<
Ev’t
>, PassRefPŒ<
FÜmS‹
>, 
Reã¼”PŞicy
);

113 
lßd
(cÚ¡ 
ResourûReque¡
&, 
boŞ
 
lockHi¡Üy
);

114 
lßd
(cÚ¡ 
ResourûReque¡
&, cÚ¡ 
Sub¡™u‹D©a
&, 
boŞ
 
lockHi¡Üy
);

115 
lßd
(cÚ¡ 
ResourûReque¡
&, cÚ¡ 
SŒšg
& 
äameName
, 
boŞ
 
lockHi¡Üy
);

117 
lßdArchive
(
PassRefPŒ
<
Archive
>);

119 
»pÜtLoÿlLßdFaed
(
F¿me
*, cÚ¡ 
SŒšg
& 
u¾
);

122 
F¿me
* 
ü—‹Wšdow
(
F¿meLßd”
* 
äameLßd”FÜF¿meLookup
, cÚ¡ 
F¿meLßdReque¡
&, cÚ¡ 
WšdowF—tu»s
&, 
boŞ
& 
ü—‹d
);

124 
lßdResourûSynchrÚou¦y
(cÚ¡ 
ResourûReque¡
&, 
StÜedC»d’tŸls
, 
ResourûE¼Ü
&, 
ResourûRe¥Ú£
&, 
VeùÜ
<>& 
d©a
);

126 
boŞ
 
ÿnHªdËReque¡
(cÚ¡ 
ResourûReque¡
&);

129 
¡İAÎLßd”s
(
D©aba£PŞicy
 = 
D©aba£PŞicyStİ
);

130 
¡İFÜU£rCªûl
(
boŞ
 
deãrCheckLßdCom¶‘e
 = 
çl£
);

132 
boŞ
 
isLßdšgMašResourû
(ècÚ¡ {  
	gm_isLßdšgMašResourû
; }

133 
boŞ
 
isLßdšg
() const;

134 
boŞ
 
äameHasLßded
() const;

136 
numP’dšgOrLßdšgReque¡s
(
boŞ
 
»cur£
) const;

137 
SŒšg
 
»ã¼”
() const;

138 
SŒšg
 
outgošgReã¼”
() const;

139 
SŒšg
 
outgošgOrigš
() const;

141 
Docum’tLßd”
* 
aùiveDocum’tLßd”
() const;

142 
Docum’tLßd”
* 
docum’tLßd”
(ècÚ¡ {  
	gm_docum’tLßd”
.
g‘
(); }

143 
Docum’tLßd”
* 
pŞicyDocum’tLßd”
(ècÚ¡ {  
	gm_pŞicyDocum’tLßd”
.
g‘
(); }

144 
Docum’tLßd”
* 
´ovisiÚ®Docum’tLßd”
(ècÚ¡ {  
	gm_´ovisiÚ®Docum’tLßd”
.
g‘
(); }

145 
F¿meS‹
 
¡©e
(ècÚ¡ {  
	gm_¡©e
; }

146 
timeOfLa¡Com¶‘edLßd
();

148 
boŞ
 
shouldU£C»d’tŸlStÜage
(
ResourûLßd”
*);

149 cÚ¡ 
	gResourûReque¡
& 
Üigš®Reque¡
() const;

150 cÚ¡ 
	gResourûReque¡
& 
š™ŸlReque¡
() const;

151 
»ûivedMašResourûE¼Ü
(cÚ¡ 
ResourûE¼Ü
&, 
boŞ
 
isCom¶‘e
);

152 
»ûivedD©a
(const *, );

154 
boŞ
 
wlLßdMedŸEËm’tURL
(
KURL
&);

156 
hªdËF®lbackCÚ‹Á
();

157 
boŞ
 
isStİpšg
() const;

159 
fšishedLßdšg
();

161 
ResourûE¼Ü
 
ÿnûÎedE¼Ü
(cÚ¡ 
ResourûReque¡
&) const;

162 
ResourûE¼Ü
 
feDÛsNÙExi¡E¼Ü
(cÚ¡ 
ResourûRe¥Ú£
&) const;

163 
ResourûE¼Ü
 
blockedE¼Ü
(cÚ¡ 
ResourûReque¡
&) const;

164 
ResourûE¼Ü
 
ÿÂÙShowURLE¼Ü
(cÚ¡ 
ResourûReque¡
&) const;

165 
ResourûE¼Ü
 
š‹¼u±iÚFÜPŞicyChªgeE¼Ü
(cÚ¡ 
ResourûReque¡
&);

167 
boŞ
 
isHo¡edByObjeùEËm’t
() const;

168 
boŞ
 
isLßdšgMašF¿me
() const;

169 
boŞ
 
ÿnShowMIMETy³
(cÚ¡ 
SŒšg
& 
MIMETy³
) const;

170 
boŞ
 
»´e£Á©iÚExi¡sFÜURLScheme
(cÚ¡ 
SŒšg
& 
URLScheme
);

171 
SŒšg
 
g’”©edMIMETy³FÜURLScheme
(cÚ¡ SŒšg& 
URLScheme
);

173 
»lßd
(
boŞ
 
’dToEndR–ßd
 = 
çl£
);

174 
»lßdW™hOv”rideEncodšg
(cÚ¡ 
SŒšg
& 
ov”rideEncodšg
);

176 
didReûiveS”v”RedœeùFÜProvisiÚ®LßdFÜF¿me
();

177 
fšishedLßdšgDocum’t
(
Docum’tLßd”
*);

178 
comm™‹dLßd
(
Docum’tLßd”
*, const *, );

179 
boŞ
 
isR•Ïcšg
() const;

180 
£tR•Ïcšg
();

181 
»v”tToProvisiÚ®
(
Docum’tLßd”
*);

182 
£tMašDocum’tE¼Ü
(
Docum’tLßd”
*, cÚ¡ 
ResourûE¼Ü
&);

183 
mašReûivedCom¶‘eE¼Ü
(
Docum’tLßd”
*, cÚ¡ 
ResourûE¼Ü
&);

184 
boŞ
 
subäameIsLßdšg
() const;

185 
wlChªgeT™Ë
(
Docum’tLßd”
*);

186 
didChªgeT™Ë
(
Docum’tLßd”
*);

188 
F¿meLßdTy³
 
lßdTy³
() const;

189 
CachePŞicy
 
sub»sourûCachePŞicy
() const;

191 
didFœ¡Layout
();

192 
boŞ
 
fœ¡LayoutDÚe
() const;

194 
didFœ¡Visu®lyNÚEm±yLayout
();

196 
lßdedResourûFromMemÜyCache
(cÚ¡ 
CachedResourû
*);

197 
‹ÎCl›ÁAboutPa¡MemÜyCacheLßds
();

199 
checkLßdCom¶‘e
();

200 
d‘achFromP¬’t
();

201 
d‘achV›wsAndDocum’tLßd”
();

203 
addExŒaF›ldsToSub»sourûReque¡
(
ResourûReque¡
&);

204 
addExŒaF›ldsToMašResourûReque¡
(
ResourûReque¡
&);

206 
addHTTPOrigšIfN“ded
(
ResourûReque¡
&, 
SŒšg
 
Üigš
);

208 
F¿meLßd”Cl›Á
* 
ş›Á
(ècÚ¡ {  
	gm_ş›Á
; }

210 
£tDeãrsLßdšg
(
boŞ
);

212 
chªgeLoÿtiÚ
(cÚ¡ 
KURL
&, cÚ¡ 
SŒšg
& 
»ã¼”
, 
boŞ
 
lockHi¡Üy
 = 
Œue
, boŞ 
lockBackFÜw¬dLi¡
 =rue, boŞ 
u£rGe¡u»
 = 
çl£
, boŞ 
»äesh
 = false);

213 
u¾S–eùed
(cÚ¡ 
ResourûReque¡
&, cÚ¡ 
SŒšg
& 
rg‘
, 
PassRefPŒ
<
Ev’t
>, 
boŞ
 
lockHi¡Üy
, boŞ 
lockBackFÜw¬dLi¡
, boŞ 
u£rGe¡u»
, 
Reã¼”PŞicy
);

214 
boŞ
 
»que¡F¿me
(
HTMLF¿meOwÃrEËm’t
*, cÚ¡ 
SŒšg
& 
u¾
, cÚ¡ 
AtomicSŒšg
& 
äameName
, boŞ 
lockHi¡Üy
 = 
Œue
, boŞ 
lockBackFÜw¬dLi¡
 =rue);

216 
subm™FÜm
(cÚ¡ * 
aùiÚ
, cÚ¡ 
SŒšg
& 
u¾
,

217 
PassRefPŒ
<
FÜmD©a
>, cÚ¡ 
SŒšg
& 
rg‘
, cÚ¡ SŒšg& 
cÚ‹ÁTy³
, cÚ¡ SŒšg& 
bound¬y
,

218 
boŞ
 
lockHi¡Üy
, 
PassRefPŒ
<
Ev’t
>, PassRefPŒ<
FÜmS‹
>);

220 
¡İ
();

221 
¡İLßdšg
(
UÆßdEv’tPŞicy
, 
D©aba£PŞicy
 = 
D©aba£PŞicyStİ
);

222 
boŞ
 
şo£URL
();

224 
didEx¶ic™O³n
();

226 
KURL
 
icÚURL
();

227 
comm™IcÚURLToIcÚD©aba£
(cÚ¡ 
KURL
&);

229 
KURL
 
ba£URL
() const;

231 
»¶aûDocum’t
(cÚ¡ 
SŒšg
&);

233 
begš
();

234 
begš
(cÚ¡ 
KURL
&, 
boŞ
 
di¥©chWšdowObjeùAvaabË
 = 
Œue
, 
Secur™yOrigš
* 
fÜûdSecur™yOrigš
 = 0);

236 
wr™e
(cÚ¡ * 
¡ršg
, 
Ëngth
 = -1, 
boŞ
 
æush
 = 
çl£
);

237 
wr™e
(cÚ¡ 
SŒšg
&);

238 
’d
();

239 
’dIfNÙLßdšgMašResourû
();

241 
£tEncodšg
(cÚ¡ 
SŒšg
& 
’codšg
, 
boŞ
 
u£rCho£n
);

242 
SŒšg
 
’codšg
() const;

244 
tok’iz”Proûs£dD©a
();

246 
hªdËdOÆßdEv’ts
();

247 
SŒšg
 
u£rAg’t
(cÚ¡ 
KURL
&) const;

249 
	gPassRefPŒ
<
	gWidg‘
> 
ü—‹JavaAµËtWidg‘
(cÚ¡ 
IÁSize
&, 
HTMLAµËtEËm’t
*, cÚ¡ 
HashM­
<
SŒšg
, SŒšg>& 
¬gs
);

251 
di¥©chDidCË¬WšdowObjeùInWÜld
(
DOMW¿µ”WÜld
*);

252 
di¥©chDidCË¬WšdowObjeùsInAÎWÜlds
();

253 
di¥©chDocum’tEËm’tAvaabË
();

255 
owÃrEËm’tSªdboxFÏgsChªged
(è{ 
upd©eSªdboxFÏgs
(); }

257 
boŞ
 
isSªdboxed
(
SªdboxFÏgs
 
mask
ècÚ¡ {  
	gm_§ndboxFÏgs
 & 
	gmask
; }

258 
SªdboxFÏgs
 
§ndboxFÏgs
(ècÚ¡ {  
	gm_§ndboxFÏgs
; }

261 
boŞ
 
isMixedCÚ‹Á
(
Secur™yOrigš
* 
cÚ‹xt
, cÚ¡ 
KURL
&);

262 
checkIfDi¥ÏyIn£cu»CÚ‹Á
(
Secur™yOrigš
* 
cÚ‹xt
, cÚ¡ 
KURL
&);

263 
checkIfRunIn£cu»CÚ‹Á
(
Secur™yOrigš
* 
cÚ‹xt
, cÚ¡ 
KURL
&);

265 
F¿me
* 
İ’”
();

266 
£tO³Ãr
(
F¿me
*);

268 
boŞ
 
isProûssšgU£rGe¡u»
();

270 
»£tMuÉËFÜmSubmissiÚPrÙeùiÚ
();

272 
addD©a
(cÚ¡ * 
by‹s
, 
Ëngth
);

274 
checkC®lIm¶ic™Clo£
();

276 
äameD‘ached
();

278 cÚ¡ 
	gKURL
& 
u¾
(ècÚ¡ {  
	gm_URL
; }

280 
£tRe¥Ú£MIMETy³
(cÚ¡ 
SŒšg
&);

281 cÚ¡ 
	gSŒšg
& 
»¥Ú£MIMETy³
() const;

283 
boŞ
 
®lowPlugšs
(
R—sÚFÜC®lšgAÎowPlugšs
);

284 
boŞ
 
cÚšsPlugšs
() const;

286 
lßdDÚe
();

287 
fšishedP¬sšg
();

288 
checkCom¶‘ed
();

290 
checkDidP”fÜmFœ¡Navig©iÚ
();

292 
boŞ
 
isCom¶‘e
() const;

294 
boŞ
 
»que¡Objeù
(
R’d”EmbeddedObjeù
*, cÚ¡ 
SŒšg
& 
u¾
, cÚ¡ 
AtomicSŒšg
& 
äameName
,

295 cÚ¡ 
SŒšg
& 
£rviûTy³
, cÚ¡ 
VeùÜ
<SŒšg>& 
·¿mNames
, cÚ¡ VeùÜ<SŒšg>& 
·¿mV®ues
);

297 
KURL
 
com¶‘eURL
(cÚ¡ 
SŒšg
& 
u¾
);

299 
ÿnûlAndCË¬
();

301 
£tT™Ë
(cÚ¡ 
SŒšg
&);

303 
comm™ProvisiÚ®Lßd
(
PassRefPŒ
<
CachedPage
>);

304 
boŞ
 
isLßdšgFromCachedPage
(ècÚ¡ {  
	gm_lßdšgFromCachedPage
; }

306 
boŞ
 
comm™tšgFœ¡R—lLßd
(ècÚ¡ {  !
	gm_ü—tšgIn™ŸlEm±yDocum’t
 && !
	gm_comm™‹dFœ¡R—lDocum’tLßd
; }

307 
boŞ
 
comm™‹dFœ¡R—lDocum’tLßd
(ècÚ¡ {  
	gm_comm™‹dFœ¡R—lDocum’tLßd
; }

308 
boŞ
 
ü—tšgIn™ŸlEm±yDocum’t
(ècÚ¡ {  
	gm_ü—tšgIn™ŸlEm±yDocum’t
; }

310 
icÚLßdDecisiÚAvaabË
();

312 
boŞ
 
shouldAÎowNavig©iÚ
(
F¿me
* 
rg‘F¿me
) const;

313 
F¿me
* 
fšdF¿meFÜNavig©iÚ
(cÚ¡ 
AtomicSŒšg
& 
Çme
);

315 
¡¬tIcÚLßd”
();

317 
­¶yU£rAg’t
(
ResourûReque¡
& 
»que¡
);

319 
boŞ
 
shouldIÁ”ru±LßdFÜXF¿meO±iÚs
(cÚ¡ 
SŒšg
&, cÚ¡ 
KURL
&);

321 
İ’
(
CachedF¿meBa£
&);

324 
com¶‘ed
();

325 
boŞ
 
®lAnû¡ÜsA»Com¶‘e
() const;

326 
boŞ
 
®lChd»nA»Com¶‘e
() const;

327 
ş›ÁRedœeùed
(cÚ¡ 
KURL
&, 
d–ay
, 
fœeD©e
, 
boŞ
 
lockBackFÜw¬dLi¡
);

328 
ş›ÁRedœeùCªûÎedOrFšished
(
boŞ
 
ÿnûlW™hLßdInProg»ss
);

329 
lßdI‹m
(
Hi¡ÜyI‹m
*, 
F¿meLßdTy³
);

334 
cÚtšueLßdAá”WlSubm™FÜm
();

336 
boŞ
 
suµ»ssO³ÃrInNewF¿me
(ècÚ¡ {  
	gm_suµ»ssO³ÃrInNewF¿me
; }

338 
ObjeùCÚ‹ÁTy³
 
deçuÉObjeùCÚ‹ÁTy³
(cÚ¡ 
KURL
& 
u¾
, cÚ¡ 
SŒšg
& 
mimeTy³
);

340 
	g´iv©e
:

341 
boŞ
 
ÿnCachePageCÚššgThisF¿me
();

342 #iâdeà
NDEBUG


343 
logCªCachePageDecisiÚ
();

344 
boŞ
 
logCªCacheF¿meDecisiÚ
(
šd’tLev–
);

347 
checkTim”Fœed
(
Tim”
<
F¿meLßd”
>*);

349 
¡¬‹d
();

351 
boŞ
 
shouldU£Plugš
(cÚ¡ 
KURL
&, cÚ¡ 
SŒšg
& 
mimeTy³
, boŞ 
hasF®lback
, boŞ& 
u£F®lback
);

352 
boŞ
 
lßdPlugš
(
R’d”EmbeddedObjeù
*, cÚ¡ 
KURL
&, cÚ¡ 
SŒšg
& 
mimeTy³
,

353 cÚ¡ 
VeùÜ
<
SŒšg
>& 
·¿mNames
, cÚ¡ VeùÜ<SŒšg>& 
·¿mV®ues
, 
boŞ
 
u£F®lback
);

355 
Çvig©eW™hšDocum’t
(
Hi¡ÜyI‹m
*);

356 
Çvig©eToDifã»ÁDocum’t
(
Hi¡ÜyI‹m
*, 
F¿meLßdTy³
);

358 
boŞ
 
lßdProvisiÚ®I‹mFromCachedPage
();

359 
ÿchePageFÜHi¡ÜyI‹m
(
Hi¡ÜyI‹m
*);

360 
·geHidd’
();

362 
»ûivedFœ¡D©a
();

364 
upd©eFœ¡P¬tyFÜCook›s
();

365 
£tFœ¡P¬tyFÜCook›s
(cÚ¡ 
KURL
&);

367 
addExŒaF›ldsToReque¡
(
ResourûReque¡
&, 
F¿meLßdTy³
 
lßdTy³
, 
boŞ
 
isMašResourû
, boŞ 
cook›PŞicyURLFromReque¡
);

370 
¡İLßdšgSubäames
();

372 
ş—rProvisiÚ®Lßd
();

373 
m¬kLßdCom¶‘e
();

374 
Œªs™iÚToComm™‹d
(
PassRefPŒ
<
CachedPage
>);

375 
äameLßdCom¶‘ed
();

377 
mašReûivedE¼Ü
(cÚ¡ 
ResourûE¼Ü
&, 
boŞ
 
isCom¶‘e
);

379 
£tLßdTy³
(
F¿meLßdTy³
);

381 
ÿÎCÚtšueLßdAá”Navig©iÚPŞicy
(*, cÚ¡ 
ResourûReque¡
&, 
PassRefPŒ
<
FÜmS‹
>, 
boŞ
 
shouldCÚtšue
);

382 
ÿÎCÚtšueLßdAá”NewWšdowPŞicy
(*, cÚ¡ 
ResourûReque¡
&, 
PassRefPŒ
<
FÜmS‹
>, cÚ¡ 
SŒšg
& 
äameName
, 
boŞ
 
shouldCÚtšue
);

383 
ÿÎCÚtšueF¿gm’tSüŞlAá”Navig©iÚPŞicy
(*, cÚ¡ 
ResourûReque¡
&, 
PassRefPŒ
<
FÜmS‹
>, 
boŞ
 
shouldCÚtšue
);

385 
cÚtšueLßdAá”Navig©iÚPŞicy
(cÚ¡ 
ResourûReque¡
&, 
PassRefPŒ
<
FÜmS‹
>, 
boŞ
 
shouldCÚtšue
);

386 
cÚtšueLßdAá”NewWšdowPŞicy
(cÚ¡ 
ResourûReque¡
&, 
PassRefPŒ
<
FÜmS‹
>, cÚ¡ 
SŒšg
& 
äameName
, 
boŞ
 
shouldCÚtšue
);

387 
cÚtšueF¿gm’tSüŞlAá”Navig©iÚPŞicy
(cÚ¡ 
ResourûReque¡
&, 
boŞ
 
shouldCÚtšue
);

389 
boŞ
 
shouldSüŞlToAnchÜ
(boŞ 
isFÜmSubmissiÚ
, 
F¿meLßdTy³
, cÚ¡ 
KURL
&);

391 
checkLßdCom¶‘eFÜThisF¿me
();

393 
£tDocum’tLßd”
(
Docum’tLßd”
*);

394 
£tPŞicyDocum’tLßd”
(
Docum’tLßd”
*);

395 
£tProvisiÚ®Docum’tLßd”
(
Docum’tLßd”
*);

397 
£tS‹
(
F¿meS‹
);

399 
şo£OldD©aSourûs
();

400 
İ’
(
CachedPage
&);

402 
upd©eHi¡ÜyAá”Cl›ÁRedœeù
();

404 
ş—r
(
boŞ
 
ş—rWšdowPrİ”t›s
 = 
Œue
, boŞ 
ş—rSütObjeùs
 =rue, boŞ 
ş—rF¿meV›w
 =rue);

406 
boŞ
 
shouldR–ßdToHªdËUÄ—chabËURL
(
Docum’tLßd”
*);

408 
di¥©chDidComm™Lßd
();

410 
lßdW™hDocum’tLßd”
(
Docum’tLßd”
*, 
F¿meLßdTy³
, 
PassRefPŒ
<
FÜmS‹
>);

411 
lßd
(
Docum’tLßd”
*);

413 
lßdW™hNavig©iÚAùiÚ
(cÚ¡ 
ResourûReque¡
&, cÚ¡ 
Navig©iÚAùiÚ
&,

414 
boŞ
 
lockHi¡Üy
, 
F¿meLßdTy³
, 
PassRefPŒ
<
FÜmS‹
>);

416 
lßdPo¡Reque¡
(cÚ¡ 
ResourûReque¡
&, cÚ¡ 
SŒšg
& 
»ã¼”
,

417 cÚ¡ 
SŒšg
& 
äameName
, 
boŞ
 
lockHi¡Üy
, 
F¿meLßdTy³
, 
PassRefPŒ
<
Ev’t
>, PassRefPŒ<
FÜmS‹
>);

418 
lßdURL
(cÚ¡ 
KURL
&, cÚ¡ 
SŒšg
& 
»ã¼”
, cÚ¡ SŒšg& 
äameName
,

419 
boŞ
 
lockHi¡Üy
, 
F¿meLßdTy³
, 
PassRefPŒ
<
Ev’t
>, PassRefPŒ<
FÜmS‹
>);

421 
boŞ
 
shouldR–ßd
(cÚ¡ 
KURL
& 
cu¼’tURL
, cÚ¡ KURL& 
de¡š©iÚURL
);

423 
»que¡FromD–eg©e
(
ResourûReque¡
&, & 
id’tif›r
, 
ResourûE¼Ü
&);

425 
»cursiveCheckLßdCom¶‘e
();

427 
d‘achChd»n
();

428 
şo£AndRemoveChd
(
F¿me
*);

430 
F¿me
* 
lßdSubäame
(
HTMLF¿meOwÃrEËm’t
*, cÚ¡ 
KURL
&, cÚ¡ 
SŒšg
& 
Çme
, cÚ¡ SŒšg& 
»ã¼”
);

432 
lßdInSameDocum’t
(cÚ¡ 
KURL
&, 
S”ŸlizedSütV®ue
* 
¡©eObjeù
, 
boŞ
 
isNewNavig©iÚ
);

434 
´ovisiÚ®LßdS¹ed
();

436 
boŞ
 
ÿnCachePage
();

438 
boŞ
 
didO³nURL
(cÚ¡ 
KURL
&);

440 
scheduËCheckCom¶‘ed
();

441 
scheduËCheckLßdCom¶‘e
();

442 
¡¬tCheckCom¶‘eTim”
();

444 
KURL
 
Üigš®Reque¡URL
() const;

446 
boŞ
 
shouldT»©URLAsSameAsCu¼’t
(cÚ¡ 
KURL
&) const;

448 
upd©eSªdboxFÏgs
();

450 
boŞ
 
isDocum’tSªdboxed
(
SªdboxFÏgs
) const;

452 
F¿me
* 
	gm_äame
;

453 
F¿meLßd”Cl›Á
* 
	gm_ş›Á
;

455 
mubË
 
PŞicyCheck”
 
	gm_pŞicyCheck”
;

456 
mubË
 
Hi¡ÜyCÚŒŞËr
 
	gm_hi¡Üy
;

457 
mubË
 
ResourûLßdNÙif›r
 
	gm_nÙiãr
;

459 
F¿meS‹
 
	gm_¡©e
;

460 
F¿meLßdTy³
 
	gm_lßdTy³
;

466 
	gRefPŒ
<
	gDocum’tLßd”
> 
	gm_docum’tLßd”
;

467 
	gRefPŒ
<
	gDocum’tLßd”
> 
	gm_´ovisiÚ®Docum’tLßd”
;

468 
	gRefPŒ
<
	gDocum’tLßd”
> 
	gm_pŞicyDocum’tLßd”
;

470 
boŞ
 
	gm_d–eg©eIsHªdlšgProvisiÚ®LßdE¼Ü
;

472 
boŞ
 
	gm_fœ¡LayoutDÚe
;

473 
boŞ
 
	gm_quickRedœeùComšg
;

474 
boŞ
 
	gm_£ÁRedœeùNÙifiÿtiÚ
;

475 
boŞ
 
	gm_šStİAÎLßd”s
;

477 
SŒšg
 
	gm_outgošgReã¼”
;

479 
boŞ
 
	gm_isExecutšgJavaSütFÜmAùiÚ
;

481 
SŒšg
 
	gm_»¥Ú£MIMETy³
;

483 
boŞ
 
	gm_didC®lIm¶ic™Clo£
;

484 
boŞ
 
	gm_wasUÆßdEv’tEm™‹d
;

485 
boŞ
 
	gm_uÆßdEv’tBešgDi¥©ched
;

486 
boŞ
 
	gm_isCom¶‘e
;

487 
boŞ
 
	gm_isLßdšgMašResourû
;

489 
	gRefPŒ
<
	gS”ŸlizedSütV®ue
> 
	gm_³ndšgS‹Objeù
;

491 
KURL
 
	gm_URL
;

492 
KURL
 
	gm_wÜkšgURL
;

494 
	gOwnPŒ
<
	gIcÚLßd”
> 
	gm_icÚLßd”
;

495 
boŞ
 
	gm_mayLßdIcÚL©”
;

497 
boŞ
 
	gm_ÿnûÎšgW™hLßdInProg»ss
;

499 
boŞ
 
	gm_ÃedsCË¬
;

500 
boŞ
 
	gm_»ûivedD©a
;

502 
boŞ
 
	gm_’codšgWasCho£nByU£r
;

503 
SŒšg
 
	gm_’codšg
;

504 
	gRefPŒ
<
	gTextResourûDecod”
> 
	gm_decod”
;

506 
boŞ
 
	gm_cÚšsPlugIns
;

508 
KURL
 
	gm_subm™‹dFÜmURL
;

510 
	gTim”
<
	gF¿meLßd”
> 
	gm_checkTim”
;

511 
boŞ
 
	gm_shouldC®lCheckCom¶‘ed
;

512 
boŞ
 
	gm_shouldC®lCheckLßdCom¶‘e
;

514 
F¿me
* 
	gm_İ’”
;

515 
	gHashS‘
<
	gF¿me
*> 
	gm_İ’edF¿mes
;

517 
boŞ
 
	gm_ü—tšgIn™ŸlEm±yDocum’t
;

518 
boŞ
 
	gm_isDi¥ÏyšgIn™ŸlEm±yDocum’t
;

519 
boŞ
 
	gm_comm™‹dFœ¡R—lDocum’tLßd
;

521 
boŞ
 
	gm_didP”fÜmFœ¡Navig©iÚ
;

522 
boŞ
 
	gm_lßdšgFromCachedPage
;

523 
boŞ
 
	gm_suµ»ssO³ÃrInNewF¿me
;

525 
SªdboxFÏgs
 
	gm_§ndboxFÏgs
;

527 #iâdeà
NDEBUG


528 
boŞ
 
	gm_didDi¥©chDidComm™Lßd
;

	@FrameLoaderClient.h

29 #iâdeà
F¿meLßd”Cl›Á_h


30 
	#F¿meLßd”Cl›Á_h


	)

32 
	~"F¿meLßd”Ty³s.h
"

33 
	~"SüŞlTy³s.h
"

34 
	~<wtf/FÜw¬d.h
>

35 
	~<wtf/VeùÜ.h
>

37 
şass
 
	t_jobjeù
* 
	tjobjeù
;

39 #ià
PLATFORM
(
MAC
è&& !
defšed
(
__OBJC__
)

40 
şass
 
	gNSCachedURLRe¥Ú£
;

41 
şass
 
	gNSV›w
;

44 
Çme¥aû
 
	gWebCÜe
 {

46 
şass
 
	gAuth’tiÿtiÚCh®Ënge
;

47 
şass
 
	gCachedF¿me
;

48 
şass
 
	gCŞÜ
;

49 
şass
 
	gDOMW¿µ”WÜld
;

50 
şass
 
	gDocum’tLßd”
;

51 
şass
 
	gEËm’t
;

52 
şass
 
	gFÜmS‹
;

53 
şass
 
	gF¿me
;

54 
şass
 
	gF¿meLßd”
;

55 
şass
 
	gHi¡ÜyI‹m
;

56 
şass
 
	gHTMLAµËtEËm’t
;

57 
şass
 
	gHTMLF¿meOwÃrEËm’t
;

58 
şass
 
	gHTMLPlugInEËm’t
;

59 
şass
 
	gIÁSize
;

60 
şass
 
	gKURL
;

61 
şass
 
	gNavig©iÚAùiÚ
;

62 
şass
 
	gPlugšV›w
;

63 
şass
 
	gPŞicyCheck”
;

64 
şass
 
	gResourûE¼Ü
;

65 
şass
 
	gResourûHªdË
;

66 
şass
 
	gResourûLßd”
;

67 
şass
 
	gResourûReque¡
;

68 
şass
 
	gResourûRe¥Ú£
;

69 
şass
 
	gSütSŒšg
;

70 
şass
 
	gSecur™yOrigš
;

71 
şass
 
	gSh¬edBufãr
;

72 
şass
 
	gSub¡™u‹D©a
;

73 
şass
 
	gSŒšg
;

74 
şass
 
	gWidg‘
;

76 (
	gPŞicyCheck”
::*
	tF¿mePŞicyFunùiÚ
)(
	tPŞicyAùiÚ
);

78 şas 
	cF¿meLßd”Cl›Á
 {

79 
	gpublic
:

84 
vœtu®
 
boŞ
 
hasHTMLV›w
() const;

86 
	gvœtu®
 ~
F¿meLßd”Cl›Á
() { }

88 
vœtu®
 
äameLßd”De¡royed
() = 0;

90 
vœtu®
 
boŞ
 
hasWebV›w
() const = 0;

92 
vœtu®
 
makeR•»£Á©iÚ
(
Docum’tLßd”
*) = 0;

93 
vœtu®
 
fÜûLayout
() = 0;

94 
vœtu®
 
fÜûLayoutFÜNÚHTML
() = 0;

96 
vœtu®
 
£tCİ›sOnSüŞl
() = 0;

98 
vœtu®
 
d‘achedFromP¬’t2
() = 0;

99 
vœtu®
 
d‘achedFromP¬’t3
() = 0;

101 
vœtu®
 
assignId’tif›rToIn™ŸlReque¡
(
id’tif›r
, 
Docum’tLßd”
*, cÚ¡ 
ResourûReque¡
&) = 0;

103 
vœtu®
 
di¥©chWlS’dReque¡
(
Docum’tLßd”
*, 
id’tif›r
, 
ResourûReque¡
&, cÚ¡ 
ResourûRe¥Ú£
& 
»dœeùRe¥Ú£
) = 0;

104 
vœtu®
 
boŞ
 
shouldU£C»d’tŸlStÜage
(
Docum’tLßd”
*, 
id’tif›r
) = 0;

105 
vœtu®
 
di¥©chDidReûiveAuth’tiÿtiÚCh®Ënge
(
Docum’tLßd”
*, 
id’tif›r
, cÚ¡ 
Auth’tiÿtiÚCh®Ënge
&) = 0;

106 
vœtu®
 
di¥©chDidCªûlAuth’tiÿtiÚCh®Ënge
(
Docum’tLßd”
*, 
id’tif›r
, cÚ¡ 
Auth’tiÿtiÚCh®Ënge
&) = 0;

107 
vœtu®
 
di¥©chDidReûiveRe¥Ú£
(
Docum’tLßd”
*, 
id’tif›r
, cÚ¡ 
ResourûRe¥Ú£
&) = 0;

108 
vœtu®
 
di¥©chDidReûiveCÚ‹ÁL’gth
(
Docum’tLßd”
*, 
id’tif›r
, 
ËngthReûived
) = 0;

109 
vœtu®
 
di¥©chDidFšishLßdšg
(
Docum’tLßd”
*, 
id’tif›r
) = 0;

110 
vœtu®
 
di¥©chDidFaLßdšg
(
Docum’tLßd”
*, 
id’tif›r
, cÚ¡ 
ResourûE¼Ü
&) = 0;

111 
vœtu®
 
boŞ
 
di¥©chDidLßdResourûFromMemÜyCache
(
Docum’tLßd”
*, cÚ¡ 
ResourûReque¡
&, cÚ¡ 
ResourûRe¥Ú£
&, 
Ëngth
) = 0;

112 
vœtu®
 
di¥©chDidLßdResourûByXMLH‰pReque¡
(
id’tif›r
, cÚ¡ 
SütSŒšg
&) = 0;

114 
vœtu®
 
di¥©chDidHªdËOÆßdEv’ts
() = 0;

115 
vœtu®
 
di¥©chDidReûiveS”v”RedœeùFÜProvisiÚ®Lßd
() = 0;

116 
vœtu®
 
di¥©chDidCªûlCl›ÁRedœeù
() = 0;

117 
vœtu®
 
di¥©chWlP”fÜmCl›ÁRedœeù
(cÚ¡ 
KURL
&, 
š‹rv®
, 
fœeD©e
) = 0;

118 
vœtu®
 
di¥©chDidNavig©eW™hšPage
() { }

119 
vœtu®
 
di¥©chDidChªgeLoÿtiÚW™hšPage
() = 0;

120 
vœtu®
 
di¥©chDidPushS‹W™hšPage
() = 0;

121 
vœtu®
 
di¥©chDidR•ÏûS‹W™hšPage
() = 0;

122 
vœtu®
 
di¥©chDidPİS‹W™hšPage
() = 0;

123 
vœtu®
 
di¥©chWlClo£
() = 0;

124 
vœtu®
 
di¥©chDidReûiveIcÚ
() = 0;

125 
vœtu®
 
di¥©chDidS¹ProvisiÚ®Lßd
() = 0;

126 
vœtu®
 
di¥©chDidReûiveT™Ë
(cÚ¡ 
SŒšg
& 
t™Ë
) = 0;

127 
vœtu®
 
di¥©chDidComm™Lßd
() = 0;

128 
vœtu®
 
di¥©chDidFaProvisiÚ®Lßd
(cÚ¡ 
ResourûE¼Ü
&) = 0;

129 
vœtu®
 
di¥©chDidFaLßd
(cÚ¡ 
ResourûE¼Ü
&) = 0;

130 
vœtu®
 
di¥©chDidFšishDocum’tLßd
() = 0;

131 
vœtu®
 
di¥©chDidFšishLßd
() = 0;

132 
vœtu®
 
di¥©chDidFœ¡Layout
() = 0;

133 
vœtu®
 
di¥©chDidFœ¡Visu®lyNÚEm±yLayout
() = 0;

135 
vœtu®
 
F¿me
* 
di¥©chC»©ePage
() = 0;

136 
vœtu®
 
di¥©chShow
() = 0;

138 
vœtu®
 
di¥©chDecidePŞicyFÜMIMETy³
(
F¿mePŞicyFunùiÚ
, cÚ¡ 
SŒšg
& 
MIMETy³
, cÚ¡ 
ResourûReque¡
&) = 0;

139 
vœtu®
 
di¥©chDecidePŞicyFÜNewWšdowAùiÚ
(
F¿mePŞicyFunùiÚ
, cÚ¡ 
Navig©iÚAùiÚ
&, cÚ¡ 
ResourûReque¡
&, 
PassRefPŒ
<
FÜmS‹
>, cÚ¡ 
SŒšg
& 
äameName
) = 0;

140 
vœtu®
 
di¥©chDecidePŞicyFÜNavig©iÚAùiÚ
(
F¿mePŞicyFunùiÚ
, cÚ¡ 
Navig©iÚAùiÚ
&, cÚ¡ 
ResourûReque¡
&, 
PassRefPŒ
<
FÜmS‹
>) = 0;

141 
vœtu®
 
ÿnûlPŞicyCheck
() = 0;

143 
vœtu®
 
di¥©chUÇbËToIm¶em’tPŞicy
(cÚ¡ 
ResourûE¼Ü
&) = 0;

145 
vœtu®
 
di¥©chWlSubm™FÜm
(
F¿mePŞicyFunùiÚ
, 
PassRefPŒ
<
FÜmS‹
>) = 0;

147 
vœtu®
 
di¥©chDidLßdMašResourû
(
Docum’tLßd”
*) = 0;

148 
vœtu®
 
»v”tToProvisiÚ®S‹
(
Docum’tLßd”
*) = 0;

149 
vœtu®
 
£tMašDocum’tE¼Ü
(
Docum’tLßd”
*, cÚ¡ 
ResourûE¼Ü
&) = 0;

152 
vœtu®
 
wlChªgeE¡im©edProg»ss
() { }

153 
vœtu®
 
didChªgeE¡im©edProg»ss
() { }

154 
vœtu®
 
po¡Prog»ssS¹edNÙifiÿtiÚ
() = 0;

155 
vœtu®
 
po¡Prog»ssE¡im©eChªgedNÙifiÿtiÚ
() = 0;

156 
vœtu®
 
po¡Prog»ssFšishedNÙifiÿtiÚ
() = 0;

158 
vœtu®
 
£tMašF¿meDocum’tR—dy
(
boŞ
) = 0;

160 
vœtu®
 
¡¬tDowÆßd
(cÚ¡ 
ResourûReque¡
&) = 0;

162 
vœtu®
 
wlChªgeT™Ë
(
Docum’tLßd”
*) = 0;

163 
vœtu®
 
didChªgeT™Ë
(
Docum’tLßd”
*) = 0;

165 
vœtu®
 
comm™‹dLßd
(
Docum’tLßd”
*, const *, ) = 0;

166 
vœtu®
 
fšishedLßdšg
(
Docum’tLßd”
*) = 0;

168 
vœtu®
 
upd©eGlob®Hi¡Üy
() = 0;

169 
vœtu®
 
upd©eGlob®Hi¡ÜyRedœeùLšks
() = 0;

171 
vœtu®
 
boŞ
 
shouldGoToHi¡ÜyI‹m
(
Hi¡ÜyI‹m
*) const = 0;

172 
vœtu®
 
di¥©chDidAddBackFÜw¬dI‹m
(
Hi¡ÜyI‹m
*) const = 0;

173 
vœtu®
 
di¥©chDidRemoveBackFÜw¬dI‹m
(
Hi¡ÜyI‹m
*) const = 0;

174 
vœtu®
 
di¥©chDidChªgeBackFÜw¬dIndex
() const = 0;

178 
vœtu®
 
didDi¥ÏyIn£cu»CÚ‹Á
() = 0;

183 
vœtu®
 
didRunIn£cu»CÚ‹Á
(
Secur™yOrigš
*) = 0;

185 
vœtu®
 
ResourûE¼Ü
 
ÿnûÎedE¼Ü
(cÚ¡ 
ResourûReque¡
&) = 0;

186 
vœtu®
 
ResourûE¼Ü
 
blockedE¼Ü
(cÚ¡ 
ResourûReque¡
&) = 0;

187 
vœtu®
 
ResourûE¼Ü
 
ÿÂÙShowURLE¼Ü
(cÚ¡ 
ResourûReque¡
&) = 0;

188 
vœtu®
 
ResourûE¼Ü
 
š‹¼u±FÜPŞicyChªgeE¼Ü
(cÚ¡ 
ResourûReque¡
&) = 0;

190 
vœtu®
 
ResourûE¼Ü
 
ÿÂÙShowMIMETy³E¼Ü
(cÚ¡ 
ResourûRe¥Ú£
&) = 0;

191 
vœtu®
 
ResourûE¼Ü
 
feDÛsNÙExi¡E¼Ü
(cÚ¡ 
ResourûRe¥Ú£
&) = 0;

192 
vœtu®
 
ResourûE¼Ü
 
¶ugšWlHªdËLßdE¼Ü
(cÚ¡ 
ResourûRe¥Ú£
&) = 0;

194 
vœtu®
 
boŞ
 
shouldF®lBack
(cÚ¡ 
ResourûE¼Ü
&) = 0;

196 
vœtu®
 
boŞ
 
ÿnHªdËReque¡
(cÚ¡ 
ResourûReque¡
&) const = 0;

197 
vœtu®
 
boŞ
 
ÿnShowMIMETy³
(cÚ¡ 
SŒšg
& 
MIMETy³
) const = 0;

198 
vœtu®
 
boŞ
 
»´e£Á©iÚExi¡sFÜURLScheme
(cÚ¡ 
SŒšg
& 
URLScheme
) const = 0;

199 
vœtu®
 
SŒšg
 
g’”©edMIMETy³FÜURLScheme
(cÚ¡ SŒšg& 
URLScheme
) const = 0;

201 
vœtu®
 
äameLßdCom¶‘ed
() = 0;

202 
vœtu®
 
§veV›wS‹ToI‹m
(
Hi¡ÜyI‹m
*) = 0;

203 
vœtu®
 
»¡ÜeV›wS‹
() = 0;

204 
vœtu®
 
´ovisiÚ®LßdS¹ed
() = 0;

205 
vœtu®
 
didFšishLßd
() = 0;

206 
vœtu®
 
´•¬eFÜD©aSourûR•Ïûm’t
() = 0;

208 
vœtu®
 
	gPassRefPŒ
<
	gDocum’tLßd”
> 
ü—‹Docum’tLßd”
(cÚ¡ 
ResourûReque¡
&, cÚ¡ 
Sub¡™u‹D©a
&) = 0;

209 
vœtu®
 
£tT™Ë
(cÚ¡ 
SŒšg
& 
t™Ë
, cÚ¡ 
KURL
&) = 0;

211 
vœtu®
 
SŒšg
 
u£rAg’t
(cÚ¡ 
KURL
&) = 0;

213 
vœtu®
 
§vePÏtfÜmD©aToCachedF¿me
(
CachedF¿me
*) = 0;

214 
vœtu®
 
Œªs™iÚToComm™‹dFromCachedF¿me
(
CachedF¿me
*) = 0;

215 
vœtu®
 
Œªs™iÚToComm™‹dFÜNewPage
() = 0;

217 
vœtu®
 
boŞ
 
ÿnCachePage
() const = 0;

218 
vœtu®
 
dowÆßd
(
ResourûHªdË
*, cÚ¡ 
ResourûReque¡
&, cÚ¡ ResourûReque¡&, cÚ¡ 
ResourûRe¥Ú£
&) = 0;

220 
vœtu®
 
	gPassRefPŒ
<
	gF¿me
> 
ü—‹F¿me
(cÚ¡ 
KURL
& 
u¾
, cÚ¡ 
SŒšg
& 
Çme
, 
HTMLF¿meOwÃrEËm’t
* 
owÃrEËm’t
,

221 cÚ¡ 
SŒšg
& 
»ã¼”
, 
boŞ
 
®lowsSüŞlšg
, 
m¬gšWidth
, 
m¬gšHeight
) = 0;

222 
vœtu®
 
didT¿nsãrChdF¿meToNewDocum’t
() = 0;

223 
vœtu®
 
	gPassRefPŒ
<
	gWidg‘
> 
ü—‹Plugš
(cÚ¡ 
IÁSize
&, 
HTMLPlugInEËm’t
*, cÚ¡ 
KURL
&, cÚ¡ 
VeùÜ
<
SŒšg
>&, cÚ¡ VeùÜ<SŒšg>&, cÚ¡ SŒšg&, 
boŞ
 
lßdMªu®ly
) = 0;

224 
vœtu®
 
»dœeùD©aToPlugš
(
Widg‘
* 
¶ugšWidg‘
) = 0;

226 
vœtu®
 
	gPassRefPŒ
<
	gWidg‘
> 
ü—‹JavaAµËtWidg‘
(cÚ¡ 
IÁSize
&, 
HTMLAµËtEËm’t
*, cÚ¡ 
KURL
& 
ba£URL
, cÚ¡ 
VeùÜ
<
SŒšg
>& 
·¿mNames
, cÚ¡ VeùÜ<SŒšg>& 
·¿mV®ues
) = 0;

228 
vœtu®
 
di¥©chDidFaToS¹Plugš
(cÚ¡ 
PlugšV›w
*) const { }

230 
vœtu®
 
ObjeùCÚ‹ÁTy³
 
objeùCÚ‹ÁTy³
(cÚ¡ 
KURL
& 
u¾
, cÚ¡ 
SŒšg
& 
mimeTy³
) = 0;

231 
vœtu®
 
SŒšg
 
ov”rideMedŸTy³
() const = 0;

233 
vœtu®
 
di¥©chDidCË¬WšdowObjeùInWÜld
(
DOMW¿µ”WÜld
*) = 0;

234 
vœtu®
 
docum’tEËm’tAvaabË
() = 0;

235 
vœtu®
 
didP”fÜmFœ¡Navig©iÚ
() const = 0;

237 #ià
USE
(
V8
)

238 
vœtu®
 
didC»©eSütCÚ‹xtFÜF¿me
() = 0;

239 
vœtu®
 
didDe¡roySütCÚ‹xtFÜF¿me
() = 0;

240 
vœtu®
 
didC»©eIsŞ©edSütCÚ‹xt
() = 0;

243 
vœtu®
 
»gi¡”FÜIcÚNÙifiÿtiÚ
(
boŞ
 
li¡’
 = 
Œue
) = 0;

245 #ià
PLATFORM
(
MAC
)

246 #ià
ENABLE
(
MAC_JAVA_BRIDGE
)

247 
vœtu®
 
jobjeù
 
javaAµËt
(
NSV›w
*) {  0; }

249 
vœtu®
 
NSCachedURLRe¥Ú£
* 
wlCacheRe¥Ú£
(
Docum’tLßd”
*, 
id’tif›r
, NSCachedURLResponse*) const = 0;

251 #ià
USE
(
CFNETWORK
)

252 
vœtu®
 
boŞ
 
shouldCacheRe¥Ú£
(
Docum’tLßd”
*, 
id’tif›r
, cÚ¡ 
ResourûRe¥Ú£
&, cÚ¡ * 
d©a
, 
Ëngth
) = 0;

255 
vœtu®
 
boŞ
 
shouldU£PlugšDocum’t
(cÚ¡ 
SŒšg
& ) cÚ¡ {  
	gçl£
; }

256 
vœtu®
 
boŞ
 
shouldLßdMedŸEËm’tURL
(cÚ¡ 
KURL
&ècÚ¡ {  
	gŒue
; }

258 
vœtu®
 
didChªgeSüŞlOff£t
() { }

260 
vœtu®
 
boŞ
 
®lowJavaSüt
(boŞ 
’abËdP”S‘tšgs
è{  
	g’abËdP”S‘tšgs
; }

261 
vœtu®
 
boŞ
 
®lowPlugšs
(boŞ 
’abËdP”S‘tšgs
è{  
	g’abËdP”S‘tšgs
; }

262 
vœtu®
 
boŞ
 
®lowImages
(boŞ 
’abËdP”S‘tšgs
è{  
	g’abËdP”S‘tšgs
; }

269 
vœtu®
 
didNÙAÎowSüt
() { }

271 
vœtu®
 
didNÙAÎowPlugšs
() { }

	@FrameLoaderTypes.h

29 #iâdeà
F¿meLßd”Ty³s_h


30 
	#F¿meLßd”Ty³s_h


	)

32 
Çme¥aû
 
	gWebCÜe
 {

34 
	eF¿meS‹
 {

35 
	gF¿meS‹ProvisiÚ®
,

38 
	gF¿meS‹Comm™‹dPage
,

39 
	gF¿meS‹Com¶‘e


42 
	ePŞicyAùiÚ
 {

43 
	gPŞicyU£
,

44 
	gPŞicyDowÆßd
,

45 
	gPŞicyIgnÜe
,

49 
	eF¿meLßdTy³
 {

50 
	gF¿meLßdTy³Snd¬d
,

51 
	gF¿meLßdTy³Back
,

52 
	gF¿meLßdTy³FÜw¬d
,

53 
	gF¿meLßdTy³IndexedBackFÜw¬d
,

54 
	gF¿meLßdTy³R–ßd
,

56 
	gF¿meLßdTy³Same
 = 
F¿meLßdTy³R–ßd
 + 2,

57 
	gF¿meLßdTy³RedœeùW™hLockedBackFÜw¬dLi¡
,

58 
	gF¿meLßdTy³R•Ïû
,

59 
	gF¿meLßdTy³R–ßdFromOrigš
,

60 
	gF¿meLßdTy³BackWMLDeckNÙAcûssibË


63 
	eNavig©iÚTy³
 {

64 
	gNavig©iÚTy³LškClicked
,

65 
	gNavig©iÚTy³FÜmSubm™‹d
,

66 
	gNavig©iÚTy³BackFÜw¬d
,

67 
	gNavig©iÚTy³R–ßd
,

68 
	gNavig©iÚTy³FÜmResubm™‹d
,

69 
	gNavig©iÚTy³Oth”


72 
	eD©aba£PŞicy
 {

73 
	gD©aba£PŞicyStİ
,

74 
	gD©aba£PŞicyCÚtšue


77 
	eObjeùCÚ‹ÁTy³
 {

78 
	gObjeùCÚ‹ÁNÚe
,

79 
	gObjeùCÚ‹ÁImage
,

80 
	gObjeùCÚ‹ÁF¿me
,

81 
	gObjeùCÚ‹ÁN‘sÿ³Plugš
,

82 
	gObjeùCÚ‹ÁOth”Plugš


85 
	eUÆßdEv’tPŞicy
 {

86 
	gUÆßdEv’tPŞicyNÚe
,

87 
	gUÆßdEv’tPŞicyUÆßdOÆy
,

88 
	gUÆßdEv’tPŞicyUÆßdAndPageHide


91 
	eReã¼”PŞicy
 {

92 
	gS’dReã¼”
,

93 
	gNoReã¼”


96 
	eSªdboxFÏg
 {

97 
	gSªdboxNÚe
 = 0,

98 
	gSªdboxNavig©iÚ
 = 1,

99 
	gSªdboxPlugšs
 = 1 << 1,

100 
	gSªdboxOrigš
 = 1 << 2,

101 
	gSªdboxFÜms
 = 1 << 3,

102 
	gSªdboxSüts
 = 1 << 4,

103 
	gSªdboxAÎ
 = -1

106 
	eSecur™yCheckPŞicy
 {

107 
	gSkSecur™yCheck
,

108 
	gDoSecur™yCheck


111 
	eR—sÚFÜC®lšgAÎowPlugšs
 {

112 
	gAboutToIn¡ªtŸ‹Plugš
,

113 
	gNÙAboutToIn¡ªtŸ‹Plugš


116 
	tSªdboxFÏgs
;

	@HistoryController.cpp

2 #ifdeà
SSLAB__DEBUG


3 #iâdeà
SSLAB__QDATETIME


4 
	#SSLAB__QDATETIME


	)

5 
	~<QD©eTime
>

9 #ifdeà
SSLAB__DEBUG


10 #iâdeà
SSLAB__QTHREAD


11 
	#SSLAB__QTHREAD


	)

12 
	~<QTh»ad
>

45 
	~"cÚfig.h
"

46 
	~"Hi¡ÜyCÚŒŞËr.h
"

48 
	~"BackFÜw¬dLi¡.h
"

49 
	~"CachedPage.h
"

50 
	~"CSŒšg.h
"

51 
	~"Docum’tLßd”.h
"

52 
	~"F¿me.h
"

53 
	~"F¿meLßd”.h
"

54 
	~"F¿meLßd”Cl›Á.h
"

55 
	~"F¿meT»e.h
"

56 
	~"F¿meV›w.h
"

57 
	~"Hi¡ÜyI‹m.h
"

58 
	~"Loggšg.h
"

59 
	~"Page.h
"

60 
	~"PageCache.h
"

61 
	~"PageGroup.h
"

62 
	~"S‘tšgs.h
"

64 
Çme¥aû
 
	gWebCÜe
 {

66 
	gHi¡ÜyCÚŒŞËr
::
Hi¡ÜyCÚŒŞËr
(
F¿me
* 
äame
)

67 : 
m_äame
(
äame
)

69 #ifdeà
SSLAB__DEBUG


70 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

75 
	gHi¡ÜyCÚŒŞËr
::~
Hi¡ÜyCÚŒŞËr
()

77 #ifdeà
SSLAB__DEBUG


78 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

83 
	gHi¡ÜyCÚŒŞËr
::
§veSüŞlPos™iÚAndV›wS‹ToI‹m
(
Hi¡ÜyI‹m
* 
™em
)

85 #ifdeà
SSLAB__DEBUG


86 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

89 ià(!
	g™em
 || !
	gm_äame
->
v›w
())

92 
	g™em
->
£tSüŞlPošt
(
m_äame
->
v›w
()->
süŞlPos™iÚ
());

94 
	gm_äame
->
lßd”
()->
ş›Á
()->
§veV›wS‹ToI‹m
(
™em
);

108 
	gHi¡ÜyCÚŒŞËr
::
»¡ÜeSüŞlPos™iÚAndV›wS‹
()

110 #ifdeà
SSLAB__DEBUG


111 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

114 ià(!
	gm_äame
->
lßd”
()->
comm™‹dFœ¡R—lDocum’tLßd
())

117 
ASSERT
(
m_cu¼’tI‹m
);

124 ià(!
	gm_cu¼’tI‹m
)

129 
	gm_äame
->
lßd”
()->
ş›Á
()->
»¡ÜeV›wS‹
();

131 ià(
F¿meV›w
* 
	gv›w
 = 
m_äame
->
v›w
())

132 ià(!
v›w
->
wasSüŞËdByU£r
())

133 
v›w
->
£tSüŞlPos™iÚ
(
m_cu¼’tI‹m
->
süŞlPošt
());

136 
	gHi¡ÜyCÚŒŞËr
::
upd©eBackFÜw¬dLi¡FÜF¿gm’tSüŞl
()

138 #ifdeà
SSLAB__DEBUG


139 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

142 
upd©eBackFÜw¬dLi¡Cl³dAtT¬g‘
(
çl£
);

146 ià(!
	gm_´eviousI‹m
)

149 
ASSERT
(
m_cu¼’tI‹m
);

150 
	gm_cu¼’tI‹m
->
£tDocum’tSequ’ûNumb”
(
m_´eviousI‹m
->
docum’tSequ’ûNumb”
());

153 
	gHi¡ÜyCÚŒŞËr
::
§veDocum’tS‹
()

155 #ifdeà
SSLAB__DEBUG


156 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

161 ià(
	gm_äame
->
lßd”
()->
ü—tšgIn™ŸlEm±yDocum’t
())

175 
Hi¡ÜyI‹m
* 
	g™em
 = 
m_´eviousI‹m
 ? m_´eviousI‹m.
g‘
(è: 
m_cu¼’tI‹m
.get();

176 ià(!
	g™em
)

179 
Docum’t
* 
	gdocum’t
 = 
m_äame
->
docum’t
();

180 
ASSERT
(
docum’t
);

182 ià(
	g™em
->
isCu¼’tDocum’t
(
docum’t
)) {

183 
LOG
(
Lßdšg
, "WebCÜeLßdšg %s: savšg fÜm s‹Ø%p", 
m_äame
->
Œ“
()->
Çme
().
¡ršg
().
utf8
().
d©a
(), 
™em
);

184 
	g™em
->
£tDocum’tS‹
(
docum’t
->
fÜmEËm’tsS‹
());

190 
	gHi¡ÜyCÚŒŞËr
::
§veDocum’tAndSüŞlS‹
()

192 #ifdeà
SSLAB__DEBUG


193 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

196 
F¿me
* 
	gäame
 = 
m_äame
; f¿me; f¿mğ
äame
->
Œ“
()->
Œav”£Next
(m_frame)) {

197 
äame
->
lßd”
()->
hi¡Üy
()->
§veDocum’tS‹
();

198 
	gäame
->
lßd”
()->
hi¡Üy
()->
§veSüŞlPos™iÚAndV›wS‹ToI‹m
(
äame
->lßd”()->hi¡Üy()->
cu¼’tI‹m
());

202 
	gHi¡ÜyCÚŒŞËr
::
»¡ÜeDocum’tS‹
()

204 #ifdeà
SSLAB__DEBUG


205 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

208 
Docum’t
* 
	gdoc
 = 
m_äame
->
docum’t
();

210 
Hi¡ÜyI‹m
* 
	g™emToRe¡Üe
 = 0;

212 
	gm_äame
->
lßd”
()->
lßdTy³
()) {

213 
	gF¿meLßdTy³R–ßd
:

214 
F¿meLßdTy³R–ßdFromOrigš
:

215 
F¿meLßdTy³Same
:

216 
F¿meLßdTy³R•Ïû
:

218 
	gF¿meLßdTy³Back
:

219 
F¿meLßdTy³BackWMLDeckNÙAcûssibË
:

220 
F¿meLßdTy³FÜw¬d
:

221 
F¿meLßdTy³IndexedBackFÜw¬d
:

222 
F¿meLßdTy³RedœeùW™hLockedBackFÜw¬dLi¡
:

223 
F¿meLßdTy³Snd¬d
:

224 
™emToRe¡Üe
 = 
m_cu¼’tI‹m
.
g‘
();

227 ià(!
	g™emToRe¡Üe
)

230 
LOG
(
Lßdšg
, "WebCÜeLßdšg %s:„e¡Üšg fÜm s‹ from %p", 
m_äame
->
Œ“
()->
Çme
().
¡ršg
().
utf8
().
d©a
(), 
™emToRe¡Üe
);

231 
	gdoc
->
£tS‹FÜNewFÜmEËm’ts
(
™emToRe¡Üe
->
docum’tS‹
());

234 
	gHi¡ÜyCÚŒŞËr
::
šv®id©eCu¼’tI‹mCachedPage
()

236 #ifdeà
SSLAB__DEBUG


237 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

241 
CachedPage
* 
	gÿchedPage
 = 
·geCache
()->
g‘
(
cu¼’tI‹m
());

247 
ASSERT
(!
ÿchedPage
 || cachedPage->
docum’t
(è=ğ
m_äame
->document());

248 ià(
	gÿchedPage
 && cachedPage->
docum’t
(è=ğ
m_äame
->document()) {

249 
ÿchedPage
->
docum’t
()->
£tInPageCache
(
çl£
);

250 
	gÿchedPage
->
ş—r
();

253 ià(
	gÿchedPage
)

254 
·geCache
()->
»move
(
cu¼’tI‹m
());

259 
	gHi¡ÜyCÚŒŞËr
::
goToI‹m
(
Hi¡ÜyI‹m
* 
rg‘I‹m
, 
F¿meLßdTy³
 
ty³
)

261 #ifdeà
SSLAB__DEBUG


262 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

265 
ASSERT
(!
m_äame
->
Œ“
()->
·»Á
());

271 
Page
* 
	g·ge
 = 
m_äame
->
·ge
();

272 ià(!
	g·ge
)

274 ià(!
	gm_äame
->
lßd”
()->
ş›Á
()->
shouldGoToHi¡ÜyI‹m
(
rg‘I‹m
))

280 
BackFÜw¬dLi¡
* 
	gbfLi¡
 = 
·ge
->
backFÜw¬dLi¡
();

281 
Hi¡ÜyI‹m
* 
	gcu¼’tI‹m
 = 
bfLi¡
->
cu¼’tI‹m
();

282 
	gbfLi¡
->
goToI‹m
(
rg‘I‹m
);

283 
S‘tšgs
* 
	g£‰šgs
 = 
m_äame
->
£‰šgs
();

284 
	g·ge
->
£tGlob®Hi¡ÜyI‹m
((!
£‰šgs
 || s‘tšgs->
´iv©eBrowsšgEÇbËd
()è? 0 : 
rg‘I‹m
);

285 
»cursiveGoToI‹m
(
rg‘I‹m
, 
cu¼’tI‹m
, 
ty³
);

289 
boŞ
 
	gHi¡ÜyCÚŒŞËr
::
u¾sM©chI‹m
(
Hi¡ÜyI‹m
* 
™em
) const

291 #ifdeà
SSLAB__DEBUG


292 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

295 cÚ¡ 
	gKURL
& 
	gcu¼’tURL
 = 
m_äame
->
lßd”
()->
docum’tLßd”
()->
u¾
();

296 ià(!
equ®IgnÜšgF¿gm’tId’tif›r
(
cu¼’tURL
, 
™em
->
u¾
()))

297  
	gçl£
;

299 cÚ¡ 
	gHi¡ÜyI‹mVeùÜ
& 
	gchdI‹ms
 = 
™em
->
chd»n
();

301 
	gsize
 = 
chdI‹ms
.
size
();

302 
	gi
 = 0; i < 
	gsize
; ++i) {

303 
F¿me
* 
	gchdF¿me
 = 
m_äame
->
Œ“
()->
chd
(
chdI‹ms
[
i
]->
rg‘
());

304 ià(
	gchdF¿me
 && !chdF¿me->
lßd”
()->
hi¡Üy
()->
u¾sM©chI‹m
(
chdI‹ms
[
i
].
g‘
()))

305  
	gçl£
;

308  
	gŒue
;

311 
	gHi¡ÜyCÚŒŞËr
::
upd©eFÜBackFÜw¬dNavig©iÚ
()

313 #ifdeà
SSLAB__DEBUG


314 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

317 #ià!
LOG_DISABLED


318 ià(
	gm_äame
->
lßd”
()->
docum’tLßd”
())

319 
LOG
(
Hi¡Üy
, "WebCÜeHi¡Üy: Upd©šg Hi¡Üy fÜ back/fÜw¬d‚avig©iÚ iÀäam%s", 
m_äame
->
lßd”
()->
docum’tLßd”
()->
t™Ë
().
utf8
().
d©a
());

323 
§veSüŞlPos™iÚAndV›wS‹ToI‹m
(
m_´eviousI‹m
.
g‘
());

326 
	gHi¡ÜyCÚŒŞËr
::
upd©eFÜR–ßd
()

328 #ifdeà
SSLAB__DEBUG


329 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

332 #ià!
LOG_DISABLED


333 ià(
	gm_äame
->
lßd”
()->
docum’tLßd”
())

334 
LOG
(
Hi¡Üy
, "WebCÜeHi¡Üy: Upd©šg Hi¡Üy fÜ„–ßd iÀäam%s", 
m_äame
->
lßd”
()->
docum’tLßd”
()->
t™Ë
().
utf8
().
d©a
());

337 ià(
	gm_cu¼’tI‹m
) {

338 
·geCache
()->
»move
(
m_cu¼’tI‹m
.
g‘
());

340 ià(
	gm_äame
->
lßd”
()->
lßdTy³
(è=ğ
F¿meLßdTy³R–ßd
 || 
m_äame
->lßd”()->lßdTy³(è=ğ
F¿meLßdTy³R–ßdFromOrigš
)

341 
§veSüŞlPos™iÚAndV›wS‹ToI‹m
(
m_cu¼’tI‹m
.
g‘
());

344 ià(
	gm_äame
->
lßd”
()->
docum’tLßd”
()->
uÄ—chabËURL
().
isEm±y
())

345 
	gm_cu¼’tI‹m
->
£tURL
(
m_äame
->
lßd”
()->
docum’tLßd”
()->
»que¡URL
());

355 
	gHi¡ÜyCÚŒŞËr
::
upd©eFÜSnd¬dLßd
()

357 #ifdeà
SSLAB__DEBUG


358 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

361 
LOG
(
Hi¡Üy
, "WebCÜeHi¡Üy: Upd©šg Hi¡Üy fÜ Snd¬d Lßd iÀäam%s", 
m_äame
->
lßd”
()->
docum’tLßd”
()->
u¾
().
¡ršg
().
ascii
().
d©a
());

363 
F¿meLßd”
* 
	gäameLßd”
 = 
m_äame
->
lßd”
();

365 
S‘tšgs
* 
	g£‰šgs
 = 
m_äame
->
£‰šgs
();

366 
boŞ
 
	gÃedPrivacy
 = !
£‰šgs
 || s‘tšgs->
´iv©eBrowsšgEÇbËd
();

367 cÚ¡ 
	gKURL
& 
	ghi¡ÜyURL
 = 
äameLßd”
->
docum’tLßd”
()->
u¾FÜHi¡Üy
();

369 ià(!
	gäameLßd”
->
docum’tLßd”
()->
isCl›ÁRedœeù
()) {

370 ià(!
	ghi¡ÜyURL
.
isEm±y
()) {

371 
upd©eBackFÜw¬dLi¡Cl³dAtT¬g‘
(
Œue
);

372 ià(!
	gÃedPrivacy
) {

373 
	gäameLßd”
->
ş›Á
()->
upd©eGlob®Hi¡Üy
();

374 
	gäameLßd”
->
docum’tLßd”
()->
£tDidC»©eGlob®Hi¡ÜyEÁry
(
Œue
);

375 ià(
	gäameLßd”
->
docum’tLßd”
()->
uÄ—chabËURL
().
isEm±y
())

376 
	gäameLßd”
->
ş›Á
()->
upd©eGlob®Hi¡ÜyRedœeùLšks
();

378 ià(
Page
* 
	g·ge
 = 
m_äame
->
·ge
())

379 
·ge
->
£tGlob®Hi¡ÜyI‹m
(
ÃedPrivacy
 ? 0 :…age->
backFÜw¬dLi¡
()->
cu¼’tI‹m
());

381 } ià(
	gäameLßd”
->
docum’tLßd”
()->
uÄ—chabËURL
().
isEm±y
(è&& 
	gm_cu¼’tI‹m
) {

382 
	gm_cu¼’tI‹m
->
£tURL
(
äameLßd”
->
docum’tLßd”
()->
u¾
());

383 
	gm_cu¼’tI‹m
->
£tFÜmInfoFromReque¡
(
äameLßd”
->
docum’tLßd”
()->
»que¡
());

386 ià(!
	ghi¡ÜyURL
.
isEm±y
(è&& !
	gÃedPrivacy
) {

387 ià(
Page
* 
	g·ge
 = 
m_äame
->
·ge
())

388 
·ge
->
group
().
addVis™edLšk
(
hi¡ÜyURL
);

390 ià(!
	gäameLßd”
->
docum’tLßd”
()->
didC»©eGlob®Hi¡ÜyEÁry
(è&& f¿meLßd”->docum’tLßd”()->
uÄ—chabËURL
().
isEm±y
(è&& !äameLßd”->
u¾
().isEmpty())

391 
	gäameLßd”
->
ş›Á
()->
upd©eGlob®Hi¡ÜyRedœeùLšks
();

395 
	gHi¡ÜyCÚŒŞËr
::
upd©eFÜRedœeùW™hLockedBackFÜw¬dLi¡
()

397 #ifdeà
SSLAB__DEBUG


398 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

401 #ià!
LOG_DISABLED


402 ià(
	gm_äame
->
lßd”
()->
docum’tLßd”
())

403 
LOG
(
Hi¡Üy
, "WebCÜeHi¡Üy: Upd©šg Hi¡Üy fÜ„edœeù†ßd iÀäam%s", 
m_äame
->
lßd”
()->
docum’tLßd”
()->
t™Ë
().
utf8
().
d©a
());

406 
S‘tšgs
* 
	g£‰šgs
 = 
m_äame
->
£‰šgs
();

407 
boŞ
 
	gÃedPrivacy
 = !
£‰šgs
 || s‘tšgs->
´iv©eBrowsšgEÇbËd
();

408 cÚ¡ 
	gKURL
& 
	ghi¡ÜyURL
 = 
m_äame
->
lßd”
()->
docum’tLßd”
()->
u¾FÜHi¡Üy
();

410 ià(
	gm_äame
->
lßd”
()->
docum’tLßd”
()->
isCl›ÁRedœeù
()) {

411 ià(!
	gm_cu¼’tI‹m
 && !
	gm_äame
->
Œ“
()->
·»Á
()) {

412 ià(!
	ghi¡ÜyURL
.
isEm±y
()) {

413 
upd©eBackFÜw¬dLi¡Cl³dAtT¬g‘
(
Œue
);

414 ià(!
	gÃedPrivacy
) {

415 
	gm_äame
->
lßd”
()->
ş›Á
()->
upd©eGlob®Hi¡Üy
();

416 
	gm_äame
->
lßd”
()->
docum’tLßd”
()->
£tDidC»©eGlob®Hi¡ÜyEÁry
(
Œue
);

417 ià(
	gm_äame
->
lßd”
()->
docum’tLßd”
()->
uÄ—chabËURL
().
isEm±y
())

418 
	gm_äame
->
lßd”
()->
ş›Á
()->
upd©eGlob®Hi¡ÜyRedœeùLšks
();

420 ià(
Page
* 
	g·ge
 = 
m_äame
->
·ge
())

421 
·ge
->
£tGlob®Hi¡ÜyI‹m
(
ÃedPrivacy
 ? 0 :…age->
backFÜw¬dLi¡
()->
cu¼’tI‹m
());

424 ià(
	gm_cu¼’tI‹m
) {

425 
	gm_cu¼’tI‹m
->
£tURL
(
m_äame
->
lßd”
()->
docum’tLßd”
()->
u¾
());

426 
	gm_cu¼’tI‹m
->
£tFÜmInfoFromReque¡
(
m_äame
->
lßd”
()->
docum’tLßd”
()->
»que¡
());

429 
F¿me
* 
	g·»ÁF¿me
 = 
m_äame
->
Œ“
()->
·»Á
();

430 ià(
	g·»ÁF¿me
 &&…¬’tF¿me->
lßd”
()->
hi¡Üy
()->
	gm_cu¼’tI‹m
)

431 
	g·»ÁF¿me
->
lßd”
()->
hi¡Üy
()->
	gm_cu¼’tI‹m
->
£tChdI‹m
(
ü—‹I‹m
(
Œue
));

434 ià(!
	ghi¡ÜyURL
.
isEm±y
(è&& !
	gÃedPrivacy
) {

435 ià(
Page
* 
	g·ge
 = 
m_äame
->
·ge
())

436 
·ge
->
group
().
addVis™edLšk
(
hi¡ÜyURL
);

438 ià(!
	gm_äame
->
lßd”
()->
docum’tLßd”
()->
didC»©eGlob®Hi¡ÜyEÁry
(è&& m_äame->lßd”()->docum’tLßd”()->
uÄ—chabËURL
().
isEm±y
(è&& !m_äame->lßd”()->
u¾
().isEmpty())

439 
	gm_äame
->
lßd”
()->
ş›Á
()->
upd©eGlob®Hi¡ÜyRedœeùLšks
();

443 
	gHi¡ÜyCÚŒŞËr
::
upd©eFÜCl›ÁRedœeù
()

445 #ifdeà
SSLAB__DEBUG


446 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

449 #ià!
LOG_DISABLED


450 ià(
	gm_äame
->
lßd”
()->
docum’tLßd”
())

451 
LOG
(
Hi¡Üy
, "WebCÜeHi¡Üy: Upd©šg Hi¡Üy fÜ cl›Á„edœeù iÀäam%s", 
m_äame
->
lßd”
()->
docum’tLßd”
()->
t™Ë
().
utf8
().
d©a
());

456 ià(
	gm_cu¼’tI‹m
) {

457 
	gm_cu¼’tI‹m
->
ş—rDocum’tS‹
();

458 
	gm_cu¼’tI‹m
->
ş—rSüŞlPošt
();

461 
S‘tšgs
* 
	g£‰šgs
 = 
m_äame
->
£‰šgs
();

462 
boŞ
 
	gÃedPrivacy
 = !
£‰šgs
 || s‘tšgs->
´iv©eBrowsšgEÇbËd
();

463 cÚ¡ 
	gKURL
& 
	ghi¡ÜyURL
 = 
m_äame
->
lßd”
()->
docum’tLßd”
()->
u¾FÜHi¡Üy
();

465 ià(!
	ghi¡ÜyURL
.
isEm±y
(è&& !
	gÃedPrivacy
) {

466 ià(
Page
* 
	g·ge
 = 
m_äame
->
·ge
())

467 
·ge
->
group
().
addVis™edLšk
(
hi¡ÜyURL
);

471 
	gHi¡ÜyCÚŒŞËr
::
upd©eFÜComm™
()

473 #ifdeà
SSLAB__DEBUG


474 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

477 
F¿meLßd”
* 
	gäameLßd”
 = 
m_äame
->
lßd”
();

478 #ià!
LOG_DISABLED


479 ià(
	gäameLßd”
->
docum’tLßd”
())

480 
LOG
(
Hi¡Üy
, "WebCÜeHi¡Üy: Upd©šg Hi¡Üy fÜ comm™ iÀäam%s", 
äameLßd”
->
docum’tLßd”
()->
t™Ë
().
utf8
().
d©a
());

482 
F¿meLßdTy³
 
	gty³
 = 
äameLßd”
->
lßdTy³
();

483 ià(
isBackFÜw¬dLßdTy³
(
ty³
) ||

484 ((
	gty³
 =ğ
F¿meLßdTy³R–ßd
 || 
ty³
 =ğ
F¿meLßdTy³R–ßdFromOrigš
è&& !
äameLßd”
->
´ovisiÚ®Docum’tLßd”
()->
uÄ—chabËURL
().
isEm±y
())) {

489 
m_´eviousI‹m
 = 
m_cu¼’tI‹m
;

490 
ASSERT
(
m_´ovisiÚ®I‹m
);

491 
	gm_cu¼’tI‹m
 = 
m_´ovisiÚ®I‹m
;

492 
	gm_´ovisiÚ®I‹m
 = 0;

496 
	gHi¡ÜyCÚŒŞËr
::
upd©eFÜSameDocum’tNavig©iÚ
()

498 #ifdeà
SSLAB__DEBUG


499 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

502 ià(
	gm_äame
->
lßd”
()->
u¾
().
isEm±y
())

505 
S‘tšgs
* 
	g£‰šgs
 = 
m_äame
->
£‰šgs
();

506 ià(!
	g£‰šgs
 || s‘tšgs->
´iv©eBrowsšgEÇbËd
())

509 
Page
* 
	g·ge
 = 
m_äame
->
·ge
();

510 ià(!
	g·ge
)

513 
	g·ge
->
group
().
addVis™edLšk
(
m_äame
->
lßd”
()->
u¾
());

516 
	gHi¡ÜyCÚŒŞËr
::
upd©eFÜF¿meLßdCom¶‘ed
()

518 #ifdeà
SSLAB__DEBUG


519 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

524 
	gm_´eviousI‹m
 = 0;

527 
	gHi¡ÜyCÚŒŞËr
::
£tCu¼’tI‹m
(
Hi¡ÜyI‹m
* 
™em
)

529 #ifdeà
SSLAB__DEBUG


530 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

533 
	gm_cu¼’tI‹m
 = 
™em
;

536 
	gHi¡ÜyCÚŒŞËr
::
£tCu¼’tI‹mT™Ë
(cÚ¡ 
SŒšg
& 
t™Ë
)

538 #ifdeà
SSLAB__DEBUG


539 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

542 ià(
	gm_cu¼’tI‹m
)

543 
	gm_cu¼’tI‹m
->
£tT™Ë
(
t™Ë
);

546 
	gHi¡ÜyCÚŒŞËr
::
£tProvisiÚ®I‹m
(
Hi¡ÜyI‹m
* 
™em
)

548 #ifdeà
SSLAB__DEBUG


549 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

552 
	gm_´ovisiÚ®I‹m
 = 
™em
;

555 
	gPassRefPŒ
<
	gHi¡ÜyI‹m
> 
	gHi¡ÜyCÚŒŞËr
::
ü—‹I‹m
(
boŞ
 
u£Origš®
)

557 #ifdeà
SSLAB__DEBUG


558 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

561 
Docum’tLßd”
* 
	gdocLßd”
 = 
m_äame
->
lßd”
()->
docum’tLßd”
();

563 
KURL
 
	guÄ—chabËURL
 = 
docLßd”
 ? docLßd”->
uÄ—chabËURL
() : KURL();

565 
KURL
 
	gu¾
;

566 
KURL
 
	gÜigš®URL
;

568 ià(!
	guÄ—chabËURL
.
isEm±y
()) {

569 
	gu¾
 = 
uÄ—chabËURL
;

570 
	gÜigš®URL
 = 
uÄ—chabËURL
;

572 
	gÜigš®URL
 = 
docLßd”
 ? docLßd”->
Üigš®URL
(è: 
KURL
();

573 ià(
	gu£Origš®
)

574 
	gu¾
 = 
Üigš®URL
;

575 ià(
	gdocLßd”
)

576 
	gu¾
 = 
docLßd”
->
»que¡URL
();

579 
LOG
(
Hi¡Üy
, "WebCÜeHi¡Üy: C»©šg i‹m fÜ %s", 
u¾
.
¡ršg
().
ascii
().
d©a
());

586 ià(
	gu¾
.
isEm±y
())

587 
	gu¾
 = 
bÏnkURL
();

588 ià(
	gÜigš®URL
.
isEm±y
())

589 
	gÜigš®URL
 = 
bÏnkURL
();

591 
F¿me
* 
	g·»ÁF¿me
 = 
m_äame
->
Œ“
()->
·»Á
();

592 
SŒšg
 
	g·»Á
 = 
·»ÁF¿me
 ?…¬’tF¿me->
Œ“
()->
Çme
() : "";

593 
SŒšg
 
	gt™Ë
 = 
docLßd”
 ? docLßd”->
t™Ë
() : "";

595 
	gRefPŒ
<
	gHi¡ÜyI‹m
> 
	g™em
 = 
Hi¡ÜyI‹m
::
ü—‹
(
u¾
, 
m_äame
->
Œ“
()->
Çme
(), 
·»Á
, 
t™Ë
);

596 
	g™em
->
£tOrigš®URLSŒšg
(
Üigš®URL
.
¡ršg
());

598 ià(!
	guÄ—chabËURL
.
isEm±y
(è|| !
	gdocLßd”
 || docLßd”->
»¥Ú£
().
h‰pStusCode
() >= 400)

599 
™em
->
£tLa¡Vis™WasFau»
(
Œue
);

602 ià(
	gdocLßd”
) {

603 ià(
	gu£Origš®
)

604 
	g™em
->
£tFÜmInfoFromReque¡
(
docLßd”
->
Üigš®Reque¡
());

606 
	g™em
->
£tFÜmInfoFromReque¡
(
docLßd”
->
»que¡
());

610 
	gm_´eviousI‹m
 = 
m_cu¼’tI‹m
;

611 
	gm_cu¼’tI‹m
 = 
™em
;

613  
	g™em
.
»Ëa£
();

616 
	gPassRefPŒ
<
	gHi¡ÜyI‹m
> 
	gHi¡ÜyCÚŒŞËr
::
ü—‹I‹mT»e
(
F¿me
* 
rg‘F¿me
, 
boŞ
 
şAtT¬g‘
)

618 #ifdeà
SSLAB__DEBUG


619 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

622 
	gRefPŒ
<
	gHi¡ÜyI‹m
> 
	gbfI‹m
 = 
ü—‹I‹m
(
m_äame
->
Œ“
()->
·»Á
(è? 
Œue
 : 
çl£
);

623 ià(
	gm_´eviousI‹m
)

624 
§veSüŞlPos™iÚAndV›wS‹ToI‹m
(
m_´eviousI‹m
.
g‘
());

625 ià(!(
	gşAtT¬g‘
 && 
	gm_äame
 =ğ
rg‘F¿me
)) {

627 
§veDocum’tS‹
();

628 
F¿me
* 
	gchd
 = 
m_äame
->
Œ“
()->
fœ¡Chd
(); chd; chd = 
chd
->Œ“()->
ÃxtSiblšg
()) {

629 
F¿meLßd”
* 
chdLßd”
 = 
chd
->
lßd”
();

630 
boŞ
 
	ghasChdLßded
 = 
chdLßd”
->
äameHasLßded
();

636 ià(!(!
	ghasChdLßded
 && 
	gchdLßd”
->
isHo¡edByObjeùEËm’t
()))

637 
	gbfI‹m
->
addChdI‹m
(
chdLßd”
->
hi¡Üy
()->
ü—‹I‹mT»e
(
rg‘F¿me
, 
şAtT¬g‘
));

640 ià(
	gm_äame
 =ğ
rg‘F¿me
)

641 
bfI‹m
->
£tIsT¬g‘I‹m
(
Œue
);

642  
	gbfI‹m
;

649 
	gHi¡ÜyCÚŒŞËr
::
»cursiveGoToI‹m
(
Hi¡ÜyI‹m
* 
™em
, Hi¡ÜyI‹m* 
äomI‹m
, 
F¿meLßdTy³
 
ty³
)

651 #ifdeà
SSLAB__DEBUG


652 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

655 
ASSERT
(
™em
);

656 
ASSERT
(
äomI‹m
);

658 
KURL
 
	g™emURL
 = 
™em
->
u¾
();

659 
KURL
 
	gcu¼’tURL
;

660 ià(
	gm_äame
->
lßd”
()->
docum’tLßd”
())

661 
	gcu¼’tURL
 = 
m_äame
->
lßd”
()->
docum’tLßd”
()->
u¾
();

669 ià(!
	g™em
->
isT¬g‘I‹m
() &&

670 
	g™emURL
 =ğ
cu¼’tURL
 &&

671 ((
m_äame
->
Œ“
()->
Çme
().
isEm±y
(è&& 
™em
->
rg‘
().isEmpty()) || m_frame->tree()->name() == item->target()) &&

672 
chdF¿mesM©chI‹m
(
™em
))

676 
ASSERT
(!
m_´eviousI‹m
);

677 
§veDocum’tS‹
();

678 
§veSüŞlPos™iÚAndV›wS‹ToI‹m
(
m_cu¼’tI‹m
.
g‘
());

680 ià(
F¿meV›w
* 
	gv›w
 = 
m_äame
->
v›w
())

681 
v›w
->
£tWasSüŞËdByU£r
(
çl£
);

683 
	gm_cu¼’tI‹m
 = 
™em
;

686 
»¡ÜeDocum’tS‹
();

689 
»¡ÜeSüŞlPos™iÚAndV›wS‹
();

691 cÚ¡ 
	gHi¡ÜyI‹mVeùÜ
& 
	gchdI‹ms
 = 
™em
->
chd»n
();

693 
	gsize
 = 
chdI‹ms
.
size
();

694 
	gi
 = 0; i < 
	gsize
; ++i) {

695 
SŒšg
 
	gchdF¿meName
 = 
chdI‹ms
[
i
]->
rg‘
();

696 
Hi¡ÜyI‹m
* 
	gäomChdI‹m
 = 
äomI‹m
->
chdI‹mW™hT¬g‘
(
chdF¿meName
);

697 
ASSERT
(
äomChdI‹m
 || 
äomI‹m
->
isT¬g‘I‹m
());

698 
F¿me
* 
	gchdF¿me
 = 
m_äame
->
Œ“
()->
chd
(
chdF¿meName
);

699 
ASSERT
(
chdF¿me
);

700 
	gchdF¿me
->
lßd”
()->
hi¡Üy
()->
»cursiveGoToI‹m
(
chdI‹ms
[
i
].
g‘
(), 
äomChdI‹m
, 
ty³
);

703 
	gm_äame
->
lßd”
()->
lßdI‹m
(
™em
, 
ty³
);

709 
boŞ
 
	gHi¡ÜyCÚŒŞËr
::
chdF¿mesM©chI‹m
(
Hi¡ÜyI‹m
* 
™em
) const

711 #ifdeà
SSLAB__DEBUG


712 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

715 cÚ¡ 
	gHi¡ÜyI‹mVeùÜ
& 
	gchdI‹ms
 = 
™em
->
chd»n
();

716 ià(
	gchdI‹ms
.
size
(è!ğ
m_äame
->
Œ“
()->
chdCouÁ
())

717  
çl£
;

719 
	gsize
 = 
chdI‹ms
.
size
();

720 
	gi
 = 0; i < 
	gsize
; ++i) {

721 ià(!
	gm_äame
->
Œ“
()->
chd
(
chdI‹ms
[
i
]->
rg‘
()))

722  
	gçl£
;

726  
	gŒue
;

729 
	gHi¡ÜyCÚŒŞËr
::
upd©eBackFÜw¬dLi¡Cl³dAtT¬g‘
(
boŞ
 
doCl
)

731 #ifdeà
SSLAB__DEBUG


732 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

740 
Page
* 
	g·ge
 = 
m_äame
->
·ge
();

741 ià(!
	g·ge
)

744 ià(
	gm_äame
->
lßd”
()->
docum’tLßd”
()->
u¾FÜHi¡Üy
().
isEm±y
())

747 
F¿me
* 
	gmašF¿me
 = 
·ge
->
mašF¿me
();

748 
ASSERT
(
mašF¿me
);

749 
F¿meLßd”
* 
	gäameLßd”
 = 
mašF¿me
->
lßd”
();

751 
	gäameLßd”
->
checkDidP”fÜmFœ¡Navig©iÚ
();

753 
	gRefPŒ
<
	gHi¡ÜyI‹m
> 
	g™em
 = 
äameLßd”
->
hi¡Üy
()->
ü—‹I‹mT»e
(
m_äame
, 
doCl
);

754 
LOG
(
BackFÜw¬d
, "WebCÜeBackFÜw¬d - Addšg backfÜw¬d i‹m %°fÜ f¿m%s", 
™em
.
g‘
(), 
m_äame
->
lßd”
()->
docum’tLßd”
()->
u¾
().
¡ršg
().
ascii
().
d©a
());

755 
	g·ge
->
backFÜw¬dLi¡
()->
addI‹m
(
™em
);

758 
	gHi¡ÜyCÚŒŞËr
::
pushS‹
(
PassRefPŒ
<
S”ŸlizedSütV®ue
> 
¡©eObjeù
, cÚ¡ 
SŒšg
& 
t™Ë
, cÚ¡ SŒšg& 
u¾SŒšg
)

760 #ifdeà
SSLAB__DEBUG


761 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

764 
Page
* 
	g·ge
 = 
m_äame
->
·ge
();

765 
ASSERT
(
·ge
);

768 
	gRefPŒ
<
	gHi¡ÜyI‹m
> 
	g™em
 = 
ü—‹I‹mT»e
(
m_äame
, 
çl£
);

769 
ASSERT
(
™em
->
isT¬g‘I‹m
());

772 
	g™em
->
£tT™Ë
(
t™Ë
);

773 
	g™em
->
£tS‹Objeù
(
¡©eObjeù
);

774 
	g™em
->
£tURLSŒšg
(
u¾SŒšg
);

778 
	g™em
->
£tDocum’tSequ’ûNumb”
(
m_´eviousI‹m
->
docum’tSequ’ûNumb”
());

780 
	g·ge
->
backFÜw¬dLi¡
()->
pushS‹I‹m
(
™em
.
»Ëa£
());

783 
	gHi¡ÜyCÚŒŞËr
::
»¶aûS‹
(
PassRefPŒ
<
S”ŸlizedSütV®ue
> 
¡©eObjeù
, cÚ¡ 
SŒšg
& 
t™Ë
, cÚ¡ SŒšg& 
u¾SŒšg
)

785 #ifdeà
SSLAB__DEBUG


786 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

791 ià(!
	gm_cu¼’tI‹m
) {

792 
ASSERT_NOT_REACHED
();

796 ià(!
	gu¾SŒšg
.
isEm±y
())

797 
	gm_cu¼’tI‹m
->
£tURLSŒšg
(
u¾SŒšg
);

798 
	gm_cu¼’tI‹m
->
£tT™Ë
(
t™Ë
);

799 
	gm_cu¼’tI‹m
->
£tS‹Objeù
(
¡©eObjeù
);

	@HistoryController.h

30 #iâdeà
Hi¡ÜyCÚŒŞËr_h


31 
	#Hi¡ÜyCÚŒŞËr_h


	)

33 
	~"F¿meLßd”Ty³s.h
"

34 
	~"PÏtfÜmSŒšg.h
"

35 
	~<wtf/NÚcİyabË.h
>

36 
	~<wtf/RefPŒ.h
>

38 
Çme¥aû
 
	gWebCÜe
 {

40 
şass
 
	gF¿me
;

41 
şass
 
	gHi¡ÜyI‹m
;

42 
şass
 
	gS”ŸlizedSütV®ue
;

44 şas 
	cHi¡ÜyCÚŒŞËr
 : 
public
 
NÚcİyabË
 {

45 
public
:

46 
Hi¡ÜyCÚŒŞËr
(
F¿me
*);

47 ~
Hi¡ÜyCÚŒŞËr
();

49 
§veSüŞlPos™iÚAndV›wS‹ToI‹m
(
Hi¡ÜyI‹m
*);

50 
»¡ÜeSüŞlPos™iÚAndV›wS‹
();

52 
upd©eBackFÜw¬dLi¡FÜF¿gm’tSüŞl
();

54 
§veDocum’tS‹
();

55 
§veDocum’tAndSüŞlS‹
();

56 
»¡ÜeDocum’tS‹
();

58 
šv®id©eCu¼’tI‹mCachedPage
();

60 
goToI‹m
(
Hi¡ÜyI‹m
*, 
F¿meLßdTy³
);

61 
boŞ
 
u¾sM©chI‹m
(
Hi¡ÜyI‹m
*) const;

63 
upd©eFÜBackFÜw¬dNavig©iÚ
();

64 
upd©eFÜR–ßd
();

65 
upd©eFÜSnd¬dLßd
();

66 
upd©eFÜRedœeùW™hLockedBackFÜw¬dLi¡
();

67 
upd©eFÜCl›ÁRedœeù
();

68 
upd©eFÜComm™
();

69 
upd©eFÜSameDocum’tNavig©iÚ
();

70 
upd©eFÜF¿meLßdCom¶‘ed
();

72 
Hi¡ÜyI‹m
* 
cu¼’tI‹m
(ècÚ¡ {  
	gm_cu¼’tI‹m
.
g‘
(); }

73 
£tCu¼’tI‹m
(
Hi¡ÜyI‹m
*);

74 
£tCu¼’tI‹mT™Ë
(cÚ¡ 
SŒšg
&);

76 
Hi¡ÜyI‹m
* 
´ovisiÚ®I‹m
(ècÚ¡ {  
	gm_´ovisiÚ®I‹m
.
g‘
(); }

77 
£tProvisiÚ®I‹m
(
Hi¡ÜyI‹m
*);

79 
pushS‹
(
PassRefPŒ
<
S”ŸlizedSütV®ue
>, cÚ¡ 
SŒšg
& 
t™Ë
, cÚ¡ SŒšg& 
u¾
);

80 
»¶aûS‹
(
PassRefPŒ
<
S”ŸlizedSütV®ue
>, cÚ¡ 
SŒšg
& 
t™Ë
, cÚ¡ SŒšg& 
u¾
);

82 
	g´iv©e
:

83 
PassRefPŒ
<
Hi¡ÜyI‹m
> 
ü—‹I‹m
(
boŞ
 
u£Origš®
);

84 
	gPassRefPŒ
<
	gHi¡ÜyI‹m
> 
ü—‹I‹mT»e
(
F¿me
* 
rg‘F¿me
, 
boŞ
 
şAtT¬g‘
);

86 
»cursiveGoToI‹m
(
Hi¡ÜyI‹m
*, Hi¡ÜyI‹m*, 
F¿meLßdTy³
);

87 
boŞ
 
chdF¿mesM©chI‹m
(
Hi¡ÜyI‹m
*) const;

88 
upd©eBackFÜw¬dLi¡Cl³dAtT¬g‘
(
boŞ
 
doCl
);

90 
F¿me
* 
	gm_äame
;

92 
	gRefPŒ
<
	gHi¡ÜyI‹m
> 
	gm_cu¼’tI‹m
;

93 
	gRefPŒ
<
	gHi¡ÜyI‹m
> 
	gm_´eviousI‹m
;

94 
	gRefPŒ
<
	gHi¡ÜyI‹m
> 
	gm_´ovisiÚ®I‹m
;

	@ImageDocument.cpp

2 #ifdeà
SSLAB__DEBUG


3 #iâdeà
SSLAB__QDATETIME


4 
	#SSLAB__QDATETIME


	)

5 
	~<QD©eTime
>

9 #ifdeà
SSLAB__DEBUG


10 #iâdeà
SSLAB__QTHREAD


11 
	#SSLAB__QTHREAD


	)

12 
	~<QTh»ad
>

39 
	~"cÚfig.h
"

40 
	~"ImageDocum’t.h
"

42 
	~"CSSStyËDeş¬©iÚ.h
"

43 
	~"CachedImage.h
"

44 
	~"Docum’tLßd”.h
"

45 
	~"EËm’t.h
"

46 
	~"Ev’tLi¡’”.h
"

47 
	~"Ev’tNames.h
"

48 
	~"F¿me.h
"

49 
	~"F¿meLßd”.h
"

50 
	~"F¿meLßd”Cl›Á.h
"

51 
	~"F¿meV›w.h
"

52 
	~"HTMLImageEËm’t.h
"

53 
	~"HTMLNames.h
"

54 
	~"LoÿlizedSŒšgs.h
"

55 
	~"Mou£Ev’t.h
"

56 
	~"NÙIm¶em’‹d.h
"

57 
	~"Page.h
"

58 
	~"Segm’‹dSŒšg.h
"

59 
	~"S‘tšgs.h
"

60 
	~"Text.h
"

61 
	~"XMLTok’iz”.h
"

63 
usšg
 
	g¡d
::
mš
;

65 
Çme¥aû
 
	gWebCÜe
 {

67 
usšg
 
Çme¥aû
 
	gHTMLNames
;

69 şas 
	cImageEv’tLi¡’”
 : 
public
 
Ev’tLi¡’”
 {

70 
public
:

71 
PassRefPŒ
<
ImageEv’tLi¡’”
> 
ü—‹
(
ImageDocum’t
* 
docum’t
è{  
adİtRef
(
Ãw
 ImageEventListener(document)); }

72 cÚ¡ 
ImageEv’tLi¡’”
* 
ÿ¡
(cÚ¡ 
Ev’tLi¡’”
* 
li¡’”
)

74  
	gli¡’”
->
ty³
(è=ğ
ImageEv’tLi¡’”Ty³


75 ? 
¡©ic_ÿ¡
<cÚ¡ 
ImageEv’tLi¡’”
*>(
li¡’”
)

79 
vœtu®
 
boŞ
 
	gİ”©Ü
==(cÚ¡ 
Ev’tLi¡’”
& 
Ùh”
);

81 
	g´iv©e
:

82 
ImageEv’tLi¡’”
(
ImageDocum’t
* 
docum’t
)

83 : 
Ev’tLi¡’”
(
ImageEv’tLi¡’”Ty³
)

84 , 
m_doc
(
docum’t
)

88 
vœtu®
 
hªdËEv’t
(
SütExecutiÚCÚ‹xt
*, 
Ev’t
*);

90 
ImageDocum’t
* 
	gm_doc
;

93 şas 
	cImageTok’iz”
 : 
public
 
Tok’iz”
 {

94 
public
:

95 
ImageTok’iz”
(
ImageDocum’t
* 
doc
è: 
m_doc
(doc) {}

97 
vœtu®
 
wr™e
(cÚ¡ 
Segm’‹dSŒšg
&, 
boŞ
 
­³ndD©a
);

98 
vœtu®
 
fšish
();

99 
vœtu®
 
boŞ
 
isWa™šgFÜSüts
() const;

101 
vœtu®
 
boŞ
 
wªtsRawD©a
(ècÚ¡ {  
	gŒue
; }

102 
vœtu®
 
boŞ
 
wr™eRawD©a
(cÚ¡ * 
d©a
, 
Ën
);

104 
	g´iv©e
:

105 
ImageDocum’t
* 
m_doc
;

108 şas 
	cImageDocum’tEËm’t
 : 
public
 
HTMLImageEËm’t
 {

109 
public
:

110 
ImageDocum’tEËm’t
(
ImageDocum’t
* 
doc
)

111 : 
HTMLImageEËm’t
(
imgTag
, 
doc
)

112 , 
m_imageDocum’t
(
doc
)

116 
	gvœtu®
 ~
ImageDocum’tEËm’t
();

117 
vœtu®
 
wlMoveToNewOwÃrDocum’t
();

119 
	g´iv©e
:

120 
ImageDocum’t
* 
m_imageDocum’t
;

125 
	gImageTok’iz”
::
	$wr™e
(cÚ¡ 
Segm’‹dSŒšg
&, 
boŞ
)

127 #ifdeà
SSLAB__DEBUG


128 
	`qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
	`cu¼’tD©eTime
().
	`toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
	`toAscii
().
	`d©a
(), 
QTh»ad
::
	`cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

132 
	`nÙIm¶em’‹d
();

133 
	}
}

135 
boŞ
 
	gImageTok’iz”
::
	$wr™eRawD©a
(const *, )

137 #ifdeà
SSLAB__DEBUG


138 
	`qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
	`cu¼’tD©eTime
().
	`toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
	`toAscii
().
	`d©a
(), 
QTh»ad
::
	`cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

141 
F¿me
* 
äame
 = 
m_doc
->
	`äame
();

142 
S‘tšgs
* 
£‰šgs
 = 
äame
->
	`£‰šgs
();

143 ià(!
äame
->
	`lßd”
()->
	`ş›Á
()->
	`®lowImages
(!
£‰šgs
 || s‘tšgs->
	`¬eImagesEÇbËd
()))

144  
çl£
;

146 
CachedImage
* 
ÿchedImage
 = 
m_doc
->
	`ÿchedImage
();

147 
ÿchedImage
->
	`d©a
(
äame
->
	`lßd”
()->
	`docum’tLßd”
()->
	`mašResourûD©a
(), 
çl£
);

149 
m_doc
->
	`imageChªged
();

151  
çl£
;

152 
	}
}

154 
	gImageTok’iz”
::
	$fšish
()

156 #ifdeà
SSLAB__DEBUG


157 
	`qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
	`cu¼’tD©eTime
().
	`toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
	`toAscii
().
	`d©a
(), 
QTh»ad
::
	`cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

160 ià(!
m_·r£rStİ³d
 && 
m_doc
->
	`imageEËm’t
()) {

161 
CachedImage
* 
ÿchedImage
 = 
m_doc
->
	`ÿchedImage
();

162 
RefPŒ
<
Sh¬edBufãr
> 
d©a
 = 
m_doc
->
	`äame
()->
	`lßd”
()->
	`docum’tLßd”
()->
	`mašResourûD©a
();

166 ià(
m_doc
->
	`äame
()->
	`lßd”
()->
	`docum’tLßd”
()->
	`isLßdšgMuÉ¬tCÚ‹Á
())

167 
d©a
 = d©a->
	`cİy
();

169 
ÿchedImage
->
	`d©a
(
d©a
.
	`»Ëa£
(), 
Œue
);

170 
ÿchedImage
->
	`fšish
();

172 
ÿchedImage
->
	`£tRe¥Ú£
(
m_doc
->
	`äame
()->
	`lßd”
()->
	`docum’tLßd”
()->
	`»¥Ú£
());

174 
IÁSize
 
size
 = 
ÿchedImage
->
	`imageSize
(
m_doc
->
	`äame
()->
	`·geZoomFaùÜ
());

175 ià(
size
.
	`width
()) {

178 
SŒšg
 
feName
 = 
	`decodeURLEsÿ³Sequ’ûs
(
m_doc
->
	`u¾
().
	`Ï¡P©hCompÚ’t
());

179 ià(
feName
.
	`isEm±y
())

180 
feName
 = 
m_doc
->
	`u¾
().
	`ho¡
();

181 
m_doc
->
	`£tT™Ë
(
	`imageT™Ë
(
feName
, 
size
));

184 
m_doc
->
	`imageChªged
();

187 
m_doc
->
	`fšishedP¬sšg
();

188 
	}
}

190 
boŞ
 
	gImageTok’iz”
::
	$isWa™šgFÜSüts
() const

192 #ifdeà
SSLAB__DEBUG


193 
	`qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
	`cu¼’tD©eTime
().
	`toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
	`toAscii
().
	`d©a
(), 
QTh»ad
::
	`cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

197  
çl£
;

198 
	}
}

202 
	gImageDocum’t
::
	$ImageDocum’t
(
F¿me
* 
äame
)

203 : 
	`HTMLDocum’t
(
äame
)

204 , 
	`m_imageEËm’t
(0)

205 , 
	`m_imageSizeIsKnown
(
çl£
)

206 , 
	`m_didShrškImage
(
çl£
)

207 , 
	`m_shouldShrškImage
(
	$shouldShrškToF™
())

209 #ifdeà
SSLAB__DEBUG


210 
	`qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
	`cu¼’tD©eTime
().
	`toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
	`toAscii
().
	`d©a
(), 
QTh»ad
::
	`cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

213 
	`£tP¬£Mode
(
Com·t
);

214 
	}
}

216 
Tok’iz”
* 
	gImageDocum’t
::
	$ü—‹Tok’iz”
()

218 #ifdeà
SSLAB__DEBUG


219 
	`qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
	`cu¼’tD©eTime
().
	`toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
	`toAscii
().
	`d©a
(), 
QTh»ad
::
	`cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

222  
Ãw
 
	`ImageTok’iz”
(
this
);

223 
	}
}

225 
	gImageDocum’t
::
	$ü—‹Docum’tSŒuùu»
()

227 #ifdeà
SSLAB__DEBUG


228 
	`qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
	`cu¼’tD©eTime
().
	`toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
	`toAscii
().
	`d©a
(), 
QTh»ad
::
	`cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

231 
Exû±iÚCode
 
ec
;

233 
RefPŒ
<
EËm’t
> 
roÙEËm’t
 = 
Docum’t
::
	`ü—‹EËm’t
(
htmlTag
, 
çl£
);

234 
	`­³ndChd
(
roÙEËm’t
, 
ec
);

236 
RefPŒ
<
EËm’t
> 
body
 = 
Docum’t
::
	`ü—‹EËm’t
(
bodyTag
, 
çl£
);

237 
body
->
	`£tA‰ribu‹
(
¡yËA‰r
, "margin: 0px;");

239 
roÙEËm’t
->
	`­³ndChd
(
body
, 
ec
);

241 
RefPŒ
<
ImageDocum’tEËm’t
> 
imageEËm’t
 = 
Ãw
 
	`ImageDocum’tEËm’t
(
this
);

243 
imageEËm’t
->
	`£tA‰ribu‹
(
¡yËA‰r
, "-webkit-user-select:‚one");

244 
imageEËm’t
->
	`£tLßdMªu®ly
(
Œue
);

245 
imageEËm’t
->
	`£tSrc
(
	`u¾
().
	`¡ršg
());

247 
body
->
	`­³ndChd
(
imageEËm’t
, 
ec
);

249 ià(
	`shouldShrškToF™
()) {

251 
RefPŒ
<
Ev’tLi¡’”
> 
li¡’”
 = 
ImageEv’tLi¡’”
::
	`ü—‹
(
this
);

252 ià(
DOMWšdow
* 
domWšdow
 = 
this
->
	`domWšdow
())

253 
domWšdow
->
	`addEv’tLi¡’”
("»size", 
li¡’”
, 
çl£
);

254 
imageEËm’t
->
	`addEv’tLi¡’”
("şick", 
li¡’”
.
	`»Ëa£
(), 
çl£
);

257 
m_imageEËm’t
 = 
imageEËm’t
.
	`g‘
();

258 
	}
}

260 
	gImageDocum’t
::
	$sÿË
() const

262 #ifdeà
SSLAB__DEBUG


263 
	`qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
	`cu¼’tD©eTime
().
	`toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
	`toAscii
().
	`d©a
(), 
QTh»ad
::
	`cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

266 ià(!
m_imageEËm’t
)

269 
IÁSize
 
imageSize
 = 
m_imageEËm’t
->
	`ÿchedImage
()->
	`imageSize
(
	`äame
()->
	`·geZoomFaùÜ
());

270 
IÁSize
 
wšdowSize
 = 
	`IÁSize
(
	`äame
()->
	`v›w
()->
	`width
(), f¿me()->v›w()->
	`height
());

272 
widthSÿË
 = ()
wšdowSize
.
	`width
(è/ 
imageSize
.width();

273 
heightSÿË
 = ()
wšdowSize
.
	`height
(è/ 
imageSize
.height();

275  
	`mš
(
widthSÿË
, 
heightSÿË
);

276 
	}
}

278 
	gImageDocum’t
::
	$»sizeImageToF™
()

280 #ifdeà
SSLAB__DEBUG


281 
	`qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
	`cu¼’tD©eTime
().
	`toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
	`toAscii
().
	`d©a
(), 
QTh»ad
::
	`cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

284 ià(!
m_imageEËm’t
)

287 
IÁSize
 
imageSize
 = 
m_imageEËm’t
->
	`ÿchedImage
()->
	`imageSize
(
	`äame
()->
	`·geZoomFaùÜ
());

289 
sÿË
 = 
this
->
	`sÿË
();

290 
m_imageEËm’t
->
	`£tWidth
(
¡©ic_ÿ¡
<>(
imageSize
.
	`width
(è* 
sÿË
));

291 
m_imageEËm’t
->
	`£tHeight
(
¡©ic_ÿ¡
<>(
imageSize
.
	`height
(è* 
sÿË
));

293 
Exû±iÚCode
 
ec
;

294 
m_imageEËm’t
->
	`¡yË
()->
	`£tPrİ”ty
("cursÜ", "-webk™-zoom-š", 
ec
);

295 
	}
}

297 
	gImageDocum’t
::
	$imageClicked
(
x
, 
y
)

299 #ifdeà
SSLAB__DEBUG


300 
	`qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
	`cu¼’tD©eTime
().
	`toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
	`toAscii
().
	`d©a
(), 
QTh»ad
::
	`cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

303 ià(!
m_imageSizeIsKnown
 || 
	`imageF™sInWšdow
())

306 
m_shouldShrškImage
 = !m_shouldShrinkImage;

308 ià(
m_shouldShrškImage
)

309 
	`wšdowSizeChªged
();

311 
	`»¡ÜeImageSize
();

313 
	`upd©eLayout
();

315 
sÿË
 = 
this
->
	`sÿË
();

317 
süŞlX
 = 
¡©ic_ÿ¡
<>(
x
 / 
sÿË
 - ()
	`äame
()->
	`v›w
()->
	`width
() / 2);

318 
süŞlY
 = 
¡©ic_ÿ¡
<>(
y
 / 
sÿË
 - ()
	`äame
()->
	`v›w
()->
	`height
() / 2);

320 
	`äame
()->
	`v›w
()->
	`£tSüŞlPos™iÚ
(
	`IÁPošt
(
süŞlX
, 
süŞlY
));

322 
	}
}

324 
	gImageDocum’t
::
	$imageChªged
()

326 #ifdeà
SSLAB__DEBUG


327 
	`qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
	`cu¼’tD©eTime
().
	`toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
	`toAscii
().
	`d©a
(), 
QTh»ad
::
	`cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

330 
	`ASSERT
(
m_imageEËm’t
);

332 ià(
m_imageSizeIsKnown
)

335 ià(
m_imageEËm’t
->
	`ÿchedImage
()->
	`imageSize
(
	`äame
()->
	`·geZoomFaùÜ
()).
	`isEm±y
())

338 
m_imageSizeIsKnown
 = 
Œue
;

340 ià(
	`shouldShrškToF™
()) {

342 
	`wšdowSizeChªged
();

344 
	}
}

346 
	gImageDocum’t
::
	$»¡ÜeImageSize
()

348 #ifdeà
SSLAB__DEBUG


349 
	`qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
	`cu¼’tD©eTime
().
	`toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
	`toAscii
().
	`d©a
(), 
QTh»ad
::
	`cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

352 ià(!
m_imageEËm’t
 || !
m_imageSizeIsKnown
)

355 
m_imageEËm’t
->
	`£tWidth
(m_imageEËm’t->
	`ÿchedImage
()->
	`imageSize
(
	`äame
()->
	`·geZoomFaùÜ
()).
	`width
());

356 
m_imageEËm’t
->
	`£tHeight
(m_imageEËm’t->
	`ÿchedImage
()->
	`imageSize
(
	`äame
()->
	`·geZoomFaùÜ
()).
	`height
());

358 
Exû±iÚCode
 
ec
;

359 ià(
	`imageF™sInWšdow
())

360 
m_imageEËm’t
->
	`¡yË
()->
	`»movePrİ”ty
("cursÜ", 
ec
);

362 
m_imageEËm’t
->
	`¡yË
()->
	`£tPrİ”ty
("cursÜ", "-webk™-zoom-out", 
ec
);

364 
m_didShrškImage
 = 
çl£
;

365 
	}
}

367 
boŞ
 
	gImageDocum’t
::
	$imageF™sInWšdow
() const

369 #ifdeà
SSLAB__DEBUG


370 
	`qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
	`cu¼’tD©eTime
().
	`toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
	`toAscii
().
	`d©a
(), 
QTh»ad
::
	`cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

373 ià(!
m_imageEËm’t
)

374  
Œue
;

376 
IÁSize
 
imageSize
 = 
m_imageEËm’t
->
	`ÿchedImage
()->
	`imageSize
(
	`äame
()->
	`·geZoomFaùÜ
());

377 
IÁSize
 
wšdowSize
 = 
	`IÁSize
(
	`äame
()->
	`v›w
()->
	`width
(), f¿me()->v›w()->
	`height
());

379  
imageSize
.
	`width
(è<ğ
wšdowSize
.width(è&& imageSize.
	`height
() <= windowSize.height();

380 
	}
}

382 
	gImageDocum’t
::
	$wšdowSizeChªged
()

384 #ifdeà
SSLAB__DEBUG


385 
	`qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
	`cu¼’tD©eTime
().
	`toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
	`toAscii
().
	`d©a
(), 
QTh»ad
::
	`cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

388 ià(!
m_imageEËm’t
 || !
m_imageSizeIsKnown
)

391 
boŞ
 
f™sInWšdow
 = 
	`imageF™sInWšdow
();

395 ià(!
m_shouldShrškImage
) {

396 
Exû±iÚCode
 
ec
;

398 ià(
f™sInWšdow
)

399 
m_imageEËm’t
->
	`¡yË
()->
	`»movePrİ”ty
("cursÜ", 
ec
);

401 
m_imageEËm’t
->
	`¡yË
()->
	`£tPrİ”ty
("cursÜ", "-webk™-zoom-out", 
ec
);

405 ià(
m_didShrškImage
) {

408 ià(
f™sInWšdow
)

409 
	`»¡ÜeImageSize
();

411 
	`»sizeImageToF™
();

414 ià(!
f™sInWšdow
) {

415 
	`»sizeImageToF™
();

416 
m_didShrškImage
 = 
Œue
;

419 
	}
}

421 
CachedImage
* 
	gImageDocum’t
::
	$ÿchedImage
()

423 #ifdeà
SSLAB__DEBUG


424 
	`qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
	`cu¼’tD©eTime
().
	`toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
	`toAscii
().
	`d©a
(), 
QTh»ad
::
	`cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

427 ià(!
m_imageEËm’t
)

428 
	`ü—‹Docum’tSŒuùu»
();

430  
m_imageEËm’t
->
	`ÿchedImage
();

431 
	}
}

433 
boŞ
 
	gImageDocum’t
::
	$shouldShrškToF™
() const

435 #ifdeà
SSLAB__DEBUG


436 
	`qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
	`cu¼’tD©eTime
().
	`toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
	`toAscii
().
	`d©a
(), 
QTh»ad
::
	`cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

439  
	`äame
()->
	`·ge
()->
	`£‰šgs
()->
	`shršksSnd®ÚeImagesToF™
() &&

440 
	`äame
()->
	`·ge
()->
	`mašF¿me
() == frame();

441 
	}
}

445 
	gImageEv’tLi¡’”
::
	$hªdËEv’t
(
SütExecutiÚCÚ‹xt
*, 
Ev’t
* 
ev’t
)

447 #ifdeà
SSLAB__DEBUG


448 
	`qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
	`cu¼’tD©eTime
().
	`toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
	`toAscii
().
	`d©a
(), 
QTh»ad
::
	`cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

451 ià(
ev’t
->
	`ty³
(è=ğ
	`ev’tNames
().
»sizeEv’t
)

452 
m_doc
->
	`wšdowSizeChªged
();

453 ià(
ev’t
->
	`ty³
(è=ğ
	`ev’tNames
().
şickEv’t
) {

454 
Mou£Ev’t
* 
mou£Ev’t
 = 
¡©ic_ÿ¡
<Mou£Ev’t*>(
ev’t
);

455 
m_doc
->
	`imageClicked
(
mou£Ev’t
->
	`x
(), mou£Ev’t->
	`y
());

457 
	}
}

459 
boŞ
 
	gImageEv’tLi¡’”
::
İ”©Ü
==(cÚ¡ 
Ev’tLi¡’”
& 
li¡’”
)

461 #ifdeà
SSLAB__DEBUG


462 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

465 ià(cÚ¡ 
ImageEv’tLi¡’”
* 
	gimageEv’tLi¡’”
 = ImageEv’tLi¡’”::
ÿ¡
(&
li¡’”
))

466  
m_doc
 =ğ
imageEv’tLi¡’”
->m_doc;

467  
	gçl£
;

472 
	gImageDocum’tEËm’t
::~
	$ImageDocum’tEËm’t
()

474 #ifdeà
SSLAB__DEBUG


475 
	`qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
	`cu¼’tD©eTime
().
	`toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
	`toAscii
().
	`d©a
(), 
QTh»ad
::
	`cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

478 ià(
m_imageDocum’t
)

479 
m_imageDocum’t
->
	`discÚÃùImageEËm’t
();

480 
	}
}

482 
	gImageDocum’tEËm’t
::
	$wlMoveToNewOwÃrDocum’t
()

484 #ifdeà
SSLAB__DEBUG


485 
	`qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
	`cu¼’tD©eTime
().
	`toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
	`toAscii
().
	`d©a
(), 
QTh»ad
::
	`cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

488 ià(
m_imageDocum’t
) {

489 
m_imageDocum’t
->
	`discÚÃùImageEËm’t
();

490 
m_imageDocum’t
 = 0;

492 
HTMLImageEËm’t
::
	`wlMoveToNewOwÃrDocum’t
();

493 
	}
}

	@ImageDocument.h

25 #iâdeà
ImageDocum’t_h


26 
	#ImageDocum’t_h


	)

28 
	~"HTMLDocum’t.h
"

30 
Çme¥aû
 
	gWebCÜe
 {

32 
şass
 
	gImageDocum’tEËm’t
;

34 şas 
	cImageDocum’t
 : 
public
 
HTMLDocum’t
 {

35 
public
:

36 
PassRefPŒ
<
ImageDocum’t
> 
ü—‹
(
F¿me
* 
äame
)

38  
adİtRef
(
Ãw
 
ImageDocum’t
(
äame
));

41 
CachedImage
* 
ÿchedImage
();

42 
ImageDocum’tEËm’t
* 
imageEËm’t
(ècÚ¡ {  
	gm_imageEËm’t
; }

43 
discÚÃùImageEËm’t
(è{ 
	gm_imageEËm’t
 = 0; }

45 
wšdowSizeChªged
();

46 
imageChªged
();

47 
imageClicked
(
x
, 
y
);

49 
	g´iv©e
:

50 
ImageDocum’t
(
F¿me
*);

52 
vœtu®
 
Tok’iz”
* 
ü—‹Tok’iz”
();

53 
vœtu®
 
boŞ
 
isImageDocum’t
(ècÚ¡ {  
	gŒue
; }

55 
ü—‹Docum’tSŒuùu»
();

56 
»sizeImageToF™
();

57 
»¡ÜeImageSize
();

58 
boŞ
 
imageF™sInWšdow
() const;

59 
boŞ
 
shouldShrškToF™
() const;

60 
sÿË
() const;

62 
ImageDocum’tEËm’t
* 
	gm_imageEËm’t
;

65 
boŞ
 
	gm_imageSizeIsKnown
;

68 
boŞ
 
	gm_didShrškImage
;

71 
boŞ
 
	gm_shouldShrškImage
;

	@ImageLoader.cpp

2 #ifdeà
SSLAB__DEBUG


3 #iâdeà
SSLAB__QDATETIME


4 
	#SSLAB__QDATETIME


	)

5 
	~<QD©eTime
>

9 #ifdeà
SSLAB__DEBUG


10 #iâdeà
SSLAB__QTHREAD


11 
	#SSLAB__QTHREAD


	)

12 
	~<QTh»ad
>

36 
	~"cÚfig.h
"

37 
	~"ImageLßd”.h
"

39 
	~"CSSH–³r.h
"

40 
	~"CachedImage.h
"

41 
	~"DocLßd”.h
"

42 
	~"Docum’t.h
"

43 
	~"EËm’t.h
"

44 
	~"R’d”Image.h
"

46 #ià!
ASSERT_DISABLED


48 
Çme¥aû
 
	gWTF
 {

50 
	g‹m¶©e
<> 
	gV®ueCheck
<
	gWebCÜe
::
ImageLßd”
*> {

51 
WebCÜe
::
	tImageLßd”
* 
	tT¿™Ty³
;

52 
checkCÚsi¡’cy
(cÚ¡ 
WebCÜe
::
ImageLßd”
* 
p
)

54 ià(!
p
)

56 
ASSERT
(
p
->
–em’t
());

57 
	gV®ueCheck
<
	gWebCÜe
::
EËm’t
*>::
checkCÚsi¡’cy
(
p
->
–em’t
());

64 
Çme¥aû
 
	gWebCÜe
 {

66 şas 
	cImageEv’tS’d”
 : 
public
 
NÚcİyabË
 {

67 
public
:

68 
ImageEv’tS’d”
(cÚ¡ 
AtomicSŒšg
& 
ev’tTy³
);

70 
di¥©chEv’tSoÚ
(
ImageLßd”
*);

71 
ÿnûlEv’t
(
ImageLßd”
*);

73 
di¥©chP’dšgEv’ts
();

75 #ià!
ASSERT_DISABLED


76 
boŞ
 
hasP’dšgEv’ts
(
ImageLßd”
* 
lßd”
è{  
	gm_di¥©chSoÚLi¡
.
fšd
Ößd”è!ğ
nÙFound
; }

79 
	g´iv©e
:

80 
tim”Fœed
(
Tim”
<
ImageEv’tS’d”
>*);

82 
AtomicSŒšg
 
	gm_ev’tTy³
;

83 
	gTim”
<
	gImageEv’tS’d”
> 
	gm_tim”
;

84 
	gVeùÜ
<
	gImageLßd”
*> 
	gm_di¥©chSoÚLi¡
;

85 
	gVeùÜ
<
	gImageLßd”
*> 
	gm_di¥©chšgLi¡
;

88 
	gImageEv’tS’d”
& 
	$befÜeLßdEv’tS’d”
()

90 #ifdeà
SSLAB__DEBUG


91 
	`qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
	`cu¼’tD©eTime
().
	`toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
	`toAscii
().
	`d©a
(), 
QTh»ad
::
	`cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

94 
	`DEFINE_STATIC_LOCAL
(
ImageEv’tS’d”
, 
£nd”
, (
	`ev’tNames
().
befÜ–ßdEv’t
));

95  
£nd”
;

96 
	}
}

98 
	gImageEv’tS’d”
& 
	$lßdEv’tS’d”
()

100 #ifdeà
SSLAB__DEBUG


101 
	`qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
	`cu¼’tD©eTime
().
	`toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
	`toAscii
().
	`d©a
(), 
QTh»ad
::
	`cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

104 
	`DEFINE_STATIC_LOCAL
(
ImageEv’tS’d”
, 
£nd”
, (
	`ev’tNames
().
lßdEv’t
));

105  
£nd”
;

106 
	}
}

108 
	gImageLßd”
::
	$ImageLßd”
(
EËm’t
* 
–em’t
)

109 : 
	`m_–em’t
(
–em’t
)

110 , 
	`m_image
(0)

111 , 
	`m_fœedBefÜeLßd
(
Œue
)

112 , 
	`m_fœedLßd
(
Œue
)

113 , 
	`m_imageCom¶‘e
(
Œue
)

114 , 
	$m_lßdMªu®ly
(
çl£
)

116 #ifdeà
SSLAB__DEBUG


117 
	`qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
	`cu¼’tD©eTime
().
	`toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
	`toAscii
().
	`d©a
(), 
QTh»ad
::
	`cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

120 
	}
}

122 
	gImageLßd”
::~
	$ImageLßd”
()

124 #ifdeà
SSLAB__DEBUG


125 
	`qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
	`cu¼’tD©eTime
().
	`toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
	`toAscii
().
	`d©a
(), 
QTh»ad
::
	`cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

128 ià(
m_image
)

129 
m_image
->
	`»moveCl›Á
(
this
);

131 
	`ASSERT
(!
m_fœedBefÜeLßd
 || !
	`befÜeLßdEv’tS’d”
().
	`hasP’dšgEv’ts
(
this
));

132 ià(!
m_fœedBefÜeLßd
)

133 
	`befÜeLßdEv’tS’d”
().
	`ÿnûlEv’t
(
this
);

135 
	`ASSERT
(!
m_fœedLßd
 || !
	`lßdEv’tS’d”
().
	`hasP’dšgEv’ts
(
this
));

136 ià(!
m_fœedLßd
)

137 
	`lßdEv’tS’d”
().
	`ÿnûlEv’t
(
this
);

138 
	}
}

140 
	gImageLßd”
::
	$£tImage
(
CachedImage
* 
ÃwImage
)

142 #ifdeà
SSLAB__DEBUG


143 
	`qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
	`cu¼’tD©eTime
().
	`toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
	`toAscii
().
	`d©a
(), 
QTh»ad
::
	`cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

146 
	`ASSERT
(
m_çedLßdURL
.
	`isEm±y
());

147 
CachedImage
* 
ŞdImage
 = 
m_image
.
	`g‘
();

148 ià(
ÃwImage
 !ğ
ŞdImage
) {

149 
m_image
 = 
ÃwImage
;

150 ià(!
m_fœedBefÜeLßd
) {

151 
	`befÜeLßdEv’tS’d”
().
	`ÿnûlEv’t
(
this
);

152 
m_fœedBefÜeLßd
 = 
Œue
;

154 ià(!
m_fœedLßd
) {

155 
	`lßdEv’tS’d”
().
	`ÿnûlEv’t
(
this
);

156 
m_fœedLßd
 = 
Œue
;

158 
m_imageCom¶‘e
 = 
Œue
;

159 ià(
ÃwImage
)

160 
ÃwImage
->
	`addCl›Á
(
this
);

161 ià(
ŞdImage
)

162 
ŞdImage
->
	`»moveCl›Á
(
this
);

165 ià(
R’d”Objeù
* 
»nd””
 = 
m_–em’t
->
	`»nd””
()) {

166 ià(!
»nd””
->
	`isImage
())

168 
	`toR’d”Image
(
»nd””
)->
	`»£tAnim©iÚ
();

170 
	}
}

172 
	gImageLßd”
::
	$upd©eFromEËm’t
()

174 #ifdeà
SSLAB__DEBUG


175 
	`qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
	`cu¼’tD©eTime
().
	`toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
	`toAscii
().
	`d©a
(), 
QTh»ad
::
	`cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

180 
Docum’t
* 
docum’t
 = 
m_–em’t
->
	`docum’t
();

181 ià(!
docum’t
->
	`»nd””
())

184 
AtomicSŒšg
 
©Œ
 = 
m_–em’t
->
	`g‘A‰ribu‹
(m_–em’t->
	`imageSourûA‰ribu‹Name
());

186 ià(
©Œ
 =ğ
m_çedLßdURL
)

193 
CachedImage
* 
ÃwImage
 = 0;

194 ià(!(
©Œ
.
	`isNuÎ
(è|| (©Œ.
	`isEm±y
(è&& 
docum’t
->
	`ba£URI
().
	`isLoÿlFe
()))) {

195 ià(
m_lßdMªu®ly
) {

196 
docum’t
->
	`docLßd”
()->
	`£tAutoLßdImages
(
çl£
);

197 
ÃwImage
 = 
Ãw
 
	`CachedImage
(
	`sourûURI
(
©Œ
));

198 
ÃwImage
->
	`£tLßdšg
(
Œue
);

199 
ÃwImage
->
	`£tDocLßd”
(
docum’t
->
	`docLßd”
());

200 
docum’t
->
	`docLßd”
()->
m_docum’tResourûs
.
	`£t
(
ÃwImage
->
	`u¾
(),‚ewImage);

202 
ÃwImage
 = 
docum’t
->
	`docLßd”
()->
	`»que¡Image
(
	`sourûURI
(
©Œ
));

206 
m_çedLßdURL
 = !
ÃwImage
 ? 
©Œ
 : 
	`AtomicSŒšg
();

209 
CachedImage
* 
ŞdImage
 = 
m_image
.
	`g‘
();

210 ià(
ÃwImage
 !ğ
ŞdImage
) {

211 ià(!
m_fœedBefÜeLßd
)

212 
	`befÜeLßdEv’tS’d”
().
	`ÿnûlEv’t
(
this
);

213 ià(!
m_fœedLßd
)

214 
	`lßdEv’tS’d”
().
	`ÿnûlEv’t
(
this
);

216 
m_image
 = 
ÃwImage
;

217 
m_fœedBefÜeLßd
 = !
ÃwImage
;

218 
m_fœedLßd
 = !
ÃwImage
;

219 
m_imageCom¶‘e
 = !
ÃwImage
;

221 ià(
ÃwImage
) {

222 
ÃwImage
->
	`addCl›Á
(
this
);

223 ià(!
m_–em’t
->
	`docum’t
()->
	`hasLi¡’”Ty³
(
Docum’t
::
BEFORELOAD_LISTENER
))

224 
	`di¥©chP’dšgBefÜeLßdEv’t
();

226 
	`befÜeLßdEv’tS’d”
().
	`di¥©chEv’tSoÚ
(
this
);

228 ià(
ŞdImage
)

229 
ŞdImage
->
	`»moveCl›Á
(
this
);

232 ià(
R’d”Objeù
* 
»nd””
 = 
m_–em’t
->
	`»nd””
()) {

233 ià(!
»nd””
->
	`isImage
())

235 
	`toR’d”Image
(
»nd””
)->
	`»£tAnim©iÚ
();

237 
	}
}

239 
	gImageLßd”
::
	$upd©eFromEËm’tIgnÜšgP»viousE¼Ü
()

241 #ifdeà
SSLAB__DEBUG


242 
	`qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
	`cu¼’tD©eTime
().
	`toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
	`toAscii
().
	`d©a
(), 
QTh»ad
::
	`cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

246 
m_çedLßdURL
 = 
	`AtomicSŒšg
();

247 
	`upd©eFromEËm’t
();

248 
	}
}

250 
	gImageLßd”
::
	$nÙifyFšished
(
CachedResourû
*)

252 #ifdeà
SSLAB__DEBUG


253 
	`qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
	`cu¼’tD©eTime
().
	`toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
	`toAscii
().
	`d©a
(), 
QTh»ad
::
	`cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

256 
	`ASSERT
(
m_çedLßdURL
.
	`isEm±y
());

258 
m_imageCom¶‘e
 = 
Œue
;

259 ià(
	`haveFœedBefÜeLßdEv’t
())

260 
	`upd©eR’d””
();

262 ià(
m_fœedLßd
)

265 
	`lßdEv’tS’d”
().
	`di¥©chEv’tSoÚ
(
this
);

266 
	}
}

268 
	gImageLßd”
::
	$upd©eR’d””
()

270 #ifdeà
SSLAB__DEBUG


271 
	`qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
	`cu¼’tD©eTime
().
	`toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
	`toAscii
().
	`d©a
(), 
QTh»ad
::
	`cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

274 ià(
R’d”Objeù
* 
»nd””
 = 
m_–em’t
->
	`»nd””
()) {

275 ià(!
»nd””
->
	`isImage
(è&& !»nd””->
	`isVideo
())

277 
R’d”Image
* 
imageR’d””
 = 
	`toR’d”Image
(
»nd””
);

282 
CachedImage
* 
ÿchedImage
 = 
imageR’d””
->
	`ÿchedImage
();

283 ià(
m_image
 !ğ
ÿchedImage
 && (
m_imageCom¶‘e
 || !cachedImage))

284 
imageR’d””
->
	`£tCachedImage
(
m_image
.
	`g‘
());

286 
	}
}

288 
	gImageLßd”
::
	$di¥©chP’dšgBefÜeLßdEv’t
()

290 #ifdeà
SSLAB__DEBUG


291 
	`qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
	`cu¼’tD©eTime
().
	`toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
	`toAscii
().
	`d©a
(), 
QTh»ad
::
	`cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

294 ià(
m_fœedBefÜeLßd
)

296 ià(!
m_image
)

298 ià(!
m_–em’t
->
	`docum’t
()->
	`©ched
())

300 
m_fœedBefÜeLßd
 = 
Œue
;

301 ià(
m_–em’t
->
	`di¥©chBefÜeLßdEv’t
(
m_image
->
	`u¾
())) {

302 
	`upd©eR’d””
();

305 ià(
m_image
) {

306 
m_image
->
	`»moveCl›Á
(
this
);

307 
m_image
 = 0;

309 
	`lßdEv’tS’d”
().
	`ÿnûlEv’t
(
this
);

310 
	}
}

312 
	gImageLßd”
::
	$di¥©chP’dšgLßdEv’t
()

314 #ifdeà
SSLAB__DEBUG


315 
	`qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
	`cu¼’tD©eTime
().
	`toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
	`toAscii
().
	`d©a
(), 
QTh»ad
::
	`cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

318 ià(
m_fœedLßd
)

320 ià(!
m_image
)

322 ià(!
m_–em’t
->
	`docum’t
()->
	`©ched
())

324 
m_fœedLßd
 = 
Œue
;

325 
	`di¥©chLßdEv’t
();

326 
	}
}

328 
	gImageLßd”
::
	$di¥©chP’dšgBefÜeLßdEv’ts
()

330 #ifdeà
SSLAB__DEBUG


331 
	`qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
	`cu¼’tD©eTime
().
	`toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
	`toAscii
().
	`d©a
(), 
QTh»ad
::
	`cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

334 
	`befÜeLßdEv’tS’d”
().
	`di¥©chP’dšgEv’ts
();

335 
	}
}

337 
	gImageLßd”
::
	$di¥©chP’dšgLßdEv’ts
()

339 #ifdeà
SSLAB__DEBUG


340 
	`qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
	`cu¼’tD©eTime
().
	`toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
	`toAscii
().
	`d©a
(), 
QTh»ad
::
	`cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

343 
	`lßdEv’tS’d”
().
	`di¥©chP’dšgEv’ts
();

344 
	}
}

346 
	gImageEv’tS’d”
::
	$ImageEv’tS’d”
(cÚ¡ 
AtomicSŒšg
& 
ev’tTy³
)

347 : 
	`m_ev’tTy³
(
ev’tTy³
)

348 , 
	`m_tim”
(
this
, &
ImageEv’tS’d”
::
tim”Fœed
)

350 #ifdeà
SSLAB__DEBUG


351 
	`qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
	`cu¼’tD©eTime
().
	`toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
	`toAscii
().
	`d©a
(), 
QTh»ad
::
	`cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

354 
	}
}

356 
	gImageEv’tS’d”
::
	$di¥©chEv’tSoÚ
(
ImageLßd”
* 
lßd”
)

358 #ifdeà
SSLAB__DEBUG


359 
	`qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
	`cu¼’tD©eTime
().
	`toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
	`toAscii
().
	`d©a
(), 
QTh»ad
::
	`cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

362 
m_di¥©chSoÚLi¡
.
	`­³nd
(
lßd”
);

363 ià(!
m_tim”
.
	`isAùive
())

364 
m_tim”
.
	`¡¬tOÃShÙ
(0);

365 
	}
}

367 
	gImageEv’tS’d”
::
	$ÿnûlEv’t
(
ImageLßd”
* 
lßd”
)

369 #ifdeà
SSLAB__DEBUG


370 
	`qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
	`cu¼’tD©eTime
().
	`toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
	`toAscii
().
	`d©a
(), 
QTh»ad
::
	`cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

375 
size_t
 
size
 = 
m_di¥©chSoÚLi¡
.
	`size
();

376 
size_t
 
i
 = 0; i < 
size
; ++i) {

377 ià(
m_di¥©chSoÚLi¡
[
i
] =ğ
lßd”
)

378 
m_di¥©chSoÚLi¡
[
i
] = 0;

380 
size
 = 
m_di¥©chšgLi¡
.
	`size
();

381 
size_t
 
i
 = 0; i < 
size
; ++i) {

382 ià(
m_di¥©chšgLi¡
[
i
] =ğ
lßd”
)

383 
m_di¥©chšgLi¡
[
i
] = 0;

385 ià(
m_di¥©chSoÚLi¡
.
	`isEm±y
())

386 
m_tim”
.
	`¡İ
();

387 
	}
}

389 
	gImageEv’tS’d”
::
	$di¥©chP’dšgEv’ts
()

391 #ifdeà
SSLAB__DEBUG


392 
	`qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
	`cu¼’tD©eTime
().
	`toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
	`toAscii
().
	`d©a
(), 
QTh»ad
::
	`cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

398 ià(!
m_di¥©chšgLi¡
.
	`isEm±y
())

401 
m_tim”
.
	`¡İ
();

403 
m_di¥©chSoÚLi¡
.
	`checkCÚsi¡’cy
();

405 
m_di¥©chšgLi¡
.
	`sw­
(
m_di¥©chSoÚLi¡
);

406 
size_t
 
size
 = 
m_di¥©chšgLi¡
.
	`size
();

407 
size_t
 
i
 = 0; i < 
size
; ++i) {

408 ià(
ImageLßd”
* 
lßd”
 = 
m_di¥©chšgLi¡
[
i
]) {

409 ià(
m_ev’tTy³
 =ğ
	`ev’tNames
().
befÜ–ßdEv’t
)

410 
lßd”
->
	`di¥©chP’dšgBefÜeLßdEv’t
();

412 
lßd”
->
	`di¥©chP’dšgLßdEv’t
();

415 
m_di¥©chšgLi¡
.
	`ş—r
();

416 
	}
}

418 
	gImageEv’tS’d”
::
tim”Fœed
(
Tim”
<
ImageEv’tS’d”
>*)

420 #ifdeà
SSLAB__DEBUG


421 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

424 
di¥©chP’dšgEv’ts
();

	@ImageLoader.h

23 #iâdeà
ImageLßd”_h


24 
	#ImageLßd”_h


	)

26 
	~"AtomicSŒšg.h
"

27 
	~"CachedResourûCl›Á.h
"

28 
	~"CachedResourûHªdË.h
"

30 
Çme¥aû
 
	gWebCÜe
 {

32 
şass
 
	gEËm’t
;

33 
şass
 
	gImageLßdEv’tS’d”
;

35 şas 
	cImageLßd”
 : 
public
 
CachedResourûCl›Á
 {

36 
public
:

37 
ImageLßd”
(
EËm’t
*);

38 
	gvœtu®
 ~
ImageLßd”
();

42 
upd©eFromEËm’t
();

46 
upd©eFromEËm’tIgnÜšgP»viousE¼Ü
();

48 
EËm’t
* 
–em’t
(ècÚ¡ {  
	gm_–em’t
; }

49 
boŞ
 
imageCom¶‘e
(ècÚ¡ {  
	gm_imageCom¶‘e
; }

51 
CachedImage
* 
image
(ècÚ¡ {  
	gm_image
.
g‘
(); }

52 
£tImage
(
CachedImage
*);

54 
£tLßdMªu®ly
(
boŞ
 
lßdMªu®ly
è{ 
	gm_lßdMªu®ly
 =†oadManually; }

56 
boŞ
 
haveFœedBefÜeLßdEv’t
(ècÚ¡ {  
	gm_fœedBefÜeLßd
; }

57 
boŞ
 
haveFœedLßdEv’t
(ècÚ¡ {  
	gm_fœedLßd
; }

59 
di¥©chP’dšgBefÜeLßdEv’ts
();

60 
di¥©chP’dšgLßdEv’ts
();

62 
	g´Ùeùed
:

63 
vœtu®
 
nÙifyFšished
(
CachedResourû
*);

65 
	g´iv©e
:

66 
vœtu®
 
di¥©chLßdEv’t
() = 0;

67 
vœtu®
 
SŒšg
 
sourûURI
(cÚ¡ 
AtomicSŒšg
&) const = 0;

69 
ä›nd
 
şass
 
	gImageEv’tS’d”
;

70 
di¥©chP’dšgBefÜeLßdEv’t
();

71 
di¥©chP’dšgLßdEv’t
();

73 
upd©eR’d””
();

75 
EËm’t
* 
	gm_–em’t
;

76 
	gCachedResourûHªdË
<
	gCachedImage
> 
	gm_image
;

77 
AtomicSŒšg
 
	gm_çedLßdURL
;

78 
boŞ
 
	gm_fœedBefÜeLßd
 : 1;

79 
boŞ
 
	gm_fœedLßd
 : 1;

80 
boŞ
 
	gm_imageCom¶‘e
 : 1;

81 
boŞ
 
	gm_lßdMªu®ly
 : 1;

	@MainResourceLoader.cpp

2 #ifdeà
SSLAB__DEBUG


3 #iâdeà
SSLAB__QDATETIME


4 
	#SSLAB__QDATETIME


	)

5 
	~<QD©eTime
>

9 #ifdeà
SSLAB__DEBUG


10 #iâdeà
SSLAB__QTHREAD


11 
	#SSLAB__QTHREAD


	)

12 
	~<QTh»ad
>

44 
	~"cÚfig.h
"

45 
	~"MašResourûLßd”.h
"

47 
	~"AµliÿtiÚCacheHo¡.h
"

48 
	~"Docum’tLßd”.h
"

49 
	~"FÜmS‹.h
"

50 
	~"F¿me.h
"

51 
	~"F¿meLßd”.h
"

52 
	~"F¿meLßd”Cl›Á.h
"

53 
	~"HTMLFÜmEËm’t.h
"

54 
	~"Page.h
"

55 #ià
PLATFORM
(
QT
)

56 
	~"PlugšD©aba£.h
"

58 
	~"ResourûE¼Ü.h
"

59 
	~"ResourûHªdË.h
"

60 
	~"S‘tšgs.h
"

64 
Çme¥aû
 
	gWebCÜe
 {

66 
	gMašResourûLßd”
::
MašResourûLßd”
(
F¿me
* 
äame
)

67 : 
ResourûLßd”
(
äame
, 
Œue
,rue)

68 , 
m_d©aLßdTim”
(
this
, &
MašResourûLßd”
::
hªdËD©aLßdNow
)

69 , 
m_lßdšgMuÉ¬tCÚ‹Á
(
çl£
)

70 , 
m_wa™šgFÜCÚ‹ÁPŞicy
(
çl£
)

72 #ifdeà
SSLAB__DEBUG


73 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

78 
	gMašResourûLßd”
::~
MašResourûLßd”
()

80 #ifdeà
SSLAB__DEBUG


81 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

86 
	gPassRefPŒ
<
	gMašResourûLßd”
> MašResourûLßd”::
ü—‹
(
F¿me
* 
äame
)

88 #ifdeà
SSLAB__DEBUG


89 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

92  
adİtRef
(
Ãw
 
MašResourûLßd”
(
äame
));

95 
	gMašResourûLßd”
::
»ûivedE¼Ü
(cÚ¡ 
ResourûE¼Ü
& 
”rÜ
)

97 #ifdeà
SSLAB__DEBUG


98 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

102 
	gRefPŒ
<
	gMašResourûLßd”
> 
´Ùeù
(
this
);

103 
	gRefPŒ
<
	gF¿me
> 
´ÙeùF¿me
(
m_äame
);

109 
äameLßd”
()->
»ûivedMašResourûE¼Ü
(
”rÜ
, 
Œue
);

111 ià(!
ÿnûÎed
()) {

112 
ASSERT
(!
»achedT”mš®S‹
());

113 
äameLßd”
()->
nÙif›r
()->
didFaToLßd
(
this
, 
”rÜ
);

115 
»Ëa£Resourûs
();

118 
ASSERT
(
»achedT”mš®S‹
());

121 
	gMašResourûLßd”
::
didCªûl
(cÚ¡ 
ResourûE¼Ü
& 
”rÜ
)

123 #ifdeà
SSLAB__DEBUG


124 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

127 
	gm_d©aLßdTim”
.
¡İ
();

130 
	gRefPŒ
<
	gMašResourûLßd”
> 
´Ùeù
(
this
);

132 ià(
	gm_wa™šgFÜCÚ‹ÁPŞicy
) {

133 
äameLßd”
()->
pŞicyCheck”
()->
ÿnûlCheck
();

134 
ASSERT
(
m_wa™šgFÜCÚ‹ÁPŞicy
);

135 
	gm_wa™šgFÜCÚ‹ÁPŞicy
 = 
çl£
;

136 
d”ef
();

138 
äameLßd”
()->
»ûivedMašResourûE¼Ü
(
”rÜ
, 
Œue
);

139 
	gResourûLßd”
::
didCªûl
(
”rÜ
);

142 
ResourûE¼Ü
 
	gMašResourûLßd”
::
š‹¼u±iÚFÜPŞicyChªgeE¼Ü
() const

144 #ifdeà
SSLAB__DEBUG


145 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

148  
äameLßd”
()->
š‹¼u±iÚFÜPŞicyChªgeE¼Ü
(
»que¡
());

151 
	gMašResourûLßd”
::
¡İLßdšgFÜPŞicyChªge
()

153 #ifdeà
SSLAB__DEBUG


154 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

157 
ÿnûl
(
š‹¼u±iÚFÜPŞicyChªgeE¼Ü
());

160 
	gMašResourûLßd”
::
ÿÎCÚtšueAá”Navig©iÚPŞicy
(* 
¬gum’t
, cÚ¡ 
ResourûReque¡
& 
»que¡
, 
PassRefPŒ
<
FÜmS‹
>, 
boŞ
 
shouldCÚtšue
)

162 #ifdeà
SSLAB__DEBUG


163 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

166 
	g¡©ic_ÿ¡
<
	gMašResourûLßd”
*>(
	g¬gum’t
)->
cÚtšueAá”Navig©iÚPŞicy
(
»que¡
, 
shouldCÚtšue
);

169 
	gMašResourûLßd”
::
cÚtšueAá”Navig©iÚPŞicy
(cÚ¡ 
ResourûReque¡
&, 
boŞ
 
shouldCÚtšue
)

171 #ifdeà
SSLAB__DEBUG


172 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

175 ià(!
	gshouldCÚtšue
)

176 
¡İLßdšgFÜPŞicyChªge
();

177 
d”ef
();

180 
boŞ
 
	gMašResourûLßd”
::
isPo¡OrRedœeùAá”Po¡
(cÚ¡ 
ResourûReque¡
& 
ÃwReque¡
, cÚ¡ 
ResourûRe¥Ú£
& 
»dœeùRe¥Ú£
)

182 #ifdeà
SSLAB__DEBUG


183 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

186 ià(
	gÃwReque¡
.
h‰pM‘hod
() == "POST")

187  
Œue
;

189 
	g¡©us
 = 
»dœeùRe¥Ú£
.
h‰pStusCode
();

190 ià(((
	g¡©us
 >ğ301 && 
¡©us
 <= 303) || status == 307)

191 && 
äameLßd”
()->
š™ŸlReque¡
().
h‰pM‘hod
() == "POST")

192  
Œue
;

194  
	gçl£
;

197 
	gMašResourûLßd”
::
addD©a
(cÚ¡ * 
d©a
, 
Ëngth
, 
boŞ
 
®lAtOnû
)

199 #ifdeà
SSLAB__DEBUG


200 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

203 
	gResourûLßd”
::
addD©a
(
d©a
, 
Ëngth
, 
®lAtOnû
);

204 
äameLßd”
()->
»ûivedD©a
(
d©a
, 
Ëngth
);

207 
	gMašResourûLßd”
::
wlS’dReque¡
(
ResourûReque¡
& 
ÃwReque¡
, cÚ¡ 
ResourûRe¥Ú£
& 
»dœeùRe¥Ú£
)

209 #ifdeà
SSLAB__DEBUG


210 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

217 
ASSERT
(!
ÃwReque¡
.
isNuÎ
());

221 
	gRefPŒ
<
	gMašResourûLßd”
> 
´Ùeù
(
this
);

225 ià(
äameLßd”
()->
isLßdšgMašF¿me
())

226 
	gÃwReque¡
.
£tFœ¡P¬tyFÜCook›s
(
ÃwReque¡
.
u¾
());

232 ià(
	gÃwReque¡
.
ÿchePŞicy
(è=ğ
U£PrÙocŞCachePŞicy
 && 
isPo¡OrRedœeùAá”Po¡
(
ÃwReque¡
, 
»dœeùRe¥Ú£
))

233 
	gÃwReque¡
.
£tCachePŞicy
(
R–ßdIgnÜšgCacheD©a
);

235 
	gResourûLßd”
::
wlS’dReque¡
(
ÃwReque¡
, 
»dœeùRe¥Ú£
);

238 
	gm_docum’tLßd”
->
£tReque¡
(
ÃwReque¡
);

240 
F¿me
* 
	gtİ
 = 
m_äame
->
Œ“
()->
tİ
();

241 ià(
	gtİ
 !ğ
m_äame
)

242 
äameLßd”
()->
checkIfDi¥ÏyIn£cu»CÚ‹Á
(
tİ
->
docum’t
()->
£cur™yOrigš
(), 
ÃwReque¡
.
u¾
());

248 ià(!
	g»dœeùRe¥Ú£
.
isNuÎ
()) {

249 
»f
();

250 
äameLßd”
()->
pŞicyCheck”
()->
checkNavig©iÚPŞicy
(
ÃwReque¡
, 
ÿÎCÚtšueAá”Navig©iÚPŞicy
, 
this
);

254 
boŞ
 
shouldLßdAsEm±yDocum’t
(cÚ¡ 
KURL
& 
u¾
)

256 #ifdeà
SSLAB__DEBUG


257 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

260 #ià
PLATFORM
(
TORCHMOBILE
)

261  
	gu¾
.
isEm±y
(è|| (u¾.
´ÙocŞIs
("about"è&& 
equ®IgnÜšgRef
(
u¾
, 
bÏnkURL
()));

263  
	gu¾
.
isEm±y
(è|| u¾.
´ÙocŞIs
("about");

267 
	gMašResourûLßd”
::
cÚtšueAá”CÚ‹ÁPŞicy
(
PŞicyAùiÚ
 
cÚ‹ÁPŞicy
, cÚ¡ 
ResourûRe¥Ú£
& 
r
)

269 #ifdeà
SSLAB__DEBUG


270 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

273 
KURL
 
	gu¾
 = 
»que¡
().
u¾
();

274 cÚ¡ 
	gSŒšg
& 
	gmimeTy³
 = 
r
.
mimeTy³
();

276 
	gcÚ‹ÁPŞicy
) {

277 
	gPŞicyU£
: {

279 
boŞ
 
isRemÙeWebArchive
 = 
equ®IgnÜšgCa£
("­¶iÿtiÚ/x-web¬chive", 
mimeTy³
è&& !
	gm_sub¡™u‹D©a
.
isV®id
(è&& !
	gu¾
.
isLoÿlFe
();

280 ià(!
äameLßd”
()->
ÿnShowMIMETy³
(
mimeTy³
è|| 
	gisRemÙeWebArchive
) {

281 
äameLßd”
()->
pŞicyCheck”
()->
ÿÂÙShowMIMETy³
(
r
);

283 ià(!
»achedT”mš®S‹
())

284 
¡İLßdšgFÜPŞicyChªge
();

290 
	gPŞicyDowÆßd
:

292 ià(!
m_hªdË
) {

293 
»ûivedE¼Ü
(
ÿÂÙShowURLE¼Ü
());

296 
äameLßd”
()->
ş›Á
()->
dowÆßd
(
m_hªdË
.
g‘
(), 
»que¡
(), m_hªdË.g‘()->»que¡(), 
r
);

298 ià(
äameLßd”
())

299 
»ûivedE¼Ü
(
š‹¼u±iÚFÜPŞicyChªgeE¼Ü
());

302 
	gPŞicyIgnÜe
:

303 
¡İLßdšgFÜPŞicyChªge
();

307 
ASSERT_NOT_REACHED
();

310 
	gRefPŒ
<
	gMašResourûLßd”
> 
´Ùeù
(
this
);

312 ià(
	gr
.
isHTTP
()) {

313 
	g¡©us
 = 
r
.
h‰pStusCode
();

314 ià(
	g¡©us
 < 200 || status >= 300) {

315 
boŞ
 
ho¡edByObjeù
 = 
äameLßd”
()->
isHo¡edByObjeùEËm’t
();

317 
äameLßd”
()->
hªdËF®lbackCÚ‹Á
();

321 ià(
	gho¡edByObjeù
)

322 
ÿnûl
();

327 ià(!
»achedT”mš®S‹
())

328 
	gResourûLßd”
::
didReûiveRe¥Ú£
(
r
);

330 ià(
äameLßd”
(è&& !äameLßd”()->
isStİpšg
()) {

331 ià(
	gm_sub¡™u‹D©a
.
isV®id
()) {

332 ià(
	gm_sub¡™u‹D©a
.
cÚ‹Á
()->
size
())

333 
didReûiveD©a
(
m_sub¡™u‹D©a
.
cÚ‹Á
()->
d©a
(), m_sub¡™u‹D©a.cÚ‹Á()->
size
(), m_sub¡™u‹D©a.cÚ‹Á()->size(), 
Œue
);

334 ià(
äameLßd”
(è&& !äameLßd”()->
isStİpšg
())

335 
didFšishLßdšg
();

336 } ià(
shouldLßdAsEm±yDocum’t
(
u¾
è|| 
äameLßd”
()->
»´e£Á©iÚExi¡sFÜURLScheme
(u¾.
´ÙocŞ
()))

337 
didFšishLßdšg
();

341 
	gMašResourûLßd”
::
ÿÎCÚtšueAá”CÚ‹ÁPŞicy
(* 
¬gum’t
, 
PŞicyAùiÚ
 
pŞicy
)

343 #ifdeà
SSLAB__DEBUG


344 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

347 
	g¡©ic_ÿ¡
<
	gMašResourûLßd”
*>(
	g¬gum’t
)->
cÚtšueAá”CÚ‹ÁPŞicy
(
pŞicy
);

350 
	gMašResourûLßd”
::
cÚtšueAá”CÚ‹ÁPŞicy
(
PŞicyAùiÚ
 
pŞicy
)

352 #ifdeà
SSLAB__DEBUG


353 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

356 
ASSERT
(
m_wa™šgFÜCÚ‹ÁPŞicy
);

357 
	gm_wa™šgFÜCÚ‹ÁPŞicy
 = 
çl£
;

358 ià(
äameLßd”
(è&& !äameLßd”()->
isStİpšg
())

359 
cÚtšueAá”CÚ‹ÁPŞicy
(
pŞicy
, 
m_»¥Ú£
);

360 
d”ef
();

363 #ià
PLATFORM
(
QT
)

364 
	gMašResourûLßd”
::
sub¡™u‹MIMETy³FromPlugšD©aba£
(cÚ¡ 
ResourûRe¥Ú£
& 
r
)

366 #ifdeà
SSLAB__DEBUG


367 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

370 ià(!
	gm_äame
->
lßd”
()->
®lowPlugšs
(
NÙAboutToIn¡ªtŸ‹Plugš
))

373 
SŒšg
 
	gf’ame
 = 
r
.
u¾
().
Ï¡P©hCompÚ’t
();

374 ià(
	gf’ame
.
’dsW™h
("/"))

377 
	gex‹nsiÚPos
 = 
f’ame
.
»v”£Fšd
('.');

378 ià(
	gex‹nsiÚPos
 == -1)

381 
SŒšg
 
	gex‹nsiÚ
 = 
f’ame
.
sub¡ršg
(
ex‹nsiÚPos
 + 1);

382 
SŒšg
 
	gmimeTy³
 = 
PlugšD©aba£
::
š¡®ËdPlugšs
()->
MIMETy³FÜEx‹nsiÚ
(
ex‹nsiÚ
);

383 ià(!
	gmimeTy³
.
isEm±y
()) {

384 
ResourûRe¥Ú£
* 
	g»¥Ú£
 = 
cÚ¡_ÿ¡
<ResourûRe¥Ú£*>(&
r
);

385 
	g»¥Ú£
->
£tMimeTy³
(
mimeTy³
);

390 
	gMašResourûLßd”
::
didReûiveRe¥Ú£
(cÚ¡ 
ResourûRe¥Ú£
& 
r
)

392 #ifdeà
SSLAB__DEBUG


393 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

396 #ià
ENABLE
(
OFFLINE_WEB_APPLICATIONS
)

397 ià(
docum’tLßd”
()->
­¶iÿtiÚCacheHo¡
()->
maybeLßdF®lbackFÜMašRe¥Ú£
(
»que¡
(), 
r
))

401 
	gHTTPH—d”M­
::
cÚ¡_™”©Ü
 
™
 = 
r
.
h‰pH—d”F›lds
().
fšd
(
AtomicSŒšg
("x-frame-options"));

402 ià(
	g™
 !ğ
r
.
h‰pH—d”F›lds
().
’d
()) {

403 
SŒšg
 
cÚ‹Á
 = 
™
->
£cÚd
;

404 ià(
	gm_äame
->
lßd”
()->
shouldIÁ”ru±LßdFÜXF¿meO±iÚs
(
cÚ‹Á
, 
r
.
u¾
())) {

405 
ÿnûl
();

412 #ià!
PLATFORM
(
CF
)

413 
ASSERT
(
shouldLßdAsEm±yDocum’t
(
r
.
u¾
()è|| !
deãrsLßdšg
());

416 #ià
PLATFORM
(
QT
)

417 ià(
	gr
.
mimeTy³
() == "application/octet-stream")

418 
sub¡™u‹MIMETy³FromPlugšD©aba£
(
r
);

421 ià(
	gm_lßdšgMuÉ¬tCÚ‹Á
) {

422 
äameLßd”
()->
£tupFÜR•ÏûByMIMETy³
(
r
.
mimeTy³
());

423 
ş—rResourûD©a
();

426 ià(
	gr
.
isMuÉ¬t
())

427 
	gm_lßdšgMuÉ¬tCÚ‹Á
 = 
Œue
;

431 
	gRefPŒ
<
	gMašResourûLßd”
> 
´Ùeù
(
this
);

433 
	gm_docum’tLßd”
->
£tRe¥Ú£
(
r
);

435 
	gm_»¥Ú£
 = 
r
;

437 
ASSERT
(!
m_wa™šgFÜCÚ‹ÁPŞicy
);

438 
	gm_wa™šgFÜCÚ‹ÁPŞicy
 = 
Œue
;

439 
»f
();

441 
ASSERT
(
äameLßd”
()->
aùiveDocum’tLßd”
());

444 ià(
äameLßd”
()->
aùiveDocum’tLßd”
()->
sub¡™u‹D©a
().
isV®id
()) {

445 
ÿÎCÚtšueAá”CÚ‹ÁPŞicy
(
this
, 
PŞicyU£
);

449 #ià
ENABLE
(
FTPDIR
)

451 
S‘tšgs
* 
	g£‰šgs
 = 
m_äame
->
£‰šgs
();

452 ià(
	g£‰šgs
 && s‘tšgs->
fÜûFTPDœeùÜyLi¡šgs
(è&& 
	gm_»¥Ú£
.
mimeTy³
() == "application/x-ftp-directory") {

453 
ÿÎCÚtšueAá”CÚ‹ÁPŞicy
(
this
, 
PŞicyU£
);

458 
äameLßd”
()->
pŞicyCheck”
()->
checkCÚ‹ÁPŞicy
(
m_»¥Ú£
.
mimeTy³
(), 
ÿÎCÚtšueAá”CÚ‹ÁPŞicy
, 
this
);

461 
	gMašResourûLßd”
::
didReûiveD©a
(cÚ¡ * 
d©a
, 
Ëngth
, 
ËngthReûived
, 
boŞ
 
®lAtOnû
)

463 #ifdeà
SSLAB__DEBUG


464 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

467 
ASSERT
(
d©a
);

468 
ASSERT
(
Ëngth
 != 0);

470 
ASSERT
(!
m_»¥Ú£
.
isNuÎ
());

472 #ià
USE
(
CFNETWORK
è|| (
PLATFORM
(
MAC
è&& !
defšed
(
BUILDING_ON_TIGER
))

474 ià(
	gm_»¥Ú£
.
isNuÎ
()) {

475 
	gm_»¥Ú£
 = 
ResourûRe¥Ú£
(
KURL
(), "‹xt/html", 0, 
SŒšg
(), String());

476 ià(
Docum’tLßd”
* 
	gdocum’tLßd”
 = 
äameLßd”
()->
aùiveDocum’tLßd”
())

477 
docum’tLßd”
->
£tRe¥Ú£
(
m_»¥Ú£
);

483 #ià!
PLATFORM
(
CF
)

484 
ASSERT
(!
deãrsLßdšg
());

487 #ià
ENABLE
(
OFFLINE_WEB_APPLICATIONS
)

488 
docum’tLßd”
()->
­¶iÿtiÚCacheHo¡
()->
mašResourûD©aReûived
(
d©a
, 
Ëngth
, 
ËngthReûived
, 
®lAtOnû
);

493 
	gRefPŒ
<
	gMašResourûLßd”
> 
´Ùeù
(
this
);

495 
	gResourûLßd”
::
didReûiveD©a
(
d©a
, 
Ëngth
, 
ËngthReûived
, 
®lAtOnû
);

498 
	gMašResourûLßd”
::
didFšishLßdšg
()

500 #ifdeà
SSLAB__DEBUG


501 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

506 #ià!
PLATFORM
(
CF
)

507 
ASSERT
(
shouldLßdAsEm±yDocum’t
(
äameLßd”
()->
aùiveDocum’tLßd”
()->
u¾
()è|| !
deãrsLßdšg
());

512 
	gRefPŒ
<
	gMašResourûLßd”
> 
´Ùeù
(
this
);

514 #ià
ENABLE
(
OFFLINE_WEB_APPLICATIONS
)

515 
	gRefPŒ
<
	gDocum’tLßd”
> 
	gdl
 = 
docum’tLßd”
();

518 
äameLßd”
()->
fšishedLßdšg
();

519 
	gResourûLßd”
::
didFšishLßdšg
();

521 #ià
ENABLE
(
OFFLINE_WEB_APPLICATIONS
)

522 
	gdl
->
­¶iÿtiÚCacheHo¡
()->
fšishedLßdšgMašResourû
();

526 
	gMašResourûLßd”
::
didFa
(cÚ¡ 
ResourûE¼Ü
& 
”rÜ
)

528 #ifdeà
SSLAB__DEBUG


529 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

532 #ià
ENABLE
(
OFFLINE_WEB_APPLICATIONS
)

533 ià(
docum’tLßd”
()->
­¶iÿtiÚCacheHo¡
()->
maybeLßdF®lbackFÜMašE¼Ü
(
»que¡
(), 
”rÜ
))

539 #ià!
PLATFORM
(
CF
)

540 
ASSERT
(!
deãrsLßdšg
());

543 
»ûivedE¼Ü
(
”rÜ
);

546 
	gMašResourûLßd”
::
hªdËEm±yLßd
(cÚ¡ 
KURL
& 
u¾
, 
boŞ
 
fÜURLScheme
)

548 #ifdeà
SSLAB__DEBUG


549 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

552 
SŒšg
 
	gmimeTy³
;

553 ià(
	gfÜURLScheme
)

554 
	gmimeTy³
 = 
äameLßd”
()->
g’”©edMIMETy³FÜURLScheme
(
u¾
.
´ÙocŞ
());

556 
	gmimeTy³
 = "text/html";

558 
ResourûRe¥Ú£
 
»¥Ú£
(
u¾
, 
mimeTy³
, 0, 
SŒšg
(), String());

559 
didReûiveRe¥Ú£
(
»¥Ú£
);

562 
	gMašResourûLßd”
::
hªdËD©aLßdNow
(
MašResourûLßd”Tim”
*)

564 #ifdeà
SSLAB__DEBUG


565 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

568 
	gRefPŒ
<
	gMašResourûLßd”
> 
´Ùeù
(
this
);

570 
KURL
 
	gu¾
 = 
m_sub¡™u‹D©a
.
»¥Ú£URL
();

571 ià(
	gu¾
.
isEm±y
())

572 
	gu¾
 = 
m_š™ŸlReque¡
.
u¾
();

576 
	gm_š™ŸlReque¡
 = 
ResourûReque¡
();

578 
ResourûRe¥Ú£
 
»¥Ú£
(
u¾
, 
m_sub¡™u‹D©a
.
mimeTy³
(), m_sub¡™u‹D©a.
cÚ‹Á
()->
size
(), m_sub¡™u‹D©a.
‹xtEncodšg
(), "");

579 
didReûiveRe¥Ú£
(
»¥Ú£
);

582 
	gMašResourûLßd”
::
¡¬tD©aLßdTim”
()

584 #ifdeà
SSLAB__DEBUG


585 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

588 
	gm_d©aLßdTim”
.
¡¬tOÃShÙ
(0);

590 #ià
HAVE
(
RUNLOOP_TIMER
)

591 ià(
ScheduËPaœHashS‘
* 
	gscheduËdPaœs
 = 
m_äame
->
·ge
()->
scheduËdRunLoİPaœs
())

592 
m_d©aLßdTim”
.
scheduË
(*
scheduËdPaœs
);

596 
	gMašResourûLßd”
::
hªdËD©aLßdSoÚ
(
ResourûReque¡
& 
r
)

598 #ifdeà
SSLAB__DEBUG


599 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

602 
	gm_š™ŸlReque¡
 = 
r
;

604 ià(
	gm_docum’tLßd”
->
deãrMašResourûD©aLßd
())

605 
¡¬tD©aLßdTim”
();

607 
hªdËD©aLßdNow
(0);

610 
boŞ
 
	gMašResourûLßd”
::
lßdNow
(
ResourûReque¡
& 
r
)

612 #ifdeà
SSLAB__DEBUG


613 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

616 
boŞ
 
	gshouldLßdEm±yBefÜeRedœeù
 = 
shouldLßdAsEm±yDocum’t
(
r
.
u¾
());

618 
ASSERT
(!
m_hªdË
);

619 
ASSERT
(
shouldLßdEm±yBefÜeRedœeù
 || !
deãrsLßdšg
());

624 
wlS’dReque¡
(
r
, 
ResourûRe¥Ú£
());

628 ià(!
äameLßd”
())

629  
	gçl£
;

631 cÚ¡ 
	gKURL
& 
	gu¾
 = 
r
.
u¾
();

632 
boŞ
 
	gshouldLßdEm±y
 = 
shouldLßdAsEm±yDocum’t
(
u¾
è&& !
m_sub¡™u‹D©a
.
isV®id
();

634 ià(
	gshouldLßdEm±yBefÜeRedœeù
 && !
	gshouldLßdEm±y
 && 
deãrsLßdšg
())

635  
	gŒue
;

637 ià(
	gm_sub¡™u‹D©a
.
isV®id
())

638 
hªdËD©aLßdSoÚ
(
r
);

639 ià(
	gshouldLßdEm±y
 || 
äameLßd”
()->
»´e£Á©iÚExi¡sFÜURLScheme
(
u¾
.
´ÙocŞ
()))

640 
hªdËEm±yLßd
(
u¾
, !
shouldLßdEm±y
);

642 
	gm_hªdË
 = 
ResourûHªdË
::
ü—‹
(
r
, 
this
, 
m_äame
.
g‘
(), 
çl£
, 
Œue
);

644  
	gçl£
;

647 
boŞ
 
	gMašResourûLßd”
::
lßd
(cÚ¡ 
ResourûReque¡
& 
r
, cÚ¡ 
Sub¡™u‹D©a
& 
sub¡™u‹D©a
)

649 #ifdeà
SSLAB__DEBUG


650 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

653 
ASSERT
(!
m_hªdË
);

655 
	gm_sub¡™u‹D©a
 = 
sub¡™u‹D©a
;

657 
ResourûReque¡
 
»que¡
(
r
);

659 #ià
ENABLE
(
OFFLINE_WEB_APPLICATIONS
)

660 
docum’tLßd”
()->
­¶iÿtiÚCacheHo¡
()->
maybeLßdMašResourû
(
»que¡
, 
m_sub¡™u‹D©a
);

663 
boŞ
 
	gdeãr
 = 
deãrsLßdšg
();

664 ià(
	gdeãr
) {

665 
boŞ
 
	gshouldLßdEm±y
 = 
shouldLßdAsEm±yDocum’t
(
»que¡
.
u¾
());

666 ià(
	gshouldLßdEm±y
)

667 
	gdeãr
 = 
çl£
;

669 ià(!
	gdeãr
) {

670 ià(
lßdNow
(
»que¡
)) {

672 
ASSERT
(
deãrsLßdšg
());

673 
	gdeãr
 = 
Œue
;

676 ià(
	gdeãr
)

677 
	gm_š™ŸlReque¡
 = 
»que¡
;

679  
	gŒue
;

682 
	gMašResourûLßd”
::
£tDeãrsLßdšg
(
boŞ
 
deãrs
)

684 #ifdeà
SSLAB__DEBUG


685 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

688 
	gResourûLßd”
::
£tDeãrsLßdšg
(
deãrs
);

690 ià(
	gdeãrs
) {

691 ià(
	gm_d©aLßdTim”
.
isAùive
())

692 
	gm_d©aLßdTim”
.
¡İ
();

694 ià(
	gm_š™ŸlReque¡
.
isNuÎ
())

697 ià(
	gm_sub¡™u‹D©a
.
isV®id
(è&& 
	gm_docum’tLßd”
->
deãrMašResourûD©aLßd
())

698 
¡¬tD©aLßdTim”
();

700 
ResourûReque¡
 
r
(
m_š™ŸlReque¡
);

701 
	gm_š™ŸlReque¡
 = 
ResourûReque¡
();

702 
lßdNow
(
r
);

	@MainResourceLoader.h

29 #iâdeà
MašResourûLßd”_h


30 
	#MašResourûLßd”_h


	)

32 
	~"F¿meLßd”Ty³s.h
"

33 
	~"ResourûLßd”.h
"

34 
	~"Sub¡™u‹D©a.h
"

35 
	~<wtf/FÜw¬d.h
>

37 #ià
HAVE
(
RUNLOOP_TIMER
)

38 
	~"RunLoİTim”.h
"

40 
	~"Tim”.h
"

43 
Çme¥aû
 
	gWebCÜe
 {

45 
şass
 
	gFÜmS‹
;

46 
şass
 
	gResourûReque¡
;

48 şas 
	cMašResourûLßd”
 : 
public
 
ResourûLßd”
 {

49 
public
:

50 
PassRefPŒ
<
MašResourûLßd”
> 
ü—‹
(
F¿me
*);

51 
	gvœtu®
 ~
MašResourûLßd”
();

53 
vœtu®
 
boŞ
 
lßd
(cÚ¡ 
ResourûReque¡
&, cÚ¡ 
Sub¡™u‹D©a
&);

54 
vœtu®
 
addD©a
(cÚ¡ *, , 
boŞ
 
®lAtOnû
);

56 
vœtu®
 
£tDeãrsLßdšg
(
boŞ
);

58 
vœtu®
 
wlS’dReque¡
(
ResourûReque¡
&, cÚ¡ 
ResourûRe¥Ú£
& 
»dœeùRe¥Ú£
);

59 
vœtu®
 
didReûiveRe¥Ú£
(cÚ¡ 
ResourûRe¥Ú£
&);

60 
vœtu®
 
didReûiveD©a
(cÚ¡ *, , 
ËngthReûived
, 
boŞ
 
®lAtOnû
);

61 
vœtu®
 
didFšishLßdšg
();

62 
vœtu®
 
didFa
(cÚ¡ 
ResourûE¼Ü
&);

64 #ià
HAVE
(
RUNLOOP_TIMER
)

65 
	gRunLoİTim”
<
	tMašResourûLßd”
> 
	tMašResourûLßd”Tim”
;

67 
	gTim”
<
	tMašResourûLßd”
> 
	tMašResourûLßd”Tim”
;

70 
hªdËD©aLßdNow
(
MašResourûLßd”Tim”
*);

72 
boŞ
 
isLßdšgMuÉ¬tCÚ‹Á
(ècÚ¡ {  
	gm_lßdšgMuÉ¬tCÚ‹Á
; }

74 
	g´iv©e
:

75 
MašResourûLßd”
(
F¿me
*);

77 
vœtu®
 
didCªûl
(cÚ¡ 
ResourûE¼Ü
&);

79 
boŞ
 
lßdNow
(
ResourûReque¡
&);

81 
hªdËEm±yLßd
(cÚ¡ 
KURL
&, 
boŞ
 
fÜURLScheme
);

82 
hªdËD©aLßdSoÚ
(
ResourûReque¡
& 
r
);

84 
¡¬tD©aLßdTim”
();

85 
hªdËD©aLßd
(
ResourûReque¡
&);

87 
»ûivedE¼Ü
(cÚ¡ 
ResourûE¼Ü
&);

88 
ResourûE¼Ü
 
š‹¼u±iÚFÜPŞicyChªgeE¼Ü
() const;

89 
¡İLßdšgFÜPŞicyChªge
();

90 
boŞ
 
isPo¡OrRedœeùAá”Po¡
(cÚ¡ 
ResourûReque¡
& 
ÃwReque¡
, cÚ¡ 
ResourûRe¥Ú£
& 
»dœeùRe¥Ú£
);

92 
ÿÎCÚtšueAá”Navig©iÚPŞicy
(*, cÚ¡ 
ResourûReque¡
&, 
PassRefPŒ
<
FÜmS‹
>, 
boŞ
 
shouldCÚtšue
);

93 
cÚtšueAá”Navig©iÚPŞicy
(cÚ¡ 
ResourûReque¡
&, 
boŞ
 
shouldCÚtšue
);

95 
ÿÎCÚtšueAá”CÚ‹ÁPŞicy
(*, 
PŞicyAùiÚ
);

96 
cÚtšueAá”CÚ‹ÁPŞicy
(
PŞicyAùiÚ
);

97 
cÚtšueAá”CÚ‹ÁPŞicy
(
PŞicyAùiÚ
, cÚ¡ 
ResourûRe¥Ú£
&);

99 #ià
PLATFORM
(
QT
)

100 
sub¡™u‹MIMETy³FromPlugšD©aba£
(cÚ¡ 
ResourûRe¥Ú£
&);

103 
ResourûReque¡
 
	gm_š™ŸlReque¡
;

104 
Sub¡™u‹D©a
 
	gm_sub¡™u‹D©a
;

106 
MašResourûLßd”Tim”
 
	gm_d©aLßdTim”
;

108 
boŞ
 
	gm_lßdšgMuÉ¬tCÚ‹Á
;

109 
boŞ
 
	gm_wa™šgFÜCÚ‹ÁPŞicy
;

	@MediaDocument.cpp

2 #ifdeà
SSLAB__DEBUG


3 #iâdeà
SSLAB__QDATETIME


4 
	#SSLAB__QDATETIME


	)

5 
	~<QD©eTime
>

9 #ifdeà
SSLAB__DEBUG


10 #iâdeà
SSLAB__QTHREAD


11 
	#SSLAB__QTHREAD


	)

12 
	~<QTh»ad
>

40 
	~"cÚfig.h
"

42 #ià
ENABLE
(
VIDEO
)

43 
	~"MedŸDocum’t.h
"

45 
	~"Docum’tLßd”.h
"

46 
	~"EËm’t.h
"

47 
	~"Ev’t.h
"

48 
	~"Ev’tNames.h
"

49 
	~"F¿me.h
"

50 
	~"F¿meLßd”.h
"

51 
	~"F¿meLßd”Cl›Á.h
"

52 
	~"HTMLEmbedEËm’t.h
"

53 
	~"HTMLNames.h
"

54 
	~"HTMLVideoEËm’t.h
"

55 
	~"KeybßrdEv’t.h
"

56 
	~"MašResourûLßd”.h
"

57 
	~"NodeLi¡.h
"

58 
	~"Page.h
"

59 
	~"Segm’‹dSŒšg.h
"

60 
	~"S‘tšgs.h
"

61 
	~"Text.h
"

62 
	~"XMLTok’iz”.h
"

64 
Çme¥aû
 
	gWebCÜe
 {

66 
usšg
 
Çme¥aû
 
	gHTMLNames
;

68 şas 
	cMedŸTok’iz”
 : 
public
 
Tok’iz”
 {

69 
public
:

70 
MedŸTok’iz”
(
Docum’t
* 
doc
è: 
m_doc
(doc), 
m_medŸEËm’t
(0) {}

72 
	g´iv©e
:

73 
vœtu®
 
wr™e
(cÚ¡ 
Segm’‹dSŒšg
&, 
boŞ
 
­³ndD©a
);

74 
vœtu®
 
¡İP¬sšg
();

75 
vœtu®
 
fšish
();

76 
vœtu®
 
boŞ
 
isWa™šgFÜSüts
() const;

78 
vœtu®
 
boŞ
 
wªtsRawD©a
(ècÚ¡ {  
	gŒue
; }

79 
vœtu®
 
boŞ
 
wr™eRawD©a
(cÚ¡ * 
d©a
, 
Ën
);

81 
ü—‹Docum’tSŒuùu»
();

83 
Docum’t
* 
	gm_doc
;

84 
HTMLMedŸEËm’t
* 
	gm_medŸEËm’t
;

87 
	gMedŸTok’iz”
::
	$wr™e
(cÚ¡ 
Segm’‹dSŒšg
&, 
boŞ
)

89 #ifdeà
SSLAB__DEBUG


90 
	`qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
	`cu¼’tD©eTime
().
	`toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
	`toAscii
().
	`d©a
(), 
QTh»ad
::
	`cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

93 
	`ASSERT_NOT_REACHED
();

94 
	}
}

96 
	gMedŸTok’iz”
::
	$ü—‹Docum’tSŒuùu»
()

98 #ifdeà
SSLAB__DEBUG


99 
	`qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
	`cu¼’tD©eTime
().
	`toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
	`toAscii
().
	`d©a
(), 
QTh»ad
::
	`cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

102 
Exû±iÚCode
 
ec
;

103 
RefPŒ
<
EËm’t
> 
roÙEËm’t
 = 
m_doc
->
	`ü—‹EËm’t
(
htmlTag
, 
çl£
);

104 
m_doc
->
	`­³ndChd
(
roÙEËm’t
, 
ec
);

106 
RefPŒ
<
EËm’t
> 
body
 = 
m_doc
->
	`ü—‹EËm’t
(
bodyTag
, 
çl£
);

107 
body
->
	`£tA‰ribu‹
(
¡yËA‰r
, "background-color:„gb(38,38,38);");

109 
roÙEËm’t
->
	`­³ndChd
(
body
, 
ec
);

111 
RefPŒ
<
EËm’t
> 
medŸEËm’t
 = 
m_doc
->
	`ü—‹EËm’t
(
videoTag
, 
çl£
);

113 
m_medŸEËm’t
 = 
¡©ic_ÿ¡
<
HTMLVideoEËm’t
*>(
medŸEËm’t
.
	`g‘
());

114 
m_medŸEËm’t
->
	`£tA‰ribu‹
(
cÚŒŞsA‰r
, "");

115 
m_medŸEËm’t
->
	`£tA‰ribu‹
(
autİÏyA‰r
, "");

116 
m_medŸEËm’t
->
	`£tA‰ribu‹
(
¡yËA‰r
, "margin:‡uto;…osition:‡bsolute;op: 0;„ight: 0; bottom: 0;†eft: 0;");

118 
m_medŸEËm’t
->
	`£tA‰ribu‹
(
ÇmeA‰r
, "media");

119 
m_medŸEËm’t
->
	`£tSrc
(
m_doc
->
	`u¾
());

121 
body
->
	`­³ndChd
(
medŸEËm’t
, 
ec
);

123 
F¿me
* 
äame
 = 
m_doc
->
	`äame
();

124 ià(!
äame
)

127 
äame
->
	`lßd”
()->
	`aùiveDocum’tLßd”
()->
	`mašResourûLßd”
()->
	`£tShouldBufãrD©a
(
çl£
);

128 
	}
}

130 
boŞ
 
	gMedŸTok’iz”
::
	$wr™eRawD©a
(const *, )

132 #ifdeà
SSLAB__DEBUG


133 
	`qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
	`cu¼’tD©eTime
().
	`toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
	`toAscii
().
	`d©a
(), 
QTh»ad
::
	`cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

136 
	`ASSERT
(!
m_medŸEËm’t
);

137 ià(
m_medŸEËm’t
)

138  
çl£
;

140 
	`ü—‹Docum’tSŒuùu»
();

141 
	`fšish
();

142  
çl£
;

143 
	}
}

145 
	gMedŸTok’iz”
::
	$¡İP¬sšg
()

147 #ifdeà
SSLAB__DEBUG


148 
	`qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
	`cu¼’tD©eTime
().
	`toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
	`toAscii
().
	`d©a
(), 
QTh»ad
::
	`cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

151 
Tok’iz”
::
	`¡İP¬sšg
();

152 
	}
}

154 
	gMedŸTok’iz”
::
	$fšish
()

156 #ifdeà
SSLAB__DEBUG


157 
	`qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
	`cu¼’tD©eTime
().
	`toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
	`toAscii
().
	`d©a
(), 
QTh»ad
::
	`cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

160 ià(!
m_·r£rStİ³d
)

161 
m_doc
->
	`fšishedP¬sšg
();

162 
	}
}

164 
boŞ
 
	gMedŸTok’iz”
::
	$isWa™šgFÜSüts
() const

166 #ifdeà
SSLAB__DEBUG


167 
	`qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
	`cu¼’tD©eTime
().
	`toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
	`toAscii
().
	`d©a
(), 
QTh»ad
::
	`cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

171  
çl£
;

172 
	}
}

174 
	gMedŸDocum’t
::
	$MedŸDocum’t
(
F¿me
* 
äame
)

175 : 
	`HTMLDocum’t
(
äame
)

176 , 
	`m_»¶aûMedŸEËm’tTim”
(
this
, &
MedŸDocum’t
::
»¶aûMedŸEËm’tTim”Fœed
)

178 #ifdeà
SSLAB__DEBUG


179 
	`qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
	`cu¼’tD©eTime
().
	`toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
	`toAscii
().
	`d©a
(), 
QTh»ad
::
	`cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

182 
	`£tP¬£Mode
(
Com·t
);

183 
	}
}

185 
	gMedŸDocum’t
::~
	$MedŸDocum’t
()

187 #ifdeà
SSLAB__DEBUG


188 
	`qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
	`cu¼’tD©eTime
().
	`toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
	`toAscii
().
	`d©a
(), 
QTh»ad
::
	`cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

191 
	`ASSERT
(!
m_»¶aûMedŸEËm’tTim”
.
	`isAùive
());

192 
	}
}

194 
Tok’iz”
* 
	gMedŸDocum’t
::
	$ü—‹Tok’iz”
()

196 #ifdeà
SSLAB__DEBUG


197 
	`qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
	`cu¼’tD©eTime
().
	`toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
	`toAscii
().
	`d©a
(), 
QTh»ad
::
	`cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

200  
Ãw
 
	`MedŸTok’iz”
(
this
);

201 
	}
}

203 
	gMedŸDocum’t
::
	$deçuÉEv’tHªdËr
(
Ev’t
* 
ev’t
)

205 #ifdeà
SSLAB__DEBUG


206 
	`qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
	`cu¼’tD©eTime
().
	`toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
	`toAscii
().
	`d©a
(), 
QTh»ad
::
	`cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

211 
Node
* 
rg‘Node
 = 
ev’t
->
	`rg‘
()->
	`toNode
();

212 ià(
rg‘Node
 &&¬g‘Node->
	`hasTagName
(
videoTag
)) {

213 
HTMLVideoEËm’t
* 
video
 = 
¡©ic_ÿ¡
<HTMLVideoEËm’t*>(
rg‘Node
);

214 ià(
ev’t
->
	`ty³
(è=ğ
	`ev’tNames
().
şickEv’t
) {

215 ià(!
video
->
	`ÿnPÏy
()) {

216 
video
->
	`·u£
(
ev’t
->
	`äomU£rGe¡u»
());

217 
ev’t
->
	`£tDeçuÉHªdËd
();

219 } ià(
ev’t
->
	`ty³
(è=ğ
	`ev’tNames
().
dblşickEv’t
) {

220 ià(
video
->
	`ÿnPÏy
()) {

221 
video
->
	`¶ay
(
ev’t
->
	`äomU£rGe¡u»
());

222 
ev’t
->
	`£tDeçuÉHªdËd
();

227 ià(
ev’t
->
	`ty³
(è=ğ
	`ev’tNames
().
keydownEv’t
 &&ƒv’t->
	`isKeybßrdEv’t
()) {

228 
HTMLVideoEËm’t
* 
video
 = 0;

229 ià(
rg‘Node
) {

230 ià(
rg‘Node
->
	`hasTagName
(
videoTag
))

231 
video
 = 
¡©ic_ÿ¡
<
HTMLVideoEËm’t
*>(
rg‘Node
);

233 
RefPŒ
<
NodeLi¡
> 
nodeLi¡
 = 
rg‘Node
->
	`g‘EËm’tsByTagName
("video");

234 ià(
nodeLi¡
.
	`g‘
()->
	`Ëngth
() > 0)

235 
video
 = 
¡©ic_ÿ¡
<
HTMLVideoEËm’t
*>(
nodeLi¡
.
	`g‘
()->
	`™em
(0));

238 ià(
video
) {

239 
KeybßrdEv’t
* 
keybßrdEv’t
 = 
¡©ic_ÿ¡
<KeybßrdEv’t*>(
ev’t
);

240 ià(
keybßrdEv’t
->
	`keyId’tif›r
() == "U+0020") {

241 ià(
video
->
	`·u£d
()) {

242 ià(
video
->
	`ÿnPÏy
())

243 
video
->
	`¶ay
(
ev’t
->
	`äomU£rGe¡u»
());

245 
video
->
	`·u£
(
ev’t
->
	`äomU£rGe¡u»
());

246 
ev’t
->
	`£tDeçuÉHªdËd
();

250 
	}
}

252 
	gMedŸDocum’t
::
	$medŸEËm’tSawUnsuµÜ‹dT¿cks
()

254 #ifdeà
SSLAB__DEBUG


255 
	`qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
	`cu¼’tD©eTime
().
	`toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
	`toAscii
().
	`d©a
(), 
QTh»ad
::
	`cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

263 
m_»¶aûMedŸEËm’tTim”
.
	`¡¬tOÃShÙ
(0);

264 
	}
}

266 
	gMedŸDocum’t
::
»¶aûMedŸEËm’tTim”Fœed
(
Tim”
<
MedŸDocum’t
>*)

268 #ifdeà
SSLAB__DEBUG


269 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

272 
HTMLEËm’t
* 
	ghtmlBody
 = 
body
();

273 ià(!
	ghtmlBody
)

277 
	ghtmlBody
->
£tA‰ribu‹
(
m¬gšwidthA‰r
, "0");

278 
	ghtmlBody
->
£tA‰ribu‹
(
m¬gšheightA‰r
, "0");

280 
	gRefPŒ
<
	gNodeLi¡
> 
	gnodeLi¡
 = 
htmlBody
->
g‘EËm’tsByTagName
("video");

282 ià(
	gnodeLi¡
.
g‘
()->
Ëngth
() > 0) {

283 
HTMLVideoEËm’t
* 
	gvideoEËm’t
 = 
¡©ic_ÿ¡
<HTMLVideoEËm’t*>(
nodeLi¡
.
g‘
()->
™em
(0));

285 
	gRefPŒ
<
	gEËm’t
> 
	g–em’t
 = 
Docum’t
::
ü—‹EËm’t
(
embedTag
, 
çl£
);

286 
HTMLEmbedEËm’t
* 
	gembedEËm’t
 = 
¡©ic_ÿ¡
<HTMLEmbedEËm’t*>(
–em’t
.
g‘
());

288 
	gembedEËm’t
->
£tA‰ribu‹
(
widthA‰r
, "100%");

289 
	gembedEËm’t
->
£tA‰ribu‹
(
heightA‰r
, "100%");

290 
	gembedEËm’t
->
£tA‰ribu‹
(
ÇmeA‰r
, "plugin");

291 
	gembedEËm’t
->
£tA‰ribu‹
(
¤cA‰r
, 
u¾
().
¡ršg
());

292 
	gembedEËm’t
->
£tA‰ribu‹
(
ty³A‰r
, 
äame
()->
lßd”
()->
»¥Ú£MIMETy³
());

294 
Exû±iÚCode
 
	gec
;

295 
	gvideoEËm’t
->
·»Á
()->
»¶aûChd
(
embedEËm’t
, 
videoEËm’t
, 
ec
);

	@MediaDocument.h

26 #iâdeà
MedŸDocum’t_h


27 
	#MedŸDocum’t_h


	)

29 #ià
ENABLE
(
VIDEO
)

31 
	~"HTMLDocum’t.h
"

33 
Çme¥aû
 
	gWebCÜe
 {

35 şas 
	cMedŸDocum’t
 : 
public
 
HTMLDocum’t
 {

36 
public
:

37 
PassRefPŒ
<
MedŸDocum’t
> 
ü—‹
(
F¿me
* 
äame
)

39  
adİtRef
(
Ãw
 
MedŸDocum’t
(
äame
));

41 
	gvœtu®
 ~
MedŸDocum’t
();

43 
medŸEËm’tSawUnsuµÜ‹dT¿cks
();

45 
	g´iv©e
:

46 
MedŸDocum’t
(
F¿me
*);

48 
vœtu®
 
boŞ
 
isMedŸDocum’t
(ècÚ¡ {  
	gŒue
; }

49 
vœtu®
 
Tok’iz”
* 
ü—‹Tok’iz”
();

51 
vœtu®
 
deçuÉEv’tHªdËr
(
Ev’t
*);

53 
»¶aûMedŸEËm’tTim”Fœed
(
Tim”
<
MedŸDocum’t
>*);

55 
	gTim”
<
	gMedŸDocum’t
> 
	gm_»¶aûMedŸEËm’tTim”
;

	@NavigationAction.cpp

2 #ifdeà
SSLAB__DEBUG


3 #iâdeà
SSLAB__QDATETIME


4 
	#SSLAB__QDATETIME


	)

5 
	~<QD©eTime
>

9 #ifdeà
SSLAB__DEBUG


10 #iâdeà
SSLAB__QTHREAD


11 
	#SSLAB__QTHREAD


	)

12 
	~<QTh»ad
>

43 
	~"cÚfig.h
"

44 
	~"Navig©iÚAùiÚ.h
"

46 
	~"Ev’t.h
"

47 
	~"F¿meLßd”.h
"

49 
Çme¥aû
 
	gWebCÜe
 {

51 
Navig©iÚTy³
 
Çvig©iÚTy³
(
F¿meLßdTy³
 
äameLßdTy³
, 
boŞ
 
isFÜmSubmissiÚ
, boŞ 
haveEv’t
)

53 #ifdeà
SSLAB__DEBUG


54 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

57 ià(
	gisFÜmSubmissiÚ
)

58  
	gNavig©iÚTy³FÜmSubm™‹d
;

59 ià(
	ghaveEv’t
)

60  
	gNavig©iÚTy³LškClicked
;

61 ià(
	gäameLßdTy³
 =ğ
F¿meLßdTy³R–ßd
 || 
äameLßdTy³
 =ğ
F¿meLßdTy³R–ßdFromOrigš
)

62  
Navig©iÚTy³R–ßd
;

63 ià(
isBackFÜw¬dLßdTy³
(
äameLßdTy³
))

64  
	gNavig©iÚTy³BackFÜw¬d
;

65  
	gNavig©iÚTy³Oth”
;

68 
	gNavig©iÚAùiÚ
::
Navig©iÚAùiÚ
()

69 : 
m_ty³
(
Navig©iÚTy³Oth”
)

71 #ifdeà
SSLAB__DEBUG


72 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

77 
	gNavig©iÚAùiÚ
::
Navig©iÚAùiÚ
(cÚ¡ 
KURL
& 
u¾
, 
Navig©iÚTy³
 
ty³
)

78 : 
m_URL
(
u¾
)

79 , 
m_ty³
(
ty³
)

81 #ifdeà
SSLAB__DEBUG


82 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

87 
	gNavig©iÚAùiÚ
::
Navig©iÚAùiÚ
(cÚ¡ 
KURL
& 
u¾
, 
F¿meLßdTy³
 
äameLßdTy³
,

88 
boŞ
 
isFÜmSubmissiÚ
)

89 : 
m_URL
(
u¾
)

90 , 
m_ty³
(
Çvig©iÚTy³
(
äameLßdTy³
, 
isFÜmSubmissiÚ
, 0))

92 #ifdeà
SSLAB__DEBUG


93 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

98 
	gNavig©iÚAùiÚ
::
Navig©iÚAùiÚ
(cÚ¡ 
KURL
& 
u¾
, 
Navig©iÚTy³
 
ty³
, 
PassRefPŒ
<
Ev’t
> 
ev’t
)

99 : 
m_URL
(
u¾
)

100 , 
m_ty³
(
ty³
)

101 , 
m_ev’t
(
ev’t
)

103 #ifdeà
SSLAB__DEBUG


104 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

109 
	gNavig©iÚAùiÚ
::
Navig©iÚAùiÚ
(cÚ¡ 
KURL
& 
u¾
, 
F¿meLßdTy³
 
äameLßdTy³
,

110 
boŞ
 
isFÜmSubmissiÚ
, 
PassRefPŒ
<
Ev’t
> 
ev’t
)

111 : 
m_URL
(
u¾
)

112 , 
m_ty³
(
Çvig©iÚTy³
(
äameLßdTy³
, 
isFÜmSubmissiÚ
, 
ev’t
))

113 , 
m_ev’t
(
ev’t
)

115 #ifdeà
SSLAB__DEBUG


116 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

	@NavigationAction.h

29 #iâdeà
Navig©iÚAùiÚ_h


30 
	#Navig©iÚAùiÚ_h


	)

32 
	~"Ev’t.h
"

33 
	~"F¿meLßd”Ty³s.h
"

34 
	~"KURL.h
"

35 
	~<wtf/FÜw¬d.h
>

37 
Çme¥aû
 
	gWebCÜe
 {

39 şas 
	cNavig©iÚAùiÚ
 {

40 
	gpublic
:

41 
Navig©iÚAùiÚ
();

42 
Navig©iÚAùiÚ
(cÚ¡ 
KURL
&, 
Navig©iÚTy³
);

43 
Navig©iÚAùiÚ
(cÚ¡ 
KURL
&, 
F¿meLßdTy³
, 
boŞ
 
isFÜmSubmissiÚ
);

44 
Navig©iÚAùiÚ
(cÚ¡ 
KURL
&, 
Navig©iÚTy³
, 
PassRefPŒ
<
Ev’t
>);

45 
Navig©iÚAùiÚ
(cÚ¡ 
KURL
&, 
F¿meLßdTy³
, 
boŞ
 
isFÜmSubmissiÚ
, 
PassRefPŒ
<
Ev’t
>);

47 
boŞ
 
isEm±y
(ècÚ¡ {  
	gm_URL
.isEmpty(); }

49 
KURL
 
u¾
(ècÚ¡ {  
	gm_URL
; }

50 
Navig©iÚTy³
 
ty³
(ècÚ¡ {  
	gm_ty³
; }

51 cÚ¡ 
Ev’t
* 
ev’t
(ècÚ¡ {  
	gm_ev’t
.
g‘
(); }

53 
	g´iv©e
:

54 
KURL
 
m_URL
;

55 
Navig©iÚTy³
 
	gm_ty³
;

56 
	gRefPŒ
<
	gEv’t
> 
	gm_ev’t
;

	@NetscapePlugInStreamLoader.cpp

2 #ifdeà
SSLAB__DEBUG


3 #iâdeà
SSLAB__QDATETIME


4 
	#SSLAB__QDATETIME


	)

5 
	~<QD©eTime
>

9 #ifdeà
SSLAB__DEBUG


10 #iâdeà
SSLAB__QTHREAD


11 
	#SSLAB__QTHREAD


	)

12 
	~<QTh»ad
>

43 
	~"cÚfig.h
"

44 
	~"N‘sÿ³PlugInSŒ—mLßd”.h
"

46 
	~"F¿meLßd”.h
"

47 
	~"Docum’tLßd”.h
"

49 
Çme¥aû
 
	gWebCÜe
 {

51 
	gN‘sÿ³PlugInSŒ—mLßd”
::
N‘sÿ³PlugInSŒ—mLßd”
(
F¿me
* 
äame
, 
N‘sÿ³PlugInSŒ—mLßd”Cl›Á
* 
ş›Á
)

52 : 
ResourûLßd”
(
äame
, 
Œue
,rue)

53 , 
m_ş›Á
(
ş›Á
)

55 #ifdeà
SSLAB__DEBUG


56 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

61 
	gN‘sÿ³PlugInSŒ—mLßd”
::~
N‘sÿ³PlugInSŒ—mLßd”
()

63 #ifdeà
SSLAB__DEBUG


64 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

69 
	gPassRefPŒ
<
	gN‘sÿ³PlugInSŒ—mLßd”
> N‘sÿ³PlugInSŒ—mLßd”::
ü—‹
(
F¿me
* 
äame
, 
N‘sÿ³PlugInSŒ—mLßd”Cl›Á
* 
ş›Á
)

71 #ifdeà
SSLAB__DEBUG


72 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

75  
adİtRef
(
Ãw
 
N‘sÿ³PlugInSŒ—mLßd”
(
äame
, 
ş›Á
));

78 
boŞ
 
	gN‘sÿ³PlugInSŒ—mLßd”
::
isDÚe
() const

80 #ifdeà
SSLAB__DEBUG


81 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

84  !
	gm_ş›Á
;

87 
	gN‘sÿ³PlugInSŒ—mLßd”
::
»Ëa£Resourûs
()

89 #ifdeà
SSLAB__DEBUG


90 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

93 
	gm_ş›Á
 = 0;

94 
	gResourûLßd”
::
»Ëa£Resourûs
();

97 
	gN‘sÿ³PlugInSŒ—mLßd”
::
didReûiveRe¥Ú£
(cÚ¡ 
ResourûRe¥Ú£
& 
»¥Ú£
)

99 #ifdeà
SSLAB__DEBUG


100 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

103 
	gRefPŒ
<
	gN‘sÿ³PlugInSŒ—mLßd”
> 
´Ùeù
(
this
);

105 
	gm_ş›Á
->
didReûiveRe¥Ú£
(
this
, 
»¥Ú£
);

108 ià(!
	gm_ş›Á
)

111 
	gResourûLßd”
::
didReûiveRe¥Ú£
(
»¥Ú£
);

114 ià(!
	gm_ş›Á
)

117 ià(!
	g»¥Ú£
.
isHTTP
())

120 ià(
	gm_ş›Á
->
wªtsAÎSŒ—ms
())

123 ià(
	g»¥Ú£
.
h‰pStusCode
() < 100 ||„esponse.httpStatusCode() >= 400)

124 
didCªûl
(
äameLßd”
()->
feDÛsNÙExi¡E¼Ü
(
»¥Ú£
));

127 
	gN‘sÿ³PlugInSŒ—mLßd”
::
didReûiveD©a
(cÚ¡ * 
d©a
, 
Ëngth
, 
ËngthReûived
, 
boŞ
 
®lAtOnû
)

129 #ifdeà
SSLAB__DEBUG


130 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

133 
	gRefPŒ
<
	gN‘sÿ³PlugInSŒ—mLßd”
> 
´Ùeù
(
this
);

135 
	gm_ş›Á
->
didReûiveD©a
(
this
, 
d©a
, 
Ëngth
);

137 
	gResourûLßd”
::
didReûiveD©a
(
d©a
, 
Ëngth
, 
ËngthReûived
, 
®lAtOnû
);

140 
	gN‘sÿ³PlugInSŒ—mLßd”
::
didFšishLßdšg
()

142 #ifdeà
SSLAB__DEBUG


143 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

146 
	gRefPŒ
<
	gN‘sÿ³PlugInSŒ—mLßd”
> 
´Ùeù
(
this
);

148 
	gm_docum’tLßd”
->
»movePlugInSŒ—mLßd”
(
this
);

149 
	gm_ş›Á
->
didFšishLßdšg
(
this
);

150 
	gResourûLßd”
::
didFšishLßdšg
();

153 
	gN‘sÿ³PlugInSŒ—mLßd”
::
didFa
(cÚ¡ 
ResourûE¼Ü
& 
”rÜ
)

155 #ifdeà
SSLAB__DEBUG


156 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

159 
	gRefPŒ
<
	gN‘sÿ³PlugInSŒ—mLßd”
> 
´Ùeù
(
this
);

161 
	gm_docum’tLßd”
->
»movePlugInSŒ—mLßd”
(
this
);

162 
	gm_ş›Á
->
didFa
(
this
, 
”rÜ
);

163 
	gResourûLßd”
::
didFa
(
”rÜ
);

166 
	gN‘sÿ³PlugInSŒ—mLßd”
::
didCªûl
(cÚ¡ 
ResourûE¼Ü
& 
”rÜ
)

168 #ifdeà
SSLAB__DEBUG


169 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

172 
	gRefPŒ
<
	gN‘sÿ³PlugInSŒ—mLßd”
> 
´Ùeù
(
this
);

174 
	gm_ş›Á
->
didFa
(
this
, 
”rÜ
);

178 ià(
»achedT”mš®S‹
())

184 
	gm_docum’tLßd”
->
»movePlugInSŒ—mLßd”
(
this
);

186 
	gResourûLßd”
::
didCªûl
(
”rÜ
);

	@NetscapePlugInStreamLoader.h

29 
	~"ResourûLßd”.h
"

30 
	~<wtf/FÜw¬d.h
>

32 
Çme¥aû
 
	gWebCÜe
 {

34 
şass
 
	gN‘sÿ³PlugInSŒ—mLßd”
;

36 şas 
	cN‘sÿ³PlugInSŒ—mLßd”Cl›Á
 {

37 
	gpublic
:

38 
vœtu®
 
didReûiveRe¥Ú£
(
N‘sÿ³PlugInSŒ—mLßd”
*, cÚ¡ 
ResourûRe¥Ú£
&) = 0;

39 
vœtu®
 
didReûiveD©a
(
N‘sÿ³PlugInSŒ—mLßd”
*, const *, ) = 0;

40 
vœtu®
 
didFa
(
N‘sÿ³PlugInSŒ—mLßd”
*, cÚ¡ 
ResourûE¼Ü
&) = 0;

41 
vœtu®
 
didFšishLßdšg
(
N‘sÿ³PlugInSŒ—mLßd”
*) { }

42 
vœtu®
 
boŞ
 
wªtsAÎSŒ—ms
(ècÚ¡ {  
	gçl£
; }

44 
	g´Ùeùed
:

45 
vœtu®
 ~
N‘sÿ³PlugInSŒ—mLßd”Cl›Á
() { }

48 şas 
	cN‘sÿ³PlugInSŒ—mLßd”
 : 
public
 
ResourûLßd”
 {

49 
public
:

50 
PassRefPŒ
<
N‘sÿ³PlugInSŒ—mLßd”
> 
ü—‹
(
F¿me
*, 
N‘sÿ³PlugInSŒ—mLßd”Cl›Á
*);

51 
	gvœtu®
 ~
N‘sÿ³PlugInSŒ—mLßd”
();

53 
boŞ
 
isDÚe
() const;

55 
	g´iv©e
:

56 
vœtu®
 
didReûiveRe¥Ú£
(cÚ¡ 
ResourûRe¥Ú£
&);

57 
vœtu®
 
didReûiveD©a
(cÚ¡ *, , 
ËngthReûived
, 
boŞ
 
®lAtOnû
);

58 
vœtu®
 
didFšishLßdšg
();

59 
vœtu®
 
didFa
(cÚ¡ 
ResourûE¼Ü
&);

61 
vœtu®
 
»Ëa£Resourûs
();

63 
N‘sÿ³PlugInSŒ—mLßd”
(
F¿me
*, 
N‘sÿ³PlugInSŒ—mLßd”Cl›Á
*);

65 
vœtu®
 
didCªûl
(cÚ¡ 
ResourûE¼Ü
& 
”rÜ
);

67 
N‘sÿ³PlugInSŒ—mLßd”Cl›Á
* 
	gm_ş›Á
;

	@PlaceholderDocument.cpp

2 #ifdeà
SSLAB__DEBUG


3 #iâdeà
SSLAB__QDATETIME


4 
	#SSLAB__QDATETIME


	)

5 
	~<QD©eTime
>

9 #ifdeà
SSLAB__DEBUG


10 #iâdeà
SSLAB__QTHREAD


11 
	#SSLAB__QTHREAD


	)

12 
	~<QTh»ad
>

40 
	~"cÚfig.h
"

41 
	~"PÏûhŞd”Docum’t.h
"

43 
	~"CSSStyËS–eùÜ.h
"

44 
	~"StyËSh“tLi¡.h
"

46 
Çme¥aû
 
	gWebCÜe
 {

48 
	gPÏûhŞd”Docum’t
::
©ch
()

50 #ifdeà
SSLAB__DEBUG


51 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

54 
ASSERT
(!
©ched
());

57 
	gCÚš”Node
::
©ch
();

	@PlaceholderDocument.h

26 #iâdeà
PÏûhŞd”Docum’t_h


27 
	#PÏûhŞd”Docum’t_h


	)

29 
	~"Docum’t.h
"

31 
Çme¥aû
 
	gWebCÜe
 {

33 şas 
	cPÏûhŞd”Docum’t
 : 
public
 
Docum’t
 {

34 
public
:

35 
PassRefPŒ
<
PÏûhŞd”Docum’t
> 
ü—‹
(
F¿me
* 
äame
)

37  
adİtRef
(
Ãw
 
PÏûhŞd”Docum’t
(
äame
));

40 
vœtu®
 
©ch
();

42 
	g´iv©e
:

43 
PÏûhŞd”Docum’t
(
F¿me
* 
äame
è: 
Docum’t
(äame, 
çl£
, false) { }

	@PluginDocument.cpp

2 #ifdeà
SSLAB__DEBUG


3 #iâdeà
SSLAB__QDATETIME


4 
	#SSLAB__QDATETIME


	)

5 
	~<QD©eTime
>

9 #ifdeà
SSLAB__DEBUG


10 #iâdeà
SSLAB__QTHREAD


11 
	#SSLAB__QTHREAD


	)

12 
	~<QTh»ad
>

39 
	~"cÚfig.h
"

40 
	~"PlugšDocum’t.h
"

42 
	~"Docum’tLßd”.h
"

43 
	~"EËm’t.h
"

44 
	~"F¿me.h
"

45 
	~"F¿meLßd”.h
"

46 
	~"F¿meLßd”Cl›Á.h
"

47 
	~"HTMLEmbedEËm’t.h
"

48 
	~"HTMLNames.h
"

49 
	~"MašResourûLßd”.h
"

50 
	~"Page.h
"

51 
	~"R’d”EmbeddedObjeù.h
"

52 
	~"R’d”Widg‘.h
"

53 
	~"Segm’‹dSŒšg.h
"

54 
	~"S‘tšgs.h
"

55 
	~"Text.h
"

56 
	~"XMLTok’iz”.h
"

58 
Çme¥aû
 
	gWebCÜe
 {

60 
usšg
 
Çme¥aû
 
	gHTMLNames
;

62 şas 
	cPlugšTok’iz”
 : 
public
 
Tok’iz”
 {

63 
public
:

64 
PlugšTok’iz”
(
Docum’t
* 
doc
è: 
m_doc
(doc), 
m_embedEËm’t
(0) {}

65 
Widg‘
* 
¶ugšWidg‘FromDocum’t
(
Docum’t
* 
doc
);

67 
	g´iv©e
:

68 
vœtu®
 
wr™e
(cÚ¡ 
Segm’‹dSŒšg
&, 
boŞ
 
­³ndD©a
);

69 
vœtu®
 
¡İP¬sšg
();

70 
vœtu®
 
fšish
();

71 
vœtu®
 
boŞ
 
isWa™šgFÜSüts
() const;

73 
vœtu®
 
boŞ
 
wªtsRawD©a
(ècÚ¡ {  
	gŒue
; }

74 
vœtu®
 
boŞ
 
wr™eRawD©a
(cÚ¡ * 
d©a
, 
Ën
);

76 
ü—‹Docum’tSŒuùu»
();

78 
Docum’t
* 
	gm_doc
;

79 
HTMLEmbedEËm’t
* 
	gm_embedEËm’t
;

82 
Widg‘
* 
	gPlugšTok’iz”
::
	$¶ugšWidg‘FromDocum’t
(
Docum’t
* 
doc
)

84 #ifdeà
SSLAB__DEBUG


85 
	`qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
	`cu¼’tD©eTime
().
	`toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
	`toAscii
().
	`d©a
(), 
QTh»ad
::
	`cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

88 
	`ASSERT
(
doc
);

89 
RefPŒ
<
EËm’t
> 
body
 = 
doc
->
	`body
();

90 ià(
body
) {

91 
RefPŒ
<
Node
> 
node
 = 
body
->
	`fœ¡Chd
();

92 ià(
node
 &&‚ode->
	`»nd””
()) {

93 
	`ASSERT
(
node
->
	`»nd””
()->
	`isEmbeddedObjeù
());

94  
	`toR’d”EmbeddedObjeù
(
node
->
	`»nd””
())->
	`widg‘
();

98 
	}
}

100 
	gPlugšTok’iz”
::
	$wr™e
(cÚ¡ 
Segm’‹dSŒšg
&, 
boŞ
)

102 #ifdeà
SSLAB__DEBUG


103 
	`qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
	`cu¼’tD©eTime
().
	`toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
	`toAscii
().
	`d©a
(), 
QTh»ad
::
	`cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

106 
	`ASSERT_NOT_REACHED
();

107 
	}
}

109 
	gPlugšTok’iz”
::
	$ü—‹Docum’tSŒuùu»
()

111 #ifdeà
SSLAB__DEBUG


112 
	`qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
	`cu¼’tD©eTime
().
	`toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
	`toAscii
().
	`d©a
(), 
QTh»ad
::
	`cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

115 
Exû±iÚCode
 
ec
;

116 
RefPŒ
<
EËm’t
> 
roÙEËm’t
 = 
m_doc
->
	`ü—‹EËm’t
(
htmlTag
, 
çl£
);

117 
m_doc
->
	`­³ndChd
(
roÙEËm’t
, 
ec
);

119 
RefPŒ
<
EËm’t
> 
body
 = 
m_doc
->
	`ü—‹EËm’t
(
bodyTag
, 
çl£
);

120 
body
->
	`£tA‰ribu‹
(
m¬gšwidthA‰r
, "0");

121 
body
->
	`£tA‰ribu‹
(
m¬gšheightA‰r
, "0");

122 
body
->
	`£tA‰ribu‹
(
bgcŞÜA‰r
, "rgb(38,38,38)");

124 
roÙEËm’t
->
	`­³ndChd
(
body
, 
ec
);

126 
RefPŒ
<
EËm’t
> 
embedEËm’t
 = 
m_doc
->
	`ü—‹EËm’t
(
embedTag
, 
çl£
);

128 
m_embedEËm’t
 = 
¡©ic_ÿ¡
<
HTMLEmbedEËm’t
*>(
embedEËm’t
.
	`g‘
());

129 
m_embedEËm’t
->
	`£tA‰ribu‹
(
widthA‰r
, "100%");

130 
m_embedEËm’t
->
	`£tA‰ribu‹
(
heightA‰r
, "100%");

132 
m_embedEËm’t
->
	`£tA‰ribu‹
(
ÇmeA‰r
, "plugin");

133 
m_embedEËm’t
->
	`£tA‰ribu‹
(
¤cA‰r
, 
m_doc
->
	`u¾
().
	`¡ršg
());

134 
m_embedEËm’t
->
	`£tA‰ribu‹
(
ty³A‰r
, 
m_doc
->
	`äame
()->
	`lßd”
()->
	`»¥Ú£MIMETy³
());

136 
body
->
	`­³ndChd
(
embedEËm’t
, 
ec
);

137 
	}
}

139 
boŞ
 
	gPlugšTok’iz”
::
	$wr™eRawD©a
(const *, )

141 #ifdeà
SSLAB__DEBUG


142 
	`qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
	`cu¼’tD©eTime
().
	`toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
	`toAscii
().
	`d©a
(), 
QTh»ad
::
	`cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

145 
	`ASSERT
(!
m_embedEËm’t
);

146 ià(
m_embedEËm’t
)

147  
çl£
;

149 
	`ü—‹Docum’tSŒuùu»
();

151 ià(
F¿me
* 
äame
 = 
m_doc
->
	`äame
()) {

152 
S‘tšgs
* 
£‰šgs
 = 
äame
->
	`£‰šgs
();

153 ià(
£‰šgs
 && 
äame
->
	`lßd”
()->
	`®lowPlugšs
(
NÙAboutToIn¡ªtŸ‹Plugš
)) {

154 
m_doc
->
	`upd©eLayout
();

156 ià(
R’d”Widg‘
* 
»nd””
 = 
	`toR’d”Widg‘
(
m_embedEËm’t
->
	`»nd””
())) {

157 
äame
->
	`lßd”
()->
	`ş›Á
()->
	`»dœeùD©aToPlugš
(
»nd””
->
	`widg‘
());

158 
äame
->
	`lßd”
()->
	`aùiveDocum’tLßd”
()->
	`mašResourûLßd”
()->
	`£tShouldBufãrD©a
(
çl£
);

161 
	`fšish
();

165  
çl£
;

166 
	}
}

168 
	gPlugšTok’iz”
::
	$¡İP¬sšg
()

170 #ifdeà
SSLAB__DEBUG


171 
	`qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
	`cu¼’tD©eTime
().
	`toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
	`toAscii
().
	`d©a
(), 
QTh»ad
::
	`cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

174 
Tok’iz”
::
	`¡İP¬sšg
();

175 
	}
}

177 
	gPlugšTok’iz”
::
	$fšish
()

179 #ifdeà
SSLAB__DEBUG


180 
	`qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
	`cu¼’tD©eTime
().
	`toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
	`toAscii
().
	`d©a
(), 
QTh»ad
::
	`cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

183 ià(!
m_·r£rStİ³d
)

184 
m_doc
->
	`fšishedP¬sšg
();

185 
	}
}

187 
boŞ
 
	gPlugšTok’iz”
::
	$isWa™šgFÜSüts
() const

189 #ifdeà
SSLAB__DEBUG


190 
	`qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
	`cu¼’tD©eTime
().
	`toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
	`toAscii
().
	`d©a
(), 
QTh»ad
::
	`cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

194  
çl£
;

195 
	}
}

197 
	gPlugšDocum’t
::
	$PlugšDocum’t
(
F¿me
* 
äame
)

198 : 
	$HTMLDocum’t
(
äame
)

200 #ifdeà
SSLAB__DEBUG


201 
	`qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
	`cu¼’tD©eTime
().
	`toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
	`toAscii
().
	`d©a
(), 
QTh»ad
::
	`cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

204 
	`£tP¬£Mode
(
Com·t
);

205 
	}
}

207 
Tok’iz”
* 
	gPlugšDocum’t
::
	$ü—‹Tok’iz”
()

209 #ifdeà
SSLAB__DEBUG


210 
	`qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
	`cu¼’tD©eTime
().
	`toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
	`toAscii
().
	`d©a
(), 
QTh»ad
::
	`cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

213  
Ãw
 
	`PlugšTok’iz”
(
this
);

214 
	}
}

216 
Widg‘
* 
	gPlugšDocum’t
::
	$¶ugšWidg‘
()

218 #ifdeà
SSLAB__DEBUG


219 
	`qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
	`cu¼’tD©eTime
().
	`toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
	`toAscii
().
	`d©a
(), 
QTh»ad
::
	`cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

222  
PlugšTok’iz”
::
	`¶ugšWidg‘FromDocum’t
(
this
);

223 
	}
}

225 
Node
* 
	gPlugšDocum’t
::
	$¶ugšNode
()

227 #ifdeà
SSLAB__DEBUG


228 
	`qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
	`cu¼’tD©eTime
().
	`toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
	`toAscii
().
	`d©a
(), 
QTh»ad
::
	`cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

231 
RefPŒ
<
EËm’t
> 
body_–em’t
 = 
	`body
();

232 ià(
body_–em’t
)

233  
body_–em’t
->
	`fœ¡Chd
();

236 
	}
}

	@PluginDocument.h

25 #iâdeà
PlugšDocum’t_h


26 
	#PlugšDocum’t_h


	)

28 
	~"HTMLDocum’t.h
"

30 
Çme¥aû
 
	gWebCÜe
 {

32 
şass
 
	gNode
;

33 
şass
 
	gWidg‘
;

34 şas 
	cPlugšDocum’t
 : 
public
 
HTMLDocum’t
 {

35 
public
:

36 
PassRefPŒ
<
PlugšDocum’t
> 
ü—‹
(
F¿me
* 
äame
)

38  
adİtRef
(
Ãw
 
PlugšDocum’t
(
äame
));

41 
Widg‘
* 
¶ugšWidg‘
();

42 
Node
* 
¶ugšNode
();

44 
	g´iv©e
:

45 
PlugšDocum’t
(
F¿me
*);

47 
vœtu®
 
boŞ
 
isPlugšDocum’t
(ècÚ¡ {  
	gŒue
; }

48 
vœtu®
 
Tok’iz”
* 
ü—‹Tok’iz”
();

	@PolicyCallback.cpp

2 #ifdeà
SSLAB__DEBUG


3 #iâdeà
SSLAB__QDATETIME


4 
	#SSLAB__QDATETIME


	)

5 
	~<QD©eTime
>

9 #ifdeà
SSLAB__DEBUG


10 #iâdeà
SSLAB__QTHREAD


11 
	#SSLAB__QTHREAD


	)

12 
	~<QTh»ad
>

45 
	~"cÚfig.h
"

46 
	~"PŞicyC®lback.h
"

48 
	~"FÜmS‹.h
"

49 
	~"F¿me.h
"

50 
	~"F¿meLßd”.h
"

51 
	~"HTMLFÜmEËm’t.h
"

53 
Çme¥aû
 
	gWebCÜe
 {

55 
	gPŞicyC®lback
::
PŞicyC®lback
()

56 : 
m_Çvig©iÚFunùiÚ
(0)

57 , 
m_ÃwWšdowFunùiÚ
(0)

58 , 
m_cÚ‹ÁFunùiÚ
(0)

60 #ifdeà
SSLAB__DEBUG


61 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

66 
	gPŞicyC®lback
::~
PŞicyC®lback
()

68 #ifdeà
SSLAB__DEBUG


69 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

74 
	gPŞicyC®lback
::
ş—r
()

76 #ifdeà
SSLAB__DEBUG


77 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

80 
ş—rReque¡
();

81 
	gm_Çvig©iÚFunùiÚ
 = 0;

82 
	gm_ÃwWšdowFunùiÚ
 = 0;

83 
	gm_cÚ‹ÁFunùiÚ
 = 0;

86 
	gPŞicyC®lback
::
£t
(cÚ¡ 
ResourûReque¡
& 
»que¡
, 
PassRefPŒ
<
FÜmS‹
> 
fÜmS‹
,

87 
Navig©iÚPŞicyDecisiÚFunùiÚ
 
funùiÚ
, * 
¬gum’t
)

89 #ifdeà
SSLAB__DEBUG


90 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

93 
	gm_»que¡
 = 
»que¡
;

94 
	gm_fÜmS‹
 = 
fÜmS‹
;

95 
	gm_äameName
 = 
SŒšg
();

97 
	gm_Çvig©iÚFunùiÚ
 = 
funùiÚ
;

98 
	gm_ÃwWšdowFunùiÚ
 = 0;

99 
	gm_cÚ‹ÁFunùiÚ
 = 0;

100 
	gm_¬gum’t
 = 
¬gum’t
;

103 
	gPŞicyC®lback
::
£t
(cÚ¡ 
ResourûReque¡
& 
»que¡
, 
PassRefPŒ
<
FÜmS‹
> 
fÜmS‹
,

104 cÚ¡ 
SŒšg
& 
äameName
, 
NewWšdowPŞicyDecisiÚFunùiÚ
 
funùiÚ
, * 
¬gum’t
)

106 #ifdeà
SSLAB__DEBUG


107 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

110 
	gm_»que¡
 = 
»que¡
;

111 
	gm_fÜmS‹
 = 
fÜmS‹
;

112 
	gm_äameName
 = 
äameName
;

114 
	gm_Çvig©iÚFunùiÚ
 = 0;

115 
	gm_ÃwWšdowFunùiÚ
 = 
funùiÚ
;

116 
	gm_cÚ‹ÁFunùiÚ
 = 0;

117 
	gm_¬gum’t
 = 
¬gum’t
;

120 
	gPŞicyC®lback
::
£t
(
CÚ‹ÁPŞicyDecisiÚFunùiÚ
 
funùiÚ
, * 
¬gum’t
)

122 #ifdeà
SSLAB__DEBUG


123 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

126 
	gm_»que¡
 = 
ResourûReque¡
();

127 
	gm_fÜmS‹
 = 0;

128 
	gm_äameName
 = 
SŒšg
();

130 
	gm_Çvig©iÚFunùiÚ
 = 0;

131 
	gm_ÃwWšdowFunùiÚ
 = 0;

132 
	gm_cÚ‹ÁFunùiÚ
 = 
funùiÚ
;

133 
	gm_¬gum’t
 = 
¬gum’t
;

136 
	gPŞicyC®lback
::
ÿÎ
(
boŞ
 
shouldCÚtšue
)

138 #ifdeà
SSLAB__DEBUG


139 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

142 ià(
	gm_Çvig©iÚFunùiÚ
)

143 
m_Çvig©iÚFunùiÚ
(
m_¬gum’t
, 
m_»que¡
, 
m_fÜmS‹
.
g‘
(), 
shouldCÚtšue
);

144 ià(
	gm_ÃwWšdowFunùiÚ
)

145 
m_ÃwWšdowFunùiÚ
(
m_¬gum’t
, 
m_»que¡
, 
m_fÜmS‹
.
g‘
(), 
m_äameName
, 
shouldCÚtšue
);

146 
ASSERT
(!
m_cÚ‹ÁFunùiÚ
);

149 
	gPŞicyC®lback
::
ÿÎ
(
PŞicyAùiÚ
 
aùiÚ
)

151 #ifdeà
SSLAB__DEBUG


152 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

155 
ASSERT
(!
m_Çvig©iÚFunùiÚ
);

156 
ASSERT
(!
m_ÃwWšdowFunùiÚ
);

157 
ASSERT
(
m_cÚ‹ÁFunùiÚ
);

158 
m_cÚ‹ÁFunùiÚ
(
m_¬gum’t
, 
aùiÚ
);

161 
	gPŞicyC®lback
::
ş—rReque¡
()

163 #ifdeà
SSLAB__DEBUG


164 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

167 
	gm_»que¡
 = 
ResourûReque¡
();

168 
	gm_fÜmS‹
 = 0;

169 
	gm_äameName
 = 
SŒšg
();

172 
	gPŞicyC®lback
::
ÿnûl
()

174 #ifdeà
SSLAB__DEBUG


175 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

178 
ş—rReque¡
();

179 ià(
	gm_Çvig©iÚFunùiÚ
)

180 
m_Çvig©iÚFunùiÚ
(
m_¬gum’t
, 
m_»que¡
, 
m_fÜmS‹
.
g‘
(), 
çl£
);

181 ià(
	gm_ÃwWšdowFunùiÚ
)

182 
m_ÃwWšdowFunùiÚ
(
m_¬gum’t
, 
m_»que¡
, 
m_fÜmS‹
.
g‘
(), 
m_äameName
, 
çl£
);

183 ià(
	gm_cÚ‹ÁFunùiÚ
)

184 
m_cÚ‹ÁFunùiÚ
(
m_¬gum’t
, 
PŞicyIgnÜe
);

	@PolicyCallback.h

30 #iâdeà
PŞicyC®lback_h


31 
	#PŞicyC®lback_h


	)

33 
	~"F¿meLßd”Ty³s.h
"

34 
	~"PÏtfÜmSŒšg.h
"

35 
	~"ResourûReque¡.h
"

36 
	~<wtf/RefPŒ.h
>

38 
Çme¥aû
 
	gWebCÜe
 {

40 
şass
 
	gFÜmS‹
;

42 (*
	gNavig©iÚPŞicyDecisiÚFunùiÚ
)(* 
	t¬gum’t
,

43 cÚ¡ 
	tResourûReque¡
&, 
	tPassRefPŒ
<
	tFÜmS‹
>, 
	tboŞ
 
	tshouldCÚtšue
);

44 (*
	gNewWšdowPŞicyDecisiÚFunùiÚ
)(* 
	t¬gum’t
,

45 cÚ¡ 
	tResourûReque¡
&, 
	tPassRefPŒ
<
	tFÜmS‹
>, cÚ¡ 
	tSŒšg
& 
	täameName
, 
	tboŞ
 
	tshouldCÚtšue
);

46 (*
	gCÚ‹ÁPŞicyDecisiÚFunùiÚ
)(* 
	t¬gum’t
, 
	tPŞicyAùiÚ
);

48 şas 
	cPŞicyC®lback
 {

49 
	gpublic
:

50 
PŞicyC®lback
();

51 ~
PŞicyC®lback
();

53 
ş—r
();

54 
£t
(cÚ¡ 
ResourûReque¡
&, 
PassRefPŒ
<
FÜmS‹
>,

55 
Navig©iÚPŞicyDecisiÚFunùiÚ
, * 
¬gum’t
);

56 
£t
(cÚ¡ 
ResourûReque¡
&, 
PassRefPŒ
<
FÜmS‹
>, cÚ¡ 
SŒšg
& 
äameName
,

57 
NewWšdowPŞicyDecisiÚFunùiÚ
, * 
¬gum’t
);

58 
£t
(
CÚ‹ÁPŞicyDecisiÚFunùiÚ
, * 
¬gum’t
);

60 cÚ¡ 
	gResourûReque¡
& 
»que¡
(ècÚ¡ {  
	gm_»que¡
; }

61 
ş—rReque¡
();

63 
ÿÎ
(
boŞ
 
shouldCÚtšue
);

64 
ÿÎ
(
PŞicyAùiÚ
);

65 
ÿnûl
();

67 
	g´iv©e
:

68 
ResourûReque¡
 
m_»que¡
;

69 
	gRefPŒ
<
	gFÜmS‹
> 
	gm_fÜmS‹
;

70 
SŒšg
 
	gm_äameName
;

72 
Navig©iÚPŞicyDecisiÚFunùiÚ
 
	gm_Çvig©iÚFunùiÚ
;

73 
NewWšdowPŞicyDecisiÚFunùiÚ
 
	gm_ÃwWšdowFunùiÚ
;

74 
CÚ‹ÁPŞicyDecisiÚFunùiÚ
 
	gm_cÚ‹ÁFunùiÚ
;

75 * 
	gm_¬gum’t
;

	@PolicyChecker.cpp

2 #ifdeà
SSLAB__DEBUG


3 #iâdeà
SSLAB__QDATETIME


4 
	#SSLAB__QDATETIME


	)

5 
	~<QD©eTime
>

9 #ifdeà
SSLAB__DEBUG


10 #iâdeà
SSLAB__QTHREAD


11 
	#SSLAB__QTHREAD


	)

12 
	~<QTh»ad
>

45 
	~"cÚfig.h
"

46 
	~"PŞicyCheck”.h
"

48 
	~"Docum’tLßd”.h
"

49 
	~"FÜmS‹.h
"

50 
	~"F¿me.h
"

51 
	~"F¿meLßd”.h
"

52 
	~"F¿meLßd”Cl›Á.h
"

53 
	~"HTMLFÜmEËm’t.h
"

55 
Çme¥aû
 
	gWebCÜe
 {

57 
	gPŞicyCheck”
::
PŞicyCheck”
(
F¿me
* 
äame
)

58 : 
m_äame
(
äame
)

59 , 
m_d–eg©eIsDecidšgNavig©iÚPŞicy
(
çl£
)

60 , 
m_d–eg©eIsHªdlšgUnim¶em’bËPŞicy
(
çl£
)

61 , 
m_lßdTy³
(
F¿meLßdTy³Snd¬d
)

63 #ifdeà
SSLAB__DEBUG


64 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

69 
	gPŞicyCheck”
::
checkNavig©iÚPŞicy
(cÚ¡ 
ResourûReque¡
& 
ÃwReque¡
, 
Navig©iÚPŞicyDecisiÚFunùiÚ
 
funùiÚ
, * 
¬gum’t
)

71 #ifdeà
SSLAB__DEBUG


72 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

75 
checkNavig©iÚPŞicy
(
ÃwReque¡
, 
m_äame
->
lßd”
()->
aùiveDocum’tLßd”
(), 0, 
funùiÚ
, 
¬gum’t
);

78 
	gPŞicyCheck”
::
checkNavig©iÚPŞicy
(cÚ¡ 
ResourûReque¡
& 
»que¡
, 
Docum’tLßd”
* 
lßd”
,

79 
PassRefPŒ
<
FÜmS‹
> 
fÜmS‹
, 
Navig©iÚPŞicyDecisiÚFunùiÚ
 
funùiÚ
, * 
¬gum’t
)

81 #ifdeà
SSLAB__DEBUG


82 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

85 
Navig©iÚAùiÚ
 
	gaùiÚ
 = 
lßd”
->
Œigg”šgAùiÚ
();

86 ià(
	gaùiÚ
.
isEm±y
()) {

87 
	gaùiÚ
 = 
Navig©iÚAùiÚ
(
»que¡
.
u¾
(), 
Navig©iÚTy³Oth”
);

88 
	glßd”
->
£tTrigg”šgAùiÚ
(
aùiÚ
);

93 ià(
equ®IgnÜšgH—d”F›lds
(
»que¡
, 
lßd”
->
Ï¡CheckedReque¡
()è|| (!
	g»que¡
.
isNuÎ
(è&&„eque¡.
u¾
().
isEm±y
())) {

94 
funùiÚ
(
¬gum’t
, 
»que¡
, 0, 
Œue
);

95 
	glßd”
->
£tLa¡CheckedReque¡
(
»que¡
);

101 ià(
	glßd”
->
sub¡™u‹D©a
().
isV®id
(è&& !lßd”->sub¡™u‹D©a().
çšgURL
().
isEm±y
()) {

102 ià(
isBackFÜw¬dLßdTy³
(
m_lßdTy³
))

103 
	gm_lßdTy³
 = 
F¿meLßdTy³R–ßd
;

104 
funùiÚ
(
¬gum’t
, 
»que¡
, 0, 
Œue
);

108 
	glßd”
->
£tLa¡CheckedReque¡
(
»que¡
);

110 
	gm_ÿÎback
.
£t
(
»que¡
, 
fÜmS‹
.
g‘
(), 
funùiÚ
, 
¬gum’t
);

112 
	gm_d–eg©eIsDecidšgNavig©iÚPŞicy
 = 
Œue
;

113 
	gm_äame
->
lßd”
()->
ş›Á
()->
di¥©chDecidePŞicyFÜNavig©iÚAùiÚ
(&
PŞicyCheck”
::
cÚtšueAá”Navig©iÚPŞicy
,

114 
aùiÚ
, 
»que¡
, 
fÜmS‹
);

115 
	gm_d–eg©eIsDecidšgNavig©iÚPŞicy
 = 
çl£
;

118 
	gPŞicyCheck”
::
checkNewWšdowPŞicy
(cÚ¡ 
Navig©iÚAùiÚ
& 
aùiÚ
, 
NewWšdowPŞicyDecisiÚFunùiÚ
 
funùiÚ
,

119 cÚ¡ 
ResourûReque¡
& 
»que¡
, 
PassRefPŒ
<
FÜmS‹
> 
fÜmS‹
, cÚ¡ 
SŒšg
& 
äameName
, * 
¬gum’t
)

121 #ifdeà
SSLAB__DEBUG


122 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

125 
	gm_ÿÎback
.
£t
(
»que¡
, 
fÜmS‹
, 
äameName
, 
funùiÚ
, 
¬gum’t
);

126 
	gm_äame
->
lßd”
()->
ş›Á
()->
di¥©chDecidePŞicyFÜNewWšdowAùiÚ
(&
PŞicyCheck”
::
cÚtšueAá”NewWšdowPŞicy
,

127 
aùiÚ
, 
»que¡
, 
fÜmS‹
, 
äameName
);

130 
	gPŞicyCheck”
::
checkCÚ‹ÁPŞicy
(cÚ¡ 
SŒšg
& 
MIMETy³
, 
CÚ‹ÁPŞicyDecisiÚFunùiÚ
 
funùiÚ
, * 
¬gum’t
)

132 #ifdeà
SSLAB__DEBUG


133 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

136 
	gm_ÿÎback
.
£t
(
funùiÚ
, 
¬gum’t
);

137 
	gm_äame
->
lßd”
()->
ş›Á
()->
di¥©chDecidePŞicyFÜMIMETy³
(&
PŞicyCheck”
::
cÚtšueAá”CÚ‹ÁPŞicy
,

138 
MIMETy³
, 
m_äame
->
lßd”
()->
aùiveDocum’tLßd”
()->
»que¡
());

141 
	gPŞicyCheck”
::
ÿnûlCheck
()

143 #ifdeà
SSLAB__DEBUG


144 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

147 
	gm_äame
->
lßd”
()->
ş›Á
()->
ÿnûlPŞicyCheck
();

148 
	gm_ÿÎback
.
ş—r
();

151 
	gPŞicyCheck”
::
¡İCheck
()

153 #ifdeà
SSLAB__DEBUG


154 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

157 
	gm_äame
->
lßd”
()->
ş›Á
()->
ÿnûlPŞicyCheck
();

158 
PŞicyC®lback
 
	gÿÎback
 = 
m_ÿÎback
;

159 
	gm_ÿÎback
.
ş—r
();

160 
	gÿÎback
.
ÿnûl
();

163 
	gPŞicyCheck”
::
ÿÂÙShowMIMETy³
(cÚ¡ 
ResourûRe¥Ú£
& 
»¥Ú£
)

165 #ifdeà
SSLAB__DEBUG


166 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

169 
hªdËUnim¶em’bËPŞicy
(
m_äame
->
lßd”
()->
ş›Á
()->
ÿÂÙShowMIMETy³E¼Ü
(
»¥Ú£
));

172 
	gPŞicyCheck”
::
cÚtšueLßdAá”WlSubm™FÜm
(
PŞicyAùiÚ
)

174 #ifdeà
SSLAB__DEBUG


175 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

180 
	gm_äame
->
lßd”
()->
cÚtšueLßdAá”WlSubm™FÜm
();

183 
	gPŞicyCheck”
::
cÚtšueAá”Navig©iÚPŞicy
(
PŞicyAùiÚ
 
pŞicy
)

185 #ifdeà
SSLAB__DEBUG


186 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

189 
PŞicyC®lback
 
	gÿÎback
 = 
m_ÿÎback
;

190 
	gm_ÿÎback
.
ş—r
();

192 
boŞ
 
	gshouldCÚtšue
 = 
pŞicy
 =ğ
PŞicyU£
;

194 
	gpŞicy
) {

195 
	gPŞicyIgnÜe
:

196 
ÿÎback
.
ş—rReque¡
();

198 
	gPŞicyDowÆßd
:

199 
m_äame
->
lßd”
()->
ş›Á
()->
¡¬tDowÆßd
(
ÿÎback
.
»que¡
());

200 
	gÿÎback
.
ş—rReque¡
();

202 
	gPŞicyU£
: {

203 
ResourûReque¡
 
»que¡
(
ÿÎback
.request());

205 ià(!
	gm_äame
->
lßd”
()->
ş›Á
()->
ÿnHªdËReque¡
(
»que¡
)) {

206 
hªdËUnim¶em’bËPŞicy
(
m_äame
->
lßd”
()->
ÿÂÙShowURLE¼Ü
(
ÿÎback
.
»que¡
()));

207 
	gÿÎback
.
ş—rReque¡
();

208 
	gshouldCÚtšue
 = 
çl£
;

214 
	gÿÎback
.
ÿÎ
(
shouldCÚtšue
);

217 
	gPŞicyCheck”
::
cÚtšueAá”NewWšdowPŞicy
(
PŞicyAùiÚ
 
pŞicy
)

219 #ifdeà
SSLAB__DEBUG


220 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

223 
PŞicyC®lback
 
	gÿÎback
 = 
m_ÿÎback
;

224 
	gm_ÿÎback
.
ş—r
();

226 
	gpŞicy
) {

227 
	gPŞicyIgnÜe
:

228 
ÿÎback
.
ş—rReque¡
();

230 
	gPŞicyDowÆßd
:

231 
m_äame
->
lßd”
()->
ş›Á
()->
¡¬tDowÆßd
(
ÿÎback
.
»que¡
());

232 
	gÿÎback
.
ş—rReque¡
();

234 
	gPŞicyU£
:

238 
	gÿÎback
.
ÿÎ
(
pŞicy
 =ğ
PŞicyU£
);

241 
	gPŞicyCheck”
::
cÚtšueAá”CÚ‹ÁPŞicy
(
PŞicyAùiÚ
 
pŞicy
)

243 #ifdeà
SSLAB__DEBUG


244 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

247 
PŞicyC®lback
 
	gÿÎback
 = 
m_ÿÎback
;

248 
	gm_ÿÎback
.
ş—r
();

249 
	gÿÎback
.
ÿÎ
(
pŞicy
);

252 
	gPŞicyCheck”
::
hªdËUnim¶em’bËPŞicy
(cÚ¡ 
ResourûE¼Ü
& 
”rÜ
)

254 #ifdeà
SSLAB__DEBUG


255 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

258 
	gm_d–eg©eIsHªdlšgUnim¶em’bËPŞicy
 = 
Œue
;

259 
	gm_äame
->
lßd”
()->
ş›Á
()->
di¥©chUÇbËToIm¶em’tPŞicy
(
”rÜ
);

260 
	gm_d–eg©eIsHªdlšgUnim¶em’bËPŞicy
 = 
çl£
;

	@PolicyChecker.h

30 #iâdeà
PŞicyCheck”_h


31 
	#PŞicyCheck”_h


	)

33 
	~"F¿meLßd”Ty³s.h
"

34 
	~"PÏtfÜmSŒšg.h
"

35 
	~"PŞicyC®lback.h
"

36 
	~"ResourûReque¡.h
"

37 
	~<wtf/PassRefPŒ.h
>

39 
Çme¥aû
 
	gWebCÜe
 {

41 
şass
 
	gDocum’tLßd”
;

42 
şass
 
	gFÜmS‹
;

43 
şass
 
	gF¿me
;

44 
şass
 
	gNavig©iÚAùiÚ
;

45 
şass
 
	gResourûE¼Ü
;

46 
şass
 
	gResourûRe¥Ú£
;

48 şas 
	cPŞicyCheck”
 : 
public
 
NÚcİyabË
 {

49 
public
:

50 
PŞicyCheck”
(
F¿me
*);

52 
checkNavig©iÚPŞicy
(cÚ¡ 
ResourûReque¡
&, 
Docum’tLßd”
*, 
PassRefPŒ
<
FÜmS‹
>, 
Navig©iÚPŞicyDecisiÚFunùiÚ
, * 
¬gum’t
);

53 
checkNavig©iÚPŞicy
(cÚ¡ 
ResourûReque¡
&, 
Navig©iÚPŞicyDecisiÚFunùiÚ
, * 
¬gum’t
);

54 
checkNewWšdowPŞicy
(cÚ¡ 
Navig©iÚAùiÚ
&, 
NewWšdowPŞicyDecisiÚFunùiÚ
, cÚ¡ 
ResourûReque¡
&, 
PassRefPŒ
<
FÜmS‹
>, cÚ¡ 
SŒšg
& 
äameName
, * 
¬gum’t
);

55 
checkCÚ‹ÁPŞicy
(cÚ¡ 
SŒšg
& 
MIMETy³
, 
CÚ‹ÁPŞicyDecisiÚFunùiÚ
, * 
¬gum’t
);

58 
ÿnûlCheck
();

59 
¡İCheck
();

61 
ÿÂÙShowMIMETy³
(cÚ¡ 
ResourûRe¥Ú£
&);

63 
F¿meLßdTy³
 
lßdTy³
(ècÚ¡ {  
	gm_lßdTy³
; }

64 
£tLßdTy³
(
F¿meLßdTy³
 
lßdTy³
è{ 
	gm_lßdTy³
 =†oadType; }

66 
boŞ
 
d–eg©eIsDecidšgNavig©iÚPŞicy
(ècÚ¡ {  
	gm_d–eg©eIsDecidšgNavig©iÚPŞicy
; }

67 
boŞ
 
d–eg©eIsHªdlšgUnim¶em’bËPŞicy
(ècÚ¡ {  
	gm_d–eg©eIsHªdlšgUnim¶em’bËPŞicy
; }

74 
cÚtšueLßdAá”WlSubm™FÜm
(
PŞicyAùiÚ
);

76 
	g´iv©e
:

77 
cÚtšueAá”Navig©iÚPŞicy
(
PŞicyAùiÚ
);

78 
cÚtšueAá”NewWšdowPŞicy
(
PŞicyAùiÚ
);

79 
cÚtšueAá”CÚ‹ÁPŞicy
(
PŞicyAùiÚ
);

81 
hªdËUnim¶em’bËPŞicy
(cÚ¡ 
ResourûE¼Ü
&);

83 
F¿me
* 
	gm_äame
;

85 
boŞ
 
	gm_d–eg©eIsDecidšgNavig©iÚPŞicy
;

86 
boŞ
 
	gm_d–eg©eIsHªdlšgUnim¶em’bËPŞicy
;

91 
F¿meLßdTy³
 
	gm_lßdTy³
;

92 
PŞicyC®lback
 
	gm_ÿÎback
;

	@ProgressTracker.cpp

2 #ifdeà
SSLAB__DEBUG


3 #iâdeà
SSLAB__QDATETIME


4 
	#SSLAB__QDATETIME


	)

5 
	~<QD©eTime
>

9 #ifdeà
SSLAB__DEBUG


10 #iâdeà
SSLAB__QTHREAD


11 
	#SSLAB__QTHREAD


	)

12 
	~<QTh»ad
>

40 
	~"cÚfig.h
"

41 
	~"Prog»ssT¿ck”.h
"

43 
	~"CSŒšg.h
"

44 
	~"Docum’tLßd”.h
"

45 
	~"F¿me.h
"

46 
	~"F¿meLßd”.h
"

47 
	~"F¿meLßd”Cl›Á.h
"

48 
	~"Loggšg.h
"

49 
	~"ResourûRe¥Ú£.h
"

50 
	~<wtf/Cu¼’tTime.h
>

52 
usšg
 
	g¡d
::
mš
;

54 
Çme¥aû
 
	gWebCÜe
 {

58 cÚ¡ 
	gš™ŸlProg»ssV®ue
 = 0.1;

62 cÚ¡ 
	gfš®Prog»ssV®ue
 = 0.9;

64 cÚ¡ 
	g´og»ssI‹mDeçuÉE¡im©edL’gth
 = 1024 * 16;

66 
	gProg»ssI‹m
 : 
NÚcİyabË
 {

67 
Prog»ssI‹m
(
Ëngth
)

68 : 
by‹sReûived
(0)

69 , 
e¡im©edL’gth
(
Ëngth
) { }

71 
	gby‹sReûived
;

72 
	ge¡im©edL’gth
;

75 
	gProg»ssT¿ck”
::
Prog»ssT¿ck”
()

76 : 
m_uniqueId’tif›r
(0)

77 , 
m_tÙ®PageAndResourûBy‹sToLßd
(0)

78 , 
m_tÙ®By‹sReûived
(0)

79 , 
m_Ï¡NÙif›dProg»ssV®ue
(0)

80 , 
m_Ï¡NÙif›dProg»ssTime
(0)

81 , 
m_´og»ssNÙifiÿtiÚIÁ”v®
(0.02)

82 , 
m_´og»ssNÙifiÿtiÚTimeIÁ”v®
(0.1)

83 , 
m_fš®Prog»ssChªgedS’t
(
çl£
)

84 , 
m_´og»ssV®ue
(0)

85 , 
m_numProg»ssT¿ckedF¿mes
(0)

87 #ifdeà
SSLAB__DEBUG


88 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

93 
	gProg»ssT¿ck”
::~
Prog»ssT¿ck”
()

95 #ifdeà
SSLAB__DEBUG


96 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

99 
d–‘eAÎV®ues
(
m_´og»ssI‹ms
);

102 
	gProg»ssT¿ck”
::
e¡im©edProg»ss
() const

104 #ifdeà
SSLAB__DEBUG


105 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

108  
	gm_´og»ssV®ue
;

111 
	gProg»ssT¿ck”
::
»£t
()

113 #ifdeà
SSLAB__DEBUG


114 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

117 
d–‘eAÎV®ues
(
m_´og»ssI‹ms
);

118 
	gm_´og»ssI‹ms
.
ş—r
();

120 
	gm_tÙ®PageAndResourûBy‹sToLßd
 = 0;

121 
	gm_tÙ®By‹sReûived
 = 0;

122 
	gm_´og»ssV®ue
 = 0;

123 
	gm_Ï¡NÙif›dProg»ssV®ue
 = 0;

124 
	gm_Ï¡NÙif›dProg»ssTime
 = 0;

125 
	gm_fš®Prog»ssChªgedS’t
 = 
çl£
;

126 
	gm_numProg»ssT¿ckedF¿mes
 = 0;

127 
	gm_Üigš©šgProg»ssF¿me
 = 0;

130 
	gProg»ssT¿ck”
::
´og»ssS¹ed
(
F¿me
* 
äame
)

132 #ifdeà
SSLAB__DEBUG


133 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

136 
LOG
(
Prog»ss
, "Prog»s ¡¬‹d (%pè- f¿m%p(\"%s\"), v®u%f,¿cked f¿me %d, origš©šg f¿m%p", 
this
, 
äame
, f¿me->
Œ“
()->
Çme
().
¡ršg
().
utf8
().
d©a
(), 
m_´og»ssV®ue
, 
m_numProg»ssT¿ckedF¿mes
, 
m_Üigš©šgProg»ssF¿me
.
g‘
());

139 
	gäame
->
lßd”
()->
ş›Á
()->
wlChªgeE¡im©edProg»ss
();

141 ià(
	gm_numProg»ssT¿ckedF¿mes
 =ğ0 || 
m_Üigš©šgProg»ssF¿me
 =ğ
äame
) {

142 
»£t
();

143 
	gm_´og»ssV®ue
 = 
š™ŸlProg»ssV®ue
;

144 
	gm_Üigš©šgProg»ssF¿me
 = 
äame
;

146 
	gm_Üigš©šgProg»ssF¿me
->
lßd”
()->
ş›Á
()->
po¡Prog»ssS¹edNÙifiÿtiÚ
();

148 
	gm_numProg»ssT¿ckedF¿mes
++;

150 
	gäame
->
lßd”
()->
ş›Á
()->
didChªgeE¡im©edProg»ss
();

153 
	gProg»ssT¿ck”
::
´og»ssCom¶‘ed
(
F¿me
* 
äame
)

155 #ifdeà
SSLAB__DEBUG


156 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

159 
LOG
(
Prog»ss
, "Prog»s com¶‘ed (%pè- f¿m%p(\"%s\"), v®u%f,¿cked f¿me %d, origš©šg f¿m%p", 
this
, 
äame
, f¿me->
Œ“
()->
Çme
().
¡ršg
().
utf8
().
d©a
(), 
m_´og»ssV®ue
, 
m_numProg»ssT¿ckedF¿mes
, 
m_Üigš©šgProg»ssF¿me
.
g‘
());

161 ià(
	gm_numProg»ssT¿ckedF¿mes
 <= 0)

164 
	gäame
->
lßd”
()->
ş›Á
()->
wlChªgeE¡im©edProg»ss
();

166 
	gm_numProg»ssT¿ckedF¿mes
--;

167 ià(
	gm_numProg»ssT¿ckedF¿mes
 == 0 ||

168 (
äame
 =ğ
m_Üigš©šgProg»ssF¿me
 && 
m_numProg»ssT¿ckedF¿mes
 != 0))

169 
fš®Prog»ssCom¶‘e
();

171 
	gäame
->
lßd”
()->
ş›Á
()->
didChªgeE¡im©edProg»ss
();

174 
	gProg»ssT¿ck”
::
fš®Prog»ssCom¶‘e
()

176 #ifdeà
SSLAB__DEBUG


177 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

180 
LOG
(
Prog»ss
, "Fš®…rog»s com¶‘(%p)", 
this
);

182 
	gRefPŒ
<
	gF¿me
> 
	gäame
 = 
m_Üigš©šgProg»ssF¿me
.
»Ëa£
();

186 ià(!
	gm_fš®Prog»ssChªgedS’t
) {

187 
	gm_´og»ssV®ue
 = 1;

188 
	gäame
->
lßd”
()->
ş›Á
()->
po¡Prog»ssE¡im©eChªgedNÙifiÿtiÚ
();

191 
»£t
();

193 
	gäame
->
lßd”
()->
ş›Á
()->
£tMašF¿meDocum’tR—dy
(
Œue
);

194 
	gäame
->
lßd”
()->
ş›Á
()->
po¡Prog»ssFšishedNÙifiÿtiÚ
();

197 
	gProg»ssT¿ck”
::
šüem’tProg»ss
(
id’tif›r
, cÚ¡ 
ResourûRe¥Ú£
& 
»¥Ú£
)

199 #ifdeà
SSLAB__DEBUG


200 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

203 
LOG
(
Prog»ss
, "Prog»s šüem’‹d (%pè- v®u%f,¿cked f¿me %d, origš©šg f¿m%p", 
this
, 
m_´og»ssV®ue
, 
m_numProg»ssT¿ckedF¿mes
, 
m_Üigš©šgProg»ssF¿me
.
g‘
());

205 ià(
	gm_numProg»ssT¿ckedF¿mes
 <= 0)

208 
	ge¡im©edL’gth
 = 
»¥Ú£
.
ex³ùedCÚ‹ÁL’gth
();

209 ià(
	ge¡im©edL’gth
 < 0)

210 
	ge¡im©edL’gth
 = 
´og»ssI‹mDeçuÉE¡im©edL’gth
;

212 
	gm_tÙ®PageAndResourûBy‹sToLßd
 +ğ
e¡im©edL’gth
;

214 ià(
Prog»ssI‹m
* 
	g™em
 = 
m_´og»ssI‹ms
.
g‘
(
id’tif›r
)) {

215 
™em
->
by‹sReûived
 = 0;

216 
	g™em
->
	ge¡im©edL’gth
 = 
e¡im©edL’gth
;

218 
	gm_´og»ssI‹ms
.
£t
(
id’tif›r
, 
Ãw
 
Prog»ssI‹m
(
e¡im©edL’gth
));

221 
	gProg»ssT¿ck”
::
šüem’tProg»ss
(
id’tif›r
, cÚ¡ *, 
Ëngth
)

223 #ifdeà
SSLAB__DEBUG


224 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

227 
Prog»ssI‹m
* 
	g™em
 = 
m_´og»ssI‹ms
.
g‘
(
id’tif›r
);

230 ià(!
	g™em
)

233 
	gRefPŒ
<
	gF¿me
> 
	gäame
 = 
m_Üigš©šgProg»ssF¿me
;

235 
	gäame
->
lßd”
()->
ş›Á
()->
wlChªgeE¡im©edProg»ss
();

237 
	gby‹sReûived
 = 
Ëngth
;

238 
	gšüem’t
, 
	g³rûÁOfRemaššgBy‹s
;

239 
	g»maššgBy‹s
, 
	ge¡im©edBy‹sFÜP’dšgReque¡s
;

241 
	g™em
->
	gby‹sReûived
 +ğ
by‹sReûived
;

242 ià(
	g™em
->
	gby‹sReûived
 > i‹m->
	ge¡im©edL’gth
) {

243 
	gm_tÙ®PageAndResourûBy‹sToLßd
 +ğ((
™em
->
by‹sReûived
 * 2è- i‹m->
e¡im©edL’gth
);

244 
	g™em
->
	ge¡im©edL’gth
 = 
™em
->
by‹sReûived
 * 2;

247 
	gnumP’dšgOrLßdšgReque¡s
 = 
äame
->
lßd”
()->
numP’dšgOrLßdšgReque¡s
(
Œue
);

248 
	ge¡im©edBy‹sFÜP’dšgReque¡s
 = 
´og»ssI‹mDeçuÉE¡im©edL’gth
 * 
numP’dšgOrLßdšgReque¡s
;

249 
	g»maššgBy‹s
 = ((
m_tÙ®PageAndResourûBy‹sToLßd
 + 
e¡im©edBy‹sFÜP’dšgReque¡s
è- 
m_tÙ®By‹sReûived
);

250 ià(
	g»maššgBy‹s
 > 0)

251 
	g³rûÁOfRemaššgBy‹s
 = ()
by‹sReûived
 / ()
»maššgBy‹s
;

253 
	g³rûÁOfRemaššgBy‹s
 = 1.0;

257 
boŞ
 
	gu£CÏm³dMaxProg»ss
 = 
äame
->
lßd”
()->
ş›Á
()->
hasHTMLV›w
()

258 && !
äame
->
lßd”
()->
fœ¡LayoutDÚe
();

259 
	gmaxProg»ssV®ue
 = 
u£CÏm³dMaxProg»ss
 ? 0.5 : 
fš®Prog»ssV®ue
;

260 
	gšüem’t
 = (
maxProg»ssV®ue
 - 
m_´og»ssV®ue
è* 
³rûÁOfRemaššgBy‹s
;

261 
	gm_´og»ssV®ue
 +ğ
šüem’t
;

262 
	gm_´og»ssV®ue
 = 
mš
(
m_´og»ssV®ue
, 
maxProg»ssV®ue
);

263 
ASSERT
(
m_´og»ssV®ue
 >ğ
š™ŸlProg»ssV®ue
);

265 
	gm_tÙ®By‹sReûived
 +ğ
by‹sReûived
;

267 
	gnow
 = 
cu¼’tTime
();

268 
	gnÙif›dProg»ssTimeD–
 = 
now
 - 
m_Ï¡NÙif›dProg»ssTime
;

270 
LOG
(
Prog»ss
, "Prog»s šüem’‹d (%pè- v®u%f,¿cked f¿me %d", 
this
, 
m_´og»ssV®ue
, 
m_numProg»ssT¿ckedF¿mes
);

271 
	gnÙifiÿtiÚProg»ssD–
 = 
m_´og»ssV®ue
 - 
m_Ï¡NÙif›dProg»ssV®ue
;

272 ià((
	gnÙifiÿtiÚProg»ssD–
 >ğ
m_´og»ssNÙifiÿtiÚIÁ”v®
 ||

273 
nÙif›dProg»ssTimeD–
 >ğ
m_´og»ssNÙifiÿtiÚTimeIÁ”v®
) &&

274 
m_numProg»ssT¿ckedF¿mes
 > 0) {

275 ià(!
m_fš®Prog»ssChªgedS’t
) {

276 ià(
m_´og»ssV®ue
 == 1)

277 
m_fš®Prog»ssChªgedS’t
 = 
Œue
;

279 
	gäame
->
lßd”
()->
ş›Á
()->
po¡Prog»ssE¡im©eChªgedNÙifiÿtiÚ
();

281 
	gm_Ï¡NÙif›dProg»ssV®ue
 = 
m_´og»ssV®ue
;

282 
	gm_Ï¡NÙif›dProg»ssTime
 = 
now
;

286 
	gäame
->
lßd”
()->
ş›Á
()->
didChªgeE¡im©edProg»ss
();

289 
	gProg»ssT¿ck”
::
com¶‘eProg»ss
(
id’tif›r
)

291 #ifdeà
SSLAB__DEBUG


292 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

295 
Prog»ssI‹m
* 
	g™em
 = 
m_´og»ssI‹ms
.
g‘
(
id’tif›r
);

298 ià(!
	g™em
)

302 
	gd–
 = 
™em
->
by‹sReûived
 - i‹m->
e¡im©edL’gth
;

303 
	gm_tÙ®PageAndResourûBy‹sToLßd
 +ğ
d–
;

304 
	g™em
->
	ge¡im©edL’gth
 = 
™em
->
by‹sReûived
;

306 
	gm_´og»ssI‹ms
.
»move
(
id’tif›r
);

307 
d–‘e
 
	g™em
;

310 
	gProg»ssT¿ck”
::
ü—‹UniqueId’tif›r
()

312 #ifdeà
SSLAB__DEBUG


313 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

316  ++
	gm_uniqueId’tif›r
;

	@ProgressTracker.h

26 #iâdeà
Prog»ssT¿ck”_h


27 
	#Prog»ssT¿ck”_h


	)

29 
	~<wtf/HashM­.h
>

30 
	~<wtf/NÚcİyabË.h
>

31 
	~<wtf/RefPŒ.h
>

33 
Çme¥aû
 
	gWebCÜe
 {

35 
şass
 
	gF¿me
;

36 
şass
 
	gResourûRe¥Ú£
;

37 
	gProg»ssI‹m
;

39 şas 
	cProg»ssT¿ck”
 : 
public
 
NÚcİyabË
 {

40 
public
:

41 
Prog»ssT¿ck”
();

42 ~
Prog»ssT¿ck”
();

44 
ü—‹UniqueId’tif›r
();

46 
e¡im©edProg»ss
() const;

48 
´og»ssS¹ed
(
F¿me
*);

49 
´og»ssCom¶‘ed
(
F¿me
*);

51 
šüem’tProg»ss
(
id’tif›r
, cÚ¡ 
ResourûRe¥Ú£
&);

52 
šüem’tProg»ss
(
id’tif›r
, const *, );

53 
com¶‘eProg»ss
(
id’tif›r
);

55 
tÙ®PageAndResourûBy‹sToLßd
(ècÚ¡ {  
	gm_tÙ®PageAndResourûBy‹sToLßd
; }

56 
tÙ®By‹sReûived
(ècÚ¡ {  
	gm_tÙ®By‹sReûived
; }

58 
	g´iv©e
:

59 
»£t
();

60 
fš®Prog»ssCom¶‘e
();

62 
	gm_uniqueId’tif›r
;

64 
	gm_tÙ®PageAndResourûBy‹sToLßd
;

65 
	gm_tÙ®By‹sReûived
;

66 
	gm_Ï¡NÙif›dProg»ssV®ue
;

67 
	gm_Ï¡NÙif›dProg»ssTime
;

68 
	gm_´og»ssNÙifiÿtiÚIÁ”v®
;

69 
	gm_´og»ssNÙifiÿtiÚTimeIÁ”v®
;

70 
boŞ
 
	gm_fš®Prog»ssChªgedS’t
;

71 
	gm_´og»ssV®ue
;

72 
	gRefPŒ
<
	gF¿me
> 
	gm_Üigš©šgProg»ssF¿me
;

74 
	gm_numProg»ssT¿ckedF¿mes
;

75 
	gHashM­
<, 
	gProg»ssI‹m
*> 
	gm_´og»ssI‹ms
;

	@RedirectScheduler.cpp

2 #ifdeà
SSLAB__DEBUG


3 #iâdeà
SSLAB__QDATETIME


4 
	#SSLAB__QDATETIME


	)

5 
	~<QD©eTime
>

9 #ifdeà
SSLAB__DEBUG


10 #iâdeà
SSLAB__QTHREAD


11 
	#SSLAB__QTHREAD


	)

12 
	~<QTh»ad
>

46 
	~"cÚfig.h
"

47 
	~"RedœeùScheduËr.h
"

49 
	~"BackFÜw¬dLi¡.h
"

50 
	~"Docum’tLßd”.h
"

51 
	~"Ev’t.h
"

52 
	~"FÜmS‹.h
"

53 
	~"F¿me.h
"

54 
	~"F¿meLßdReque¡.h
"

55 
	~"F¿meLßd”.h
"

56 
	~"Hi¡ÜyI‹m.h
"

57 
	~"HTMLFÜmEËm’t.h
"

58 
	~"HTMLF¿meOwÃrEËm’t.h
"

59 
	~"Page.h
"

60 
	~<wtf/Cu¼’tTime.h
>

62 
Çme¥aû
 
	gWebCÜe
 {

64 
	gScheduËdRedœeùiÚ
 : 
NÚcİyabË
 {

65 
	eTy³
 { 
»dœeùiÚ
, 
	gloÿtiÚChªge
, 
	ghi¡ÜyNavig©iÚ
, 
	gfÜmSubmissiÚ
 };

67 cÚ¡ 
Ty³
 
	gty³
;

68 cÚ¡ 
	gd–ay
;

69 cÚ¡ 
SŒšg
 
	gu¾
;

70 cÚ¡ 
SŒšg
 
	g»ã¼”
;

71 cÚ¡ 
F¿meLßdReque¡
 
	gäameReque¡
;

72 cÚ¡ 
	gRefPŒ
<
	gEv’t
> 
	gev’t
;

73 cÚ¡ 
	gRefPŒ
<
	gFÜmS‹
> 
	gfÜmS‹
;

74 cÚ¡ 
	ghi¡ÜyS‹ps
;

75 cÚ¡ 
boŞ
 
	glockHi¡Üy
;

76 cÚ¡ 
boŞ
 
	glockBackFÜw¬dLi¡
;

77 cÚ¡ 
boŞ
 
	gwasU£rGe¡u»
;

78 cÚ¡ 
boŞ
 
	gwasReäesh
;

79 cÚ¡ 
boŞ
 
	gwasDuršgLßd
;

80 
boŞ
 
	gtŞdCl›Á
;

82 
ScheduËdRedœeùiÚ
(
d–ay
, cÚ¡ 
SŒšg
& 
u¾
, 
boŞ
 
lockHi¡Üy
, boŞ 
lockBackFÜw¬dLi¡
, boŞ 
wasU£rGe¡u»
, boŞ 
»äesh
)

83 : 
ty³
(
»dœeùiÚ
)

84 , 
d–ay
(delay)

85 , 
u¾
(url)

86 , 
hi¡ÜyS‹ps
(0)

87 , 
lockHi¡Üy
(lockHistory)

88 , 
lockBackFÜw¬dLi¡
(lockBackForwardList)

89 , 
wasU£rGe¡u»
(wasUserGesture)

90 , 
wasReäesh
(
»äesh
)

91 , 
wasDuršgLßd
(
çl£
)

92 , 
tŞdCl›Á
(
çl£
)

94 
ASSERT
(!
u¾
.
isEm±y
());

97 
ScheduËdRedœeùiÚ
(cÚ¡ 
SŒšg
& 
u¾
, cÚ¡ SŒšg& 
»ã¼”
, 
boŞ
 
lockHi¡Üy
, boŞ 
lockBackFÜw¬dLi¡
, boŞ 
wasU£rGe¡u»
, boŞ 
»äesh
, boŞ 
duršgLßd
)

98 : 
ty³
(
loÿtiÚChªge
)

99 , 
d–ay
(0)

100 , 
u¾
(url)

101 , 
»ã¼”
(referrer)

102 , 
hi¡ÜyS‹ps
(0)

103 , 
lockHi¡Üy
(lockHistory)

104 , 
lockBackFÜw¬dLi¡
(lockBackForwardList)

105 , 
wasU£rGe¡u»
(wasUserGesture)

106 , 
wasReäesh
(
»äesh
)

107 , 
wasDuršgLßd
(
duršgLßd
)

108 , 
tŞdCl›Á
(
çl£
)

110 
ASSERT
(!
u¾
.
isEm±y
());

113 
ex¶ic™
 
ScheduËdRedœeùiÚ
(
hi¡ÜyNavig©iÚS‹ps
)

114 : 
ty³
(
hi¡ÜyNavig©iÚ
)

115 , 
d–ay
(0)

116 , 
hi¡ÜyS‹ps
(
hi¡ÜyNavig©iÚS‹ps
)

117 , 
lockHi¡Üy
(
çl£
)

118 , 
lockBackFÜw¬dLi¡
(
çl£
)

119 , 
wasU£rGe¡u»
(
çl£
)

120 , 
wasReäesh
(
çl£
)

121 , 
wasDuršgLßd
(
çl£
)

122 , 
tŞdCl›Á
(
çl£
)

126 
ScheduËdRedœeùiÚ
(cÚ¡ 
F¿meLßdReque¡
& 
äameReque¡
,

127 
boŞ
 
lockHi¡Üy
, boŞ 
lockBackFÜw¬dLi¡
, 
PassRefPŒ
<
Ev’t
> 
ev’t
, PassRefPŒ<
FÜmS‹
> 
fÜmS‹
,

128 
boŞ
 
duršgLßd
)

129 : 
ty³
(
fÜmSubmissiÚ
)

130 , 
d–ay
(0)

131 , 
äameReque¡
(frameRequest)

132 , 
ev’t
(event)

133 , 
fÜmS‹
(formState)

134 , 
hi¡ÜyS‹ps
(0)

135 , 
lockHi¡Üy
(lockHistory)

136 , 
lockBackFÜw¬dLi¡
(lockBackForwardList)

137 , 
wasU£rGe¡u»
(
çl£
)

138 , 
wasReäesh
(
çl£
)

139 , 
wasDuršgLßd
(
duršgLßd
)

140 , 
tŞdCl›Á
(
çl£
)

142 
ASSERT
(!
äameReque¡
.
isEm±y
());

143 
ASSERT
(
this
->
fÜmS‹
);

147 
	gRedœeùScheduËr
::
RedœeùScheduËr
(
F¿me
* 
äame
)

148 : 
m_äame
(
äame
)

149 , 
m_tim”
(
this
, &
RedœeùScheduËr
::
tim”Fœed
)

151 #ifdeà
SSLAB__DEBUG


152 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

157 
	gRedœeùScheduËr
::~
RedœeùScheduËr
()

159 #ifdeà
SSLAB__DEBUG


160 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

165 
boŞ
 
	gRedœeùScheduËr
::
»dœeùScheduËdDuršgLßd
()

167 #ifdeà
SSLAB__DEBUG


168 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

171  
	gm_scheduËdRedœeùiÚ
 && m_scheduËdRedœeùiÚ->
	gwasDuršgLßd
;

174 
	gRedœeùScheduËr
::
ş—r
()

176 #ifdeà
SSLAB__DEBUG


177 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

180 
	gm_tim”
.
¡İ
();

181 
	gm_scheduËdRedœeùiÚ
.
ş—r
();

184 
	gRedœeùScheduËr
::
scheduËRedœeù
(
d–ay
, cÚ¡ 
SŒšg
& 
u¾
)

186 #ifdeà
SSLAB__DEBUG


187 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

190 ià(
	gd–ay
 < 0 || d–ay > 
	gINT_MAX
 / 1000)

193 ià(!
	gm_äame
->
·ge
())

196 ià(
	gu¾
.
isEm±y
())

200 ià(!
	gm_scheduËdRedœeùiÚ
 || 
	gd–ay
 <ğ
m_scheduËdRedœeùiÚ
->
d–ay
)

201 
scheduË
(
Ãw
 
ScheduËdRedœeùiÚ
(
d–ay
, 
u¾
, 
Œue
, d–ay <ğ1, 
çl£
, false));

204 
boŞ
 
	gRedœeùScheduËr
::
mu¡LockBackFÜw¬dLi¡
(
F¿me
* 
rg‘F¿me
)

206 #ifdeà
SSLAB__DEBUG


207 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

214 
F¿me
* 
	gªû¡Ü
 = 
rg‘F¿me
->
Œ“
()->
·»Á
();‡nû¡Ü;‡nû¡Ü = 
ªû¡Ü
->tree()->parent()) {

215 
Docum’t
* 
docum’t
 = 
ªû¡Ü
->document();

216 ià(!
	gªû¡Ü
->
lßd”
()->
isCom¶‘e
(è|| (
	gdocum’t
 && docum’t->
´oûssšgLßdEv’t
()))

217  
	gŒue
;

219  
	gçl£
;

222 
	gRedœeùScheduËr
::
scheduËLoÿtiÚChªge
(cÚ¡ 
SŒšg
& 
u¾
, cÚ¡ SŒšg& 
»ã¼”
, 
boŞ
 
lockHi¡Üy
, boŞ 
lockBackFÜw¬dLi¡
, boŞ 
wasU£rGe¡u»
)

224 #ifdeà
SSLAB__DEBUG


225 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

228 ià(!
	gm_äame
->
·ge
())

231 ià(
	gu¾
.
isEm±y
())

234 
	glockBackFÜw¬dLi¡
 = 
lockBackFÜw¬dLi¡
 || 
mu¡LockBackFÜw¬dLi¡
(
m_äame
);

236 
F¿meLßd”
* 
	glßd”
 = 
m_äame
->
lßd”
();

240 
KURL
 
·r£dURL
(
P¬£dURLSŒšg
, 
u¾
);

241 ià(
	g·r£dURL
.
hasF¿gm’tId’tif›r
(è&& 
equ®IgnÜšgF¿gm’tId’tif›r
(
lßd”
->
u¾
(), 
·r£dURL
)) {

242 
	glßd”
->
chªgeLoÿtiÚ
(
lßd”
->
com¶‘eURL
(
u¾
), 
»ã¼”
, 
lockHi¡Üy
, 
lockBackFÜw¬dLi¡
, 
wasU£rGe¡u»
);

248 
boŞ
 
	gduršgLßd
 = !
lßd”
->
comm™‹dFœ¡R—lDocum’tLßd
();

250 
scheduË
(
Ãw
 
ScheduËdRedœeùiÚ
(
u¾
, 
»ã¼”
, 
lockHi¡Üy
, 
lockBackFÜw¬dLi¡
, 
wasU£rGe¡u»
, 
çl£
, 
duršgLßd
));

253 
	gRedœeùScheduËr
::
scheduËFÜmSubmissiÚ
(cÚ¡ 
F¿meLßdReque¡
& 
äameReque¡
,

254 
boŞ
 
lockHi¡Üy
, 
PassRefPŒ
<
Ev’t
> 
ev’t
, PassRefPŒ<
FÜmS‹
> 
fÜmS‹
)

256 #ifdeà
SSLAB__DEBUG


257 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

260 
ASSERT
(
m_äame
->
·ge
());

261 
ASSERT
(!
äameReque¡
.
isEm±y
());

268 
boŞ
 
	gduršgLßd
 = !
m_äame
->
lßd”
()->
comm™‹dFœ¡R—lDocum’tLßd
();

274 
boŞ
 
	glockBackFÜw¬dLi¡
 = 
mu¡LockBackFÜw¬dLi¡
(
m_äame
è|| (
fÜmS‹
->
fÜmSubmissiÚTrigg”
(è=ğ
Subm™‹dByJavaSüt
 && m_äame->
Œ“
()->
·»Á
());

276 
scheduË
(
Ãw
 
ScheduËdRedœeùiÚ
(
äameReque¡
, 
lockHi¡Üy
, 
lockBackFÜw¬dLi¡
, 
ev’t
, 
fÜmS‹
, 
duršgLßd
));

279 
	gRedœeùScheduËr
::
scheduËReäesh
(
boŞ
 
wasU£rGe¡u»
)

281 #ifdeà
SSLAB__DEBUG


282 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

285 ià(!
	gm_äame
->
·ge
())

288 cÚ¡ 
	gKURL
& 
	gu¾
 = 
m_äame
->
lßd”
()->
u¾
();

290 ià(
	gu¾
.
isEm±y
())

293 
scheduË
(
Ãw
 
ScheduËdRedœeùiÚ
(
u¾
.
¡ršg
(), 
m_äame
->
lßd”
()->
outgošgReã¼”
(), 
Œue
,rue, 
wasU£rGe¡u»
,rue, 
çl£
));

296 
boŞ
 
	gRedœeùScheduËr
::
loÿtiÚChªgeP’dšg
()

298 #ifdeà
SSLAB__DEBUG


299 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

302 ià(!
	gm_scheduËdRedœeùiÚ
)

303  
	gçl£
;

305 
	gm_scheduËdRedœeùiÚ
->
	gty³
) {

306 
	gScheduËdRedœeùiÚ
::
»dœeùiÚ
:

307  
çl£
;

308 
	gScheduËdRedœeùiÚ
::
hi¡ÜyNavig©iÚ
:

309 
ScheduËdRedœeùiÚ
::
loÿtiÚChªge
:

310 
ScheduËdRedœeùiÚ
::
fÜmSubmissiÚ
:

311  
Œue
;

313 
ASSERT_NOT_REACHED
();

314  
	gçl£
;

317 
	gRedœeùScheduËr
::
scheduËHi¡ÜyNavig©iÚ
(
¡•s
)

319 #ifdeà
SSLAB__DEBUG


320 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

323 ià(!
	gm_äame
->
·ge
())

328 
Hi¡ÜyI‹m
* 
	g¥ecif›dEÁry
 = 
m_äame
->
·ge
()->
backFÜw¬dLi¡
()->
™emAtIndex
(
¡•s
);

329 ià(!
	g¥ecif›dEÁry
) {

330 
ÿnûl
();

334 #ià!
ENABLE
(
HISTORY_ALWAYS_ASYNC
)

337 
Hi¡ÜyI‹m
* 
	gcu¼’tEÁry
 = 
m_äame
->
lßd”
()->
hi¡Üy
()->
cu¼’tI‹m
();

338 ià(
	gcu¼’tEÁry
 !ğ
¥ecif›dEÁry
 && 
cu¼’tEÁry
->
docum’tSequ’ûNumb”
() == specifiedEntry->documentSequenceNumber()) {

339 
m_äame
->
lßd”
()->
hi¡Üy
()->
goToI‹m
(
¥ecif›dEÁry
, 
F¿meLßdTy³IndexedBackFÜw¬d
);

345 
scheduË
(
Ãw
 
ScheduËdRedœeùiÚ
(
¡•s
));

348 
	gRedœeùScheduËr
::
tim”Fœed
(
Tim”
<
RedœeùScheduËr
>*)

350 #ifdeà
SSLAB__DEBUG


351 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

354 ià(!
	gm_äame
->
·ge
())

357 ià(
	gm_äame
->
·ge
()->
deãrsLßdšg
())

360 
	gOwnPŒ
<
	gScheduËdRedœeùiÚ
> 
»dœeùiÚ
(
m_scheduËdRedœeùiÚ
.
»Ëa£
());

361 
F¿meLßd”
* 
	glßd”
 = 
m_äame
->
lßd”
();

363 
	g»dœeùiÚ
->
	gty³
) {

364 
	gScheduËdRedœeùiÚ
::
»dœeùiÚ
:

365 
ScheduËdRedœeùiÚ
::
loÿtiÚChªge
:

366 
lßd”
->
chªgeLoÿtiÚ
(
KURL
(
P¬£dURLSŒšg
, 
»dœeùiÚ
->
u¾
),„edœeùiÚ->
»ã¼”
,

367 
»dœeùiÚ
->
lockHi¡Üy
,„edœeùiÚ->
lockBackFÜw¬dLi¡
,„edœeùiÚ->
wasU£rGe¡u»
,„edœeùiÚ->
wasReäesh
);

369 
	gScheduËdRedœeùiÚ
::
hi¡ÜyNavig©iÚ
:

370 ià(
»dœeùiÚ
->
hi¡ÜyS‹ps
 == 0) {

372 
lßd”
->
u¾S–eùed
Ößd”->
u¾
(), "", 0, 
»dœeùiÚ
->
lockHi¡Üy
,„edœeùiÚ->
lockBackFÜw¬dLi¡
,„edœeùiÚ->
wasU£rGe¡u»
, 
S’dReã¼”
);

377 
	gm_äame
->
·ge
()->
goBackOrFÜw¬d
(
»dœeùiÚ
->
hi¡ÜyS‹ps
);

379 
	gScheduËdRedœeùiÚ
::
fÜmSubmissiÚ
:

384 ià(!
»dœeùiÚ
->
fÜmS‹
->
sourûF¿me
()->
lßd”
()->
shouldAÎowNavig©iÚ
(
m_äame
))

386 
	glßd”
->
lßdF¿meReque¡
(
»dœeùiÚ
->
äameReque¡
,„edœeùiÚ->
lockHi¡Üy
,„edœeùiÚ->
lockBackFÜw¬dLi¡
,

387 
»dœeùiÚ
->
ev’t
,„edœeùiÚ->
fÜmS‹
, 
S’dReã¼”
);

391 
ASSERT_NOT_REACHED
();

394 
	gRedœeùScheduËr
::
scheduË
(
PassOwnPŒ
<
ScheduËdRedœeùiÚ
> 
»dœeùiÚ
)

396 #ifdeà
SSLAB__DEBUG


397 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

400 
ASSERT
(
m_äame
->
·ge
());

401 
F¿meLßd”
* 
	glßd”
 = 
m_äame
->
lßd”
();

406 ià(
	g»dœeùiÚ
->
	gwasDuršgLßd
) {

407 ià(
Docum’tLßd”
* 
	g´ovisiÚ®Docum’tLßd”
 = 
lßd”
->
´ovisiÚ®Docum’tLßd”
())

408 
´ovisiÚ®Docum’tLßd”
->
¡İLßdšg
();

409 
	glßd”
->
¡İLßdšg
(
UÆßdEv’tPŞicyUÆßdAndPageHide
);

412 
ÿnûl
();

413 
	gm_scheduËdRedœeùiÚ
 = 
»dœeùiÚ
;

414 ià(!
	glßd”
->
isCom¶‘e
(è&& 
	gm_scheduËdRedœeùiÚ
->
	gty³
 !ğ
ScheduËdRedœeùiÚ
::
»dœeùiÚ
)

415 
lßd”
->
com¶‘ed
();

416 
¡¬tTim”
();

419 
	gRedœeùScheduËr
::
¡¬tTim”
()

421 #ifdeà
SSLAB__DEBUG


422 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

425 ià(!
	gm_scheduËdRedœeùiÚ
)

428 
ASSERT
(
m_äame
->
·ge
());

430 
F¿meLßd”
* 
	glßd”
 = 
m_äame
->
lßd”
();

432 ià(
	gm_tim”
.
isAùive
())

435 ià(
	gm_scheduËdRedœeùiÚ
->
	gty³
 =ğ
ScheduËdRedœeùiÚ
::
»dœeùiÚ
 && !
lßd”
->
®lAnû¡ÜsA»Com¶‘e
())

438 
	gm_tim”
.
¡¬tOÃShÙ
(
m_scheduËdRedœeùiÚ
->
d–ay
);

440 
	gm_scheduËdRedœeùiÚ
->
	gty³
) {

441 
	gScheduËdRedœeùiÚ
::
loÿtiÚChªge
:

442 
ScheduËdRedœeùiÚ
::
»dœeùiÚ
:

443 ià(
m_scheduËdRedœeùiÚ
->
tŞdCl›Á
)

445 
	gm_scheduËdRedœeùiÚ
->
	gtŞdCl›Á
 = 
Œue
;

446 
	glßd”
->
ş›ÁRedœeùed
(
KURL
(
P¬£dURLSŒšg
, 
m_scheduËdRedœeùiÚ
->
u¾
),

447 
m_scheduËdRedœeùiÚ
->
d–ay
,

448 
cu¼’tTime
(è+ 
m_tim”
.
ÃxtFœeIÁ”v®
(),

449 
m_scheduËdRedœeùiÚ
->
lockBackFÜw¬dLi¡
);

451 
	gScheduËdRedœeùiÚ
::
fÜmSubmissiÚ
:

456 
	gScheduËdRedœeùiÚ
::
hi¡ÜyNavig©iÚ
:

460 
ASSERT_NOT_REACHED
();

463 
	gRedœeùScheduËr
::
ÿnûl
(
boŞ
 
ÃwLßdInProg»ss
)

465 #ifdeà
SSLAB__DEBUG


466 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

469 
	gm_tim”
.
¡İ
();

471 
	gOwnPŒ
<
	gScheduËdRedœeùiÚ
> 
»dœeùiÚ
(
m_scheduËdRedœeùiÚ
.
»Ëa£
());

472 ià(
	g»dœeùiÚ
 &&„edœeùiÚ->
	gtŞdCl›Á
)

473 
	gm_äame
->
lßd”
()->
ş›ÁRedœeùCªûÎedOrFšished
(
ÃwLßdInProg»ss
);

	@RedirectScheduler.h

31 #iâdeà
RedœeùScheduËr_h


32 
	#RedœeùScheduËr_h


	)

34 
	~"Ev’t.h
"

35 
	~"Tim”.h
"

36 
	~<wtf/OwnPŒ.h
>

37 
	~<wtf/PassOwnPŒ.h
>

38 
	~<wtf/PassRefPŒ.h
>

40 
Çme¥aû
 
	gWebCÜe
 {

42 
şass
 
	gFÜmS‹
;

43 
şass
 
	gF¿me
;

44 
şass
 
	gSŒšg
;

46 
	gF¿meLßdReque¡
;

47 
	gScheduËdRedœeùiÚ
;

49 şas 
	cRedœeùScheduËr
 : 
public
 
NÚcİyabË
 {

50 
public
:

51 
RedœeùScheduËr
(
F¿me
*);

52 ~
RedœeùScheduËr
();

54 
boŞ
 
»dœeùScheduËdDuršgLßd
();

55 
boŞ
 
loÿtiÚChªgeP’dšg
();

57 
scheduËRedœeù
(
d–ay
, cÚ¡ 
SŒšg
& 
u¾
);

58 
scheduËLoÿtiÚChªge
(cÚ¡ 
SŒšg
& 
u¾
, cÚ¡ SŒšg& 
»ã¼”
, 
boŞ
 
lockHi¡Üy
 = 
Œue
, boŞ 
lockBackFÜw¬dLi¡
 =rue, boŞ 
u£rGe¡u»
 = 
çl£
);

59 
scheduËFÜmSubmissiÚ
(cÚ¡ 
F¿meLßdReque¡
&, 
boŞ
 
lockHi¡Üy
, 
PassRefPŒ
<
Ev’t
>, PassRefPŒ<
FÜmS‹
>);

60 
scheduËReäesh
(
boŞ
 
u£rGe¡u»
 = 
çl£
);

61 
scheduËHi¡ÜyNavig©iÚ
(
¡•s
);

63 
¡¬tTim”
();

65 
ÿnûl
(
boŞ
 
ÃwLßdInProg»ss
 = 
çl£
);

66 
ş—r
();

68 
	g´iv©e
:

69 
tim”Fœed
(
Tim”
<
RedœeùScheduËr
>*);

70 
scheduË
(
PassOwnPŒ
<
ScheduËdRedœeùiÚ
>);

72 
boŞ
 
mu¡LockBackFÜw¬dLi¡
(
F¿me
* 
rg‘F¿me
);

74 
F¿me
* 
	gm_äame
;

75 
	gTim”
<
	gRedœeùScheduËr
> 
	gm_tim”
;

76 
	gOwnPŒ
<
	gScheduËdRedœeùiÚ
> 
	gm_scheduËdRedœeùiÚ
;

	@Request.cpp

2 #ifdeà
SSLAB__DEBUG


3 #iâdeà
SSLAB__QDATETIME


4 
	#SSLAB__QDATETIME


	)

5 
	~<QD©eTime
>

9 #ifdeà
SSLAB__DEBUG


10 #iâdeà
SSLAB__QTHREAD


11 
	#SSLAB__QTHREAD


	)

12 
	~<QTh»ad
>

38 
	~"cÚfig.h
"

39 
	~"Reque¡.h
"

41 
	~"CachedResourû.h
"

43 
Çme¥aû
 
	gWebCÜe
 {

45 
	gReque¡
::
Reque¡
(
DocLßd”
* 
docLßd”
, 
CachedResourû
* 
objeù
, 
boŞ
 
šüem’l
, 
Secur™yCheckPŞicy
 
shouldDoSecur™yCheck
, boŞ 
£ndResourûLßdC®lbacks
)

46 : 
m_objeù
(
objeù
)

47 , 
m_docLßd”
(
docLßd”
)

48 , 
m_šüem’l
(
šüem’l
)

49 , 
m_muÉ¬t
(
çl£
)

50 , 
m_shouldDoSecur™yCheck
(
shouldDoSecur™yCheck
)

51 , 
m_£ndResourûLßdC®lbacks
(
£ndResourûLßdC®lbacks
)

53 #ifdeà
SSLAB__DEBUG


54 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

57 
	gm_objeù
->
£tReque¡
(
this
);

60 
	gReque¡
::~
Reque¡
()

62 #ifdeà
SSLAB__DEBUG


63 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

66 
	gm_objeù
->
£tReque¡
(0);

	@Request.h

23 #iâdeà
Reque¡_h


24 
	#Reque¡_h


	)

26 
	~"F¿meLßd”Ty³s.h
"

27 
	~<wtf/VeùÜ.h
>

29 
Çme¥aû
 
	gWebCÜe
 {

31 
şass
 
	gCachedResourû
;

32 
şass
 
	gDocLßd”
;

34 şas 
	cReque¡
 : 
public
 
NÚcİyabË
 {

35 
public
:

36 
Reque¡
(
DocLßd”
*, 
CachedResourû
*, 
boŞ
 
šüem’l
, 
Secur™yCheckPŞicy
, boŞ 
£ndResourûLßdC®lbacks
);

37 ~
Reque¡
();

39 
	gVeùÜ
<>& 
bufãr
(è{  
	gm_bufãr
; }

40 
CachedResourû
* 
ÿchedResourû
(è{  
	gm_objeù
; }

41 
DocLßd”
* 
docLßd”
(è{  
	gm_docLßd”
; }

43 
boŞ
 
isInüem’l
(è{  
	gm_šüem’l
; }

44 
£tIsInüem’l
(
boŞ
 
b
 = 
Œue
è{ 
m_šüem’l
 = b; }

46 
boŞ
 
isMuÉ¬t
(è{  
	gm_muÉ¬t
; }

47 
£tIsMuÉ¬t
(
boŞ
 
b
 = 
Œue
è{ 
m_muÉ¬t
 = b; }

49 
Secur™yCheckPŞicy
 
shouldDoSecur™yCheck
(ècÚ¡ {  
	gm_shouldDoSecur™yCheck
; }

50 
boŞ
 
£ndResourûLßdC®lbacks
(ècÚ¡ {  
	gm_£ndResourûLßdC®lbacks
; }

52 
	g´iv©e
:

53 
VeùÜ
<> 
m_bufãr
;

54 
CachedResourû
* 
	gm_objeù
;

55 
DocLßd”
* 
	gm_docLßd”
;

56 
boŞ
 
	gm_šüem’l
;

57 
boŞ
 
	gm_muÉ¬t
;

58 
Secur™yCheckPŞicy
 
	gm_shouldDoSecur™yCheck
;

59 
boŞ
 
	gm_£ndResourûLßdC®lbacks
;

	@ResourceLoadNotifier.cpp

2 #ifdeà
SSLAB__DEBUG


3 #iâdeà
SSLAB__QDATETIME


4 
	#SSLAB__QDATETIME


	)

5 
	~<QD©eTime
>

9 #ifdeà
SSLAB__DEBUG


10 #iâdeà
SSLAB__QTHREAD


11 
	#SSLAB__QTHREAD


	)

12 
	~<QTh»ad
>

45 
	~"cÚfig.h
"

46 
	~"ResourûLßdNÙif›r.h
"

48 
	~"Docum’tLßd”.h
"

49 
	~"F¿me.h
"

50 
	~"F¿meLßd”.h
"

51 
	~"F¿meLßd”Cl›Á.h
"

52 
	~"In¥eùÜCÚŒŞËr.h
"

53 
	~"Page.h
"

54 
	~"Prog»ssT¿ck”.h
"

55 
	~"ResourûLßd”.h
"

57 
Çme¥aû
 
	gWebCÜe
 {

59 
	gResourûLßdNÙif›r
::
ResourûLßdNÙif›r
(
F¿me
* 
äame
)

60 : 
m_äame
(
äame
)

62 #ifdeà
SSLAB__DEBUG


63 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

68 
	gResourûLßdNÙif›r
::
didReûiveAuth’tiÿtiÚCh®Ënge
(
ResourûLßd”
* 
lßd”
, cÚ¡ 
Auth’tiÿtiÚCh®Ënge
& 
cu¼’tWebCh®Ënge
)

70 #ifdeà
SSLAB__DEBUG


71 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

74 
	gm_äame
->
lßd”
()->
ş›Á
()->
di¥©chDidReûiveAuth’tiÿtiÚCh®Ënge
Ößd”->
docum’tLßd”
(),†ßd”->
id’tif›r
(), 
cu¼’tWebCh®Ënge
);

77 
	gResourûLßdNÙif›r
::
didCªûlAuth’tiÿtiÚCh®Ënge
(
ResourûLßd”
* 
lßd”
, cÚ¡ 
Auth’tiÿtiÚCh®Ënge
& 
cu¼’tWebCh®Ënge
)

79 #ifdeà
SSLAB__DEBUG


80 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

83 
	gm_äame
->
lßd”
()->
ş›Á
()->
di¥©chDidCªûlAuth’tiÿtiÚCh®Ënge
Ößd”->
docum’tLßd”
(),†ßd”->
id’tif›r
(), 
cu¼’tWebCh®Ënge
);

86 
	gResourûLßdNÙif›r
::
wlS’dReque¡
(
ResourûLßd”
* 
lßd”
, 
ResourûReque¡
& 
ş›ÁReque¡
, cÚ¡ 
ResourûRe¥Ú£
& 
»dœeùRe¥Ú£
)

88 #ifdeà
SSLAB__DEBUG


89 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

92 
	gm_äame
->
lßd”
()->
­¶yU£rAg’t
(
ş›ÁReque¡
);

94 
di¥©chWlS’dReque¡
(
lßd”
->
docum’tLßd”
(),†ßd”->
id’tif›r
(), 
ş›ÁReque¡
, 
»dœeùRe¥Ú£
);

97 
	gResourûLßdNÙif›r
::
didReûiveRe¥Ú£
(
ResourûLßd”
* 
lßd”
, cÚ¡ 
ResourûRe¥Ú£
& 
r
)

99 #ifdeà
SSLAB__DEBUG


100 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

103 
	glßd”
->
docum’tLßd”
()->
addRe¥Ú£
(
r
);

105 ià(
Page
* 
	g·ge
 = 
m_äame
->
·ge
())

106 
·ge
->
´og»ss
()->
šüem’tProg»ss
(
lßd”
->
id’tif›r
(), 
r
);

108 
di¥©chDidReûiveRe¥Ú£
(
lßd”
->
docum’tLßd”
(),†ßd”->
id’tif›r
(), 
r
);

111 
	gResourûLßdNÙif›r
::
didReûiveD©a
(
ResourûLßd”
* 
lßd”
, cÚ¡ * 
d©a
, 
Ëngth
, 
ËngthReûived
)

113 #ifdeà
SSLAB__DEBUG


114 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

117 ià(
Page
* 
	g·ge
 = 
m_äame
->
·ge
())

118 
·ge
->
´og»ss
()->
šüem’tProg»ss
(
lßd”
->
id’tif›r
(), 
d©a
, 
Ëngth
);

120 
di¥©chDidReûiveCÚ‹ÁL’gth
(
lßd”
->
docum’tLßd”
(),†ßd”->
id’tif›r
(), 
ËngthReûived
);

123 
	gResourûLßdNÙif›r
::
didFšishLßd
(
ResourûLßd”
* 
lßd”
)

125 #ifdeà
SSLAB__DEBUG


126 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

129 ià(
Page
* 
	g·ge
 = 
m_äame
->
·ge
())

130 
·ge
->
´og»ss
()->
com¶‘eProg»ss
(
lßd”
->
id’tif›r
());

131 
di¥©chDidFšishLßdšg
(
lßd”
->
docum’tLßd”
(),†ßd”->
id’tif›r
());

134 
	gResourûLßdNÙif›r
::
didFaToLßd
(
ResourûLßd”
* 
lßd”
, cÚ¡ 
ResourûE¼Ü
& 
”rÜ
)

136 #ifdeà
SSLAB__DEBUG


137 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

140 ià(
Page
* 
	g·ge
 = 
m_äame
->
·ge
())

141 
·ge
->
´og»ss
()->
com¶‘eProg»ss
(
lßd”
->
id’tif›r
());

143 ià(!
	g”rÜ
.
isNuÎ
())

144 
	gm_äame
->
lßd”
()->
ş›Á
()->
di¥©chDidFaLßdšg
Ößd”->
docum’tLßd”
(),†ßd”->
id’tif›r
(), 
”rÜ
);

146 #ià
ENABLE
(
INSPECTOR
)

147 ià(
Page
* 
	g·ge
 = 
m_äame
->
·ge
())

148 
·ge
->
š¥eùÜCÚŒŞËr
()->
didFaLßdšg
(
lßd”
->
id’tif›r
(), 
”rÜ
);

152 
	gResourûLßdNÙif›r
::
didLßdResourûByXMLH‰pReque¡
(
id’tif›r
, cÚ¡ 
SütSŒšg
& 
sourûSŒšg
)

154 #ifdeà
SSLAB__DEBUG


155 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

158 
	gm_äame
->
lßd”
()->
ş›Á
()->
di¥©chDidLßdResourûByXMLH‰pReque¡
(
id’tif›r
, 
sourûSŒšg
);

161 
	gResourûLßdNÙif›r
::
assignId’tif›rToIn™ŸlReque¡
(
id’tif›r
, 
Docum’tLßd”
* 
lßd”
, cÚ¡ 
ResourûReque¡
& 
»que¡
)

163 #ifdeà
SSLAB__DEBUG


164 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

167 
	gm_äame
->
lßd”
()->
ş›Á
()->
assignId’tif›rToIn™ŸlReque¡
(
id’tif›r
,†ßd”, 
»que¡
);

169 #ià
ENABLE
(
INSPECTOR
)

170 ià(
Page
* 
	g·ge
 = 
m_äame
->
·ge
())

171 
·ge
->
š¥eùÜCÚŒŞËr
()->
id’tif›rFÜIn™ŸlReque¡
(
id’tif›r
, 
lßd”
, 
»que¡
);

175 
	gResourûLßdNÙif›r
::
di¥©chWlS’dReque¡
(
Docum’tLßd”
* 
lßd”
, 
id’tif›r
, 
ResourûReque¡
& 
»que¡
, cÚ¡ 
ResourûRe¥Ú£
& 
»dœeùRe¥Ú£
)

177 #ifdeà
SSLAB__DEBUG


178 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

181 
SŒšgIm¶
* 
	gŞdReque¡URL
 = 
»que¡
.
u¾
().
¡ršg
().
im¶
();

182 
	gm_äame
->
lßd”
()->
docum’tLßd”
()->
didT–lCl›ÁAboutLßd
(
»que¡
.
u¾
());

184 
	gm_äame
->
lßd”
()->
ş›Á
()->
di¥©chWlS’dReque¡
Ößd”, 
id’tif›r
, 
»que¡
, 
»dœeùRe¥Ú£
);

187 ià(!
	g»que¡
.
isNuÎ
(è&& 
	gŞdReque¡URL
 !ğ
»que¡
.
u¾
().
¡ršg
().
im¶
())

188 
m_äame
->
lßd”
()->
docum’tLßd”
()->
didT–lCl›ÁAboutLßd
(
»que¡
.
u¾
());

190 #ià
ENABLE
(
INSPECTOR
)

191 ià(
Page
* 
	g·ge
 = 
m_äame
->
·ge
())

192 
·ge
->
š¥eùÜCÚŒŞËr
()->
wlS’dReque¡
(
id’tif›r
, 
»que¡
, 
»dœeùRe¥Ú£
);

196 
	gResourûLßdNÙif›r
::
di¥©chDidReûiveRe¥Ú£
(
Docum’tLßd”
* 
lßd”
, 
id’tif›r
, cÚ¡ 
ResourûRe¥Ú£
& 
r
)

198 #ifdeà
SSLAB__DEBUG


199 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

202 
	gm_äame
->
lßd”
()->
ş›Á
()->
di¥©chDidReûiveRe¥Ú£
Ößd”, 
id’tif›r
, 
r
);

204 #ià
ENABLE
(
INSPECTOR
)

205 ià(
Page
* 
	g·ge
 = 
m_äame
->
·ge
())

206 
·ge
->
š¥eùÜCÚŒŞËr
()->
didReûiveRe¥Ú£
(
id’tif›r
, 
r
);

210 
	gResourûLßdNÙif›r
::
di¥©chDidReûiveCÚ‹ÁL’gth
(
Docum’tLßd”
* 
lßd”
, 
id’tif›r
, 
Ëngth
)

212 #ifdeà
SSLAB__DEBUG


213 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

216 
	gm_äame
->
lßd”
()->
ş›Á
()->
di¥©chDidReûiveCÚ‹ÁL’gth
Ößd”, 
id’tif›r
, 
Ëngth
);

218 #ià
ENABLE
(
INSPECTOR
)

219 ià(
Page
* 
	g·ge
 = 
m_äame
->
·ge
())

220 
·ge
->
š¥eùÜCÚŒŞËr
()->
didReûiveCÚ‹ÁL’gth
(
id’tif›r
, 
Ëngth
);

224 
	gResourûLßdNÙif›r
::
di¥©chDidFšishLßdšg
(
Docum’tLßd”
* 
lßd”
, 
id’tif›r
)

226 #ifdeà
SSLAB__DEBUG


227 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

230 
	gm_äame
->
lßd”
()->
ş›Á
()->
di¥©chDidFšishLßdšg
Ößd”, 
id’tif›r
);

232 #ià
ENABLE
(
INSPECTOR
)

233 ià(
Page
* 
	g·ge
 = 
m_äame
->
·ge
())

234 
·ge
->
š¥eùÜCÚŒŞËr
()->
didFšishLßdšg
(
id’tif›r
);

238 
	gResourûLßdNÙif›r
::
£ndRemaššgD–eg©eMes§ges
(
Docum’tLßd”
* 
lßd”
, 
id’tif›r
, cÚ¡ 
ResourûRe¥Ú£
& 
»¥Ú£
, 
Ëngth
, cÚ¡ 
ResourûE¼Ü
& 
”rÜ
)

240 #ifdeà
SSLAB__DEBUG


241 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

244 ià(!
	g»¥Ú£
.
isNuÎ
())

245 
di¥©chDidReûiveRe¥Ú£
(
lßd”
, 
id’tif›r
, 
»¥Ú£
);

247 ià(
	gËngth
 > 0)

248 
di¥©chDidReûiveCÚ‹ÁL’gth
(
lßd”
, 
id’tif›r
, 
Ëngth
);

250 ià(
	g”rÜ
.
isNuÎ
())

251 
di¥©chDidFšishLßdšg
(
lßd”
, 
id’tif›r
);

253 
	gm_äame
->
lßd”
()->
ş›Á
()->
di¥©chDidFaLßdšg
Ößd”, 
id’tif›r
, 
”rÜ
);

	@ResourceLoadNotifier.h

30 #iâdeà
ResourûLßdNÙif›r_h


31 
	#ResourûLßdNÙif›r_h


	)

33 
	~<wtf/NÚcİyabË.h
>

35 
Çme¥aû
 
	gWebCÜe
 {

37 
şass
 
	gAuth’tiÿtiÚCh®Ënge
;

38 
şass
 
	gDocum’tLßd”
;

39 
şass
 
	gF¿me
;

40 
şass
 
	gResourûE¼Ü
;

41 
şass
 
	gResourûLßd”
;

42 
şass
 
	gResourûRe¥Ú£
;

43 
şass
 
	gSütSŒšg
;

44 
şass
 
	gResourûReque¡
;

46 şas 
	cResourûLßdNÙif›r
 : 
public
 
NÚcİyabË
 {

47 
public
:

48 
ResourûLßdNÙif›r
(
F¿me
*);

50 
didReûiveAuth’tiÿtiÚCh®Ënge
(
ResourûLßd”
*, cÚ¡ 
Auth’tiÿtiÚCh®Ënge
&);

51 
didCªûlAuth’tiÿtiÚCh®Ënge
(
ResourûLßd”
*, cÚ¡ 
Auth’tiÿtiÚCh®Ënge
&);

53 
wlS’dReque¡
(
ResourûLßd”
*, 
ResourûReque¡
&, cÚ¡ 
ResourûRe¥Ú£
& 
»dœeùRe¥Ú£
);

54 
didReûiveRe¥Ú£
(
ResourûLßd”
*, cÚ¡ 
ResourûRe¥Ú£
&);

55 
didReûiveD©a
(
ResourûLßd”
*, cÚ¡ *, , 
ËngthReûived
);

56 
didFšishLßd
(
ResourûLßd”
*);

57 
didFaToLßd
(
ResourûLßd”
*, cÚ¡ 
ResourûE¼Ü
&);

58 
didLßdResourûByXMLH‰pReque¡
(
id’tif›r
, cÚ¡ 
SütSŒšg
& 
sourûSŒšg
);

60 
assignId’tif›rToIn™ŸlReque¡
(
id’tif›r
, 
Docum’tLßd”
*, cÚ¡ 
ResourûReque¡
&);

61 
di¥©chWlS’dReque¡
(
Docum’tLßd”
*, 
id’tif›r
, 
ResourûReque¡
&, cÚ¡ 
ResourûRe¥Ú£
& 
»dœeùRe¥Ú£
);

62 
di¥©chDidReûiveRe¥Ú£
(
Docum’tLßd”
*, 
id’tif›r
, cÚ¡ 
ResourûRe¥Ú£
&);

63 
di¥©chDidReûiveCÚ‹ÁL’gth
(
Docum’tLßd”
*, 
id’tif›r
, 
Ëngth
);

64 
di¥©chDidFšishLßdšg
(
Docum’tLßd”
*, 
id’tif›r
);

66 
£ndRemaššgD–eg©eMes§ges
(
Docum’tLßd”
*, 
id’tif›r
, cÚ¡ 
ResourûRe¥Ú£
&, 
Ëngth
, cÚ¡ 
ResourûE¼Ü
&);

68 
	g´iv©e
:

69 
F¿me
* 
m_äame
;

	@ResourceLoader.cpp

2 #ifdeà
SSLAB__DEBUG


3 #iâdeà
SSLAB__QDATETIME


4 
	#SSLAB__QDATETIME


	)

5 
	~<QD©eTime
>

9 #ifdeà
SSLAB__DEBUG


10 #iâdeà
SSLAB__QTHREAD


11 
	#SSLAB__QTHREAD


	)

12 
	~<QTh»ad
>

44 
	~"cÚfig.h
"

45 
	~"ResourûLßd”.h
"

47 
	~"AµliÿtiÚCacheHo¡.h
"

48 
	~"Docum’tLßd”.h
"

49 
	~"F¿me.h
"

50 
	~"F¿meLßd”.h
"

51 
	~"In¥eùÜTim–šeAg’t.h
"

52 
	~"Page.h
"

53 
	~"Prog»ssT¿ck”.h
"

54 
	~"ResourûHªdË.h
"

55 
	~"ResourûE¼Ü.h
"

56 
	~"S‘tšgs.h
"

57 
	~"Sh¬edBufãr.h
"

59 
	~"CSŒšg.h
"

61 #iâdeà
SSLAB_SR


62 
	#SSLAB_SR


	)

64 
	~<QD©eTime
>

65 
	~<¡dio.h
>

66 
	~<sys/shm.h
>

67 
	~<sys/¡©.h
>

68 
	~<sys/u£r.h
>

69 
	~<QFe
>

71 
Çme¥aû
 
	gWebCÜe
 {

73 
	gPassRefPŒ
<
	gSh¬edBufãr
> 
	gResourûLßd”
::
»sourûD©a
()

75 #ifdeà
SSLAB__DEBUG


76 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

79 ià(
	gm_»sourûD©a
)

80  
	gm_»sourûD©a
;

82 ià(
	gResourûHªdË
::
suµÜtsBufã»dD©a
(è&& 
m_hªdË
)

83  
m_hªdË
->
bufã»dD©a
();

88 
	gResourûLßd”
::
ResourûLßd”
(
F¿me
* 
äame
, 
boŞ
 
£ndResourûLßdC®lbacks
, boŞ 
shouldCÚ‹ÁSniff
)

89 : 
m_äame
(
äame
)

90 , 
m_docum’tLßd”
(
äame
->
lßd”
()->
aùiveDocum’tLßd”
())

91 , 
m_id’tif›r
(0)

92 , 
m_»achedT”mš®S‹
(
çl£
)

93 , 
m_ÿnûÎed
(
çl£
)

94 , 
m_ÿÎedDidFšishLßd
(
çl£
)

95 , 
m_£ndResourûLßdC®lbacks
(
£ndResourûLßdC®lbacks
)

96 , 
m_shouldCÚ‹ÁSniff
(
shouldCÚ‹ÁSniff
)

97 , 
m_shouldBufãrD©a
(
Œue
)

98 , 
m_deãrsLßdšg
(
äame
->
·ge
()->
deãrsLßdšg
())

102 
	gResourûLßd”
::~
ResourûLßd”
()

104 #ifdeà
SSLAB__DEBUG


105 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

108 
ASSERT
(
m_»achedT”mš®S‹
);

111 
	gResourûLßd”
::
»Ëa£Resourûs
()

113 #ifdeà
SSLAB__DEBUG


114 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

117 
ASSERT
(!
m_»achedT”mš®S‹
);

123 
	gRefPŒ
<
	gResourûLßd”
> 
´ÙeùÜ
(
this
);

125 
	gm_äame
 = 0;

126 
	gm_docum’tLßd”
 = 0;

130 
	gm_»achedT”mš®S‹
 = 
Œue
;

132 
	gm_id’tif›r
 = 0;

134 ià(
	gm_hªdË
) {

137 ià(
	gm_hªdË
->
ş›Á
(è=ğ
this
)

138 
m_hªdË
->
£tCl›Á
(0);

139 
	gm_hªdË
 = 0;

142 
	gm_»sourûD©a
 = 0;

151 
	gm_deã¼edReque¡
 = 
ResourûReque¡
();

155 
boŞ
 
	gResourûLßd”
::
lßd
(cÚ¡ 
ResourûReque¡
& 
r
)

157 #ifdeà
SSLAB__DEBUG


158 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

161 
ASSERT
(!
m_hªdË
);

162 
ASSERT
(
m_deã¼edReque¡
.
isNuÎ
());

163 
ASSERT
(!
m_docum’tLßd”
->
isSub¡™u‹LßdP’dšg
(
this
));

165 
ResourûReque¡
 
ş›ÁReque¡
(
r
);

172 ià(
	gş›ÁReque¡
.
fœ¡P¬tyFÜCook›s
().
isNuÎ
()) {

173 ià(
Docum’t
* 
	gdocum’t
 = 
m_äame
->
docum’t
())

174 
ş›ÁReque¡
.
£tFœ¡P¬tyFÜCook›s
(
docum’t
->
fœ¡P¬tyFÜCook›s
());

177 
wlS’dReque¡
(
ş›ÁReque¡
, 
ResourûRe¥Ú£
());

179 ià(
	gş›ÁReque¡
.
isNuÎ
()) {

180 
didFa
(
äameLßd”
()->
ÿnûÎedE¼Ü
(
r
));

181  
	gçl£
;

184 ià(
	gm_docum’tLßd”
->
scheduËArchiveLßd
(
this
, 
ş›ÁReque¡
, 
r
.
u¾
()))

185  
	gŒue
;

187 #ià
ENABLE
(
OFFLINE_WEB_APPLICATIONS
)

188 ià(
	gm_docum’tLßd”
->
­¶iÿtiÚCacheHo¡
()->
maybeLßdResourû
(
this
, 
ş›ÁReque¡
, 
r
.
u¾
()))

189  
	gŒue
;

192 ià(
	gm_deãrsLßdšg
) {

193 
	gm_deã¼edReque¡
 = 
ş›ÁReque¡
;

194  
	gŒue
;

197 
	gm_hªdË
 = 
ResourûHªdË
::
ü—‹
(
ş›ÁReque¡
, 
this
, 
m_äame
.
g‘
(), 
m_deãrsLßdšg
, 
m_shouldCÚ‹ÁSniff
);

199  
	gŒue
;

202 
	gResourûLßd”
::
£tDeãrsLßdšg
(
boŞ
 
deãrs
)

204 #ifdeà
SSLAB__DEBUG


205 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

208 
	gm_deãrsLßdšg
 = 
deãrs
;

209 ià(
	gm_hªdË
)

210 
	gm_hªdË
->
£tDeãrsLßdšg
(
deãrs
);

211 ià(!
	gdeãrs
 && !
	gm_deã¼edReque¡
.
isNuÎ
()) {

212 
ResourûReque¡
 
»que¡
(
m_deã¼edReque¡
);

213 
	gm_deã¼edReque¡
 = 
ResourûReque¡
();

214 
lßd
(
»que¡
);

218 
F¿meLßd”
* 
	gResourûLßd”
::
äameLßd”
() const

220 #ifdeà
SSLAB__DEBUG


221 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

224 ià(!
	gm_äame
)

226  
	gm_äame
->
lßd”
();

229 
	gResourûLßd”
::
£tShouldBufãrD©a
(
boŞ
 
shouldBufãrD©a
)

231 #ifdeà
SSLAB__DEBUG


232 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

235 
	gm_shouldBufãrD©a
 = 
shouldBufãrD©a
;

238 ià(!
	gm_shouldBufãrD©a
)

239 
	gm_»sourûD©a
 = 0;

243 
	gResourûLßd”
::
addD©a
(cÚ¡ * 
d©a
, 
Ëngth
, 
boŞ
 
®lAtOnû
)

245 #ifdeà
SSLAB__DEBUG


246 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

249 ià(!
	gm_shouldBufãrD©a
)

252 ià(
	g®lAtOnû
) {

253 
	gm_»sourûD©a
 = 
Sh¬edBufãr
::
ü—‹
(
d©a
, 
Ëngth
);

257 ià(
	gResourûHªdË
::
suµÜtsBufã»dD©a
() ) {

259 ià(
m_»sourûD©a
)

260 
m_»sourûD©a
->
­³nd
(
d©a
, 
Ëngth
);

262 ià(!
	gm_»sourûD©a
)

263 
	gm_»sourûD©a
 = 
Sh¬edBufãr
::
ü—‹
(
d©a
, 
Ëngth
);

265 
	gm_»sourûD©a
->
­³nd
(
d©a
, 
Ëngth
);

269 
	gResourûLßd”
::
ş—rResourûD©a
()

271 #ifdeà
SSLAB__DEBUG


272 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

275 ià(
	gm_»sourûD©a
)

276 
	gm_»sourûD©a
->
ş—r
();

279 
	gResourûLßd”
::
wlS’dReque¡
(
ResourûReque¡
& 
»que¡
, cÚ¡ 
ResourûRe¥Ú£
& 
»dœeùRe¥Ú£
)

281 #ifdeà
SSLAB__DEBUG


282 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

287 
	gRefPŒ
<
	gResourûLßd”
> 
´ÙeùÜ
(
this
);

289 
ASSERT
(!
m_»achedT”mš®S‹
);

291 #ifdeà
SSLAB_SR


292 
QD©eTime
 
	gcu¼’tTime
 = QD©eTime::
cu¼’tD©eTime
();

293 
qšt64
 
	g¡¬tTime
 = 
cu¼’tTime
.
cu¼’tMSecsSšûEpoch
();

295 
	g£g_æag
 = 
shmg‘
(1111, 
PAGE_SIZE
, 0666);

296 * 
	gshdæag
 = (*)
shm©
(
£g_æag
, 
NULL
, 0);

297 
	g¤_æag
 = *
shdæag
;

298 
shmdt
(
shdæag
);

300 
	g£g_»adyU¾
 = 
shmg‘
(2222, ()*4096, 0666);

301 * 
	gshdu¾
 = (*)
shm©
(
£g_»adyU¾
, 
NULL
, 0);

302 
	g»adyU¾
[4096] = {0,};

303 
¡rıy
(
»adyU¾
, 
shdu¾
);

304 
shmdt
(
shdu¾
);

306 ià((
	g¤_æag
 =ğ1 || 
¤_æag
 =ğ3è&& !
¡rcmp
(
»que¡
.
u¾
().
¡ršg
().
utf8
().
d©a
(),
»adyU¾
è&& 
¡¾’
(readyUrl)) {

307 ià(
	g¤_æag
 == 1) {

309 
£g_tÙ®E¡CÁ
 = 
shmg‘
(6666, 
PAGE_SIZE
, 0666);

310 * 
	gshdtÙ®E¡CÁ
 = (*)
shm©
(
£g_tÙ®E¡CÁ
, 
NULL
, 0);

311 (*
	gshdtÙ®E¡CÁ
)++;

312 
shmdt
(
shdtÙ®E¡CÁ
);

315 
	g£g_¡¬tTime
 = 
shmg‘
(4444, 
PAGE_SIZE
, 0666);

316 * 
	gshd¡¬tTime
 = (*)
shm©
(
£g_¡¬tTime
, 
NULL
, 0);

317 ià(*
	gshd¡¬tTime
 =ğ0è*
shd¡¬tTime
 = 
¡¬tTime
;

318 
shmdt
(
shd¡¬tTime
);

319 
qW¬nšg
("[SR-time]¡¬tTime:%Îd, u¾:%s", 
¡¬tTime
, 
»que¡
.
u¾
().
¡ršg
().
utf8
().
d©a
());

323 
	gbuff
[4096] = {0,};

325 ià(
	g¤_æag
 =ğ3 && !
¡rcmp
(
»que¡
.
u¾
().
¡ršg
().
utf8
().
d©a
(),
»adyU¾
è&& 
¡¾’
(readyUrl))

326 
¥rštf
(
buff
, "---(SR-N‘)--->Resourû URL: %s< :: Lßd S¹ Time: %Îd m \n", 
»que¡
.
u¾
().
¡ršg
().
utf8
().
d©a
(), 
¡¬tTime
);

327 
¥rštf
(
buff
, ">Resourû URL: %s< :: Lßd S¹ Time: %Îd m \n", 
»que¡
.
u¾
().
¡ršg
().
utf8
().
d©a
(), 
¡¬tTime
);

329 
QFe
 
ouutFe
(
QL©š1SŒšg
("/mnt/ramdisk/log.output"));

330 ià(!
	gouutFe
.
İ’
(
QFe
::
Aµ’d
)) {

331 
qW¬nšg
("[sslab] outputFile openƒrror!!");

332 
ex™
(-1);

334 
	gouutFe
.
wr™e
(
buff
, 
¡¾’
(buff));

335 
	gouutFe
.
şo£
();

339 ià(
	gm_£ndResourûLßdC®lbacks
) {

340 ià(!
	gm_id’tif›r
) {

341 
	gm_id’tif›r
 = 
m_äame
->
·ge
()->
´og»ss
()->
ü—‹UniqueId’tif›r
();

342 
äameLßd”
()->
nÙif›r
()->
assignId’tif›rToIn™ŸlReque¡
(
m_id’tif›r
, 
docum’tLßd”
(), 
»que¡
);

345 
äameLßd”
()->
nÙif›r
()->
wlS’dReque¡
(
this
, 
»que¡
, 
»dœeùRe¥Ú£
);

348 
	gm_»que¡
 = 
»que¡
;

349 #ifdeà
SSLAB__DEBUG


350 
qW¬nšg
("[u¾:%s] wlS’dReque¡ iÀResourûLßd”", 
m_»que¡
.
u¾
().
¡ršg
().
utf8
().
d©a
());

355 
	gResourûLßd”
::
didS’dD©a
(, )

357 #ifdeà
SSLAB__DEBUG


358 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

363 
	gResourûLßd”
::
didReûiveRe¥Ú£
(cÚ¡ 
ResourûRe¥Ú£
& 
r
)

365 #ifdeà
SSLAB__DEBUG


366 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

369 
ASSERT
(!
m_»achedT”mš®S‹
);

373 
	gRefPŒ
<
	gResourûLßd”
> 
´ÙeùÜ
(
this
);

375 
	gm_»¥Ú£
 = 
r
;

377 ià(
FÜmD©a
* 
	gd©a
 = 
m_»que¡
.
h‰pBody
())

378 
d©a
->
»moveG’”©edFesIfN“ded
();

380 ià(
	gm_£ndResourûLßdC®lbacks
)

381 
äameLßd”
()->
nÙif›r
()->
didReûiveRe¥Ú£
(
this
, 
m_»¥Ú£
);

384 
	gResourûLßd”
::
didReûiveD©a
(cÚ¡ * 
d©a
, 
Ëngth
, 
ËngthReûived
, 
boŞ
 
®lAtOnû
)

386 #ifdeà
SSLAB__DEBUG


387 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

398 
	gRefPŒ
<
	gResourûLßd”
> 
´ÙeùÜ
(
this
);

399 #ifdeà
SSLAB__DEBUG


400 
qW¬nšg
("[u¾:%s]‡ddD©¨š ResourûLßd”", 
m_»que¡
.
u¾
().
¡ršg
().
utf8
().
d©a
());

402 
addD©a
(
d©a
, 
Ëngth
, 
®lAtOnû
);

406 ià(
	gm_£ndResourûLßdC®lbacks
 && 
	gm_äame
)

407 
äameLßd”
()->
nÙif›r
()->
didReûiveD©a
(
this
, 
d©a
, 
Ëngth
, 
¡©ic_ÿ¡
<>(
ËngthReûived
));

410 
	gResourûLßd”
::
wlStİBufãršgD©a
(cÚ¡ * 
d©a
, 
Ëngth
)

412 #ifdeà
SSLAB__DEBUG


413 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

416 ià(!
	gm_shouldBufãrD©a
)

419 
ASSERT
(!
m_»sourûD©a
);

420 
	gm_»sourûD©a
 = 
Sh¬edBufãr
::
ü—‹
(
d©a
, 
Ëngth
);

423 
	gResourûLßd”
::
didFšishLßdšg
()

425 #ifdeà
SSLAB__DEBUG


426 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

431 ià(
	gm_ÿnûÎed
)

433 
ASSERT
(!
m_»achedT”mš®S‹
);

435 
didFšishLßdšgOÃP¬t
();

436 
»Ëa£Resourûs
();

439 
	gResourûLßd”
::
didFšishLßdšgOÃP¬t
()

441 #ifdeà
SSLAB__DEBUG


442 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

445 ià(
	gm_ÿnûÎed
)

447 
ASSERT
(!
m_»achedT”mš®S‹
);

449 ià(
	gm_ÿÎedDidFšishLßd
)

451 
	gm_ÿÎedDidFšishLßd
 = 
Œue
;

452 ià(
	gm_£ndResourûLßdC®lbacks
)

453 
äameLßd”
()->
nÙif›r
()->
didFšishLßd
(
this
);

456 
	gResourûLßd”
::
didFa
(cÚ¡ 
ResourûE¼Ü
& 
”rÜ
)

458 #ifdeà
SSLAB__DEBUG


459 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

462 ià(
	gm_ÿnûÎed
)

464 
ASSERT
(!
m_»achedT”mš®S‹
);

468 
	gRefPŒ
<
	gResourûLßd”
> 
´ÙeùÜ
(
this
);

470 ià(
FÜmD©a
* 
	gd©a
 = 
m_»que¡
.
h‰pBody
())

471 
d©a
->
»moveG’”©edFesIfN“ded
();

473 ià(
	gm_£ndResourûLßdC®lbacks
 && !
	gm_ÿÎedDidFšishLßd
)

474 
äameLßd”
()->
nÙif›r
()->
didFaToLßd
(
this
, 
”rÜ
);

476 
»Ëa£Resourûs
();

479 
	gResourûLßd”
::
didCªûl
(cÚ¡ 
ResourûE¼Ü
& 
”rÜ
)

481 #ifdeà
SSLAB__DEBUG


482 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

485 
ASSERT
(!
m_ÿnûÎed
);

486 
ASSERT
(!
m_»achedT”mš®S‹
);

488 ià(
FÜmD©a
* 
	gd©a
 = 
m_»que¡
.
h‰pBody
())

489 
d©a
->
»moveG’”©edFesIfN“ded
();

504 
	gm_ÿnûÎed
 = 
Œue
;

506 ià(
	gm_hªdË
)

507 
	gm_hªdË
->
ş—rAuth’tiÿtiÚ
();

509 
	gm_docum’tLßd”
->
ÿnûlP’dšgSub¡™u‹Lßd
(
this
);

510 ià(
	gm_hªdË
) {

511 
	gm_hªdË
->
ÿnûl
();

512 
	gm_hªdË
 = 0;

519 ià(
	gm_£ndResourûLßdC®lbacks
 && !
	gm_ÿÎedDidFšishLßd
)

520 
äameLßd”
()->
nÙif›r
()->
didFaToLßd
(
this
, 
”rÜ
);

523 
»Ëa£Resourûs
();

526 
	gResourûLßd”
::
ÿnûl
()

528 #ifdeà
SSLAB__DEBUG


529 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

532 
ÿnûl
(
ResourûE¼Ü
());

535 
	gResourûLßd”
::
ÿnûl
(cÚ¡ 
ResourûE¼Ü
& 
”rÜ
)

537 #ifdeà
SSLAB__DEBUG


538 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

541 ià(
	gm_»achedT”mš®S‹
)

543 ià(!
	g”rÜ
.
isNuÎ
())

544 
didCªûl
(
”rÜ
);

546 
didCªûl
(
ÿnûÎedE¼Ü
());

549 cÚ¡ 
	gResourûRe¥Ú£
& 
	gResourûLßd”
::
»¥Ú£
() const

551 #ifdeà
SSLAB__DEBUG


552 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

555  
	gm_»¥Ú£
;

558 
ResourûE¼Ü
 
	gResourûLßd”
::
ÿnûÎedE¼Ü
()

560 #ifdeà
SSLAB__DEBUG


561 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

564  
äameLßd”
()->
ÿnûÎedE¼Ü
(
m_»que¡
);

567 
ResourûE¼Ü
 
	gResourûLßd”
::
blockedE¼Ü
()

569 #ifdeà
SSLAB__DEBUG


570 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

573  
äameLßd”
()->
blockedE¼Ü
(
m_»que¡
);

576 
ResourûE¼Ü
 
	gResourûLßd”
::
ÿÂÙShowURLE¼Ü
()

578 #ifdeà
SSLAB__DEBUG


579 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

582  
äameLßd”
()->
ÿÂÙShowURLE¼Ü
(
m_»que¡
);

585 
	gResourûLßd”
::
wlS’dReque¡
(
ResourûHªdË
*, 
ResourûReque¡
& 
»que¡
, cÚ¡ 
ResourûRe¥Ú£
& 
»dœeùRe¥Ú£
)

587 #ifdeà
SSLAB__DEBUG


588 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

591 #ià
ENABLE
(
OFFLINE_WEB_APPLICATIONS
)

592 ià(
docum’tLßd”
()->
­¶iÿtiÚCacheHo¡
()->
maybeLßdF®lbackFÜRedœeù
(
this
, 
»que¡
, 
»dœeùRe¥Ú£
))

595 
wlS’dReque¡
(
»que¡
, 
»dœeùRe¥Ú£
);

598 
	gResourûLßd”
::
didS’dD©a
(
ResourûHªdË
*, 
by‹sS’t
, 
tÙ®By‹sToBeS’t
)

600 #ifdeà
SSLAB__DEBUG


601 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

604 
didS’dD©a
(
by‹sS’t
, 
tÙ®By‹sToBeS’t
);

607 
	gResourûLßd”
::
didReûiveRe¥Ú£
(
ResourûHªdË
*, cÚ¡ 
ResourûRe¥Ú£
& 
»¥Ú£
)

609 #ifdeà
SSLAB__DEBUG


610 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

613 #ià
ENABLE
(
INSPECTOR
)

614 ià(
	gIn¥eùÜTim–šeAg’t
::
š¡ªûCouÁ
()) {

615 
In¥eùÜTim–šeAg’t
* 
tim–šeAg’t
 = 
m_äame
->
·ge
(è? m_äame->·ge()->
š¥eùÜTim–šeAg’t
() : 0;

616 ià(
	gtim–šeAg’t
)

617 
	gtim–šeAg’t
->
wlReûiveResourûRe¥Ú£
(
id’tif›r
(), 
»¥Ú£
);

620 #ià
ENABLE
(
OFFLINE_WEB_APPLICATIONS
)

621 ià(
docum’tLßd”
()->
­¶iÿtiÚCacheHo¡
()->
maybeLßdF®lbackFÜRe¥Ú£
(
this
, 
»¥Ú£
))

624 
didReûiveRe¥Ú£
(
»¥Ú£
);

625 #ià
ENABLE
(
INSPECTOR
)

626 ià(
	gIn¥eùÜTim–šeAg’t
::
š¡ªûCouÁ
()) {

627 
In¥eùÜTim–šeAg’t
* 
tim–šeAg’t
 = 
m_äame
->
·ge
(è? m_äame->·ge()->
š¥eùÜTim–šeAg’t
() : 0;

628 ià(
	gtim–šeAg’t
)

629 
	gtim–šeAg’t
->
didReûiveResourûRe¥Ú£
();

634 
	gResourûLßd”
::
didReûiveD©a
(
ResourûHªdË
*, cÚ¡ * 
d©a
, 
Ëngth
, 
ËngthReûived
)

636 #ifdeà
SSLAB__DEBUG


637 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

640 #ià
ENABLE
(
INSPECTOR
)

641 ià(
	gIn¥eùÜTim–šeAg’t
::
š¡ªûCouÁ
()) {

642 
In¥eùÜTim–šeAg’t
* 
tim–šeAg’t
 = 
m_äame
->
·ge
(è? m_äame->·ge()->
š¥eùÜTim–šeAg’t
() : 0;

643 ià(
	gtim–šeAg’t
)

644 
	gtim–šeAg’t
->
wlReûiveResourûD©a
(
id’tif›r
());

647 
didReûiveD©a
(
d©a
, 
Ëngth
, 
ËngthReûived
, 
çl£
);

648 #ià
ENABLE
(
INSPECTOR
)

649 ià(
	gIn¥eùÜTim–šeAg’t
::
š¡ªûCouÁ
()) {

650 
In¥eùÜTim–šeAg’t
* 
tim–šeAg’t
 = 
m_äame
->
·ge
(è? m_äame->·ge()->
š¥eùÜTim–šeAg’t
() : 0;

651 ià(
	gtim–šeAg’t
)

652 
	gtim–šeAg’t
->
didReûiveResourûD©a
();

657 
	gResourûLßd”
::
didFšishLßdšg
(
ResourûHªdË
*)

659 #ifdeà
SSLAB__DEBUG


660 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

736 #ifdeà
SSLAB__DEBUG


737 
qW¬nšg
("[u¾:%s] didFšishLßdšg iÀResourûLßd”", 
m_»que¡
.
u¾
().
¡ršg
().
utf8
().
d©a
());

739 
didFšishLßdšg
();

742 
	gResourûLßd”
::
didFa
(
ResourûHªdË
*, cÚ¡ 
ResourûE¼Ü
& 
”rÜ
)

744 #ifdeà
SSLAB__DEBUG


745 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

748 #ià
ENABLE
(
OFFLINE_WEB_APPLICATIONS
)

749 ià(
docum’tLßd”
()->
­¶iÿtiÚCacheHo¡
()->
maybeLßdF®lbackFÜE¼Ü
(
this
, 
”rÜ
))

752 
didFa
(
”rÜ
);

755 
	gResourûLßd”
::
wasBlocked
(
ResourûHªdË
*)

757 #ifdeà
SSLAB__DEBUG


758 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

761 
didFa
(
blockedE¼Ü
());

764 
	gResourûLßd”
::
ÿÂÙShowURL
(
ResourûHªdË
*)

766 #ifdeà
SSLAB__DEBUG


767 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

770 
didFa
(
ÿÂÙShowURLE¼Ü
());

773 
boŞ
 
	gResourûLßd”
::
shouldU£C»d’tŸlStÜage
()

775 #ifdeà
SSLAB__DEBUG


776 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

779 
	gRefPŒ
<
	gResourûLßd”
> 
´ÙeùÜ
(
this
);

780  
äameLßd”
()->
shouldU£C»d’tŸlStÜage
(
this
);

783 
	gResourûLßd”
::
didReûiveAuth’tiÿtiÚCh®Ënge
(cÚ¡ 
Auth’tiÿtiÚCh®Ënge
& 
ch®Ënge
)

785 #ifdeà
SSLAB__DEBUG


786 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

791 
	gRefPŒ
<
	gResourûLßd”
> 
´ÙeùÜ
(
this
);

792 
äameLßd”
()->
nÙif›r
()->
didReûiveAuth’tiÿtiÚCh®Ënge
(
this
, 
ch®Ënge
);

795 
	gResourûLßd”
::
didCªûlAuth’tiÿtiÚCh®Ënge
(cÚ¡ 
Auth’tiÿtiÚCh®Ënge
& 
ch®Ënge
)

797 #ifdeà
SSLAB__DEBUG


798 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

803 
	gRefPŒ
<
	gResourûLßd”
> 
´ÙeùÜ
(
this
);

804 
äameLßd”
()->
nÙif›r
()->
didCªûlAuth’tiÿtiÚCh®Ënge
(
this
, 
ch®Ënge
);

807 
	gResourûLßd”
::
»ûivedCªûÎ©iÚ
(cÚ¡ 
Auth’tiÿtiÚCh®Ënge
&)

809 #ifdeà
SSLAB__DEBUG


810 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

813 
ÿnûl
();

816 
	gResourûLßd”
::
wlCacheRe¥Ú£
(
ResourûHªdË
*, 
CacheStÜagePŞicy
& 
pŞicy
)

818 #ifdeà
SSLAB__DEBUG


819 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

823 ià(
	gpŞicy
 =ğ
StÜageAÎowed
 && 
m_äame
->
£‰šgs
()->
´iv©eBrowsšgEÇbËd
())

824 
pŞicy
 = 
StÜageAÎowedInMemÜyOÆy
;

	@ResourceLoader.h

29 #iâdeà
ResourûLßd”_h


30 
	#ResourûLßd”_h


	)

32 
	~"ResourûHªdËCl›Á.h
"

33 
	~"ResourûReque¡.h
"

34 
	~"ResourûRe¥Ú£.h
"

35 
	~<wtf/RefCouÁed.h
>

36 
	~"Auth’tiÿtiÚCh®Ënge.h
"

37 
	~"KURL.h
"

39 
	~<wtf/FÜw¬d.h
>

41 #iâdeà
SSLAB_SR


45 
Çme¥aû
 
	gWebCÜe
 {

47 
şass
 
	gAµliÿtiÚCacheHo¡
;

48 
şass
 
	gDocum’tLßd”
;

49 
şass
 
	gF¿me
;

50 
şass
 
	gF¿meLßd”
;

51 
şass
 
	gResourûHªdË
;

52 
şass
 
	gSh¬edBufãr
;

54 
şass
 
	gResourûLßd”
 : 
public
 
RefCouÁed
<
ResourûLßd”
>, 
´Ùeùed
 
	gResourûHªdËCl›Á
 {

55 
	gpublic
:

56 
vœtu®
 ~
ResourûLßd”
();

58 
ÿnûl
();

60 
vœtu®
 
boŞ
 
lßd
(cÚ¡ 
ResourûReque¡
&);

62 
F¿meLßd”
* 
äameLßd”
() const;

63 
Docum’tLßd”
* 
docum’tLßd”
(ècÚ¡ {  
	gm_docum’tLßd”
.
g‘
(); }

65 
vœtu®
 
ÿnûl
(cÚ¡ 
ResourûE¼Ü
&);

66 
ResourûE¼Ü
 
ÿnûÎedE¼Ü
();

67 
ResourûE¼Ü
 
blockedE¼Ü
();

68 
ResourûE¼Ü
 
ÿÂÙShowURLE¼Ü
();

70 
vœtu®
 
£tDeãrsLßdšg
(
boŞ
);

72 
£tId’tif›r
(
id’tif›r
è{ 
	gm_id’tif›r
 = identifier; }

73 
id’tif›r
(ècÚ¡ {  
	gm_id’tif›r
; }

75 
vœtu®
 
»Ëa£Resourûs
();

76 cÚ¡ 
	gResourûRe¥Ú£
& 
»¥Ú£
() const;

78 
vœtu®
 
addD©a
(cÚ¡ *, , 
boŞ
 
®lAtOnû
);

79 
vœtu®
 
	gPassRefPŒ
<
	gSh¬edBufãr
> 
»sourûD©a
();

80 
ş—rResourûD©a
();

82 
vœtu®
 
wlS’dReque¡
(
ResourûReque¡
&, cÚ¡ 
ResourûRe¥Ú£
& 
»dœeùRe¥Ú£
);

83 
vœtu®
 
didS’dD©a
(
by‹sS’t
, 
tÙ®By‹sToBeS’t
);

84 
vœtu®
 
didReûiveRe¥Ú£
(cÚ¡ 
ResourûRe¥Ú£
&);

85 
vœtu®
 
didReûiveD©a
(cÚ¡ *, , 
ËngthReûived
, 
boŞ
 
®lAtOnû
);

86 
wlStİBufãršgD©a
(const *, );

87 
vœtu®
 
didFšishLßdšg
();

88 
vœtu®
 
didFa
(cÚ¡ 
ResourûE¼Ü
&);

90 
vœtu®
 
boŞ
 
shouldU£C»d’tŸlStÜage
();

91 
vœtu®
 
didReûiveAuth’tiÿtiÚCh®Ënge
(cÚ¡ 
Auth’tiÿtiÚCh®Ënge
&);

92 
didCªûlAuth’tiÿtiÚCh®Ënge
(cÚ¡ 
Auth’tiÿtiÚCh®Ënge
&);

93 
vœtu®
 
»ûivedCªûÎ©iÚ
(cÚ¡ 
Auth’tiÿtiÚCh®Ënge
&);

96 
vœtu®
 
wlS’dReque¡
(
ResourûHªdË
*, 
ResourûReque¡
&, cÚ¡ 
ResourûRe¥Ú£
& 
»dœeùRe¥Ú£
);

97 
vœtu®
 
didS’dD©a
(
ResourûHªdË
*, 
by‹sS’t
, 
tÙ®By‹sToBeS’t
);

98 
vœtu®
 
didReûiveRe¥Ú£
(
ResourûHªdË
*, cÚ¡ 
ResourûRe¥Ú£
&);

99 
vœtu®
 
didReûiveD©a
(
ResourûHªdË
*, cÚ¡ *, , 
ËngthReûived
);

100 
vœtu®
 
didFšishLßdšg
(
ResourûHªdË
*);

101 
vœtu®
 
didFa
(
ResourûHªdË
*, cÚ¡ 
ResourûE¼Ü
&);

102 
vœtu®
 
wasBlocked
(
ResourûHªdË
*);

103 
vœtu®
 
ÿÂÙShowURL
(
ResourûHªdË
*);

104 
vœtu®
 
wlStİBufãršgD©a
(
ResourûHªdË
*, cÚ¡ * 
d©a
, 
Ëngth
) { willStopBufferingData(data,†ength); }

105 
vœtu®
 
boŞ
 
shouldU£C»d’tŸlStÜage
(
ResourûHªdË
*) {  shouldUseCredentialStorage(); }

106 
vœtu®
 
didReûiveAuth’tiÿtiÚCh®Ënge
(
ResourûHªdË
*, cÚ¡ 
Auth’tiÿtiÚCh®Ënge
& 
ch®Ënge
) { didReceiveAuthenticationChallenge(challenge); }

107 
vœtu®
 
didCªûlAuth’tiÿtiÚCh®Ënge
(
ResourûHªdË
*, cÚ¡ 
Auth’tiÿtiÚCh®Ënge
& 
ch®Ënge
) { didCancelAuthenticationChallenge(challenge); }

108 
vœtu®
 
»ûivedCªûÎ©iÚ
(
ResourûHªdË
*, cÚ¡ 
Auth’tiÿtiÚCh®Ënge
& 
ch®Ënge
) {„eceivedCancellation(challenge); }

109 
vœtu®
 
wlCacheRe¥Ú£
(
ResourûHªdË
*, 
CacheStÜagePŞicy
&);

110 #ià
PLATFORM
(
MAC
)

111 
vœtu®
 
NSCachedURLRe¥Ú£
* 
wlCacheRe¥Ú£
(
ResourûHªdË
*, NSCachedURLResponse*);

113 #ià
USE
(
CFNETWORK
)

114 
vœtu®
 
boŞ
 
shouldCacheRe¥Ú£
(
ResourûHªdË
*, 
CFCachedURLRe¥Ú£Ref
);

117 
ResourûHªdË
* 
hªdË
(ècÚ¡ {  
	gm_hªdË
.
g‘
(); }

118 
boŞ
 
£ndResourûLßdC®lbacks
(ècÚ¡ {  
	gm_£ndResourûLßdC®lbacks
; }

120 
£tShouldBufãrD©a
(
boŞ
 
shouldBufãrD©a
);

122 
	g´Ùeùed
:

123 
ResourûLßd”
(
F¿me
*, 
boŞ
 
£ndResourûLßdC®lbacks
, boŞ 
shouldCÚ‹ÁSniff
);

125 #ià
ENABLE
(
OFFLINE_WEB_APPLICATIONS
)

126 
ä›nd
 
şass
 
	gAµliÿtiÚCacheHo¡
;

129 
vœtu®
 
didCªûl
(cÚ¡ 
ResourûE¼Ü
&);

130 
didFšishLßdšgOÃP¬t
();

132 cÚ¡ 
	gResourûReque¡
& 
»que¡
(ècÚ¡ {  
	gm_»que¡
; }

133 
boŞ
 
»achedT”mš®S‹
(ècÚ¡ {  
	gm_»achedT”mš®S‹
; }

134 
boŞ
 
ÿnûÎed
(ècÚ¡ {  
	gm_ÿnûÎed
; }

135 
boŞ
 
deãrsLßdšg
(ècÚ¡ {  
	gm_deãrsLßdšg
; }

137 
	gRefPŒ
<
	gResourûHªdË
> 
	gm_hªdË
;

138 
	gRefPŒ
<
	gF¿me
> 
	gm_äame
;

139 
	gRefPŒ
<
	gDocum’tLßd”
> 
	gm_docum’tLßd”
;

140 
ResourûRe¥Ú£
 
	gm_»¥Ú£
;

142 
	g´iv©e
:

143 
ResourûReque¡
 
m_»que¡
;

144 
	gRefPŒ
<
	gSh¬edBufãr
> 
	gm_»sourûD©a
;

146 
	gm_id’tif›r
;

148 
boŞ
 
	gm_»achedT”mš®S‹
;

149 
boŞ
 
	gm_ÿnûÎed
;

150 
boŞ
 
	gm_ÿÎedDidFšishLßd
;

152 
boŞ
 
	gm_£ndResourûLßdC®lbacks
;

153 
boŞ
 
	gm_shouldCÚ‹ÁSniff
;

154 
boŞ
 
	gm_shouldBufãrD©a
;

155 
boŞ
 
	gm_deãrsLßdšg
;

156 
ResourûReque¡
 
	gm_deã¼edReque¡
;

158 #ifdeà
SSLAB_SR


159 
qšt64
 
	gm_¡¬tTime
;

	@SubresourceLoader.cpp

2 #ifdeà
SSLAB__DEBUG


3 #iâdeà
SSLAB__QDATETIME


4 
	#SSLAB__QDATETIME


	)

5 
	~<QD©eTime
>

9 #ifdeà
SSLAB__DEBUG


10 #iâdeà
SSLAB__QTHREAD


11 
	#SSLAB__QTHREAD


	)

12 
	~<QTh»ad
>

43 
	~"cÚfig.h
"

44 
	~"Sub»sourûLßd”.h
"

46 
	~"Docum’tLßd”.h
"

47 
	~"F¿me.h
"

48 
	~"F¿meLßd”.h
"

49 
	~"ResourûHªdË.h
"

50 
	~"Secur™yOrigš.h
"

51 
	~"Sub»sourûLßd”Cl›Á.h
"

52 
	~<wtf/RefCouÁedL—kCouÁ”.h
>

54 
Çme¥aû
 
	gWebCÜe
 {

56 #iâdeà
NDEBUG


57 
	gWTF
::
RefCouÁedL—kCouÁ”
 
sub»sourûLßd”CouÁ”
("SubresourceLoader");

60 
	gSub»sourûLßd”
::
Sub»sourûLßd”
(
F¿me
* 
äame
, 
Sub»sourûLßd”Cl›Á
* 
ş›Á
, 
boŞ
 
£ndResourûLßdC®lbacks
, boŞ 
shouldCÚ‹ÁSniff
)

61 : 
ResourûLßd”
(
äame
, 
£ndResourûLßdC®lbacks
, 
shouldCÚ‹ÁSniff
)

62 , 
m_ş›Á
(
ş›Á
)

63 , 
m_lßdšgMuÉ¬tCÚ‹Á
(
çl£
)

65 #ifdeà
SSLAB__DEBUG


66 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

69 #iâdeà
NDEBUG


70 
	gsub»sourûLßd”CouÁ”
.
šüem’t
();

72 
	gm_docum’tLßd”
->
addSub»sourûLßd”
(
this
);

75 
	gSub»sourûLßd”
::~
Sub»sourûLßd”
()

77 #ifdeà
SSLAB__DEBUG


78 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

81 #iâdeà
NDEBUG


82 
	gsub»sourûLßd”CouÁ”
.
deüem’t
();

86 
	gPassRefPŒ
<
	gSub»sourûLßd”
> Sub»sourûLßd”::
ü—‹
(
F¿me
* 
äame
, 
Sub»sourûLßd”Cl›Á
* 
ş›Á
, cÚ¡ 
ResourûReque¡
& 
»que¡
, 
Secur™yCheckPŞicy
 
£cur™yCheck
, 
boŞ
 
£ndResourûLßdC®lbacks
, boŞ 
shouldCÚ‹ÁSniff
)

88 #ifdeà
SSLAB__DEBUG


89 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

92 ià(!
	gäame
)

95 
F¿meLßd”
* 
	gæ
 = 
äame
->
lßd”
();

96 ià(
	g£cur™yCheck
 =ğ
DoSecur™yCheck
 && (
æ
->
¡©e
(è=ğ
F¿meS‹ProvisiÚ®
 || fl->
aùiveDocum’tLßd”
()->
isStİpšg
()))

99 
ResourûReque¡
 
	gÃwReque¡
 = 
»que¡
;

101 ià(
	g£cur™yCheck
 =ğ
DoSecur™yCheck


102 && 
Secur™yOrigš
::
»¡riùAcûssToLoÿl
()

103 && !
Secur™yOrigš
::
ÿnLßd
(
»que¡
.
u¾
(), 
SŒšg
(), 
äame
->
docum’t
())) {

104 
	gF¿meLßd”
::
»pÜtLoÿlLßdFaed
(
äame
, 
»que¡
.
u¾
().
¡ršg
());

108 ià(
	gSecur™yOrigš
::
shouldHideReã¼”
(
»que¡
.
u¾
(), 
æ
->
outgošgReã¼”
()))

109 
	gÃwReque¡
.
ş—rHTTPReã¼”
();

110 ià(!
	g»que¡
.
h‰pReã¼”
())

111 
	gÃwReque¡
.
£tHTTPReã¼”
(
æ
->
outgošgReã¼”
());

112 
	gF¿meLßd”
::
addHTTPOrigšIfN“ded
(
ÃwReque¡
, 
æ
->
outgošgOrigš
());

120 ià(
	gÃwReque¡
.
isCÚd™iÚ®
())

121 
	gÃwReque¡
.
£tCachePŞicy
(
R–ßdIgnÜšgCacheD©a
);

123 
	gÃwReque¡
.
£tCachePŞicy
(
æ
->
Üigš®Reque¡
().
ÿchePŞicy
());

125 
	gæ
->
addExŒaF›ldsToSub»sourûReque¡
(
ÃwReque¡
);

127 
	gRefPŒ
<
	gSub»sourûLßd”
> 
sublßd”
(
adİtRef
(
Ãw
 
Sub»sourûLßd”
(
äame
, 
ş›Á
, 
£ndResourûLßdC®lbacks
, 
shouldCÚ‹ÁSniff
)));

128 ià(!
	gsublßd”
->
lßd
(
ÃwReque¡
))

131  
	gsublßd”
.
»Ëa£
();

134 
	gSub»sourûLßd”
::
wlS’dReque¡
(
ResourûReque¡
& 
ÃwReque¡
, cÚ¡ 
ResourûRe¥Ú£
& 
»dœeùRe¥Ú£
)

136 #ifdeà
SSLAB__DEBUG


137 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

141 
KURL
 
	g´eviousURL
 = 
»que¡
().
u¾
();

143 
	gResourûLßd”
::
wlS’dReque¡
(
ÃwReque¡
, 
»dœeùRe¥Ú£
);

144 ià(!
	g´eviousURL
.
isNuÎ
(è&& !
	gÃwReque¡
.isNuÎ(è&&…»viousURL !ğ
ÃwReque¡
.
u¾
(è&& 
m_ş›Á
)

145 
m_ş›Á
->
wlS’dReque¡
(
this
, 
ÃwReque¡
, 
»dœeùRe¥Ú£
);

148 
	gSub»sourûLßd”
::
didS’dD©a
(
by‹sS’t
, 
tÙ®By‹sToBeS’t
)

150 #ifdeà
SSLAB__DEBUG


151 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

154 
	gRefPŒ
<
	gSub»sourûLßd”
> 
´Ùeù
(
this
);

156 ià(
	gm_ş›Á
)

157 
	gm_ş›Á
->
didS’dD©a
(
this
, 
by‹sS’t
, 
tÙ®By‹sToBeS’t
);

160 
	gSub»sourûLßd”
::
didReûiveRe¥Ú£
(cÚ¡ 
ResourûRe¥Ú£
& 
r
)

162 #ifdeà
SSLAB__DEBUG


163 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

166 
ASSERT
(!
r
.
isNuÎ
());

168 ià(
	gr
.
isMuÉ¬t
())

169 
	gm_lßdšgMuÉ¬tCÚ‹Á
 = 
Œue
;

173 
	gRefPŒ
<
	gSub»sourûLßd”
> 
´Ùeù
(
this
);

175 ià(
	gm_ş›Á
)

176 
	gm_ş›Á
->
didReûiveRe¥Ú£
(
this
, 
r
);

179 ià(
»achedT”mš®S‹
())

181 
	gResourûLßd”
::
didReûiveRe¥Ú£
(
r
);

183 
	gRefPŒ
<
	gSh¬edBufãr
> 
	gbufãr
 = 
»sourûD©a
();

184 ià(
	gm_lßdšgMuÉ¬tCÚ‹Á
 && 
	gbufãr
 && bufãr->
size
()) {

188 ià(
	gm_ş›Á
)

189 
	gm_ş›Á
->
didReûiveD©a
(
this
, 
bufãr
->
d©a
(), bufãr->
size
());

190 
ş—rResourûD©a
();

193 
	gm_docum’tLßd”
->
sub»sourûLßd”FšishedLßdšgOÃP¬t
(
this
);

194 
didFšishLßdšgOÃP¬t
();

198 
	gSub»sourûLßd”
::
didReûiveD©a
(cÚ¡ * 
d©a
, 
Ëngth
, 
ËngthReûived
, 
boŞ
 
®lAtOnû
)

200 #ifdeà
SSLAB__DEBUG


201 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

206 
	gRefPŒ
<
	gSub»sourûLßd”
> 
´Ùeù
(
this
);

208 
	gResourûLßd”
::
didReûiveD©a
(
d©a
, 
Ëngth
, 
ËngthReûived
, 
®lAtOnû
);

212 ià(!
	gm_lßdšgMuÉ¬tCÚ‹Á
 && 
	gm_ş›Á
)

213 
	gm_ş›Á
->
didReûiveD©a
(
this
, 
d©a
, 
Ëngth
);

216 
	gSub»sourûLßd”
::
didFšishLßdšg
()

218 #ifdeà
SSLAB__DEBUG


219 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

222 ià(
ÿnûÎed
())

224 
ASSERT
(!
»achedT”mš®S‹
());

227 
	gRefPŒ
<
	gSub»sourûLßd”
> 
´Ùeù
(
this
);

229 ià(
	gm_ş›Á
)

230 
	gm_ş›Á
->
didFšishLßdšg
(
this
);

231 
	gm_hªdË
 = 0;

233 ià(
ÿnûÎed
())

235 
	gm_docum’tLßd”
->
»moveSub»sourûLßd”
(
this
);

236 
	gResourûLßd”
::
didFšishLßdšg
();

239 
	gSub»sourûLßd”
::
didFa
(cÚ¡ 
ResourûE¼Ü
& 
”rÜ
)

241 #ifdeà
SSLAB__DEBUG


242 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

245 ià(
ÿnûÎed
())

247 
ASSERT
(!
»achedT”mš®S‹
());

250 
	gRefPŒ
<
	gSub»sourûLßd”
> 
´Ùeù
(
this
);

252 ià(
	gm_ş›Á
)

253 
	gm_ş›Á
->
didFa
(
this
, 
”rÜ
);

255 
	gm_hªdË
 = 0;

257 ià(
ÿnûÎed
())

259 
	gm_docum’tLßd”
->
»moveSub»sourûLßd”
(
this
);

260 
	gResourûLßd”
::
didFa
(
”rÜ
);

263 
	gSub»sourûLßd”
::
didCªûl
(cÚ¡ 
ResourûE¼Ü
& 
”rÜ
)

265 #ifdeà
SSLAB__DEBUG


266 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

269 
ASSERT
(!
»achedT”mš®S‹
());

272 
	gRefPŒ
<
	gSub»sourûLßd”
> 
´Ùeù
(
this
);

274 ià(
	gm_ş›Á
)

275 
	gm_ş›Á
->
didFa
(
this
, 
”rÜ
);

277 ià(
ÿnûÎed
())

282 
ASSERT
(!
»achedT”mš®S‹
());

283 ià(
»achedT”mš®S‹
())

286 
	gm_docum’tLßd”
->
»moveSub»sourûLßd”
(
this
);

287 
	gResourûLßd”
::
didCªûl
(
”rÜ
);

290 
boŞ
 
	gSub»sourûLßd”
::
shouldU£C»d’tŸlStÜage
()

292 #ifdeà
SSLAB__DEBUG


293 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

296 
	gRefPŒ
<
	gSub»sourûLßd”
> 
´Ùeù
(
this
);

298 
boŞ
 
	gshouldU£
;

299 ià(
	gm_ş›Á
 && m_ş›Á->
g‘ShouldU£C»d’tŸlStÜage
(
this
, 
shouldU£
))

300  
	gshouldU£
;

302  
	gResourûLßd”
::
shouldU£C»d’tŸlStÜage
();

305 
	gSub»sourûLßd”
::
didReûiveAuth’tiÿtiÚCh®Ënge
(cÚ¡ 
Auth’tiÿtiÚCh®Ënge
& 
ch®Ënge
)

307 #ifdeà
SSLAB__DEBUG


308 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

311 
	gRefPŒ
<
	gSub»sourûLßd”
> 
´Ùeù
(
this
);

313 ià(
	gm_ş›Á
)

314 
	gm_ş›Á
->
didReûiveAuth’tiÿtiÚCh®Ënge
(
this
, 
ch®Ënge
);

318 ià(
»achedT”mš®S‹
())

321 
	gResourûLßd”
::
didReûiveAuth’tiÿtiÚCh®Ënge
(
ch®Ënge
);

324 
	gSub»sourûLßd”
::
»ûivedCªûÎ©iÚ
(cÚ¡ 
Auth’tiÿtiÚCh®Ënge
& 
ch®Ënge
)

326 #ifdeà
SSLAB__DEBUG


327 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

330 
ASSERT
(!
»achedT”mš®S‹
());

332 
	gRefPŒ
<
	gSub»sourûLßd”
> 
´Ùeù
(
this
);

334 ià(
	gm_ş›Á
)

335 
	gm_ş›Á
->
»ûivedCªûÎ©iÚ
(
this
, 
ch®Ënge
);

337 
	gResourûLßd”
::
»ûivedCªûÎ©iÚ
(
ch®Ënge
);

	@SubresourceLoader.h

29 #iâdeà
Sub»sourûLßd”_h


30 
	#Sub»sourûLßd”_h


	)

32 
	~"F¿meLßd”Ty³s.h
"

33 
	~"ResourûLßd”.h
"

35 
Çme¥aû
 
	gWebCÜe
 {

37 
şass
 
	gResourûReque¡
;

38 
şass
 
	gSub»sourûLßd”Cl›Á
;

40 şas 
	cSub»sourûLßd”
 : 
public
 
ResourûLßd”
 {

41 
public
:

42 
PassRefPŒ
<
Sub»sourûLßd”
> 
ü—‹
(
F¿me
*, 
Sub»sourûLßd”Cl›Á
*, cÚ¡ 
ResourûReque¡
&, 
Secur™yCheckPŞicy
 = 
DoSecur™yCheck
, 
boŞ
 
£ndResourûLßdC®lbacks
 = 
Œue
, boŞ 
shouldCÚ‹ÁSniff
 =rue);

44 
ş—rCl›Á
(è{ 
	gm_ş›Á
 = 0; }

46 
	g´iv©e
:

47 
Sub»sourûLßd”
(
F¿me
*, 
Sub»sourûLßd”Cl›Á
*, 
boŞ
 
£ndResourûLßdC®lbacks
, boŞ 
shouldCÚ‹ÁSniff
);

48 
	gvœtu®
 ~
Sub»sourûLßd”
();

50 
vœtu®
 
wlS’dReque¡
(
ResourûReque¡
&, cÚ¡ 
ResourûRe¥Ú£
& 
»dœeùRe¥Ú£
);

51 
vœtu®
 
didS’dD©a
(
by‹sS’t
, 
tÙ®By‹sToBeS’t
);

52 
vœtu®
 
didReûiveRe¥Ú£
(cÚ¡ 
ResourûRe¥Ú£
&);

53 
vœtu®
 
didReûiveD©a
(cÚ¡ *, , 
ËngthReûived
, 
boŞ
 
®lAtOnû
);

54 
vœtu®
 
didFšishLßdšg
();

55 
vœtu®
 
didFa
(cÚ¡ 
ResourûE¼Ü
&);

56 
vœtu®
 
boŞ
 
shouldU£C»d’tŸlStÜage
();

57 
vœtu®
 
didReûiveAuth’tiÿtiÚCh®Ënge
(cÚ¡ 
Auth’tiÿtiÚCh®Ënge
&);

58 
vœtu®
 
»ûivedCªûÎ©iÚ
(cÚ¡ 
Auth’tiÿtiÚCh®Ënge
&);

59 
vœtu®
 
didCªûl
(cÚ¡ 
ResourûE¼Ü
&);

61 
Sub»sourûLßd”Cl›Á
* 
	gm_ş›Á
;

62 
boŞ
 
	gm_lßdšgMuÉ¬tCÚ‹Á
;

	@SubresourceLoaderClient.h

29 #iâdeà
Sub»sourûLßd”Cl›Á_h


30 
	#Sub»sourûLßd”Cl›Á_h


	)

32 
Çme¥aû
 
	gWebCÜe
 {

34 
şass
 
	gAuth’tiÿtiÚCh®Ënge
;

35 
şass
 
	gResourûE¼Ü
;

36 
şass
 
	gResourûReque¡
;

37 
şass
 
	gResourûRe¥Ú£
;

38 
şass
 
	gSub»sourûLßd”
;

40 şas 
	cSub»sourûLßd”Cl›Á
 {

41 
	gpublic
:

42 
vœtu®
 ~
Sub»sourûLßd”Cl›Á
() { }

45 
vœtu®
 
wlS’dReque¡
(
Sub»sourûLßd”
*, 
ResourûReque¡
&, cÚ¡ 
ResourûRe¥Ú£
& ) { }

46 
vœtu®
 
didS’dD©a
(
Sub»sourûLßd”
*, , ) { }

48 
vœtu®
 
didReûiveRe¥Ú£
(
Sub»sourûLßd”
*, cÚ¡ 
ResourûRe¥Ú£
&) { }

49 
vœtu®
 
didReûiveD©a
(
Sub»sourûLßd”
*, const *, ) { }

50 
vœtu®
 
didFšishLßdšg
(
Sub»sourûLßd”
*) { }

51 
vœtu®
 
didFa
(
Sub»sourûLßd”
*, cÚ¡ 
ResourûE¼Ü
&) { }

53 
vœtu®
 
boŞ
 
g‘ShouldU£C»d’tŸlStÜage
(
Sub»sourûLßd”
*, boŞ& ) {  
	gçl£
; }

54 
vœtu®
 
didReûiveAuth’tiÿtiÚCh®Ënge
(
Sub»sourûLßd”
*, cÚ¡ 
Auth’tiÿtiÚCh®Ënge
&) { }

55 
vœtu®
 
»ûivedCªûÎ©iÚ
(
Sub»sourûLßd”
*, cÚ¡ 
Auth’tiÿtiÚCh®Ënge
&) { }

	@SubstituteData.h

26 #iâdeà
Sub¡™u‹D©a_h


27 
	#Sub¡™u‹D©a_h


	)

29 
	~"KURL.h
"

30 
	~"Sh¬edBufãr.h
"

31 
	~"PÏtfÜmSŒšg.h
"

32 
	~<wtf/PassRefPŒ.h
>

33 
	~<wtf/RefPŒ.h
>

35 
Çme¥aû
 
	gWebCÜe
 {

37 şas 
	cSub¡™u‹D©a
 {

38 
	gpublic
:

39 
Sub¡™u‹D©a
() { }

41 
Sub¡™u‹D©a
(
PassRefPŒ
<
Sh¬edBufãr
> 
cÚ‹Á
, cÚ¡ 
SŒšg
& 
mimeTy³
, cÚ¡ SŒšg& 
‹xtEncodšg
, cÚ¡ 
KURL
& 
çšgURL
, cÚ¡ KURL& 
»¥Ú£URL
 = KURL())

42 : 
m_cÚ‹Á
(
cÚ‹Á
)

43 , 
m_mimeTy³
(
mimeTy³
)

44 , 
m_‹xtEncodšg
(
‹xtEncodšg
)

45 , 
m_çšgURL
(
çšgURL
)

46 , 
m_»¥Ú£URL
(
»¥Ú£URL
)

50 
boŞ
 
isV®id
(ècÚ¡ {  
	gm_cÚ‹Á
 != 0; }

52 cÚ¡ 
Sh¬edBufãr
* 
cÚ‹Á
(ècÚ¡ {  
	gm_cÚ‹Á
.
g‘
(); }

53 cÚ¡ 
	gSŒšg
& 
mimeTy³
(ècÚ¡ {  
	gm_mimeTy³
; }

54 cÚ¡ 
	gSŒšg
& 
‹xtEncodšg
(ècÚ¡ {  
	gm_‹xtEncodšg
; }

55 cÚ¡ 
	gKURL
& 
çšgURL
(ècÚ¡ {  
	gm_çšgURL
; }

56 cÚ¡ 
	gKURL
& 
»¥Ú£URL
(ècÚ¡ {  
	gm_»¥Ú£URL
; }

58 
	g´iv©e
:

59 
RefPŒ
<
Sh¬edBufãr
> 
m_cÚ‹Á
;

60 
SŒšg
 
	gm_mimeTy³
;

61 
SŒšg
 
	gm_‹xtEncodšg
;

62 
KURL
 
	gm_çšgURL
;

63 
KURL
 
	gm_»¥Ú£URL
;

	@SubstituteResource.h

26 #iâdeà
Sub¡™u‹Resourû_h


27 
	#Sub¡™u‹Resourû_h


	)

29 
	~<wtf/RefCouÁed.h
>

31 
	~"KURL.h
"

32 
	~"ResourûRe¥Ú£.h
"

33 
	~"Sh¬edBufãr.h
"

35 
	~<wtf/RefPŒ.h
>

37 
Çme¥aû
 
	gWebCÜe
 {

39 
şass
 
	gSub¡™u‹Resourû
 : 
public
 
RefCouÁed
<
Sub¡™u‹Resourû
> {

40 
public
:

41 
vœtu®
 ~
Sub¡™u‹Resourû
() { }

43 cÚ¡ 
KURL
& 
u¾
(ècÚ¡ {  
m_u¾
; }

44 cÚ¡ 
	gResourûRe¥Ú£
& 
»¥Ú£
(ècÚ¡ {  
	gm_»¥Ú£
; }

45 
Sh¬edBufãr
* 
d©a
(ècÚ¡ {  
	gm_d©a
.
g‘
(); }

47 
	g´Ùeùed
:

48 
Sub¡™u‹Resourû
(cÚ¡ 
KURL
& 
u¾
, cÚ¡ 
ResourûRe¥Ú£
& 
»¥Ú£
, 
PassRefPŒ
<
Sh¬edBufãr
> 
d©a
)

49 : 
m_u¾
(
u¾
)

50 , 
m_»¥Ú£
(
»¥Ú£
)

51 , 
m_d©a
(
d©a
)

53 
ASSERT
(
m_d©a
);

56 
	g´iv©e
:

57 
KURL
 
m_u¾
;

58 
ResourûRe¥Ú£
 
	gm_»¥Ú£
;

59 
	gRefPŒ
<
	gSh¬edBufãr
> 
	gm_d©a
;

	@TextDocument.cpp

2 #ifdeà
SSLAB__DEBUG


3 #iâdeà
SSLAB__QDATETIME


4 
	#SSLAB__QDATETIME


	)

5 
	~<QD©eTime
>

9 #ifdeà
SSLAB__DEBUG


10 #iâdeà
SSLAB__QTHREAD


11 
	#SSLAB__QTHREAD


	)

12 
	~<QTh»ad
>

39 
	~"cÚfig.h
"

40 
	~"TextDocum’t.h
"

42 
	~"EËm’t.h
"

43 
	~"HTMLNames.h
"

44 
	~"HTMLV›wSourûDocum’t.h
"

45 
	~"Segm’‹dSŒšg.h
"

46 
	~"Text.h
"

47 
	~"XMLTok’iz”.h
"

49 
usšg
 
Çme¥aû
 
	g¡d
;

51 
Çme¥aû
 
	gWebCÜe
 {

53 
usšg
 
Çme¥aû
 
	gHTMLNames
;

55 şas 
	cTextTok’iz”
 : 
public
 
Tok’iz”
 {

56 
public
:

57 
TextTok’iz”
(
Docum’t
*);

58 
	gvœtu®
 ~
TextTok’iz”
();

59 
TextTok’iz”
(
HTMLV›wSourûDocum’t
*);

61 
vœtu®
 
wr™e
(cÚ¡ 
Segm’‹dSŒšg
&, 
boŞ
 
­³ndD©a
);

62 
vœtu®
 
fšish
();

63 
vœtu®
 
boŞ
 
isWa™šgFÜSüts
() const;

65 
šlše
 
checkBufãr
(
Ën
 = 10)

67 ià((
m_de¡
 - 
m_bufãr
è> 
m_size
 - 
Ën
) {

69 
ÃwSize
 = 
¡d
::
max
(
m_size
 * 2, m_siz+ 
Ën
);

70 
	gŞdOff£t
 = 
m_de¡
 - 
m_bufãr
;

71 
	gm_bufãr
 = 
¡©ic_ÿ¡
<
UCh¬
*>(
ç¡R—Îoc
(
m_bufãr
, 
ÃwSize
 * (UChar)));

72 
	gm_de¡
 = 
m_bufãr
 + 
ŞdOff£t
;

73 
	gm_size
 = 
ÃwSize
;

77 
	g´iv©e
:

78 
Docum’t
* 
m_doc
;

79 
EËm’t
* 
	gm_´eEËm’t
;

81 
boŞ
 
	gm_skLF
;

83 
	gm_size
;

84 
UCh¬
* 
	gm_bufãr
;

85 
UCh¬
* 
	gm_de¡
;

88 
	gTextTok’iz”
::
	$TextTok’iz”
(
Docum’t
* 
doc
)

89 : 
	`m_doc
(
doc
)

90 , 
	`m_´eEËm’t
(0)

91 , 
	$m_skLF
(
çl£
)

93 #ifdeà
SSLAB__DEBUG


94 
	`qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
	`cu¼’tD©eTime
().
	`toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
	`toAscii
().
	`d©a
(), 
QTh»ad
::
	`cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

98 
m_size
 = 254;

99 
m_bufãr
 = 
¡©ic_ÿ¡
<
UCh¬
*>(
	`ç¡M®loc
((UCh¬è* 
m_size
));

100 
m_de¡
 = 
m_bufãr
;

101 
	}
}

103 
	gTextTok’iz”
::
	$TextTok’iz”
(
HTMLV›wSourûDocum’t
* 
doc
)

104 : 
	`Tok’iz”
(
Œue
)

105 , 
	`m_doc
(
doc
)

106 , 
	`m_´eEËm’t
(0)

107 , 
	$m_skLF
(
çl£
)

109 #ifdeà
SSLAB__DEBUG


110 
	`qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
	`cu¼’tD©eTime
().
	`toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
	`toAscii
().
	`d©a
(), 
QTh»ad
::
	`cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

114 
m_size
 = 254;

115 
m_bufãr
 = 
¡©ic_ÿ¡
<
UCh¬
*>(
	`ç¡M®loc
((UCh¬è* 
m_size
));

116 
m_de¡
 = 
m_bufãr
;

117 
	}
}

119 
	gTextTok’iz”
::~
	$TextTok’iz”
()

121 #ifdeà
SSLAB__DEBUG


122 
	`qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
	`cu¼’tD©eTime
().
	`toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
	`toAscii
().
	`d©a
(), 
QTh»ad
::
	`cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

126 
	`ASSERT
(!
m_bufãr
);

127 
	}
}

129 
	gTextTok’iz”
::
	$wr™e
(cÚ¡ 
Segm’‹dSŒšg
& 
s
, 
boŞ
)

131 #ifdeà
SSLAB__DEBUG


132 
	`qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
	`cu¼’tD©eTime
().
	`toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
	`toAscii
().
	`d©a
(), 
QTh»ad
::
	`cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

135 
Exû±iÚCode
 
ec
;

137 
m_de¡
 = 
m_bufãr
;

139 
Segm’‹dSŒšg
 
¡r
 = 
s
;

140 !
¡r
.
	`isEm±y
()) {

141 
UCh¬
 
c
 = *
¡r
;

143 ià(
c
 == '\r') {

144 *
m_de¡
++ = '\n';

147 
m_skLF
 = 
Œue
;

148 } ià(
c
 == '\n') {

149 ià(!
m_skLF
)

150 *
m_de¡
++ = 
c
;

152 
m_skLF
 = 
çl£
;

154 *
m_de¡
++ = 
c
;

155 
m_skLF
 = 
çl£
;

158 
¡r
.
	`advªû
();

161 
	`checkBufãr
();

164 ià(!
m_´eEËm’t
 && !
	`šV›wSourûMode
()) {

165 
RefPŒ
<
EËm’t
> 
roÙEËm’t
 = 
m_doc
->
	`ü—‹EËm’t
(
htmlTag
, 
çl£
);

166 
m_doc
->
	`­³ndChd
(
roÙEËm’t
, 
ec
);

168 
RefPŒ
<
EËm’t
> 
body
 = 
m_doc
->
	`ü—‹EËm’t
(
bodyTag
, 
çl£
);

169 
roÙEËm’t
->
	`­³ndChd
(
body
, 
ec
);

171 
RefPŒ
<
EËm’t
> 
´eEËm’t
 = 
m_doc
->
	`ü—‹EËm’t
(
´eTag
, 
çl£
);

172 
´eEËm’t
->
	`£tA‰ribu‹
("¡yË", "wÜd-w¿p: b»ak-wÜd; wh™e-¥aû:…»-w¿p;", 
ec
);

174 
body
->
	`­³ndChd
(
´eEËm’t
, 
ec
);

176 
m_´eEËm’t
 = 
´eEËm’t
.
	`g‘
();

179 
SŒšg
 
¡ršg
 = 
	`SŒšg
(
m_bufãr
, 
m_de¡
 - m_buffer);

180 ià(
	`šV›wSourûMode
()) {

181 
¡©ic_ÿ¡
<
HTMLV›wSourûDocum’t
*>(
m_doc
)->
	`addV›wSourûText
(
¡ršg
);

185 
ch¬sLeá
 = 
¡ršg
.
	`Ëngth
();

186 
ch¬sLeá
) {

188 
RefPŒ
<
Text
> 
‹xt
 = Text::
	`ü—‹W™hL’gthLim™
(
m_doc
, 
¡ršg
, 
ch¬sLeá
);

189 
m_´eEËm’t
->
	`­³ndChd
(
‹xt
, 
ec
);

191 
	}
}

193 
	gTextTok’iz”
::
	$fšish
()

195 #ifdeà
SSLAB__DEBUG


196 
	`qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
	`cu¼’tD©eTime
().
	`toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
	`toAscii
().
	`d©a
(), 
QTh»ad
::
	`cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

199 ià(!
m_´eEËm’t
)

200 
	`wr™e
(
	`Segm’‹dSŒšg
(), 
Œue
);

201 
m_´eEËm’t
 = 0;

202 
	`ç¡F»e
(
m_bufãr
);

203 
m_bufãr
 = 0;

204 
m_de¡
 = 0;

206 
m_doc
->
	`fšishedP¬sšg
();

207 
	}
}

209 
boŞ
 
	gTextTok’iz”
::
	$isWa™šgFÜSüts
() const

211 #ifdeà
SSLAB__DEBUG


212 
	`qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
	`cu¼’tD©eTime
().
	`toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
	`toAscii
().
	`d©a
(), 
QTh»ad
::
	`cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

216  
çl£
;

217 
	}
}

219 
	gTextDocum’t
::
	$TextDocum’t
(
F¿me
* 
äame
)

220 : 
	$HTMLDocum’t
(
äame
)

222 #ifdeà
SSLAB__DEBUG


223 
	`qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
	`cu¼’tD©eTime
().
	`toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
	`toAscii
().
	`d©a
(), 
QTh»ad
::
	`cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

226 
	}
}

228 
Tok’iz”
* 
	gTextDocum’t
::
	$ü—‹Tok’iz”
()

230 #ifdeà
SSLAB__DEBUG


231 
	`qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
	`cu¼’tD©eTime
().
	`toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
	`toAscii
().
	`d©a
(), 
QTh»ad
::
	`cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

234  
Ãw
 
	`TextTok’iz”
(
this
);

235 
	}
}

237 
Tok’iz”
* 
	$ü—‹TextTok’iz”
(
HTMLV›wSourûDocum’t
* 
docum’t
)

239 #ifdeà
SSLAB__DEBUG


240 
	`qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
	`cu¼’tD©eTime
().
	`toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
	`toAscii
().
	`d©a
(), 
QTh»ad
::
	`cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

243  
Ãw
 
	`TextTok’iz”
(
docum’t
);

244 
	}
}

	@TextDocument.h

25 #iâdeà
TextDocum’t_h


26 
	#TextDocum’t_h


	)

28 
	~"HTMLDocum’t.h
"

30 
Çme¥aû
 
	gWebCÜe
 {

32 
şass
 
	gHTMLV›wSourûDocum’t
;

34 şas 
	cTextDocum’t
 : 
public
 
HTMLDocum’t
 {

35 
public
:

36 
PassRefPŒ
<
TextDocum’t
> 
ü—‹
(
F¿me
* 
äame
)

38  
adİtRef
(
Ãw
 
TextDocum’t
(
äame
));

41 
	g´iv©e
:

42 
TextDocum’t
(
F¿me
*);

44 
vœtu®
 
Tok’iz”
* 
ü—‹Tok’iz”
();

47 
Tok’iz”
* 
ü—‹TextTok’iz”
(
HTMLV›wSourûDocum’t
*);

	@TextResourceDecoder.cpp

2 #ifdeà
SSLAB__DEBUG


3 #iâdeà
SSLAB__QDATETIME


4 
	#SSLAB__QDATETIME


	)

5 
	~<QD©eTime
>

9 #ifdeà
SSLAB__DEBUG


10 #iâdeà
SSLAB__QTHREAD


11 
	#SSLAB__QTHREAD


	)

12 
	~<QTh»ad
>

37 
	~"cÚfig.h
"

38 
	~"TextResourûDecod”.h
"

40 
	~"DOMIm¶em’tiÚ.h
"

41 
	~"HTMLNames.h
"

42 
	~"TextCodec.h
"

43 
	~"TextEncodšg.h
"

44 
	~"TextEncodšgD‘eùÜ.h
"

45 
	~"TextEncodšgRegi¡ry.h
"

46 
	~<wtf/ASCIICTy³.h
>

47 
	~<wtf/SŒšgExŒas.h
>

49 
usšg
 
Çme¥aû
 
	gWTF
;

51 
Çme¥aû
 
	gWebCÜe
 {

53 
usšg
 
Çme¥aû
 
	gHTMLNames
;

59 
fšd
(cÚ¡ * 
subjeù
, 
size_t
 
subjeùL’gth
, cÚ¡ * 
rg‘
)

61 #ifdeà
SSLAB__DEBUG


62 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

65 
size_t
 
	grg‘L’gth
 = 
¡¾’
(
rg‘
);

66 ià(
	grg‘L’gth
 > 
	gsubjeùL’gth
)

68 
size_t
 
	gi
 = 0; i <ğ
subjeùL’gth
 - 
rg‘L’gth
; ++i) {

69 
boŞ
 
	gm©ch
 = 
Œue
;

70 
size_t
 
	gj
 = 0; j < 
	grg‘L’gth
; ++j) {

71 ià(
	gsubjeù
[
i
 + 
j
] !ğ
rg‘
[j]) {

72 
m©ch
 = 
çl£
;

76 ià(
	gm©ch
)

77  
	gi
;

82 
fšdIgnÜšgCa£
(cÚ¡ * 
subjeù
, 
size_t
 
subjeùL’gth
, cÚ¡ * 
rg‘
)

84 #ifdeà
SSLAB__DEBUG


85 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

88 
size_t
 
	grg‘L’gth
 = 
¡¾’
(
rg‘
);

89 ià(
	grg‘L’gth
 > 
	gsubjeùL’gth
)

91 #iâdeà
NDEBUG


92 
size_t
 
	gi
 = 0; i < 
	grg‘L’gth
; ++i)

93 
ASSERT
(
isASCIILow”
(
rg‘
[
i
]));

95 
size_t
 
	gi
 = 0; i <ğ
subjeùL’gth
 - 
rg‘L’gth
; ++i) {

96 
boŞ
 
	gm©ch
 = 
Œue
;

97 
size_t
 
	gj
 = 0; j < 
	grg‘L’gth
; ++j) {

98 ià(
toASCIILow”
(
subjeù
[
i
 + 
j
]è!ğ
rg‘
[j]) {

99 
m©ch
 = 
çl£
;

103 ià(
	gm©ch
)

104  
	gi
;

109 
TextEncodšg
 
fšdTextEncodšg
(cÚ¡ * 
’codšgName
, 
Ëngth
)

111 #ifdeà
SSLAB__DEBUG


112 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

115 
	gVeùÜ
<, 64> 
bufãr
(
Ëngth
 + 1);

116 
memıy
(
bufãr
.
d©a
(), 
’codšgName
, 
Ëngth
);

117 
	gbufãr
[
Ëngth
] = '\0';

118  
	gbufãr
.
d©a
();

121 şas 
	cKªjiCode
 {

122 
	gpublic
:

123 
	eTy³
 { 
ASCII
, 
	gJIS
, 
	gEUC
, 
	gSJIS
, 
	gUTF16
, 
	gUTF8
 };

124 
Ty³
 
judge
(cÚ¡ * 
¡r
, 
Ëngth
);

125 cÚ¡ 
	gESC
 = 0x1b;

126 cÚ¡ 
	gsjisM­
[256];

127 
ISkªji
(
code
)

129 ià(
	gcode
 >= 0x100)

131  
	gsjisM­
[
code
 & 0xff] & 1;

133 
ISkªa
(
code
)

135 ià(
	gcode
 >= 0x100)

137  
	gsjisM­
[
code
 & 0xff] & 2;

141 cÚ¡ 
	gKªjiCode
::
sjisM­
[256] = {

180 
	gKªjiCode
::
Ty³
 
KªjiCode
::
	$judge
(cÚ¡ * 
¡r
, 
size
)

182 #ifdeà
SSLAB__DEBUG


183 
	`qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
	`cu¼’tD©eTime
().
	`toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
	`toAscii
().
	`d©a
(), 
QTh»ad
::
	`cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

186 
Ty³
 
code
;

187 
i
;

188 
bä
 = 
çl£
;

189 
bfk
 = 0;

190 
sjis
 = 0;

191 
euc
 = 0;

193 cÚ¡ * 
±r
 = 
»š‹½»t_ÿ¡
<cÚ¡ *>(
¡r
);

195 
code
 = 
ASCII
;

197 
i
 = 0;

198 
i
 < 
size
) {

199 ià(
±r
[
i
] =ğ
ESC
 && (
size
 - i >= 3)) {

200 ià((
±r
[
i
 + 1] == '$' &&…tr[i + 2] == 'B')

201 || (
±r
[
i
 + 1] == '(' &&…tr[i + 2] == 'B')) {

202 
code
 = 
JIS
;

203 
b»akB»ak
;

204 } ià((
±r
[
i
 + 1] == '$' &&…tr[i + 2] == '@')

205 || (
±r
[
i
 + 1] == '(' &&…tr[i + 2] == 'J')) {

206 
code
 = 
JIS
;

207 
b»akB»ak
;

208 } ià(
±r
[
i
 + 1] == '(' &&…tr[i + 2] == 'I') {

209 
code
 = 
JIS
;

210 
i
 += 3;

211 } ià(
±r
[
i
 + 1] == ')' &&…tr[i + 2] == 'I') {

212 
code
 = 
JIS
;

213 
i
 += 3;

215 
i
++;

217 
bä
 = 
çl£
;

218 
bfk
 = 0;

220 ià(
±r
[
i
] < 0x20) {

221 
bä
 = 
çl£
;

222 
bfk
 = 0;

224 ià((
i
 >ğ2è&& (
±r
[i - 2] == 0x81)

225 && (0x41 <ğ
±r
[
i
 - 1] &&…tr[i - 1] <= 0x49)) {

226 
code
 = 
SJIS
;

227 
sjis
 += 100;

228 } ià((
i
 >ğ2è&& (
±r
[i - 2] == 0xa1)

229 && (0xa2 <ğ
±r
[
i
 - 1] &&…tr[i - 1] <= 0xaa)) {

230 
code
 = 
EUC
;

231 
euc
 += 100;

232 } ià((
i
 >ğ2è&& (
±r
[i - 2] == 0x82) && (0xa0 <=…tr[i - 1])) {

233 
sjis
 += 40;

234 } ià((
i
 >ğ2è&& (
±r
[i - 2] == 0xa4) && (0xa0 <=…tr[i - 1])) {

235 
euc
 += 40;

239 ià((
size
 - 
i
 > 1è&& (
±r
[i] == 0x82) && (0xa0 <=…tr[i + 1])) {

240 
sjis
++;

241 } ià((
size
 - 
i
 > 1è&& (
±r
[i] == 0x83)

242 && (0x40 <ğ
±r
[
i
 + 1] &&…tr[i + 1] <= 0x9f)) {

243 
sjis
++;

244 } ià((
size
 - 
i
 > 1è&& (
±r
[i] == 0xa4) && (0xa0 <=…tr[i + 1])) {

245 
euc
++;

246 } ià((
size
 - 
i
 > 1è&& (
±r
[i] == 0xa5) && (0xa0 <=…tr[i + 1])) {

247 
euc
++;

249 ià(
bä
) {

250 ià((
i
 >ğ1è&& (0x40 <ğ
±r
[i] &&…Œ[i] <ğ0xa0è&& 
	`ISkªji
(ptr[i - 1])) {

251 
code
 = 
SJIS
;

252 
b»akB»ak
;

253 } ià((
i
 >ğ1è&& (0x81 <ğ
±r
[i - 1] &&…tr[i - 1] <= 0x9f) && ((0x40 <=…tr[i] &&…tr[i] < 0x7e) || (0x7e <…tr[i] &&…tr[i] <= 0xfc))) {

254 
code
 = 
SJIS
;

255 
b»akB»ak
;

256 } ià((
i
 >ğ1è&& (0xfd <ğ
±r
[i] &&…tr[i] <= 0xfe) && (0xa1 <=…tr[i - 1] &&…tr[i - 1] <= 0xfe)) {

257 
code
 = 
EUC
;

258 
b»akB»ak
;

259 } ià((
i
 >ğ1è&& (0xfd <ğ
±r
[i - 1] &&…tr[i - 1] <= 0xfe) && (0xa1 <=…tr[i] &&…tr[i] <= 0xfe)) {

260 
code
 = 
EUC
;

261 
b»akB»ak
;

262 } ià((
i
 >ğ1è&& (
±r
[i] < 0xa0 || 0xdf <…tr[i]) && (0x8e ==…tr[i - 1])) {

263 
code
 = 
SJIS
;

264 
b»akB»ak
;

265 } ià(
±r
[
i
] <= 0x7f) {

266 
code
 = 
SJIS
;

267 
b»akB»ak
;

269 ià(0xa1 <ğ
±r
[
i
] &&…tr[i] <= 0xa6) {

270 
euc
++;

271 } ià(0xa1 <ğ
±r
[
i
] &&…tr[i] <= 0xdf) {

273 } ià(0xa1 <ğ
±r
[
i
] &&…tr[i] <= 0xfe) {

274 
euc
++;

275 } ià(0x8=ğ
±r
[
i
]) {

276 
euc
++;

277 } ià(0x20 <ğ
±r
[
i
] &&…tr[i] <= 0x7f) {

278 
sjis
++;

280 
bä
 = 
çl£
;

281 
bfk
 = 0;

283 } ià(0x8=ğ
±r
[
i
]) {

284 ià(
size
 - 
i
 <= 1) {

286 } ià(0xa1 <ğ
±r
[
i
 + 1] &&…tr[i + 1] <= 0xdf) {

288 ià(
bfk
 == 1) {

289 
euc
 += 100;

291 
bfk
++;

292 
i
++;

295 
code
 = 
SJIS
;

296 
b»akB»ak
;

298 } ià(0x81 <ğ
±r
[
i
] &&…tr[i] <= 0x9f) {

300 
code
 = 
SJIS
;

301 ià((
size
 - 
i
 >= 1)

302 && ((0x40 <ğ
±r
[
i
 + 1] &&…tr[i + 1] <= 0x7e)

303 || (0x80 <ğ
±r
[
i
 + 1] &&…tr[i + 1] <= 0xfc))) {

304 
b»akB»ak
;

306 } ià(0xfd <ğ
±r
[
i
] &&…tr[i] <= 0xfe) {

308 
code
 = 
EUC
;

309 ià((
size
 - 
i
 >= 1)

310 && (0xa1 <ğ
±r
[
i
 + 1] &&…tr[i + 1] <= 0xfe)) {

311 
b»akB»ak
;

313 } ià(
±r
[
i
] <= 0x7f) {

316 
bä
 = 
Œue
;

317 
bfk
 = 0;

320 
i
++;

323 ià(
code
 =ğ
ASCII
) {

324 ià(
sjis
 > 
euc
) {

325 
code
 = 
SJIS
;

326 } ià(
sjis
 < 
euc
) {

327 
code
 = 
EUC
;

330 
b»akB»ak
:

331  (
code
);

332 
	}
}

334 
	gTextResourûDecod”
::
CÚ‹ÁTy³
 
TextResourûDecod”
::
	$d‘”mšeCÚ‹ÁTy³
(cÚ¡ 
SŒšg
& 
mimeTy³
)

336 #ifdeà
SSLAB__DEBUG


337 
	`qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
	`cu¼’tD©eTime
().
	`toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
	`toAscii
().
	`d©a
(), 
QTh»ad
::
	`cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

340 ià(
	`equ®IgnÜšgCa£
(
mimeTy³
, "text/css"))

341  
CSS
;

342 ià(
	`equ®IgnÜšgCa£
(
mimeTy³
, "text/html"))

343  
HTML
;

344 ià(
DOMIm¶em’tiÚ
::
	`isXMLMIMETy³
(
mimeTy³
))

345  
XML
;

346  
PÏšText
;

347 
	}
}

349 cÚ¡ 
	gTextEncodšg
& 
	gTextResourûDecod”
::
	$deçuÉEncodšg
(
CÚ‹ÁTy³
 
cÚ‹ÁTy³
, cÚ¡ 
TextEncodšg
& 
¥ecif›dDeçuÉEncodšg
)

351 #ifdeà
SSLAB__DEBUG


352 
	`qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
	`cu¼’tD©eTime
().
	`toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
	`toAscii
().
	`d©a
(), 
QTh»ad
::
	`cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

357 ià(
cÚ‹ÁTy³
 =ğ
XML
)

358  
	`UTF8Encodšg
();

359 ià(!
¥ecif›dDeçuÉEncodšg
.
	`isV®id
())

360  
	`L©š1Encodšg
();

361  
¥ecif›dDeçuÉEncodšg
;

362 
	}
}

364 
	gTextResourûDecod”
::
	$TextResourûDecod”
(cÚ¡ 
SŒšg
& 
mimeTy³
, cÚ¡ 
TextEncodšg
& 
¥ecif›dDeçuÉEncodšg
, 
boŞ
 
u£sEncodšgD‘eùÜ
)

365 : 
	`m_cÚ‹ÁTy³
(
	`d‘”mšeCÚ‹ÁTy³
(
mimeTy³
))

366 , 
	`m_’codšg
(
	`deçuÉEncodšg
(
m_cÚ‹ÁTy³
, 
¥ecif›dDeçuÉEncodšg
))

367 , 
	`m_sourû
(
DeçuÉEncodšg
)

368 , 
	`m_hštEncodšg
(0)

369 , 
	`m_checkedFÜBOM
(
çl£
)

370 , 
	`m_checkedFÜCSSCh¬£t
(
çl£
)

371 , 
	`m_checkedFÜH—dCh¬£t
(
çl£
)

372 , 
	`m_u£L’›ÁXMLDecodšg
(
çl£
)

373 , 
	`m_§wE¼Ü
(
çl£
)

374 , 
	$m_u£sEncodšgD‘eùÜ
(
u£sEncodšgD‘eùÜ
)

376 #ifdeà
SSLAB__DEBUG


377 
	`qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
	`cu¼’tD©eTime
().
	`toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
	`toAscii
().
	`d©a
(), 
QTh»ad
::
	`cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

380 
	}
}

382 
	gTextResourûDecod”
::~
	$TextResourûDecod”
()

384 #ifdeà
SSLAB__DEBUG


385 
	`qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
	`cu¼’tD©eTime
().
	`toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
	`toAscii
().
	`d©a
(), 
QTh»ad
::
	`cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

388 
	}
}

390 
	gTextResourûDecod”
::
	$£tEncodšg
(cÚ¡ 
TextEncodšg
& 
’codšg
, 
EncodšgSourû
 
sourû
)

392 #ifdeà
SSLAB__DEBUG


393 
	`qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
	`cu¼’tD©eTime
().
	`toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
	`toAscii
().
	`d©a
(), 
QTh»ad
::
	`cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

397 ià(!
’codšg
.
	`isV®id
())

402 ià(
sourû
 =ğ
EncodšgFromM‘aTag
 && 
	`¡rÿ£cmp
(
’codšg
.
	`Çme
(), "x-user-defined") == 0)

403 
m_’codšg
 = "windows-1252";

404 ià(
sourû
 =ğ
EncodšgFromM‘aTag
 || sourû =ğ
EncodšgFromXMLH—d”
 || sourû =ğ
EncodšgFromCSSCh¬£t
)

405 
m_’codšg
 = 
’codšg
.
	`şo£¡By‹Ba£dEquiv®’t
();

407 
m_’codšg
 = 
’codšg
;

409 
m_codec
.
	`ş—r
();

410 
m_sourû
 = 
sourû
;

411 
	}
}

414 
	$fšdXMLEncodšg
(cÚ¡ * 
¡r
, 
Ën
, & 
’codšgL’gth
)

416 #ifdeà
SSLAB__DEBUG


417 
	`qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
	`cu¼’tD©eTime
().
	`toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
	`toAscii
().
	`d©a
(), 
QTh»ad
::
	`cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

420 
pos
 = 
	`fšd
(
¡r
, 
Ën
, "encoding");

421 ià(
pos
 == -1)

423 
pos
 += 8;

426 
pos
 < 
Ën
 && 
¡r
[pos] <= ' ')

427 ++
pos
;

430 ià(
pos
 >ğ
Ën
 || 
¡r
[pos] != '=')

432 ++
pos
;

435 
pos
 < 
Ën
 && 
¡r
[pos] <= ' ')

436 ++
pos
;

439 ià(
pos
 >ğ
Ën
)

441 
quÙeM¬k
 = 
¡r
[
pos
];

442 ià(
quÙeM¬k
 != '"' && quoteMark != '\'')

444 ++
pos
;

447 
’d
 = 
pos
;

448 
’d
 < 
Ën
 && 
¡r
[’d] !ğ
quÙeM¬k
)

449 ++
’d
;

450 ià(
’d
 >ğ
Ën
)

453 
’codšgL’gth
 = 
’d
 - 
pos
;

454  
pos
;

455 
	}
}

458 
šlše
 
boŞ
 
	$skWh™e¥aû
(cÚ¡ *& 
pos
, cÚ¡ * 
d©aEnd
)

460 #ifdeà
SSLAB__DEBUG


461 
	`qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
	`cu¼’tD©eTime
().
	`toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
	`toAscii
().
	`d©a
(), 
QTh»ad
::
	`cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

464 
pos
 < 
d©aEnd
 && (*pos == '\t' || *pos == ' '))

465 ++
pos
;

466  
pos
 !ğ
d©aEnd
;

467 
	}
}

469 
size_t
 
	gTextResourûDecod”
::
	$checkFÜBOM
(cÚ¡ * 
d©a
, 
size_t
 
Ën
)

471 #ifdeà
SSLAB__DEBUG


472 
	`qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
	`cu¼’tD©eTime
().
	`toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
	`toAscii
().
	`d©a
(), 
QTh»ad
::
	`cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

477 
	`ASSERT
(!
m_checkedFÜBOM
);

479 
size_t
 
ËngthOfBOM
 = 0;

481 
size_t
 
bufãrL’gth
 = 
m_bufãr
.
	`size
();

483 
size_t
 
buf1L’
 = 
bufãrL’gth
;

484 
size_t
 
buf2L’
 = 
Ën
;

485 cÚ¡ * 
buf1
 = 
»š‹½»t_ÿ¡
<cÚ¡ *>(
m_bufãr
.
	`d©a
());

486 cÚ¡ * 
buf2
 = 
»š‹½»t_ÿ¡
<cÚ¡ *>(
d©a
);

487 
c1
 = 
buf1L’
 ? (--buf1L’, *
buf1
++è: 
buf2L’
 ? (--buf2L’, *
buf2
++) : 0;

488 
c2
 = 
buf1L’
 ? (--buf1L’, *
buf1
++è: 
buf2L’
 ? (--buf2L’, *
buf2
++) : 0;

489 
c3
 = 
buf1L’
 ? (--buf1L’, *
buf1
++è: 
buf2L’
 ? (--buf2L’, *
buf2
++) : 0;

490 
c4
 = 
buf2L’
 ? (--buf2L’, *
buf2
++) : 0;

493 ià(
c1
 =ğ0xFF && 
c2
 == 0xFE) {

494 ià(
c3
 !ğ0 || 
c4
 != 0) {

495 
	`£tEncodšg
(
	`UTF16L™eEndŸnEncodšg
(), 
AutoD‘eùedEncodšg
);

496 
ËngthOfBOM
 = 2;

498 
	`£tEncodšg
(
	`UTF32L™eEndŸnEncodšg
(), 
AutoD‘eùedEncodšg
);

499 
ËngthOfBOM
 = 4;

501 } ià(
c1
 =ğ0xEF && 
c2
 =ğ0xBB && 
c3
 == 0xBF) {

502 
	`£tEncodšg
(
	`UTF8Encodšg
(), 
AutoD‘eùedEncodšg
);

503 
ËngthOfBOM
 = 3;

504 } ià(
c1
 =ğ0xFE && 
c2
 == 0xFF) {

505 
	`£tEncodšg
(
	`UTF16BigEndŸnEncodšg
(), 
AutoD‘eùedEncodšg
);

506 
ËngthOfBOM
 = 2;

507 } ià(
c1
 =ğ0 && 
c2
 =ğ0 && 
c3
 =ğ0xFE && 
c4
 == 0xFF) {

508 
	`£tEncodšg
(
	`UTF32BigEndŸnEncodšg
(), 
AutoD‘eùedEncodšg
);

509 
ËngthOfBOM
 = 4;

512 ià(
ËngthOfBOM
 || 
bufãrL’gth
 + 
Ën
 >= 4)

513 
m_checkedFÜBOM
 = 
Œue
;

515  
ËngthOfBOM
;

516 
	}
}

518 
boŞ
 
	gTextResourûDecod”
::
	$checkFÜCSSCh¬£t
(cÚ¡ * 
d©a
, 
size_t
 
Ën
, 
boŞ
& 
movedD©aToBufãr
)

520 #ifdeà
SSLAB__DEBUG


521 
	`qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
	`cu¼’tD©eTime
().
	`toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
	`toAscii
().
	`d©a
(), 
QTh»ad
::
	`cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

524 ià(
m_sourû
 !ğ
DeçuÉEncodšg
 && m_sourû !ğ
EncodšgFromP¬’tF¿me
) {

525 
m_checkedFÜCSSCh¬£t
 = 
Œue
;

526  
Œue
;

529 
size_t
 
ŞdSize
 = 
m_bufãr
.
	`size
();

530 
m_bufãr
.
	`grow
(
ŞdSize
 + 
Ën
);

531 
	`memıy
(
m_bufãr
.
	`d©a
(è+ 
ŞdSize
, 
d©a
, 
Ën
);

533 
movedD©aToBufãr
 = 
Œue
;

535 ià(
m_bufãr
.
	`size
() > 8) {

536 cÚ¡ * 
d©aS¹
 = 
m_bufãr
.
	`d©a
();

537 cÚ¡ * 
d©aEnd
 = 
d©aS¹
 + 
m_bufãr
.
	`size
();

539 ià(
d©aS¹
[0] == '@' && dataStart[1] == 'c' && dataStart[2] == 'h' && dataStart[3] == 'a' && dataStart[4] == 'r' &&

540 
d©aS¹
[5] == 's' && dataStart[6] == 'e' && dataStart[7] == 't') {

542 
d©aS¹
 += 8;

543 cÚ¡ * 
pos
 = 
d©aS¹
;

544 ià(!
	`skWh™e¥aû
(
pos
, 
d©aEnd
))

545  
çl£
;

547 ià(*
pos
 == '"' || *pos == '\'') {

548 
quÙ©iÚM¬k
 = *
pos
;

549 ++
pos
;

550 
d©aS¹
 = 
pos
;

552 
pos
 < 
d©aEnd
 && *po !ğ
quÙ©iÚM¬k
)

553 ++
pos
;

554 ià(
pos
 =ğ
d©aEnd
)

555  
çl£
;

557 
’codšgNameL’gth
 = 
pos
 - 
d©aS¹
 + 1;

559 ++
pos
;

560 ià(!
	`skWh™e¥aû
(
pos
, 
d©aEnd
))

561  
çl£
;

563 ià(*
pos
 == ';')

564 
	`£tEncodšg
(
	`fšdTextEncodšg
(
d©aS¹
, 
’codšgNameL’gth
), 
EncodšgFromCSSCh¬£t
);

567 
m_checkedFÜCSSCh¬£t
 = 
Œue
;

568  
Œue
;

570  
çl£
;

571 
	}
}

575 
šlše
 
	$skComm’t
(cÚ¡ *& 
±r
, cÚ¡ * 
pEnd
)

577 #ifdeà
SSLAB__DEBUG


578 
	`qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
	`cu¼’tD©eTime
().
	`toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
	`toAscii
().
	`d©a
(), 
QTh»ad
::
	`cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

581 cÚ¡ * 
p
 = 
±r
;

582 ià(
p
 =ğ
pEnd
)

585 ià(*
p
 == '>') {

586 
p
++;

588 
p
 + 2 < 
pEnd
) {

589 ià(*
p
 == '-') {

591 ià(
p
[1] == '-' &&…[2] == '>') {

592 
p
 += 3;

596 ià(
p
 + 3 < 
pEnd
 &&…[1] == '-' &&…[2] == '!' &&…[3] == '>') {

597 
p
 += 4;

601 
p
++;

604 
±r
 = 
p
;

605 
	}
}

607 cÚ¡ 
	gby‹sToCheckUncÚd™iÚ®ly
 = 1024;

609 
boŞ
 
	gTextResourûDecod”
::
	$checkFÜH—dCh¬£t
(cÚ¡ * 
d©a
, 
size_t
 
Ën
, 
boŞ
& 
movedD©aToBufãr
)

611 #ifdeà
SSLAB__DEBUG


612 
	`qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
	`cu¼’tD©eTime
().
	`toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
	`toAscii
().
	`d©a
(), 
QTh»ad
::
	`cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

615 ià(
m_sourû
 !ğ
DeçuÉEncodšg
 && m_sourû !ğ
EncodšgFromP¬’tF¿me
) {

616 
m_checkedFÜH—dCh¬£t
 = 
Œue
;

617  
Œue
;

623 
size_t
 
ŞdSize
 = 
m_bufãr
.
	`size
();

624 
m_bufãr
.
	`grow
(
ŞdSize
 + 
Ën
);

625 
	`memıy
(
m_bufãr
.
	`d©a
(è+ 
ŞdSize
, 
d©a
, 
Ën
);

627 
movedD©aToBufãr
 = 
Œue
;

629 cÚ¡ * 
±r
 = 
m_bufãr
.
	`d©a
();

630 cÚ¡ * 
pEnd
 = 
±r
 + 
m_bufãr
.
	`size
();

633 ià(
m_bufãr
.
	`size
() < 8)

634  
çl£
;

638 ià(
±r
[0] == '<' &&…tr[1] == '?' &&…tr[2] == 'x' &&…tr[3] == 'm' &&…tr[4] == 'l') {

639 cÚ¡ * 
xmlDeş¬©iÚEnd
 = 
±r
;

640 
xmlDeş¬©iÚEnd
 !ğ
pEnd
 && *xmlDeclarationEnd != '>')

641 ++
xmlDeş¬©iÚEnd
;

642 ià(
xmlDeş¬©iÚEnd
 =ğ
pEnd
)

643  
çl£
;

645 
Ën
;

646 
pos
 = 
	`fšdXMLEncodšg
(
±r
, 
xmlDeş¬©iÚEnd
 -…Œ, 
Ën
);

647 ià(
pos
 != -1)

648 
	`£tEncodšg
(
	`fšdTextEncodšg
(
±r
 + 
pos
, 
Ën
), 
EncodšgFromXMLH—d”
);

650 } ià(
±r
[0] == '<' &&…tr[1] == 0 &&…tr[2] == '?' &&…tr[3] == 0 &&…tr[4] == 'x' &&…tr[5] == 0) {

651 
	`£tEncodšg
(
	`UTF16L™eEndŸnEncodšg
(), 
AutoD‘eùedEncodšg
);

652  
Œue
;

653 } ià(
±r
[0] == 0 &&…tr[1] == '<' &&…tr[2] == 0 &&…tr[3] == '?' &&…tr[4] == 0 &&…tr[5] == 'x') {

654 
	`£tEncodšg
(
	`UTF16BigEndŸnEncodšg
(), 
AutoD‘eùedEncodšg
);

655  
Œue
;

656 } ià(
±r
[0] == '<' &&…tr[1] == 0 &&…tr[2] == 0 &&…tr[3] == 0 &&…tr[4] == '?' &&…tr[5] == 0 &&…tr[6] == 0 &&…tr[7] == 0) {

657 
	`£tEncodšg
(
	`UTF32L™eEndŸnEncodšg
(), 
AutoD‘eùedEncodšg
);

658  
Œue
;

659 } ià(
±r
[0] == 0 &&…tr[1] == 0 &&…tr[2] == 0 &&…tr[3] == '<' &&…tr[4] == 0 &&…tr[5] == 0 &&…tr[6] == 0 &&…tr[7] == '?') {

660 
	`£tEncodšg
(
	`UTF32BigEndŸnEncodšg
(), 
AutoD‘eùedEncodšg
);

661  
Œue
;

680 
AtomicSŒšgIm¶
* 
’şosšgTagName
 = 0;

681 
boŞ
 
šH—dSeùiÚ
 = 
Œue
;

684 ià(
m_cÚ‹ÁTy³
 =ğ
XML
)

685  
Œue
;

687 
±r
 + 3 < 
pEnd
) {

688 ià(*
±r
 == '<') {

689 
boŞ
 
’d
 = 
çl£
;

690 
±r
++;

693 ià(
±r
[0] == '!' &&…tr[1] == '-' &&…tr[2] == '-') {

694 
±r
 += 3;

695 
	`skComm’t
(
±r
, 
pEnd
);

696 ià(
±r
 - 
m_bufãr
.
	`d©a
(è>ğ
by‹sToCheckUncÚd™iÚ®ly
 && !
šH—dSeùiÚ
) {

700 
m_checkedFÜH—dCh¬£t
 = 
Œue
;

701  
Œue
;

706 ià(*
±r
 == '/') {

707 ++
±r
;

708 
’d
 = 
Œue
;

712 
boŞ
 
§wName¥aû
 = 
çl£
;

713 
gBufãr
[20];

714 
Ën
 = 0;

715 
Ën
 < 19) {

716 ià(
±r
 =ğ
pEnd
)

717  
çl£
;

718 
c
 = *
±r
;

719 ià(
c
 == ':') {

720 
Ën
 = 0;

721 
§wName¥aû
 = 
Œue
;

722 
±r
++;

725 ià((
c
 >= 'a' && c <= 'z') || (c >= '0' && c <= '9'))

727 ià(
c
 >= 'A' && c <= 'Z')

728 
c
 += 'a' - 'A';

731 
gBufãr
[
Ën
++] = 
c
;

732 
±r
++;

734 
gBufãr
[
Ën
] = 0;

735 
AtomicSŒšg
 
	`g
(
gBufãr
);

737 ià(
’şosšgTagName
) {

738 ià(
’d
 && 
g
.
	`im¶
(è=ğ
’şosšgTagName
)

739 
’şosšgTagName
 = 0;

741 ià(
g
 =ğ
t™ËTag
)

742 
’şosšgTagName
 = 
t™ËTag
.
	`loÿlName
().
	`im¶
();

743 ià(
g
 =ğ
sütTag
)

744 
’şosšgTagName
 = 
sütTag
.
	`loÿlName
().
	`im¶
();

745 ià(
g
 =ğ
nosütTag
)

746 
’şosšgTagName
 = 
nosütTag
.
	`loÿlName
().
	`im¶
();

750 cÚ¡ * 
gCÚ‹ÁS¹
 = 
±r
;

751 ià(!
’d
) {

752 
±r
 !ğ
pEnd
 && *ptr != '>') {

753 ià(*
±r
 == '\'' || *ptr == '"') {

754 
quÙeM¬k
 = *
±r
;

755 ++
±r
;

756 
±r
 !ğ
pEnd
 && *±¸!ğ
quÙeM¬k
)

757 ++
±r
;

758 ià(
±r
 =ğ
pEnd
)

759  
çl£
;

761 ++
±r
;

763 ià(
±r
 =ğ
pEnd
)

764  
çl£
;

765 ++
±r
;

768 ià(!
’d
 && 
g
 =ğ
m‘aTag
 && !
§wName¥aû
) {

769 cÚ¡ * 
¡r
 = 
gCÚ‹ÁS¹
;

770 
Ëngth
 = 
±r
 - 
gCÚ‹ÁS¹
;

771 
pos
 = 0;

772 
pos
 < 
Ëngth
) {

773 
ch¬£tPos
 = 
	`fšdIgnÜšgCa£
(
¡r
 + 
pos
, 
Ëngth
 -…os, "charset");

774 ià(
ch¬£tPos
 == -1)

776 
pos
 +ğ
ch¬£tPos
 + 7;

778 
pos
 < 
Ëngth
 && 
¡r
[pos] <= ' ')

779 
pos
++;

780 ià(
pos
 =ğ
Ëngth
)

782 ià(
¡r
[
pos
++] != '=')

784 (
pos
 < 
Ëngth
) &&

785 (
¡r
[
pos
] <= ' ' || str[pos] == '=' || str[pos] == '"' || str[pos] == '\''))

786 
pos
++;

789 ià(
pos
 =ğ
Ëngth
)

791 
’d
 = 
pos
;

792 
’d
 < 
Ëngth
 &&

793 
¡r
[
’d
] != ' ' && str[end] != '"' && str[end] != '\'' &&

794 
¡r
[
’d
] != ';' && str[end] != '>')

795 
’d
++;

796 
	`£tEncodšg
(
	`fšdTextEncodšg
(
¡r
 + 
pos
, 
’d
 -…os), 
EncodšgFromM‘aTag
);

797 ià(
m_sourû
 =ğ
EncodšgFromM‘aTag
)

798  
Œue
;

800 ià(
’d
 >ğ
Ëngth
 || 
¡r
[end] == '/' || str[end] == '>')

803 
pos
 = 
’d
 + 1;

806 ià(!
’şosšgTagName
 && 
g
 !ğ
sütTag
 &&ag !ğ
nosütTag
 &&ag !ğ
¡yËTag


807 && 
g
 !ğ
lškTag
 &&ag !ğ
m‘aTag
 &&ag !ğ
objeùTag
 &&ag !ğ
t™ËTag
 &&ag !ğ
ba£Tag


808 && (
’d
 || 
g
 !ğ
htmlTag
è&& (’d ||ag !ğ
h—dTag
è&& 
	`isASCIIAÍha
(
gBufãr
[0])) {

809 
šH—dSeùiÚ
 = 
çl£
;

812 ià(
±r
 - 
m_bufãr
.
	`d©a
(è>ğ
by‹sToCheckUncÚd™iÚ®ly
 && !
šH—dSeùiÚ
) {

813 
m_checkedFÜH—dCh¬£t
 = 
Œue
;

814  
Œue
;

818 ++
±r
;

820  
çl£
;

821 
	}
}

823 
	gTextResourûDecod”
::
	$d‘eùJ­ªe£Encodšg
(cÚ¡ * 
d©a
, 
size_t
 
Ën
)

825 #ifdeà
SSLAB__DEBUG


826 
	`qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
	`cu¼’tD©eTime
().
	`toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
	`toAscii
().
	`d©a
(), 
QTh»ad
::
	`cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

829 
KªjiCode
::
	`judge
(
d©a
, 
Ën
)) {

830 
KªjiCode
::
JIS
:

831 
	`£tEncodšg
("ISO-2022-JP", 
AutoD‘eùedEncodšg
);

833 
KªjiCode
::
EUC
:

834 
	`£tEncodšg
("EUC-JP", 
AutoD‘eùedEncodšg
);

836 
KªjiCode
::
SJIS
:

837 
	`£tEncodšg
("Shiá_JIS", 
AutoD‘eùedEncodšg
);

839 
KªjiCode
::
ASCII
:

840 
KªjiCode
::
UTF16
:

841 
KªjiCode
::
UTF8
:

844 
	}
}

855 
boŞ
 
	gTextResourûDecod”
::
	$shouldAutoD‘eù
() const

857 #ifdeà
SSLAB__DEBUG


858 
	`qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
	`cu¼’tD©eTime
().
	`toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
	`toAscii
().
	`d©a
(), 
QTh»ad
::
	`cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

863  
m_u£sEncodšgD‘eùÜ


864 && (
m_sourû
 =ğ
DeçuÉEncodšg
 || (m_sourû =ğ
EncodšgFromP¬’tF¿me
 && 
m_hštEncodšg
));

865 
	}
}

867 
SŒšg
 
	gTextResourûDecod”
::
	$decode
(cÚ¡ * 
d©a
, 
size_t
 
Ën
)

869 #ifdeà
SSLAB__DEBUG


870 
	`qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
	`cu¼’tD©eTime
().
	`toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
	`toAscii
().
	`d©a
(), 
QTh»ad
::
	`cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

873 
size_t
 
ËngthOfBOM
 = 0;

874 ià(!
m_checkedFÜBOM
)

875 
ËngthOfBOM
 = 
	`checkFÜBOM
(
d©a
, 
Ën
);

877 
boŞ
 
movedD©aToBufãr
 = 
çl£
;

879 ià(
m_cÚ‹ÁTy³
 =ğ
CSS
 && !
m_checkedFÜCSSCh¬£t
)

880 ià(!
	`checkFÜCSSCh¬£t
(
d©a
, 
Ën
, 
movedD©aToBufãr
))

883 ià((
m_cÚ‹ÁTy³
 =ğ
HTML
 || m_cÚ‹ÁTy³ =ğ
XML
è&& !
m_checkedFÜH—dCh¬£t
)

884 ià(!
	`checkFÜH—dCh¬£t
(
d©a
, 
Ën
, 
movedD©aToBufãr
))

888 ià(
	`shouldAutoD‘eù
()) {

889 ià(
m_’codšg
.
	`isJ­ªe£
())

890 
	`d‘eùJ­ªe£Encodšg
(
d©a
, 
Ën
);

892 
TextEncodšg
 
d‘eùedEncodšg
;

893 ià(
	`d‘eùTextEncodšg
(
d©a
, 
Ën
, 
m_hštEncodšg
, &
d‘eùedEncodšg
))

894 
	`£tEncodšg
(
d‘eùedEncodšg
, 
AutoD‘eùedEncodšg
);

898 
	`ASSERT
(
m_’codšg
.
	`isV®id
());

900 ià(!
m_codec
)

901 
m_codec
.
	`£t
(
	`ÃwTextCodec
(
m_’codšg
).
	`»Ëa£
());

903 ià(
m_bufãr
.
	`isEm±y
())

904  
m_codec
->
	`decode
(
d©a
 + 
ËngthOfBOM
, 
Ën
 -†’gthOfBOM, 
çl£
, 
m_cÚ‹ÁTy³
 =ğ
XML
, 
m_§wE¼Ü
);

906 ià(!
movedD©aToBufãr
) {

907 
size_t
 
ŞdSize
 = 
m_bufãr
.
	`size
();

908 
m_bufãr
.
	`grow
(
ŞdSize
 + 
Ën
);

909 
	`memıy
(
m_bufãr
.
	`d©a
(è+ 
ŞdSize
, 
d©a
, 
Ën
);

912 
SŒšg
 
»suÉ
 = 
m_codec
->
	`decode
(
m_bufãr
.
	`d©a
(è+ 
ËngthOfBOM
, m_bufãr.
	`size
(è-†’gthOfBOM, 
çl£
, 
m_cÚ‹ÁTy³
 =ğ
XML
 && !
m_u£L’›ÁXMLDecodšg
, 
m_§wE¼Ü
);

913 
m_bufãr
.
	`ş—r
();

914  
»suÉ
;

915 
	}
}

917 
SŒšg
 
	gTextResourûDecod”
::
	$æush
()

919 #ifdeà
SSLAB__DEBUG


920 
	`qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
	`cu¼’tD©eTime
().
	`toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
	`toAscii
().
	`d©a
(), 
QTh»ad
::
	`cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

926 ià(
m_bufãr
.
	`size
(è&& 
	`shouldAutoD‘eù
()

927 && ((!
m_checkedFÜH—dCh¬£t
 && (
m_cÚ‹ÁTy³
 =ğ
HTML
 || m_cÚ‹ÁTy³ =ğ
XML
)è|| (!
m_checkedFÜCSSCh¬£t
 && (m_cÚ‹ÁTy³ =ğ
CSS
)))) {

928 
TextEncodšg
 
d‘eùedEncodšg
;

929 ià(
	`d‘eùTextEncodšg
(
m_bufãr
.
	`d©a
(), m_bufãr.
	`size
(),

930 
m_hštEncodšg
, &
d‘eùedEncodšg
))

931 
	`£tEncodšg
(
d‘eùedEncodšg
, 
AutoD‘eùedEncodšg
);

934 ià(!
m_codec
)

935 
m_codec
.
	`£t
(
	`ÃwTextCodec
(
m_’codšg
).
	`»Ëa£
());

937 
SŒšg
 
»suÉ
 = 
m_codec
->
	`decode
(
m_bufãr
.
	`d©a
(), m_bufãr.
	`size
(), 
Œue
, 
m_cÚ‹ÁTy³
 =ğ
XML
 && !
m_u£L’›ÁXMLDecodšg
, 
m_§wE¼Ü
);

938 
m_bufãr
.
	`ş—r
();

939 
m_codec
.
	`ş—r
();

940 
m_checkedFÜBOM
 = 
çl£
;

941  
»suÉ
;

942 
	}
}

	@TextResourceDecoder.h

23 #iâdeà
TextResourûDecod”_h


24 
	#TextResourûDecod”_h


	)

26 
	~"TextEncodšg.h
"

28 
Çme¥aû
 
	gWebCÜe
 {

30 
şass
 
	gTextResourûDecod”
 : 
public
 
RefCouÁed
<
TextResourûDecod”
> {

31 
public
:

32 
	eEncodšgSourû
 {

33 
DeçuÉEncodšg
,

34 
	gAutoD‘eùedEncodšg
,

35 
	gEncodšgFromXMLH—d”
,

36 
	gEncodšgFromM‘aTag
,

37 
	gEncodšgFromCSSCh¬£t
,

38 
	gEncodšgFromHTTPH—d”
,

39 
	gU£rCho£nEncodšg
,

40 
	gEncodšgFromP¬’tF¿me


43 
	gPassRefPŒ
<
	gTextResourûDecod”
> 
ü—‹
(cÚ¡ 
SŒšg
& 
mimeTy³
, cÚ¡ 
TextEncodšg
& 
deçuÉEncodšg
 = TextEncodšg(), 
boŞ
 
u£sEncodšgD‘eùÜ
 = 
çl£
)

45  
adİtRef
(
Ãw
 
TextResourûDecod”
(
mimeTy³
, 
deçuÉEncodšg
, 
u£sEncodšgD‘eùÜ
));

47 ~
TextResourûDecod”
();

49 
£tEncodšg
(cÚ¡ 
TextEncodšg
&, 
EncodšgSourû
);

50 cÚ¡ 
	gTextEncodšg
& 
’codšg
(ècÚ¡ {  
	gm_’codšg
; }

52 
SŒšg
 
decode
(cÚ¡ * 
d©a
, 
size_t
 
Ëngth
);

53 
SŒšg
 
æush
();

55 
£tHštEncodšg
(cÚ¡ 
TextResourûDecod”
* 
hštDecod”
)

59 ià(
	ghštDecod”
 && hštDecod”->
	gm_sourû
 =ğ
AutoD‘eùedEncodšg
)

60 
m_hštEncodšg
 = 
hštDecod”
->
’codšg
().
Çme
();

63 
u£L’›ÁXMLDecodšg
(è{ 
	gm_u£L’›ÁXMLDecodšg
 = 
Œue
; }

64 
boŞ
 
§wE¼Ü
(ècÚ¡ {  
	gm_§wE¼Ü
; }

66 
	g´iv©e
:

67 
TextResourûDecod”
(cÚ¡ 
SŒšg
& 
mimeTy³
, cÚ¡ 
TextEncodšg
& 
deçuÉEncodšg
,

68 
boŞ
 
u£sEncodšgD‘eùÜ
);

70 
	eCÚ‹ÁTy³
 { 
	gPÏšText
, 
	gHTML
, 
	gXML
, 
	gCSS
 };

71 
CÚ‹ÁTy³
 
d‘”mšeCÚ‹ÁTy³
(cÚ¡ 
SŒšg
& 
mimeTy³
);

72 cÚ¡ 
	gTextEncodšg
& 
deçuÉEncodšg
(
CÚ‹ÁTy³
, cÚ¡ 
TextEncodšg
& defaultEncoding);

74 
size_t
 
checkFÜBOM
(const *, size_t);

75 
boŞ
 
checkFÜCSSCh¬£t
(cÚ¡ *, 
size_t
, boŞ& 
movedD©aToBufãr
);

76 
boŞ
 
checkFÜH—dCh¬£t
(cÚ¡ *, 
size_t
, boŞ& 
movedD©aToBufãr
);

77 
d‘eùJ­ªe£Encodšg
(cÚ¡ *, 
size_t
);

78 
boŞ
 
shouldAutoD‘eù
() const;

80 
CÚ‹ÁTy³
 
	gm_cÚ‹ÁTy³
;

81 
TextEncodšg
 
	gm_’codšg
;

82 
	gOwnPŒ
<
	gTextCodec
> 
	gm_codec
;

83 
EncodšgSourû
 
	gm_sourû
;

84 cÚ¡ * 
	gm_hštEncodšg
;

85 
	gVeùÜ
<> 
	gm_bufãr
;

86 
boŞ
 
	gm_checkedFÜBOM
;

87 
boŞ
 
	gm_checkedFÜCSSCh¬£t
;

88 
boŞ
 
	gm_checkedFÜH—dCh¬£t
;

89 
boŞ
 
	gm_u£L’›ÁXMLDecodšg
;

90 
boŞ
 
	gm_§wE¼Ü
;

91 
boŞ
 
	gm_u£sEncodšgD‘eùÜ
;

	@ThreadableLoader.cpp

2 #ifdeà
SSLAB__DEBUG


3 #iâdeà
SSLAB__QDATETIME


4 
	#SSLAB__QDATETIME


	)

5 
	~<QD©eTime
>

9 #ifdeà
SSLAB__DEBUG


10 #iâdeà
SSLAB__QTHREAD


11 
	#SSLAB__QTHREAD


	)

12 
	~<QTh»ad
>

45 
	~"cÚfig.h
"

46 
	~"Th»adabËLßd”.h
"

48 
	~"SütExecutiÚCÚ‹xt.h
"

49 
	~"Docum’t.h
"

50 
	~"Docum’tTh»adabËLßd”.h
"

51 
	~"WÜk”CÚ‹xt.h
"

52 
	~"WÜk”RunLoİ.h
"

53 
	~"WÜk”Th»adabËLßd”.h
"

55 
Çme¥aû
 
	gWebCÜe
 {

57 
	gPassRefPŒ
<
	gTh»adabËLßd”
> Th»adabËLßd”::
ü—‹
(
SütExecutiÚCÚ‹xt
* 
cÚ‹xt
, 
Th»adabËLßd”Cl›Á
* 
ş›Á
, cÚ¡ 
ResourûReque¡
& 
»que¡
, cÚ¡ 
Th»adabËLßd”O±iÚs
& 
İtiÚs
)

59 #ifdeà
SSLAB__DEBUG


60 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

63 
ASSERT
(
ş›Á
);

64 
ASSERT
(
cÚ‹xt
);

66 #ià
ENABLE
(
WORKERS
)

67 ià(
	gcÚ‹xt
->
isWÜk”CÚ‹xt
())

68  
	gWÜk”Th»adabËLßd”
::
ü—‹
(
¡©ic_ÿ¡
<
WÜk”CÚ‹xt
*>(
cÚ‹xt
), 
ş›Á
, 
WÜk”RunLoİ
::
deçuÉMode
(), 
»que¡
, 
İtiÚs
);

71 
ASSERT
(
cÚ‹xt
->
isDocum’t
());

72  
	gDocum’tTh»adabËLßd”
::
ü—‹
(
¡©ic_ÿ¡
<
Docum’t
*>(
cÚ‹xt
), 
ş›Á
, 
»que¡
, 
İtiÚs
);

75 
	gTh»adabËLßd”
::
lßdResourûSynchrÚou¦y
(
SütExecutiÚCÚ‹xt
* 
cÚ‹xt
, cÚ¡ 
ResourûReque¡
& 
»que¡
, 
Th»adabËLßd”Cl›Á
& 
ş›Á
, cÚ¡ 
Th»adabËLßd”O±iÚs
& 
İtiÚs
)

77 #ifdeà
SSLAB__DEBUG


78 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

81 
ASSERT
(
cÚ‹xt
);

83 #ià
ENABLE
(
WORKERS
)

84 ià(
	gcÚ‹xt
->
isWÜk”CÚ‹xt
()) {

85 
	gWÜk”Th»adabËLßd”
::
lßdResourûSynchrÚou¦y
(
¡©ic_ÿ¡
<
WÜk”CÚ‹xt
*>(
cÚ‹xt
), 
»que¡
, 
ş›Á
, 
İtiÚs
);

90 
ASSERT
(
cÚ‹xt
->
isDocum’t
());

91 
	gDocum’tTh»adabËLßd”
::
lßdResourûSynchrÚou¦y
(
¡©ic_ÿ¡
<
Docum’t
*>(
cÚ‹xt
), 
»que¡
, 
ş›Á
, 
İtiÚs
);

	@ThreadableLoader.h

31 #iâdeà
Th»adabËLßd”_h


32 
	#Th»adabËLßd”_h


	)

34 
	~<wtf/NÚcİyabË.h
>

35 
	~<wtf/PassRefPŒ.h
>

36 
	~<wtf/VeùÜ.h
>

38 
Çme¥aû
 
	gWebCÜe
 {

40 
şass
 
	gResourûE¼Ü
;

41 
şass
 
	gResourûReque¡
;

42 
şass
 
	gResourûRe¥Ú£
;

43 
şass
 
	gSütExecutiÚCÚ‹xt
;

44 
şass
 
	gTh»adabËLßd”Cl›Á
;

46 
	eStÜedC»d’tŸls
 {

47 
	gAÎowStÜedC»d’tŸls
,

48 
	gDoNÙAÎowStÜedC»d’tŸls


51 
	eCrossOrigšReque¡PŞicy
 {

52 
	gD’yCrossOrigšReque¡s
,

53 
	gU£AcûssCÚŒŞ
,

54 
	gAÎowCrossOrigšReque¡s


57 
	sTh»adabËLßd”O±iÚs
 {

58 
Th»adabËLßd”O±iÚs
(è: 
£ndLßdC®lbacks
(
çl£
), 
¢iffCÚ‹Á
(çl£), 
®lowC»d’tŸls
(çl£), 
fÜûP»æight
(çl£), 
üossOrigšReque¡PŞicy
(
D’yCrossOrigšReque¡s
) { }

59 
boŞ
 
	g£ndLßdC®lbacks
;

60 
boŞ
 
	g¢iffCÚ‹Á
;

61 
boŞ
 
	g®lowC»d’tŸls
;

62 
boŞ
 
	gfÜûP»æight
;

63 
CrossOrigšReque¡PŞicy
 
	güossOrigšReque¡PŞicy
;

68 şas 
	cTh»adabËLßd”
 : 
public
 
NÚcİyabË
 {

69 
public
:

70 
lßdResourûSynchrÚou¦y
(
SütExecutiÚCÚ‹xt
*, cÚ¡ 
ResourûReque¡
&, 
Th»adabËLßd”Cl›Á
&, cÚ¡ 
Th»adabËLßd”O±iÚs
&);

71 
	gPassRefPŒ
<
	gTh»adabËLßd”
> 
ü—‹
(
SütExecutiÚCÚ‹xt
*, 
Th»adabËLßd”Cl›Á
*, cÚ¡ 
ResourûReque¡
&, cÚ¡ 
Th»adabËLßd”O±iÚs
&);

73 
vœtu®
 
ÿnûl
() = 0;

74 
»f
(è{ 
»fTh»adabËLßd”
(); }

75 
d”ef
(è{ 
d”efTh»adabËLßd”
(); }

77 
	g´Ùeùed
:

78 
vœtu®
 ~
Th»adabËLßd”
() { }

79 
vœtu®
 
»fTh»adabËLßd”
() = 0;

80 
vœtu®
 
d”efTh»adabËLßd”
() = 0;

	@ThreadableLoaderClient.h

31 #iâdeà
Th»adabËLßd”Cl›Á_h


32 
	#Th»adabËLßd”Cl›Á_h


	)

34 
Çme¥aû
 
	gWebCÜe
 {

36 
şass
 
	gResourûE¼Ü
;

37 
şass
 
	gResourûRe¥Ú£
;

39 şas 
	cTh»adabËLßd”Cl›Á
 : 
public
 
NÚcİyabË
 {

40 
public
:

41 
vœtu®
 
didS’dD©a
(, ) { }

43 
vœtu®
 
didReûiveRe¥Ú£
(cÚ¡ 
ResourûRe¥Ú£
&) { }

44 
vœtu®
 
didReûiveD©a
(const *, ) { }

45 
vœtu®
 
didFšishLßdšg
() { }

46 
vœtu®
 
didFa
(cÚ¡ 
ResourûE¼Ü
&) { }

47 
vœtu®
 
didFaRedœeùCheck
() { }

49 
vœtu®
 
didReûiveAuth’tiÿtiÚCªûÎ©iÚ
(cÚ¡ 
ResourûRe¥Ú£
&) { }

51 
	g´Ùeùed
:

52 
vœtu®
 ~
Th»adabËLßd”Cl›Á
() { }

	@ThreadableLoaderClientWrapper.h

31 #iâdeà
Th»adabËLßd”Cl›ÁW¿µ”_h


32 
	#Th»adabËLßd”Cl›ÁW¿µ”_h


	)

34 
	~"Th»adabËLßd”Cl›Á.h
"

35 
	~<wtf/NÚcİyabË.h
>

36 
	~<wtf/PassRefPŒ.h
>

37 
	~<wtf/Th»adšg.h
>

39 
Çme¥aû
 
	gWebCÜe
 {

41 
şass
 
	gTh»adabËLßd”Cl›ÁW¿µ”
 : 
public
 
Th»adSaãSh¬ed
<
Th»adabËLßd”Cl›ÁW¿µ”
> {

42 
public
:

43 
PassRefPŒ
<
Th»adabËLßd”Cl›ÁW¿µ”
> 
ü—‹
(
Th»adabËLßd”Cl›Á
* 
ş›Á
)

45  
adİtRef
(
Ãw
 
Th»adabËLßd”Cl›ÁW¿µ”
(
ş›Á
));

48 
ş—rCl›Á
()

50 
	gm_dÚe
 = 
Œue
;

51 
	gm_ş›Á
 = 0;

54 
boŞ
 
dÚe
() const

56  
	gm_dÚe
;

59 
didS’dD©a
(
by‹sS’t
, 
tÙ®By‹sToBeS’t
)

61 ià(
	gm_ş›Á
)

62 
	gm_ş›Á
->
didS’dD©a
(
by‹sS’t
, 
tÙ®By‹sToBeS’t
);

65 
didReûiveRe¥Ú£
(cÚ¡ 
ResourûRe¥Ú£
& 
»¥Ú£
)

67 ià(
	gm_ş›Á
)

68 
	gm_ş›Á
->
didReûiveRe¥Ú£
(
»¥Ú£
);

71 
didReûiveD©a
(cÚ¡ * 
d©a
, 
ËngthReûived
)

73 ià(
	gm_ş›Á
)

74 
	gm_ş›Á
->
didReûiveD©a
(
d©a
, 
ËngthReûived
);

77 
didFšishLßdšg
(
id’tif›r
)

79 
	gm_dÚe
 = 
Œue
;

80 ià(
	gm_ş›Á
)

81 
	gm_ş›Á
->
didFšishLßdšg
(
id’tif›r
);

84 
didFa
(cÚ¡ 
ResourûE¼Ü
& 
”rÜ
)

86 
	gm_dÚe
 = 
Œue
;

87 ià(
	gm_ş›Á
)

88 
	gm_ş›Á
->
didFa
(
”rÜ
);

91 
didFaRedœeùCheck
()

93 
	gm_dÚe
 = 
Œue
;

94 ià(
	gm_ş›Á
)

95 
	gm_ş›Á
->
didFaRedœeùCheck
();

98 
didReûiveAuth’tiÿtiÚCªûÎ©iÚ
(cÚ¡ 
ResourûRe¥Ú£
& 
»¥Ú£
)

100 ià(
	gm_ş›Á
)

101 
	gm_ş›Á
->
didReûiveRe¥Ú£
(
»¥Ú£
);

104 
	g´Ùeùed
:

105 
Th»adabËLßd”Cl›ÁW¿µ”
(
Th»adabËLßd”Cl›Á
* 
ş›Á
)

106 : 
m_ş›Á
(
ş›Á
)

107 , 
m_dÚe
(
çl£
)

111 
Th»adabËLßd”Cl›Á
* 
	gm_ş›Á
;

112 
boŞ
 
	gm_dÚe
;

	@WorkerThreadableLoader.cpp

2 #ifdeà
SSLAB__DEBUG


3 #iâdeà
SSLAB__QDATETIME


4 
	#SSLAB__QDATETIME


	)

5 
	~<QD©eTime
>

9 #ifdeà
SSLAB__DEBUG


10 #iâdeà
SSLAB__QTHREAD


11 
	#SSLAB__QTHREAD


	)

12 
	~<QTh»ad
>

45 
	~"cÚfig.h
"

47 #ià
ENABLE
(
WORKERS
)

49 
	~"WÜk”Th»adabËLßd”.h
"

51 
	~"G’”icWÜk”Task.h
"

52 
	~"ResourûE¼Ü.h
"

53 
	~"ResourûReque¡.h
"

54 
	~"ResourûRe¥Ú£.h
"

55 
	~"Th»adabËLßd”.h
"

56 
	~"WÜk”CÚ‹xt.h
"

57 
	~"WÜk”Lßd”Proxy.h
"

58 
	~"WÜk”Th»ad.h
"

59 
	~<wtf/OwnPŒ.h
>

60 
	~<wtf/Th»adšg.h
>

61 
	~<wtf/VeùÜ.h
>

63 
usšg
 
Çme¥aû
 
	g¡d
;

65 
Çme¥aû
 
	gWebCÜe
 {

67 cÚ¡ 
	glßdResourûSynchrÚou¦yMode
[] = "loadResourceSynchronouslyMode";

69 
	gWÜk”Th»adabËLßd”
::
WÜk”Th»adabËLßd”
(
WÜk”CÚ‹xt
* 
wÜk”CÚ‹xt
, 
Th»adabËLßd”Cl›Á
* 
ş›Á
, cÚ¡ 
SŒšg
& 
skMode
, cÚ¡ 
ResourûReque¡
& 
»que¡
, cÚ¡ 
Th»adabËLßd”O±iÚs
& 
İtiÚs
)

70 : 
m_wÜk”CÚ‹xt
(
wÜk”CÚ‹xt
)

71 , 
m_wÜk”Cl›ÁW¿µ”
(
Th»adabËLßd”Cl›ÁW¿µ”
::
ü—‹
(
ş›Á
))

72 , 
m_bridge
(*(
Ãw
 
MašTh»adBridge
(
m_wÜk”Cl›ÁW¿µ”
, 
m_wÜk”CÚ‹xt
->
th»ad
()->
wÜk”Lßd”Proxy
(), 
skMode
, 
»que¡
, 
İtiÚs
)))

76 
	gWÜk”Th»adabËLßd”
::~
WÜk”Th»adabËLßd”
()

78 #ifdeà
SSLAB__DEBUG


79 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

82 
	gm_bridge
.
de¡roy
();

85 
	gWÜk”Th»adabËLßd”
::
lßdResourûSynchrÚou¦y
(
WÜk”CÚ‹xt
* 
wÜk”CÚ‹xt
, cÚ¡ 
ResourûReque¡
& 
»que¡
, 
Th»adabËLßd”Cl›Á
& 
ş›Á
, cÚ¡ 
Th»adabËLßd”O±iÚs
& 
İtiÚs
)

87 #ifdeà
SSLAB__DEBUG


88 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

91 
	gWÜk”RunLoİ
& 
	grunLoİ
 = 
wÜk”CÚ‹xt
->
th»ad
()->
runLoİ
();

94 
SŒšg
 
	gmode
 = 
lßdResourûSynchrÚou¦yMode
;

95 
	gmode
.
­³nd
(
SŒšg
::
numb”
(
runLoİ
.
ü—‹UniqueId
()));

97 
	gRefPŒ
<
	gWÜk”Th»adabËLßd”
> 
	glßd”
 = 
WÜk”Th»adabËLßd”
::
ü—‹
(
wÜk”CÚ‹xt
, &
ş›Á
, 
mode
, 
»que¡
, 
İtiÚs
);

98 
Mes§geQueueWa™ResuÉ
 
	g»suÉ
 = 
Mes§geQueueMes§geReûived
;

99 !
	glßd”
->
dÚe
(è&& 
	g»suÉ
 !ğ
Mes§geQueueT”mš©ed
)

100 
»suÉ
 = 
runLoİ
.
runInMode
(
wÜk”CÚ‹xt
, 
mode
);

102 ià(!
	glßd”
->
dÚe
(è&& 
	g»suÉ
 =ğ
Mes§geQueueT”mš©ed
)

103 
lßd”
->
ÿnûl
();

106 
	gWÜk”Th»adabËLßd”
::
ÿnûl
()

108 #ifdeà
SSLAB__DEBUG


109 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

112 
	gm_bridge
.
ÿnûl
();

115 
	gWÜk”Th»adabËLßd”
::
MašTh»adBridge
::MašTh»adBridge(
PassRefPŒ
<
Th»adabËLßd”Cl›ÁW¿µ”
> 
wÜk”Cl›ÁW¿µ”
, 
WÜk”Lßd”Proxy
& 
lßd”Proxy
, cÚ¡ 
SŒšg
& 
skMode
,

116 cÚ¡ 
ResourûReque¡
& 
»que¡
, cÚ¡ 
Th»adabËLßd”O±iÚs
& 
İtiÚs
)

117 : 
m_wÜk”Cl›ÁW¿µ”
(
wÜk”Cl›ÁW¿µ”
)

118 , 
m_lßd”Proxy
(
lßd”Proxy
)

119 , 
m_skMode
(
skMode
.
üossTh»adSŒšg
())

121 #ifdeà
SSLAB__DEBUG


122 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

125 
ASSERT
(
m_wÜk”Cl›ÁW¿µ”
.
g‘
());

126 
	gm_lßd”Proxy
.
po¡TaskToLßd”
(
ü—‹C®lbackTask
(&
MašTh»adBridge
::
mašTh»adC»©eLßd”
, 
this
, 
»que¡
, 
İtiÚs
));

129 
	gWÜk”Th»adabËLßd”
::
MašTh»adBridge
::~MainThreadBridge()

131 #ifdeà
SSLAB__DEBUG


132 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

137 
	gWÜk”Th»adabËLßd”
::
MašTh»adBridge
::
mašTh»adC»©eLßd”
(
SütExecutiÚCÚ‹xt
* 
cÚ‹xt
, MašTh»adBridge* 
thisPŒ
, 
PassOwnPŒ
<
CrossTh»adResourûReque¡D©a
> 
»que¡D©a
, 
Th»adabËLßd”O±iÚs
 
İtiÚs
)

139 #ifdeà
SSLAB__DEBUG


140 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

143 
ASSERT
(
isMašTh»ad
());

144 
ASSERT
(
cÚ‹xt
->
isDocum’t
());

149 
	gOwnPŒ
<
	gResourûReque¡
> 
»que¡
(
ResourûReque¡
::
adİt
(
»que¡D©a
));

153 
	gthisPŒ
->
	gm_mašTh»adLßd”
 = 
Th»adabËLßd”
::
ü—‹
(
cÚ‹xt
, 
thisPŒ
, *
»que¡
, 
İtiÚs
);

154 
ASSERT
(
thisPŒ
->
m_mašTh»adLßd”
);

157 
	gWÜk”Th»adabËLßd”
::
MašTh»adBridge
::
mašTh»adDe¡roy
(
SütExecutiÚCÚ‹xt
* 
cÚ‹xt
, MašTh»adBridge* 
thisPŒ
)

159 #ifdeà
SSLAB__DEBUG


160 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

163 
ASSERT
(
isMašTh»ad
());

164 
ASSERT_UNUSED
(
cÚ‹xt
, cÚ‹xt->
isDocum’t
());

165 
d–‘e
 
	gthisPŒ
;

168 
	gWÜk”Th»adabËLßd”
::
MašTh»adBridge
::
de¡roy
()

170 #ifdeà
SSLAB__DEBUG


171 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

175 
ş—rCl›ÁW¿µ”
();

178 
	gm_lßd”Proxy
.
po¡TaskToLßd”
(
ü—‹C®lbackTask
(&
MašTh»adBridge
::
mašTh»adDe¡roy
, 
this
));

181 
	gWÜk”Th»adabËLßd”
::
MašTh»adBridge
::
mašTh»adCªûl
(
SütExecutiÚCÚ‹xt
* 
cÚ‹xt
, MašTh»adBridge* 
thisPŒ
)

183 #ifdeà
SSLAB__DEBUG


184 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

187 
ASSERT
(
isMašTh»ad
());

188 
ASSERT_UNUSED
(
cÚ‹xt
, cÚ‹xt->
isDocum’t
());

190 ià(!
	gthisPŒ
->
	gm_mašTh»adLßd”
)

192 
	gthisPŒ
->
	gm_mašTh»adLßd”
->
ÿnûl
();

193 
	gthisPŒ
->
	gm_mašTh»adLßd”
 = 0;

196 
	gWÜk”Th»adabËLßd”
::
MašTh»adBridge
::
ÿnûl
()

198 #ifdeà
SSLAB__DEBUG


199 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

202 
	gm_lßd”Proxy
.
po¡TaskToLßd”
(
ü—‹C®lbackTask
(&
MašTh»adBridge
::
mašTh»adCªûl
, 
this
));

203 
Th»adabËLßd”Cl›ÁW¿µ”
* 
	gş›ÁW¿µ”
 = 
m_wÜk”Cl›ÁW¿µ”
.
g‘
();

204 ià(!
	gş›ÁW¿µ”
->
dÚe
()) {

207 
ResourûE¼Ü
 
”rÜ
(
SŒšg
(), 0, String(), String());

208 
	g”rÜ
.
£tIsCªûÎ©iÚ
(
Œue
);

209 
	gş›ÁW¿µ”
->
didFa
(
”rÜ
);

211 
ş—rCl›ÁW¿µ”
();

214 
	gWÜk”Th»adabËLßd”
::
MašTh»adBridge
::
ş—rCl›ÁW¿µ”
()

216 #ifdeà
SSLAB__DEBUG


217 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

220 
	gm_wÜk”Cl›ÁW¿µ”
->
ş—rCl›Á
();

223 
wÜk”CÚ‹xtDidS’dD©a
(
SütExecutiÚCÚ‹xt
* 
cÚ‹xt
, 
RefPŒ
<
Th»adabËLßd”Cl›ÁW¿µ”
> 
wÜk”Cl›ÁW¿µ”
, 
by‹sS’t
, 
tÙ®By‹sToBeS’t
)

225 #ifdeà
SSLAB__DEBUG


226 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

229 
ASSERT_UNUSED
(
cÚ‹xt
, cÚ‹xt->
isWÜk”CÚ‹xt
());

230 
	gwÜk”Cl›ÁW¿µ”
->
didS’dD©a
(
by‹sS’t
, 
tÙ®By‹sToBeS’t
);

233 
	gWÜk”Th»adabËLßd”
::
MašTh»adBridge
::
didS’dD©a
(
by‹sS’t
, 
tÙ®By‹sToBeS’t
)

235 #ifdeà
SSLAB__DEBUG


236 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

239 
	gm_lßd”Proxy
.
po¡TaskFÜModeToWÜk”CÚ‹xt
(
ü—‹C®lbackTask
(&
wÜk”CÚ‹xtDidS’dD©a
, 
m_wÜk”Cl›ÁW¿µ”
, 
by‹sS’t
, 
tÙ®By‹sToBeS’t
), 
m_skMode
);

242 
wÜk”CÚ‹xtDidReûiveRe¥Ú£
(
SütExecutiÚCÚ‹xt
* 
cÚ‹xt
, 
RefPŒ
<
Th»adabËLßd”Cl›ÁW¿µ”
> 
wÜk”Cl›ÁW¿µ”
, 
PassOwnPŒ
<
CrossTh»adResourûRe¥Ú£D©a
> 
»¥Ú£D©a
)

244 #ifdeà
SSLAB__DEBUG


245 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

248 
ASSERT_UNUSED
(
cÚ‹xt
, cÚ‹xt->
isWÜk”CÚ‹xt
());

249 
	gOwnPŒ
<
	gResourûRe¥Ú£
> 
»¥Ú£
(
ResourûRe¥Ú£
::
adİt
(
»¥Ú£D©a
));

250 
	gwÜk”Cl›ÁW¿µ”
->
didReûiveRe¥Ú£
(*
»¥Ú£
);

253 
	gWÜk”Th»adabËLßd”
::
MašTh»adBridge
::
didReûiveRe¥Ú£
(cÚ¡ 
ResourûRe¥Ú£
& 
»¥Ú£
)

255 #ifdeà
SSLAB__DEBUG


256 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

259 
	gm_lßd”Proxy
.
po¡TaskFÜModeToWÜk”CÚ‹xt
(
ü—‹C®lbackTask
(&
wÜk”CÚ‹xtDidReûiveRe¥Ú£
, 
m_wÜk”Cl›ÁW¿µ”
, 
»¥Ú£
), 
m_skMode
);

262 
wÜk”CÚ‹xtDidReûiveD©a
(
SütExecutiÚCÚ‹xt
* 
cÚ‹xt
, 
RefPŒ
<
Th»adabËLßd”Cl›ÁW¿µ”
> 
wÜk”Cl›ÁW¿µ”
, 
PassOwnPŒ
<
VeùÜ
<> > 
veùÜD©a
)

264 #ifdeà
SSLAB__DEBUG


265 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

268 
ASSERT_UNUSED
(
cÚ‹xt
, cÚ‹xt->
isWÜk”CÚ‹xt
());

269 
	gwÜk”Cl›ÁW¿µ”
->
didReûiveD©a
(
veùÜD©a
->
d©a
(), veùÜD©a->
size
());

272 
	gWÜk”Th»adabËLßd”
::
MašTh»adBridge
::
didReûiveD©a
(cÚ¡ * 
d©a
, 
ËngthReûived
)

274 #ifdeà
SSLAB__DEBUG


275 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

278 
	gOwnPŒ
<
	gVeùÜ
<> > 
veùÜ
(
Ãw
 
VeùÜ
<>(
ËngthReûived
));

279 
memıy
(
veùÜ
->
d©a
(), d©a, 
ËngthReûived
);

280 
	gm_lßd”Proxy
.
po¡TaskFÜModeToWÜk”CÚ‹xt
(
ü—‹C®lbackTask
(&
wÜk”CÚ‹xtDidReûiveD©a
, 
m_wÜk”Cl›ÁW¿µ”
, 
veùÜ
.
»Ëa£
()), 
m_skMode
);

283 
wÜk”CÚ‹xtDidFšishLßdšg
(
SütExecutiÚCÚ‹xt
* 
cÚ‹xt
, 
RefPŒ
<
Th»adabËLßd”Cl›ÁW¿µ”
> 
wÜk”Cl›ÁW¿µ”
, 
id’tif›r
)

285 #ifdeà
SSLAB__DEBUG


286 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

289 
ASSERT_UNUSED
(
cÚ‹xt
, cÚ‹xt->
isWÜk”CÚ‹xt
());

290 
	gwÜk”Cl›ÁW¿µ”
->
didFšishLßdšg
(
id’tif›r
);

293 
	gWÜk”Th»adabËLßd”
::
MašTh»adBridge
::
didFšishLßdšg
(
id’tif›r
)

295 #ifdeà
SSLAB__DEBUG


296 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

299 
	gm_lßd”Proxy
.
po¡TaskFÜModeToWÜk”CÚ‹xt
(
ü—‹C®lbackTask
(&
wÜk”CÚ‹xtDidFšishLßdšg
, 
m_wÜk”Cl›ÁW¿µ”
, 
id’tif›r
), 
m_skMode
);

302 
wÜk”CÚ‹xtDidFa
(
SütExecutiÚCÚ‹xt
* 
cÚ‹xt
, 
RefPŒ
<
Th»adabËLßd”Cl›ÁW¿µ”
> 
wÜk”Cl›ÁW¿µ”
, cÚ¡ 
ResourûE¼Ü
& 
”rÜ
)

304 #ifdeà
SSLAB__DEBUG


305 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

308 
ASSERT_UNUSED
(
cÚ‹xt
, cÚ‹xt->
isWÜk”CÚ‹xt
());

309 
	gwÜk”Cl›ÁW¿µ”
->
didFa
(
”rÜ
);

312 
	gWÜk”Th»adabËLßd”
::
MašTh»adBridge
::
didFa
(cÚ¡ 
ResourûE¼Ü
& 
”rÜ
)

314 #ifdeà
SSLAB__DEBUG


315 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

318 
	gm_lßd”Proxy
.
po¡TaskFÜModeToWÜk”CÚ‹xt
(
ü—‹C®lbackTask
(&
wÜk”CÚ‹xtDidFa
, 
m_wÜk”Cl›ÁW¿µ”
, 
”rÜ
), 
m_skMode
);

321 
wÜk”CÚ‹xtDidFaRedœeùCheck
(
SütExecutiÚCÚ‹xt
* 
cÚ‹xt
, 
RefPŒ
<
Th»adabËLßd”Cl›ÁW¿µ”
> 
wÜk”Cl›ÁW¿µ”
)

323 #ifdeà
SSLAB__DEBUG


324 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

327 
ASSERT_UNUSED
(
cÚ‹xt
, cÚ‹xt->
isWÜk”CÚ‹xt
());

328 
	gwÜk”Cl›ÁW¿µ”
->
didFaRedœeùCheck
();

331 
	gWÜk”Th»adabËLßd”
::
MašTh»adBridge
::
didFaRedœeùCheck
()

333 #ifdeà
SSLAB__DEBUG


334 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

337 
	gm_lßd”Proxy
.
po¡TaskFÜModeToWÜk”CÚ‹xt
(
ü—‹C®lbackTask
(&
wÜk”CÚ‹xtDidFaRedœeùCheck
, 
m_wÜk”Cl›ÁW¿µ”
), 
m_skMode
);

340 
wÜk”CÚ‹xtDidReûiveAuth’tiÿtiÚCªûÎ©iÚ
(
SütExecutiÚCÚ‹xt
* 
cÚ‹xt
, 
RefPŒ
<
Th»adabËLßd”Cl›ÁW¿µ”
> 
wÜk”Cl›ÁW¿µ”
, 
PassOwnPŒ
<
CrossTh»adResourûRe¥Ú£D©a
> 
»¥Ú£D©a
)

342 #ifdeà
SSLAB__DEBUG


343 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

346 
ASSERT_UNUSED
(
cÚ‹xt
, cÚ‹xt->
isWÜk”CÚ‹xt
());

347 
	gOwnPŒ
<
	gResourûRe¥Ú£
> 
»¥Ú£
(
ResourûRe¥Ú£
::
adİt
(
»¥Ú£D©a
));

348 
	gwÜk”Cl›ÁW¿µ”
->
didReûiveAuth’tiÿtiÚCªûÎ©iÚ
(*
»¥Ú£
);

351 
	gWÜk”Th»adabËLßd”
::
MašTh»adBridge
::
didReûiveAuth’tiÿtiÚCªûÎ©iÚ
(cÚ¡ 
ResourûRe¥Ú£
& 
»¥Ú£
)

353 #ifdeà
SSLAB__DEBUG


354 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

357 
	gm_lßd”Proxy
.
po¡TaskFÜModeToWÜk”CÚ‹xt
(
ü—‹C®lbackTask
(&
wÜk”CÚ‹xtDidReûiveAuth’tiÿtiÚCªûÎ©iÚ
, 
m_wÜk”Cl›ÁW¿µ”
, 
»¥Ú£
), 
m_skMode
);

	@WorkerThreadableLoader.h

31 #iâdeà
WÜk”Th»adabËLßd”_h


32 
	#WÜk”Th»adabËLßd”_h


	)

34 #ià
ENABLE
(
WORKERS
)

36 
	~"PÏtfÜmSŒšg.h
"

37 
	~"Th»adabËLßd”.h
"

38 
	~"Th»adabËLßd”Cl›Á.h
"

39 
	~"Th»adabËLßd”Cl›ÁW¿µ”.h
"

41 
	~<wtf/PassOwnPŒ.h
>

42 
	~<wtf/PassRefPŒ.h
>

43 
	~<wtf/RefCouÁed.h
>

44 
	~<wtf/RefPŒ.h
>

45 
	~<wtf/Th»adšg.h
>

47 
Çme¥aû
 
	gWebCÜe
 {

49 
şass
 
	gResourûE¼Ü
;

50 
şass
 
	gResourûReque¡
;

51 
şass
 
	gWÜk”CÚ‹xt
;

52 
şass
 
	gWÜk”Lßd”Proxy
;

53 
	gCrossTh»adResourûRe¥Ú£D©a
;

54 
	gCrossTh»adResourûReque¡D©a
;

56 
şass
 
	gWÜk”Th»adabËLßd”
 : 
public
 
RefCouÁed
<
WÜk”Th»adabËLßd”
>,…ubliø
	gTh»adabËLßd”
 {

57 
	gpublic
:

58 
lßdResourûSynchrÚou¦y
(
WÜk”CÚ‹xt
*, cÚ¡ 
ResourûReque¡
&, 
Th»adabËLßd”Cl›Á
&, cÚ¡ 
Th»adabËLßd”O±iÚs
&);

59 
	gPassRefPŒ
<
	gWÜk”Th»adabËLßd”
> 
ü—‹
(
WÜk”CÚ‹xt
* 
wÜk”CÚ‹xt
, 
Th»adabËLßd”Cl›Á
* 
ş›Á
, cÚ¡ 
SŒšg
& 
skMode
, cÚ¡ 
ResourûReque¡
& 
»que¡
, cÚ¡ 
Th»adabËLßd”O±iÚs
& 
İtiÚs
)

61  
adİtRef
(
Ãw
 
WÜk”Th»adabËLßd”
(
wÜk”CÚ‹xt
, 
ş›Á
, 
skMode
, 
»que¡
, 
İtiÚs
));

64 ~
WÜk”Th»adabËLßd”
();

66 
vœtu®
 
ÿnûl
();

68 
boŞ
 
dÚe
(ècÚ¡ {  
	gm_wÜk”Cl›ÁW¿µ”
->done(); }

70 
usšg
 
	gRefCouÁed
<
	gWÜk”Th»adabËLßd”
>::
»f
;

71 
usšg
 
	gRefCouÁed
<
	gWÜk”Th»adabËLßd”
>::
d”ef
;

73 
	g´Ùeùed
:

74 
vœtu®
 
»fTh»adabËLßd”
(è{ 
»f
(); }

75 
vœtu®
 
d”efTh»adabËLßd”
(è{ 
d”ef
(); }

77 
	g´iv©e
:

97 şas 
	cMašTh»adBridge
 : 
public
 
Th»adabËLßd”Cl›Á
 {

98 
public
:

100 
MašTh»adBridge
(
PassRefPŒ
<
Th»adabËLßd”Cl›ÁW¿µ”
>, 
WÜk”Lßd”Proxy
&, cÚ¡ 
SŒšg
& 
skMode
, cÚ¡ 
ResourûReque¡
&, cÚ¡ 
Th»adabËLßd”O±iÚs
&);

101 
ÿnûl
();

102 
de¡roy
();

104 
	g´iv©e
:

106 
ş—rCl›ÁW¿µ”
();

109 
mašTh»adDe¡roy
(
SütExecutiÚCÚ‹xt
*, 
MašTh»adBridge
*);

110 ~
MašTh»adBridge
();

112 
mašTh»adC»©eLßd”
(
SütExecutiÚCÚ‹xt
*, 
MašTh»adBridge
*, 
PassOwnPŒ
<
CrossTh»adResourûReque¡D©a
>, 
Th»adabËLßd”O±iÚs
);

113 
mašTh»adCªûl
(
SütExecutiÚCÚ‹xt
*, 
MašTh»adBridge
*);

114 
vœtu®
 
didS’dD©a
(
by‹sS’t
, 
tÙ®By‹sToBeS’t
);

115 
vœtu®
 
didReûiveRe¥Ú£
(cÚ¡ 
ResourûRe¥Ú£
&);

116 
vœtu®
 
didReûiveD©a
(cÚ¡ *, 
ËngthReûived
);

117 
vœtu®
 
didFšishLßdšg
(
id’tif›r
);

118 
vœtu®
 
didFa
(cÚ¡ 
ResourûE¼Ü
&);

119 
vœtu®
 
didFaRedœeùCheck
();

120 
vœtu®
 
didReûiveAuth’tiÿtiÚCªûÎ©iÚ
(cÚ¡ 
ResourûRe¥Ú£
&);

123 
	gRefPŒ
<
	gTh»adabËLßd”
> 
	gm_mašTh»adLßd”
;

127 
	gRefPŒ
<
	gTh»adabËLßd”Cl›ÁW¿µ”
> 
	gm_wÜk”Cl›ÁW¿µ”
;

130 
	gWÜk”Lßd”Proxy
& 
	gm_lßd”Proxy
;

133 
SŒšg
 
	gm_skMode
;

136 
WÜk”Th»adabËLßd”
(
WÜk”CÚ‹xt
*, 
Th»adabËLßd”Cl›Á
*, cÚ¡ 
SŒšg
& 
skMode
, cÚ¡ 
ResourûReque¡
&, cÚ¡ 
Th»adabËLßd”O±iÚs
&);

138 
	gRefPŒ
<
	gWÜk”CÚ‹xt
> 
	gm_wÜk”CÚ‹xt
;

139 
	gRefPŒ
<
	gTh»adabËLßd”Cl›ÁW¿µ”
> 
	gm_wÜk”Cl›ÁW¿µ”
;

140 
	gMašTh»adBridge
& 
	gm_bridge
;

	@appcache/ApplicationCache.cpp

2 #ifdeà
SSLAB__DEBUG


3 #iâdeà
SSLAB__QDATETIME


4 
	#SSLAB__QDATETIME


	)

5 
	~<QD©eTime
>

9 #ifdeà
SSLAB__DEBUG


10 #iâdeà
SSLAB__QTHREAD


11 
	#SSLAB__QTHREAD


	)

12 
	~<QTh»ad
>

40 
	~"cÚfig.h
"

41 
	~"AµliÿtiÚCache.h
"

43 #ià
ENABLE
(
OFFLINE_WEB_APPLICATIONS
)

45 
	~"AµliÿtiÚCacheGroup.h
"

46 
	~"AµliÿtiÚCacheResourû.h
"

47 
	~"AµliÿtiÚCacheStÜage.h
"

48 
	~"ResourûReque¡.h
"

49 
	~<¡dio.h
>

51 
Çme¥aû
 
	gWebCÜe
 {

53 
	gAµliÿtiÚCache
::
AµliÿtiÚCache
()

54 : 
m_group
(0)

55 , 
m_mªiã¡
(0)

56 , 
m_e¡im©edSizeInStÜage
(0)

57 , 
m_¡ÜageID
(0)

59 #ifdeà
SSLAB__DEBUG


60 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

65 
	gAµliÿtiÚCache
::~
AµliÿtiÚCache
()

67 #ifdeà
SSLAB__DEBUG


68 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

71 ià(
	gm_group
 && !m_group->
isCİy
())

72 
	gm_group
->
ÿcheDe¡royed
(
this
);

75 
	gAµliÿtiÚCache
::
£tGroup
(
AµliÿtiÚCacheGroup
* 
group
)

77 #ifdeà
SSLAB__DEBUG


78 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

81 
ASSERT
(!
m_group
 || 
group
 == m_group);

82 
	gm_group
 = 
group
;

85 
boŞ
 
	gAµliÿtiÚCache
::
isCom¶‘e
() const

87 #ifdeà
SSLAB__DEBUG


88 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

91  !
	gm_group
->
ÿcheIsBešgUpd©ed
(
this
);

94 
	gAµliÿtiÚCache
::
£tMªiã¡Resourû
(
PassRefPŒ
<
AµliÿtiÚCacheResourû
> 
mªiã¡
)

96 #ifdeà
SSLAB__DEBUG


97 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

100 
ASSERT
(
mªiã¡
);

101 
ASSERT
(!
m_mªiã¡
);

102 
ASSERT
(
mªiã¡
->
ty³
(è& 
AµliÿtiÚCacheResourû
::
Mªiã¡
);

104 
	gm_mªiã¡
 = 
mªiã¡
.
g‘
();

106 
addResourû
(
mªiã¡
);

109 
	gAµliÿtiÚCache
::
addResourû
(
PassRefPŒ
<
AµliÿtiÚCacheResourû
> 
»sourû
)

111 #ifdeà
SSLAB__DEBUG


112 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

115 
ASSERT
(
»sourû
);

117 cÚ¡ 
	gSŒšg
& 
	gu¾
 = 
»sourû
->
u¾
();

119 
ASSERT
(!
m_»sourûs
.
cÚšs
(
u¾
));

121 ià(
	gm_¡ÜageID
) {

122 
ASSERT
(!
»sourû
->
¡ÜageID
());

123 
ASSERT
(
»sourû
->
ty³
(è& 
AµliÿtiÚCacheResourû
::
Ma¡”
);

126 
ÿcheStÜage
().
¡Üe
(
»sourû
.
g‘
(), 
this
);

129 
	gm_e¡im©edSizeInStÜage
 +ğ
»sourû
->
e¡im©edSizeInStÜage
();

131 
	gm_»sourûs
.
£t
(
u¾
, 
»sourû
);

134 
	gAµliÿtiÚCache
::
»moveResourû
(cÚ¡ 
SŒšg
& 
u¾
)

136 #ifdeà
SSLAB__DEBUG


137 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

140 
	gHashM­
<
	gSŒšg
, 
	gRefPŒ
<
	gAµliÿtiÚCacheResourû
> >::
™”©Ü
 
™
 = 
m_»sourûs
.
fšd
(
u¾
);

141 ià(
	g™
 =ğ
m_»sourûs
.
’d
())

145 
	gty³
 = 
™
->
£cÚd
->
ty³
();

147 
	gm_»sourûs
.
»move
(
™
);

149 
	gm_e¡im©edSizeInStÜage
 -ğ
™
->
£cÚd
->
e¡im©edSizeInStÜage
();

151  
	gty³
;

154 
AµliÿtiÚCacheResourû
* 
	gAµliÿtiÚCache
::
»sourûFÜURL
(cÚ¡ 
SŒšg
& 
u¾
)

156 #ifdeà
SSLAB__DEBUG


157 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

160 
ASSERT
(!
KURL
(
P¬£dURLSŒšg
, 
u¾
).
hasF¿gm’tId’tif›r
());

161  
	gm_»sourûs
.
g‘
(
u¾
).get();

164 
boŞ
 
	gAµliÿtiÚCache
::
»que¡IsHTTPOrHTTPSG‘
(cÚ¡ 
ResourûReque¡
& 
»que¡
)

166 #ifdeà
SSLAB__DEBUG


167 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

170 ià(!
	g»que¡
.
u¾
().
´ÙocŞInHTTPFamy
())

171  
	gçl£
;

173 ià(!
equ®IgnÜšgCa£
(
»que¡
.
h‰pM‘hod
(), "GET"))

174  
	gçl£
;

176  
	gŒue
;

179 
AµliÿtiÚCacheResourû
* 
	gAµliÿtiÚCache
::
»sourûFÜReque¡
(cÚ¡ 
ResourûReque¡
& 
»que¡
)

181 #ifdeà
SSLAB__DEBUG


182 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

186 ià(!
»que¡IsHTTPOrHTTPSG‘
(
»que¡
))

187  
	gçl£
;

189 
KURL
 
u¾
(
»que¡
.url());

190 ià(
	gu¾
.
hasF¿gm’tId’tif›r
())

191 
	gu¾
.
»moveF¿gm’tId’tif›r
();

193  
»sourûFÜURL
(
u¾
);

196 
	gAµliÿtiÚCache
::
£tOÆšeWh™–i¡
(cÚ¡ 
VeùÜ
<
KURL
>& 
ÚlšeWh™–i¡
)

198 #ifdeà
SSLAB__DEBUG


199 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

202 
ASSERT
(
m_ÚlšeWh™–i¡
.
isEm±y
());

203 
	gm_ÚlšeWh™–i¡
 = 
ÚlšeWh™–i¡
;

206 
boŞ
 
	gAµliÿtiÚCache
::
isURLInOÆšeWh™–i¡
(cÚ¡ 
KURL
& 
u¾
)

208 #ifdeà
SSLAB__DEBUG


209 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

212 ià(
	gm_®lowAÎN‘wÜkReque¡s
)

213  
	gŒue
;

215 
size_t
 
	gwh™–i¡Size
 = 
m_ÚlšeWh™–i¡
.
size
();

216 
size_t
 
	gi
 = 0; i < 
	gwh™–i¡Size
; ++i) {

217 ià(
´ÙocŞHo¡AndPÜtA»Equ®
(
u¾
, 
m_ÚlšeWh™–i¡
[
i
]è&& 
	gu¾
.
¡ršg
().
¡¬tsW™h
(m_onlineWhitelist[i].string()))

218  
	gŒue
;

220  
	gçl£
;

223 
	gAµliÿtiÚCache
::
£tF®lbackURLs
(cÚ¡ 
F®lbackURLVeùÜ
& 
çÎbackURLs
)

225 #ifdeà
SSLAB__DEBUG


226 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

229 
ASSERT
(
m_çÎbackURLs
.
isEm±y
());

230 
	gm_çÎbackURLs
 = 
çÎbackURLs
;

233 
boŞ
 
	gAµliÿtiÚCache
::
u¾M©chesF®lbackName¥aû
(cÚ¡ 
KURL
& 
u¾
, KURL* 
çÎbackURL
)

235 #ifdeà
SSLAB__DEBUG


236 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

239 
size_t
 
	gçÎbackCouÁ
 = 
m_çÎbackURLs
.
size
();

240 
size_t
 
	gi
 = 0; i < 
	gçÎbackCouÁ
; ++i) {

241 ià(
´ÙocŞHo¡AndPÜtA»Equ®
(
u¾
, 
m_çÎbackURLs
[
i
].
fœ¡
è&& 
	gu¾
.
¡ršg
().
¡¬tsW™h
(m_fallbackURLs[i].first.string())) {

242 ià(
	gçÎbackURL
)

243 *
	gçÎbackURL
 = 
m_çÎbackURLs
[
i
].
£cÚd
;

244  
	gŒue
;

247  
	gçl£
;

250 
	gAµliÿtiÚCache
::
ş—rStÜageID
()

252 #ifdeà
SSLAB__DEBUG


253 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

256 
	gm_¡ÜageID
 = 0;

258 
	gResourûM­
::
cÚ¡_™”©Ü
 
’d
 = 
m_»sourûs
.end();

259 
	gResourûM­
::
cÚ¡_™”©Ü
 
™
 = 
m_»sourûs
.
begš
(); 
	g™
 !ğ
’d
; ++it)

260 
	g™
->
	g£cÚd
->
ş—rStÜageID
();

263 #iâdeà
NDEBUG


264 
	gAµliÿtiÚCache
::
dump
()

266 #ifdeà
SSLAB__DEBUG


267 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

270 
	gHashM­
<
	gSŒšg
, 
	gRefPŒ
<
	gAµliÿtiÚCacheResourû
> >::
cÚ¡_™”©Ü
 
’d
 = 
m_»sourûs
.end();

272 
	gHashM­
<
	gSŒšg
, 
	gRefPŒ
<
	gAµliÿtiÚCacheResourû
> >::
cÚ¡_™”©Ü
 
™
 = 
m_»sourûs
.
begš
(); 
	g™
 !ğ
’d
; ++it) {

273 
´štf
("% ", 
™
->
fœ¡
.
ascii
().
d©a
());

274 
	gAµliÿtiÚCacheResourû
::
dumpTy³
(
™
->
£cÚd
->
ty³
());

	@appcache/ApplicationCache.h

26 #iâdeà
AµliÿtiÚCache_h


27 
	#AµliÿtiÚCache_h


	)

29 #ià
ENABLE
(
OFFLINE_WEB_APPLICATIONS
)

31 
	~"PÏtfÜmSŒšg.h
"

32 
	~"SŒšgHash.h
"

33 
	~<wtf/HashM­.h
>

34 
	~<wtf/HashS‘.h
>

35 
	~<wtf/PassRefPŒ.h
>

36 
	~<wtf/RefCouÁed.h
>

38 
Çme¥aû
 
	gWebCÜe
 {

40 
şass
 
	gAµliÿtiÚCacheGroup
;

41 
şass
 
	gAµliÿtiÚCacheResourû
;

42 
şass
 
	gDocum’tLßd”
;

43 
şass
 
	gKURL
;

45 
şass
 
	gResourûReque¡
;

47 
	gVeùÜ
<
	t¡d
::
	t·œ
<
	tKURL
, KURL> > 
	tF®lbackURLVeùÜ
;

49 
şass
 
	gAµliÿtiÚCache
 : 
public
 
RefCouÁed
<
AµliÿtiÚCache
> {

50 
public
:

51 
PassRefPŒ
<
AµliÿtiÚCache
> 
ü—‹
(è{  
adİtRef
(
Ãw
 ApplicationCache); }

52 ~
AµliÿtiÚCache
();

54 
addResourû
(
PassRefPŒ
<
AµliÿtiÚCacheResourû
> 
»sourû
);

55 
»moveResourû
(cÚ¡ 
SŒšg
& 
u¾
);

57 
£tMªiã¡Resourû
(
PassRefPŒ
<
AµliÿtiÚCacheResourû
> 
mªiã¡
);

58 
AµliÿtiÚCacheResourû
* 
mªiã¡Resourû
(ècÚ¡ {  
	gm_mªiã¡
; }

60 
£tGroup
(
AµliÿtiÚCacheGroup
*);

61 
AµliÿtiÚCacheGroup
* 
group
(ècÚ¡ {  
	gm_group
; }

63 
boŞ
 
isCom¶‘e
() const;

65 
AµliÿtiÚCacheResourû
* 
»sourûFÜReque¡
(cÚ¡ 
ResourûReque¡
&);

66 
AµliÿtiÚCacheResourû
* 
»sourûFÜURL
(cÚ¡ 
SŒšg
& 
u¾
);

68 
£tAÎowsAÎN‘wÜkReque¡s
(
boŞ
 
v®ue
è{ 
	gm_®lowAÎN‘wÜkReque¡s
 = value; }

69 
boŞ
 
®lowsAÎN‘wÜkReque¡s
(ècÚ¡ {  
	gm_®lowAÎN‘wÜkReque¡s
; }

70 
£tOÆšeWh™–i¡
(cÚ¡ 
VeùÜ
<
KURL
>& 
ÚlšeWh™–i¡
);

71 cÚ¡ 
	gVeùÜ
<
	gKURL
>& 
ÚlšeWh™–i¡
(ècÚ¡ {  
	gm_ÚlšeWh™–i¡
; }

72 
boŞ
 
isURLInOÆšeWh™–i¡
(cÚ¡ 
KURL
&);

74 
£tF®lbackURLs
(cÚ¡ 
F®lbackURLVeùÜ
&);

75 cÚ¡ 
	gF®lbackURLVeùÜ
& 
çÎbackURLs
(ècÚ¡ {  
	gm_çÎbackURLs
; }

76 
boŞ
 
u¾M©chesF®lbackName¥aû
(cÚ¡ 
KURL
&, KURL* 
çÎbackURL
 = 0);

78 #iâdeà
NDEBUG


79 
dump
();

82 
	gHashM­
<
	tSŒšg
, 
	tRefPŒ
<
	tAµliÿtiÚCacheResourû
> > 
	tResourûM­
;

83 
	gResourûM­
::
cÚ¡_™”©Ü
 
begš
(ècÚ¡ {  
m_»sourûs
.begin(); }

84 
	gResourûM­
::
cÚ¡_™”©Ü
 
’d
(ècÚ¡ {  
m_»sourûs
.end(); }

86 
£tStÜageID
(
¡ÜageID
è{ 
	gm_¡ÜageID
 = storageID; }

87 
¡ÜageID
(ècÚ¡ {  
	gm_¡ÜageID
; }

88 
ş—rStÜageID
();

90 
boŞ
 
»que¡IsHTTPOrHTTPSG‘
(cÚ¡ 
ResourûReque¡
&);

92 
št64_t
 
e¡im©edSizeInStÜage
(ècÚ¡ {  
	gm_e¡im©edSizeInStÜage
; }

94 
	g´iv©e
:

95 
AµliÿtiÚCache
();

97 
AµliÿtiÚCacheGroup
* 
	gm_group
;

98 
ResourûM­
 
	gm_»sourûs
;

99 
AµliÿtiÚCacheResourû
* 
	gm_mªiã¡
;

101 
boŞ
 
	gm_®lowAÎN‘wÜkReque¡s
;

102 
	gVeùÜ
<
	gKURL
> 
	gm_ÚlšeWh™–i¡
;

103 
F®lbackURLVeùÜ
 
	gm_çÎbackURLs
;

108 
št64_t
 
	gm_e¡im©edSizeInStÜage
;

110 
	gm_¡ÜageID
;

	@appcache/ApplicationCacheGroup.cpp

2 #ifdeà
SSLAB__DEBUG


3 #iâdeà
SSLAB__QDATETIME


4 
	#SSLAB__QDATETIME


	)

5 
	~<QD©eTime
>

9 #ifdeà
SSLAB__DEBUG


10 #iâdeà
SSLAB__QTHREAD


11 
	#SSLAB__QTHREAD


	)

12 
	~<QTh»ad
>

40 
	~"cÚfig.h
"

41 
	~"AµliÿtiÚCacheGroup.h
"

43 #ià
ENABLE
(
OFFLINE_WEB_APPLICATIONS
)

45 
	~"AµliÿtiÚCache.h
"

46 
	~"AµliÿtiÚCacheHo¡.h
"

47 
	~"AµliÿtiÚCacheResourû.h
"

48 
	~"AµliÿtiÚCacheStÜage.h
"

49 
	~"Chrome.h
"

50 
	~"ChromeCl›Á.h
"

51 
	~"Docum’tLßd”.h
"

52 
	~"DOMAµliÿtiÚCache.h
"

53 
	~"DOMWšdow.h
"

54 
	~"F¿me.h
"

55 
	~"F¿meLßd”.h
"

56 
	~"MašResourûLßd”.h
"

57 
	~"Mªiã¡P¬£r.h
"

58 
	~"Page.h
"

59 
	~"S‘tšgs.h
"

60 
	~<wtf/HashM­.h
>

62 
Çme¥aû
 
	gWebCÜe
 {

64 
	gAµliÿtiÚCacheGroup
::
AµliÿtiÚCacheGroup
(cÚ¡ 
KURL
& 
mªiã¡URL
, 
boŞ
 
isCİy
)

65 : 
m_mªiã¡URL
(
mªiã¡URL
)

66 , 
m_upd©eStus
(
IdË
)

67 , 
m_dowÆßdšgP’dšgMa¡”ResourûLßd”sCouÁ
(0)

68 , 
m_äame
(0)

69 , 
m_¡ÜageID
(0)

70 , 
m_isObsŞ‘e
(
çl£
)

71 , 
m_com¶‘iÚTy³
(
NÚe
)

72 , 
m_isCİy
(
isCİy
)

73 , 
m_ÿÎedR—chedMaxAµCacheSize
(
çl£
)

75 #ifdeà
SSLAB__DEBUG


76 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

81 
	gAµliÿtiÚCacheGroup
::~
AµliÿtiÚCacheGroup
()

83 #ifdeà
SSLAB__DEBUG


84 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

87 ià(
	gm_isCİy
) {

88 
ASSERT
(
m_Ãwe¡Cache
);

89 
ASSERT
(
m_ÿches
.
size
() == 1);

90 
ASSERT
(
m_ÿches
.
cÚšs
(
m_Ãwe¡Cache
.
g‘
()));

91 
ASSERT
(!
m_ÿcheBešgUpd©ed
);

92 
ASSERT
(
m_assocŸ‹dDocum’tLßd”s
.
isEm±y
());

93 
ASSERT
(
m_³ndšgMa¡”ResourûLßd”s
.
isEm±y
());

94 
ASSERT
(
m_Ãwe¡Cache
->
group
(è=ğ
this
);

99 
ASSERT
(!
m_Ãwe¡Cache
);

100 
ASSERT
(
m_ÿches
.
isEm±y
());

102 
¡İLßdšg
();

104 
ÿcheStÜage
().
ÿcheGroupDe¡royed
(
this
);

107 
AµliÿtiÚCache
* 
	gAµliÿtiÚCacheGroup
::
ÿcheFÜMašReque¡
(cÚ¡ 
ResourûReque¡
& 
»que¡
, 
Docum’tLßd”
*)

109 #ifdeà
SSLAB__DEBUG


110 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

113 ià(!
	gAµliÿtiÚCache
::
»que¡IsHTTPOrHTTPSG‘
(
»que¡
))

116 
KURL
 
u¾
(
»que¡
.url());

117 ià(
	gu¾
.
hasF¿gm’tId’tif›r
())

118 
	gu¾
.
»moveF¿gm’tId’tif›r
();

120 ià(
AµliÿtiÚCacheGroup
* 
	ggroup
 = 
ÿcheStÜage
().
ÿcheGroupFÜURL
(
u¾
)) {

121 
ASSERT
(
group
->
Ãwe¡Cache
());

122 
ASSERT
(!
group
->
isObsŞ‘e
());

124  
	ggroup
->
Ãwe¡Cache
();

130 
AµliÿtiÚCache
* 
	gAµliÿtiÚCacheGroup
::
çÎbackCacheFÜMašReque¡
(cÚ¡ 
ResourûReque¡
& 
»que¡
, 
Docum’tLßd”
*)

132 #ifdeà
SSLAB__DEBUG


133 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

136 ià(!
	gAµliÿtiÚCache
::
»que¡IsHTTPOrHTTPSG‘
(
»que¡
))

139 
KURL
 
u¾
(
»que¡
.url());

140 ià(
	gu¾
.
hasF¿gm’tId’tif›r
())

141 
	gu¾
.
»moveF¿gm’tId’tif›r
();

143 ià(
AµliÿtiÚCacheGroup
* 
	ggroup
 = 
ÿcheStÜage
().
çÎbackCacheGroupFÜURL
(
u¾
)) {

144 
ASSERT
(
group
->
Ãwe¡Cache
());

145 
ASSERT
(!
group
->
isObsŞ‘e
());

147  
	ggroup
->
Ãwe¡Cache
();

153 
	gAµliÿtiÚCacheGroup
::
£ËùCache
(
F¿me
* 
äame
, cÚ¡ 
KURL
& 
·s£dMªiã¡URL
)

155 #ifdeà
SSLAB__DEBUG


156 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

159 
ASSERT
(
äame
 && f¿me->
·ge
());

161 ià(!
	gäame
->
£‰šgs
()->
ofæšeWebAµliÿtiÚCacheEÇbËd
())

164 
Docum’tLßd”
* 
	gdocum’tLßd”
 = 
äame
->
lßd”
()->
docum’tLßd”
();

165 
ASSERT
(!
docum’tLßd”
->
­¶iÿtiÚCacheHo¡
()->
­¶iÿtiÚCache
());

167 ià(
	g·s£dMªiã¡URL
.
isNuÎ
()) {

168 
£ËùCacheW™houtMªiã¡URL
(
äame
);

172 
KURL
 
mªiã¡URL
(
·s£dMªiã¡URL
);

173 ià(
	gmªiã¡URL
.
hasF¿gm’tId’tif›r
())

174 
	gmªiã¡URL
.
»moveF¿gm’tId’tif›r
();

176 
AµliÿtiÚCache
* 
	gmašResourûCache
 = 
docum’tLßd”
->
­¶iÿtiÚCacheHo¡
()->
mašResourûAµliÿtiÚCache
();

178 ià(
	gmašResourûCache
) {

179 ià(
	gmªiã¡URL
 =ğ
mašResourûCache
->
group
()->
m_mªiã¡URL
) {

180 
mašResourûCache
->
group
()->
assocŸ‹Docum’tLßd”W™hCache
(
docum’tLßd”
, mainResourceCache);

181 
	gmašResourûCache
->
group
()->
upd©e
(
äame
, 
AµliÿtiÚCacheUpd©eW™hBrowsšgCÚ‹xt
);

184 
KURL
 
docum’tURL
(
docum’tLßd”
->
u¾
());

185 ià(
	gdocum’tURL
.
hasF¿gm’tId’tif›r
())

186 
	gdocum’tURL
.
»moveF¿gm’tId’tif›r
();

187 
AµliÿtiÚCacheResourû
* 
	g»sourû
 = 
mašResourûCache
->
»sourûFÜURL
(
docum’tURL
);

188 
boŞ
 
	gšStÜage
 = 
»sourû
->
¡ÜageID
();

189 
	g»sourû
->
addTy³
(
AµliÿtiÚCacheResourû
::
FÜeign
);

190 ià(
	gšStÜage
)

191 
ÿcheStÜage
().
¡ÜeUpd©edTy³
(
»sourû
, 
mašResourûCache
);

196 
	gäame
->
»dœeùScheduËr
()->
scheduËLoÿtiÚChªge
(
docum’tLßd”
->
u¾
(), 
äame
->
lßd”
()->
»ã¼”
(), 
Œue
);

203 cÚ¡ 
	gResourûReque¡
& 
	g»que¡
 = 
äame
->
lßd”
()->
aùiveDocum’tLßd”
()->
»que¡
();

205 ià(!
	gAµliÿtiÚCache
::
»que¡IsHTTPOrHTTPSG‘
(
»que¡
))

209 ià(!
´ÙocŞHo¡AndPÜtA»Equ®
(
mªiã¡URL
, 
»que¡
.
u¾
()))

213 ià(!
	gäame
->
£‰šgs
(è|| f¿me->£‰šgs()->
´iv©eBrowsšgEÇbËd
()) {

214 
po¡Li¡’”Task
(
AµliÿtiÚCacheHo¡
::
CHECKING_EVENT
, 
docum’tLßd”
);

215 
po¡Li¡’”Task
(
AµliÿtiÚCacheHo¡
::
ERROR_EVENT
, 
docum’tLßd”
);

219 
AµliÿtiÚCacheGroup
* 
	ggroup
 = 
ÿcheStÜage
().
fšdOrC»©eCacheGroup
(
mªiã¡URL
);

221 
	gdocum’tLßd”
->
­¶iÿtiÚCacheHo¡
()->
£tCªdid©eAµliÿtiÚCacheGroup
(
group
);

222 
	ggroup
->
	gm_³ndšgMa¡”ResourûLßd”s
.
add
(
docum’tLßd”
);

223 
	ggroup
->
	gm_dowÆßdšgP’dšgMa¡”ResourûLßd”sCouÁ
++;

225 
ASSERT
(!
group
->
m_ÿcheBešgUpd©ed
 || group->
m_upd©eStus
 !ğ
IdË
);

226 
	ggroup
->
upd©e
(
äame
, 
AµliÿtiÚCacheUpd©eW™hBrowsšgCÚ‹xt
);

229 
	gAµliÿtiÚCacheGroup
::
£ËùCacheW™houtMªiã¡URL
(
F¿me
* 
äame
)

231 #ifdeà
SSLAB__DEBUG


232 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

235 ià(!
	gäame
->
£‰šgs
()->
ofæšeWebAµliÿtiÚCacheEÇbËd
())

238 
Docum’tLßd”
* 
	gdocum’tLßd”
 = 
äame
->
lßd”
()->
docum’tLßd”
();

239 
ASSERT
(!
docum’tLßd”
->
­¶iÿtiÚCacheHo¡
()->
­¶iÿtiÚCache
());

241 
AµliÿtiÚCache
* 
	gmašResourûCache
 = 
docum’tLßd”
->
­¶iÿtiÚCacheHo¡
()->
mašResourûAµliÿtiÚCache
();

243 ià(
	gmašResourûCache
) {

244 
	gmašResourûCache
->
group
()->
assocŸ‹Docum’tLßd”W™hCache
(
docum’tLßd”
, 
mašResourûCache
);

245 
	gmašResourûCache
->
group
()->
upd©e
(
äame
, 
AµliÿtiÚCacheUpd©eW™hBrowsšgCÚ‹xt
);

249 
	gAµliÿtiÚCacheGroup
::
fšishedLßdšgMašResourû
(
Docum’tLßd”
* 
lßd”
)

251 #ifdeà
SSLAB__DEBUG


252 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

255 
ASSERT
(
m_³ndšgMa¡”ResourûLßd”s
.
cÚšs
(
lßd”
));

256 
ASSERT
(
m_com¶‘iÚTy³
 =ğ
NÚe
 || 
m_³ndšgEÁr›s
.
isEm±y
());

257 
KURL
 
	gu¾
 = 
lßd”
->
u¾
();

258 ià(
	gu¾
.
hasF¿gm’tId’tif›r
())

259 
	gu¾
.
»moveF¿gm’tId’tif›r
();

261 
	gm_com¶‘iÚTy³
) {

262 
	gNÚe
:

265 
	gNoUpd©e
:

266 
ASSERT
(!
m_ÿcheBešgUpd©ed
);

267 
assocŸ‹Docum’tLßd”W™hCache
(
lßd”
, 
m_Ãwe¡Cache
.
g‘
());

269 ià(
AµliÿtiÚCacheResourû
* 
	g»sourû
 = 
m_Ãwe¡Cache
->
»sourûFÜURL
(
u¾
)) {

270 ià(!(
»sourû
->
ty³
(è& 
AµliÿtiÚCacheResourû
::
Ma¡”
)) {

271 
»sourû
->
addTy³
(
AµliÿtiÚCacheResourû
::
Ma¡”
);

272 
ASSERT
(!
»sourû
->
¡ÜageID
());

275 
	gm_Ãwe¡Cache
->
addResourû
(
AµliÿtiÚCacheResourû
::
ü—‹
(
u¾
, 
lßd”
->
»¥Ú£
(), AµliÿtiÚCacheResourû::
Ma¡”
,†ßd”->
mašResourûD©a
()));

278 
	gFau»
:

281 
ASSERT
(!
m_ÿcheBešgUpd©ed
);

282 
	glßd”
->
­¶iÿtiÚCacheHo¡
()->
£tAµliÿtiÚCache
(0);

283 
	gm_assocŸ‹dDocum’tLßd”s
.
»move
(
lßd”
);

284 
po¡Li¡’”Task
(
AµliÿtiÚCacheHo¡
::
ERROR_EVENT
, 
lßd”
);

286 
	gCom¶‘ed
:

287 
ASSERT
(
m_assocŸ‹dDocum’tLßd”s
.
cÚšs
(
lßd”
));

289 ià(
AµliÿtiÚCacheResourû
* 
	g»sourû
 = 
m_ÿcheBešgUpd©ed
->
»sourûFÜURL
(
u¾
)) {

290 ià(!(
»sourû
->
ty³
(è& 
AµliÿtiÚCacheResourû
::
Ma¡”
)) {

291 
»sourû
->
addTy³
(
AµliÿtiÚCacheResourû
::
Ma¡”
);

292 
ASSERT
(!
»sourû
->
¡ÜageID
());

295 
	gm_ÿcheBešgUpd©ed
->
addResourû
(
AµliÿtiÚCacheResourû
::
ü—‹
(
u¾
, 
lßd”
->
»¥Ú£
(), AµliÿtiÚCacheResourû::
Ma¡”
,†ßd”->
mašResourûD©a
()));

300 
	gm_dowÆßdšgP’dšgMa¡”ResourûLßd”sCouÁ
--;

301 
checkIfLßdIsCom¶‘e
();

304 
	gAµliÿtiÚCacheGroup
::
çedLßdšgMašResourû
(
Docum’tLßd”
* 
lßd”
)

306 #ifdeà
SSLAB__DEBUG


307 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

310 
ASSERT
(
m_³ndšgMa¡”ResourûLßd”s
.
cÚšs
(
lßd”
));

311 
ASSERT
(
m_com¶‘iÚTy³
 =ğ
NÚe
 || 
m_³ndšgEÁr›s
.
isEm±y
());

313 
	gm_com¶‘iÚTy³
) {

314 
	gNÚe
:

317 
	gNoUpd©e
:

318 
ASSERT
(!
m_ÿcheBešgUpd©ed
);

322 
po¡Li¡’”Task
(
AµliÿtiÚCacheHo¡
::
ERROR_EVENT
, 
lßd”
);

325 
	gFau»
:

327 
ASSERT
(!
m_ÿcheBešgUpd©ed
);

328 
ASSERT
(!
lßd”
->
­¶iÿtiÚCacheHo¡
()->
­¶iÿtiÚCache
(è||†ßd”->­¶iÿtiÚCacheHo¡()->­¶iÿtiÚCache(è=ğ
m_ÿcheBešgUpd©ed
);

330 
	glßd”
->
­¶iÿtiÚCacheHo¡
()->
£tAµliÿtiÚCache
(0);

331 
	gm_assocŸ‹dDocum’tLßd”s
.
»move
(
lßd”
);

332 
po¡Li¡’”Task
(
AµliÿtiÚCacheHo¡
::
ERROR_EVENT
, 
lßd”
);

334 
	gCom¶‘ed
:

337 
ASSERT
(
m_assocŸ‹dDocum’tLßd”s
.
cÚšs
(
lßd”
));

338 
ASSERT
(
lßd”
->
­¶iÿtiÚCacheHo¡
()->
­¶iÿtiÚCache
(è=ğ
m_ÿcheBešgUpd©ed
);

339 
ASSERT
(!
lßd”
->
­¶iÿtiÚCacheHo¡
()->
ÿndid©eAµliÿtiÚCacheGroup
());

340 
	gm_assocŸ‹dDocum’tLßd”s
.
»move
(
lßd”
);

341 
	glßd”
->
­¶iÿtiÚCacheHo¡
()->
£tAµliÿtiÚCache
(0);

343 
po¡Li¡’”Task
(
AµliÿtiÚCacheHo¡
::
ERROR_EVENT
, 
lßd”
);

348 
	gm_dowÆßdšgP’dšgMa¡”ResourûLßd”sCouÁ
--;

349 
checkIfLßdIsCom¶‘e
();

352 
	gAµliÿtiÚCacheGroup
::
¡İLßdšg
()

354 #ifdeà
SSLAB__DEBUG


355 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

358 ià(
	gm_mªiã¡HªdË
) {

359 
ASSERT
(!
m_cu¼’tHªdË
);

361 
	gm_mªiã¡HªdË
->
£tCl›Á
(0);

362 
	gm_mªiã¡HªdË
->
ÿnûl
();

363 
	gm_mªiã¡HªdË
 = 0;

366 ià(
	gm_cu¼’tHªdË
) {

367 
ASSERT
(!
m_mªiã¡HªdË
);

368 
ASSERT
(
m_ÿcheBešgUpd©ed
);

370 
	gm_cu¼’tHªdË
->
£tCl›Á
(0);

371 
	gm_cu¼’tHªdË
->
ÿnûl
();

372 
	gm_cu¼’tHªdË
 = 0;

375 
	gm_ÿcheBešgUpd©ed
 = 0;

376 
	gm_³ndšgEÁr›s
.
ş—r
();

379 
	gAµliÿtiÚCacheGroup
::
di§ssocŸ‹Docum’tLßd”
(
Docum’tLßd”
* 
lßd”
)

381 #ifdeà
SSLAB__DEBUG


382 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

385 
	gHashS‘
<
	gDocum’tLßd”
*>::
™”©Ü
 
™
 = 
m_assocŸ‹dDocum’tLßd”s
.
fšd
(
lßd”
);

386 ià(
	g™
 !ğ
m_assocŸ‹dDocum’tLßd”s
.
’d
())

387 
m_assocŸ‹dDocum’tLßd”s
.
»move
(
™
);

389 
	gm_³ndšgMa¡”ResourûLßd”s
.
»move
(
lßd”
);

391 
	glßd”
->
­¶iÿtiÚCacheHo¡
()->
£tAµliÿtiÚCache
(0);

393 ià(!
	gm_assocŸ‹dDocum’tLßd”s
.
isEm±y
(è|| !
	gm_³ndšgMa¡”ResourûLßd”s
.isEmpty())

396 ià(
	gm_ÿches
.
isEm±y
()) {

398 
ASSERT
(!
m_Ãwe¡Cache
);

400 
d–‘e
 
	gthis
;

404 
ASSERT
(
m_ÿches
.
cÚšs
(
m_Ãwe¡Cache
.
g‘
()));

408 
	gm_Ãwe¡Cache
.
»Ëa£
();

411 
	gAµliÿtiÚCacheGroup
::
ÿcheDe¡royed
(
AµliÿtiÚCache
* 
ÿche
)

413 #ifdeà
SSLAB__DEBUG


414 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

417 ià(!
	gm_ÿches
.
cÚšs
(
ÿche
))

420 
	gm_ÿches
.
»move
(
ÿche
);

422 ià(
	gm_ÿches
.
isEm±y
()) {

423 
ASSERT
(
m_assocŸ‹dDocum’tLßd”s
.
isEm±y
());

424 
ASSERT
(
m_³ndšgMa¡”ResourûLßd”s
.
isEm±y
());

425 
d–‘e
 
	gthis
;

429 
	gAµliÿtiÚCacheGroup
::
£tNewe¡Cache
(
PassRefPŒ
<
AµliÿtiÚCache
> 
Ãwe¡Cache
)

431 #ifdeà
SSLAB__DEBUG


432 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

435 
	gm_Ãwe¡Cache
 = 
Ãwe¡Cache
;

437 
	gm_ÿches
.
add
(
m_Ãwe¡Cache
.
g‘
());

438 
	gm_Ãwe¡Cache
->
£tGroup
(
this
);

441 
	gAµliÿtiÚCacheGroup
::
makeObsŞ‘e
()

443 #ifdeà
SSLAB__DEBUG


444 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

447 ià(
isObsŞ‘e
())

450 
	gm_isObsŞ‘e
 = 
Œue
;

451 
ÿcheStÜage
().
ÿcheGroupMadeObsŞ‘e
(
this
);

452 
ASSERT
(!
m_¡ÜageID
);

455 
	gAµliÿtiÚCacheGroup
::
upd©e
(
F¿me
* 
äame
, 
AµliÿtiÚCacheUpd©eO±iÚ
 
upd©eO±iÚ
)

457 #ifdeà
SSLAB__DEBUG


458 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

461 ià(
	gm_upd©eStus
 =ğ
Checkšg
 || 
m_upd©eStus
 =ğ
DowÆßdšg
) {

462 ià(
upd©eO±iÚ
 =ğ
AµliÿtiÚCacheUpd©eW™hBrowsšgCÚ‹xt
) {

463 
po¡Li¡’”Task
(
AµliÿtiÚCacheHo¡
::
CHECKING_EVENT
, 
äame
->
lßd”
()->
docum’tLßd”
());

464 ià(
	gm_upd©eStus
 =ğ
DowÆßdšg
)

465 
po¡Li¡’”Task
(
AµliÿtiÚCacheHo¡
::
DOWNLOADING_EVENT
, 
äame
->
lßd”
()->
docum’tLßd”
());

471 ià(!
	gäame
->
£‰šgs
(è|| f¿me->£‰šgs()->
´iv©eBrowsšgEÇbËd
()) {

472 
ASSERT
(
m_³ndšgMa¡”ResourûLßd”s
.
isEm±y
());

473 
ASSERT
(
m_³ndšgEÁr›s
.
isEm±y
());

474 
ASSERT
(!
m_ÿcheBešgUpd©ed
);

475 
po¡Li¡’”Task
(
AµliÿtiÚCacheHo¡
::
CHECKING_EVENT
, 
äame
->
lßd”
()->
docum’tLßd”
());

476 
po¡Li¡’”Task
(
AµliÿtiÚCacheHo¡
::
NOUPDATE_EVENT
, 
äame
->
lßd”
()->
docum’tLßd”
());

480 
ASSERT
(!
m_äame
);

481 
	gm_äame
 = 
äame
;

483 
	gm_upd©eStus
 = 
Checkšg
;

485 
po¡Li¡’”Task
(
AµliÿtiÚCacheHo¡
::
CHECKING_EVENT
, 
m_assocŸ‹dDocum’tLßd”s
);

486 ià(!
	gm_Ãwe¡Cache
) {

487 
ASSERT
(
upd©eO±iÚ
 =ğ
AµliÿtiÚCacheUpd©eW™hBrowsšgCÚ‹xt
);

488 
po¡Li¡’”Task
(
AµliÿtiÚCacheHo¡
::
CHECKING_EVENT
, 
äame
->
lßd”
()->
docum’tLßd”
());

491 
ASSERT
(!
m_mªiã¡HªdË
);

492 
ASSERT
(!
m_mªiã¡Resourû
);

493 
ASSERT
(
m_com¶‘iÚTy³
 =ğ
NÚe
);

496 
	gm_mªiã¡HªdË
 = 
ü—‹ResourûHªdË
(
m_mªiã¡URL
, 
m_Ãwe¡Cache
 ? m_Ãwe¡Cache->
mªiã¡Resourû
() : 0);

499 
	gPassRefPŒ
<
	gResourûHªdË
> 
	gAµliÿtiÚCacheGroup
::
ü—‹ResourûHªdË
(cÚ¡ 
KURL
& 
u¾
, 
AµliÿtiÚCacheResourû
* 
Ãwe¡CachedResourû
)

501 #ifdeà
SSLAB__DEBUG


502 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

505 
ResourûReque¡
 
»que¡
(
u¾
);

506 
	gm_äame
->
lßd”
()->
­¶yU£rAg’t
(
»que¡
);

507 
	g»que¡
.
£tHTTPH—d”F›ld
("Cache-Control", "max-age=0");

509 ià(
	gÃwe¡CachedResourû
) {

510 cÚ¡ 
	gSŒšg
& 
	gÏ¡Modif›d
 = 
Ãwe¡CachedResourû
->
»¥Ú£
().
h‰pH—d”F›ld
("Last-Modified");

511 cÚ¡ 
	gSŒšg
& 
	geTag
 = 
Ãwe¡CachedResourû
->
»¥Ú£
().
h‰pH—d”F›ld
("ETag");

512 ià(!
	gÏ¡Modif›d
.
isEm±y
(è|| !
	geTag
.isEmpty()) {

513 ià(!
	gÏ¡Modif›d
.
isEm±y
())

514 
	g»que¡
.
£tHTTPH—d”F›ld
("If-Modif›d-Sšû", 
Ï¡Modif›d
);

515 ià(!
	geTag
.
isEm±y
())

516 
	g»que¡
.
£tHTTPH—d”F›ld
("If-NÚe-M©ch", 
eTag
);

520  
	gResourûHªdË
::
ü—‹
(
»que¡
, 
this
, 
m_äame
, 
çl£
, 
Œue
);

523 
	gAµliÿtiÚCacheGroup
::
didReûiveRe¥Ú£
(
ResourûHªdË
* 
hªdË
, cÚ¡ 
ResourûRe¥Ú£
& 
»¥Ú£
)

525 #ifdeà
SSLAB__DEBUG


526 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

529 ià(
	ghªdË
 =ğ
m_mªiã¡HªdË
) {

530 
didReûiveMªiã¡Re¥Ú£
(
»¥Ú£
);

534 
ASSERT
(
hªdË
 =ğ
m_cu¼’tHªdË
);

536 
KURL
 
u¾
(
hªdË
->
»que¡
().url());

537 ià(
	gu¾
.
hasF¿gm’tId’tif›r
())

538 
	gu¾
.
»moveF¿gm’tId’tif›r
();

540 
ASSERT
(!
m_cu¼’tResourû
);

541 
ASSERT
(
m_³ndšgEÁr›s
.
cÚšs
(
u¾
));

543 
	gty³
 = 
m_³ndšgEÁr›s
.
g‘
(
u¾
);

546 ià(!
	gm_Ãwe¡Cache
)

547 
ASSERT
(!(
ty³
 & 
AµliÿtiÚCacheResourû
::
Ma¡”
));

549 ià(
	gm_Ãwe¡Cache
 && 
	g»¥Ú£
.
h‰pStusCode
() == 304) {

550 
AµliÿtiÚCacheResourû
* 
Ãwe¡CachedResourû
 = 
m_Ãwe¡Cache
->
»sourûFÜURL
(
u¾
);

551 ià(
	gÃwe¡CachedResourû
) {

552 
	gm_ÿcheBešgUpd©ed
->
addResourû
(
AµliÿtiÚCacheResourû
::
ü—‹
(
u¾
, 
Ãwe¡CachedResourû
->
»¥Ú£
(), 
ty³
,‚ewe¡CachedResourû->
d©a
()));

553 
	gm_³ndšgEÁr›s
.
»move
(
m_cu¼’tHªdË
->
»que¡
().
u¾
());

554 
	gm_cu¼’tHªdË
->
ÿnûl
();

555 
	gm_cu¼’tHªdË
 = 0;

557 
¡¬tLßdšgEÁry
();

563 ià(
	g»¥Ú£
.
h‰pStusCode
(è/ 100 !ğ2 || 
»¥Ú£
.
u¾
(è!ğ
m_cu¼’tHªdË
->
»que¡
().url()) {

564 ià((
ty³
 & 
AµliÿtiÚCacheResourû
::
Ex¶ic™
è|| (ty³ & AµliÿtiÚCacheResourû::
F®lback
)) {

566 
ÿcheUpd©eFaed
();

567 } ià(
	g»¥Ú£
.
h‰pStusCode
(è=ğ404 || 
»¥Ú£
.httpStatusCode() == 410) {

569 
m_cu¼’tHªdË
->
ÿnûl
();

570 
	gm_cu¼’tHªdË
 = 0;

571 
	gm_³ndšgEÁr›s
.
»move
(
u¾
);

573 
¡¬tLßdšgEÁry
();

577 
ASSERT
(
m_Ãwe¡Cache
);

578 
AµliÿtiÚCacheResourû
* 
	gÃwe¡CachedResourû
 = 
m_Ãwe¡Cache
->
»sourûFÜURL
(
hªdË
->
»que¡
().
u¾
());

579 
ASSERT
(
Ãwe¡CachedResourû
);

580 
	gm_ÿcheBešgUpd©ed
->
addResourû
(
AµliÿtiÚCacheResourû
::
ü—‹
(
u¾
, 
Ãwe¡CachedResourû
->
»¥Ú£
(), 
ty³
,‚ewe¡CachedResourû->
d©a
()));

581 
	gm_³ndšgEÁr›s
.
»move
(
m_cu¼’tHªdË
->
»que¡
().
u¾
());

582 
	gm_cu¼’tHªdË
->
ÿnûl
();

583 
	gm_cu¼’tHªdË
 = 0;

585 
¡¬tLßdšgEÁry
();

590 
	gm_cu¼’tResourû
 = 
AµliÿtiÚCacheResourû
::
ü—‹
(
u¾
, 
»¥Ú£
, 
ty³
);

593 
	gAµliÿtiÚCacheGroup
::
didReûiveD©a
(
ResourûHªdË
* 
hªdË
, cÚ¡ * 
d©a
, 
Ëngth
, )

595 #ifdeà
SSLAB__DEBUG


596 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

599 ià(
	ghªdË
 =ğ
m_mªiã¡HªdË
) {

600 
didReûiveMªiã¡D©a
(
d©a
, 
Ëngth
);

604 
ASSERT
(
hªdË
 =ğ
m_cu¼’tHªdË
);

606 
ASSERT
(
m_cu¼’tResourû
);

607 
	gm_cu¼’tResourû
->
d©a
()->
­³nd
(d©a, 
Ëngth
);

610 
	gAµliÿtiÚCacheGroup
::
didFšishLßdšg
(
ResourûHªdË
* 
hªdË
)

612 #ifdeà
SSLAB__DEBUG


613 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

616 ià(
	ghªdË
 =ğ
m_mªiã¡HªdË
) {

617 
didFšishLßdšgMªiã¡
();

621 
ASSERT
(
m_cu¼’tHªdË
 =ğ
hªdË
);

622 
ASSERT
(
m_³ndšgEÁr›s
.
cÚšs
(
hªdË
->
»que¡
().
u¾
()));

624 
	gm_³ndšgEÁr›s
.
»move
(
hªdË
->
»que¡
().
u¾
());

626 
ASSERT
(
m_ÿcheBešgUpd©ed
);

628 
	gm_ÿcheBešgUpd©ed
->
addResourû
(
m_cu¼’tResourû
.
»Ëa£
());

629 
	gm_cu¼’tHªdË
 = 0;

632 
¡¬tLßdšgEÁry
();

635 
	gAµliÿtiÚCacheGroup
::
didFa
(
ResourûHªdË
* 
hªdË
, cÚ¡ 
ResourûE¼Ü
&)

637 #ifdeà
SSLAB__DEBUG


638 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

641 ià(
	ghªdË
 =ğ
m_mªiã¡HªdË
) {

642 
ÿcheUpd©eFaed
();

646 
	gty³
 = 
m_cu¼’tResourû
 ? m_cu¼’tResourû->
ty³
(è: 
m_³ndšgEÁr›s
.
g‘
(
hªdË
->
»que¡
().
u¾
());

647 
KURL
 
u¾
(
hªdË
->
»que¡
().url());

648 ià(
	gu¾
.
hasF¿gm’tId’tif›r
())

649 
	gu¾
.
»moveF¿gm’tId’tif›r
();

651 
ASSERT
(!
m_cu¼’tResourû
 || !
m_³ndšgEÁr›s
.
cÚšs
(
u¾
));

652 
	gm_cu¼’tResourû
 = 0;

653 
	gm_³ndšgEÁr›s
.
»move
(
u¾
);

655 ià((
	gty³
 & 
	gAµliÿtiÚCacheResourû
::
Ex¶ic™
è|| (
ty³
 & 
AµliÿtiÚCacheResourû
::
F®lback
)) {

657 
ÿcheUpd©eFaed
();

661 
ASSERT
(
m_Ãwe¡Cache
);

662 
AµliÿtiÚCacheResourû
* 
	gÃwe¡CachedResourû
 = 
m_Ãwe¡Cache
->
»sourûFÜURL
(
u¾
);

663 
ASSERT
(
Ãwe¡CachedResourû
);

664 
	gm_ÿcheBešgUpd©ed
->
addResourû
(
AµliÿtiÚCacheResourû
::
ü—‹
(
u¾
, 
Ãwe¡CachedResourû
->
»¥Ú£
(), 
ty³
,‚ewe¡CachedResourû->
d©a
()));

666 
¡¬tLßdšgEÁry
();

670 
	gAµliÿtiÚCacheGroup
::
didReûiveMªiã¡Re¥Ú£
(cÚ¡ 
ResourûRe¥Ú£
& 
»¥Ú£
)

672 #ifdeà
SSLAB__DEBUG


673 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

676 
ASSERT
(!
m_mªiã¡Resourû
);

677 
ASSERT
(
m_mªiã¡HªdË
);

679 ià(
	g»¥Ú£
.
h‰pStusCode
(è=ğ404 || 
»¥Ú£
.httpStatusCode() == 410) {

680 
mªiã¡NÙFound
();

684 ià(
	g»¥Ú£
.
h‰pStusCode
() == 304)

687 ià(
	g»¥Ú£
.
h‰pStusCode
(è/ 100 !ğ2 || 
»¥Ú£
.
u¾
(è!ğ
m_mªiã¡HªdË
->
»que¡
().u¾(è|| !
equ®IgnÜšgCa£
Ôe¥Ú£.
mimeTy³
(), "text/cache-manifest")) {

688 
ÿcheUpd©eFaed
();

692 
	gm_mªiã¡Resourû
 = 
AµliÿtiÚCacheResourû
::
ü—‹
(
m_mªiã¡HªdË
->
»que¡
().
u¾
(), 
»¥Ú£
,

693 
AµliÿtiÚCacheResourû
::
Mªiã¡
);

696 
	gAµliÿtiÚCacheGroup
::
didReûiveMªiã¡D©a
(cÚ¡ * 
d©a
, 
Ëngth
)

698 #ifdeà
SSLAB__DEBUG


699 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

702 ià(
	gm_mªiã¡Resourû
)

703 
	gm_mªiã¡Resourû
->
d©a
()->
­³nd
(d©a, 
Ëngth
);

706 
	gAµliÿtiÚCacheGroup
::
didFšishLßdšgMªiã¡
()

708 #ifdeà
SSLAB__DEBUG


709 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

712 
boŞ
 
	gisUpg¿deA‰em±
 = 
m_Ãwe¡Cache
;

714 ià(!
	gisUpg¿deA‰em±
 && !
	gm_mªiã¡Resourû
) {

716 
ÿcheUpd©eFaed
();

720 
	gm_mªiã¡HªdË
 = 0;

723 ià(
	gisUpg¿deA‰em±
) {

724 
AµliÿtiÚCacheResourû
* 
	gÃwe¡Mªiã¡
 = 
m_Ãwe¡Cache
->
mªiã¡Resourû
();

725 
ASSERT
(
Ãwe¡Mªiã¡
);

727 ià(!
	gm_mªiã¡Resourû
 ||

728 (
	gÃwe¡Mªiã¡
->
d©a
()->
size
(è=ğ
m_mªiã¡Resourû
->d©a()->size(è&& !
memcmp
(
Ãwe¡Mªiã¡
->data()->data(), m_manifestResource->data()->data(),‚ewestManifest->data()->size()))) {

730 
	gm_com¶‘iÚTy³
 = 
NoUpd©e
;

731 
	gm_mªiã¡Resourû
 = 0;

732 
d–iv”D–ayedMašResourûs
();

738 
Mªiã¡
 
	gmªiã¡
;

739 ià(!
·r£Mªiã¡
(
m_mªiã¡URL
, 
m_mªiã¡Resourû
->
d©a
()->d©a(), m_mªiã¡Resourû->d©a()->
size
(), 
mªiã¡
)) {

740 
ÿcheUpd©eFaed
();

744 
ASSERT
(!
m_ÿcheBešgUpd©ed
);

745 
	gm_ÿcheBešgUpd©ed
 = 
AµliÿtiÚCache
::
ü—‹
();

746 
	gm_ÿcheBešgUpd©ed
->
£tGroup
(
this
);

748 
	gHashS‘
<
	gDocum’tLßd”
*>::
cÚ¡_™”©Ü
 
ma¡”End
 = 
m_³ndšgMa¡”ResourûLßd”s
.
’d
();

749 
	gHashS‘
<
	gDocum’tLßd”
*>::
cÚ¡_™”©Ü
 
™”
 = 
m_³ndšgMa¡”ResourûLßd”s
.
begš
(); 
	g™”
 !ğ
ma¡”End
; ++iter)

750 
assocŸ‹Docum’tLßd”W™hCache
(*
™”
, 
m_ÿcheBešgUpd©ed
.
g‘
());

753 
	gm_upd©eStus
 = 
DowÆßdšg
;

755 
po¡Li¡’”Task
(
AµliÿtiÚCacheHo¡
::
DOWNLOADING_EVENT
, 
m_assocŸ‹dDocum’tLßd”s
);

757 
ASSERT
(
m_³ndšgEÁr›s
.
isEm±y
());

759 ià(
	gisUpg¿deA‰em±
) {

760 
	gAµliÿtiÚCache
::
ResourûM­
::
cÚ¡_™”©Ü
 
’d
 = 
m_Ãwe¡Cache
->end();

761 
	gAµliÿtiÚCache
::
ResourûM­
::
cÚ¡_™”©Ü
 
™
 = 
m_Ãwe¡Cache
->
begš
(); 
	g™
 !ğ
’d
; ++it) {

762 
	gty³
 = 
™
->
£cÚd
->
ty³
();

763 ià(
	gty³
 & 
	gAµliÿtiÚCacheResourû
::
Ma¡”
)

764 
addEÁry
(
™
->
fœ¡
, 
ty³
);

768 
	gHashS‘
<
	gSŒšg
>::
cÚ¡_™”©Ü
 
’d
 = 
mªiã¡
.
ex¶ic™URLs
.end();

769 
	gHashS‘
<
	gSŒšg
>::
cÚ¡_™”©Ü
 
™
 = 
mªiã¡
.
ex¶ic™URLs
.
begš
(); 
	g™
 !ğ
’d
; ++it)

770 
addEÁry
(*
™
, 
AµliÿtiÚCacheResourû
::
Ex¶ic™
);

772 
size_t
 
	gçÎbackCouÁ
 = 
mªiã¡
.
çÎbackURLs
.
size
();

773 
size_t
 
	gi
 = 0; i < 
	gçÎbackCouÁ
; ++i)

774 
addEÁry
(
mªiã¡
.
çÎbackURLs
[
i
].
£cÚd
, 
AµliÿtiÚCacheResourû
::
F®lback
);

776 
	gm_ÿcheBešgUpd©ed
->
£tOÆšeWh™–i¡
(
mªiã¡
.
ÚlšeWh™–i¡edURLs
);

777 
	gm_ÿcheBešgUpd©ed
->
£tF®lbackURLs
(
mªiã¡
.
çÎbackURLs
);

778 
	gm_ÿcheBešgUpd©ed
->
£tAÎowsAÎN‘wÜkReque¡s
(
mªiã¡
.
®lowAÎN‘wÜkReque¡s
);

780 
¡¬tLßdšgEÁry
();

783 
	gAµliÿtiÚCacheGroup
::
didR—chMaxAµCacheSize
()

785 #ifdeà
SSLAB__DEBUG


786 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

789 
ASSERT
(
m_äame
);

790 
ASSERT
(
m_ÿcheBešgUpd©ed
);

791 
	gm_äame
->
·ge
()->
chrome
()->
ş›Á
()->
»achedMaxAµCacheSize
(
ÿcheStÜage
().
¥aûN“ded
(
m_ÿcheBešgUpd©ed
->
e¡im©edSizeInStÜage
()));

792 
	gm_ÿÎedR—chedMaxAµCacheSize
 = 
Œue
;

793 
checkIfLßdIsCom¶‘e
();

796 
	gAµliÿtiÚCacheGroup
::
ÿcheUpd©eFaed
()

798 #ifdeà
SSLAB__DEBUG


799 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

802 
¡İLßdšg
();

803 
	gm_mªiã¡Resourû
 = 0;

806 
	gm_com¶‘iÚTy³
 = 
Fau»
;

807 
d–iv”D–ayedMašResourûs
();

810 
	gAµliÿtiÚCacheGroup
::
mªiã¡NÙFound
()

812 #ifdeà
SSLAB__DEBUG


813 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

816 
makeObsŞ‘e
();

818 
po¡Li¡’”Task
(
AµliÿtiÚCacheHo¡
::
OBSOLETE_EVENT
, 
m_assocŸ‹dDocum’tLßd”s
);

819 
po¡Li¡’”Task
(
AµliÿtiÚCacheHo¡
::
ERROR_EVENT
, 
m_³ndšgMa¡”ResourûLßd”s
);

821 
¡İLßdšg
();

823 
ASSERT
(
m_³ndšgEÁr›s
.
isEm±y
());

824 
	gm_mªiã¡Resourû
 = 0;

826 !
	gm_³ndšgMa¡”ResourûLßd”s
.
isEm±y
()) {

827 
	gHashS‘
<
	gDocum’tLßd”
*>::
™”©Ü
 
™
 = 
m_³ndšgMa¡”ResourûLßd”s
.
begš
();

829 
ASSERT
((*
™
)->
­¶iÿtiÚCacheHo¡
()->
ÿndid©eAµliÿtiÚCacheGroup
(è=ğ
this
);

830 
ASSERT
(!(*
™
)->
­¶iÿtiÚCacheHo¡
()->
­¶iÿtiÚCache
());

831 (*
	g™
)->
­¶iÿtiÚCacheHo¡
()->
£tCªdid©eAµliÿtiÚCacheGroup
(0);

832 
	gm_³ndšgMa¡”ResourûLßd”s
.
»move
(
™
);

835 
	gm_dowÆßdšgP’dšgMa¡”ResourûLßd”sCouÁ
 = 0;

836 
	gm_upd©eStus
 = 
IdË
;

837 
	gm_äame
 = 0;

839 ià(
	gm_ÿches
.
isEm±y
()) {

840 
ASSERT
(
m_assocŸ‹dDocum’tLßd”s
.
isEm±y
());

841 
ASSERT
(!
m_ÿcheBešgUpd©ed
);

842 
d–‘e
 
	gthis
;

846 
	gAµliÿtiÚCacheGroup
::
checkIfLßdIsCom¶‘e
()

848 #ifdeà
SSLAB__DEBUG


849 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

852 ià(
	gm_mªiã¡HªdË
 || !
	gm_³ndšgEÁr›s
.
isEm±y
(è|| 
	gm_dowÆßdšgP’dšgMa¡”ResourûLßd”sCouÁ
)

857 
boŞ
 
	gisUpg¿deA‰em±
 = 
m_Ãwe¡Cache
;

859 
	gm_com¶‘iÚTy³
) {

860 
	gNÚe
:

861 
ASSERT_NOT_REACHED
();

863 
	gNoUpd©e
:

864 
ASSERT
(
isUpg¿deA‰em±
);

865 
ASSERT
(!
m_ÿcheBešgUpd©ed
);

868 ià(!
	gm_¡ÜageID
)

869 
ÿcheStÜage
().
¡ÜeNewe¡Cache
(
this
);

871 
po¡Li¡’”Task
(
AµliÿtiÚCacheHo¡
::
NOUPDATE_EVENT
, 
m_assocŸ‹dDocum’tLßd”s
);

873 
	gFau»
:

874 
ASSERT
(!
m_ÿcheBešgUpd©ed
);

875 
po¡Li¡’”Task
(
AµliÿtiÚCacheHo¡
::
ERROR_EVENT
, 
m_assocŸ‹dDocum’tLßd”s
);

876 ià(
	gm_ÿches
.
isEm±y
()) {

877 
ASSERT
(
m_assocŸ‹dDocum’tLßd”s
.
isEm±y
());

878 
d–‘e
 
	gthis
;

882 
	gCom¶‘ed
: {

885 
ASSERT
(
m_ÿcheBešgUpd©ed
);

886 ià(
	gm_mªiã¡Resourû
)

887 
	gm_ÿcheBešgUpd©ed
->
£tMªiã¡Resourû
(
m_mªiã¡Resourû
.
»Ëa£
());

893 
ASSERT
(
ÿcheStÜage
().
isMaximumSizeR—ched
(è&& 
m_ÿÎedR—chedMaxAµCacheSize
);

896 
	gRefPŒ
<
	gAµliÿtiÚCache
> 
	gŞdNewe¡Cache
 = (
m_Ãwe¡Cache
 =ğ
m_ÿcheBešgUpd©ed
) ? 0 : m_newestCache;

898 
£tNewe¡Cache
(
m_ÿcheBešgUpd©ed
.
»Ëa£
());

899 ià(
ÿcheStÜage
().
¡ÜeNewe¡Cache
(
this
)) {

901 ià(
	gŞdNewe¡Cache
)

902 
ÿcheStÜage
().
»move
(
ŞdNewe¡Cache
.
g‘
());

904 
po¡Li¡’”Task
(
isUpg¿deA‰em±
 ? 
AµliÿtiÚCacheHo¡
::
UPDATEREADY_EVENT
 : AµliÿtiÚCacheHo¡::
CACHED_EVENT
, 
m_assocŸ‹dDocum’tLßd”s
);

906 ià(
ÿcheStÜage
().
isMaximumSizeR—ched
(è&& !
	gm_ÿÎedR—chedMaxAµCacheSize
) {

913 
	gm_ÿcheBešgUpd©ed
 = 
m_Ãwe¡Cache
.
»Ëa£
();

914 ià(
	gŞdNewe¡Cache
) {

916 
£tNewe¡Cache
(
ŞdNewe¡Cache
.
»Ëa£
());

918 
scheduËR—chedMaxAµCacheSizeC®lback
();

924 
po¡Li¡’”Task
(
AµliÿtiÚCacheHo¡
::
ERROR_EVENT
, 
m_assocŸ‹dDocum’tLßd”s
);

930 
	gVeùÜ
<
	gDocum’tLßd”
*> 
	glßd”s
;

931 
cİyToVeùÜ
(
m_³ndšgMa¡”ResourûLßd”s
, 
lßd”s
);

932 
size_t
 
	gcouÁ
 = 
lßd”s
.
size
();

933 
size_t
 
	gi
 = 0; i !ğ
couÁ
; ++i)

934 
di§ssocŸ‹Docum’tLßd”
(
lßd”s
[
i
]);

937 ià(
	gŞdNewe¡Cache
) {

939 
£tNewe¡Cache
(
ŞdNewe¡Cache
.
»Ëa£
());

951 
	gm_³ndšgMa¡”ResourûLßd”s
.
ş—r
();

952 
	gm_com¶‘iÚTy³
 = 
NÚe
;

953 
	gm_upd©eStus
 = 
IdË
;

954 
	gm_äame
 = 0;

955 
	gm_ÿÎedR—chedMaxAµCacheSize
 = 
çl£
;

958 
	gAµliÿtiÚCacheGroup
::
¡¬tLßdšgEÁry
()

960 #ifdeà
SSLAB__DEBUG


961 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

964 
ASSERT
(
m_ÿcheBešgUpd©ed
);

966 ià(
	gm_³ndšgEÁr›s
.
isEm±y
()) {

967 
	gm_com¶‘iÚTy³
 = 
Com¶‘ed
;

968 
d–iv”D–ayedMašResourûs
();

972 
	gEÁryM­
::
cÚ¡_™”©Ü
 
™
 = 
m_³ndšgEÁr›s
.
begš
();

974 
po¡Li¡’”Task
(
AµliÿtiÚCacheHo¡
::
PROGRESS_EVENT
, 
m_assocŸ‹dDocum’tLßd”s
);

976 
ASSERT
(!
m_cu¼’tHªdË
);

978 
	gm_cu¼’tHªdË
 = 
ü—‹ResourûHªdË
(
KURL
(
P¬£dURLSŒšg
, 
™
->
fœ¡
), 
m_Ãwe¡Cache
 ? m_Ãwe¡Cache->
»sourûFÜURL
(it->first) : 0);

981 
	gAµliÿtiÚCacheGroup
::
d–iv”D–ayedMašResourûs
()

983 #ifdeà
SSLAB__DEBUG


984 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

988 
	gVeùÜ
<
	gDocum’tLßd”
*> 
	glßd”s
;

989 
cİyToVeùÜ
(
m_³ndšgMa¡”ResourûLßd”s
, 
lßd”s
);

990 
size_t
 
	gcouÁ
 = 
lßd”s
.
size
();

991 
size_t
 
	gi
 = 0; i !ğ
couÁ
; ++i) {

992 
Docum’tLßd”
* 
	glßd”
 = 
lßd”s
[
i
];

993 ià(
	glßd”
->
isLßdšgMašResourû
())

996 cÚ¡ 
	gResourûE¼Ü
& 
	g”rÜ
 = 
lßd”
->
mašDocum’tE¼Ü
();

997 ià(
	g”rÜ
.
isNuÎ
())

998 
fšishedLßdšgMašResourû
(
lßd”
);

1000 
çedLßdšgMašResourû
(
lßd”
);

1002 ià(!
	gcouÁ
)

1003 
checkIfLßdIsCom¶‘e
();

1006 
	gAµliÿtiÚCacheGroup
::
addEÁry
(cÚ¡ 
SŒšg
& 
u¾
, 
ty³
)

1008 #ifdeà
SSLAB__DEBUG


1009 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

1012 
ASSERT
(
m_ÿcheBešgUpd©ed
);

1013 
ASSERT
(!
KURL
(
P¬£dURLSŒšg
, 
u¾
).
hasF¿gm’tId’tif›r
());

1017 ià(
AµliÿtiÚCacheResourû
* 
	g»sourû
 = 
m_ÿcheBešgUpd©ed
->
»sourûFÜURL
(
u¾
)) {

1018 
ASSERT
(
»sourû
->
ty³
(è& 
AµliÿtiÚCacheResourû
::
Ma¡”
);

1019 
ASSERT
(!
m_äame
->
lßd”
()->
docum’tLßd”
()->
isLßdšgMašResourû
());

1021 
	g»sourû
->
addTy³
(
ty³
);

1026 
ASSERT
(
m_mªiã¡Resourû
);

1027 ià(
	gm_mªiã¡Resourû
->
u¾
() == url) {

1028 
m_mªiã¡Resourû
->
addTy³
(
ty³
);

1032 
	g·œ
<
	gEÁryM­
::
™”©Ü
, 
	gboŞ
> 
	g»suÉ
 = 
m_³ndšgEÁr›s
.
add
(
u¾
, 
ty³
);

1034 ià(!
	g»suÉ
.
	g£cÚd
)

1035 
	g»suÉ
.
	gfœ¡
->
	g£cÚd
 |ğ
ty³
;

1038 
	gAµliÿtiÚCacheGroup
::
assocŸ‹Docum’tLßd”W™hCache
(
Docum’tLßd”
* 
lßd”
, 
AµliÿtiÚCache
* 
ÿche
)

1040 #ifdeà
SSLAB__DEBUG


1041 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

1045 ià(!
	gm_Ãwe¡Cache
 && !
	gm_ÿcheBešgUpd©ed
)

1046 
	gm_Ãwe¡Cache
 = 
ÿche
;

1048 
ASSERT
(!
m_isObsŞ‘e
);

1050 
	glßd”
->
­¶iÿtiÚCacheHo¡
()->
£tAµliÿtiÚCache
(
ÿche
);

1052 
ASSERT
(!
m_assocŸ‹dDocum’tLßd”s
.
cÚšs
(
lßd”
));

1053 
	gm_assocŸ‹dDocum’tLßd”s
.
add
(
lßd”
);

1056 şas 
	cChromeCl›ÁC®lbackTim”
: 
public
 
Tim”Ba£
 {

1057 
public
:

1058 
ChromeCl›ÁC®lbackTim”
(
AµliÿtiÚCacheGroup
* 
ÿcheGroup
)

1059 : 
m_ÿcheGroup
(
ÿcheGroup
)

1063 
´iv©e
:

1064 
vœtu®
 
fœed
()

1066 
m_ÿcheGroup
->
didR—chMaxAµCacheSize
();

1067 
d–‘e
 
	gthis
;

1072 
AµliÿtiÚCacheGroup
* 
	gm_ÿcheGroup
;

1075 
	gAµliÿtiÚCacheGroup
::
	$scheduËR—chedMaxAµCacheSizeC®lback
()

1077 #ifdeà
SSLAB__DEBUG


1078 
	`qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
	`cu¼’tD©eTime
().
	`toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
	`toAscii
().
	`d©a
(), 
QTh»ad
::
	`cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

1081 
	`ASSERT
(
	`isMašTh»ad
());

1082 
ChromeCl›ÁC®lbackTim”
* 
tim”
 = 
Ãw
 
	`ChromeCl›ÁC®lbackTim”
(
this
);

1083 
tim”
->
	`¡¬tOÃShÙ
(0);

1085 
	}
}

1087 şas 
	cC®lCacheLi¡’”Task
 : 
public
 
SütExecutiÚCÚ‹xt
::
Task
 {

1088 
public
:

1089 
PassOwnPŒ
<
C®lCacheLi¡’”Task
> 
ü—‹
(
PassRefPŒ
<
Docum’tLßd”
> 
lßd”
, 
AµliÿtiÚCacheHo¡
::
Ev’tID
 
ev’tID
)

1091  
Ãw
 
C®lCacheLi¡’”Task
(
lßd”
, 
ev’tID
);

1094 
vœtu®
 
³rfÜmTask
(
SütExecutiÚCÚ‹xt
* 
cÚ‹xt
)

1097 
ASSERT_UNUSED
(
cÚ‹xt
, cÚ‹xt->
isDocum’t
());

1098 
F¿me
* 
	gäame
 = 
m_docum’tLßd”
->
äame
();

1099 ià(!
	gäame
)

1102 
ASSERT
(
äame
->
lßd”
()->
docum’tLßd”
(è=ğ
m_docum’tLßd”
.
g‘
());

1104 
	gm_docum’tLßd”
->
­¶iÿtiÚCacheHo¡
()->
nÙifyDOMAµliÿtiÚCache
(
m_ev’tID
);

1107 
	g´iv©e
:

1108 
C®lCacheLi¡’”Task
(
PassRefPŒ
<
Docum’tLßd”
> 
lßd”
, 
AµliÿtiÚCacheHo¡
::
Ev’tID
 
ev’tID
)

1109 : 
m_docum’tLßd”
(
lßd”
)

1110 , 
m_ev’tID
(
ev’tID
)

1114 
	gRefPŒ
<
	gDocum’tLßd”
> 
	gm_docum’tLßd”
;

1115 
	gAµliÿtiÚCacheHo¡
::
Ev’tID
 
m_ev’tID
;

1118 
	gAµliÿtiÚCacheGroup
::
po¡Li¡’”Task
(
AµliÿtiÚCacheHo¡
::
Ev’tID
 
ev’tID
, cÚ¡ 
HashS‘
<
Docum’tLßd”
*>& 
lßd”S‘
)

1120 #ifdeà
SSLAB__DEBUG


1121 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

1124 
	gHashS‘
<
	gDocum’tLßd”
*>::
cÚ¡_™”©Ü
 
lßd”S‘End
 = 
lßd”S‘
.
’d
();

1125 
	gHashS‘
<
	gDocum’tLßd”
*>::
cÚ¡_™”©Ü
 
™”
 = 
lßd”S‘
.
begš
(); 
	g™”
 !ğ
lßd”S‘End
; ++iter)

1126 
po¡Li¡’”Task
(
ev’tID
, *
™”
);

1129 
	gAµliÿtiÚCacheGroup
::
po¡Li¡’”Task
(
AµliÿtiÚCacheHo¡
::
Ev’tID
 
ev’tID
, 
Docum’tLßd”
* 
lßd”
)

1131 #ifdeà
SSLAB__DEBUG


1132 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

1135 
F¿me
* 
	gäame
 = 
lßd”
->
äame
();

1136 ià(!
	gäame
)

1139 
ASSERT
(
äame
->
lßd”
()->
docum’tLßd”
() ==†oader);

1141 
	gäame
->
docum’t
()->
po¡Task
(
C®lCacheLi¡’”Task
::
ü—‹
(
lßd”
, 
ev’tID
));

1144 
	gAµliÿtiÚCacheGroup
::
	$ş—rStÜageID
()

1146 #ifdeà
SSLAB__DEBUG


1147 
	`qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
	`cu¼’tD©eTime
().
	`toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
	`toAscii
().
	`d©a
(), 
QTh»ad
::
	`cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

1150 
m_¡ÜageID
 = 0;

1152 
HashS‘
<
AµliÿtiÚCache
*>::
cÚ¡_™”©Ü
 
’d
 = 
m_ÿches
.
	`’d
();

1153 
HashS‘
<
AµliÿtiÚCache
*>::
cÚ¡_™”©Ü
 
™
 = 
m_ÿches
.
	`begš
(); iˆ!ğ
’d
; ++it)

1154 (*
™
)->
	`ş—rStÜageID
();

1155 
	}
}

	@appcache/ApplicationCacheGroup.h

26 #iâdeà
AµliÿtiÚCacheGroup_h


27 
	#AµliÿtiÚCacheGroup_h


	)

29 #ià
ENABLE
(
OFFLINE_WEB_APPLICATIONS
)

31 
	~<wtf/NÚcİyabË.h
>

32 
	~<wtf/HashM­.h
>

33 
	~<wtf/HashS‘.h
>

35 
	~"DOMAµliÿtiÚCache.h
"

36 
	~"KURL.h
"

37 
	~"PÏtfÜmSŒšg.h
"

38 
	~"ResourûHªdË.h
"

39 
	~"ResourûHªdËCl›Á.h
"

40 
	~"Sh¬edBufãr.h
"

42 
Çme¥aû
 
	gWebCÜe
 {

44 
şass
 
	gAµliÿtiÚCache
;

45 
şass
 
	gAµliÿtiÚCacheResourû
;

46 
şass
 
	gDocum’t
;

47 
şass
 
	gDocum’tLßd”
;

48 
şass
 
	gF¿me
;

50 
	eAµliÿtiÚCacheUpd©eO±iÚ
 {

51 
	gAµliÿtiÚCacheUpd©eW™hBrowsšgCÚ‹xt
,

52 
	gAµliÿtiÚCacheUpd©eW™houtBrowsšgCÚ‹xt


55 
şass
 
	gAµliÿtiÚCacheGroup
 : 
public
 
NÚcİyabË
, 
	gResourûHªdËCl›Á
 {

56 
	gpublic
:

57 
AµliÿtiÚCacheGroup
(cÚ¡ 
KURL
& 
mªiã¡URL
, 
boŞ
 
isCİy
 = 
çl£
);

58 ~
AµliÿtiÚCacheGroup
();

60 
	eUpd©eStus
 { 
	gIdË
, 
	gCheckšg
, 
	gDowÆßdšg
 };

62 
AµliÿtiÚCache
* 
ÿcheFÜMašReque¡
(cÚ¡ 
ResourûReque¡
&, 
Docum’tLßd”
*);

63 
AµliÿtiÚCache
* 
çÎbackCacheFÜMašReque¡
(cÚ¡ 
ResourûReque¡
&, 
Docum’tLßd”
*);

65 
£ËùCache
(
F¿me
*, cÚ¡ 
KURL
& 
mªiã¡URL
);

66 
£ËùCacheW™houtMªiã¡URL
(
F¿me
*);

68 cÚ¡ 
	gKURL
& 
mªiã¡URL
(ècÚ¡ {  
	gm_mªiã¡URL
; }

69 
Upd©eStus
 
upd©eStus
(ècÚ¡ {  
	gm_upd©eStus
; }

71 
£tStÜageID
(
¡ÜageID
è{ 
	gm_¡ÜageID
 = storageID; }

72 
¡ÜageID
(ècÚ¡ {  
	gm_¡ÜageID
; }

73 
ş—rStÜageID
();

75 
upd©e
(
F¿me
*, 
AµliÿtiÚCacheUpd©eO±iÚ
);

76 
ÿcheDe¡royed
(
AµliÿtiÚCache
*);

78 
boŞ
 
ÿcheIsBešgUpd©ed
(cÚ¡ 
AµliÿtiÚCache
* 
ÿche
ècÚ¡ {  
	gÿche
 =ğ
m_ÿcheBešgUpd©ed
; }

80 
AµliÿtiÚCache
* 
Ãwe¡Cache
(ècÚ¡ {  
	gm_Ãwe¡Cache
.
g‘
(); }

81 
£tNewe¡Cache
(
PassRefPŒ
<
AµliÿtiÚCache
>);

83 
makeObsŞ‘e
();

84 
boŞ
 
isObsŞ‘e
(ècÚ¡ {  
	gm_isObsŞ‘e
; }

86 
fšishedLßdšgMašResourû
(
Docum’tLßd”
*);

87 
çedLßdšgMašResourû
(
Docum’tLßd”
*);

89 
di§ssocŸ‹Docum’tLßd”
(
Docum’tLßd”
*);

91 
boŞ
 
isCİy
(ècÚ¡ {  
	gm_isCİy
; }

93 
	g´iv©e
:

94 
po¡Li¡’”Task
(
AµliÿtiÚCacheHo¡
::
Ev’tID
, cÚ¡ 
HashS‘
<
Docum’tLßd”
*>&);

95 
po¡Li¡’”Task
(
AµliÿtiÚCacheHo¡
::
Ev’tID
, 
Docum’tLßd”
*);

96 
scheduËR—chedMaxAµCacheSizeC®lback
();

98 
	gPassRefPŒ
<
	gResourûHªdË
> 
ü—‹ResourûHªdË
(cÚ¡ 
KURL
&, 
AµliÿtiÚCacheResourû
* 
Ãwe¡CachedResourû
);

102 
vœtu®
 
boŞ
 
shouldU£C»d’tŸlStÜage
(
ResourûHªdË
*è{  
	gŒue
; }

104 
vœtu®
 
didReûiveRe¥Ú£
(
ResourûHªdË
*, cÚ¡ 
ResourûRe¥Ú£
&);

105 
vœtu®
 
didReûiveD©a
(
ResourûHªdË
*, cÚ¡ *, , 
ËngthReûived
);

106 
vœtu®
 
didFšishLßdšg
(
ResourûHªdË
*);

107 
vœtu®
 
didFa
(
ResourûHªdË
*, cÚ¡ 
ResourûE¼Ü
&);

109 
didReûiveMªiã¡Re¥Ú£
(cÚ¡ 
ResourûRe¥Ú£
&);

110 
didReûiveMªiã¡D©a
(const *, );

111 
didFšishLßdšgMªiã¡
();

112 
didR—chMaxAµCacheSize
();

114 
¡¬tLßdšgEÁry
();

115 
d–iv”D–ayedMašResourûs
();

116 
checkIfLßdIsCom¶‘e
();

117 
ÿcheUpd©eFaed
();

118 
mªiã¡NÙFound
();

120 
addEÁry
(cÚ¡ 
SŒšg
&, 
ty³
);

122 
assocŸ‹Docum’tLßd”W™hCache
(
Docum’tLßd”
*, 
AµliÿtiÚCache
*);

124 
¡İLßdšg
();

126 
KURL
 
	gm_mªiã¡URL
;

127 
Upd©eStus
 
	gm_upd©eStus
;

130 
	gRefPŒ
<
	gAµliÿtiÚCache
> 
	gm_Ãwe¡Cache
;

133 
	gHashS‘
<
	gAµliÿtiÚCache
*> 
	gm_ÿches
;

137 
	gRefPŒ
<
	gAµliÿtiÚCache
> 
	gm_ÿcheBešgUpd©ed
;

140 
	gHashS‘
<
	gDocum’tLßd”
*> 
	gm_³ndšgMa¡”ResourûLßd”s
;

142 
	gm_dowÆßdšgP’dšgMa¡”ResourûLßd”sCouÁ
;

145 
	gHashS‘
<
	gDocum’tLßd”
*> 
	gm_assocŸ‹dDocum’tLßd”s
;

148 
	gHashM­
<
	tSŒšg
, > 
	tEÁryM­
;

149 
EÁryM­
 
	gm_³ndšgEÁr›s
;

153 
F¿me
* 
	gm_äame
;

156 
	gm_¡ÜageID
;

157 
boŞ
 
	gm_isObsŞ‘e
;

160 
	eCom¶‘iÚTy³
 {

161 
	gNÚe
,

162 
	gNoUpd©e
,

163 
	gFau»
,

164 
	gCom¶‘ed


166 
Com¶‘iÚTy³
 
	gm_com¶‘iÚTy³
;

169 
boŞ
 
	gm_isCİy
;

174 
boŞ
 
	gm_ÿÎedR—chedMaxAµCacheSize
;

176 
	gRefPŒ
<
	gResourûHªdË
> 
	gm_cu¼’tHªdË
;

177 
	gRefPŒ
<
	gAµliÿtiÚCacheResourû
> 
	gm_cu¼’tResourû
;

179 
	gRefPŒ
<
	gAµliÿtiÚCacheResourû
> 
	gm_mªiã¡Resourû
;

180 
	gRefPŒ
<
	gResourûHªdË
> 
	gm_mªiã¡HªdË
;

182 
ä›nd
 
şass
 
	gChromeCl›ÁC®lbackTim”
;

	@appcache/ApplicationCacheHost.cpp

2 #ifdeà
SSLAB__DEBUG


3 #iâdeà
SSLAB__QDATETIME


4 
	#SSLAB__QDATETIME


	)

5 
	~<QD©eTime
>

9 #ifdeà
SSLAB__DEBUG


10 #iâdeà
SSLAB__QTHREAD


11 
	#SSLAB__QTHREAD


	)

12 
	~<QTh»ad
>

40 
	~"cÚfig.h
"

41 
	~"AµliÿtiÚCacheHo¡.h
"

43 #ià
ENABLE
(
OFFLINE_WEB_APPLICATIONS
)

45 
	~"AµliÿtiÚCache.h
"

46 
	~"AµliÿtiÚCacheGroup.h
"

47 
	~"AµliÿtiÚCacheResourû.h
"

48 
	~"Docum’tLßd”.h
"

49 
	~"DOMAµliÿtiÚCache.h
"

50 
	~"F¿me.h
"

51 
	~"F¿meLßd”.h
"

52 
	~"F¿meLßd”Cl›Á.h
"

53 
	~"MašResourûLßd”.h
"

54 
	~"ResourûLßd”.h
"

55 
	~"ResourûReque¡.h
"

56 
	~"S‘tšgs.h
"

58 
Çme¥aû
 
	gWebCÜe
 {

60 
	gAµliÿtiÚCacheHo¡
::
AµliÿtiÚCacheHo¡
(
Docum’tLßd”
* 
docum’tLßd”
)

61 : 
m_domAµliÿtiÚCache
(0)

62 , 
m_docum’tLßd”
(
docum’tLßd”
)

63 , 
m_deãrsEv’ts
(
Œue
)

64 , 
m_ÿndid©eAµliÿtiÚCacheGroup
(0)

66 #ifdeà
SSLAB__DEBUG


67 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

70 
ASSERT
(
m_docum’tLßd”
);

73 
	gAµliÿtiÚCacheHo¡
::~
AµliÿtiÚCacheHo¡
()

75 #ifdeà
SSLAB__DEBUG


76 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

79 ià(
	gm_­¶iÿtiÚCache
)

80 
	gm_­¶iÿtiÚCache
->
group
()->
di§ssocŸ‹Docum’tLßd”
(
m_docum’tLßd”
);

81 ià(
	gm_ÿndid©eAµliÿtiÚCacheGroup
)

82 
	gm_ÿndid©eAµliÿtiÚCacheGroup
->
di§ssocŸ‹Docum’tLßd”
(
m_docum’tLßd”
);

85 
	gAµliÿtiÚCacheHo¡
::
£ËùCacheW™houtMªiã¡
()

87 #ifdeà
SSLAB__DEBUG


88 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

91 
	gAµliÿtiÚCacheGroup
::
£ËùCacheW™houtMªiã¡URL
(
m_docum’tLßd”
->
äame
());

94 
	gAµliÿtiÚCacheHo¡
::
£ËùCacheW™hMªiã¡
(cÚ¡ 
KURL
& 
mªiã¡URL
)

96 #ifdeà
SSLAB__DEBUG


97 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

100 
	gAµliÿtiÚCacheGroup
::
£ËùCache
(
m_docum’tLßd”
->
äame
(), 
mªiã¡URL
);

103 
	gAµliÿtiÚCacheHo¡
::
maybeLßdMašResourû
(
ResourûReque¡
& 
»que¡
, 
Sub¡™u‹D©a
& 
sub¡™u‹D©a
)

105 #ifdeà
SSLAB__DEBUG


106 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

110 ià(!
	gsub¡™u‹D©a
.
isV®id
(è&& 
isAµliÿtiÚCacheEÇbËd
()) {

111 
ASSERT
(!
m_mašResourûAµliÿtiÚCache
);

113 
	gm_mašResourûAµliÿtiÚCache
 = 
AµliÿtiÚCacheGroup
::
ÿcheFÜMašReque¡
(
»que¡
, 
m_docum’tLßd”
);

115 ià(
	gm_mašResourûAµliÿtiÚCache
) {

117 
AµliÿtiÚCacheResourû
* 
	g»sourû
 = 
m_mašResourûAµliÿtiÚCache
->
»sourûFÜReque¡
(
»que¡
);

118 
	gsub¡™u‹D©a
 = 
Sub¡™u‹D©a
(
»sourû
->
d©a
(),

119 
»sourû
->
»¥Ú£
().
mimeTy³
(),

120 
»sourû
->
»¥Ú£
().
‹xtEncodšgName
(), 
KURL
());

125 
boŞ
 
	gAµliÿtiÚCacheHo¡
::
maybeLßdF®lbackFÜMašRe¥Ú£
(cÚ¡ 
ResourûReque¡
& 
»que¡
, cÚ¡ 
ResourûRe¥Ú£
& 
r
)

127 #ifdeà
SSLAB__DEBUG


128 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

131 ià(
	gr
.
h‰pStusCode
(è/ 100 =ğ4 || 
r
.httpStatusCode() / 100 == 5) {

132 
ASSERT
(!
m_mašResourûAµliÿtiÚCache
);

133 ià(
isAµliÿtiÚCacheEÇbËd
()) {

134 
	gm_mašResourûAµliÿtiÚCache
 = 
AµliÿtiÚCacheGroup
::
çÎbackCacheFÜMašReque¡
(
»que¡
, 
docum’tLßd”
());

136 ià(
scheduËLßdF®lbackResourûFromAµliÿtiÚCache
(
docum’tLßd”
()->
mašResourûLßd”
(), 
m_mašResourûAµliÿtiÚCache
.
g‘
()))

137  
	gŒue
;

140  
	gçl£
;

143 
boŞ
 
	gAµliÿtiÚCacheHo¡
::
maybeLßdF®lbackFÜMašE¼Ü
(cÚ¡ 
ResourûReque¡
& 
»que¡
, cÚ¡ 
ResourûE¼Ü
& 
”rÜ
)

145 #ifdeà
SSLAB__DEBUG


146 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

149 ià(!
	g”rÜ
.
isCªûÎ©iÚ
()) {

150 
ASSERT
(!
m_mašResourûAµliÿtiÚCache
);

151 ià(
isAµliÿtiÚCacheEÇbËd
()) {

152 
	gm_mašResourûAµliÿtiÚCache
 = 
AµliÿtiÚCacheGroup
::
çÎbackCacheFÜMašReque¡
(
»que¡
, 
m_docum’tLßd”
);

154 ià(
scheduËLßdF®lbackResourûFromAµliÿtiÚCache
(
docum’tLßd”
()->
mašResourûLßd”
(), 
m_mašResourûAµliÿtiÚCache
.
g‘
()))

155  
	gŒue
;

158  
	gçl£
;

161 
	gAµliÿtiÚCacheHo¡
::
mašResourûD©aReûived
(cÚ¡ *, , , 
boŞ
)

163 #ifdeà
SSLAB__DEBUG


164 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

170 
	gAµliÿtiÚCacheHo¡
::
çedLßdšgMašResourû
()

172 #ifdeà
SSLAB__DEBUG


173 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

176 
AµliÿtiÚCacheGroup
* 
	ggroup
 = 
m_ÿndid©eAµliÿtiÚCacheGroup
;

177 ià(!
	ggroup
 && 
	gm_­¶iÿtiÚCache
) {

178 
ASSERT
(!
mašResourûAµliÿtiÚCache
());

179 
	ggroup
 = 
m_­¶iÿtiÚCache
->
group
();

182 ià(
	ggroup
)

183 
	ggroup
->
çedLßdšgMašResourû
(
m_docum’tLßd”
);

186 
	gAµliÿtiÚCacheHo¡
::
fšishedLßdšgMašResourû
()

188 #ifdeà
SSLAB__DEBUG


189 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

192 
AµliÿtiÚCacheGroup
* 
	ggroup
 = 
ÿndid©eAµliÿtiÚCacheGroup
();

193 ià(!
	ggroup
 && 
­¶iÿtiÚCache
(è&& !
mašResourûAµliÿtiÚCache
())

194 
	ggroup
 = 
­¶iÿtiÚCache
()->
group
();

196 ià(
	ggroup
)

197 
	ggroup
->
fšishedLßdšgMašResourû
(
m_docum’tLßd”
);

200 
boŞ
 
	gAµliÿtiÚCacheHo¡
::
maybeLßdResourû
(
ResourûLßd”
* 
lßd”
, 
ResourûReque¡
& 
»que¡
, cÚ¡ 
KURL
& 
Üigš®URL
)

202 #ifdeà
SSLAB__DEBUG


203 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

206 ià(!
isAµliÿtiÚCacheEÇbËd
())

207  
	gçl£
;

209 ià(
	g»que¡
.
u¾
(è!ğ
Üigš®URL
)

210  
çl£
;

212 
AµliÿtiÚCacheResourû
* 
	g»sourû
;

213 ià(!
shouldLßdResourûFromAµliÿtiÚCache
(
»que¡
, 
»sourû
))

214  
	gçl£
;

216 
	gm_docum’tLßd”
->
	gm_³ndšgSub¡™u‹Resourûs
.
£t
(
lßd”
, 
»sourû
);

217 
	gm_docum’tLßd”
->
d–iv”Sub¡™u‹ResourûsAá”D–ay
();

219  
	gŒue
;

222 
boŞ
 
	gAµliÿtiÚCacheHo¡
::
maybeLßdF®lbackFÜRedœeù
(
ResourûLßd”
* 
»sourûLßd”
, 
ResourûReque¡
& 
»que¡
, cÚ¡ 
ResourûRe¥Ú£
& 
»dœeùRe¥Ú£
)

224 #ifdeà
SSLAB__DEBUG


225 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

228 ià(!
	g»dœeùRe¥Ú£
.
isNuÎ
(è&& !
´ÙocŞHo¡AndPÜtA»Equ®
(
»que¡
.
u¾
(), 
»dœeùRe¥Ú£
.url()))

229 ià(
scheduËLßdF®lbackResourûFromAµliÿtiÚCache
(
»sourûLßd”
))

230  
	gŒue
;

231  
	gçl£
;

234 
boŞ
 
	gAµliÿtiÚCacheHo¡
::
maybeLßdF®lbackFÜRe¥Ú£
(
ResourûLßd”
* 
»sourûLßd”
, cÚ¡ 
ResourûRe¥Ú£
& 
»¥Ú£
)

236 #ifdeà
SSLAB__DEBUG


237 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

240 ià(
	g»¥Ú£
.
h‰pStusCode
(è/ 100 =ğ4 || 
»¥Ú£
.httpStatusCode() / 100 == 5)

241 ià(
scheduËLßdF®lbackResourûFromAµliÿtiÚCache
(
»sourûLßd”
))

242  
Œue
;

243  
	gçl£
;

246 
boŞ
 
	gAµliÿtiÚCacheHo¡
::
maybeLßdF®lbackFÜE¼Ü
(
ResourûLßd”
* 
»sourûLßd”
, cÚ¡ 
ResourûE¼Ü
& 
”rÜ
)

248 #ifdeà
SSLAB__DEBUG


249 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

252 ià(!
	g”rÜ
.
isCªûÎ©iÚ
())

253 ià(
scheduËLßdF®lbackResourûFromAµliÿtiÚCache
(
»sourûLßd”
))

254  
	gŒue
;

255  
	gçl£
;

258 
boŞ
 
	gAµliÿtiÚCacheHo¡
::
maybeLßdSynchrÚou¦y
(
ResourûReque¡
& 
»que¡
, 
ResourûE¼Ü
& 
”rÜ
, 
ResourûRe¥Ú£
& 
»¥Ú£
, 
VeùÜ
<>& 
d©a
)

260 #ifdeà
SSLAB__DEBUG


261 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

264 
AµliÿtiÚCacheResourû
* 
	g»sourû
;

265 ià(
shouldLßdResourûFromAµliÿtiÚCache
(
»que¡
, 
»sourû
)) {

266 ià(
	g»sourû
) {

267 
	g»¥Ú£
 = 
»sourû
->
»¥Ú£
();

268 
	gd©a
.
­³nd
(
»sourû
->
d©a
()->d©a(),„esourû->d©a()->
size
());

270 
	g”rÜ
 = 
docum’tLßd”
()->
äameLßd”
()->
ş›Á
()->
ÿÂÙShowURLE¼Ü
(
»que¡
);

272  
	gŒue
;

274  
	gçl£
;

277 
	gAµliÿtiÚCacheHo¡
::
maybeLßdF®lbackSynchrÚou¦y
(cÚ¡ 
ResourûReque¡
& 
»que¡
, 
ResourûE¼Ü
& 
”rÜ
, 
ResourûRe¥Ú£
& 
»¥Ú£
, 
VeùÜ
<>& 
d©a
)

279 #ifdeà
SSLAB__DEBUG


280 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

286 ià((!
	g”rÜ
.
isNuÎ
(è&& !”rÜ.
isCªûÎ©iÚ
())

287 || 
	g»¥Ú£
.
h‰pStusCode
(è/ 100 =ğ4 || 
»¥Ú£
.httpStatusCode() / 100 == 5

288 || !
´ÙocŞHo¡AndPÜtA»Equ®
(
»que¡
.
u¾
(), 
»¥Ú£
.url())) {

289 
AµliÿtiÚCacheResourû
* 
	g»sourû
;

290 ià(
g‘AµliÿtiÚCacheF®lbackResourû
(
»que¡
, 
»sourû
)) {

291 
	g»¥Ú£
 = 
»sourû
->
»¥Ú£
();

292 
	gd©a
.
ş—r
();

293 
	gd©a
.
­³nd
(
»sourû
->
d©a
()->d©a(),„esourû->d©a()->
size
());

298 
boŞ
 
	gAµliÿtiÚCacheHo¡
::
ÿnCacheInPageCache
() const

300 #ifdeà
SSLAB__DEBUG


301 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

304  !
­¶iÿtiÚCache
(è&& !
ÿndid©eAµliÿtiÚCacheGroup
();

307 
	gAµliÿtiÚCacheHo¡
::
£tDOMAµliÿtiÚCache
(
DOMAµliÿtiÚCache
* 
domAµliÿtiÚCache
)

309 #ifdeà
SSLAB__DEBUG


310 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

313 
ASSERT
(!
m_domAµliÿtiÚCache
 || !
domAµliÿtiÚCache
);

314 
	gm_domAµliÿtiÚCache
 = 
domAµliÿtiÚCache
;

317 
	gAµliÿtiÚCacheHo¡
::
nÙifyDOMAµliÿtiÚCache
(
Ev’tID
 
id
)

319 #ifdeà
SSLAB__DEBUG


320 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

323 ià(
	gm_deãrsEv’ts
) {

325 
	gm_deã¼edEv’ts
.
­³nd
(
id
);

328 ià(
	gm_domAµliÿtiÚCache
) {

329 
Exû±iÚCode
 
	gec
 = 0;

330 
	gm_domAµliÿtiÚCache
->
di¥©chEv’t
(
Ev’t
::
ü—‹
(
DOMAµliÿtiÚCache
::
toEv’tTy³
(
id
), 
çl£
, f®£), 
ec
);

331 
ASSERT
(!
ec
);

335 
	gAµliÿtiÚCacheHo¡
::
¡İDeã¼šgEv’ts
()

337 #ifdeà
SSLAB__DEBUG


338 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

341 
	gRefPŒ
<
	gDocum’tLßd”
> 
´Ùeù
(
docum’tLßd”
());

342 
	gi
 = 0; i < 
	gm_deã¼edEv’ts
.
size
(); ++i) {

343 
Ev’tID
 
	gid
 = 
m_deã¼edEv’ts
[
i
];

344 ià(
	gm_domAµliÿtiÚCache
) {

345 
Exû±iÚCode
 
	gec
 = 0;

346 
	gm_domAµliÿtiÚCache
->
di¥©chEv’t
(
Ev’t
::
ü—‹
(
DOMAµliÿtiÚCache
::
toEv’tTy³
(
id
), 
çl£
, f®£), 
ec
);

347 
ASSERT
(!
ec
);

350 
	gm_deã¼edEv’ts
.
ş—r
();

351 
	gm_deãrsEv’ts
 = 
çl£
;

354 
	gAµliÿtiÚCacheHo¡
::
£tCªdid©eAµliÿtiÚCacheGroup
(
AµliÿtiÚCacheGroup
* 
group
)

356 #ifdeà
SSLAB__DEBUG


357 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

360 
ASSERT
(!
m_­¶iÿtiÚCache
);

361 
	gm_ÿndid©eAµliÿtiÚCacheGroup
 = 
group
;

364 
	gAµliÿtiÚCacheHo¡
::
£tAµliÿtiÚCache
(
PassRefPŒ
<
AµliÿtiÚCache
> 
­¶iÿtiÚCache
)

366 #ifdeà
SSLAB__DEBUG


367 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

370 ià(
	gm_ÿndid©eAµliÿtiÚCacheGroup
) {

371 
ASSERT
(!
m_­¶iÿtiÚCache
);

372 
	gm_ÿndid©eAµliÿtiÚCacheGroup
 = 0;

375 
	gm_­¶iÿtiÚCache
 = 
­¶iÿtiÚCache
;

378 
boŞ
 
	gAµliÿtiÚCacheHo¡
::
shouldLßdResourûFromAµliÿtiÚCache
(cÚ¡ 
ResourûReque¡
& 
»que¡
, 
AµliÿtiÚCacheResourû
*& 
»sourû
)

380 #ifdeà
SSLAB__DEBUG


381 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

384 
AµliÿtiÚCache
* 
	gÿche
 = 
­¶iÿtiÚCache
();

385 ià(!
	gÿche
 || !ÿche->
isCom¶‘e
())

386  
	gçl£
;

390 ià(!
	gAµliÿtiÚCache
::
»que¡IsHTTPOrHTTPSG‘
(
»que¡
è|| !
equ®IgnÜšgCa£
Ôeque¡.
u¾
().
´ÙocŞ
(), 
ÿche
->
mªiã¡Resourû
()->url().protocol()))

391  
	gçl£
;

395 
	g»sourû
 = 
ÿche
->
»sourûFÜURL
(
»que¡
.
u¾
());

399 ià(!
	g»sourû
 && (
	gÿche
->
u¾M©chesF®lbackName¥aû
(
»que¡
.
u¾
()è|| cache->
isURLInOÆšeWh™–i¡
(request.url())))

400  
	gçl£
;

404  
	gŒue
;

407 
boŞ
 
	gAµliÿtiÚCacheHo¡
::
g‘AµliÿtiÚCacheF®lbackResourû
(cÚ¡ 
ResourûReque¡
& 
»que¡
, 
AµliÿtiÚCacheResourû
*& 
»sourû
, 
AµliÿtiÚCache
* 
ÿche
)

409 #ifdeà
SSLAB__DEBUG


410 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

413 ià(!
	gÿche
) {

414 
	gÿche
 = 
­¶iÿtiÚCache
();

415 ià(!
	gÿche
)

416  
	gçl£
;

418 ià(!
	gÿche
->
isCom¶‘e
())

419  
	gçl£
;

422 ià(!
	gAµliÿtiÚCache
::
»que¡IsHTTPOrHTTPSG‘
(
»que¡
))

423  
çl£
;

425 
KURL
 
	gçÎbackURL
;

426 ià(!
	gÿche
->
u¾M©chesF®lbackName¥aû
(
»que¡
.
u¾
(), &
çÎbackURL
))

427  
	gçl£
;

429 
	g»sourû
 = 
ÿche
->
»sourûFÜURL
(
çÎbackURL
);

430 
ASSERT
(
»sourû
);

432  
	gŒue
;

435 
boŞ
 
	gAµliÿtiÚCacheHo¡
::
scheduËLßdF®lbackResourûFromAµliÿtiÚCache
(
ResourûLßd”
* 
lßd”
, 
AµliÿtiÚCache
* 
ÿche
)

437 #ifdeà
SSLAB__DEBUG


438 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

441 ià(!
isAµliÿtiÚCacheEÇbËd
())

442  
	gçl£
;

444 
AµliÿtiÚCacheResourû
* 
	g»sourû
;

445 ià(!
g‘AµliÿtiÚCacheF®lbackResourû
(
lßd”
->
»que¡
(), 
»sourû
, 
ÿche
))

446  
	gçl£
;

448 
	gm_docum’tLßd”
->
	gm_³ndšgSub¡™u‹Resourûs
.
£t
(
lßd”
, 
»sourû
);

449 
	gm_docum’tLßd”
->
d–iv”Sub¡™u‹ResourûsAá”D–ay
();

451 
	glßd”
->
hªdË
()->
ÿnûl
();

453  
	gŒue
;

456 
	gAµliÿtiÚCacheHo¡
::
Stus
 
AµliÿtiÚCacheHo¡
::
¡©us
() const

458 #ifdeà
SSLAB__DEBUG


459 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

462 
AµliÿtiÚCache
* 
	gÿche
 = 
­¶iÿtiÚCache
();

463 ià(!
	gÿche
)

464  
	gUNCACHED
;

466 
	gÿche
->
group
()->
upd©eStus
()) {

467 
	gAµliÿtiÚCacheGroup
::
Checkšg
:

468  
CHECKING
;

469 
	gAµliÿtiÚCacheGroup
::
DowÆßdšg
:

470  
DOWNLOADING
;

471 
	gAµliÿtiÚCacheGroup
::
IdË
: {

472 ià(
ÿche
->
group
()->
isObsŞ‘e
())

473  
OBSOLETE
;

474 ià(
	gÿche
 !ğ
ÿche
->
group
()->
Ãwe¡Cache
())

475  
UPDATEREADY
;

476  
	gIDLE
;

480 
ASSERT_NOT_REACHED
();

481  
	gUNCACHED
;

484 
boŞ
 
	gAµliÿtiÚCacheHo¡
::
upd©e
()

486 #ifdeà
SSLAB__DEBUG


487 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

490 
AµliÿtiÚCache
* 
	gÿche
 = 
­¶iÿtiÚCache
();

491 ià(!
	gÿche
)

492  
	gçl£
;

493 
	gÿche
->
group
()->
upd©e
(
m_docum’tLßd”
->
äame
(), 
AµliÿtiÚCacheUpd©eW™houtBrowsšgCÚ‹xt
);

494  
	gŒue
;

497 
boŞ
 
	gAµliÿtiÚCacheHo¡
::
sw­Cache
()

499 #ifdeà
SSLAB__DEBUG


500 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

503 
AµliÿtiÚCache
* 
	gÿche
 = 
­¶iÿtiÚCache
();

504 ià(!
	gÿche
)

505  
	gçl£
;

508 ià(
	gÿche
->
group
()->
isObsŞ‘e
()) {

509 
	gÿche
->
group
()->
di§ssocŸ‹Docum’tLßd”
(
m_docum’tLßd”
);

510  
	gŒue
;

514 
AµliÿtiÚCache
* 
	gÃwe¡Cache
 = 
ÿche
->
group
()->
Ãwe¡Cache
();

515 ià(
	gÿche
 =ğ
Ãwe¡Cache
)

516  
çl£
;

518 
ASSERT
(
ÿche
->
group
(è=ğ
Ãwe¡Cache
->group());

519 
£tAµliÿtiÚCache
(
Ãwe¡Cache
);

521  
	gŒue
;

524 
boŞ
 
	gAµliÿtiÚCacheHo¡
::
isAµliÿtiÚCacheEÇbËd
()

526 #ifdeà
SSLAB__DEBUG


527 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

530  
	gm_docum’tLßd”
->
äame
()->
£‰šgs
()

531 && 
	gm_docum’tLßd”
->
äame
()->
£‰šgs
()->
ofæšeWebAµliÿtiÚCacheEÇbËd
();

	@appcache/ApplicationCacheHost.h

31 #iâdeà
AµliÿtiÚCacheHo¡_h


32 
	#AµliÿtiÚCacheHo¡_h


	)

34 #ià
ENABLE
(
OFFLINE_WEB_APPLICATIONS
)

36 
	~<wtf/Deque.h
>

37 
	~<wtf/OwnPŒ.h
>

38 
	~<wtf/PassRefPŒ.h
>

39 
	~<wtf/RefPŒ.h
>

40 
	~<wtf/VeùÜ.h
>

42 
Çme¥aû
 
	gWebCÜe
 {

44 
şass
 
	gDOMAµliÿtiÚCache
;

45 
şass
 
	gDocum’tLßd”
;

46 
şass
 
	gKURL
;

47 
şass
 
	gResourûLßd”
;

48 
şass
 
	gResourûE¼Ü
;

49 
şass
 
	gResourûReque¡
;

50 
şass
 
	gResourûRe¥Ú£
;

51 
şass
 
	gSub¡™u‹D©a
;

52 #ià
PLATFORM
(
CHROMIUM
)

53 
şass
 
	gAµliÿtiÚCacheHo¡IÁ”Çl
;

55 
şass
 
	gAµliÿtiÚCache
;

56 
şass
 
	gAµliÿtiÚCacheGroup
;

57 
şass
 
	gAµliÿtiÚCacheResourû
;

58 
şass
 
	gAµliÿtiÚCacheStÜage
;

61 şas 
	cAµliÿtiÚCacheHo¡
 : 
public
 
NÚcİyabË
 {

62 
public
:

64 
	eStus
 {

65 
UNCACHED
 = 0,

66 
	gIDLE
 = 1,

67 
	gCHECKING
 = 2,

68 
	gDOWNLOADING
 = 3,

69 
	gUPDATEREADY
 = 4,

70 
	gOBSOLETE
 = 5

73 
	eEv’tID
 {

74 
	gCHECKING_EVENT
 = 0,

75 
	gERROR_EVENT
,

76 
	gNOUPDATE_EVENT
,

77 
	gDOWNLOADING_EVENT
,

78 
	gPROGRESS_EVENT
,

79 
	gUPDATEREADY_EVENT
,

80 
	gCACHED_EVENT
,

81 
	gOBSOLETE_EVENT


84 
AµliÿtiÚCacheHo¡
(
Docum’tLßd”
*);

85 ~
AµliÿtiÚCacheHo¡
();

87 
£ËùCacheW™houtMªiã¡
();

88 
£ËùCacheW™hMªiã¡
(cÚ¡ 
KURL
& 
mªiã¡URL
);

90 
maybeLßdMašResourû
(
ResourûReque¡
&, 
Sub¡™u‹D©a
&);

91 
boŞ
 
maybeLßdF®lbackFÜMašRe¥Ú£
(cÚ¡ 
ResourûReque¡
&, cÚ¡ 
ResourûRe¥Ú£
&);

92 
boŞ
 
maybeLßdF®lbackFÜMašE¼Ü
(cÚ¡ 
ResourûReque¡
&, cÚ¡ 
ResourûE¼Ü
&);

93 
mašResourûD©aReûived
(cÚ¡ * 
d©a
, 
Ëngth
, 
ËngthReûived
, 
boŞ
 
®lAtOnû
);

94 
fšishedLßdšgMašResourû
();

95 
çedLßdšgMašResourû
();

97 
boŞ
 
maybeLßdResourû
(
ResourûLßd”
*, 
ResourûReque¡
&, cÚ¡ 
KURL
& 
Üigš®URL
);

98 
boŞ
 
maybeLßdF®lbackFÜRedœeù
(
ResourûLßd”
*, 
ResourûReque¡
&, cÚ¡ 
ResourûRe¥Ú£
&);

99 
boŞ
 
maybeLßdF®lbackFÜRe¥Ú£
(
ResourûLßd”
*, cÚ¡ 
ResourûRe¥Ú£
&);

100 
boŞ
 
maybeLßdF®lbackFÜE¼Ü
(
ResourûLßd”
*, cÚ¡ 
ResourûE¼Ü
&);

102 
boŞ
 
maybeLßdSynchrÚou¦y
(
ResourûReque¡
&, 
ResourûE¼Ü
&, 
ResourûRe¥Ú£
&, 
VeùÜ
<>& 
d©a
);

103 
maybeLßdF®lbackSynchrÚou¦y
(cÚ¡ 
ResourûReque¡
&, 
ResourûE¼Ü
&, 
ResourûRe¥Ú£
&, 
VeùÜ
<>& 
d©a
);

105 
boŞ
 
ÿnCacheInPageCache
() const;

107 
Stus
 
¡©us
() const;

108 
boŞ
 
upd©e
();

109 
boŞ
 
sw­Cache
();

111 
£tDOMAµliÿtiÚCache
(
DOMAµliÿtiÚCache
* 
domAµliÿtiÚCache
);

112 
nÙifyDOMAµliÿtiÚCache
(
Ev’tID
 
id
);

114 
¡İDeã¼šgEv’ts
();

116 
	g´iv©e
:

117 
boŞ
 
isAµliÿtiÚCacheEÇbËd
();

118 
Docum’tLßd”
* 
docum’tLßd”
(è{  
	gm_docum’tLßd”
; }

120 
DOMAµliÿtiÚCache
* 
	gm_domAµliÿtiÚCache
;

121 
Docum’tLßd”
* 
	gm_docum’tLßd”
;

122 
boŞ
 
	gm_deãrsEv’ts
;

123 
	gVeùÜ
<
	gEv’tID
> 
	gm_deã¼edEv’ts
;

125 #ià
PLATFORM
(
CHROMIUM
)

126 
ä›nd
 
şass
 
	gAµliÿtiÚCacheHo¡IÁ”Çl
;

127 
	gOwnPŒ
<
	gAµliÿtiÚCacheHo¡IÁ”Çl
> 
	gm_š‹º®
;

129 
ä›nd
 
şass
 
	gAµliÿtiÚCacheGroup
;

130 
ä›nd
 
şass
 
	gAµliÿtiÚCacheStÜage
;

132 
boŞ
 
scheduËLßdF®lbackResourûFromAµliÿtiÚCache
(
ResourûLßd”
*, 
AµliÿtiÚCache
* = 0);

133 
boŞ
 
shouldLßdResourûFromAµliÿtiÚCache
(cÚ¡ 
ResourûReque¡
&, 
AµliÿtiÚCacheResourû
*&);

134 
boŞ
 
g‘AµliÿtiÚCacheF®lbackResourû
(cÚ¡ 
ResourûReque¡
&, 
AµliÿtiÚCacheResourû
*&, 
AµliÿtiÚCache
* = 0);

135 
£tCªdid©eAµliÿtiÚCacheGroup
(
AµliÿtiÚCacheGroup
* 
group
);

136 
AµliÿtiÚCacheGroup
* 
ÿndid©eAµliÿtiÚCacheGroup
(ècÚ¡ {  
	gm_ÿndid©eAµliÿtiÚCacheGroup
; }

137 
£tAµliÿtiÚCache
(
PassRefPŒ
<
AµliÿtiÚCache
> 
­¶iÿtiÚCache
);

138 
AµliÿtiÚCache
* 
­¶iÿtiÚCache
(ècÚ¡ {  
	gm_­¶iÿtiÚCache
.
g‘
(); }

139 
AµliÿtiÚCache
* 
mašResourûAµliÿtiÚCache
(ècÚ¡ {  
	gm_mašResourûAµliÿtiÚCache
.
g‘
(); }

143 
	gRefPŒ
<
	gAµliÿtiÚCache
> 
	gm_­¶iÿtiÚCache
;

147 
AµliÿtiÚCacheGroup
* 
	gm_ÿndid©eAµliÿtiÚCacheGroup
;

150 
	gRefPŒ
<
	gAµliÿtiÚCache
> 
	gm_mašResourûAµliÿtiÚCache
;

	@appcache/ApplicationCacheResource.cpp

2 #ifdeà
SSLAB__DEBUG


3 #iâdeà
SSLAB__QDATETIME


4 
	#SSLAB__QDATETIME


	)

5 
	~<QD©eTime
>

9 #ifdeà
SSLAB__DEBUG


10 #iâdeà
SSLAB__QTHREAD


11 
	#SSLAB__QTHREAD


	)

12 
	~<QTh»ad
>

40 
	~"cÚfig.h
"

41 
	~"AµliÿtiÚCacheResourû.h
"

42 
	~<¡dio.h
>

44 #ià
ENABLE
(
OFFLINE_WEB_APPLICATIONS
)

46 
Çme¥aû
 
	gWebCÜe
 {

48 
	gAµliÿtiÚCacheResourû
::
AµliÿtiÚCacheResourû
(cÚ¡ 
KURL
& 
u¾
, cÚ¡ 
ResourûRe¥Ú£
& 
»¥Ú£
, 
ty³
, 
PassRefPŒ
<
Sh¬edBufãr
> 
d©a
)

49 : 
Sub¡™u‹Resourû
(
u¾
, 
»¥Ú£
, 
d©a
)

50 , 
m_ty³
(
ty³
)

51 , 
m_¡ÜageID
(0)

52 , 
m_e¡im©edSizeInStÜage
(0)

54 #ifdeà
SSLAB__DEBUG


55 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

60 
	gAµliÿtiÚCacheResourû
::
addTy³
(
ty³
)

62 #ifdeà
SSLAB__DEBUG


63 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

67 
	gm_ty³
 |ğ
ty³
;

70 
št64_t
 
	gAµliÿtiÚCacheResourû
::
e¡im©edSizeInStÜage
()

72 #ifdeà
SSLAB__DEBUG


73 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

76 ià(
	gm_e¡im©edSizeInStÜage
)

77  
	gm_e¡im©edSizeInStÜage
;

79 ià(
d©a
())

80 
	gm_e¡im©edSizeInStÜage
 = 
d©a
()->
size
();

82 
	gHTTPH—d”M­
::
cÚ¡_™”©Ü
 
’d
 = 
»¥Ú£
().
h‰pH—d”F›lds
().end();

83 
	gHTTPH—d”M­
::
cÚ¡_™”©Ü
 
™
 = 
»¥Ú£
().
h‰pH—d”F›lds
().
begš
(); 
	g™
 !ğ
’d
; ++it)

84 
	gm_e¡im©edSizeInStÜage
 +ğ(
™
->
fœ¡
.
Ëngth
(è+ it->
£cÚd
.Ëngth(è+ 2è* (
UCh¬
);

86 
	gm_e¡im©edSizeInStÜage
 +ğ
u¾
().
¡ršg
().
Ëngth
(è* (
UCh¬
);

87 
	gm_e¡im©edSizeInStÜage
 += ();

88 
	gm_e¡im©edSizeInStÜage
 +ğ
»¥Ú£
().
u¾
().
¡ršg
().
Ëngth
(è* (
UCh¬
);

89 
	gm_e¡im©edSizeInStÜage
 += ();

90 
	gm_e¡im©edSizeInStÜage
 +ğ
»¥Ú£
().
mimeTy³
().
Ëngth
(è* (
UCh¬
);

91 
	gm_e¡im©edSizeInStÜage
 +ğ
»¥Ú£
().
‹xtEncodšgName
().
Ëngth
(è* (
UCh¬
);

93  
	gm_e¡im©edSizeInStÜage
;

96 #iâdeà
NDEBUG


97 
	gAµliÿtiÚCacheResourû
::
dumpTy³
(
ty³
)

99 #ifdeà
SSLAB__DEBUG


100 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

103 ià(
	gty³
 & 
	gMa¡”
)

104 
´štf
("master ");

105 ià(
	gty³
 & 
	gMªiã¡
)

106 
´štf
("manifest ");

107 ià(
	gty³
 & 
	gEx¶ic™
)

108 
´štf
("explicit ");

109 ià(
	gty³
 & 
	gFÜeign
)

110 
´štf
("foreign ");

111 ià(
	gty³
 & 
	gF®lback
)

112 
´štf
("fallback ");

114 
´štf
("\n");

	@appcache/ApplicationCacheResource.h

26 #iâdeà
AµliÿtiÚCacheResourû_h


27 
	#AµliÿtiÚCacheResourû_h


	)

29 #ià
ENABLE
(
OFFLINE_WEB_APPLICATIONS
)

31 
	~"Sub¡™u‹Resourû.h
"

33 
Çme¥aû
 
	gWebCÜe
 {

35 şas 
	cAµliÿtiÚCacheResourû
 : 
public
 
Sub¡™u‹Resourû
 {

36 
public
:

37 
	eTy³
 {

38 
Ma¡”
 = 1 << 0,

39 
	gMªiã¡
 = 1 << 1,

40 
	gEx¶ic™
 = 1 << 2,

41 
	gFÜeign
 = 1 << 3,

42 
	gF®lback
 = 1 << 4

45 
	gPassRefPŒ
<
	gAµliÿtiÚCacheResourû
> 
ü—‹
(cÚ¡ 
KURL
& 
u¾
, cÚ¡ 
ResourûRe¥Ú£
& 
»¥Ú£
, 
ty³
, 
PassRefPŒ
<
Sh¬edBufãr
> 
bufãr
 = SharedBuffer::create())

47 
ASSERT
(!
u¾
.
hasF¿gm’tId’tif›r
());

48  
adİtRef
(
Ãw
 
AµliÿtiÚCacheResourû
(
u¾
, 
»¥Ú£
, 
ty³
, 
bufãr
));

51 
ty³
(ècÚ¡ {  
	gm_ty³
; }

52 
addTy³
(
ty³
);

54 
£tStÜageID
(
¡ÜageID
è{ 
	gm_¡ÜageID
 = storageID; }

55 
¡ÜageID
(ècÚ¡ {  
	gm_¡ÜageID
; }

56 
ş—rStÜageID
(è{ 
	gm_¡ÜageID
 = 0; }

57 
št64_t
 
e¡im©edSizeInStÜage
();

59 #iâdeà
NDEBUG


60 
dumpTy³
(
ty³
);

63 
	g´iv©e
:

64 
AµliÿtiÚCacheResourû
(cÚ¡ 
KURL
& 
u¾
, cÚ¡ 
ResourûRe¥Ú£
& 
»¥Ú£
, 
ty³
, 
PassRefPŒ
<
Sh¬edBufãr
> 
bufãr
);

66 
	gm_ty³
;

67 
	gm_¡ÜageID
;

68 
št64_t
 
	gm_e¡im©edSizeInStÜage
;

	@appcache/ApplicationCacheStorage.cpp

2 #ifdeà
SSLAB__DEBUG


3 #iâdeà
SSLAB__QDATETIME


4 
	#SSLAB__QDATETIME


	)

5 
	~<QD©eTime
>

9 #ifdeà
SSLAB__DEBUG


10 #iâdeà
SSLAB__QTHREAD


11 
	#SSLAB__QTHREAD


	)

12 
	~<QTh»ad
>

40 
	~"cÚfig.h
"

41 
	~"AµliÿtiÚCacheStÜage.h
"

43 #ià
ENABLE
(
OFFLINE_WEB_APPLICATIONS
)

45 
	~"AµliÿtiÚCache.h
"

46 
	~"AµliÿtiÚCacheHo¡.h
"

47 
	~"AµliÿtiÚCacheGroup.h
"

48 
	~"AµliÿtiÚCacheResourû.h
"

49 
	~"CSŒšg.h
"

50 
	~"FeSy¡em.h
"

51 
	~"KURL.h
"

52 
	~"SQL™eS‹m’t.h
"

53 
	~"SQL™eT¿n§ùiÚ.h
"

54 
	~<wtf/StdLibExŒas.h
>

55 
	~<wtf/SŒšgExŒas.h
>

57 
usšg
 
Çme¥aû
 
	g¡d
;

59 
Çme¥aû
 
	gWebCÜe
 {

61 
	g‹m¶©e
 <
şass
 
	gT
>

62 şas 
	cStÜageIDJouº®
 {

63 
	gpublic
:

64 ~
StÜageIDJouº®
()

66 
size_t
 
size
 = 
m_»cÜds
.size();

67 
size_t
 
	gi
 = 0; i < 
	gsize
; ++i)

68 
	gm_»cÜds
[
i
].
»¡Üe
();

71 
add
(
T
* 
»sourû
, 
¡ÜageID
)

73 
	gm_»cÜds
.
­³nd
(
RecÜd
(
»sourû
, 
¡ÜageID
));

76 
comm™
()

78 
	gm_»cÜds
.
ş—r
();

81 
	g´iv©e
:

82 şas 
	cRecÜd
 {

83 
public
:

84 
RecÜd
(è: 
m_»sourû
(0), 
m_¡ÜageID
(0) { }

85 
RecÜd
(
T
* 
»sourû
, 
¡ÜageID
è: 
m_»sourû
Ôesourû), 
m_¡ÜageID
(storageID) { }

87 
»¡Üe
()

89 
	gm_»sourû
->
£tStÜageID
(
m_¡ÜageID
);

92 
	g´iv©e
:

93 
T
* 
m_»sourû
;

94 
	gm_¡ÜageID
;

97 
	gVeùÜ
<
	gRecÜd
> 
	gm_»cÜds
;

100 
	$u¾Ho¡Hash
(cÚ¡ 
KURL
& 
u¾
)

102 #ifdeà
SSLAB__DEBUG


103 
	`qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
	`cu¼’tD©eTime
().
	`toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
	`toAscii
().
	`d©a
(), 
QTh»ad
::
	`cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

106 
ho¡S¹
 = 
u¾
.
	`ho¡S¹
();

107 
ho¡End
 = 
u¾
.
	`ho¡End
();

109  
AÌ—dyHashed
::
	`avoidD–‘edV®ue
(
SŒšgIm¶
::
	`compu‹Hash
(
u¾
.
	`¡ršg
().
	`ch¬aù”s
(è+ 
ho¡S¹
, 
ho¡End
 - hostStart));

110 
	}
}

112 
AµliÿtiÚCacheGroup
* 
	gAµliÿtiÚCacheStÜage
::
	$lßdCacheGroup
(cÚ¡ 
KURL
& 
mªiã¡URL
)

114 #ifdeà
SSLAB__DEBUG


115 
	`qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
	`cu¼’tD©eTime
().
	`toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
	`toAscii
().
	`d©a
(), 
QTh»ad
::
	`cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

118 
	`İ’D©aba£
(
çl£
);

119 ià(!
m_d©aba£
.
	`isO³n
())

122 
SQL™eS‹m’t
 
	`¡©em’t
(
m_d©aba£
, "SELECT id, manifestURL,‚ewestCache FROM CacheGroups WHERE‚ewestCache IS NOT NULL AND manifestURL=?");

123 ià(
¡©em’t
.
	`´•¬e
(è!ğ
SQLResuÉOk
)

126 
¡©em’t
.
	`bšdText
(1, 
mªiã¡URL
);

128 
»suÉ
 = 
¡©em’t
.
	`¡•
();

129 ià(
»suÉ
 =ğ
SQLResuÉDÚe
)

132 ià(
»suÉ
 !ğ
SQLResuÉRow
) {

133 
	`LOG_ERROR
("Could‚Ù†ßd cachgroup,ƒ¼Ü \"%s\"", 
m_d©aba£
.
	`Ï¡E¼ÜMsg
());

137 
Ãwe¡CacheStÜageID
 = 
¡©ic_ÿ¡
<>(
¡©em’t
.
	`g‘CŞumnIÁ64
(2));

139 
RefPŒ
<
AµliÿtiÚCache
> 
ÿche
 = 
	`lßdCache
(
Ãwe¡CacheStÜageID
);

140 ià(!
ÿche
)

143 
AµliÿtiÚCacheGroup
* 
group
 = 
Ãw
 
	`AµliÿtiÚCacheGroup
(
mªiã¡URL
);

145 
group
->
	`£tStÜageID
(
¡©ic_ÿ¡
<>(
¡©em’t
.
	`g‘CŞumnIÁ64
(0)));

146 
group
->
	`£tNewe¡Cache
(
ÿche
.
	`»Ëa£
());

148  
group
;

149 
	}
}

151 
AµliÿtiÚCacheGroup
* 
	gAµliÿtiÚCacheStÜage
::
	$fšdOrC»©eCacheGroup
(cÚ¡ 
KURL
& 
mªiã¡URL
)

153 #ifdeà
SSLAB__DEBUG


154 
	`qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
	`cu¼’tD©eTime
().
	`toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
	`toAscii
().
	`d©a
(), 
QTh»ad
::
	`cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

157 
	`ASSERT
(!
mªiã¡URL
.
	`hasF¿gm’tId’tif›r
());

159 
¡d
::
·œ
<
CacheGroupM­
::
™”©Ü
, 
boŞ
> 
»suÉ
 = 
m_ÿchesInMemÜy
.
	`add
(
mªiã¡URL
, 0);

161 ià(!
»suÉ
.
£cÚd
) {

162 
	`ASSERT
(
»suÉ
.
fœ¡
->
£cÚd
);

163  
»suÉ
.
fœ¡
->
£cÚd
;

167 
AµliÿtiÚCacheGroup
* 
group
 = 
	`lßdCacheGroup
(
mªiã¡URL
);

170 ià(!
group
) {

171 
group
 = 
Ãw
 
	`AµliÿtiÚCacheGroup
(
mªiã¡URL
);

172 
m_ÿcheHo¡S‘
.
	`add
(
	`u¾Ho¡Hash
(
mªiã¡URL
));

175 
»suÉ
.
fœ¡
->
£cÚd
 = 
group
;

177  
group
;

178 
	}
}

180 
	gAµliÿtiÚCacheStÜage
::
	$lßdMªiã¡Ho¡Hashes
()

182 #ifdeà
SSLAB__DEBUG


183 
	`qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
	`cu¼’tD©eTime
().
	`toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
	`toAscii
().
	`d©a
(), 
QTh»ad
::
	`cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

186 
boŞ
 
hasLßdedHashes
 = 
çl£
;

188 ià(
hasLßdedHashes
)

193 
hasLßdedHashes
 = 
Œue
;

195 
	`İ’D©aba£
(
çl£
);

196 ià(!
m_d©aba£
.
	`isO³n
())

200 
SQL™eS‹m’t
 
	`¡©em’t
(
m_d©aba£
, "SELECT manifestHostHash FROM CacheGroups");

201 ià(
¡©em’t
.
	`´•¬e
(è!ğ
SQLResuÉOk
)

204 
»suÉ
;

205 (
»suÉ
 = 
¡©em’t
.
	`¡•
()è=ğ
SQLResuÉRow
)

206 
m_ÿcheHo¡S‘
.
	`add
(
¡©ic_ÿ¡
<>(
¡©em’t
.
	`g‘CŞumnIÁ64
(0)));

207 
	}
}

209 
AµliÿtiÚCacheGroup
* 
	gAµliÿtiÚCacheStÜage
::
	$ÿcheGroupFÜURL
(cÚ¡ 
KURL
& 
u¾
)

211 #ifdeà
SSLAB__DEBUG


212 
	`qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
	`cu¼’tD©eTime
().
	`toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
	`toAscii
().
	`d©a
(), 
QTh»ad
::
	`cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

215 
	`ASSERT
(!
u¾
.
	`hasF¿gm’tId’tif›r
());

217 
	`lßdMªiã¡Ho¡Hashes
();

220 ià(!
m_ÿcheHo¡S‘
.
	`cÚšs
(
	`u¾Ho¡Hash
(
u¾
)))

224 
CacheGroupM­
::
cÚ¡_™”©Ü
 
’d
 = 
m_ÿchesInMemÜy
.
	`’d
();

225 
CacheGroupM­
::
cÚ¡_™”©Ü
 
™
 = 
m_ÿchesInMemÜy
.
	`begš
(); iˆ!ğ
’d
; ++it) {

226 
AµliÿtiÚCacheGroup
* 
group
 = 
™
->
£cÚd
;

228 
	`ASSERT
(!
group
->
	`isObsŞ‘e
());

230 ià(!
	`´ÙocŞHo¡AndPÜtA»Equ®
(
u¾
, 
group
->
	`mªiã¡URL
()))

233 ià(
AµliÿtiÚCache
* 
ÿche
 = 
group
->
	`Ãwe¡Cache
()) {

234 
AµliÿtiÚCacheResourû
* 
»sourû
 = 
ÿche
->
	`»sourûFÜURL
(
u¾
);

235 ià(!
»sourû
)

237 ià(
»sourû
->
	`ty³
(è& 
AµliÿtiÚCacheResourû
::
FÜeign
)

239  
group
;

243 ià(!
m_d©aba£
.
	`isO³n
())

247 
SQL™eS‹m’t
 
	`¡©em’t
(
m_d©aba£
, "SELECT id, manifestURL,‚ewestCache FROM CacheGroups WHERE‚ewestCache IS NOT NULL");

248 ià(
¡©em’t
.
	`´•¬e
(è!ğ
SQLResuÉOk
)

251 
»suÉ
;

252 (
»suÉ
 = 
¡©em’t
.
	`¡•
()è=ğ
SQLResuÉRow
) {

253 
KURL
 
mªiã¡URL
 = 
	`KURL
(
P¬£dURLSŒšg
, 
¡©em’t
.
	`g‘CŞumnText
(1));

255 ià(
m_ÿchesInMemÜy
.
	`cÚšs
(
mªiã¡URL
))

258 ià(!
	`´ÙocŞHo¡AndPÜtA»Equ®
(
u¾
, 
mªiã¡URL
))

263 
Ãwe¡CacheID
 = 
¡©ic_ÿ¡
<>(
¡©em’t
.
	`g‘CŞumnIÁ64
(2));

264 
RefPŒ
<
AµliÿtiÚCache
> 
ÿche
 = 
	`lßdCache
(
Ãwe¡CacheID
);

265 ià(!
ÿche
)

268 
AµliÿtiÚCacheResourû
* 
»sourû
 = 
ÿche
->
	`»sourûFÜURL
(
u¾
);

269 ià(!
»sourû
)

271 ià(
»sourû
->
	`ty³
(è& 
AµliÿtiÚCacheResourû
::
FÜeign
)

274 
AµliÿtiÚCacheGroup
* 
group
 = 
Ãw
 
	`AµliÿtiÚCacheGroup
(
mªiã¡URL
);

276 
group
->
	`£tStÜageID
(
¡©ic_ÿ¡
<>(
¡©em’t
.
	`g‘CŞumnIÁ64
(0)));

277 
group
->
	`£tNewe¡Cache
(
ÿche
.
	`»Ëa£
());

279 
m_ÿchesInMemÜy
.
	`£t
(
group
->
	`mªiã¡URL
(), group);

281  
group
;

284 ià(
»suÉ
 !ğ
SQLResuÉDÚe
)

285 
	`LOG_ERROR
("Could‚Ù†ßd cachgroup,ƒ¼Ü \"%s\"", 
m_d©aba£
.
	`Ï¡E¼ÜMsg
());

288 
	}
}

290 
AµliÿtiÚCacheGroup
* 
	gAµliÿtiÚCacheStÜage
::
	$çÎbackCacheGroupFÜURL
(cÚ¡ 
KURL
& 
u¾
)

292 #ifdeà
SSLAB__DEBUG


293 
	`qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
	`cu¼’tD©eTime
().
	`toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
	`toAscii
().
	`d©a
(), 
QTh»ad
::
	`cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

296 
	`ASSERT
(!
u¾
.
	`hasF¿gm’tId’tif›r
());

299 
CacheGroupM­
::
cÚ¡_™”©Ü
 
’d
 = 
m_ÿchesInMemÜy
.
	`’d
();

300 
CacheGroupM­
::
cÚ¡_™”©Ü
 
™
 = 
m_ÿchesInMemÜy
.
	`begš
(); iˆ!ğ
’d
; ++it) {

301 
AµliÿtiÚCacheGroup
* 
group
 = 
™
->
£cÚd
;

303 
	`ASSERT
(!
group
->
	`isObsŞ‘e
());

305 ià(
AµliÿtiÚCache
* 
ÿche
 = 
group
->
	`Ãwe¡Cache
()) {

306 
KURL
 
çÎbackURL
;

307 ià(!
ÿche
->
	`u¾M©chesF®lbackName¥aû
(
u¾
, &
çÎbackURL
))

309 ià(
ÿche
->
	`»sourûFÜURL
(
çÎbackURL
)->
	`ty³
(è& 
AµliÿtiÚCacheResourû
::
FÜeign
)

311  
group
;

315 ià(!
m_d©aba£
.
	`isO³n
())

319 
SQL™eS‹m’t
 
	`¡©em’t
(
m_d©aba£
, "SELECT id, manifestURL,‚ewestCache FROM CacheGroups WHERE‚ewestCache IS NOT NULL");

320 ià(
¡©em’t
.
	`´•¬e
(è!ğ
SQLResuÉOk
)

323 
»suÉ
;

324 (
»suÉ
 = 
¡©em’t
.
	`¡•
()è=ğ
SQLResuÉRow
) {

325 
KURL
 
mªiã¡URL
 = 
	`KURL
(
P¬£dURLSŒšg
, 
¡©em’t
.
	`g‘CŞumnText
(1));

327 ià(
m_ÿchesInMemÜy
.
	`cÚšs
(
mªiã¡URL
))

331 ià(!
	`´ÙocŞHo¡AndPÜtA»Equ®
(
u¾
, 
mªiã¡URL
))

336 
Ãwe¡CacheID
 = 
¡©ic_ÿ¡
<>(
¡©em’t
.
	`g‘CŞumnIÁ64
(2));

337 
RefPŒ
<
AµliÿtiÚCache
> 
ÿche
 = 
	`lßdCache
(
Ãwe¡CacheID
);

339 
KURL
 
çÎbackURL
;

340 ià(!
ÿche
->
	`u¾M©chesF®lbackName¥aû
(
u¾
, &
çÎbackURL
))

342 ià(
ÿche
->
	`»sourûFÜURL
(
çÎbackURL
)->
	`ty³
(è& 
AµliÿtiÚCacheResourû
::
FÜeign
)

345 
AµliÿtiÚCacheGroup
* 
group
 = 
Ãw
 
	`AµliÿtiÚCacheGroup
(
mªiã¡URL
);

347 
group
->
	`£tStÜageID
(
¡©ic_ÿ¡
<>(
¡©em’t
.
	`g‘CŞumnIÁ64
(0)));

348 
group
->
	`£tNewe¡Cache
(
ÿche
.
	`»Ëa£
());

350 
m_ÿchesInMemÜy
.
	`£t
(
group
->
	`mªiã¡URL
(), group);

352  
group
;

355 ià(
»suÉ
 !ğ
SQLResuÉDÚe
)

356 
	`LOG_ERROR
("Could‚Ù†ßd cachgroup,ƒ¼Ü \"%s\"", 
m_d©aba£
.
	`Ï¡E¼ÜMsg
());

359 
	}
}

361 
	gAµliÿtiÚCacheStÜage
::
	$ÿcheGroupDe¡royed
(
AµliÿtiÚCacheGroup
* 
group
)

363 #ifdeà
SSLAB__DEBUG


364 
	`qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
	`cu¼’tD©eTime
().
	`toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
	`toAscii
().
	`d©a
(), 
QTh»ad
::
	`cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

367 ià(
group
->
	`isObsŞ‘e
()) {

368 
	`ASSERT
(!
group
->
	`¡ÜageID
());

369 
	`ASSERT
(
m_ÿchesInMemÜy
.
	`g‘
(
group
->
	`mªiã¡URL
()) != group);

373 
	`ASSERT
(
m_ÿchesInMemÜy
.
	`g‘
(
group
->
	`mªiã¡URL
()) == group);

375 
m_ÿchesInMemÜy
.
	`»move
(
group
->
	`mªiã¡URL
());

378 ià(!
group
->
	`¡ÜageID
())

379 
m_ÿcheHo¡S‘
.
	`»move
(
	`u¾Ho¡Hash
(
group
->
	`mªiã¡URL
()));

380 
	}
}

382 
	gAµliÿtiÚCacheStÜage
::
	$ÿcheGroupMadeObsŞ‘e
(
AµliÿtiÚCacheGroup
* 
group
)

384 #ifdeà
SSLAB__DEBUG


385 
	`qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
	`cu¼’tD©eTime
().
	`toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
	`toAscii
().
	`d©a
(), 
QTh»ad
::
	`cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

388 
	`ASSERT
(
m_ÿchesInMemÜy
.
	`g‘
(
group
->
	`mªiã¡URL
()) == group);

389 
	`ASSERT
(
m_ÿcheHo¡S‘
.
	`cÚšs
(
	`u¾Ho¡Hash
(
group
->
	`mªiã¡URL
())));

391 ià(
AµliÿtiÚCache
* 
Ãwe¡Cache
 = 
group
->
	`Ãwe¡Cache
())

392 
	`»move
(
Ãwe¡Cache
);

394 
m_ÿchesInMemÜy
.
	`»move
(
group
->
	`mªiã¡URL
());

395 
m_ÿcheHo¡S‘
.
	`»move
(
	`u¾Ho¡Hash
(
group
->
	`mªiã¡URL
()));

396 
	}
}

398 
	gAµliÿtiÚCacheStÜage
::
	$£tCacheDœeùÜy
(cÚ¡ 
SŒšg
& 
ÿcheDœeùÜy
)

400 #ifdeà
SSLAB__DEBUG


401 
	`qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
	`cu¼’tD©eTime
().
	`toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
	`toAscii
().
	`d©a
(), 
QTh»ad
::
	`cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

404 
	`ASSERT
(
m_ÿcheDœeùÜy
.
	`isNuÎ
());

405 
	`ASSERT
(!
ÿcheDœeùÜy
.
	`isNuÎ
());

407 
m_ÿcheDœeùÜy
 = 
ÿcheDœeùÜy
;

408 
	}
}

410 cÚ¡ 
	gSŒšg
& 
	gAµliÿtiÚCacheStÜage
::
	$ÿcheDœeùÜy
() const

412 #ifdeà
SSLAB__DEBUG


413 
	`qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
	`cu¼’tD©eTime
().
	`toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
	`toAscii
().
	`d©a
(), 
QTh»ad
::
	`cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

416  
m_ÿcheDœeùÜy
;

417 
	}
}

419 
	gAµliÿtiÚCacheStÜage
::
	$£tMaximumSize
(
št64_t
 
size
)

421 #ifdeà
SSLAB__DEBUG


422 
	`qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
	`cu¼’tD©eTime
().
	`toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
	`toAscii
().
	`d©a
(), 
QTh»ad
::
	`cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

425 
m_maximumSize
 = 
size
;

426 
	}
}

428 
št64_t
 
	gAµliÿtiÚCacheStÜage
::
	$maximumSize
() const

430 #ifdeà
SSLAB__DEBUG


431 
	`qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
	`cu¼’tD©eTime
().
	`toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
	`toAscii
().
	`d©a
(), 
QTh»ad
::
	`cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

434  
m_maximumSize
;

435 
	}
}

437 
boŞ
 
	gAµliÿtiÚCacheStÜage
::
	$isMaximumSizeR—ched
() const

439 #ifdeà
SSLAB__DEBUG


440 
	`qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
	`cu¼’tD©eTime
().
	`toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
	`toAscii
().
	`d©a
(), 
QTh»ad
::
	`cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

443  
m_isMaximumSizeR—ched
;

444 
	}
}

446 
št64_t
 
	gAµliÿtiÚCacheStÜage
::
	$¥aûN“ded
(
št64_t
 
ÿcheToSave
)

448 #ifdeà
SSLAB__DEBUG


449 
	`qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
	`cu¼’tD©eTime
().
	`toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
	`toAscii
().
	`d©a
(), 
QTh»ad
::
	`cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

452 
št64_t
 
¥aûN“ded
 = 0;

453 
feSize
 = 0;

454 ià(!
	`g‘FeSize
(
m_ÿcheFe
, 
feSize
))

457 
št64_t
 
cu¼’tSize
 = 
feSize
;

460 
št64_t
 
tÙ®AvaabËSize
 = 0;

461 ià(
m_maximumSize
 < 
cu¼’tSize
) {

469 
tÙ®AvaabËSize
 = 
m_d©aba£
.
	`ä“S·ûSize
();

475 
tÙ®AvaabËSize
 = (
m_maximumSize
 - 
cu¼’tSize
è+ 
m_d©aba£
.
	`ä“S·ûSize
();

480 
¥aûN“ded
 = 
ÿcheToSave
 - 
tÙ®AvaabËSize
;

484 
	`ASSERT
(
¥aûN“ded
);

485  
¥aûN“ded
;

486 
	}
}

488 
boŞ
 
	gAµliÿtiÚCacheStÜage
::
	$execu‹SQLCommªd
(cÚ¡ 
SŒšg
& 
sql
)

490 #ifdeà
SSLAB__DEBUG


491 
	`qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
	`cu¼’tD©eTime
().
	`toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
	`toAscii
().
	`d©a
(), 
QTh»ad
::
	`cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

494 
	`ASSERT
(
m_d©aba£
.
	`isO³n
());

496 
boŞ
 
»suÉ
 = 
m_d©aba£
.
	`execu‹Commªd
(
sql
);

497 ià(!
»suÉ
)

498 
	`LOG_ERROR
("Application Cache Storage: failedoƒxecute statement \"%s\"ƒrror \"%s\"",

499 
sql
.
	`utf8
().
	`d©a
(), 
m_d©aba£
.
	`Ï¡E¼ÜMsg
());

501  
»suÉ
;

502 
	}
}

504 cÚ¡ 
	gschemaV”siÚ
 = 5;

506 
	gAµliÿtiÚCacheStÜage
::
	$v”ifySchemaV”siÚ
()

508 #ifdeà
SSLAB__DEBUG


509 
	`qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
	`cu¼’tD©eTime
().
	`toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
	`toAscii
().
	`d©a
(), 
QTh»ad
::
	`cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

512 
v”siÚ
 = 
	`SQL™eS‹m’t
(
m_d©aba£
, "PRAGMA u£r_v”siÚ").
	`g‘CŞumnIÁ
(0);

513 ià(
v”siÚ
 =ğ
schemaV”siÚ
)

516 
m_d©aba£
.
	`ş—rAÎTabËs
();

519 
SQL™eT¿n§ùiÚ
 
	`£tD©aba£V”siÚ
(
m_d©aba£
);

520 
£tD©aba£V”siÚ
.
	`begš
();

522 
u£rV”siÚSQL
[32];

523 
unu£dNumBy‹s
 = 
	`¢´štf
(
u£rV”siÚSQL
, (u£rV”siÚSQL), "PRAGMA u£r_v”siÚ=%d", 
schemaV”siÚ
);

524 
	`ASSERT_UNUSED
(
unu£dNumBy‹s
, 
¡©ic_ÿ¡
<>((
u£rV”siÚSQL
)) >= unusedNumBytes);

526 
SQL™eS‹m’t
 
	`¡©em’t
(
m_d©aba£
, 
u£rV”siÚSQL
);

527 ià(
¡©em’t
.
	`´•¬e
(è!ğ
SQLResuÉOk
)

530 
	`execu‹S‹m’t
(
¡©em’t
);

531 
£tD©aba£V”siÚ
.
	`comm™
();

532 
	}
}

534 
	gAµliÿtiÚCacheStÜage
::
	$İ’D©aba£
(
boŞ
 
ü—‹IfDÛsNÙExi¡
)

536 #ifdeà
SSLAB__DEBUG


537 
	`qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
	`cu¼’tD©eTime
().
	`toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
	`toAscii
().
	`d©a
(), 
QTh»ad
::
	`cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

540 ià(
m_d©aba£
.
	`isO³n
())

544 ià(
m_ÿcheDœeùÜy
.
	`isNuÎ
())

547 
m_ÿcheFe
 = 
	`·thByAµ’dšgCompÚ’t
(
m_ÿcheDœeùÜy
, "ApplicationCache.db");

548 ià(!
ü—‹IfDÛsNÙExi¡
 && !
	`feExi¡s
(
m_ÿcheFe
))

551 
	`makeAÎDœeùÜ›s
(
m_ÿcheDœeùÜy
);

552 
m_d©aba£
.
	`İ’
(
m_ÿcheFe
);

554 ià(!
m_d©aba£
.
	`isO³n
())

557 
	`v”ifySchemaV”siÚ
();

560 
	`execu‹SQLCommªd
("CREATE TABLE IF NOT EXISTS CacheGroups (id INTEGER PRIMARY KEY AUTOINCREMENT, "

562 
	`execu‹SQLCommªd
("CREATE TABLE IF NOT EXISTS Caches (id INTEGER PRIMARY KEY AUTOINCREMENT, cacheGroup INTEGER, size INTEGER)");

563 
	`execu‹SQLCommªd
("CREATE TABLE IF NOT EXISTS CacheWhitelistURLs (url TEXT NOT NULL ON CONFLICT FAIL, cache INTEGER NOT NULL ON CONFLICT FAIL)");

564 
	`execu‹SQLCommªd
("CREATE TABLE IF NOT EXISTS CacheAllowsAllNetworkRequests (wildcard INTEGER NOT NULL ON CONFLICT FAIL, cache INTEGER NOT NULL ON CONFLICT FAIL)");

565 
	`execu‹SQLCommªd
("CREATE TABLE IF NOT EXISTS FallbackURLs (namespace TEXT NOT NULL ON CONFLICT FAIL, fallbackURL TEXT NOT NULL ON CONFLICT FAIL, "

567 
	`execu‹SQLCommªd
("CREATE TABLE IF NOT EXISTS CacheEntries (cache INTEGER NOT NULL ON CONFLICT FAIL,ype INTEGER,„esource INTEGER NOT NULL)");

568 
	`execu‹SQLCommªd
("CREATE TABLE IF NOT EXISTS CacheResources (id INTEGER PRIMARY KEY AUTOINCREMENT, url TEXT NOT NULL ON CONFLICT FAIL, "

570 
	`execu‹SQLCommªd
("CREATE TABLE IF NOT EXISTS CacheResourceData (id INTEGER PRIMARY KEY AUTOINCREMENT, data BLOB)");

573 
	`execu‹SQLCommªd
("CREATE TRIGGER IF NOT EXISTS CacheDeleted AFTER DELETE ON Caches"

582 
	`execu‹SQLCommªd
("CREATE TRIGGER IF NOT EXISTS CacheEntryDeleted AFTER DELETE ON CacheEntries"

588 
	`execu‹SQLCommªd
("CREATE TRIGGER IF NOT EXISTS CacheResourceDeleted AFTER DELETE ON CacheResources"

592 
	}
}

594 
boŞ
 
	gAµliÿtiÚCacheStÜage
::
	$execu‹S‹m’t
(
SQL™eS‹m’t
& 
¡©em’t
)

596 #ifdeà
SSLAB__DEBUG


597 
	`qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
	`cu¼’tD©eTime
().
	`toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
	`toAscii
().
	`d©a
(), 
QTh»ad
::
	`cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

600 
boŞ
 
»suÉ
 = 
¡©em’t
.
	`execu‹Commªd
();

601 ià(!
»suÉ
)

602 
	`LOG_ERROR
("Application Cache Storage: failedoƒxecute statement \"%s\"ƒrror \"%s\"",

603 
¡©em’t
.
	`qu”y
().
	`utf8
().
	`d©a
(), 
m_d©aba£
.
	`Ï¡E¼ÜMsg
());

605  
»suÉ
;

606 
	}
}

608 
boŞ
 
	gAµliÿtiÚCacheStÜage
::
	$¡Üe
(
AµliÿtiÚCacheGroup
* 
group
, 
GroupStÜageIDJouº®
* 
jouº®
)

610 #ifdeà
SSLAB__DEBUG


611 
	`qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
	`cu¼’tD©eTime
().
	`toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
	`toAscii
().
	`d©a
(), 
QTh»ad
::
	`cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

614 
	`ASSERT
(
group
->
	`¡ÜageID
() == 0);

615 
	`ASSERT
(
jouº®
);

617 
SQL™eS‹m’t
 
	`¡©em’t
(
m_d©aba£
, "INSERT INTO CacheGroups (manifestHostHash, manifestURL) VALUES (?, ?)");

618 ià(
¡©em’t
.
	`´•¬e
(è!ğ
SQLResuÉOk
)

619  
çl£
;

621 
¡©em’t
.
	`bšdIÁ64
(1, 
	`u¾Ho¡Hash
(
group
->
	`mªiã¡URL
()));

622 
¡©em’t
.
	`bšdText
(2, 
group
->
	`mªiã¡URL
());

624 ià(!
	`execu‹S‹m’t
(
¡©em’t
))

625  
çl£
;

627 
group
->
	`£tStÜageID
(
¡©ic_ÿ¡
<>(
m_d©aba£
.
	`Ï¡In£¹RowID
()));

628 
jouº®
->
	`add
(
group
, 0);

629  
Œue
;

630 
	}
}

632 
boŞ
 
	gAµliÿtiÚCacheStÜage
::
	$¡Üe
(
AµliÿtiÚCache
* 
ÿche
, 
ResourûStÜageIDJouº®
* 
¡ÜageIDJouº®
)

634 #ifdeà
SSLAB__DEBUG


635 
	`qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
	`cu¼’tD©eTime
().
	`toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
	`toAscii
().
	`d©a
(), 
QTh»ad
::
	`cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

638 
	`ASSERT
(
ÿche
->
	`¡ÜageID
() == 0);

639 
	`ASSERT
(
ÿche
->
	`group
()->
	`¡ÜageID
() != 0);

640 
	`ASSERT
(
¡ÜageIDJouº®
);

642 
SQL™eS‹m’t
 
	`¡©em’t
(
m_d©aba£
, "INSERT INTO Caches (cacheGroup, size) VALUES (?, ?)");

643 ià(
¡©em’t
.
	`´•¬e
(è!ğ
SQLResuÉOk
)

644  
çl£
;

646 
¡©em’t
.
	`bšdIÁ64
(1, 
ÿche
->
	`group
()->
	`¡ÜageID
());

647 
¡©em’t
.
	`bšdIÁ64
(2, 
ÿche
->
	`e¡im©edSizeInStÜage
());

649 ià(!
	`execu‹S‹m’t
(
¡©em’t
))

650  
çl£
;

652 
ÿcheStÜageID
 = 
¡©ic_ÿ¡
<>(
m_d©aba£
.
	`Ï¡In£¹RowID
());

656 
AµliÿtiÚCache
::
ResourûM­
::
cÚ¡_™”©Ü
 
’d
 = 
ÿche
->
	`’d
();

657 
AµliÿtiÚCache
::
ResourûM­
::
cÚ¡_™”©Ü
 
™
 = 
ÿche
->
	`begš
(); iˆ!ğ
’d
; ++it) {

658 
ŞdStÜageID
 = 
™
->
£cÚd
->
	`¡ÜageID
();

659 ià(!
	`¡Üe
(
™
->
£cÚd
.
	`g‘
(), 
ÿcheStÜageID
))

660  
çl£
;

664 
¡ÜageIDJouº®
->
	`add
(
™
->
£cÚd
.
	`g‘
(), 
ŞdStÜageID
);

669 cÚ¡ 
VeùÜ
<
KURL
>& 
ÚlšeWh™–i¡
 = 
ÿche
->
	`ÚlšeWh™–i¡
();

671 
size_t
 
wh™–i¡Size
 = 
ÚlšeWh™–i¡
.
	`size
();

672 
size_t
 
i
 = 0; i < 
wh™–i¡Size
; ++i) {

673 
SQL™eS‹m’t
 
	`¡©em’t
(
m_d©aba£
, "INSERT INTO CacheWhitelistURLs (url, cache) VALUES (?, ?)");

674 
¡©em’t
.
	`´•¬e
();

676 
¡©em’t
.
	`bšdText
(1, 
ÚlšeWh™–i¡
[
i
]);

677 
¡©em’t
.
	`bšdIÁ64
(2, 
ÿcheStÜageID
);

679 ià(!
	`execu‹S‹m’t
(
¡©em’t
))

680  
çl£
;

686 
SQL™eS‹m’t
 
	`¡©em’t
(
m_d©aba£
, "INSERT INTO CacheAllowsAllNetworkRequests (wildcard, cache) VALUES (?, ?)");

687 
¡©em’t
.
	`´•¬e
();

689 
¡©em’t
.
	`bšdIÁ64
(1, 
ÿche
->
	`®lowsAÎN‘wÜkReque¡s
());

690 
¡©em’t
.
	`bšdIÁ64
(2, 
ÿcheStÜageID
);

692 ià(!
	`execu‹S‹m’t
(
¡©em’t
))

693  
çl£
;

697 cÚ¡ 
F®lbackURLVeùÜ
& 
çÎbackURLs
 = 
ÿche
->
	`çÎbackURLs
();

699 
size_t
 
çÎbackCouÁ
 = 
çÎbackURLs
.
	`size
();

700 
size_t
 
i
 = 0; i < 
çÎbackCouÁ
; ++i) {

701 
SQL™eS‹m’t
 
	`¡©em’t
(
m_d©aba£
, "INSERT INTO FallbackURLs (namespace, fallbackURL, cache) VALUES (?, ?, ?)");

702 
¡©em’t
.
	`´•¬e
();

704 
¡©em’t
.
	`bšdText
(1, 
çÎbackURLs
[
i
].
fœ¡
);

705 
¡©em’t
.
	`bšdText
(2, 
çÎbackURLs
[
i
].
£cÚd
);

706 
¡©em’t
.
	`bšdIÁ64
(3, 
ÿcheStÜageID
);

708 ià(!
	`execu‹S‹m’t
(
¡©em’t
))

709  
çl£
;

713 
ÿche
->
	`£tStÜageID
(
ÿcheStÜageID
);

714  
Œue
;

715 
	}
}

717 
boŞ
 
	gAµliÿtiÚCacheStÜage
::
	$¡Üe
(
AµliÿtiÚCacheResourû
* 
»sourû
, 
ÿcheStÜageID
)

719 #ifdeà
SSLAB__DEBUG


720 
	`qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
	`cu¼’tD©eTime
().
	`toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
	`toAscii
().
	`d©a
(), 
QTh»ad
::
	`cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

723 
	`ASSERT
(
ÿcheStÜageID
);

724 
	`ASSERT
(!
»sourû
->
	`¡ÜageID
());

726 
	`İ’D©aba£
(
Œue
);

729 
SQL™eS‹m’t
 
	`d©aS‹m’t
(
m_d©aba£
, "INSERT INTO CacheResourceData (data) VALUES (?)");

730 ià(
d©aS‹m’t
.
	`´•¬e
(è!ğ
SQLResuÉOk
)

731  
çl£
;

733 ià(
»sourû
->
	`d©a
()->
	`size
())

734 
d©aS‹m’t
.
	`bšdBlob
(1, 
»sourû
->
	`d©a
()->d©a(),„esourû->d©a()->
	`size
());

736 ià(!
d©aS‹m’t
.
	`execu‹Commªd
())

737  
çl£
;

739 
d©aId
 = 
¡©ic_ÿ¡
<>(
m_d©aba£
.
	`Ï¡In£¹RowID
());

744 
VeùÜ
<
UCh¬
> 
¡ršgBud”
;

746 
HTTPH—d”M­
::
cÚ¡_™”©Ü
 
’d
 = 
»sourû
->
	`»¥Ú£
().
	`h‰pH—d”F›lds
().
	`’d
();

747 
HTTPH—d”M­
::
cÚ¡_™”©Ü
 
™
 = 
»sourû
->
	`»¥Ú£
().
	`h‰pH—d”F›lds
().
	`begš
(); it!ğ
’d
; ++it) {

748 
¡ršgBud”
.
	`­³nd
(
™
->
fœ¡
.
	`ch¬aù”s
(), it->fœ¡.
	`Ëngth
());

749 
¡ršgBud”
.
	`­³nd
((
UCh¬
)':');

750 
¡ršgBud”
.
	`­³nd
(
™
->
£cÚd
.
	`ch¬aù”s
(), it->£cÚd.
	`Ëngth
());

751 
¡ršgBud”
.
	`­³nd
((
UCh¬
)'\n');

754 
SŒšg
 
h—d”s
 = SŒšg::
	`adİt
(
¡ršgBud”
);

756 
SQL™eS‹m’t
 
	`»sourûS‹m’t
(
m_d©aba£
, "INSERT INTO CacheResources (url, statusCode,„esponseURL, headers, data, mimeType,extEncodingName) VALUES (?, ?, ?, ?, ?, ?, ?)");

757 ià(
»sourûS‹m’t
.
	`´•¬e
(è!ğ
SQLResuÉOk
)

758  
çl£
;

763 
»sourûS‹m’t
.
	`bšdText
(1, 
»sourû
->
	`u¾
());

764 
»sourûS‹m’t
.
	`bšdIÁ64
(2, 
»sourû
->
	`»¥Ú£
().
	`h‰pStusCode
());

765 
»sourûS‹m’t
.
	`bšdText
(3, 
»sourû
->
	`»¥Ú£
().
	`u¾
());

766 
»sourûS‹m’t
.
	`bšdText
(4, 
h—d”s
);

767 
»sourûS‹m’t
.
	`bšdIÁ64
(5, 
d©aId
);

768 
»sourûS‹m’t
.
	`bšdText
(6, 
»sourû
->
	`»¥Ú£
().
	`mimeTy³
());

769 
»sourûS‹m’t
.
	`bšdText
(7, 
»sourû
->
	`»¥Ú£
().
	`‹xtEncodšgName
());

771 ià(!
	`execu‹S‹m’t
(
»sourûS‹m’t
))

772  
çl£
;

774 
»sourûId
 = 
¡©ic_ÿ¡
<>(
m_d©aba£
.
	`Ï¡In£¹RowID
());

777 
SQL™eS‹m’t
 
	`’ŒyS‹m’t
(
m_d©aba£
, "INSERT INTO CacheEntries (cache,ype,„esource) VALUES (?, ?, ?)");

778 ià(
’ŒyS‹m’t
.
	`´•¬e
(è!ğ
SQLResuÉOk
)

779  
çl£
;

781 
’ŒyS‹m’t
.
	`bšdIÁ64
(1, 
ÿcheStÜageID
);

782 
’ŒyS‹m’t
.
	`bšdIÁ64
(2, 
»sourû
->
	`ty³
());

783 
’ŒyS‹m’t
.
	`bšdIÁ64
(3, 
»sourûId
);

785 ià(!
	`execu‹S‹m’t
(
’ŒyS‹m’t
))

786  
çl£
;

788 
»sourû
->
	`£tStÜageID
(
»sourûId
);

789  
Œue
;

790 
	}
}

792 
boŞ
 
	gAµliÿtiÚCacheStÜage
::
	$¡ÜeUpd©edTy³
(
AµliÿtiÚCacheResourû
* 
»sourû
, 
AµliÿtiÚCache
* 
ÿche
)

794 #ifdeà
SSLAB__DEBUG


795 
	`qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
	`cu¼’tD©eTime
().
	`toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
	`toAscii
().
	`d©a
(), 
QTh»ad
::
	`cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

798 
	`ASSERT_UNUSED
(
ÿche
, cache->
	`¡ÜageID
());

799 
	`ASSERT
(
»sourû
->
	`¡ÜageID
());

802 
SQL™eS‹m’t
 
	`’ŒyS‹m’t
(
m_d©aba£
, "UPDATE CacheEntries SEType=? WHERE„esource=?");

803 ià(
’ŒyS‹m’t
.
	`´•¬e
(è!ğ
SQLResuÉOk
)

804  
çl£
;

806 
’ŒyS‹m’t
.
	`bšdIÁ64
(1, 
»sourû
->
	`ty³
());

807 
’ŒyS‹m’t
.
	`bšdIÁ64
(2, 
»sourû
->
	`¡ÜageID
());

809  
	`execu‹S‹m’t
(
’ŒyS‹m’t
);

810 
	}
}

812 
boŞ
 
	gAµliÿtiÚCacheStÜage
::
	$¡Üe
(
AµliÿtiÚCacheResourû
* 
»sourû
, 
AµliÿtiÚCache
* 
ÿche
)

814 #ifdeà
SSLAB__DEBUG


815 
	`qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
	`cu¼’tD©eTime
().
	`toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
	`toAscii
().
	`d©a
(), 
QTh»ad
::
	`cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

818 
	`ASSERT
(
ÿche
->
	`¡ÜageID
());

820 
	`İ’D©aba£
(
Œue
);

822 
m_isMaximumSizeR—ched
 = 
çl£
;

823 
m_d©aba£
.
	`£tMaximumSize
(
m_maximumSize
);

825 
SQL™eT¿n§ùiÚ
 
	`¡ÜeResourûT¿n§ùiÚ
(
m_d©aba£
);

826 
¡ÜeResourûT¿n§ùiÚ
.
	`begš
();

828 ià(!
	`¡Üe
(
»sourû
, 
ÿche
->
	`¡ÜageID
())) {

829 
	`checkFÜMaxSizeR—ched
();

830  
çl£
;

834 
SQL™eS‹m’t
 
	`sizeUpd©eS‹m’t
(
m_d©aba£
, "UPDATE Caches SET size=size+? WHERE id=?");

835 ià(
sizeUpd©eS‹m’t
.
	`´•¬e
(è!ğ
SQLResuÉOk
)

836  
çl£
;

838 
sizeUpd©eS‹m’t
.
	`bšdIÁ64
(1, 
»sourû
->
	`e¡im©edSizeInStÜage
());

839 
sizeUpd©eS‹m’t
.
	`bšdIÁ64
(2, 
ÿche
->
	`¡ÜageID
());

841 ià(!
	`execu‹S‹m’t
(
sizeUpd©eS‹m’t
))

842  
çl£
;

844 
¡ÜeResourûT¿n§ùiÚ
.
	`comm™
();

845  
Œue
;

846 
	}
}

848 
boŞ
 
	gAµliÿtiÚCacheStÜage
::
	$¡ÜeNewe¡Cache
(
AµliÿtiÚCacheGroup
* 
group
)

850 #ifdeà
SSLAB__DEBUG


851 
	`qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
	`cu¼’tD©eTime
().
	`toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
	`toAscii
().
	`d©a
(), 
QTh»ad
::
	`cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

854 
	`İ’D©aba£
(
Œue
);

856 
m_isMaximumSizeR—ched
 = 
çl£
;

857 
m_d©aba£
.
	`£tMaximumSize
(
m_maximumSize
);

859 
SQL™eT¿n§ùiÚ
 
	`¡ÜeCacheT¿n§ùiÚ
(
m_d©aba£
);

861 
¡ÜeCacheT¿n§ùiÚ
.
	`begš
();

863 
GroupStÜageIDJouº®
 
groupStÜageIDJouº®
;

864 ià(!
group
->
	`¡ÜageID
()) {

866 ià(!
	`¡Üe
(
group
, &
groupStÜageIDJouº®
)) {

867 
	`checkFÜMaxSizeR—ched
();

868  
çl£
;

872 
	`ASSERT
(
group
->
	`Ãwe¡Cache
());

873 
	`ASSERT
(!
group
->
	`isObsŞ‘e
());

874 
	`ASSERT
(!
group
->
	`Ãwe¡Cache
()->
	`¡ÜageID
());

879 
ResourûStÜageIDJouº®
 
»sourûStÜageIDJouº®
;

882 ià(!
	`¡Üe
(
group
->
	`Ãwe¡Cache
(), &
»sourûStÜageIDJouº®
)) {

883 
	`checkFÜMaxSizeR—ched
();

884  
çl£
;

889 
SQL™eS‹m’t
 
	`¡©em’t
(
m_d©aba£
, "UPDATE CacheGroups SET‚ewestCache=? WHERE id=?");

890 ià(
¡©em’t
.
	`´•¬e
(è!ğ
SQLResuÉOk
)

891  
çl£
;

893 
¡©em’t
.
	`bšdIÁ64
(1, 
group
->
	`Ãwe¡Cache
()->
	`¡ÜageID
());

894 
¡©em’t
.
	`bšdIÁ64
(2, 
group
->
	`¡ÜageID
());

896 ià(!
	`execu‹S‹m’t
(
¡©em’t
))

897  
çl£
;

899 
groupStÜageIDJouº®
.
	`comm™
();

900 
»sourûStÜageIDJouº®
.
	`comm™
();

901 
¡ÜeCacheT¿n§ùiÚ
.
	`comm™
();

902  
Œue
;

903 
	}
}

905 
šlše
 
	$·r£H—d”
(cÚ¡ 
UCh¬
* 
h—d”
, 
size_t
 
h—d”L’gth
, 
ResourûRe¥Ú£
& 
»¥Ú£
)

907 #ifdeà
SSLAB__DEBUG


908 
	`qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
	`cu¼’tD©eTime
().
	`toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
	`toAscii
().
	`d©a
(), 
QTh»ad
::
	`cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

911 
pos
 = 
	`fšd
(
h—d”
, 
h—d”L’gth
, ':');

912 
	`ASSERT
(
pos
 != -1);

914 
AtomicSŒšg
 
h—d”Name
 = 
	`AtomicSŒšg
(
h—d”
, 
pos
);

915 
SŒšg
 
h—d”V®ue
 = 
	`SŒšg
(
h—d”
 + 
pos
 + 1, 
h—d”L’gth
 -…os - 1);

917 
»¥Ú£
.
	`£tHTTPH—d”F›ld
(
h—d”Name
, 
h—d”V®ue
);

918 
	}
}

920 
šlše
 
	$·r£H—d”s
(cÚ¡ 
SŒšg
& 
h—d”s
, 
ResourûRe¥Ú£
& 
»¥Ú£
)

922 #ifdeà
SSLAB__DEBUG


923 
	`qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
	`cu¼’tD©eTime
().
	`toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
	`toAscii
().
	`d©a
(), 
QTh»ad
::
	`cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

926 
¡¬tPos
 = 0;

927 
’dPos
;

928 (
’dPos
 = 
h—d”s
.
	`fšd
('\n', 
¡¬tPos
)) != -1) {

929 
	`ASSERT
(
¡¬tPos
 !ğ
’dPos
);

931 
	`·r£H—d”
(
h—d”s
.
	`ch¬aù”s
(è+ 
¡¬tPos
, 
’dPos
 - s¹Pos, 
»¥Ú£
);

933 
¡¬tPos
 = 
’dPos
 + 1;

936 ià(
¡¬tPos
 !ğ
¡©ic_ÿ¡
<>(
h—d”s
.
	`Ëngth
()))

937 
	`·r£H—d”
(
h—d”s
.
	`ch¬aù”s
(), h—d”s.
	`Ëngth
(), 
»¥Ú£
);

938 
	}
}

940 
	gPassRefPŒ
<
	gAµliÿtiÚCache
> 
	gAµliÿtiÚCacheStÜage
::
	$lßdCache
(
¡ÜageID
)

942 #ifdeà
SSLAB__DEBUG


943 
	`qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
	`cu¼’tD©eTime
().
	`toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
	`toAscii
().
	`d©a
(), 
QTh»ad
::
	`cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

946 
SQL™eS‹m’t
 
	`ÿcheS‹m’t
(
m_d©aba£
,

949 ià(
ÿcheS‹m’t
.
	`´•¬e
(è!ğ
SQLResuÉOk
) {

950 
	`LOG_ERROR
("Could‚Ù…»·» cach¡©em’t,ƒ¼Ü \"%s\"", 
m_d©aba£
.
	`Ï¡E¼ÜMsg
());

954 
ÿcheS‹m’t
.
	`bšdIÁ64
(1, 
¡ÜageID
);

956 
RefPŒ
<
AµliÿtiÚCache
> 
ÿche
 = AµliÿtiÚCache::
	`ü—‹
();

958 
»suÉ
;

959 (
»suÉ
 = 
ÿcheS‹m’t
.
	`¡•
()è=ğ
SQLResuÉRow
) {

960 
KURL
 
	`u¾
(
P¬£dURLSŒšg
, 
ÿcheS‹m’t
.
	`g‘CŞumnText
(0));

962 
ty³
 = 
¡©ic_ÿ¡
<>(
ÿcheS‹m’t
.
	`g‘CŞumnIÁ64
(1));

964 
VeùÜ
<> 
blob
;

965 
ÿcheS‹m’t
.
	`g‘CŞumnBlobAsVeùÜ
(5, 
blob
);

967 
RefPŒ
<
Sh¬edBufãr
> 
d©a
 = Sh¬edBufãr::
	`adİtVeùÜ
(
blob
);

969 
SŒšg
 
mimeTy³
 = 
ÿcheS‹m’t
.
	`g‘CŞumnText
(2);

970 
SŒšg
 
‹xtEncodšgName
 = 
ÿcheS‹m’t
.
	`g‘CŞumnText
(3);

972 
ResourûRe¥Ú£
 
	`»¥Ú£
(
u¾
, 
mimeTy³
, 
d©a
->
	`size
(), 
‹xtEncodšgName
, "");

974 
SŒšg
 
h—d”s
 = 
ÿcheS‹m’t
.
	`g‘CŞumnText
(4);

975 
	`·r£H—d”s
(
h—d”s
, 
»¥Ú£
);

977 
RefPŒ
<
AµliÿtiÚCacheResourû
> 
»sourû
 = AµliÿtiÚCacheResourû::
	`ü—‹
(
u¾
, 
»¥Ú£
, 
ty³
, 
d©a
.
	`»Ëa£
());

979 ià(
ty³
 & 
AµliÿtiÚCacheResourû
::
Mªiã¡
)

980 
ÿche
->
	`£tMªiã¡Resourû
(
»sourû
.
	`»Ëa£
());

982 
ÿche
->
	`addResourû
(
»sourû
.
	`»Ëa£
());

985 ià(
»suÉ
 !ğ
SQLResuÉDÚe
)

986 
	`LOG_ERROR
("Could‚Ù†ßd cach»sourûs,ƒ¼Ü \"%s\"", 
m_d©aba£
.
	`Ï¡E¼ÜMsg
());

989 
SQL™eS‹m’t
 
	`wh™–i¡S‹m’t
(
m_d©aba£
, "SELECT url FROM CacheWhitelistURLs WHERE cache=?");

990 ià(
wh™–i¡S‹m’t
.
	`´•¬e
(è!ğ
SQLResuÉOk
)

992 
wh™–i¡S‹m’t
.
	`bšdIÁ64
(1, 
¡ÜageID
);

994 
VeùÜ
<
KURL
> 
wh™–i¡
;

995 (
»suÉ
 = 
wh™–i¡S‹m’t
.
	`¡•
()è=ğ
SQLResuÉRow
)

996 
wh™–i¡
.
	`­³nd
(
	`KURL
(
P¬£dURLSŒšg
, 
wh™–i¡S‹m’t
.
	`g‘CŞumnText
(0)));

998 ià(
»suÉ
 !ğ
SQLResuÉDÚe
)

999 
	`LOG_ERROR
("Could‚Ù†ßd cachÚlšwh™–i¡,ƒ¼Ü \"%s\"", 
m_d©aba£
.
	`Ï¡E¼ÜMsg
());

1001 
ÿche
->
	`£tOÆšeWh™–i¡
(
wh™–i¡
);

1004 
SQL™eS‹m’t
 
	`wh™–i¡WdÿrdS‹m’t
(
m_d©aba£
, "SELECT wildcard FROM CacheAllowsAllNetworkRequests WHERE cache=?");

1005 ià(
wh™–i¡WdÿrdS‹m’t
.
	`´•¬e
(è!ğ
SQLResuÉOk
)

1007 
wh™–i¡WdÿrdS‹m’t
.
	`bšdIÁ64
(1, 
¡ÜageID
);

1009 
»suÉ
 = 
wh™–i¡WdÿrdS‹m’t
.
	`¡•
();

1010 ià(
»suÉ
 !ğ
SQLResuÉRow
)

1011 
	`LOG_ERROR
("Could‚Ù†ßd cachÚlšwh™–i¡ wdÿrd fÏg,ƒ¼Ü \"%s\"", 
m_d©aba£
.
	`Ï¡E¼ÜMsg
());

1013 
ÿche
->
	`£tAÎowsAÎN‘wÜkReque¡s
(
wh™–i¡WdÿrdS‹m’t
.
	`g‘CŞumnIÁ64
(0));

1015 ià(
wh™–i¡WdÿrdS‹m’t
.
	`¡•
(è!ğ
SQLResuÉDÚe
)

1016 
	`LOG_ERROR
("Too many„ows for online whitelist wildcard flag");

1019 
SQL™eS‹m’t
 
	`çÎbackS‹m’t
(
m_d©aba£
, "SELECT‚amespace, fallbackURL FROM FallbackURLs WHERE cache=?");

1020 ià(
çÎbackS‹m’t
.
	`´•¬e
(è!ğ
SQLResuÉOk
)

1022 
çÎbackS‹m’t
.
	`bšdIÁ64
(1, 
¡ÜageID
);

1024 
F®lbackURLVeùÜ
 
çÎbackURLs
;

1025 (
»suÉ
 = 
çÎbackS‹m’t
.
	`¡•
()è=ğ
SQLResuÉRow
)

1026 
çÎbackURLs
.
	`­³nd
(
	`make_·œ
(
	`KURL
(
P¬£dURLSŒšg
, 
çÎbackS‹m’t
.
	`g‘CŞumnText
(0)), KURL(ParsedURLString, fallbackStatement.getColumnText(1))));

1028 ià(
»suÉ
 !ğ
SQLResuÉDÚe
)

1029 
	`LOG_ERROR
("Could‚Ù†ßd f®lback URLs,ƒ¼Ü \"%s\"", 
m_d©aba£
.
	`Ï¡E¼ÜMsg
());

1031 
ÿche
->
	`£tF®lbackURLs
(
çÎbackURLs
);

1033 
ÿche
->
	`£tStÜageID
(
¡ÜageID
);

1035  
ÿche
.
	`»Ëa£
();

1036 
	}
}

1038 
	gAµliÿtiÚCacheStÜage
::
	$»move
(
AµliÿtiÚCache
* 
ÿche
)

1040 #ifdeà
SSLAB__DEBUG


1041 
	`qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
	`cu¼’tD©eTime
().
	`toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
	`toAscii
().
	`d©a
(), 
QTh»ad
::
	`cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

1044 ià(!
ÿche
->
	`¡ÜageID
())

1047 
	`İ’D©aba£
(
çl£
);

1048 ià(!
m_d©aba£
.
	`isO³n
())

1051 
	`ASSERT
(
ÿche
->
	`group
());

1052 
	`ASSERT
(
ÿche
->
	`group
()->
	`¡ÜageID
());

1055 
SQL™eS‹m’t
 
	`¡©em’t
(
m_d©aba£
, "DELETE FROM Caches WHERE id=?");

1056 ià(
¡©em’t
.
	`´•¬e
(è!ğ
SQLResuÉOk
)

1059 
¡©em’t
.
	`bšdIÁ64
(1, 
ÿche
->
	`¡ÜageID
());

1060 
	`execu‹S‹m’t
(
¡©em’t
);

1062 
ÿche
->
	`ş—rStÜageID
();

1064 ià(
ÿche
->
	`group
()->
	`Ãwe¡Cache
() == cache) {

1066 
SQL™eS‹m’t
 
	`groupS‹m’t
(
m_d©aba£
, "DELETE FROM CacheGroups WHERE id=?");

1067 ià(
groupS‹m’t
.
	`´•¬e
(è!ğ
SQLResuÉOk
)

1070 
groupS‹m’t
.
	`bšdIÁ64
(1, 
ÿche
->
	`group
()->
	`¡ÜageID
());

1071 
	`execu‹S‹m’t
(
groupS‹m’t
);

1073 
ÿche
->
	`group
()->
	`ş—rStÜageID
();

1075 
	}
}

1077 
	gAµliÿtiÚCacheStÜage
::
	$em±y
()

1079 #ifdeà
SSLAB__DEBUG


1080 
	`qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
	`cu¼’tD©eTime
().
	`toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
	`toAscii
().
	`d©a
(), 
QTh»ad
::
	`cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

1083 
	`İ’D©aba£
(
çl£
);

1085 ià(!
m_d©aba£
.
	`isO³n
())

1089 
	`execu‹SQLCommªd
("DELETE FROM CacheGroups");

1090 
	`execu‹SQLCommªd
("DELETE FROM Caches");

1095 
CacheGroupM­
::
cÚ¡_™”©Ü
 
’d
 = 
m_ÿchesInMemÜy
.
	`’d
();

1096 
CacheGroupM­
::
cÚ¡_™”©Ü
 
™
 = 
m_ÿchesInMemÜy
.
	`begš
(); iˆ!ğ
’d
; ++it)

1097 
™
->
£cÚd
->
	`ş—rStÜageID
();

1098 
	}
}

1100 
boŞ
 
	gAµliÿtiÚCacheStÜage
::
	$¡ÜeCİyOfCache
(cÚ¡ 
SŒšg
& 
ÿcheDœeùÜy
, 
AµliÿtiÚCacheHo¡
* 
ÿcheHo¡
)

1102 #ifdeà
SSLAB__DEBUG


1103 
	`qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
	`cu¼’tD©eTime
().
	`toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
	`toAscii
().
	`d©a
(), 
QTh»ad
::
	`cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

1106 
AµliÿtiÚCache
* 
ÿche
 = 
ÿcheHo¡
->
	`­¶iÿtiÚCache
();

1107 ià(!
ÿche
)

1108  
Œue
;

1111 
RefPŒ
<
AµliÿtiÚCache
> 
ÿcheCİy
 = AµliÿtiÚCache::
	`ü—‹
();

1113 
ÿcheCİy
->
	`£tOÆšeWh™–i¡
(
ÿche
->
	`ÚlšeWh™–i¡
());

1114 
ÿcheCİy
->
	`£tF®lbackURLs
(
ÿche
->
	`çÎbackURLs
());

1117 
AµliÿtiÚCache
::
ResourûM­
::
cÚ¡_™”©Ü
 
’d
 = 
ÿche
->
	`’d
();

1118 
AµliÿtiÚCache
::
ResourûM­
::
cÚ¡_™”©Ü
 
™
 = 
ÿche
->
	`begš
(); iˆ!ğ
’d
; ++it) {

1119 
AµliÿtiÚCacheResourû
* 
»sourû
 = 
™
->
£cÚd
.
	`g‘
();

1121 
RefPŒ
<
AµliÿtiÚCacheResourû
> 
»sourûCİy
 = AµliÿtiÚCacheResourû::
	`ü—‹
(
»sourû
->
	`u¾
(),„esourû->
	`»¥Ú£
(),„esourû->
	`ty³
(),„esourû->
	`d©a
());

1123 
ÿcheCİy
->
	`addResourû
(
»sourûCİy
.
	`»Ëa£
());

1127 
OwnPŒ
<
AµliÿtiÚCacheGroup
> 
	`groupCİy
(
Ãw
 
	`AµliÿtiÚCacheGroup
(
ÿche
->
	`group
()->
	`mªiã¡URL
(), 
Œue
));

1129 
groupCİy
->
	`£tNewe¡Cache
(
ÿcheCİy
);

1131 
AµliÿtiÚCacheStÜage
 
cİyStÜage
;

1132 
cİyStÜage
.
	`£tCacheDœeùÜy
(
ÿcheDœeùÜy
);

1135 
cİyStÜage
.
	`em±y
();

1137  
cİyStÜage
.
	`¡ÜeNewe¡Cache
(
groupCİy
.
	`g‘
());

1138 
	}
}

1140 
boŞ
 
	gAµliÿtiÚCacheStÜage
::
mªiã¡URLs
(
VeùÜ
<
KURL
>* 
u¾s
)

1142 #ifdeà
SSLAB__DEBUG


1143 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

1146 
ASSERT
(
u¾s
);

1147 
İ’D©aba£
(
çl£
);

1148 ià(!
	gm_d©aba£
.
isO³n
())

1149  
	gçl£
;

1151 
SQL™eS‹m’t
 
£ËùURLs
(
m_d©aba£
, "SELECT manifestURL FROM CacheGroups");

1153 ià(
	g£ËùURLs
.
´•¬e
(è!ğ
SQLResuÉOk
)

1154  
çl£
;

1156 
	g£ËùURLs
.
¡•
(è=ğ
SQLResuÉRow
)

1157 
u¾s
->
­³nd
(
KURL
(
P¬£dURLSŒšg
, 
£ËùURLs
.
g‘CŞumnText
(0)));

1159  
	gŒue
;

1162 
boŞ
 
	gAµliÿtiÚCacheStÜage
::
	$ÿcheGroupSize
(cÚ¡ 
SŒšg
& 
mªiã¡URL
, 
št64_t
* 
size
)

1164 #ifdeà
SSLAB__DEBUG


1165 
	`qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
	`cu¼’tD©eTime
().
	`toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
	`toAscii
().
	`d©a
(), 
QTh»ad
::
	`cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

1168 
	`ASSERT
(
size
);

1169 
	`İ’D©aba£
(
çl£
);

1170 ià(!
m_d©aba£
.
	`isO³n
())

1171  
çl£
;

1173 
SQL™eS‹m’t
 
	`¡©em’t
(
m_d©aba£
, "SELECT sum(Caches.size) FROM Caches INNER JOIN CacheGroups ON Caches.cacheGroup=CacheGroups.id WHERE CacheGroups.manifestURL=?");

1174 ià(
¡©em’t
.
	`´•¬e
(è!ğ
SQLResuÉOk
)

1175  
çl£
;

1177 
¡©em’t
.
	`bšdText
(1, 
mªiã¡URL
);

1179 
»suÉ
 = 
¡©em’t
.
	`¡•
();

1180 ià(
»suÉ
 =ğ
SQLResuÉDÚe
)

1181  
çl£
;

1183 ià(
»suÉ
 !ğ
SQLResuÉRow
) {

1184 
	`LOG_ERROR
("Could‚Ù g‘hsizoàthÿchgroup,ƒ¼Ü \"%s\"", 
m_d©aba£
.
	`Ï¡E¼ÜMsg
());

1185  
çl£
;

1188 *
size
 = 
¡©em’t
.
	`g‘CŞumnIÁ64
(0);

1189  
Œue
;

1190 
	}
}

1192 
boŞ
 
	gAµliÿtiÚCacheStÜage
::
	$d–‘eCacheGroup
(cÚ¡ 
SŒšg
& 
mªiã¡URL
)

1194 #ifdeà
SSLAB__DEBUG


1195 
	`qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
	`cu¼’tD©eTime
().
	`toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
	`toAscii
().
	`d©a
(), 
QTh»ad
::
	`cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

1198 
SQL™eT¿n§ùiÚ
 
	`d–‘eT¿n§ùiÚ
(
m_d©aba£
);

1200 
AµliÿtiÚCacheGroup
* 
group
 = 
m_ÿchesInMemÜy
.
	`g‘
(
mªiã¡URL
);

1201 ià(
group
)

1202 
	`ÿcheGroupMadeObsŞ‘e
(
group
);

1205 
	`İ’D©aba£
(
çl£
);

1206 ià(!
m_d©aba£
.
	`isO³n
())

1207  
çl£
;

1209 
SQL™eS‹m’t
 
	`idS‹m’t
(
m_d©aba£
, "SELECT id FROM CacheGroups WHERE manifestURL=?");

1210 ià(
idS‹m’t
.
	`´•¬e
(è!ğ
SQLResuÉOk
)

1211  
çl£
;

1213 
idS‹m’t
.
	`bšdText
(1, 
mªiã¡URL
);

1215 
»suÉ
 = 
idS‹m’t
.
	`¡•
();

1216 ià(
»suÉ
 =ğ
SQLResuÉDÚe
)

1217  
çl£
;

1219 ià(
»suÉ
 !ğ
SQLResuÉRow
) {

1220 
	`LOG_ERROR
("Could‚Ù†ßd cachgrou°id,ƒ¼Ü \"%s\"", 
m_d©aba£
.
	`Ï¡E¼ÜMsg
());

1221  
çl£
;

1224 
št64_t
 
groupId
 = 
idS‹m’t
.
	`g‘CŞumnIÁ64
(0);

1226 
SQL™eS‹m’t
 
	`ÿcheS‹m’t
(
m_d©aba£
, "DELETE FROM Caches WHERE cacheGroup=?");

1227 ià(
ÿcheS‹m’t
.
	`´•¬e
(è!ğ
SQLResuÉOk
)

1228  
çl£
;

1230 
SQL™eS‹m’t
 
	`groupS‹m’t
(
m_d©aba£
, "DELETE FROM CacheGroups WHERE id=?");

1231 ià(
groupS‹m’t
.
	`´•¬e
(è!ğ
SQLResuÉOk
)

1232  
çl£
;

1234 
ÿcheS‹m’t
.
	`bšdIÁ64
(1, 
groupId
);

1235 
	`execu‹S‹m’t
(
ÿcheS‹m’t
);

1236 
groupS‹m’t
.
	`bšdIÁ64
(1, 
groupId
);

1237 
	`execu‹S‹m’t
(
groupS‹m’t
);

1240 
d–‘eT¿n§ùiÚ
.
	`comm™
();

1241  
Œue
;

1242 
	}
}

1244 
	gAµliÿtiÚCacheStÜage
::
	$vacuumD©aba£Fe
()

1246 #ifdeà
SSLAB__DEBUG


1247 
	`qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
	`cu¼’tD©eTime
().
	`toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
	`toAscii
().
	`d©a
(), 
QTh»ad
::
	`cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

1250 
	`İ’D©aba£
(
çl£
);

1251 ià(!
m_d©aba£
.
	`isO³n
())

1254 
m_d©aba£
.
	`runVacuumCommªd
();

1255 
	}
}

1257 
	gAµliÿtiÚCacheStÜage
::
	$checkFÜMaxSizeR—ched
()

1259 #ifdeà
SSLAB__DEBUG


1260 
	`qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
	`cu¼’tD©eTime
().
	`toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
	`toAscii
().
	`d©a
(), 
QTh»ad
::
	`cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

1263 ià(
m_d©aba£
.
	`Ï¡E¼Ü
(è=ğ
SQLResuÉFuÎ
)

1264 
m_isMaximumSizeR—ched
 = 
Œue
;

1265 
	}
}

1267 
	gAµliÿtiÚCacheStÜage
::
	$AµliÿtiÚCacheStÜage
()

1268 : 
	`m_maximumSize
(
INT_MAX
)

1269 , 
	$m_isMaximumSizeR—ched
(
çl£
)

1271 #ifdeà
SSLAB__DEBUG


1272 
	`qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
	`cu¼’tD©eTime
().
	`toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
	`toAscii
().
	`d©a
(), 
QTh»ad
::
	`cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

1275 
	}
}

1277 
	gAµliÿtiÚCacheStÜage
& 
	$ÿcheStÜage
()

1279 #ifdeà
SSLAB__DEBUG


1280 
	`qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
	`cu¼’tD©eTime
().
	`toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
	`toAscii
().
	`d©a
(), 
QTh»ad
::
	`cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

1283 
	`DEFINE_STATIC_LOCAL
(
AµliÿtiÚCacheStÜage
, 
¡Üage
, ());

1285  
¡Üage
;

1286 
	}
}

	@appcache/ApplicationCacheStorage.h

26 #iâdeà
AµliÿtiÚCacheStÜage_h


27 
	#AµliÿtiÚCacheStÜage_h


	)

29 #ià
ENABLE
(
OFFLINE_WEB_APPLICATIONS
)

31 
	~"PÏtfÜmSŒšg.h
"

32 
	~"SQL™eD©aba£.h
"

33 
	~"SŒšgHash.h
"

35 
	~<wtf/HashCouÁedS‘.h
>

37 
Çme¥aû
 
	gWebCÜe
 {

39 
şass
 
	gAµliÿtiÚCache
;

40 
şass
 
	gAµliÿtiÚCacheHo¡
;

41 
şass
 
	gAµliÿtiÚCacheGroup
;

42 
şass
 
	gAµliÿtiÚCacheResourû
;

43 
şass
 
	gKURL
;

44 
	g‹m¶©e
 <
şass
 
	gT
>

45 
şass
 
	gStÜageIDJouº®
;

47 şas 
	cAµliÿtiÚCacheStÜage
 : 
public
 
NÚcİyabË
 {

48 
public
:

49 
£tCacheDœeùÜy
(cÚ¡ 
SŒšg
&);

50 cÚ¡ 
	gSŒšg
& 
ÿcheDœeùÜy
() const;

52 
£tMaximumSize
(
št64_t
 
size
);

53 
št64_t
 
maximumSize
() const;

54 
boŞ
 
isMaximumSizeR—ched
() const;

55 
št64_t
 
¥aûN“ded
(št64_ˆ
ÿcheToSave
);

57 
AµliÿtiÚCacheGroup
* 
ÿcheGroupFÜURL
(cÚ¡ 
KURL
&);

58 
AµliÿtiÚCacheGroup
* 
çÎbackCacheGroupFÜURL
(cÚ¡ 
KURL
&);

60 
AµliÿtiÚCacheGroup
* 
fšdOrC»©eCacheGroup
(cÚ¡ 
KURL
& 
mªiã¡URL
);

61 
ÿcheGroupDe¡royed
(
AµliÿtiÚCacheGroup
*);

62 
ÿcheGroupMadeObsŞ‘e
(
AµliÿtiÚCacheGroup
*);

64 
boŞ
 
¡ÜeNewe¡Cache
(
AµliÿtiÚCacheGroup
*);

65 
boŞ
 
¡Üe
(
AµliÿtiÚCacheResourû
*, 
AµliÿtiÚCache
*);

66 
boŞ
 
¡ÜeUpd©edTy³
(
AµliÿtiÚCacheResourû
*, 
AµliÿtiÚCache
*);

69 
»move
(
AµliÿtiÚCache
*);

71 
em±y
();

73 
boŞ
 
¡ÜeCİyOfCache
(cÚ¡ 
SŒšg
& 
ÿcheDœeùÜy
, 
AµliÿtiÚCacheHo¡
*);

75 
boŞ
 
mªiã¡URLs
(
VeùÜ
<
KURL
>* 
u¾s
);

76 
boŞ
 
ÿcheGroupSize
(cÚ¡ 
SŒšg
& 
mªiã¡URL
, 
št64_t
* 
size
);

77 
boŞ
 
d–‘eCacheGroup
(cÚ¡ 
SŒšg
& 
mªiã¡URL
);

78 
vacuumD©aba£Fe
();

79 
	g´iv©e
:

80 
AµliÿtiÚCacheStÜage
();

81 
	gPassRefPŒ
<
	gAµliÿtiÚCache
> 
lßdCache
(
¡ÜageID
);

82 
AµliÿtiÚCacheGroup
* 
lßdCacheGroup
(cÚ¡ 
KURL
& 
mªiã¡URL
);

84 
	gStÜageIDJouº®
<
	tAµliÿtiÚCacheResourû
> 
	tResourûStÜageIDJouº®
;

85 
	gStÜageIDJouº®
<
	tAµliÿtiÚCacheGroup
> 
	tGroupStÜageIDJouº®
;

87 
boŞ
 
¡Üe
(
AµliÿtiÚCacheGroup
*, 
GroupStÜageIDJouº®
*);

88 
boŞ
 
¡Üe
(
AµliÿtiÚCache
*, 
ResourûStÜageIDJouº®
*);

89 
boŞ
 
¡Üe
(
AµliÿtiÚCacheResourû
*, 
ÿcheStÜageID
);

91 
lßdMªiã¡Ho¡Hashes
();

93 
v”ifySchemaV”siÚ
();

95 
İ’D©aba£
(
boŞ
 
ü—‹IfDÛsNÙExi¡
);

97 
boŞ
 
execu‹S‹m’t
(
SQL™eS‹m’t
&);

98 
boŞ
 
execu‹SQLCommªd
(cÚ¡ 
SŒšg
&);

100 
checkFÜMaxSizeR—ched
();

102 
SŒšg
 
	gm_ÿcheDœeùÜy
;

103 
SŒšg
 
	gm_ÿcheFe
;

105 
št64_t
 
	gm_maximumSize
;

106 
boŞ
 
	gm_isMaximumSizeR—ched
;

108 
SQL™eD©aba£
 
	gm_d©aba£
;

112 
	gHashCouÁedS‘
<, 
	gAÌ—dyHashed
> 
	gm_ÿcheHo¡S‘
;

114 
	gHashM­
<
	tSŒšg
, 
	tAµliÿtiÚCacheGroup
*> 
	tCacheGroupM­
;

115 
CacheGroupM­
 
	gm_ÿchesInMemÜy
;

117 
ä›nd
 
	gAµliÿtiÚCacheStÜage
& 
ÿcheStÜage
();

120 
	gAµliÿtiÚCacheStÜage
& 
ÿcheStÜage
();

	@appcache/DOMApplicationCache.cpp

2 #ifdeà
SSLAB__DEBUG


3 #iâdeà
SSLAB__QDATETIME


4 
	#SSLAB__QDATETIME


	)

5 
	~<QD©eTime
>

9 #ifdeà
SSLAB__DEBUG


10 #iâdeà
SSLAB__QTHREAD


11 
	#SSLAB__QTHREAD


	)

12 
	~<QTh»ad
>

40 
	~"cÚfig.h
"

41 
	~"DOMAµliÿtiÚCache.h
"

43 #ià
ENABLE
(
OFFLINE_WEB_APPLICATIONS
)

45 
	~"AµliÿtiÚCacheHo¡.h
"

46 
	~"Docum’tLßd”.h
"

47 
	~"Ev’t.h
"

48 
	~"Ev’tExû±iÚ.h
"

49 
	~"Ev’tLi¡’”.h
"

50 
	~"Ev’tNames.h
"

51 
	~"F¿me.h
"

52 
	~"F¿meLßd”.h
"

54 
Çme¥aû
 
	gWebCÜe
 {

56 
	gDOMAµliÿtiÚCache
::
DOMAµliÿtiÚCache
(
F¿me
* 
äame
)

57 : 
m_äame
(
äame
)

59 #ifdeà
SSLAB__DEBUG


60 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

63 
AµliÿtiÚCacheHo¡
* 
	gÿcheHo¡
 = 
­¶iÿtiÚCacheHo¡
();

64 ià(
	gÿcheHo¡
)

65 
	gÿcheHo¡
->
£tDOMAµliÿtiÚCache
(
this
);

68 
	gDOMAµliÿtiÚCache
::
discÚÃùF¿me
()

70 #ifdeà
SSLAB__DEBUG


71 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

74 
AµliÿtiÚCacheHo¡
* 
	gÿcheHo¡
 = 
­¶iÿtiÚCacheHo¡
();

75 ià(
	gÿcheHo¡
)

76 
	gÿcheHo¡
->
£tDOMAµliÿtiÚCache
(0);

77 
	gm_äame
 = 0;

80 
AµliÿtiÚCacheHo¡
* 
	gDOMAµliÿtiÚCache
::
­¶iÿtiÚCacheHo¡
() const

82 #ifdeà
SSLAB__DEBUG


83 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

86 ià(!
	gm_äame
 || !m_äame->
lßd”
()->
docum’tLßd”
())

88  
	gm_äame
->
lßd”
()->
docum’tLßd”
()->
­¶iÿtiÚCacheHo¡
();

91 
	gDOMAµliÿtiÚCache
::
¡©us
() const

93 #ifdeà
SSLAB__DEBUG


94 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

97 
AµliÿtiÚCacheHo¡
* 
	gÿcheHo¡
 = 
­¶iÿtiÚCacheHo¡
();

98 ià(!
	gÿcheHo¡
)

99  
	gAµliÿtiÚCacheHo¡
::
UNCACHED
;

100  
	gÿcheHo¡
->
¡©us
();

103 
	gDOMAµliÿtiÚCache
::
upd©e
(
Exû±iÚCode
& 
ec
)

105 #ifdeà
SSLAB__DEBUG


106 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

109 
AµliÿtiÚCacheHo¡
* 
	gÿcheHo¡
 = 
­¶iÿtiÚCacheHo¡
();

110 ià(!
	gÿcheHo¡
 || !ÿcheHo¡->
upd©e
())

111 
	gec
 = 
INVALID_STATE_ERR
;

114 
	gDOMAµliÿtiÚCache
::
sw­Cache
(
Exû±iÚCode
& 
ec
)

116 #ifdeà
SSLAB__DEBUG


117 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

120 
AµliÿtiÚCacheHo¡
* 
	gÿcheHo¡
 = 
­¶iÿtiÚCacheHo¡
();

121 ià(!
	gÿcheHo¡
 || !ÿcheHo¡->
sw­Cache
())

122 
	gec
 = 
INVALID_STATE_ERR
;

125 
SütExecutiÚCÚ‹xt
* 
	gDOMAµliÿtiÚCache
::
sütExecutiÚCÚ‹xt
() const

127 #ifdeà
SSLAB__DEBUG


128 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

131 ià(
	gm_äame
)

132  
	gm_äame
->
docum’t
();

136 cÚ¡ 
	gAtomicSŒšg
& 
	gDOMAµliÿtiÚCache
::
toEv’tTy³
(
AµliÿtiÚCacheHo¡
::
Ev’tID
 
id
)

138 #ifdeà
SSLAB__DEBUG


139 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

142 
	gid
) {

143 
	gAµliÿtiÚCacheHo¡
::
CHECKING_EVENT
:

144  
ev’tNames
().
checkšgEv’t
;

145 
	gAµliÿtiÚCacheHo¡
::
ERROR_EVENT
:

146  
ev’tNames
().
”rÜEv’t
;

147 
	gAµliÿtiÚCacheHo¡
::
NOUPDATE_EVENT
:

148  
ev’tNames
().
noupd©eEv’t
;

149 
	gAµliÿtiÚCacheHo¡
::
DOWNLOADING_EVENT
:

150  
ev’tNames
().
dowÆßdšgEv’t
;

151 
	gAµliÿtiÚCacheHo¡
::
PROGRESS_EVENT
:

152  
ev’tNames
().
´og»ssEv’t
;

153 
	gAµliÿtiÚCacheHo¡
::
UPDATEREADY_EVENT
:

154  
ev’tNames
().
upd©”—dyEv’t
;

155 
	gAµliÿtiÚCacheHo¡
::
CACHED_EVENT
:

156  
ev’tNames
().
ÿchedEv’t
;

157 
	gAµliÿtiÚCacheHo¡
::
OBSOLETE_EVENT
:

158  
ev’tNames
().
obsŞ‘eEv’t
;

160 
ASSERT_NOT_REACHED
();

161  
ev’tNames
().
	g”rÜEv’t
;

164 
Ev’tT¬g‘D©a
* 
	gDOMAµliÿtiÚCache
::
ev’tT¬g‘D©a
()

166 #ifdeà
SSLAB__DEBUG


167 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

170  &
	gm_ev’tT¬g‘D©a
;

173 
Ev’tT¬g‘D©a
* 
	gDOMAµliÿtiÚCache
::
’su»Ev’tT¬g‘D©a
()

175 #ifdeà
SSLAB__DEBUG


176 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

179  &
	gm_ev’tT¬g‘D©a
;

	@appcache/DOMApplicationCache.h

26 #iâdeà
DOMAµliÿtiÚCache_h


27 
	#DOMAµliÿtiÚCache_h


	)

29 #ià
ENABLE
(
OFFLINE_WEB_APPLICATIONS
)

31 
	~"AµliÿtiÚCacheHo¡.h
"

32 
	~"AtomicSŒšgHash.h
"

33 
	~"Ev’tLi¡’”.h
"

34 
	~"Ev’tNames.h
"

35 
	~"Ev’tT¬g‘.h
"

36 
	~<wtf/HashM­.h
>

37 
	~<wtf/PassRefPŒ.h
>

38 
	~<wtf/RefCouÁed.h
>

39 
	~<wtf/VeùÜ.h
>

41 
Çme¥aû
 
	gWebCÜe
 {

43 
şass
 
	gAtomicSŒšgIm¶
;

44 
şass
 
	gF¿me
;

45 
şass
 
	gKURL
;

46 
şass
 
	gSŒšg
;

48 
şass
 
	gDOMAµliÿtiÚCache
 : 
public
 
RefCouÁed
<
DOMAµliÿtiÚCache
>,…ubliø
	gEv’tT¬g‘
 {

49 
	gpublic
:

50 
PassRefPŒ
<
DOMAµliÿtiÚCache
> 
ü—‹
(
F¿me
* 
äame
è{  
adİtRef
(
Ãw
 DOMApplicationCache(frame)); }

51 ~
DOMAµliÿtiÚCache
(è{ 
ASSERT
(!
m_äame
); }

53 
discÚÃùF¿me
();

55 
¡©us
() const;

56 
upd©e
(
Exû±iÚCode
&);

57 
sw­Cache
(
Exû±iÚCode
&);

61 
usšg
 
	gRefCouÁed
<
	gDOMAµliÿtiÚCache
>::
»f
;

62 
usšg
 
	gRefCouÁed
<
	gDOMAµliÿtiÚCache
>::
d”ef
;

66 
DEFINE_ATTRIBUTE_EVENT_LISTENER
(
checkšg
);

67 
DEFINE_ATTRIBUTE_EVENT_LISTENER
(
”rÜ
);

68 
DEFINE_ATTRIBUTE_EVENT_LISTENER
(
noupd©e
);

69 
DEFINE_ATTRIBUTE_EVENT_LISTENER
(
dowÆßdšg
);

70 
DEFINE_ATTRIBUTE_EVENT_LISTENER
(
´og»ss
);

71 
DEFINE_ATTRIBUTE_EVENT_LISTENER
(
upd©”—dy
);

72 
DEFINE_ATTRIBUTE_EVENT_LISTENER
(
ÿched
);

73 
DEFINE_ATTRIBUTE_EVENT_LISTENER
(
obsŞ‘e
);

75 
vœtu®
 
SütExecutiÚCÚ‹xt
* 
sütExecutiÚCÚ‹xt
() const;

76 
DOMAµliÿtiÚCache
* 
toDOMAµliÿtiÚCache
(è{  
	gthis
; }

78 cÚ¡ 
	gAtomicSŒšg
& 
toEv’tTy³
(
AµliÿtiÚCacheHo¡
::
Ev’tID
 
id
);

80 
	g´iv©e
:

81 
DOMAµliÿtiÚCache
(
F¿me
*);

83 
vœtu®
 
»fEv’tT¬g‘
(è{ 
»f
(); }

84 
vœtu®
 
d”efEv’tT¬g‘
(è{ 
d”ef
(); }

85 
vœtu®
 
Ev’tT¬g‘D©a
* 
ev’tT¬g‘D©a
();

86 
vœtu®
 
Ev’tT¬g‘D©a
* 
’su»Ev’tT¬g‘D©a
();

88 
AµliÿtiÚCacheHo¡
* 
­¶iÿtiÚCacheHo¡
() const;

90 
F¿me
* 
	gm_äame
;

91 
Ev’tT¬g‘D©a
 
	gm_ev’tT¬g‘D©a
;

	@appcache/ManifestParser.cpp

2 #ifdeà
SSLAB__DEBUG


3 #iâdeà
SSLAB__QDATETIME


4 
	#SSLAB__QDATETIME


	)

5 
	~<QD©eTime
>

9 #ifdeà
SSLAB__DEBUG


10 #iâdeà
SSLAB__QTHREAD


11 
	#SSLAB__QTHREAD


	)

12 
	~<QTh»ad
>

40 
	~"cÚfig.h
"

41 
	~"Mªiã¡P¬£r.h
"

43 #ià
ENABLE
(
OFFLINE_WEB_APPLICATIONS
)

45 
	~"Ch¬aù”Names.h
"

46 
	~"KURL.h
"

47 
	~"TextResourûDecod”.h
"

49 
usšg
 
Çme¥aû
 
	g¡d
;

51 
Çme¥aû
 
	gWebCÜe
 {

53 
	eMode
 { 
	gEx¶ic™
, 
	gF®lback
, 
	gOÆšeWh™–i¡
, 
	gUnknown
 };

55 
boŞ
 
·r£Mªiã¡
(cÚ¡ 
KURL
& 
mªiã¡URL
, cÚ¡ * 
d©a
, 
Ëngth
, 
Mªiã¡
& 
mªiã¡
)

57 #ifdeà
SSLAB__DEBUG


58 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

61 
ASSERT
(
mªiã¡
.
ex¶ic™URLs
.
isEm±y
());

62 
ASSERT
(
mªiã¡
.
ÚlšeWh™–i¡edURLs
.
isEm±y
());

63 
ASSERT
(
mªiã¡
.
çÎbackURLs
.
isEm±y
());

64 
	gmªiã¡
.
	g®lowAÎN‘wÜkReque¡s
 = 
çl£
;

66 
Mode
 
	gmode
 = 
Ex¶ic™
;

68 
	gRefPŒ
<
	gTextResourûDecod”
> 
	gdecod”
 = 
TextResourûDecod”
::
ü—‹
("text/cache-manifest", "UTF-8");

69 
SŒšg
 
	gs
 = 
decod”
->
decode
(
d©a
, 
Ëngth
);

70 
	gs
 +ğ
decod”
->
æush
();

75 ià(!
	gs
.
¡¬tsW™h
("CACHE MANIFEST"))

76  
	gçl£
;

78 cÚ¡ 
UCh¬
* 
	g’d
 = 
s
.
ch¬aù”s
(è+ s.
Ëngth
();

79 cÚ¡ 
UCh¬
* 
	gp
 = 
s
.
ch¬aù”s
() + 14;

81 ià(
	gp
 < 
	g’d
 && *°!ğ' ' && *
p
 != '\t' && *p != '\n' && *p != '\r')

82  
çl£
;

85 
	gp
 < 
	g’d
 && *°!ğ'\r' && *
p
 != '\n')

86 
p
++;

90 
	gp
 < 
	g’d
 && (*°=ğ'\n' || *
p
 == '\r' || *p == ' ' || *p == '\t'))

91 
p
++;

93 ià(
	gp
 =ğ
’d
)

96 cÚ¡ 
UCh¬
* 
	glšeS¹
 = 
p
;

99 
	gp
 < 
	g’d
 && *°!ğ'\r' && *
p
 != '\n')

100 
p
++;

103 ià(*
	glšeS¹
 == '#')

107 cÚ¡ 
UCh¬
* 
	gtmp
 = 
p
 - 1;

108 
	gtmp
 > 
	glšeS¹
 && (*tm°=ğ' ' || *
tmp
 == '\t'))

109 
tmp
--;

111 
SŒšg
 
lše
(
lšeS¹
, 
tmp
 -†ineStart + 1);

113 ià(
	glše
 == "CACHE:")

114 
mode
 = 
Ex¶ic™
;

115 ià(
	glše
 == "FALLBACK:")

116 
mode
 = 
F®lback
;

117 ià(
	glše
 == "NETWORK:")

118 
mode
 = 
OÆšeWh™–i¡
;

119 ià(
	glše
.
’dsW™h
(":"))

120 
	gmode
 = 
Unknown
;

121 ià(
	gmode
 =ğ
Unknown
)

123 ià(
	gmode
 =ğ
Ex¶ic™
 || 
mode
 =ğ
OÆšeWh™–i¡
) {

124 cÚ¡ 
UCh¬
* 
p
 = 
lše
.
ch¬aù”s
();

125 cÚ¡ 
UCh¬
* 
	glšeEnd
 = 
p
 + 
lše
.
Ëngth
();

128 
	gp
 < 
	glšeEnd
 && *°!ğ'\t' && *
p
 != ' ')

129 
p
++;

131 ià(
	gmode
 =ğ
OÆšeWh™–i¡
 && 
p
 - 
lše
.
ch¬aù”s
() == 1 && *line.characters() == '*') {

133 
mªiã¡
.
®lowAÎN‘wÜkReque¡s
 = 
Œue
;

137 
KURL
 
u¾
(
mªiã¡URL
, 
SŒšg
(
lše
.
ch¬aù”s
(), 
p
 -†ine.characters()));

139 ià(!
	gu¾
.
isV®id
())

142 ià(
	gu¾
.
hasF¿gm’tId’tif›r
())

143 
	gu¾
.
»moveF¿gm’tId’tif›r
();

145 ià(!
equ®IgnÜšgCa£
(
u¾
.
´ÙocŞ
(), 
mªiã¡URL
.protocol()))

148 ià(
	gmode
 =ğ
Ex¶ic™
)

149 
mªiã¡
.
ex¶ic™URLs
.
add
(
u¾
.
¡ršg
());

151 
	gmªiã¡
.
	gÚlšeWh™–i¡edURLs
.
­³nd
(
u¾
);

153 } ià(
	gmode
 =ğ
F®lback
) {

154 cÚ¡ 
UCh¬
* 
p
 = 
lše
.
ch¬aù”s
();

155 cÚ¡ 
UCh¬
* 
	glšeEnd
 = 
p
 + 
lše
.
Ëngth
();

158 
	gp
 < 
	glšeEnd
 && *°!ğ'\t' && *
p
 != ' ')

159 
p
++;

161 ià(
	gp
 =ğ
lšeEnd
) {

166 
KURL
 
Çme¥aûURL
(
mªiã¡URL
, 
SŒšg
(
lše
.
ch¬aù”s
(), 
p
 -†ine.characters()));

167 ià(!
	gÇme¥aûURL
.
isV®id
())

169 ià(
	gÇme¥aûURL
.
hasF¿gm’tId’tif›r
())

170 
	gÇme¥aûURL
.
»moveF¿gm’tId’tif›r
();

172 ià(!
´ÙocŞHo¡AndPÜtA»Equ®
(
mªiã¡URL
, 
Çme¥aûURL
))

176 
	gp
 < 
	glšeEnd
 && (*°=ğ'\t' || *
p
 == ' '))

177 
p
++;

180 cÚ¡ 
UCh¬
* 
	gçÎbackS¹
 = 
p
;

181 
	gp
 < 
	glšeEnd
 && *°!ğ'\t' && *
p
 != ' ')

182 
p
++;

184 
KURL
 
çÎbackURL
(
mªiã¡URL
, 
SŒšg
(
çÎbackS¹
, 
p
 - fallbackStart));

185 ià(!
	gçÎbackURL
.
isV®id
())

187 ià(
	gçÎbackURL
.
hasF¿gm’tId’tif›r
())

188 
	gçÎbackURL
.
»moveF¿gm’tId’tif›r
();

190 ià(!
´ÙocŞHo¡AndPÜtA»Equ®
(
mªiã¡URL
, 
çÎbackURL
))

193 
	gmªiã¡
.
	gçÎbackURLs
.
­³nd
(
make_·œ
(
Çme¥aûURL
, 
çÎbackURL
));

195 
ASSERT_NOT_REACHED
();

198  
	gŒue
;

	@appcache/ManifestParser.h

26 #iâdeà
Mªiã¡P¬£r_h


27 
	#Mªiã¡P¬£r_h


	)

29 #ià
ENABLE
(
OFFLINE_WEB_APPLICATIONS
)

31 
	~"AµliÿtiÚCache.h
"

33 
Çme¥aû
 
	gWebCÜe
 {

35 
şass
 
	gKURL
;

37 
	sMªiã¡
 {

38 
	gVeùÜ
<
	gKURL
> 
	gÚlšeWh™–i¡edURLs
;

39 
	gHashS‘
<
	gSŒšg
> 
	gex¶ic™URLs
;

40 
F®lbackURLVeùÜ
 
	gçÎbackURLs
;

41 
boŞ
 
	g®lowAÎN‘wÜkReque¡s
;

44 
boŞ
 
·r£Mªiã¡
(cÚ¡ 
KURL
& 
mªiã¡URL
, cÚ¡ * 
d©a
, 
Ëngth
, 
Mªiã¡
&);

	@archive/Archive.h

29 #iâdeà
Archive_h


30 
	#Archive_h


	)

32 
	~"ArchiveResourû.h
"

34 
	~<wtf/PassRefPŒ.h
>

35 
	~<wtf/RefCouÁed.h
>

36 
	~<wtf/RefPŒ.h
>

37 
	~<wtf/VeùÜ.h
>

39 
Çme¥aû
 
	gWebCÜe
 {

41 
şass
 
	gArchive
 : 
public
 
RefCouÁed
<
Archive
> {

42 
public
:

43 
ArchiveResourû
* 
mašResourû
(è{  
m_mašResourû
.
g‘
(); }

44 cÚ¡ 
	gVeùÜ
<
	gRefPŒ
<
	gArchiveResourû
> >& 
sub»sourûs
(ècÚ¡ {  
	gm_sub»sourûs
; }

45 cÚ¡ 
	gVeùÜ
<
	gRefPŒ
<
	gArchive
> >& 
subäameArchives
(ècÚ¡ {  
	gm_subäameArchives
; }

47 
	g´Ùeùed
:

50 
£tMašResourû
(
PassRefPŒ
<
ArchiveResourû
> 
mašResourû
è{ 
m_mašResourû
 = mainResource; }

51 
addSub»sourû
(
PassRefPŒ
<
ArchiveResourû
> 
subResourû
è{ 
	gm_sub»sourûs
.
­³nd
(subResource); }

52 
addSubäameArchive
(
PassRefPŒ
<
Archive
> 
subäameArchive
è{ 
	gm_subäameArchives
.
­³nd
(subframeArchive); }

54 
	g´iv©e
:

55 
RefPŒ
<
ArchiveResourû
> 
m_mašResourû
;

56 
	gVeùÜ
<
	gRefPŒ
<
	gArchiveResourû
> > 
	gm_sub»sourûs
;

57 
	gVeùÜ
<
	gRefPŒ
<
	gArchive
> > 
	gm_subäameArchives
;

	@archive/ArchiveFactory.cpp

2 #ifdeà
SSLAB__DEBUG


3 #iâdeà
SSLAB__QDATETIME


4 
	#SSLAB__QDATETIME


	)

5 
	~<QD©eTime
>

9 #ifdeà
SSLAB__DEBUG


10 #iâdeà
SSLAB__QTHREAD


11 
	#SSLAB__QTHREAD


	)

12 
	~<QTh»ad
>

43 
	~"cÚfig.h
"

44 
	~"ArchiveFaùÜy.h
"

46 
	~"MIMETy³Regi¡ry.h
"

47 
	~"PÏtfÜmSŒšg.h
"

49 #ià
PLATFORM
(
CF
è&& !PLATFORM(
QT
)

50 
	~"LegacyWebArchive.h
"

53 
	~<wtf/HashM­.h
>

54 
	~<wtf/HashS‘.h
>

55 
	~<wtf/StdLibExŒas.h
>

57 
Çme¥aû
 
	gWebCÜe
 {

59 
	gPassRefPŒ
<
	tArchive
> 
	tRawD©aC»©iÚFunùiÚ
(
	tSh¬edBufãr
*);

60 
	gHashM­
<
	tSŒšg
, 
	tRawD©aC»©iÚFunùiÚ
*, 
	tCa£FŞdšgHash
> 
	tArchiveMIMETy³sM­
;

64 
	g‹m¶©e
 <
ty³Çme
 
	gArchiveCÏss
> 
	gPassRefPŒ
<
	gArchive
> 
¬chiveFaùÜyC»©e
(
Sh¬edBufãr
* 
bufãr
)

66 #ifdeà
SSLAB__DEBUG


67 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

70  
	gArchiveCÏss
::
ü—‹
(
bufãr
);

73 
	gArchiveMIMETy³sM­
& 
¬chiveMIMETy³s
()

75 #ifdeà
SSLAB__DEBUG


76 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

79 
DEFINE_STATIC_LOCAL
(
ArchiveMIMETy³sM­
, 
mimeTy³s
, ());

80 
boŞ
 
	gš™Ÿlized
 = 
çl£
;

82 ià(
	gš™Ÿlized
)

83  
	gmimeTy³s
;

85 #ià
PLATFORM
(
CF
è&& !PLATFORM(
QT
)

86 
	gmimeTy³s
.
£t
("­¶iÿtiÚ/x-web¬chive", 
¬chiveFaùÜyC»©e
<
LegacyWebArchive
>);

89 
	gš™Ÿlized
 = 
Œue
;

90  
	gmimeTy³s
;

93 
boŞ
 
	gArchiveFaùÜy
::
isArchiveMimeTy³
(cÚ¡ 
SŒšg
& 
mimeTy³
)

95 #ifdeà
SSLAB__DEBUG


96 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

99  
¬chiveMIMETy³s
().
cÚšs
(
mimeTy³
);

102 
	gPassRefPŒ
<
	gArchive
> 
	gArchiveFaùÜy
::
ü—‹
(
Sh¬edBufãr
* 
d©a
, cÚ¡ 
SŒšg
& 
mimeTy³
)

104 #ifdeà
SSLAB__DEBUG


105 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

108 
RawD©aC»©iÚFunùiÚ
* 
	gfunùiÚ
 = 
¬chiveMIMETy³s
().
g‘
(
mimeTy³
);

109  
	gfunùiÚ
 ? 
funùiÚ
(
d©a
) : 0;

112 
	gArchiveFaùÜy
::
»gi¡”KnownArchiveMIMETy³s
()

114 #ifdeà
SSLAB__DEBUG


115 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

118 
	gHashS‘
<
	gSŒšg
>& 
	gmimeTy³s
 = 
MIMETy³Regi¡ry
::
g‘SuµÜ‹dNÚImageMIMETy³s
();

119 
	gArchiveMIMETy³sM­
::
™”©Ü
 
i
 = 
¬chiveMIMETy³s
().
begš
();

120 
	gArchiveMIMETy³sM­
::
™”©Ü
 
’d
 = 
¬chiveMIMETy³s
().end();

122 ; 
	gi
 !ğ
’d
; ++i)

123 
	gmimeTy³s
.
add
(
i
->
fœ¡
);

	@archive/ArchiveFactory.h

29 #iâdeà
ArchiveFaùÜy_h


30 
	#ArchiveFaùÜy_h


	)

32 
	~"Archive.h
"

34 
	~<wtf/PassRefPŒ.h
>

36 
Çme¥aû
 
	gWebCÜe
 {

38 
şass
 
	gSh¬edBufãr
;

39 
şass
 
	gSŒšg
;

41 şas 
	cArchiveFaùÜy
 {

42 
	gpublic
:

43 
boŞ
 
isArchiveMimeTy³
(cÚ¡ 
SŒšg
&);

44 
	gPassRefPŒ
<
	gArchive
> 
ü—‹
(
Sh¬edBufãr
* 
d©a
, cÚ¡ 
SŒšg
& 
mimeTy³
);

45 
»gi¡”KnownArchiveMIMETy³s
();

	@archive/ArchiveResource.cpp

2 #ifdeà
SSLAB__DEBUG


3 #iâdeà
SSLAB__QDATETIME


4 
	#SSLAB__QDATETIME


	)

5 
	~<QD©eTime
>

9 #ifdeà
SSLAB__DEBUG


10 #iâdeà
SSLAB__QTHREAD


11 
	#SSLAB__QTHREAD


	)

12 
	~<QTh»ad
>

43 
	~"cÚfig.h
"

44 
	~"ArchiveResourû.h
"

46 
	~"Sh¬edBufãr.h
"

48 
Çme¥aû
 
	gWebCÜe
 {

50 
	gPassRefPŒ
<
	gArchiveResourû
> ArchiveResourû::
ü—‹
(
PassRefPŒ
<
Sh¬edBufãr
> 
d©a
, cÚ¡ 
KURL
& 
u¾
, cÚ¡ 
ResourûRe¥Ú£
& 
»¥Ú£
)

52 #ifdeà
SSLAB__DEBUG


53 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

56  
	gd©a
 ? 
adİtRef
(
Ãw
 
ArchiveResourû
(
d©a
, 
u¾
, 
»¥Ú£
)) : 0;

59 
	gPassRefPŒ
<
	gArchiveResourû
> ArchiveResourû::
ü—‹
(
PassRefPŒ
<
Sh¬edBufãr
> 
d©a
, cÚ¡ 
KURL
& 
u¾
, cÚ¡ 
SŒšg
& 
mimeTy³
, cÚ¡ SŒšg& 
‹xtEncodšg
, cÚ¡ SŒšg& 
äameName
)

61 #ifdeà
SSLAB__DEBUG


62 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

65  
	gd©a
 ? 
adİtRef
(
Ãw
 
ArchiveResourû
(
d©a
, 
u¾
, 
mimeTy³
, 
‹xtEncodšg
, 
äameName
)) : 0;

68 
	gPassRefPŒ
<
	gArchiveResourû
> ArchiveResourû::
ü—‹
(
PassRefPŒ
<
Sh¬edBufãr
> 
d©a
, cÚ¡ 
KURL
& 
u¾
, cÚ¡ 
SŒšg
& 
mimeTy³
, cÚ¡ SŒšg& 
‹xtEncodšg
, cÚ¡ SŒšg& 
äameName
, cÚ¡ 
ResourûRe¥Ú£
& 
»sourûRe¥Ú£
)

70 #ifdeà
SSLAB__DEBUG


71 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

74  
	gd©a
 ? 
adİtRef
(
Ãw
 
ArchiveResourû
(
d©a
, 
u¾
, 
mimeTy³
, 
‹xtEncodšg
, 
äameName
, 
»sourûRe¥Ú£
)) : 0;

77 
	gArchiveResourû
::
ArchiveResourû
(
PassRefPŒ
<
Sh¬edBufãr
> 
d©a
, cÚ¡ 
KURL
& 
u¾
, cÚ¡ 
ResourûRe¥Ú£
& 
»¥Ú£
)

78 : 
Sub¡™u‹Resourû
(
u¾
, 
»¥Ú£
, 
d©a
)

79 , 
m_mimeTy³
(
»¥Ú£
.
mimeTy³
())

80 , 
m_‹xtEncodšg
(
»¥Ú£
.
‹xtEncodšgName
())

81 , 
m_shouldIgnÜeWh’UÇrchivšg
(
çl£
)

83 #ifdeà
SSLAB__DEBUG


84 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

89 
	gArchiveResourû
::
ArchiveResourû
(
PassRefPŒ
<
Sh¬edBufãr
> 
d©a
, cÚ¡ 
KURL
& 
u¾
, cÚ¡ 
SŒšg
& 
mimeTy³
, cÚ¡ SŒšg& 
‹xtEncodšg
, cÚ¡ SŒšg& 
äameName
)

90 : 
Sub¡™u‹Resourû
(
u¾
, 
ResourûRe¥Ú£
(u¾, 
mimeTy³
, 
d©a
 ? d©a->
size
(è: 0, 
‹xtEncodšg
, 
SŒšg
()), data)

91 , 
m_mimeTy³
(
mimeTy³
)

92 , 
m_‹xtEncodšg
(
‹xtEncodšg
)

93 , 
m_äameName
(
äameName
)

94 , 
m_shouldIgnÜeWh’UÇrchivšg
(
çl£
)

98 
	gArchiveResourû
::
ArchiveResourû
(
PassRefPŒ
<
Sh¬edBufãr
> 
d©a
, cÚ¡ 
KURL
& 
u¾
, cÚ¡ 
SŒšg
& 
mimeTy³
, cÚ¡ SŒšg& 
‹xtEncodšg
, cÚ¡ SŒšg& 
äameName
, cÚ¡ 
ResourûRe¥Ú£
& 
»¥Ú£
)

99 : 
Sub¡™u‹Resourû
(
u¾
, 
»¥Ú£
.
isNuÎ
(è? 
ResourûRe¥Ú£
(u¾, 
mimeTy³
, 
d©a
 ? d©a->
size
(è: 0, 
‹xtEncodšg
, 
SŒšg
()) :„esponse, data)

100 , 
m_mimeTy³
(
mimeTy³
)

101 , 
m_‹xtEncodšg
(
‹xtEncodšg
)

102 , 
m_äameName
(
äameName
)

103 , 
m_shouldIgnÜeWh’UÇrchivšg
(
çl£
)

	@archive/ArchiveResource.h

29 #iâdeà
ArchiveResourû_h


30 
	#ArchiveResourû_h


	)

32 
	~"Sub¡™u‹Resourû.h
"

34 
	~"PÏtfÜmSŒšg.h
"

36 
Çme¥aû
 
	gWebCÜe
 {

38 şas 
	cArchiveResourû
 : 
public
 
Sub¡™u‹Resourû
 {

39 
public
:

40 
PassRefPŒ
<
ArchiveResourû
> 
ü—‹
(PassRefPŒ<
Sh¬edBufãr
>, cÚ¡ 
KURL
&, cÚ¡ 
ResourûRe¥Ú£
&);

41 
	gPassRefPŒ
<
	gArchiveResourû
> 
ü—‹
(
PassRefPŒ
<
Sh¬edBufãr
>, cÚ¡ 
KURL
&, cÚ¡ 
SŒšg
& 
mimeTy³
, cÚ¡ SŒšg& 
‹xtEncodšg
, cÚ¡ SŒšg& 
äameName
);

42 
	gPassRefPŒ
<
	gArchiveResourû
> 
ü—‹
(
PassRefPŒ
<
Sh¬edBufãr
>, cÚ¡ 
KURL
&, cÚ¡ 
SŒšg
& 
mimeTy³
, cÚ¡ SŒšg& 
‹xtEncodšg
, cÚ¡ SŒšg& 
äameName
, cÚ¡ 
ResourûRe¥Ú£
&);

44 cÚ¡ 
	gSŒšg
& 
mimeTy³
(ècÚ¡ {  
	gm_mimeTy³
; }

45 cÚ¡ 
	gSŒšg
& 
‹xtEncodšg
(ècÚ¡ {  
	gm_‹xtEncodšg
; }

46 cÚ¡ 
	gSŒšg
& 
äameName
(ècÚ¡ {  
	gm_äameName
; }

48 
ignÜeWh’UÇrchivšg
(è{ 
	gm_shouldIgnÜeWh’UÇrchivšg
 = 
Œue
; }

49 
boŞ
 
shouldIgnÜeWh’UÇrchivšg
(ècÚ¡ {  
	gm_shouldIgnÜeWh’UÇrchivšg
; }

51 
	g´iv©e
:

52 
ArchiveResourû
(
PassRefPŒ
<
Sh¬edBufãr
>, cÚ¡ 
KURL
&, cÚ¡ 
ResourûRe¥Ú£
&);

53 
ArchiveResourû
(
PassRefPŒ
<
Sh¬edBufãr
>, cÚ¡ 
KURL
&, cÚ¡ 
SŒšg
& 
mimeTy³
, cÚ¡ SŒšg& 
‹xtEncodšg
, cÚ¡ SŒšg& 
äameName
);

54 
ArchiveResourû
(
PassRefPŒ
<
Sh¬edBufãr
>, cÚ¡ 
KURL
&, cÚ¡ 
SŒšg
& 
mimeTy³
, cÚ¡ SŒšg& 
‹xtEncodšg
, cÚ¡ SŒšg& 
äameName
, cÚ¡ 
ResourûRe¥Ú£
&);

56 
SŒšg
 
	gm_mimeTy³
;

57 
SŒšg
 
	gm_‹xtEncodšg
;

58 
SŒšg
 
	gm_äameName
;

60 
boŞ
 
	gm_shouldIgnÜeWh’UÇrchivšg
;

	@archive/ArchiveResourceCollection.cpp

2 #ifdeà
SSLAB__DEBUG


3 #iâdeà
SSLAB__QDATETIME


4 
	#SSLAB__QDATETIME


	)

5 
	~<QD©eTime
>

9 #ifdeà
SSLAB__DEBUG


10 #iâdeà
SSLAB__QTHREAD


11 
	#SSLAB__QTHREAD


	)

12 
	~<QTh»ad
>

43 
	~"cÚfig.h
"

44 
	~"ArchiveResourûCŞËùiÚ.h
"

46 
Çme¥aû
 
	gWebCÜe
 {

48 
	gArchiveResourûCŞËùiÚ
::
ArchiveResourûCŞËùiÚ
()

50 #ifdeà
SSLAB__DEBUG


51 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

56 
	gArchiveResourûCŞËùiÚ
::
addAÎResourûs
(
Archive
* 
¬chive
)

58 #ifdeà
SSLAB__DEBUG


59 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

62 
ASSERT
(
¬chive
);

63 ià(!
	g¬chive
)

66 cÚ¡ 
	gVeùÜ
<
	gRefPŒ
<
	gArchiveResourû
> >& 
	gsub»sourûs
 = 
¬chive
->
sub»sourûs
();

67 
	gVeùÜ
<
	gRefPŒ
<
	gArchiveResourû
> >::
cÚ¡_™”©Ü
 
iRes
 = 
sub»sourûs
.
begš
();

68 
	gVeùÜ
<
	gRefPŒ
<
	gArchiveResourû
> >::
cÚ¡_™”©Ü
 
’dRes
 = 
sub»sourûs
.
’d
();

70 ; 
	giRes
 !ğ
’dRes
; ++iRes)

71 
	gm_sub»sourûs
.
£t
((*
iRes
)->
u¾
(), iRes->
g‘
());

73 cÚ¡ 
	gVeùÜ
<
	gRefPŒ
<
	gArchive
> >& 
	gsubäames
 = 
¬chive
->
subäameArchives
();

74 
	gVeùÜ
<
	gRefPŒ
<
	gArchive
> >::
cÚ¡_™”©Ü
 
iF¿me
 = 
subäames
.
begš
();

75 
	gVeùÜ
<
	gRefPŒ
<
	gArchive
> >::
cÚ¡_™”©Ü
 
’dF¿me
 = 
subäames
.
’d
();

77 ; 
	giF¿me
 !ğ
’dF¿me
; ++iFrame) {

78 
ASSERT
((*
iF¿me
)->
mašResourû
());

79 cÚ¡ 
	gSŒšg
& 
	gäameName
 = (*
iF¿me
)->
mašResourû
()->
äameName
();

80 ià(!
	gäameName
.
isNuÎ
())

81 
	gm_subäames
.
£t
(
äameName
, 
iF¿me
->
g‘
());

87 
	gArchiveResourûCŞËùiÚ
::
addResourû
(
PassRefPŒ
<
ArchiveResourû
> 
»sourû
)

89 #ifdeà
SSLAB__DEBUG


90 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

93 
ASSERT
(
»sourû
);

94 ià(!
	g»sourû
)

97 cÚ¡ 
	gKURL
& 
	gu¾
 = 
»sourû
->
u¾
();

98 
	gm_sub»sourûs
.
£t
(
u¾
, 
»sourû
);

101 
ArchiveResourû
* 
	gArchiveResourûCŞËùiÚ
::
¬chiveResourûFÜURL
(cÚ¡ 
KURL
& 
u¾
)

103 #ifdeà
SSLAB__DEBUG


104 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

107 
ArchiveResourû
* 
	g»sourû
 = 
m_sub»sourûs
.
g‘
(
u¾
).get();

108 ià(!
	g»sourû
)

111  
	g»sourû
;

114 
	gPassRefPŒ
<
	gArchive
> 
	gArchiveResourûCŞËùiÚ
::
pİSubäameArchive
(cÚ¡ 
SŒšg
& 
äameName
)

116 #ifdeà
SSLAB__DEBUG


117 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

120  
	gm_subäames
.
ke
(
äameName
);

	@archive/ArchiveResourceCollection.h

29 #iâdeà
ArchiveResourûCŞËùiÚ_h


30 
	#ArchiveResourûCŞËùiÚ_h


	)

32 
	~"Archive.h
"

33 
	~"ArchiveResourû.h
"

34 
	~"KURL.h
"

35 
	~"PÏtfÜmSŒšg.h
"

37 
	~<wtf/HashM­.h
>

38 
	~<wtf/RefCouÁed.h
>

40 
Çme¥aû
 
	gWebCÜe
 {

42 şas 
	cArchiveResourûCŞËùiÚ
 : 
public
 
NÚcİyabË
 {

43 
public
:

44 
ArchiveResourûCŞËùiÚ
();

46 
addResourû
(
PassRefPŒ
<
ArchiveResourû
>);

47 
addAÎResourûs
(
Archive
*);

49 
ArchiveResourû
* 
¬chiveResourûFÜURL
(cÚ¡ 
KURL
&);

50 
	gPassRefPŒ
<
	gArchive
> 
pİSubäameArchive
(cÚ¡ 
SŒšg
& 
äameName
);

52 
	g´iv©e
:

53 
HashM­
<
SŒšg
, 
	gRefPŒ
<
	gArchiveResourû
> > 
	gm_sub»sourûs
;

54 
	gHashM­
<
	gSŒšg
, 
	gRefPŒ
<
	gArchive
> > 
	gm_subäames
;

	@icon/IconDatabase.cpp

2 #ifdeà
SSLAB__DEBUG


3 #iâdeà
SSLAB__QDATETIME


4 
	#SSLAB__QDATETIME


	)

5 
	~<QD©eTime
>

9 #ifdeà
SSLAB__DEBUG


10 #iâdeà
SSLAB__QTHREAD


11 
	#SSLAB__QTHREAD


	)

12 
	~<QTh»ad
>

41 
	~"cÚfig.h
"

42 
	~"IcÚD©aba£.h
"

44 #ià
ENABLE
(
ICONDATABASE
)

46 
	~"Autod¿šedPoŞ.h
"

47 
	~"Docum’tLßd”.h
"

48 
	~"FeSy¡em.h
"

49 
	~"IcÚD©aba£Cl›Á.h
"

50 
	~"IcÚRecÜd.h
"

51 
	~"IÁSize.h
"

52 
	~"Loggšg.h
"

53 
	~"SütCÚŒŞËr.h
"

54 
	~"SQL™eS‹m’t.h
"

55 
	~"SQL™eT¿n§ùiÚ.h
"

56 
	~"Sudd’T”mš©iÚ.h
"

57 
	~<wtf/Cu¼’tTime.h
>

58 
	~<wtf/MašTh»ad.h
>

59 
	~<wtf/StdLibExŒas.h
>

62 
	#ASSERT_NOT_SYNC_THREAD
(è
	`ASSERT
(!
m_syncTh»adRuÂšg
 || !
	`IS_ICON_SYNC_THREAD
())

	)

65 
	#IS_ICON_SYNC_THREAD
(è(
m_syncTh»ad
 =ğ
	`cu¼’tTh»ad
())

	)

66 
	#ASSERT_ICON_SYNC_THREAD
(è
	`ASSERT
(
	`IS_ICON_SYNC_THREAD
())

	)

68 #ià
PLATFORM
(
QT
è|| PLATFORM(
GTK
)

69 
	#CAN_THEME_URL_ICON


	)

72 
Çme¥aû
 
	gWebCÜe
 {

74 
IcÚD©aba£
* 
	gsh¬edIcÚD©aba£
 = 0;

75 
	gd©aba£CËªupCouÁ”
 = 0;

81 cÚ¡ 
	gcu¼’tD©aba£V”siÚ
 = 6;

84 cÚ¡ 
	gicÚExpœ©iÚTime
 = 60*60*24*4;

86 cÚ¡ 
	gupd©eTim”D–ay
 = 5;

88 
boŞ
 
	gcheckIÁegr™yOnO³n
 = 
çl£
;

90 #iâdeà
NDEBUG


91 
SŒšg
 
u¾FÜLoggšg
(cÚ¡ SŒšg& 
u¾
)

93 #ifdeà
SSLAB__DEBUG


94 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

97 
	gu¾TrunÿtiÚL’gth
 = 120;

99 ià(
	gu¾
.
Ëngth
(è< 
	gu¾TrunÿtiÚL’gth
)

100  
	gu¾
;

101  
	gu¾
.
sub¡ršg
(0, 
u¾TrunÿtiÚL’gth
) + "...";

105 
IcÚD©aba£Cl›Á
* 
deçuÉCl›Á
()

107 #ifdeà
SSLAB__DEBUG


108 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

111 
IcÚD©aba£Cl›Á
* 
	gdeçuÉCl›Á
 = 
Ãw
 IconDatabaseClient();

112  
	gdeçuÉCl›Á
;

115 
IcÚD©aba£
* 
icÚD©aba£
()

117 #ifdeà
SSLAB__DEBUG


118 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

121 ià(!
	gsh¬edIcÚD©aba£
) {

122 
	gSütCÚŒŞËr
::
š™ŸlizeTh»adšg
();

123 
	gsh¬edIcÚD©aba£
 = 
Ãw
 
IcÚD©aba£
;

125  
	gsh¬edIcÚD©aba£
;

132 
	gIcÚD©aba£
::
£tCl›Á
(
IcÚD©aba£Cl›Á
* 
ş›Á
)

134 #ifdeà
SSLAB__DEBUG


135 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

141 
ASSERT
(
ş›Á
);

142 
ASSERT
(!
m_syncTh»adRuÂšg
);

143 ià(!
	gş›Á
 || 
	gm_syncTh»adRuÂšg
)

146 
	gm_ş›Á
 = 
ş›Á
;

149 
boŞ
 
	gIcÚD©aba£
::
İ’
(cÚ¡ 
SŒšg
& 
d©aba£P©h
)

151 #ifdeà
SSLAB__DEBUG


152 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

155 
ASSERT_NOT_SYNC_THREAD
();

157 ià(!
	gm_isEÇbËd
)

158  
	gçl£
;

160 ià(
isO³n
()) {

161 
LOG_ERROR
("Attempto„eopenhe IconDatabase which is‡lready open. Must close it first.");

162  
	gçl£
;

165 
	gm_d©aba£DœeùÜy
 = 
d©aba£P©h
.
üossTh»adSŒšg
();

168 
	gm_com¶‘eD©aba£P©h
 = 
·thByAµ’dšgCompÚ’t
(
m_d©aba£DœeùÜy
, 
deçuÉD©aba£F’ame
());

172 
	gm_syncLock
.
lock
();

173 
	gm_syncTh»ad
 = 
ü—‹Th»ad
(
IcÚD©aba£
::
icÚD©aba£SyncTh»adS¹
, 
this
, "WebCore: IconDatabase");

174 
	gm_syncTh»adRuÂšg
 = 
m_syncTh»ad
;

175 
	gm_syncLock
.
uÆock
();

176 ià(!
	gm_syncTh»ad
)

177  
	gçl£
;

178  
	gŒue
;

181 
	gIcÚD©aba£
::
şo£
()

183 #ifdeà
SSLAB__DEBUG


184 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

187 
ASSERT_NOT_SYNC_THREAD
();

189 ià(
	gm_syncTh»adRuÂšg
) {

191 
	gm_th»adT”mš©iÚReque¡ed
 = 
Œue
;

194 
wakeSyncTh»ad
();

197 
wa™FÜTh»adCom¶‘iÚ
(
m_syncTh»ad
, 0);

200 
	gm_syncTh»adRuÂšg
 = 
çl£
;

201 
	gm_th»adT”mš©iÚReque¡ed
 = 
çl£
;

202 
	gm_»moveIcÚsReque¡ed
 = 
çl£
;

204 
	gm_syncDB
.
şo£
();

205 
ASSERT
(!
isO³n
());

208 
	gIcÚD©aba£
::
»moveAÎIcÚs
()

210 #ifdeà
SSLAB__DEBUG


211 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

214 
ASSERT_NOT_SYNC_THREAD
();

216 ià(!
isO³n
())

219 
LOG
(
IcÚD©aba£
, "Requesting backgroundhreado„emove‡ll icons");

223 
Mu‹xLock”
 
lock”
(
m_u¾AndIcÚLock
);

227 
	gHashM­
<
	gSŒšg
, 
	gPageURLRecÜd
*>::
™”©Ü
 
™”
 = 
m_·geURLToRecÜdM­
.
begš
();

228 
	gHashM­
<
	gSŒšg
, 
	gPageURLRecÜd
*>::
™”©Ü
 
’d
 = 
m_·geURLToRecÜdM­
.end();

229 ; 
	g™”
 !ğ
’d
; ++iter)

230 (*
	g™”
).
	g£cÚd
->
£tIcÚRecÜd
(0);

233 
	gm_icÚURLToRecÜdM­
.
ş—r
();

237 
Mu‹xLock”
 
lock”
(
m_³ndšgSyncLock
);

238 
	gm_·geURLsP’dšgSync
.
ş—r
();

239 
	gm_icÚsP’dšgSync
.
ş—r
();

244 
Mu‹xLock”
 
lock”
(
m_³ndšgR—dšgLock
);

245 
	gm_·geURLsP’dšgImpÜt
.
ş—r
();

246 
	gm_·geURLsIÁ”e¡edInIcÚs
.
ş—r
();

247 
	gm_icÚsP’dšgR—dšg
.
ş—r
();

248 
	gm_lßd”sP’dšgDecisiÚ
.
ş—r
();

252 
	gm_»moveIcÚsReque¡ed
 = 
Œue
;

253 
wakeSyncTh»ad
();

256 
Image
* 
	gIcÚD©aba£
::
icÚFÜPageURL
(cÚ¡ 
SŒšg
& 
·geURLOrigš®
, cÚ¡ 
IÁSize
& 
size
)

258 #ifdeà
SSLAB__DEBUG


259 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

262 
ASSERT_NOT_SYNC_THREAD
();

267 ià(!
isO³n
(è|| 
	g·geURLOrigš®
.
isEm±y
())

268  
deçuÉIcÚ
(
size
);

270 
Mu‹xLock”
 
lock”
(
m_u¾AndIcÚLock
);

272 
SŒšg
 
	g·geURLCİy
;

274 
PageURLRecÜd
* 
	g·geRecÜd
 = 
m_·geURLToRecÜdM­
.
g‘
(
·geURLOrigš®
);

275 ià(!
	g·geRecÜd
) {

276 
	g·geURLCİy
 = 
·geURLOrigš®
.
üossTh»adSŒšg
();

277 
	g·geRecÜd
 = 
g‘OrC»©ePageURLRecÜd
(
·geURLCİy
);

283 ià(!
	g·geRecÜd
) {

284 
Mu‹xLock”
 
lock”
(
m_³ndšgR—dšgLock
);

288 ià(!
	gm_icÚURLImpÜtCom¶‘e
)

289 
	gm_·geURLsIÁ”e¡edInIcÚs
.
add
(
·geURLCİy
);

294 
IcÚRecÜd
* 
	gicÚRecÜd
 = 
·geRecÜd
->
icÚRecÜd
();

299 ià(!
	gm_icÚURLImpÜtCom¶‘e
 && !
	gicÚRecÜd
)

303 
ASSERT
(
icÚRecÜd
 || 
m_»šedPageURLs
.
cÚšs
(
·geURLOrigš®
));

305 ià(!
	gicÚRecÜd
)

310 ià(
	gicÚRecÜd
->
imageD©aStus
(è=ğ
ImageD©aStusUnknown
) {

311 ià(
·geURLCİy
.
isNuÎ
())

312 
·geURLCİy
 = 
·geURLOrigš®
.
üossTh»adSŒšg
();

314 
Mu‹xLock”
 
lock”
(
m_³ndšgR—dšgLock
);

315 
	gm_·geURLsIÁ”e¡edInIcÚs
.
add
(
·geURLCİy
);

316 
	gm_icÚsP’dšgR—dšg
.
add
(
icÚRecÜd
);

317 
wakeSyncTh»ad
();

323 ià(
	gsize
 =ğ
IÁSize
(0, 0))

336  
	gicÚRecÜd
->
image
(
size
);

339 
	gIcÚD©aba£
::
»adIcÚFÜPageURLFromDisk
(cÚ¡ 
SŒšg
& 
·geURL
)

341 #ifdeà
SSLAB__DEBUG


342 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

348 
icÚFÜPageURL
(
·geURL
, 
IÁSize
(0,0));

351 
SŒšg
 
	gIcÚD©aba£
::
icÚURLFÜPageURL
(cÚ¡ SŒšg& 
·geURLOrigš®
)

353 #ifdeà
SSLAB__DEBUG


354 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

357 
ASSERT_NOT_SYNC_THREAD
();

362 ià(!
isO³n
(è|| 
	g·geURLOrigš®
.
isEm±y
())

363  
SŒšg
();

365 
Mu‹xLock”
 
lock”
(
m_u¾AndIcÚLock
);

367 
PageURLRecÜd
* 
	g·geRecÜd
 = 
m_·geURLToRecÜdM­
.
g‘
(
·geURLOrigš®
);

368 ià(!
	g·geRecÜd
)

369 
	g·geRecÜd
 = 
g‘OrC»©ePageURLRecÜd
(
·geURLOrigš®
.
üossTh»adSŒšg
());

374 ià(!
	g·geRecÜd
)

375  
SŒšg
();

378  
	g·geRecÜd
->
icÚRecÜd
(è?…ageRecÜd->icÚRecÜd()->
icÚURL
().
th»ad§ãCİy
(è: 
SŒšg
();

381 #ifdeà
CAN_THEME_URL_ICON


382 
šlše
 
lßdDeçuÉIcÚRecÜd
(
IcÚRecÜd
* 
deçuÉIcÚRecÜd
)

384 #ifdeà
SSLAB__DEBUG


385 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

388 
	gdeçuÉIcÚRecÜd
->
lßdImageFromResourû
("urlIcon");

391 
šlše
 
lßdDeçuÉIcÚRecÜd
(
IcÚRecÜd
* 
deçuÉIcÚRecÜd
)

393 #ifdeà
SSLAB__DEBUG


394 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

397 cÚ¡ 
	gdeçuÉIcÚD©a
[] = { 0x4D, 0x4D, 0x00, 0x2A, 0x00, 0x00, 0x03, 0x32, 0x80, 0x00, 0x20, 0x50, 0x38, 0x24, 0x16, 0x0D, 0x07, 0x84, 0x42, 0x61, 0x50, 0xB8,

435 
DEFINE_STATIC_LOCAL
(
RefPŒ
<
Sh¬edBufãr
>, 
deçuÉIcÚBufãr
, (Sh¬edBufãr::
ü—‹
(
deçuÉIcÚD©a
, (defaultIconData))));

436 
	gdeçuÉIcÚRecÜd
->
£tImageD©a
(
deçuÉIcÚBufãr
);

440 
Image
* 
	gIcÚD©aba£
::
deçuÉIcÚ
(cÚ¡ 
IÁSize
& 
size
)

442 #ifdeà
SSLAB__DEBUG


443 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

446 
ASSERT_NOT_SYNC_THREAD
();

449 ià(!
	gm_deçuÉIcÚRecÜd
) {

450 
	gm_deçuÉIcÚRecÜd
 = 
IcÚRecÜd
::
ü—‹
("urlIcon");

451 
lßdDeçuÉIcÚRecÜd
(
m_deçuÉIcÚRecÜd
.
g‘
());

454  
	gm_deçuÉIcÚRecÜd
->
image
(
size
);

458 
	gIcÚD©aba£
::
»šIcÚFÜPageURL
(cÚ¡ 
SŒšg
& 
·geURLOrigš®
)

460 #ifdeà
SSLAB__DEBUG


461 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

464 
ASSERT_NOT_SYNC_THREAD
();

468 ià(!
isEÇbËd
(è|| 
	g·geURLOrigš®
.
isEm±y
())

471 
Mu‹xLock”
 
lock”
(
m_u¾AndIcÚLock
);

473 
PageURLRecÜd
* 
	g»cÜd
 = 
m_·geURLToRecÜdM­
.
g‘
(
·geURLOrigš®
);

475 
SŒšg
 
	g·geURL
;

477 ià(!
	g»cÜd
) {

478 
	g·geURL
 = 
·geURLOrigš®
.
üossTh»adSŒšg
();

480 
	g»cÜd
 = 
Ãw
 
PageURLRecÜd
(
·geURL
);

481 
	gm_·geURLToRecÜdM­
.
£t
(
·geURL
, 
»cÜd
);

484 ià(!
	g»cÜd
->
»š
()) {

485 ià(
	g·geURL
.
isNuÎ
())

486 
	g·geURL
 = 
·geURLOrigš®
.
üossTh»adSŒšg
();

489 
	gm_»šedPageURLs
.
add
(
·geURL
);

493 ià(!
	gm_icÚURLImpÜtCom¶‘e
)

496 
Mu‹xLock”
 
lock”
(
m_³ndšgSyncLock
);

499 ià(!
	gm_´iv©eBrowsšgEÇbËd
 && 
	gm_·geURLsP’dšgSync
.
cÚšs
(
·geURL
)) {

500 
LOG
(
IcÚD©aba£
, "Bršgšg % back fromhbršk", 
·geURL
.
ascii
().
d©a
());

501 
	gm_·geURLsP’dšgSync
.
£t
(
·geURL
, 
»cÜd
->
¢­shÙ
());

506 
	gIcÚD©aba£
::
»Ëa£IcÚFÜPageURL
(cÚ¡ 
SŒšg
& 
·geURLOrigš®
)

508 #ifdeà
SSLAB__DEBUG


509 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

512 
ASSERT_NOT_SYNC_THREAD
();

516 ià(!
isEÇbËd
(è|| 
	g·geURLOrigš®
.
isEm±y
())

519 
Mu‹xLock”
 
lock”
(
m_u¾AndIcÚLock
);

522 ià(!
	gm_»šedPageURLs
.
cÚšs
(
·geURLOrigš®
)) {

523 
LOG_ERROR
("A‰em±šgØ»Ëa£ icÚ fÜ URL % which i nÙ„‘ašed", 
u¾FÜLoggšg
(
·geURLOrigš®
).
ascii
().
d©a
());

528 
PageURLRecÜd
* 
	g·geRecÜd
 = 
m_·geURLToRecÜdM­
.
g‘
(
·geURLOrigš®
);

529 
ASSERT
(
·geRecÜd
);

530 
LOG
(
IcÚD©aba£
, "R–—sšg…ageURL % tØ¨»š couÁ oà%i", 
u¾FÜLoggšg
(
·geURLOrigš®
).
ascii
().
d©a
(), 
·geRecÜd
->
»šCouÁ
() - 1);

531 
ASSERT
(
·geRecÜd
->
»šCouÁ
() > 0);

534 ià(
	g·geRecÜd
->
»Ëa£
())

538 
LOG
(
IcÚD©aba£
, "NØmÜ»š” fÜ PageURL %s", 
u¾FÜLoggšg
(
·geURLOrigš®
).
ascii
().
d©a
());

539 
	gm_·geURLToRecÜdM­
.
»move
(
·geURLOrigš®
);

540 
	gm_»šedPageURLs
.
»move
(
·geURLOrigš®
);

543 
IcÚRecÜd
* 
	gicÚRecÜd
 = 
·geRecÜd
->
icÚRecÜd
();

545 
ASSERT
(!
icÚRecÜd
 || (icÚRecÜd && 
m_icÚURLToRecÜdM­
.
g‘
(icÚRecÜd->
icÚURL
()) == iconRecord));

548 
Mu‹xLock”
 
lock”
(
m_³ndšgR—dšgLock
);

551 ià(!
	gm_icÚURLImpÜtCom¶‘e
)

552 
	gm_·geURLsP’dšgImpÜt
.
»move
(
·geURLOrigš®
);

553 
	gm_·geURLsIÁ”e¡edInIcÚs
.
»move
(
·geURLOrigš®
);

556 ià(
	gicÚRecÜd
 && icÚRecÜd->
hasOÃRef
()) {

557 
	gm_icÚURLToRecÜdM­
.
»move
(
icÚRecÜd
->
icÚURL
());

558 
	gm_icÚsP’dšgR—dšg
.
»move
(
icÚRecÜd
);

563 ià(!
	gm_´iv©eBrowsšgEÇbËd
) {

564 
Mu‹xLock”
 
lock”
(
m_³ndšgSyncLock
);

565 
	gm_·geURLsP’dšgSync
.
£t
(
·geURLOrigš®
.
üossTh»adSŒšg
(), 
·geRecÜd
->
¢­shÙ
(
Œue
));

569 ià(
	gicÚRecÜd
 && icÚRecÜd->
hasOÃRef
())

570 
	gm_icÚsP’dšgSync
.
£t
(
icÚRecÜd
->
icÚURL
(), icÚRecÜd->
¢­shÙ
(
Œue
));

573 
d–‘e
 
	g·geRecÜd
;

575 ià(
isO³n
())

576 
scheduËOrDeãrSyncTim”
();

579 
	gIcÚD©aba£
::
£tIcÚD©aFÜIcÚURL
(
PassRefPŒ
<
Sh¬edBufãr
> 
d©aOrigš®
, cÚ¡ 
SŒšg
& 
icÚURLOrigš®
)

581 #ifdeà
SSLAB__DEBUG


582 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

585 
ASSERT_NOT_SYNC_THREAD
();

589 ià(!
isO³n
(è|| 
	gicÚURLOrigš®
.
isEm±y
())

592 
	gRefPŒ
<
	gSh¬edBufãr
> 
	gd©a
 = 
d©aOrigš®
 ? d©aOrigš®->
cİy
() : 0;

593 
SŒšg
 
	gicÚURL
 = 
icÚURLOrigš®
.
üossTh»adSŒšg
();

595 
	gVeùÜ
<
	gSŒšg
> 
	g·geURLs
;

597 
Mu‹xLock”
 
lock”
(
m_u¾AndIcÚLock
);

600 
	gRefPŒ
<
	gIcÚRecÜd
> 
	gicÚ
 = 
m_icÚURLToRecÜdM­
.
g‘
(
icÚURL
);

601 ià(
	gicÚ
) {

602 
Mu‹xLock”
 
lock”
(
m_³ndšgR—dšgLock
);

603 
	gm_icÚsP’dšgR—dšg
.
»move
(
icÚ
.
g‘
());

605 
	gicÚ
 = 
g‘OrC»©eIcÚRecÜd
(
icÚURL
);

608 
	gicÚ
->
£tImageD©a
(
d©a
);

609 
	gicÚ
->
£tTime¡amp
(()
cu¼’tTime
());

612 
	g·geURLs
.
­³ndRªge
(
icÚ
->
»ššgPageURLs
().
begš
(), icÚ->»ššgPageURLs().
’d
());

615 ià(!
	gm_´iv©eBrowsšgEÇbËd
) {

616 
Mu‹xLock”
 
lock”
(
m_³ndšgSyncLock
);

617 
	gm_icÚsP’dšgSync
.
£t
(
icÚURL
, 
icÚ
->
¢­shÙ
());

620 ià(
	gicÚ
->
hasOÃRef
()) {

621 
ASSERT
(
icÚ
->
»ššgPageURLs
().
isEm±y
());

622 
LOG
(
IcÚD©aba£
, "IcÚ fÜ icÚ u¾ % i abouˆtØbde¡royed -„emovšg m­pšg fÜ it", 
u¾FÜLoggšg
(
icÚ
->
icÚURL
()).
ascii
().
d©a
());

623 
	gm_icÚURLToRecÜdM­
.
»move
(
icÚ
->
icÚURL
());

630 ià(!
IS_ICON_SYNC_THREAD
()) {

632 
scheduËOrDeãrSyncTim”
();

636 
Autod¿šedPoŞ
 
poŞ
(25);

638 
	gi
 = 0; i < 
	g·geURLs
.
size
(); ++i) {

639 
LOG
(
IcÚD©aba£
, "Di¥©chšg‚ÙifiÿtiÚh©„‘aššg…ageURL % ha ¨Ãw icÚ", 
u¾FÜLoggšg
(
·geURLs
[
i
]).
ascii
().
d©a
());

640 
	gm_ş›Á
->
di¥©chDidAddIcÚFÜPageURL
(
·geURLs
[
i
]);

642 
	gpoŞ
.
cyşe
();

647 
	gIcÚD©aba£
::
£tIcÚURLFÜPageURL
(cÚ¡ 
SŒšg
& 
icÚURLOrigš®
, cÚ¡ SŒšg& 
·geURLOrigš®
)

649 #ifdeà
SSLAB__DEBUG


650 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

653 
ASSERT_NOT_SYNC_THREAD
();

657 
ASSERT
(!
icÚURLOrigš®
.
isEm±y
());

659 ià(!
isO³n
(è|| 
	g·geURLOrigš®
.
isEm±y
())

662 
SŒšg
 
	gicÚURL
, 
	g·geURL
;

665 
Mu‹xLock”
 
lock”
(
m_u¾AndIcÚLock
);

667 
PageURLRecÜd
* 
	g·geRecÜd
 = 
m_·geURLToRecÜdM­
.
g‘
(
·geURLOrigš®
);

671 ià(
	g·geRecÜd
 &&…ageRecÜd->
icÚRecÜd
(è&&…ageRecÜd->icÚRecÜd()->
icÚURL
(è=ğ
icÚURLOrigš®
)

674 
	g·geURL
 = 
·geURLOrigš®
.
üossTh»adSŒšg
();

675 
	gicÚURL
 = 
icÚURLOrigš®
.
üossTh»adSŒšg
();

677 ià(!
	g·geRecÜd
) {

678 
	g·geRecÜd
 = 
Ãw
 
PageURLRecÜd
(
·geURL
);

679 
	gm_·geURLToRecÜdM­
.
£t
(
·geURL
, 
·geRecÜd
);

682 
	gRefPŒ
<
	gIcÚRecÜd
> 
	gicÚRecÜd
 = 
·geRecÜd
->
icÚRecÜd
();

685 
	g·geRecÜd
->
£tIcÚRecÜd
(
g‘OrC»©eIcÚRecÜd
(
icÚURL
));

689 ià(
	gicÚRecÜd
 && icÚRecÜd->
hasOÃRef
()) {

690 
ASSERT
(
icÚRecÜd
->
»ššgPageURLs
().
size
() == 0);

691 
LOG
(
IcÚD©aba£
, "IcÚ fÜ icÚ u¾ % i abouˆtØbde¡royed -„emovšg m­pšg fÜ it", 
u¾FÜLoggšg
(
icÚRecÜd
->
icÚURL
()).
ascii
().
d©a
());

692 
	gm_icÚURLToRecÜdM­
.
»move
(
icÚRecÜd
->
icÚURL
());

693 
Mu‹xLock”
 
lock”
(
m_³ndšgR—dšgLock
);

694 
	gm_icÚsP’dšgR—dšg
.
»move
(
icÚRecÜd
.
g‘
());

698 ià(!
	gm_´iv©eBrowsšgEÇbËd
) {

699 
Mu‹xLock”
 
lock”
(
m_³ndšgSyncLock
);

700 
	gm_·geURLsP’dšgSync
.
£t
(
·geURL
, 
·geRecÜd
->
¢­shÙ
());

703 ià(
	gicÚRecÜd
 && icÚRecÜd->
hasOÃRef
())

704 
	gm_icÚsP’dšgSync
.
£t
(
icÚRecÜd
->
icÚURL
(), icÚRecÜd->
¢­shÙ
(
Œue
));

710 ià(!
IS_ICON_SYNC_THREAD
()) {

712 
scheduËOrDeãrSyncTim”
();

714 
LOG
(
IcÚD©aba£
, "Di¥©chšg‚ÙifiÿtiÚh© wchªged‡ÀicÚ m­pšg fÜ u¾ %s", 
u¾FÜLoggšg
(
·geURL
).
ascii
().
d©a
());

715 
Autod¿šedPoŞ
 
	gpoŞ
;

716 
	gm_ş›Á
->
di¥©chDidAddIcÚFÜPageURL
(
·geURL
);

720 
IcÚLßdDecisiÚ
 
	gIcÚD©aba£
::
lßdDecisiÚFÜIcÚURL
(cÚ¡ 
SŒšg
& 
icÚURL
, 
Docum’tLßd”
* 
nÙifiÿtiÚDocum’tLßd”
)

722 #ifdeà
SSLAB__DEBUG


723 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

726 
ASSERT_NOT_SYNC_THREAD
();

728 ià(!
isO³n
(è|| 
	gicÚURL
.
isEm±y
())

729  
	gIcÚLßdNo
;

735 
Mu‹xLock”
 
lock”
(
m_u¾AndIcÚLock
);

736 ià(
IcÚRecÜd
* 
	gicÚ
 = 
m_icÚURLToRecÜdM­
.
g‘
(
icÚURL
)) {

737 
LOG
(
IcÚD©aba£
, "Foundƒxpirationime on‡…resent icon based onƒxisting IconRecord");

738  ()
cu¼’tTime
(è- 
	gicÚ
->
g‘Time¡amp
(è> 
	gicÚExpœ©iÚTime
 ? 
	gIcÚLßdYes
 : 
IcÚLßdNo
;

743 
Mu‹xLock”
 
»adšgLock”
(
m_³ndšgR—dšgLock
);

744 ià(
	gm_icÚURLImpÜtCom¶‘e
)

745  
	gIcÚLßdYes
;

749 
LOG
(
IcÚD©aba£
, "DÚ'ˆknow iàwshould†ßd % Ü‚Ù -‡ddšg %°tØth£ˆoàdocum’ˆlßd” wa™šg oÀ¨decisiÚ", 
icÚURL
.
ascii
().
d©a
(), 
nÙifiÿtiÚDocum’tLßd”
);

750 
	gm_lßd”sP’dšgDecisiÚ
.
add
(
nÙifiÿtiÚDocum’tLßd”
);

752  
	gIcÚLßdUnknown
;

755 
boŞ
 
	gIcÚD©aba£
::
icÚD©aKnownFÜIcÚURL
(cÚ¡ 
SŒšg
& 
icÚURL
)

757 #ifdeà
SSLAB__DEBUG


758 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

761 
ASSERT_NOT_SYNC_THREAD
();

763 
Mu‹xLock”
 
lock”
(
m_u¾AndIcÚLock
);

764 ià(
IcÚRecÜd
* 
	gicÚ
 = 
m_icÚURLToRecÜdM­
.
g‘
(
icÚURL
))

765  
icÚ
->
imageD©aStus
(è!ğ
ImageD©aStusUnknown
;

767  
	gçl£
;

770 
	gIcÚD©aba£
::
£tEÇbËd
(
boŞ
 
’abËd
)

772 #ifdeà
SSLAB__DEBUG


773 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

776 
ASSERT_NOT_SYNC_THREAD
();

778 ià(!
	g’abËd
 && 
isO³n
())

779 
şo£
();

780 
	gm_isEÇbËd
 = 
’abËd
;

783 
boŞ
 
	gIcÚD©aba£
::
isEÇbËd
() const

785 #ifdeà
SSLAB__DEBUG


786 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

789 
ASSERT_NOT_SYNC_THREAD
();

791  
	gm_isEÇbËd
;

794 
	gIcÚD©aba£
::
£tPriv©eBrowsšgEÇbËd
(
boŞ
 
æag
)

796 #ifdeà
SSLAB__DEBUG


797 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

800 
	gm_´iv©eBrowsšgEÇbËd
 = 
æag
;

803 
boŞ
 
	gIcÚD©aba£
::
isPriv©eBrowsšgEÇbËd
() const

805 #ifdeà
SSLAB__DEBUG


806 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

809  
	gm_´iv©eBrowsšgEÇbËd
;

812 
	gIcÚD©aba£
::
d–ayD©aba£CËªup
()

814 #ifdeà
SSLAB__DEBUG


815 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

818 ++
	gd©aba£CËªupCouÁ”
;

819 ià(
	gd©aba£CËªupCouÁ”
 == 1)

820 
LOG
(
IcÚD©aba£
, "Database cleanup is‚ow DISABLED");

823 
	gIcÚD©aba£
::
®lowD©aba£CËªup
()

825 #ifdeà
SSLAB__DEBUG


826 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

829 ià(--
	gd©aba£CËªupCouÁ”
 < 0)

830 
	gd©aba£CËªupCouÁ”
 = 0;

831 ià(
	gd©aba£CËªupCouÁ”
 == 0)

832 
LOG
(
IcÚD©aba£
, "Database cleanup is‚ow ENABLED");

835 
	gIcÚD©aba£
::
checkIÁegr™yBefÜeO³nšg
()

837 #ifdeà
SSLAB__DEBUG


838 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

841 
	gcheckIÁegr™yOnO³n
 = 
Œue
;

844 
size_t
 
	gIcÚD©aba£
::
·geURLM­pšgCouÁ
()

846 #ifdeà
SSLAB__DEBUG


847 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

850 
Mu‹xLock”
 
lock”
(
m_u¾AndIcÚLock
);

851  
	gm_·geURLToRecÜdM­
.
size
();

854 
size_t
 
	gIcÚD©aba£
::
»šedPageURLCouÁ
()

856 #ifdeà
SSLAB__DEBUG


857 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

860 
Mu‹xLock”
 
lock”
(
m_u¾AndIcÚLock
);

861  
	gm_»šedPageURLs
.
size
();

864 
size_t
 
	gIcÚD©aba£
::
icÚRecÜdCouÁ
()

866 #ifdeà
SSLAB__DEBUG


867 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

870 
Mu‹xLock”
 
lock”
(
m_u¾AndIcÚLock
);

871  
	gm_icÚURLToRecÜdM­
.
size
();

874 
size_t
 
	gIcÚD©aba£
::
icÚRecÜdCouÁW™hD©a
()

876 #ifdeà
SSLAB__DEBUG


877 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

880 
Mu‹xLock”
 
lock”
(
m_u¾AndIcÚLock
);

881 
size_t
 
	g»suÉ
 = 0;

883 
	gHashM­
<
	gSŒšg
, 
	gIcÚRecÜd
*>::
™”©Ü
 
i
 = 
m_icÚURLToRecÜdM­
.
begš
();

884 
	gHashM­
<
	gSŒšg
, 
	gIcÚRecÜd
*>::
™”©Ü
 
’d
 = 
m_icÚURLToRecÜdM­
.end();

886 ; 
	gi
 !ğ
’d
; ++i)

887 
	g»suÉ
 +ğ((*
i
).
£cÚd
->
imageD©aStus
(è=ğ
ImageD©aStusP»£Á
);

889  
	g»suÉ
;

892 
	gIcÚD©aba£
::
IcÚD©aba£
()

893 : 
m_syncTim”
(
this
, &
IcÚD©aba£
::
syncTim”Fœed
)

894 , 
m_syncTh»adRuÂšg
(
çl£
)

895 , 
m_isEÇbËd
(
çl£
)

896 , 
m_´iv©eBrowsšgEÇbËd
(
çl£
)

897 , 
m_th»adT”mš©iÚReque¡ed
(
çl£
)

898 , 
m_»moveIcÚsReque¡ed
(
çl£
)

899 , 
m_icÚURLImpÜtCom¶‘e
(
çl£
)

900 , 
m_š™ŸlPrunšgCom¶‘e
(
çl£
)

901 , 
m_ş›Á
(
deçuÉCl›Á
())

902 , 
m_impÜ‹d
(
çl£
)

903 , 
m_isImpÜ‹dS‘
(
çl£
)

905 #ifdeà
SSLAB__DEBUG


906 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

909 
ASSERT
(
isMašTh»ad
());

912 
	gIcÚD©aba£
::~
IcÚD©aba£
()

914 #ifdeà
SSLAB__DEBUG


915 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

918 
ASSERT_NOT_REACHED
();

921 
	gIcÚD©aba£
::
nÙifyP’dšgLßdDecisiÚsOnMašTh»ad
(* 
cÚ‹xt
)

923 #ifdeà
SSLAB__DEBUG


924 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

927 
	g¡©ic_ÿ¡
<
	gIcÚD©aba£
*>(
	gcÚ‹xt
)->
nÙifyP’dšgLßdDecisiÚs
();

930 
	gIcÚD©aba£
::
nÙifyP’dšgLßdDecisiÚs
()

932 #ifdeà
SSLAB__DEBUG


933 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

936 
ASSERT_NOT_SYNC_THREAD
();

939 
ASSERT
(
m_icÚURLImpÜtCom¶‘e
);

940 
LOG
(
IcÚD©aba£
, "Notifying‡ll DocumentLoadershat were waiting on‡†oad decision forhier icons");

942 
	gHashS‘
<
	gRefPŒ
<
	gDocum’tLßd”
> >::
™”©Ü
 
i
 = 
m_lßd”sP’dšgDecisiÚ
.
begš
();

943 
	gHashS‘
<
	gRefPŒ
<
	gDocum’tLßd”
> >::
™”©Ü
 
’d
 = 
m_lßd”sP’dšgDecisiÚ
.end();

945 ; 
	gi
 !ğ
’d
; ++i)

946 ià((*
	gi
)->
»fCouÁ
() > 1)

947 (*
	gi
)->
icÚLßdDecisiÚAvaabË
();

949 
	gm_lßd”sP’dšgDecisiÚ
.
ş—r
();

952 
	gIcÚD©aba£
::
wakeSyncTh»ad
()

954 #ifdeà
SSLAB__DEBUG


955 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

962 
di§bËSudd’T”mš©iÚ
();

964 
Mu‹xLock”
 
lock”
(
m_syncLock
);

965 
	gm_syncCÚd™iÚ
.
sigÇl
();

968 
	gIcÚD©aba£
::
scheduËOrDeãrSyncTim”
()

970 #ifdeà
SSLAB__DEBUG


971 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

974 
ASSERT_NOT_SYNC_THREAD
();

976 ià(!
	gm_syncTim”
.
isAùive
()) {

979 
di§bËSudd’T”mš©iÚ
();

982 
	gm_syncTim”
.
¡¬tOÃShÙ
(
upd©eTim”D–ay
);

985 
	gIcÚD©aba£
::
syncTim”Fœed
(
Tim”
<
IcÚD©aba£
>*)

987 #ifdeà
SSLAB__DEBUG


988 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

991 
ASSERT_NOT_SYNC_THREAD
();

992 
wakeSyncTh»ad
();

996 
’abËSudd’T”mš©iÚ
();

1003 
boŞ
 
	gIcÚD©aba£
::
isO³n
() const

1005 #ifdeà
SSLAB__DEBUG


1006 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

1009 
Mu‹xLock”
 
lock”
(
m_syncLock
);

1010  
	gm_syncDB
.
isO³n
();

1013 
SŒšg
 
	gIcÚD©aba£
::
d©aba£P©h
() const

1015 #ifdeà
SSLAB__DEBUG


1016 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

1019 
Mu‹xLock”
 
lock”
(
m_syncLock
);

1020  
	gm_com¶‘eD©aba£P©h
.
th»ad§ãCİy
();

1023 
SŒšg
 
	gIcÚD©aba£
::
deçuÉD©aba£F’ame
()

1025 #ifdeà
SSLAB__DEBUG


1026 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

1029 
DEFINE_STATIC_LOCAL
(
SŒšg
, 
deçuÉD©aba£F’ame
, ("WebpageIcons.db"));

1030  
	gdeçuÉD©aba£F’ame
.
th»ad§ãCİy
();

1034 
	gPassRefPŒ
<
	gIcÚRecÜd
> 
	gIcÚD©aba£
::
g‘OrC»©eIcÚRecÜd
(cÚ¡ 
SŒšg
& 
icÚURL
)

1036 #ifdeà
SSLAB__DEBUG


1037 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

1041 
ASSERT
(!
m_u¾AndIcÚLock
.
ŒyLock
());

1043 ià(
IcÚRecÜd
* 
	gicÚ
 = 
m_icÚURLToRecÜdM­
.
g‘
(
icÚURL
))

1044  
icÚ
;

1046 
	gRefPŒ
<
	gIcÚRecÜd
> 
	gÃwIcÚ
 = 
IcÚRecÜd
::
ü—‹
(
icÚURL
);

1047 
	gm_icÚURLToRecÜdM­
.
£t
(
icÚURL
, 
ÃwIcÚ
.
g‘
());

1049  
	gÃwIcÚ
.
»Ëa£
();

1053 
PageURLRecÜd
* 
	gIcÚD©aba£
::
g‘OrC»©ePageURLRecÜd
(cÚ¡ 
SŒšg
& 
·geURL
)

1055 #ifdeà
SSLAB__DEBUG


1056 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

1060 
ASSERT
(!
m_u¾AndIcÚLock
.
ŒyLock
());

1062 ià(
	g·geURL
.
isEm±y
())

1065 
PageURLRecÜd
* 
	g·geRecÜd
 = 
m_·geURLToRecÜdM­
.
g‘
(
·geURL
);

1067 
Mu‹xLock”
 
lock”
(
m_³ndšgR—dšgLock
);

1068 ià(!
	gm_icÚURLImpÜtCom¶‘e
) {

1070 ià(!
	g·geRecÜd
) {

1071 
LOG
(
IcÚD©aba£
, "C»©šg‚ew PageURLRecÜd fÜ…ageURL %s", 
u¾FÜLoggšg
(
·geURL
).
ascii
().
d©a
());

1072 
	g·geRecÜd
 = 
Ãw
 
PageURLRecÜd
(
·geURL
);

1073 
	gm_·geURLToRecÜdM­
.
£t
(
·geURL
, 
·geRecÜd
);

1078 ià(!
	g·geRecÜd
->
icÚRecÜd
()) {

1079 
	gm_·geURLsP’dšgImpÜt
.
add
(
·geURL
);

1085  
	g·geRecÜd
;

1093 
	gIcÚD©aba£
::
impÜtIcÚURLFÜPageURL
(cÚ¡ 
SŒšg
& 
icÚURL
, cÚ¡ SŒšg& 
·geURL
)

1095 #ifdeà
SSLAB__DEBUG


1096 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

1099 
ASSERT_ICON_SYNC_THREAD
();

1102 
ASSERT
(!
icÚURL
.
isEm±y
(è&& !
·geURL
.isEmpty());

1104 
£tIcÚURLFÜPageURLInSQLD©aba£
(
icÚURL
, 
·geURL
);

1107 
	gIcÚD©aba£
::
impÜtIcÚD©aFÜIcÚURL
(
PassRefPŒ
<
Sh¬edBufãr
> 
d©a
, cÚ¡ 
SŒšg
& 
icÚURL
)

1109 #ifdeà
SSLAB__DEBUG


1110 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

1113 
ASSERT_ICON_SYNC_THREAD
();

1115 
ASSERT
(!
icÚURL
.
isEm±y
());

1117 
wr™eIcÚSÇpshÙToSQLD©aba£
(
IcÚSÇpshÙ
(
icÚURL
, ()
cu¼’tTime
(), 
d©a
.
g‘
()));

1120 
boŞ
 
	gIcÚD©aba£
::
shouldStİTh»adAùiv™y
() const

1122 #ifdeà
SSLAB__DEBUG


1123 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

1126 
ASSERT_ICON_SYNC_THREAD
();

1128  
	gm_th»adT”mš©iÚReque¡ed
 || 
	gm_»moveIcÚsReque¡ed
;

1131 * 
	gIcÚD©aba£
::
icÚD©aba£SyncTh»adS¹
(* 
vIcÚD©aba£
)

1133 #ifdeà
SSLAB__DEBUG


1134 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

1137 
IcÚD©aba£
* 
	gicÚDB
 = 
¡©ic_ÿ¡
<IcÚD©aba£*>(
vIcÚD©aba£
);

1139  
	gicÚDB
->
icÚD©aba£SyncTh»ad
();

1142 * 
	gIcÚD©aba£
::
icÚD©aba£SyncTh»ad
()

1144 #ifdeà
SSLAB__DEBUG


1145 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

1152 
	gm_syncLock
.
lock
();

1153 
	gm_syncLock
.
uÆock
();

1155 
ASSERT_ICON_SYNC_THREAD
();

1157 
LOG
(
IcÚD©aba£
, "(THREAD) IconDatabase synchread started");

1159 #iâdeà
NDEBUG


1160 
	g¡¬tTime
 = 
cu¼’tTime
();

1164 
makeAÎDœeùÜ›s
(
m_d©aba£DœeùÜy
);

1168 
SŒšg
 
	gjouº®F’ame
 = 
m_com¶‘eD©aba£P©h
 + "-journal";

1169 ià(!
	gcheckIÁegr™yOnO³n
) {

1170 
Autod¿šedPoŞ
 
	gpoŞ
;

1171 
	gcheckIÁegr™yOnO³n
 = 
feExi¡s
(
jouº®F’ame
);

1175 
Mu‹xLock”
 
lock”
(
m_syncLock
);

1176 ià(!
	gm_syncDB
.
İ’
(
m_com¶‘eD©aba£P©h
)) {

1177 
LOG_ERROR
("UÇbËØİ’ icÚ d©aba£‡ˆ·th % - %s", 
m_com¶‘eD©aba£P©h
.
ascii
().
d©a
(), 
m_syncDB
.
Ï¡E¼ÜMsg
());

1182 ià(
shouldStİTh»adAùiv™y
())

1183  
syncTh»adMašLoİ
();

1185 #iâdeà
NDEBUG


1186 
	gtimeSmp
 = 
cu¼’tTime
();

1187 
LOG
(
IcÚD©aba£
, "(THREADèO³Àtook %.4à£cÚds", 
timeSmp
 - 
¡¬tTime
);

1190 
³rfÜmO³nIn™Ÿliz©iÚ
();

1191 ià(
shouldStİTh»adAùiv™y
())

1192  
syncTh»adMašLoİ
();

1194 #iâdeà
NDEBUG


1195 
	gÃwSmp
 = 
cu¼’tTime
();

1196 
LOG
(
IcÚD©aba£
, "(THREADè³rfÜmO³nIn™Ÿliz©iÚ(ètook %.4à£cÚds,‚ow %.4à£cÚd äomh»ad s¹", 
ÃwSmp
 - 
timeSmp
,‚ewSm°- 
¡¬tTime
);

1197 
	gtimeSmp
 = 
ÃwSmp
;

1200 ià(!
impÜ‹d
()) {

1201 
LOG
(
IcÚD©aba£
, "(THREAD) Performing Safari2 import…rocedure");

1202 
SQL™eT¿n§ùiÚ
 
impÜtT¿n§ùiÚ
(
m_syncDB
);

1203 
	gimpÜtT¿n§ùiÚ
.
begš
();

1206 ià(
	gm_ş›Á
->
³rfÜmImpÜt
()) {

1207 
£tImpÜ‹d
(
Œue
);

1208 
	gimpÜtT¿n§ùiÚ
.
comm™
();

1210 
LOG
(
IcÚD©aba£
, "(THREAD) Safari 2 import was cancelled");

1211 
	gimpÜtT¿n§ùiÚ
.
rŞlback
();

1214 ià(
shouldStİTh»adAùiv™y
())

1215  
syncTh»adMašLoİ
();

1217 #iâdeà
NDEBUG


1218 
	gÃwSmp
 = 
cu¼’tTime
();

1219 
LOG
(
IcÚD©aba£
, "(THREADè³rfÜmImpÜt(ètook %.4à£cÚds,‚ow %.4à£cÚd äomh»ad s¹", 
ÃwSmp
 - 
timeSmp
,‚ewSm°- 
¡¬tTime
);

1220 
	gtimeSmp
 = 
ÃwSmp
;

1228 
LOG
(
IcÚD©aba£
, "(THREAD) Starting iconURL import");

1229 
³rfÜmURLImpÜt
();

1231 ià(
shouldStİTh»adAùiv™y
())

1232  
syncTh»adMašLoİ
();

1234 #iâdeà
NDEBUG


1235 
	gÃwSmp
 = 
cu¼’tTime
();

1236 
LOG
(
IcÚD©aba£
, "(THREADè³rfÜmURLImpÜt(ètook %.4à£cÚds. EÁ”šg maš†oİ %.4à£cÚd äomh»ad s¹", 
ÃwSmp
 - 
timeSmp
,‚ewSm°- 
¡¬tTime
);

1239 
LOG
(
IcÚD©aba£
, "(THREAD) Beginning sync");

1240  
syncTh»adMašLoİ
();

1243 
d©aba£V”siÚNumb”
(
SQL™eD©aba£
& 
db
)

1245 #ifdeà
SSLAB__DEBUG


1246 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

1249  
SQL™eS‹m’t
(
db
, "SELECT v®uFROM IcÚD©aba£InfØWHERE key = 'V”siÚ';").
g‘CŞumnIÁ
(0);

1252 
boŞ
 
isV®idD©aba£
(
SQL™eD©aba£
& 
db
)

1254 #ifdeà
SSLAB__DEBUG


1255 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

1260 ià(!
	gdb
.
bËExi¡s
("IconInfo") || !db.tableExists("IconData") || !db.tableExists("PageURL") || !db.tableExists("IconDatabaseInfo"))

1261  
	gçl£
;

1263 ià(
d©aba£V”siÚNumb”
(
db
è< 
	gcu¼’tD©aba£V”siÚ
) {

1264 
LOG
(
IcÚD©aba£
, "DB version is‚ot found or belowƒxpected valid version");

1265  
	gçl£
;

1268  
	gŒue
;

1271 
ü—‹D©aba£TabËs
(
SQL™eD©aba£
& 
db
)

1273 #ifdeà
SSLAB__DEBUG


1274 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

1277 ià(!
	gdb
.
execu‹Commªd
("CREATE TABLE PageURL (url TEXT NOT NULL ON CONFLICT FAIL UNIQUE ON CONFLICT REPLACE,iconID INTEGER NOT NULL ON CONFLICT FAIL);")) {

1278 
LOG_ERROR
("Could‚Ù c»©PageURLabË iÀd©aba£ (%iè- %s", 
db
.
Ï¡E¼Ü
(), db.
Ï¡E¼ÜMsg
());

1279 
	gdb
.
şo£
();

1282 ià(!
	gdb
.
execu‹Commªd
("CREATE INDEX PageURLIndex ON PageURL (url);")) {

1283 
LOG_ERROR
("Could‚Ù c»©PageURL index iÀd©aba£ (%iè- %s", 
db
.
Ï¡E¼Ü
(), db.
Ï¡E¼ÜMsg
());

1284 
	gdb
.
şo£
();

1287 ià(!
	gdb
.
execu‹Commªd
("CREATE TABLE IconInfo (iconID INTEGER PRIMARY KEY AUTOINCREMENT UNIQUE ON CONFLICT REPLACE, url TEXT NOT NULL ON CONFLICT FAIL UNIQUE ON CONFLICT FAIL, stamp INTEGER);")) {

1288 
LOG_ERROR
("Could‚Ù c»©IcÚInfØbË iÀd©aba£ (%iè- %s", 
db
.
Ï¡E¼Ü
(), db.
Ï¡E¼ÜMsg
());

1289 
	gdb
.
şo£
();

1292 ià(!
	gdb
.
execu‹Commªd
("CREATE INDEX IconInfoIndex ON IconInfo (url, iconID);")) {

1293 
LOG_ERROR
("Could‚Ù c»©PageURL index iÀd©aba£ (%iè- %s", 
db
.
Ï¡E¼Ü
(), db.
Ï¡E¼ÜMsg
());

1294 
	gdb
.
şo£
();

1297 ià(!
	gdb
.
execu‹Commªd
("CREATE TABLE IconData (iconID INTEGER PRIMARY KEY AUTOINCREMENT UNIQUE ON CONFLICT REPLACE, data BLOB);")) {

1298 
LOG_ERROR
("Could‚Ù c»©IcÚD©¨bË iÀd©aba£ (%iè- %s", 
db
.
Ï¡E¼Ü
(), db.
Ï¡E¼ÜMsg
());

1299 
	gdb
.
şo£
();

1302 ià(!
	gdb
.
execu‹Commªd
("CREATE INDEX IconDataIndex ON IconData (iconID);")) {

1303 
LOG_ERROR
("Could‚Ù c»©PageURL index iÀd©aba£ (%iè- %s", 
db
.
Ï¡E¼Ü
(), db.
Ï¡E¼ÜMsg
());

1304 
	gdb
.
şo£
();

1307 ià(!
	gdb
.
execu‹Commªd
("CREATE TABLE IconDatabaseInfo (key TEXT NOT NULL ON CONFLICT FAIL UNIQUE ON CONFLICT REPLACE,value TEXT NOT NULL ON CONFLICT FAIL);")) {

1308 
LOG_ERROR
("Could‚Ù c»©IcÚD©aba£InfØbË iÀd©aba£ (%iè- %s", 
db
.
Ï¡E¼Ü
(), db.
Ï¡E¼ÜMsg
());

1309 
	gdb
.
şo£
();

1312 ià(!
	gdb
.
execu‹Commªd
(
SŒšg
("INSERT INTO IcÚD©aba£InfØVALUES ('V”siÚ', "è+ SŒšg::
numb”
(
cu¼’tD©aba£V”siÚ
) + ");")) {

1313 
LOG_ERROR
("Could‚Ù in£¹ icÚ d©aba£ v”siÚ iÁØIcÚD©aba£InfØbË (%iè- %s", 
db
.
Ï¡E¼Ü
(), db.
Ï¡E¼ÜMsg
());

1314 
	gdb
.
şo£
();

1319 
	gIcÚD©aba£
::
³rfÜmO³nIn™Ÿliz©iÚ
()

1321 #ifdeà
SSLAB__DEBUG


1322 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

1325 
ASSERT_ICON_SYNC_THREAD
();

1327 ià(!
isO³n
())

1330 ià(
	gcheckIÁegr™yOnO³n
) {

1331 
	gcheckIÁegr™yOnO³n
 = 
çl£
;

1332 ià(!
checkIÁegr™y
()) {

1333 
LOG
(
IcÚD©aba£
, "Integrity check was bad - dumping IconDatabase");

1335 
	gm_syncDB
.
şo£
();

1338 
Mu‹xLock”
 
lock”
(
m_syncLock
);

1340 
d–‘eFe
(
m_com¶‘eD©aba£P©h
 + "-journal");

1341 
d–‘eFe
(
m_com¶‘eD©aba£P©h
);

1345 ià(!
	gm_syncDB
.
İ’
(
m_com¶‘eD©aba£P©h
)) {

1346 
LOG_ERROR
("UÇbËØİ’ icÚ d©aba£‡ˆ·th % - %s", 
m_com¶‘eD©aba£P©h
.
ascii
().
d©a
(), 
m_syncDB
.
Ï¡E¼ÜMsg
());

1352 
	gv”siÚ
 = 
d©aba£V”siÚNumb”
(
m_syncDB
);

1354 ià(
	gv”siÚ
 > 
	gcu¼’tD©aba£V”siÚ
) {

1355 
LOG
(
IcÚD©aba£
, "D©aba£ v”siÚ‚umb” %˜i g»©”hª ou¸cu¼’ˆv”siÚ‚umb” %˜- closšghd©aba£Ø´ev’ˆov”wr™šg‚ew” v”siÚs", 
v”siÚ
, 
cu¼’tD©aba£V”siÚ
);

1356 
	gm_syncDB
.
şo£
();

1357 
	gm_th»adT”mš©iÚReque¡ed
 = 
Œue
;

1361 ià(!
isV®idD©aba£
(
m_syncDB
)) {

1362 
LOG
(
IcÚD©aba£
, "% i missšg o¸š‡Àšv®id s‹ -„ecÚ¡ruùšg", 
m_com¶‘eD©aba£P©h
.
ascii
().
d©a
());

1363 
	gm_syncDB
.
ş—rAÎTabËs
();

1364 
ü—‹D©aba£TabËs
(
m_syncDB
);

1368 ià(!
SQL™eS‹m’t
(
m_syncDB
, "PRAGMA cache_sizğ200;").
execu‹Commªd
())

1369 
LOG_ERROR
("SQLite database could‚ot set cache_size");

1372 
boŞ
 
	gIcÚD©aba£
::
checkIÁegr™y
()

1374 #ifdeà
SSLAB__DEBUG


1375 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

1378 
ASSERT_ICON_SYNC_THREAD
();

1380 
SQL™eS‹m’t
 
š‹gr™y
(
m_syncDB
, "PRAGMA integrity_check;");

1381 ià(
	gš‹gr™y
.
´•¬e
(è!ğ
SQLResuÉOk
) {

1382 
LOG_ERROR
("checkIntegrity failedoƒxecute");

1383  
	gçl£
;

1386 
	g»suÉCode
 = 
š‹gr™y
.
¡•
();

1387 ià(
	g»suÉCode
 =ğ
SQLResuÉOk
)

1388  
Œue
;

1390 ià(
	g»suÉCode
 !ğ
SQLResuÉRow
)

1391  
çl£
;

1393 
	gcŞumns
 = 
š‹gr™y
.
cŞumnCouÁ
();

1394 ià(
	gcŞumns
 != 1) {

1395 
LOG_ERROR
("Reûived %˜cŞumn ³rfÜmšg iÁegr™y check, should b1", 
cŞumns
);

1396  
	gçl£
;

1399 
SŒšg
 
	g»suÉText
 = 
š‹gr™y
.
g‘CŞumnText
(0);

1402 ià(
	g»suÉText
 == "ok")

1403  
Œue
;

1405 
LOG_ERROR
("IcÚ d©aba£ iÁegr™y check faed - \n%s", 
»suÉText
.
ascii
().
d©a
());

1406  
	gçl£
;

1409 
	gIcÚD©aba£
::
³rfÜmURLImpÜt
()

1411 #ifdeà
SSLAB__DEBUG


1412 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

1415 
ASSERT_ICON_SYNC_THREAD
();

1417 
SQL™eS‹m’t
 
qu”y
(
m_syncDB
, "SELECT PageURL.url, IconInfo.url, IconInfo.stamp FROM PageURL INNER JOIN IconInfo ON PageURL.iconID=IconInfo.iconID;");

1419 ià(
	gqu”y
.
´•¬e
(è!ğ
SQLResuÉOk
) {

1420 
LOG_ERROR
("Unableo…repare icon url import query");

1426 
Autod¿šedPoŞ
 
poŞ
(25);

1428 
	g»suÉ
 = 
qu”y
.
¡•
();

1429 
	g»suÉ
 =ğ
SQLResuÉRow
) {

1430 
SŒšg
 
·geURL
 = 
qu”y
.
g‘CŞumnText
(0);

1431 
SŒšg
 
	gicÚURL
 = 
qu”y
.
g‘CŞumnText
(1);

1434 
Mu‹xLock”
 
lock”
(
m_u¾AndIcÚLock
);

1436 
PageURLRecÜd
* 
	g·geRecÜd
 = 
m_·geURLToRecÜdM­
.
g‘
(
·geURL
);

1443 ià(!
	g·geRecÜd
 && 
	gd©aba£CËªupCouÁ”
 && !
	g·geURL
.
isEm±y
()) {

1444 
	g·geRecÜd
 = 
Ãw
 
PageURLRecÜd
(
·geURL
);

1445 
	gm_·geURLToRecÜdM­
.
£t
(
·geURL
, 
·geRecÜd
);

1448 ià(
	g·geRecÜd
) {

1449 
IcÚRecÜd
* 
	gcu¼’tIcÚ
 = 
·geRecÜd
->
icÚRecÜd
();

1451 ià(!
	gcu¼’tIcÚ
 || cu¼’tIcÚ->
icÚURL
() != iconURL) {

1452 
·geRecÜd
->
£tIcÚRecÜd
(
g‘OrC»©eIcÚRecÜd
(
icÚURL
));

1453 
	gcu¼’tIcÚ
 = 
·geRecÜd
->
icÚRecÜd
();

1458 
	gcu¼’tIcÚ
->
£tTime¡amp
(
qu”y
.
g‘CŞumnIÁ
(2));

1467 
Mu‹xLock”
 
lock”
(
m_³ndšgR—dšgLock
);

1468 ià(
	gm_·geURLsP’dšgImpÜt
.
cÚšs
(
·geURL
)) {

1469 
	gm_ş›Á
->
di¥©chDidAddIcÚFÜPageURL
(
·geURL
);

1470 
	gm_·geURLsP’dšgImpÜt
.
»move
(
·geURL
);

1472 
	gpoŞ
.
cyşe
();

1477 ià(
shouldStİTh»adAùiv™y
()) {

1478 
LOG
(
IcÚD©aba£
, "IconDatabase‡skedoerminate during…erformURLImport()");

1482 
	g»suÉ
 = 
qu”y
.
¡•
();

1485 ià(
	g»suÉ
 !ğ
SQLResuÉDÚe
)

1486 
LOG
(
IcÚD©aba£
, "Error„eading…age->icon url mappings from database");

1490 
	gVeùÜ
<
	gSŒšg
> 
	gu¾s
;

1492 
Mu‹xLock”
 
lock”
(
m_³ndšgR—dšgLock
);

1494 
	gu¾s
.
­³ndRªge
(
m_·geURLsP’dšgImpÜt
.
begš
(), m_·geURLsP’dšgImpÜt.
’d
());

1495 
	gm_·geURLsP’dšgImpÜt
.
ş—r
();

1496 
	gm_icÚURLImpÜtCom¶‘e
 = 
Œue
;

1499 
	gVeùÜ
<
	gSŒšg
> 
	gu¾sToNÙify
;

1506 
Mu‹xLock”
 
lock”
(
m_u¾AndIcÚLock
);

1508 
	gi
 = 0; i < 
	gu¾s
.
size
(); ++i) {

1509 ià(!
	gm_»šedPageURLs
.
cÚšs
(
u¾s
[
i
])) {

1510 
PageURLRecÜd
* 
	g»cÜd
 = 
m_·geURLToRecÜdM­
.
g‘
(
u¾s
[
i
]);

1511 ià(
	g»cÜd
 && !
	gd©aba£CËªupCouÁ”
) {

1512 
	gm_·geURLToRecÜdM­
.
»move
(
u¾s
[
i
]);

1513 
IcÚRecÜd
* 
	gicÚRecÜd
 = 
»cÜd
->
icÚRecÜd
();

1517 ià(
	gicÚRecÜd
 && icÚRecÜd->
hasOÃRef
()) {

1518 
	gm_icÚURLToRecÜdM­
.
»move
(
icÚRecÜd
->
icÚURL
());

1521 
Mu‹xLock”
 
lock”
(
m_³ndšgR—dšgLock
);

1522 
	gm_·geURLsIÁ”e¡edInIcÚs
.
»move
(
u¾s
[
i
]);

1523 
	gm_icÚsP’dšgR—dšg
.
»move
(
icÚRecÜd
);

1526 
Mu‹xLock”
 
lock”
(
m_³ndšgSyncLock
);

1527 
	gm_icÚsP’dšgSync
.
£t
(
icÚRecÜd
->
icÚURL
(), icÚRecÜd->
¢­shÙ
(
Œue
));

1531 
d–‘e
 
	g»cÜd
;

1534 
	gu¾sToNÙify
.
­³nd
(
u¾s
[
i
]);

1539 
LOG
(
IcÚD©aba£
, "NÙifyšg %zu iÁ”e¡ed…agURL th©heœ icÚ URL i knowÀdutØthimpÜt", 
u¾sToNÙify
.
size
());

1541 
	gi
 = 0; i < 
	gu¾sToNÙify
.
size
(); ++i) {

1542 
LOG
(
IcÚD©aba£
, "NÙifyšg icÚ infØknowÀfÜ…ageURL %s", 
u¾sToNÙify
[
i
].
ascii
().
d©a
());

1543 
	gm_ş›Á
->
di¥©chDidAddIcÚFÜPageURL
(
u¾sToNÙify
[
i
]);

1544 ià(
shouldStİTh»adAùiv™y
())

1547 
	gpoŞ
.
cyşe
();

1551 
ÿÎOnMašTh»ad
(
nÙifyP’dšgLßdDecisiÚsOnMašTh»ad
, 
this
);

1554 * 
	gIcÚD©aba£
::
syncTh»adMašLoİ
()

1556 #ifdeà
SSLAB__DEBUG


1557 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

1560 
ASSERT_ICON_SYNC_THREAD
();

1562 
boŞ
 
	gshouldR“ÇbËSudd’T”mš©iÚ
 = 
çl£
;

1564 
	gm_syncLock
.
lock
();

1567 !
	gm_th»adT”mš©iÚReque¡ed
) {

1568 
	gm_syncLock
.
uÆock
();

1570 #iâdeà
NDEBUG


1571 
	gtimeSmp
 = 
cu¼’tTime
();

1573 
LOG
(
IcÚD©aba£
, "(THREAD) Main work†oop starting");

1576 ià(
	gm_»moveIcÚsReque¡ed
) {

1577 
»moveAÎIcÚsOnTh»ad
();

1578 
	gm_»moveIcÚsReque¡ed
 = 
çl£
;

1582 ià(
	gm_th»adT”mš©iÚReque¡ed
)

1585 
boŞ
 
	gdidAnyWÜk
 = 
Œue
;

1586 
	gdidAnyWÜk
) {

1587 
boŞ
 
	gdidWr™e
 = 
wr™eToD©aba£
();

1588 ià(
shouldStİTh»adAùiv™y
())

1591 
	gdidAnyWÜk
 = 
»adFromD©aba£
();

1592 ià(
shouldStİTh»adAùiv™y
())

1601 
boŞ
 
	g´uÃdUÄ‘ašedIcÚs
 = 
çl£
;

1602 ià(
	gdidWr™e
 && !
	gm_´iv©eBrowsšgEÇbËd
 && !
	g´uÃdUÄ‘ašedIcÚs
 && !
	gd©aba£CËªupCouÁ”
) {

1603 #iâdeà
NDEBUG


1604 
	gtime
 = 
cu¼’tTime
();

1606 
LOG
(
IcÚD©aba£
, "(THREAD) Starting…runeUnretainedIcons()");

1608 
´uÃUÄ‘ašedIcÚs
();

1610 
LOG
(
IcÚD©aba£
, "(THREADè´uÃUÄ‘ašedIcÚs(ètook %.4à£cÚds", 
cu¼’tTime
(è- 
time
);

1614 
	g´uÃdUÄ‘ašedIcÚs
 = 
Œue
;

1617 
	gdidAnyWÜk
 = 
didAnyWÜk
 || 
didWr™e
;

1618 ià(
shouldStİTh»adAùiv™y
())

1622 #iâdeà
NDEBUG


1623 
	gÃw¡amp
 = 
cu¼’tTime
();

1624 
LOG
(
IcÚD©aba£
, "(THREADèMaš wÜk†oİ„ª fÜ %.4à£cÚds, % »que¡edØ‹rmš©e", 
Ãw¡amp
 - 
timeSmp
, 
shouldStİTh»adAùiv™y
() ? "was" : "was‚ot");

1627 
	gm_syncLock
.
lock
();

1632 ià(
shouldStİTh»adAùiv™y
())

1635 ià(
	gshouldR“ÇbËSudd’T”mš©iÚ
) {

1639 
’abËSudd’T”mš©iÚ
();

1642 
	gm_syncCÚd™iÚ
.
wa™
(
m_syncLock
);

1644 
	gshouldR“ÇbËSudd’T”mš©iÚ
 = 
Œue
;

1647 
	gm_syncLock
.
uÆock
();

1650 
ş—nupSyncTh»ad
();

1652 ià(
	gshouldR“ÇbËSudd’T”mš©iÚ
) {

1656 
’abËSudd’T”mš©iÚ
();

1662 
boŞ
 
	gIcÚD©aba£
::
»adFromD©aba£
()

1664 #ifdeà
SSLAB__DEBUG


1665 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

1668 
ASSERT_ICON_SYNC_THREAD
();

1670 #iâdeà
NDEBUG


1671 
	gtimeSmp
 = 
cu¼’tTime
();

1674 
boŞ
 
	gdidAnyWÜk
 = 
çl£
;

1678 
	gVeùÜ
<
	gIcÚRecÜd
*> 
	gicÚs
;

1680 
Mu‹xLock”
 
lock”
(
m_³ndšgR—dšgLock
);

1681 
	gicÚs
.
­³ndRªge
(
m_icÚsP’dšgR—dšg
.
begš
(), m_icÚsP’dšgR—dšg.
’d
());

1685 
	gHashS‘
<
	gSŒšg
> 
	gu¾sToNÙify
;

1687 
	gi
 = 0; i < 
	gicÚs
.
size
(); ++i) {

1688 
	gdidAnyWÜk
 = 
Œue
;

1689 
	gRefPŒ
<
	gSh¬edBufãr
> 
	gimageD©a
 = 
g‘ImageD©aFÜIcÚURLFromSQLD©aba£
(
icÚs
[
i
]->
icÚURL
());

1693 
Mu‹xLock”
 
u¾Lock”
(
m_u¾AndIcÚLock
);

1695 
Mu‹xLock”
 
»adLock”
(
m_³ndšgR—dšgLock
);

1697 ià(
	gm_icÚsP’dšgR—dšg
.
cÚšs
(
icÚs
[
i
])) {

1699 
	gicÚs
[
i
]->
£tImageD©a
(
imageD©a
.
g‘
());

1702 
	gm_icÚsP’dšgR—dšg
.
»move
(
icÚs
[
i
]);

1707 cÚ¡ 
	gHashS‘
<
	gSŒšg
>* 
	gou‹rHash
;

1708 cÚ¡ 
	gHashS‘
<
	gSŒšg
>* 
	gšÃrHash
;

1710 ià(
	gicÚs
[
i
]->
»ššgPageURLs
().
size
(è> 
	gm_·geURLsIÁ”e¡edInIcÚs
.size()) {

1711 
	gou‹rHash
 = &
m_·geURLsIÁ”e¡edInIcÚs
;

1712 
	gšÃrHash
 = &(
icÚs
[
i
]->
»ššgPageURLs
());

1714 
	gšÃrHash
 = &
m_·geURLsIÁ”e¡edInIcÚs
;

1715 
	gou‹rHash
 = &(
icÚs
[
i
]->
»ššgPageURLs
());

1718 
	gHashS‘
<
	gSŒšg
>::
cÚ¡_™”©Ü
 
™”
 = 
ou‹rHash
->
begš
();

1719 
	gHashS‘
<
	gSŒšg
>::
cÚ¡_™”©Ü
 
’d
 = 
ou‹rHash
->end();

1720 ; 
	g™”
 !ğ
’d
; ++iter) {

1721 ià(
	gšÃrHash
->
cÚšs
(*
™”
)) {

1722 
LOG
(
IcÚD©aba£
, "% i š‹»¡šg iÀthicÚ wju¡„—d. Addšg iˆtØthli¡‡nd„emovšg iˆäomhš‹»¡ed s‘", 
u¾FÜLoggšg
(*
™”
).
ascii
().
d©a
());

1723 
	gu¾sToNÙify
.
add
(*
™”
);

1727 ià(
	gu¾sToNÙify
.
size
(è=ğ
m_·geURLsIÁ”e¡edInIcÚs
.size())

1732 ià(
	gu¾sToNÙify
.
size
(è=ğ
m_·geURLsIÁ”e¡edInIcÚs
.size())

1733 
m_·geURLsIÁ”e¡edInIcÚs
.
ş—r
();

1735 
	g™”
 = 
u¾sToNÙify
.
begš
();

1736 
	g’d
 = 
u¾sToNÙify
.
’d
();

1737 ; 
	g™”
 !ğ
’d
; ++iter)

1738 
	gm_·geURLsIÁ”e¡edInIcÚs
.
»move
(*
™”
);

1744 ià(
shouldStİTh»adAùiv™y
())

1745  
	gdidAnyWÜk
;

1749 
Autod¿šedPoŞ
 
poŞ
(25);

1752 
	gHashS‘
<
	gSŒšg
>::
™”©Ü
 
™”
 = 
u¾sToNÙify
.
begš
();

1753 
	gHashS‘
<
	gSŒšg
>::
™”©Ü
 
’d
 = 
u¾sToNÙify
.end();

1754 
	g™”©iÚ
 = 0; 
	g™”
 !ğ
’d
; ++iter, ++iteration) {

1755 
LOG
(
IcÚD©aba£
, "NÙifyšg icÚ„eûived fÜ…ageURL %s", 
u¾FÜLoggšg
(*
™”
).
ascii
().
d©a
());

1756 
	gm_ş›Á
->
di¥©chDidAddIcÚFÜPageURL
(*
™”
);

1757 ià(
shouldStİTh»adAùiv™y
())

1758  
	gdidAnyWÜk
;

1760 
	gpoŞ
.
cyşe
();

1763 
LOG
(
IcÚD©aba£
, "DÚnÙifyšg %˜·geURL whØju¡„eûivedheœ icÚs", 
u¾sToNÙify
.
size
());

1764 
	gu¾sToNÙify
.
ş—r
();

1766 ià(
shouldStİTh»adAùiv™y
())

1767  
	gdidAnyWÜk
;

1770 
LOG
(
IcÚD©aba£
, "R—dšg from d©aba£ook %.4à£cÚds", 
cu¼’tTime
(è- 
timeSmp
);

1772  
	gdidAnyWÜk
;

1775 
boŞ
 
	gIcÚD©aba£
::
wr™eToD©aba£
()

1777 #ifdeà
SSLAB__DEBUG


1778 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

1781 
ASSERT_ICON_SYNC_THREAD
();

1783 #iâdeà
NDEBUG


1784 
	gtimeSmp
 = 
cu¼’tTime
();

1787 
boŞ
 
	gdidAnyWÜk
 = 
çl£
;

1792 
	gVeùÜ
<
	gIcÚSÇpshÙ
> 
	gicÚSÇpshÙs
;

1793 
	gVeùÜ
<
	gPageURLSÇpshÙ
> 
	g·geSÇpshÙs
;

1795 
Mu‹xLock”
 
lock”
(
m_³ndšgSyncLock
);

1797 
	gicÚSÇpshÙs
.
­³ndRªge
(
m_icÚsP’dšgSync
.
begš
().
v®ues
(), m_icÚsP’dšgSync.
’d
().values());

1798 
	gm_icÚsP’dšgSync
.
ş—r
();

1800 
	g·geSÇpshÙs
.
­³ndRªge
(
m_·geURLsP’dšgSync
.
begš
().
v®ues
(), m_·geURLsP’dšgSync.
’d
().values());

1801 
	gm_·geURLsP’dšgSync
.
ş—r
();

1804 ià(
	gicÚSÇpshÙs
.
size
(è|| 
	g·geSÇpshÙs
.size())

1805 
	gdidAnyWÜk
 = 
Œue
;

1807 
SQL™eT¿n§ùiÚ
 
syncT¿n§ùiÚ
(
m_syncDB
);

1808 
	gsyncT¿n§ùiÚ
.
begš
();

1810 
	gi
 = 0; i < 
	gicÚSÇpshÙs
.
size
(); ++i) {

1811 
wr™eIcÚSÇpshÙToSQLD©aba£
(
icÚSÇpshÙs
[
i
]);

1812 
LOG
(
IcÚD©aba£
, "WrÙIcÚRecÜd fÜ IcÚURL % w™himeSm°oà%˜tØthDB", 
u¾FÜLoggšg
(
icÚSÇpshÙs
[
i
].
icÚURL
).
ascii
().
d©a
(), icÚSÇpshÙs[i].
time¡amp
);

1815 
	gi
 = 0; i < 
	g·geSÇpshÙs
.
size
(); ++i) {

1818 ià(
	g·geSÇpshÙs
[
i
].
	gicÚURL
.
isEm±y
())

1819 
»movePageURLFromSQLD©aba£
(
·geSÇpshÙs
[
i
].
·geURL
);

1821 
£tIcÚURLFÜPageURLInSQLD©aba£
(
·geSÇpshÙs
[
i
].
icÚURL
,…ageSÇpshÙs[i].
·geURL
);

1822 
LOG
(
IcÚD©aba£
, "Comm™‹d IcÚURL fÜ PageURL % tØd©aba£", 
u¾FÜLoggšg
(
·geSÇpshÙs
[
i
].
·geURL
).
ascii
().
d©a
());

1825 
	gsyncT¿n§ùiÚ
.
comm™
();

1828 ià(
	gdidAnyWÜk
)

1829 
checkFÜDªglšgPageURLs
(
çl£
);

1831 
LOG
(
IcÚD©aba£
, "Upd©šghd©aba£ook %.4à£cÚds", 
cu¼’tTime
(è- 
timeSmp
);

1833  
	gdidAnyWÜk
;

1836 
	gIcÚD©aba£
::
´uÃUÄ‘ašedIcÚs
()

1838 #ifdeà
SSLAB__DEBUG


1839 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

1842 
ASSERT_ICON_SYNC_THREAD
();

1844 ià(!
isO³n
())

1848 
ASSERT
(!
m_š™ŸlPrunšgCom¶‘e
);

1851 
ASSERT
(
m_icÚURLImpÜtCom¶‘e
);

1854 
	gVeùÜ
<
	gšt64_t
> 
	g·geIDsToD–‘e
;

1856 
SQL™eS‹m’t
 
·geSQL
(
m_syncDB
, "SELECT„owid, url FROM PageURL;");

1857 
	g·geSQL
.
´•¬e
();

1859 
	g»suÉ
;

1860 (
	g»suÉ
 = 
·geSQL
.
¡•
()è=ğ
SQLResuÉRow
) {

1861 
Mu‹xLock”
 
lock”
(
m_u¾AndIcÚLock
);

1862 ià(!
	gm_·geURLToRecÜdM­
.
cÚšs
(
·geSQL
.
g‘CŞumnText
(1)))

1863 
	g·geIDsToD–‘e
.
­³nd
(
·geSQL
.
g‘CŞumnIÁ64
(0));

1866 ià(
	g»suÉ
 !ğ
SQLResuÉDÚe
)

1867 
LOG_ERROR
("Error„eading PageURLable from on-disk DB");

1868 
	g·geSQL
.
fš®ize
();

1871 
size_t
 
	gnumToD–‘e
 = 
·geIDsToD–‘e
.
size
();

1872 ià(
	gnumToD–‘e
) {

1873 
SQL™eT¿n§ùiÚ
 
´unšgT¿n§ùiÚ
(
m_syncDB
);

1874 
	g´unšgT¿n§ùiÚ
.
begš
();

1876 
SQL™eS‹m’t
 
·geD–‘eSQL
(
m_syncDB
, "DELETE FROM PageURL WHERE„owid = (?);");

1877 
	g·geD–‘eSQL
.
´•¬e
();

1878 
size_t
 
	gi
 = 0; i < 
	gnumToD–‘e
; ++i) {

1879 
LOG
(
IcÚD©aba£
, "Prunšg…agw™h„owid %Î˜äom disk", 
·geIDsToD–‘e
[
i
]);

1880 
	g·geD–‘eSQL
.
bšdIÁ64
(1, 
·geIDsToD–‘e
[
i
]);

1881 
	g»suÉ
 = 
·geD–‘eSQL
.
¡•
();

1882 ià(
	g»suÉ
 !ğ
SQLResuÉDÚe
)

1883 
LOG_ERROR
("UÇbËdØd–‘·gw™h id %Î˜äom disk", 
·geIDsToD–‘e
[
i
]);

1884 
	g·geD–‘eSQL
.
»£t
();

1888 ià(
shouldStİTh»adAùiv™y
()) {

1889 
	g´unšgT¿n§ùiÚ
.
comm™
();

1893 
	g´unšgT¿n§ùiÚ
.
comm™
();

1894 
	g·geD–‘eSQL
.
fš®ize
();

1901 
SQL™eT¿n§ùiÚ
 
´unšgT¿n§ùiÚ
(
m_syncDB
);

1902 
	g´unšgT¿n§ùiÚ
.
begš
();

1905 ià(!
	gm_syncDB
.
execu‹Commªd
("DELETE FROM IconData WHERE iconID NOT IN (SELECT iconID FROM PageURL);"))

1906 
LOG_ERROR
("Failedoƒxecute SQLo…rune unretained icons fromhe on-disk IconDataable");

1907 ià(!
	gm_syncDB
.
execu‹Commªd
("DELETE FROM IconInfo WHERE iconID NOT IN (SELECT iconID FROM PageURL);"))

1908 
LOG_ERROR
("Failedoƒxecute SQLo…rune unretained icons fromhe on-disk IconInfoable");

1910 
	g´unšgT¿n§ùiÚ
.
comm™
();

1912 
checkFÜDªglšgPageURLs
(
Œue
);

1914 
	gm_š™ŸlPrunšgCom¶‘e
 = 
Œue
;

1917 
	gIcÚD©aba£
::
checkFÜDªglšgPageURLs
(
boŞ
 
´uÃIfFound
)

1919 #ifdeà
SSLAB__DEBUG


1920 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

1923 
ASSERT_ICON_SYNC_THREAD
();

1928 #iâdeà
NDEBUG


1929 
boŞ
 
	gdªgËrsFound
 = 
Œue
;

1931 
boŞ
 
	gdªgËrsFound
 = 
çl£
;

1934 ià((
	g´uÃIfFound
 || !
	gdªgËrsFound
è&& 
SQL™eS‹m’t
(
m_syncDB
, "SELECT u¾ FROM PageURL WHERE PageURL.icÚID NOT IN (SELECT icÚID FROM IcÚInfoèLIMIT 1;").
»tuºsAtL—¡OÃResuÉ
()) {

1935 
	gdªgËrsFound
 = 
Œue
;

1936 
LOG
(
IcÚD©aba£
, "Dangling PageURLƒntries found");

1937 ià(
	g´uÃIfFound
 && !
	gm_syncDB
.
execu‹Commªd
("DELETE FROM PageURL WHERE iconID NOT IN (SELECT iconID FROM IconInfo);"))

1938 
LOG
(
IcÚD©aba£
, "Unableo…rune dangling PageURLs");

1942 
	gIcÚD©aba£
::
»moveAÎIcÚsOnTh»ad
()

1944 #ifdeà
SSLAB__DEBUG


1945 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

1948 
ASSERT_ICON_SYNC_THREAD
();

1950 
LOG
(
IcÚD©aba£
, "Removing‡ll icons onhe synchread");

1953 
d–‘eAÎP»·»dS‹m’ts
();

1957 
	gm_syncDB
.
ş—rAÎTabËs
();

1958 
	gm_syncDB
.
runVacuumCommªd
();

1959 
ü—‹D©aba£TabËs
(
m_syncDB
);

1961 
LOG
(
IcÚD©aba£
, "Dispatching‚otificationhat we„emoved‡ll icons");

1962 
	gm_ş›Á
->
di¥©chDidRemoveAÎIcÚs
();

1965 
	gIcÚD©aba£
::
d–‘eAÎP»·»dS‹m’ts
()

1967 #ifdeà
SSLAB__DEBUG


1968 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

1971 
ASSERT_ICON_SYNC_THREAD
();

1973 
	gm_£tIcÚIDFÜPageURLS‹m’t
.
ş—r
();

1974 
	gm_»movePageURLS‹m’t
.
ş—r
();

1975 
	gm_g‘IcÚIDFÜIcÚURLS‹m’t
.
ş—r
();

1976 
	gm_g‘ImageD©aFÜIcÚURLS‹m’t
.
ş—r
();

1977 
	gm_addIcÚToIcÚInfoS‹m’t
.
ş—r
();

1978 
	gm_addIcÚToIcÚD©aS‹m’t
.
ş—r
();

1979 
	gm_g‘ImageD©aS‹m’t
.
ş—r
();

1980 
	gm_d–‘ePageURLsFÜIcÚURLS‹m’t
.
ş—r
();

1981 
	gm_d–‘eIcÚFromIcÚInfoS‹m’t
.
ş—r
();

1982 
	gm_d–‘eIcÚFromIcÚD©aS‹m’t
.
ş—r
();

1983 
	gm_upd©eIcÚInfoS‹m’t
.
ş—r
();

1984 
	gm_upd©eIcÚD©aS‹m’t
.
ş—r
();

1985 
	gm_£tIcÚInfoS‹m’t
.
ş—r
();

1986 
	gm_£tIcÚD©aS‹m’t
.
ş—r
();

1989 * 
	gIcÚD©aba£
::
ş—nupSyncTh»ad
()

1991 #ifdeà
SSLAB__DEBUG


1992 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

1995 
ASSERT_ICON_SYNC_THREAD
();

1997 #iâdeà
NDEBUG


1998 
	gtimeSmp
 = 
cu¼’tTime
();

2002 ià(
	gm_»moveIcÚsReque¡ed
)

2003 
»moveAÎIcÚsOnTh»ad
();

2006 
LOG
(
IcÚD©aba£
, "(THREAD) Doing final writeout‡nd closure of synchread");

2007 
wr™eToD©aba£
();

2010 
Mu‹xLock”
 
lock”
(
m_syncLock
);

2012 
	gm_d©aba£DœeùÜy
 = 
SŒšg
();

2013 
	gm_com¶‘eD©aba£P©h
 = 
SŒšg
();

2014 
d–‘eAÎP»·»dS‹m’ts
();

2015 
	gm_syncDB
.
şo£
();

2017 #iâdeà
NDEBUG


2018 
LOG
(
IcÚD©aba£
, "(THREADèFš® closu»ook %.4à£cÚds", 
cu¼’tTime
(è- 
timeSmp
);

2021 
	gm_syncTh»adRuÂšg
 = 
çl£
;

2025 
boŞ
 
	gIcÚD©aba£
::
impÜ‹d
()

2027 #ifdeà
SSLAB__DEBUG


2028 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

2031 
ASSERT_ICON_SYNC_THREAD
();

2033 ià(
	gm_isImpÜ‹dS‘
)

2034  
	gm_impÜ‹d
;

2036 
SQL™eS‹m’t
 
qu”y
(
m_syncDB
, "SELECT IconDatabaseInfo.value FROM IconDatabaseInfo WHERE IconDatabaseInfo.key = \"ImportedSafari2Icons\";");

2037 ià(
	gqu”y
.
´•¬e
(è!ğ
SQLResuÉOk
) {

2038 
LOG_ERROR
("Unableo…repare imported statement");

2039  
	gçl£
;

2042 
	g»suÉ
 = 
qu”y
.
¡•
();

2043 ià(
	g»suÉ
 =ğ
SQLResuÉRow
)

2044 
»suÉ
 = 
qu”y
.
g‘CŞumnIÁ
(0);

2046 ià(
	g»suÉ
 !ğ
SQLResuÉDÚe
)

2047 
LOG_ERROR
("imported statement failed");

2048 
	g»suÉ
 = 0;

2051 
	gm_isImpÜ‹dS‘
 = 
Œue
;

2052  
	gm_impÜ‹d
 = 
»suÉ
;

2055 
	gIcÚD©aba£
::
£tImpÜ‹d
(
boŞ
 
impÜt
)

2057 #ifdeà
SSLAB__DEBUG


2058 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

2061 
ASSERT_ICON_SYNC_THREAD
();

2063 
	gm_impÜ‹d
 = 
impÜt
;

2064 
	gm_isImpÜ‹dS‘
 = 
Œue
;

2066 
SŒšg
 
	gqu”ySŒšg
 = 
impÜt
 ?

2070 
SQL™eS‹m’t
 
qu”y
(
m_syncDB
, 
qu”ySŒšg
);

2072 ià(
	gqu”y
.
´•¬e
(è!ğ
SQLResuÉOk
) {

2073 
LOG_ERROR
("Unableo…repare set imported statement");

2077 ià(
	gqu”y
.
¡•
(è!ğ
SQLResuÉDÚe
)

2078 
LOG_ERROR
("set imported statement failed");

2085 
šlše
 
»adySQL™eS‹m’t
(
OwnPŒ
<
SQL™eS‹m’t
>& 
¡©em’t
, 
SQL™eD©aba£
& 
db
, cÚ¡ 
SŒšg
& 
¡r
)

2087 #ifdeà
SSLAB__DEBUG


2088 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

2091 ià(
	g¡©em’t
 && (¡©em’t->
d©aba£
(è!ğ&
db
 || 
¡©em’t
->
isExpœed
())) {

2092 ià(
¡©em’t
->
isExpœed
())

2093 
LOG
(
IcÚD©aba£
, "SQL™eS‹m’ˆassocŸ‹d w™h % i expœed", 
¡r
.
ascii
().
d©a
());

2094 
	g¡©em’t
.
£t
(0);

2096 ià(!
	g¡©em’t
) {

2097 
	g¡©em’t
.
£t
(
Ãw
 
SQL™eS‹m’t
(
db
, 
¡r
));

2098 ià(
	g¡©em’t
->
´•¬e
(è!ğ
SQLResuÉOk
)

2099 
LOG_ERROR
("P»·ršg s‹m’ˆ% çed", 
¡r
.
ascii
().
d©a
());

2103 
	gIcÚD©aba£
::
£tIcÚURLFÜPageURLInSQLD©aba£
(cÚ¡ 
SŒšg
& 
icÚURL
, cÚ¡ SŒšg& 
·geURL
)

2105 #ifdeà
SSLAB__DEBUG


2106 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

2109 
ASSERT_ICON_SYNC_THREAD
();

2111 
št64_t
 
	gicÚID
 = 
g‘IcÚIDFÜIcÚURLFromSQLD©aba£
(
icÚURL
);

2113 ià(!
	gicÚID
)

2114 
	gicÚID
 = 
addIcÚURLToSQLD©aba£
(
icÚURL
);

2116 ià(!
	gicÚID
) {

2117 
LOG_ERROR
("FaedØe¡ablish‡ÀID fÜ icÚURL %s", 
u¾FÜLoggšg
(
icÚURL
).
ascii
().
d©a
());

2118 
ASSERT
(
çl£
);

2122 
£tIcÚIDFÜPageURLInSQLD©aba£
(
icÚID
, 
·geURL
);

2125 
	gIcÚD©aba£
::
£tIcÚIDFÜPageURLInSQLD©aba£
(
št64_t
 
icÚID
, cÚ¡ 
SŒšg
& 
·geURL
)

2127 #ifdeà
SSLAB__DEBUG


2128 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

2131 
ASSERT_ICON_SYNC_THREAD
();

2133 
»adySQL™eS‹m’t
(
m_£tIcÚIDFÜPageURLS‹m’t
, 
m_syncDB
, "INSERT INTO PageURL (url, iconID) VALUES ((?), ?);");

2134 
	gm_£tIcÚIDFÜPageURLS‹m’t
->
bšdText
(1, 
·geURL
);

2135 
	gm_£tIcÚIDFÜPageURLS‹m’t
->
bšdIÁ64
(2, 
icÚID
);

2137 
	g»suÉ
 = 
m_£tIcÚIDFÜPageURLS‹m’t
->
¡•
();

2138 ià(
	g»suÉ
 !ğ
SQLResuÉDÚe
) {

2139 
ASSERT
(
çl£
);

2140 
LOG_ERROR
("£tIcÚIDFÜPageURLQu”y faed fÜ u¾ %s", 
u¾FÜLoggšg
(
·geURL
).
ascii
().
d©a
());

2143 
	gm_£tIcÚIDFÜPageURLS‹m’t
->
»£t
();

2146 
	gIcÚD©aba£
::
»movePageURLFromSQLD©aba£
(cÚ¡ 
SŒšg
& 
·geURL
)

2148 #ifdeà
SSLAB__DEBUG


2149 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

2152 
ASSERT_ICON_SYNC_THREAD
();

2154 
»adySQL™eS‹m’t
(
m_»movePageURLS‹m’t
, 
m_syncDB
, "DELETE FROM PageURL WHERE url = (?);");

2155 
	gm_»movePageURLS‹m’t
->
bšdText
(1, 
·geURL
);

2157 ià(
	gm_»movePageURLS‹m’t
->
¡•
(è!ğ
SQLResuÉDÚe
)

2158 
LOG_ERROR
("»movePageURLFromSQLD©aba£ faed fÜ u¾ %s", 
u¾FÜLoggšg
(
·geURL
).
ascii
().
d©a
());

2160 
	gm_»movePageURLS‹m’t
->
»£t
();

2164 
št64_t
 
	gIcÚD©aba£
::
g‘IcÚIDFÜIcÚURLFromSQLD©aba£
(cÚ¡ 
SŒšg
& 
icÚURL
)

2166 #ifdeà
SSLAB__DEBUG


2167 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

2170 
ASSERT_ICON_SYNC_THREAD
();

2172 
»adySQL™eS‹m’t
(
m_g‘IcÚIDFÜIcÚURLS‹m’t
, 
m_syncDB
, "SELECT IconInfo.iconID FROM IconInfo WHERE IconInfo.url = (?);");

2173 
	gm_g‘IcÚIDFÜIcÚURLS‹m’t
->
bšdText
(1, 
icÚURL
);

2175 
št64_t
 
	g»suÉ
 = 
m_g‘IcÚIDFÜIcÚURLS‹m’t
->
¡•
();

2176 ià(
	g»suÉ
 =ğ
SQLResuÉRow
)

2177 
»suÉ
 = 
m_g‘IcÚIDFÜIcÚURLS‹m’t
->
g‘CŞumnIÁ64
(0);

2179 ià(
	g»suÉ
 !ğ
SQLResuÉDÚe
)

2180 
LOG_ERROR
("g‘IcÚIDFÜIcÚURLFromSQLD©aba£ faed fÜ u¾ %s", 
u¾FÜLoggšg
(
icÚURL
).
ascii
().
d©a
());

2181 
	g»suÉ
 = 0;

2184 
	gm_g‘IcÚIDFÜIcÚURLS‹m’t
->
»£t
();

2185  
	g»suÉ
;

2188 
št64_t
 
	gIcÚD©aba£
::
addIcÚURLToSQLD©aba£
(cÚ¡ 
SŒšg
& 
icÚURL
)

2190 #ifdeà
SSLAB__DEBUG


2191 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

2194 
ASSERT_ICON_SYNC_THREAD
();

2200 
»adySQL™eS‹m’t
(
m_addIcÚToIcÚInfoS‹m’t
, 
m_syncDB
, "INSERT INTO IconInfo (url, stamp) VALUES (?, 0);");

2201 
	gm_addIcÚToIcÚInfoS‹m’t
->
bšdText
(1, 
icÚURL
);

2203 
	g»suÉ
 = 
m_addIcÚToIcÚInfoS‹m’t
->
¡•
();

2204 
	gm_addIcÚToIcÚInfoS‹m’t
->
»£t
();

2205 ià(
	g»suÉ
 !ğ
SQLResuÉDÚe
) {

2206 
LOG_ERROR
("addIcÚURLToSQLD©aba£ faedØš£¹ % štØIcÚInfo", 
u¾FÜLoggšg
(
icÚURL
).
ascii
().
d©a
());

2209 
št64_t
 
	gicÚID
 = 
m_syncDB
.
Ï¡In£¹RowID
();

2211 
»adySQL™eS‹m’t
(
m_addIcÚToIcÚD©aS‹m’t
, 
m_syncDB
, "INSERT INTO IconData (iconID, data) VALUES (?, ?);");

2212 
	gm_addIcÚToIcÚD©aS‹m’t
->
bšdIÁ64
(1, 
icÚID
);

2214 
	g»suÉ
 = 
m_addIcÚToIcÚD©aS‹m’t
->
¡•
();

2215 
	gm_addIcÚToIcÚD©aS‹m’t
->
»£t
();

2216 ià(
	g»suÉ
 !ğ
SQLResuÉDÚe
) {

2217 
LOG_ERROR
("addIcÚURLToSQLD©aba£ faedØš£¹ % štØIcÚD©a", 
u¾FÜLoggšg
(
icÚURL
).
ascii
().
d©a
());

2221  
	gicÚID
;

2224 
	gPassRefPŒ
<
	gSh¬edBufãr
> 
	gIcÚD©aba£
::
g‘ImageD©aFÜIcÚURLFromSQLD©aba£
(cÚ¡ 
SŒšg
& 
icÚURL
)

2226 #ifdeà
SSLAB__DEBUG


2227 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

2230 
ASSERT_ICON_SYNC_THREAD
();

2232 
	gRefPŒ
<
	gSh¬edBufãr
> 
	gimageD©a
;

2234 
»adySQL™eS‹m’t
(
m_g‘ImageD©aFÜIcÚURLS‹m’t
, 
m_syncDB
, "SELECT IconData.data FROM IconData WHERE IconData.iconID IN (SELECT iconID FROM IconInfo WHERE IconInfo.url = (?));");

2235 
	gm_g‘ImageD©aFÜIcÚURLS‹m’t
->
bšdText
(1, 
icÚURL
);

2237 
	g»suÉ
 = 
m_g‘ImageD©aFÜIcÚURLS‹m’t
->
¡•
();

2238 ià(
	g»suÉ
 =ğ
SQLResuÉRow
) {

2239 
VeùÜ
<> 
d©a
;

2240 
	gm_g‘ImageD©aFÜIcÚURLS‹m’t
->
g‘CŞumnBlobAsVeùÜ
(0, 
d©a
);

2241 
	gimageD©a
 = 
Sh¬edBufãr
::
ü—‹
(
d©a
.d©a(), d©a.
size
());

2242 } ià(
	g»suÉ
 !ğ
SQLResuÉDÚe
)

2243 
LOG_ERROR
("g‘ImageD©aFÜIcÚURLFromSQLD©aba£ faed fÜ u¾ %s", 
u¾FÜLoggšg
(
icÚURL
).
ascii
().
d©a
());

2245 
	gm_g‘ImageD©aFÜIcÚURLS‹m’t
->
»£t
();

2247  
	gimageD©a
.
»Ëa£
();

2250 
	gIcÚD©aba£
::
»moveIcÚFromSQLD©aba£
(cÚ¡ 
SŒšg
& 
icÚURL
)

2252 #ifdeà
SSLAB__DEBUG


2253 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

2256 
ASSERT_ICON_SYNC_THREAD
();

2258 ià(
	gicÚURL
.
isEm±y
())

2266 
št64_t
 
	gicÚID
 = 
g‘IcÚIDFÜIcÚURLFromSQLD©aba£
(
icÚURL
);

2267 ià(!
	gicÚID
)

2270 
»adySQL™eS‹m’t
(
m_d–‘ePageURLsFÜIcÚURLS‹m’t
, 
m_syncDB
, "DELETE FROM PageURL WHERE PageURL.iconID = (?);");

2271 
	gm_d–‘ePageURLsFÜIcÚURLS‹m’t
->
bšdIÁ64
(1, 
icÚID
);

2273 ià(
	gm_d–‘ePageURLsFÜIcÚURLS‹m’t
->
¡•
(è!ğ
SQLResuÉDÚe
)

2274 
LOG_ERROR
("m_d–‘ePageURLsFÜIcÚURLS‹m’ˆçed fÜ u¾ %s", 
u¾FÜLoggšg
(
icÚURL
).
ascii
().
d©a
());

2276 
»adySQL™eS‹m’t
(
m_d–‘eIcÚFromIcÚInfoS‹m’t
, 
m_syncDB
, "DELETE FROM IconInfo WHERE IconInfo.iconID = (?);");

2277 
	gm_d–‘eIcÚFromIcÚInfoS‹m’t
->
bšdIÁ64
(1, 
icÚID
);

2279 ià(
	gm_d–‘eIcÚFromIcÚInfoS‹m’t
->
¡•
(è!ğ
SQLResuÉDÚe
)

2280 
LOG_ERROR
("m_d–‘eIcÚFromIcÚInfoS‹m’ˆçed fÜ u¾ %s", 
u¾FÜLoggšg
(
icÚURL
).
ascii
().
d©a
());

2282 
»adySQL™eS‹m’t
(
m_d–‘eIcÚFromIcÚD©aS‹m’t
, 
m_syncDB
, "DELETE FROM IconData WHERE IconData.iconID = (?);");

2283 
	gm_d–‘eIcÚFromIcÚD©aS‹m’t
->
bšdIÁ64
(1, 
icÚID
);

2285 ià(
	gm_d–‘eIcÚFromIcÚD©aS‹m’t
->
¡•
(è!ğ
SQLResuÉDÚe
)

2286 
LOG_ERROR
("m_d–‘eIcÚFromIcÚD©aS‹m’ˆçed fÜ u¾ %s", 
u¾FÜLoggšg
(
icÚURL
).
ascii
().
d©a
());

2288 
	gm_d–‘ePageURLsFÜIcÚURLS‹m’t
->
»£t
();

2289 
	gm_d–‘eIcÚFromIcÚInfoS‹m’t
->
»£t
();

2290 
	gm_d–‘eIcÚFromIcÚD©aS‹m’t
->
»£t
();

2293 
	gIcÚD©aba£
::
wr™eIcÚSÇpshÙToSQLD©aba£
(cÚ¡ 
IcÚSÇpshÙ
& 
¢­shÙ
)

2295 #ifdeà
SSLAB__DEBUG


2296 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

2299 
ASSERT_ICON_SYNC_THREAD
();

2301 ià(
	g¢­shÙ
.
	gicÚURL
.
isEm±y
())

2305 ià(!
	g¢­shÙ
.
	gtime¡amp
 && !¢­shÙ.
	gd©a
) {

2306 
LOG
(
IcÚD©aba£
, "Removšg % äom on-disk d©aba£", 
u¾FÜLoggšg
(
¢­shÙ
.
icÚURL
).
ascii
().
d©a
());

2307 
»moveIcÚFromSQLD©aba£
(
¢­shÙ
.
icÚURL
);

2315 
št64_t
 
	gicÚID
 = 
g‘IcÚIDFÜIcÚURLFromSQLD©aba£
(
¢­shÙ
.
icÚURL
);

2319 ià(
	gicÚID
) {

2320 
»adySQL™eS‹m’t
(
m_upd©eIcÚInfoS‹m’t
, 
m_syncDB
, "UPDATE IconInfo SET stamp = ?, url = ? WHERE iconID = ?;");

2321 
	gm_upd©eIcÚInfoS‹m’t
->
bšdIÁ64
(1, 
¢­shÙ
.
time¡amp
);

2322 
	gm_upd©eIcÚInfoS‹m’t
->
bšdText
(2, 
¢­shÙ
.
icÚURL
);

2323 
	gm_upd©eIcÚInfoS‹m’t
->
bšdIÁ64
(3, 
icÚID
);

2325 ià(
	gm_upd©eIcÚInfoS‹m’t
->
¡•
(è!ğ
SQLResuÉDÚe
)

2326 
LOG_ERROR
("FaedØupd©icÚ infØfÜ u¾ %s", 
u¾FÜLoggšg
(
¢­shÙ
.
icÚURL
).
ascii
().
d©a
());

2328 
	gm_upd©eIcÚInfoS‹m’t
->
»£t
();

2330 
»adySQL™eS‹m’t
(
m_upd©eIcÚD©aS‹m’t
, 
m_syncDB
, "UPDATE IconData SET data = ? WHERE iconID = ?;");

2331 
	gm_upd©eIcÚD©aS‹m’t
->
bšdIÁ64
(2, 
icÚID
);

2335 ià(
	g¢­shÙ
.
	gd©a
 && sÇpshÙ.d©a->
size
())

2336 
	gm_upd©eIcÚD©aS‹m’t
->
bšdBlob
(1, 
¢­shÙ
.
d©a
->d©a(), sÇpshÙ.d©a->
size
());

2338 
	gm_upd©eIcÚD©aS‹m’t
->
bšdNuÎ
(1);

2340 ià(
	gm_upd©eIcÚD©aS‹m’t
->
¡•
(è!ğ
SQLResuÉDÚe
)

2341 
LOG_ERROR
("FaedØupd©icÚ d©¨fÜ u¾ %s", 
u¾FÜLoggšg
(
¢­shÙ
.
icÚURL
).
ascii
().
d©a
());

2343 
	gm_upd©eIcÚD©aS‹m’t
->
»£t
();

2345 
»adySQL™eS‹m’t
(
m_£tIcÚInfoS‹m’t
, 
m_syncDB
, "INSERT INTO IconInfo (url,stamp) VALUES (?, ?);");

2346 
	gm_£tIcÚInfoS‹m’t
->
bšdText
(1, 
¢­shÙ
.
icÚURL
);

2347 
	gm_£tIcÚInfoS‹m’t
->
bšdIÁ64
(2, 
¢­shÙ
.
time¡amp
);

2349 ià(
	gm_£tIcÚInfoS‹m’t
->
¡•
(è!ğ
SQLResuÉDÚe
)

2350 
LOG_ERROR
("FaedØ£ˆicÚ infØfÜ u¾ %s", 
u¾FÜLoggšg
(
¢­shÙ
.
icÚURL
).
ascii
().
d©a
());

2352 
	gm_£tIcÚInfoS‹m’t
->
»£t
();

2354 
št64_t
 
	gicÚID
 = 
m_syncDB
.
Ï¡In£¹RowID
();

2356 
»adySQL™eS‹m’t
(
m_£tIcÚD©aS‹m’t
, 
m_syncDB
, "INSERT INTO IconData (iconID, data) VALUES (?, ?);");

2357 
	gm_£tIcÚD©aS‹m’t
->
bšdIÁ64
(1, 
icÚID
);

2361 ià(
	g¢­shÙ
.
	gd©a
 && sÇpshÙ.d©a->
size
())

2362 
	gm_£tIcÚD©aS‹m’t
->
bšdBlob
(2, 
¢­shÙ
.
d©a
->d©a(), sÇpshÙ.d©a->
size
());

2364 
	gm_£tIcÚD©aS‹m’t
->
bšdNuÎ
(2);

2366 ià(
	gm_£tIcÚD©aS‹m’t
->
¡•
(è!ğ
SQLResuÉDÚe
)

2367 
LOG_ERROR
("FaedØ£ˆicÚ d©¨fÜ u¾ %s", 
u¾FÜLoggšg
(
¢­shÙ
.
icÚURL
).
ascii
().
d©a
());

2369 
	gm_£tIcÚD©aS‹m’t
->
»£t
();

	@icon/IconDatabase.h

27 #iâdeà
IcÚD©aba£_h


28 
	#IcÚD©aba£_h


	)

30 
	~"SŒšgHash.h
"

31 
	~"Tim”.h
"

32 
	~<wtf/HashM­.h
>

33 
	~<wtf/HashS‘.h
>

34 
	~<wtf/NÚcİyabË.h
>

35 
	~<wtf/OwnPŒ.h
>

37 #ià
ENABLE
(
ICONDATABASE
)

38 
	~"SQL™eD©aba£.h
"

39 
	~<wtf/Th»adšg.h
>

42 
Çme¥aû
 
	gWebCÜe
 {

44 
şass
 
	gDocum’tLßd”
;

45 
şass
 
	gImage
;

46 
şass
 
	gIÁSize
;

47 
şass
 
	gIcÚD©aba£Cl›Á
;

48 
şass
 
	gIcÚRecÜd
;

49 
şass
 
	gIcÚSÇpshÙ
;

50 
şass
 
	gKURL
;

51 
şass
 
	gPageURLRecÜd
;

52 
şass
 
	gPageURLSÇpshÙ
;

53 
şass
 
	gSh¬edBufãr
;

55 #ià
ENABLE
(
ICONDATABASE
)

56 
şass
 
	gSQLT¿n§ùiÚ
;

59 
	eIcÚLßdDecisiÚ
 {

60 
	gIcÚLßdYes
,

61 
	gIcÚLßdNo
,

62 
	gIcÚLßdUnknown


65 şas 
	cIcÚD©aba£
 : 
public
 
NÚcİyabË
 {

68 
public
:

69 
£tCl›Á
(
IcÚD©aba£Cl›Á
*);

71 
boŞ
 
İ’
(cÚ¡ 
SŒšg
& 
·th
);

72 
şo£
();

74 
»moveAÎIcÚs
();

76 
Image
* 
icÚFÜPageURL
(cÚ¡ 
SŒšg
&, cÚ¡ 
IÁSize
&);

77 
»adIcÚFÜPageURLFromDisk
(cÚ¡ 
SŒšg
&);

78 
SŒšg
 
icÚURLFÜPageURL
(const String&);

79 
Image
* 
deçuÉIcÚ
(cÚ¡ 
IÁSize
&);

81 
»šIcÚFÜPageURL
(cÚ¡ 
SŒšg
&);

82 
»Ëa£IcÚFÜPageURL
(cÚ¡ 
SŒšg
&);

84 
£tIcÚD©aFÜIcÚURL
(
PassRefPŒ
<
Sh¬edBufãr
> 
d©a
, cÚ¡ 
SŒšg
&);

85 
£tIcÚURLFÜPageURL
(cÚ¡ 
SŒšg
& 
icÚURL
, cÚ¡ SŒšg& 
·geURL
);

87 
IcÚLßdDecisiÚ
 
lßdDecisiÚFÜIcÚURL
(cÚ¡ 
SŒšg
&, 
Docum’tLßd”
*);

88 
boŞ
 
icÚD©aKnownFÜIcÚURL
(cÚ¡ 
SŒšg
&);

90 
£tEÇbËd
(
boŞ
 
’abËd
);

91 
boŞ
 
isEÇbËd
() const;

93 
£tPriv©eBrowsšgEÇbËd
(
boŞ
 
æag
);

94 
boŞ
 
isPriv©eBrowsšgEÇbËd
() const;

96 
d–ayD©aba£CËªup
();

97 
®lowD©aba£CËªup
();

98 
checkIÁegr™yBefÜeO³nšg
();

101 
size_t
 
·geURLM­pšgCouÁ
();

102 
size_t
 
»šedPageURLCouÁ
();

103 
size_t
 
icÚRecÜdCouÁ
();

104 
size_t
 
icÚRecÜdCouÁW™hD©a
();

106 
	g´iv©e
:

107 
IcÚD©aba£
();

108 ~
IcÚD©aba£
();

109 
ä›nd
 
IcÚD©aba£
* 
icÚD©aba£
();

111 #ià
ENABLE
(
ICONDATABASE
)

112 
nÙifyP’dšgLßdDecisiÚsOnMašTh»ad
(*);

113 
nÙifyP’dšgLßdDecisiÚs
();

115 
wakeSyncTh»ad
();

116 
scheduËOrDeãrSyncTim”
();

117 
syncTim”Fœed
(
Tim”
<
IcÚD©aba£
>*);

119 
	gTim”
<
	gIcÚD©aba£
> 
	gm_syncTim”
;

120 
Th»adId’tif›r
 
	gm_syncTh»ad
;

121 
boŞ
 
	gm_syncTh»adRuÂšg
;

123 
	gHashS‘
<
	gRefPŒ
<
	gDocum’tLßd”
> > 
	gm_lßd”sP’dšgDecisiÚ
;

125 
	gRefPŒ
<
	gIcÚRecÜd
> 
	gm_deçuÉIcÚRecÜd
;

129 
	gpublic
:

130 
boŞ
 
isO³n
() const;

131 
SŒšg
 
d©aba£P©h
() const;

132 
SŒšg
 
deçuÉD©aba£F’ame
();

134 #ià
ENABLE
(
ICONDATABASE
)

135 
	g´iv©e
:

136 
PassRefPŒ
<
IcÚRecÜd
> 
g‘OrC»©eIcÚRecÜd
(cÚ¡ 
SŒšg
& 
icÚURL
);

137 
PageURLRecÜd
* 
g‘OrC»©ePageURLRecÜd
(cÚ¡ 
SŒšg
& 
·geURL
);

139 
boŞ
 
	gm_isEÇbËd
;

140 
boŞ
 
	gm_´iv©eBrowsšgEÇbËd
;

142 
mubË
 
Mu‹x
 
	gm_syncLock
;

143 
Th»adCÚd™iÚ
 
	gm_syncCÚd™iÚ
;

144 
SŒšg
 
	gm_d©aba£DœeùÜy
;

146 
SŒšg
 
	gm_com¶‘eD©aba£P©h
;

148 
boŞ
 
	gm_th»adT”mš©iÚReque¡ed
;

149 
boŞ
 
	gm_»moveIcÚsReque¡ed
;

150 
boŞ
 
	gm_icÚURLImpÜtCom¶‘e
;

152 
Mu‹x
 
	gm_u¾AndIcÚLock
;

154 
	gHashM­
<
	gSŒšg
, 
	gIcÚRecÜd
*> 
	gm_icÚURLToRecÜdM­
;

155 
	gHashM­
<
	gSŒšg
, 
	gPageURLRecÜd
*> 
	gm_·geURLToRecÜdM­
;

156 
	gHashS‘
<
	gSŒšg
> 
	gm_»šedPageURLs
;

158 
Mu‹x
 
	gm_³ndšgSyncLock
;

160 
	gHashM­
<
	gSŒšg
, 
	gPageURLSÇpshÙ
> 
	gm_·geURLsP’dšgSync
;

161 
	gHashM­
<
	gSŒšg
, 
	gIcÚSÇpshÙ
> 
	gm_icÚsP’dšgSync
;

163 
Mu‹x
 
	gm_³ndšgR—dšgLock
;

165 
	gHashS‘
<
	gSŒšg
> 
	gm_·geURLsP’dšgImpÜt
;

166 
	gHashS‘
<
	gSŒšg
> 
	gm_·geURLsIÁ”e¡edInIcÚs
;

167 
	gHashS‘
<
	gIcÚRecÜd
*> 
	gm_icÚsP’dšgR—dšg
;

171 
	gpublic
:

173 
impÜtIcÚURLFÜPageURL
(cÚ¡ 
SŒšg
& 
icÚURL
, cÚ¡ SŒšg& 
·geURL
);

174 
impÜtIcÚD©aFÜIcÚURL
(
PassRefPŒ
<
Sh¬edBufãr
> 
d©a
, cÚ¡ 
SŒšg
& 
icÚURL
);

176 
boŞ
 
shouldStİTh»adAùiv™y
() const;

178 #ià
ENABLE
(
ICONDATABASE
)

179 
	g´iv©e
:

180 * 
icÚD©aba£SyncTh»adS¹
(*);

181 * 
icÚD©aba£SyncTh»ad
();

185 
³rfÜmO³nIn™Ÿliz©iÚ
();

186 
boŞ
 
checkIÁegr™y
();

187 
³rfÜmURLImpÜt
();

188 * 
syncTh»adMašLoİ
();

189 
boŞ
 
»adFromD©aba£
();

190 
boŞ
 
wr™eToD©aba£
();

191 
´uÃUÄ‘ašedIcÚs
();

192 
checkFÜDªglšgPageURLs
(
boŞ
 
´uÃIfFound
);

193 
»moveAÎIcÚsOnTh»ad
();

194 
d–‘eAÎP»·»dS‹m’ts
();

195 * 
ş—nupSyncTh»ad
();

198 
boŞ
 
impÜ‹d
();

199 
£tImpÜ‹d
(
boŞ
);

201 
boŞ
 
	gm_š™ŸlPrunšgCom¶‘e
;

203 
£tIcÚURLFÜPageURLInSQLD©aba£
(cÚ¡ 
SŒšg
&, const String&);

204 
£tIcÚIDFÜPageURLInSQLD©aba£
(
št64_t
, cÚ¡ 
SŒšg
&);

205 
»movePageURLFromSQLD©aba£
(cÚ¡ 
SŒšg
& 
·geURL
);

206 
št64_t
 
g‘IcÚIDFÜIcÚURLFromSQLD©aba£
(cÚ¡ 
SŒšg
& 
icÚURL
);

207 
št64_t
 
addIcÚURLToSQLD©aba£
(cÚ¡ 
SŒšg
&);

208 
	gPassRefPŒ
<
	gSh¬edBufãr
> 
g‘ImageD©aFÜIcÚURLFromSQLD©aba£
(cÚ¡ 
SŒšg
& 
icÚURL
);

209 
»moveIcÚFromSQLD©aba£
(cÚ¡ 
SŒšg
& 
icÚURL
);

210 
wr™eIcÚSÇpshÙToSQLD©aba£
(cÚ¡ 
IcÚSÇpshÙ
&);

213 
IcÚD©aba£Cl›Á
* 
	gm_ş›Á
;

215 
SQL™eD©aba£
 
	gm_syncDB
;

218 
boŞ
 
	gm_impÜ‹d
;

219 
boŞ
 
	gm_isImpÜ‹dS‘
;

221 
	gOwnPŒ
<
	gSQL™eS‹m’t
> 
	gm_£tIcÚIDFÜPageURLS‹m’t
;

222 
	gOwnPŒ
<
	gSQL™eS‹m’t
> 
	gm_»movePageURLS‹m’t
;

223 
	gOwnPŒ
<
	gSQL™eS‹m’t
> 
	gm_g‘IcÚIDFÜIcÚURLS‹m’t
;

224 
	gOwnPŒ
<
	gSQL™eS‹m’t
> 
	gm_g‘ImageD©aFÜIcÚURLS‹m’t
;

225 
	gOwnPŒ
<
	gSQL™eS‹m’t
> 
	gm_addIcÚToIcÚInfoS‹m’t
;

226 
	gOwnPŒ
<
	gSQL™eS‹m’t
> 
	gm_addIcÚToIcÚD©aS‹m’t
;

227 
	gOwnPŒ
<
	gSQL™eS‹m’t
> 
	gm_g‘ImageD©aS‹m’t
;

228 
	gOwnPŒ
<
	gSQL™eS‹m’t
> 
	gm_d–‘ePageURLsFÜIcÚURLS‹m’t
;

229 
	gOwnPŒ
<
	gSQL™eS‹m’t
> 
	gm_d–‘eIcÚFromIcÚInfoS‹m’t
;

230 
	gOwnPŒ
<
	gSQL™eS‹m’t
> 
	gm_d–‘eIcÚFromIcÚD©aS‹m’t
;

231 
	gOwnPŒ
<
	gSQL™eS‹m’t
> 
	gm_upd©eIcÚInfoS‹m’t
;

232 
	gOwnPŒ
<
	gSQL™eS‹m’t
> 
	gm_upd©eIcÚD©aS‹m’t
;

233 
	gOwnPŒ
<
	gSQL™eS‹m’t
> 
	gm_£tIcÚInfoS‹m’t
;

234 
	gOwnPŒ
<
	gSQL™eS‹m’t
> 
	gm_£tIcÚD©aS‹m’t
;

239 
IcÚD©aba£
* 
icÚD©aba£
();

	@icon/IconDatabaseClient.h

29 #iâdeà
IcÚD©aba£Cl›Á_h


30 
	#IcÚD©aba£Cl›Á_h


	)

32 
	~<wtf/NÚcİyabË.h
>

37 
Çme¥aû
 
	gWebCÜe
 {

39 
şass
 
	gSŒšg
;

41 şas 
	cIcÚD©aba£Cl›Á
 : 
public
 
NÚcİyabË
 {

42 
public
:

43 
vœtu®
 ~
IcÚD©aba£Cl›Á
() { }

44 
vœtu®
 
boŞ
 
³rfÜmImpÜt
(è{  
Œue
; }

45 
vœtu®
 
di¥©chDidRemoveAÎIcÚs
() { }

46 
vœtu®
 
di¥©chDidAddIcÚFÜPageURL
(cÚ¡ 
SŒšg
& ) { }

	@icon/IconDatabaseNone.cpp

2 #ifdeà
SSLAB__DEBUG


3 #iâdeà
SSLAB__QDATETIME


4 
	#SSLAB__QDATETIME


	)

5 
	~<QD©eTime
>

9 #ifdeà
SSLAB__DEBUG


10 #iâdeà
SSLAB__QTHREAD


11 
	#SSLAB__QTHREAD


	)

12 
	~<QTh»ad
>

40 
	~"cÚfig.h
"

41 
	~"IcÚD©aba£.h
"

43 #ià!
ENABLE
(
ICONDATABASE
)

45 
	~"PÏtfÜmSŒšg.h
"

46 
	~"Sh¬edBufãr.h
"

47 
	~<wtf/StdLibExŒas.h
>

49 
Çme¥aû
 
	gWebCÜe
 {

51 
IcÚD©aba£
* 
	gsh¬edIcÚD©aba£
 = 0;

58 cÚ¡ 
	gcu¼’tD©aba£V”siÚ
 = 5;

61 cÚ¡ 
	gicÚExpœ©iÚTime
 = 60*60*24;

63 cÚ¡ 
	gmissšgIcÚExpœ©iÚTime
 = 60*60*24*7;

65 cÚ¡ 
	gupd©eTim”D–ay
 = 5;

67 
SŒšg
 
	gIcÚD©aba£
::
deçuÉD©aba£F’ame
()

69 #ifdeà
SSLAB__DEBUG


70 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

73 
DEFINE_STATIC_LOCAL
(
SŒšg
, 
deçuÉD©aba£F’ame
, ("Icons.db"));

74  
	gdeçuÉD©aba£F’ame
.
th»ad§ãCİy
();

77 
IcÚD©aba£
* 
icÚD©aba£
()

79 #ifdeà
SSLAB__DEBUG


80 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

83 ià(!
	gsh¬edIcÚD©aba£
)

84 
	gsh¬edIcÚD©aba£
 = 
Ãw
 
IcÚD©aba£
;

85  
	gsh¬edIcÚD©aba£
;

88 
	gIcÚD©aba£
::
IcÚD©aba£
()

90 #ifdeà
SSLAB__DEBUG


91 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

96 
boŞ
 
	gIcÚD©aba£
::
İ’
(cÚ¡ 
SŒšg
& )

98  
çl£
;

101 
boŞ
 
	gIcÚD©aba£
::
isO³n
() const

103 #ifdeà
SSLAB__DEBUG


104 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

107  
	gçl£
;

110 
	gIcÚD©aba£
::
şo£
()

112 #ifdeà
SSLAB__DEBUG


113 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

118 
SŒšg
 
	gIcÚD©aba£
::
d©aba£P©h
() const

120 #ifdeà
SSLAB__DEBUG


121 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

124  
SŒšg
();

127 
	gIcÚD©aba£
::
»moveAÎIcÚs
()

129 #ifdeà
SSLAB__DEBUG


130 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

135 
	gIcÚD©aba£
::
£tPriv©eBrowsšgEÇbËd
(
boŞ
 )

139 
boŞ
 
IcÚD©aba£
::
isPriv©eBrowsšgEÇbËd
() const

141 #ifdeà
SSLAB__DEBUG


142 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

145  
	gçl£
;

148 
	gIcÚD©aba£
::
»adIcÚFÜPageURLFromDisk
(cÚ¡ 
SŒšg
&)

150 #ifdeà
SSLAB__DEBUG


151 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

157 
Image
* 
	gIcÚD©aba£
::
icÚFÜPageURL
(cÚ¡ 
SŒšg
& , cÚ¡ 
IÁSize
& 
size
)

159  
deçuÉIcÚ
(
size
);

163 
IcÚLßdDecisiÚ
 
	gIcÚD©aba£
::
lßdDecisiÚFÜIcÚURL
(cÚ¡ 
SŒšg
&, 
Docum’tLßd”
*)

165 #ifdeà
SSLAB__DEBUG


166 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

169  
	gIcÚLßdNo
;

172 
boŞ
 
	gIcÚD©aba£
::
icÚD©aKnownFÜIcÚURL
(cÚ¡ 
SŒšg
&)

174 #ifdeà
SSLAB__DEBUG


175 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

178  
	gçl£
;

181 
SŒšg
 
	gIcÚD©aba£
::
icÚURLFÜPageURL
(const String& )

183  
SŒšg
();

186 
Image
* 
	gIcÚD©aba£
::
deçuÉIcÚ
(cÚ¡ 
IÁSize
& )

191 
	gIcÚD©aba£
::
»šIcÚFÜPageURL
(cÚ¡ 
SŒšg
& )

195 
IcÚD©aba£
::
»Ëa£IcÚFÜPageURL
(cÚ¡ 
SŒšg
& )

199 
IcÚD©aba£
::
£tIcÚD©aFÜIcÚURL
(
PassRefPŒ
<
Sh¬edBufãr
> , cÚ¡ 
SŒšg
& )

203 
	gIcÚD©aba£
::
£tIcÚURLFÜPageURL
(cÚ¡ 
SŒšg
& , const String& )

207 
	gIcÚD©aba£
::
£tEÇbËd
(
boŞ
 )

211 
boŞ
 
IcÚD©aba£
::
isEÇbËd
() const

213 #ifdeà
SSLAB__DEBUG


214 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

217  
	gçl£
;

220 
	gIcÚD©aba£
::~
IcÚD©aba£
()

222 #ifdeà
SSLAB__DEBUG


223 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

226 
ASSERT_NOT_REACHED
();

229 
	gIcÚD©aba£
::
checkIÁegr™yBefÜeO³nšg
()

231 #ifdeà
SSLAB__DEBUG


232 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

237 
	gIcÚD©aba£
::
d–ayD©aba£CËªup
()

239 #ifdeà
SSLAB__DEBUG


240 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

245 
	gIcÚD©aba£
::
®lowD©aba£CËªup
()

247 #ifdeà
SSLAB__DEBUG


248 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

253 
size_t
 
	gIcÚD©aba£
::
·geURLM­pšgCouÁ
()

255 #ifdeà
SSLAB__DEBUG


256 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

262 
size_t
 
	gIcÚD©aba£
::
»šedPageURLCouÁ
()

264 #ifdeà
SSLAB__DEBUG


265 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

271 
size_t
 
	gIcÚD©aba£
::
icÚRecÜdCouÁ
()

273 #ifdeà
SSLAB__DEBUG


274 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

280 
size_t
 
	gIcÚD©aba£
::
icÚRecÜdCouÁW™hD©a
()

282 #ifdeà
SSLAB__DEBUG


283 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

289 
	gIcÚD©aba£
::
£tCl›Á
(
IcÚD©aba£Cl›Á
*)

291 #ifdeà
SSLAB__DEBUG


292 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

301 
	gIcÚD©aba£
::
impÜtIcÚURLFÜPageURL
(cÚ¡ 
SŒšg
&, const String&)

303 #ifdeà
SSLAB__DEBUG


304 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

309 
	gIcÚD©aba£
::
impÜtIcÚD©aFÜIcÚURL
(
PassRefPŒ
<
Sh¬edBufãr
>, cÚ¡ 
SŒšg
&)

311 #ifdeà
SSLAB__DEBUG


312 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

317 
boŞ
 
	gIcÚD©aba£
::
shouldStİTh»adAùiv™y
() const

319 #ifdeà
SSLAB__DEBUG


320 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

323  
	gŒue
;

	@icon/IconFetcher.cpp

2 #ifdeà
SSLAB__DEBUG


3 #iâdeà
SSLAB__QDATETIME


4 
	#SSLAB__QDATETIME


	)

5 
	~<QD©eTime
>

9 #ifdeà
SSLAB__DEBUG


10 #iâdeà
SSLAB__QTHREAD


11 
	#SSLAB__QTHREAD


	)

12 
	~<QTh»ad
>

40 
	~"cÚfig.h
"

41 
	~"IcÚF‘ch”.h
"

43 
	~"F¿me.h
"

44 
	~"HTMLH—dEËm’t.h
"

45 
	~"HTMLLškEËm’t.h
"

46 
	~"HTMLNames.h
"

47 
	~"ResourûHªdË.h
"

48 
	~"ResourûReque¡.h
"

49 
	~"Sh¬edBufãr.h
"

51 
Çme¥aû
 
	gWebCÜe
 {

53 
usšg
 
Çme¥aû
 
	gHTMLNames
;

55 
	sIcÚLškEÁry
 {

56 
	gpublic
:

57 
	eIcÚTy³
 {

58 
Unknown
,

59 
	gICNS
,

60 
	gICO
,

63 
IcÚLškEÁry
(
IcÚTy³
 
ty³
, cÚ¡ 
KURL
& 
u¾
)

64 : 
m_ty³
(
ty³
)

65 , 
m_u¾
(
u¾
)

69 
IcÚTy³
 
ty³
(ècÚ¡ {  
	gm_ty³
; }

70 cÚ¡ 
	gKURL
& 
u¾
(ècÚ¡ {  
	gm_u¾
; }

72 
Sh¬edBufãr
* 
bufãr
()

74 ià(!
	gm_bufãr
)

75 
	gm_bufãr
 = 
Sh¬edBufãr
::
ü—‹
();

77  
	gm_bufãr
.
g‘
();

80 
	g´iv©e
:

81 
RefPŒ
<
Sh¬edBufãr
> 
m_bufãr
;

82 
IcÚTy³
 
	gm_ty³
;

83 
KURL
 
	gm_u¾
;

86 #ià
PLATFORM
(
MAC
)

87 cÚ¡ 
	gIcÚLškEÁry
::
IcÚTy³
 
N©iveIcÚTy³
 = 
IcÚLškEÁry
::
ICNS
;

88 #–ià
PLATFORM
(
WIN
)

89 cÚ¡ 
	gIcÚLškEÁry
::
IcÚTy³
 
N©iveIcÚTy³
 = 
IcÚLškEÁry
::
ICO
;

91 cÚ¡ 
	gIcÚLškEÁry
::
IcÚTy³
 
N©iveIcÚTy³
 = 
IcÚLškEÁry
::
Unknown
;

94 
·r£IcÚLšk
(
HTMLLškEËm’t
* 
lšk
, 
VeùÜ
<
IcÚLškEÁry
>& 
’Œ›s
)

96 #ifdeà
SSLAB__DEBUG


97 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

102 
	gIcÚLškEÁry
::
IcÚTy³
 
ty³
 = 
IcÚLškEÁry
::
Unknown
;

103 cÚ¡ 
	gKURL
& 
	gu¾
 = 
lšk
->
h»f
();

106 
SŒšg
 
	g·th
 = 
u¾
.
·th
();

108 
	gpos
 = 
·th
.
»v”£Fšd
('.');

109 ià(
	gpos
 >= 0) {

110 
SŒšg
 
ex‹nsiÚ
 = 
·th
.
sub¡ršg
(
pos
 + 1);

111 ià(
equ®IgnÜšgCa£
(
ex‹nsiÚ
, "icns"))

112 
	gty³
 = 
IcÚLškEÁry
::
ICNS
;

113 ià(
equ®IgnÜšgCa£
(
ex‹nsiÚ
, "ico"))

114 
	gty³
 = 
IcÚLškEÁry
::
ICO
;

117 
	g’Œ›s
.
­³nd
(
IcÚLškEÁry
(
ty³
, 
u¾
));

120 
	gPassRefPŒ
<
	gIcÚF‘ch”
> IcÚF‘ch”::
ü—‹
(
F¿me
* 
äame
, 
IcÚF‘ch”Cl›Á
* 
ş›Á
)

122 #ifdeà
SSLAB__DEBUG


123 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

126 
Docum’t
* 
	gdocum’t
 = 
äame
->
docum’t
();

128 
HTMLH—dEËm’t
* 
	gh—d
 = 
docum’t
->
h—d
();

129 ià(!
	gh—d
)

132 
	gVeùÜ
<
	gIcÚLškEÁry
> 
	g’Œ›s
;

134 
Node
* 
	gn
 = 
h—d
;‚;‚ = 
n
->
Œav”£NextNode
()) {

135 ià(!
n
->
hasTagName
(
lškTag
))

138 
HTMLLškEËm’t
* 
	glšk
 = 
¡©ic_ÿ¡
<HTMLLškEËm’t*>(
n
);

139 ià(!
	glšk
->
isIcÚ
())

142 
·r£IcÚLšk
(
lšk
, 
’Œ›s
);

145 ià(
	g’Œ›s
.
isEm±y
())

152 
	gi
 = 0; i < 
	g’Œ›s
.
size
(); i++) {

153 cÚ¡ 
	gIcÚLškEÁry
& 
	g’Œy
 = 
’Œ›s
[
i
];

154 ià(
	g’Œy
.
ty³
(è=ğ
N©iveIcÚTy³
) {

155 
RefPŒ
<
IcÚF‘ch”
> 
icÚF‘ch”
 = 
adİtRef
(
Ãw
 IcÚF‘ch”(
äame
, 
ş›Á
));

157 
	gicÚF‘ch”
->
	gm_’Œ›s
.
­³nd
(
’Œy
);

158 
	gicÚF‘ch”
->
lßdEÁry
();

160  
	gicÚF‘ch”
.
»Ëa£
();

167 
	gIcÚF‘ch”
::
IcÚF‘ch”
(
F¿me
* 
äame
, 
IcÚF‘ch”Cl›Á
* 
ş›Á
)

168 : 
m_äame
(
äame
)

169 , 
m_ş›Á
(
ş›Á
)

170 , 
m_cu¼’tEÁry
(0)

172 #ifdeà
SSLAB__DEBUG


173 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

178 
	gIcÚF‘ch”
::~
IcÚF‘ch”
()

180 #ifdeà
SSLAB__DEBUG


181 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

184 
ÿnûl
();

187 
	gIcÚF‘ch”
::
ÿnûl
()

189 #ifdeà
SSLAB__DEBUG


190 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

193 ià(
	gm_hªdË
)

194 
	gm_hªdË
->
ÿnûl
();

197 
	gPassRefPŒ
<
	gSh¬edBufãr
> 
	gIcÚF‘ch”
::
ü—‹IcÚ
()

199 #ifdeà
SSLAB__DEBUG


200 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

203 
ASSERT
(!
m_’Œ›s
.
isEm±y
());

206  
	gm_’Œ›s
.
fœ¡
().
bufãr
();

209 
	gIcÚF‘ch”
::
lßdEÁry
()

211 #ifdeà
SSLAB__DEBUG


212 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

215 
ASSERT
(
m_cu¼’tEÁry
 < 
m_’Œ›s
.
size
());

216 
ASSERT
(!
m_hªdË
);

218 
	gm_hªdË
 = 
ResourûHªdË
::
ü—‹
(
m_’Œ›s
[
m_cu¼’tEÁry
].
u¾
(), 
this
, 
m_äame
, 
çl£
, false);

221 
	gIcÚF‘ch”
::
lßdFaed
()

223 #ifdeà
SSLAB__DEBUG


224 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

227 
	gm_hªdË
 = 0;

229 
	gm_ş›Á
->
fšishedF‘chšgIcÚ
(0);

232 
	gIcÚF‘ch”
::
didReûiveRe¥Ú£
(
ResourûHªdË
* 
hªdË
, cÚ¡ 
ResourûRe¥Ú£
& 
»¥Ú£
)

234 #ifdeà
SSLAB__DEBUG


235 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

238 
ASSERT_UNUSED
(
hªdË
, 
m_hªdË
 == handle);

240 
	g¡©usCode
 = 
»¥Ú£
.
h‰pStusCode
() / 100;

241 ià(
	g¡©usCode
 =ğ4 || 
¡©usCode
 == 5) {

242 
lßdFaed
();

247 
	gIcÚF‘ch”
::
didReûiveD©a
(
ResourûHªdË
* 
hªdË
, cÚ¡ * 
d©a
, 
Ëngth
, )

249 #ifdeà
SSLAB__DEBUG


250 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

253 
ASSERT_UNUSED
(
hªdË
, 
m_hªdË
 == handle);

255 
	gm_’Œ›s
[
m_cu¼’tEÁry
].
bufãr
()->
­³nd
(
d©a
, 
Ëngth
);

258 
	gIcÚF‘ch”
::
didFšishLßdšg
(
ResourûHªdË
* 
hªdË
)

260 #ifdeà
SSLAB__DEBUG


261 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

264 
ASSERT_UNUSED
(
hªdË
, 
m_hªdË
 == handle);

266 ià(
	gm_cu¼’tEÁry
 =ğ
m_’Œ›s
.
size
() - 1) {

268 
RefPŒ
<
Sh¬edBufãr
> 
icÚD©a
 = 
ü—‹IcÚ
();

270 
	gm_ş›Á
->
fšishedF‘chšgIcÚ
(
icÚD©a
.
»Ëa£
());

275 
	gm_cu¼’tEÁry
++;

277 
lßdEÁry
();

280 
	gIcÚF‘ch”
::
didFa
(
ResourûHªdË
* 
hªdË
, cÚ¡ 
ResourûE¼Ü
&)

282 #ifdeà
SSLAB__DEBUG


283 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

286 
ASSERT_UNUSED
(
hªdË
, 
m_hªdË
 == handle);

288 
lßdFaed
();

	@icon/IconFetcher.h

26 #iâdeà
IcÚF‘ch”_h


27 
	#IcÚF‘ch”_h


	)

29 
	~<wtf/RefCouÁed.h
>

30 
	~<wtf/FÜw¬d.h
>

31 
	~<wtf/VeùÜ.h
>

33 
	~"ResourûHªdËCl›Á.h
"

35 
Çme¥aû
 
	gWebCÜe
 {

37 
şass
 
	gF¿me
;

38 
	gIcÚLškEÁry
;

39 
şass
 
	gResourûHªdË
;

40 
şass
 
	gSh¬edBufãr
;

42 şas 
	cIcÚF‘ch”Cl›Á
 {

43 
	gpublic
:

44 
vœtu®
 
fšishedF‘chšgIcÚ
(
PassRefPŒ
<
Sh¬edBufãr
> 
icÚD©a
) = 0;

46 
	gvœtu®
 ~
IcÚF‘ch”Cl›Á
() { }

49 
şass
 
	gIcÚF‘ch”
 : 
public
 
RefCouÁed
<
IcÚF‘ch”
>, 
	gResourûHªdËCl›Á
 {

50 
	gpublic
:

51 
PassRefPŒ
<
IcÚF‘ch”
> 
ü—‹
(
F¿me
*, 
IcÚF‘ch”Cl›Á
*);

52 ~
IcÚF‘ch”
();

54 
ÿnûl
();

56 
	g´iv©e
:

57 
IcÚF‘ch”
(
F¿me
*, 
IcÚF‘ch”Cl›Á
*);

58 
lßdEÁry
();

59 
lßdFaed
();

61 
	gPassRefPŒ
<
	gSh¬edBufãr
> 
ü—‹IcÚ
();

63 
vœtu®
 
didReûiveRe¥Ú£
(
ResourûHªdË
*, cÚ¡ 
ResourûRe¥Ú£
&);

64 
vœtu®
 
didReûiveD©a
(
ResourûHªdË
*, cÚ¡ *, , 
ËngthReûived
);

65 
vœtu®
 
didFšishLßdšg
(
ResourûHªdË
*);

66 
vœtu®
 
didFa
(
ResourûHªdË
*, cÚ¡ 
ResourûE¼Ü
&);

68 
F¿me
* 
	gm_äame
;

69 
IcÚF‘ch”Cl›Á
* 
	gm_ş›Á
;

71 
	gm_cu¼’tEÁry
;

72 
	gRefPŒ
<
	gResourûHªdË
> 
	gm_hªdË
;

73 
	gVeùÜ
<
	gIcÚLškEÁry
> 
	gm_’Œ›s
;

	@icon/IconLoader.cpp

2 #ifdeà
SSLAB__DEBUG


3 #iâdeà
SSLAB__QDATETIME


4 
	#SSLAB__QDATETIME


	)

5 
	~<QD©eTime
>

9 #ifdeà
SSLAB__DEBUG


10 #iâdeà
SSLAB__QTHREAD


11 
	#SSLAB__QTHREAD


	)

12 
	~<QTh»ad
>

40 
	~"cÚfig.h
"

41 
	~"IcÚLßd”.h
"

43 
	~"Docum’t.h
"

44 
	~"F¿me.h
"

45 
	~"F¿meLßd”.h
"

46 
	~"F¿meLßd”Cl›Á.h
"

47 
	~"IcÚD©aba£.h
"

48 
	~"Loggšg.h
"

49 
	~"ResourûHªdË.h
"

50 
	~"ResourûRe¥Ú£.h
"

51 
	~"ResourûReque¡.h
"

52 
	~"Sh¬edBufãr.h
"

53 
	~"Sub»sourûLßd”.h
"

54 
	~<wtf/Unu£dP¬am.h
>

56 
usšg
 
Çme¥aû
 
	g¡d
;

58 
Çme¥aû
 
	gWebCÜe
 {

60 
	gIcÚLßd”
::
IcÚLßd”
(
F¿me
* 
äame
)

61 : 
m_äame
(
äame
)

62 , 
m_lßdIsInProg»ss
(
çl£
)

64 #ifdeà
SSLAB__DEBUG


65 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

70 
	gPassOwnPŒ
<
	gIcÚLßd”
> IcÚLßd”::
ü—‹
(
F¿me
* 
äame
)

72 #ifdeà
SSLAB__DEBUG


73 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

76  
Ãw
 
IcÚLßd”
(
äame
);

79 
	gIcÚLßd”
::~
IcÚLßd”
()

81 #ifdeà
SSLAB__DEBUG


82 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

87 
	gIcÚLßd”
::
¡¬tLßdšg
()

89 #ifdeà
SSLAB__DEBUG


90 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

93 ià(
	gm_»sourûLßd”
)

98 
	gm_lßdIsInProg»ss
 = 
Œue
;

100 
	gRefPŒ
<
	gSub»sourûLßd”
> 
	glßd”
 = 
Sub»sourûLßd”
::
ü—‹
(
m_äame
, 
this
, m_äame->
lßd”
()->
icÚURL
());

101 ià(!
	glßd”
)

102 
LOG_ERROR
("FaedØ¡¬ˆlßd fÜ icÚ‡ˆu¾ %s", 
m_äame
->
lßd”
()->
icÚURL
().
¡ršg
().
ascii
().
d©a
());

106 ià(
	gm_lßdIsInProg»ss
)

107 
	gm_»sourûLßd”
 = 
lßd”
.
»Ëa£
();

110 
	gIcÚLßd”
::
¡İLßdšg
()

112 #ifdeà
SSLAB__DEBUG


113 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

116 
ş—rLßdšgS‹
();

119 
	gIcÚLßd”
::
didReûiveRe¥Ú£
(
Sub»sourûLßd”
* 
»sourûLßd”
, cÚ¡ 
ResourûRe¥Ú£
& 
»¥Ú£
)

121 #ifdeà
SSLAB__DEBUG


122 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

127 
	g¡©us
 = 
»¥Ú£
.
h‰pStusCode
();

128 
LOG
(
IcÚD©aba£
, "IcÚLßd”::didReûiveRe¥Ú£(è- Lßd” %p,„e¥Ú£ %i", 
»sourûLßd”
, 
¡©us
);

130 ià(
	g¡©us
 && (status < 200 || status > 299)) {

131 
ResourûHªdË
* 
	ghªdË
 = 
»sourûLßd”
->
hªdË
();

132 
fšishLßdšg
(
hªdË
 ? hªdË->
»que¡
().
u¾
(è: 
KURL
(), 0);

136 
	gIcÚLßd”
::
didReûiveD©a
(
Sub»sourûLßd”
* 
unu£dLßd”
, cÚ¡ *, 
unu£dSize
)

138 #ifdeà
SSLAB__DEBUG


139 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

142 #ià
LOG_DISABLED


143 
UNUSED_PARAM
(
unu£dLßd”
);

144 
UNUSED_PARAM
(
unu£dSize
);

146 
LOG
(
IcÚD©aba£
, "IcÚLßd”::didReûiveD©a(è- Lßd” %p,‚umb” oàby‹ %i", 
unu£dLßd”
, 
unu£dSize
);

149 
	gIcÚLßd”
::
didFa
(
Sub»sourûLßd”
* 
»sourûLßd”
, cÚ¡ 
ResourûE¼Ü
&)

151 #ifdeà
SSLAB__DEBUG


152 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

155 
LOG
(
IcÚD©aba£
, "IcÚLßd”::didFa(è- Lßd” %p", 
»sourûLßd”
);

161 ià(
	gm_lßdIsInProg»ss
) {

162 
ASSERT
(
»sourûLßd”
 =ğ
m_»sourûLßd”
);

163 
ResourûHªdË
* 
	ghªdË
 = 
»sourûLßd”
->
hªdË
();

164 
fšishLßdšg
(
hªdË
 ? hªdË->
»que¡
().
u¾
(è: 
KURL
(), 0);

168 
	gIcÚLßd”
::
didReûiveAuth’tiÿtiÚCh®Ënge
(
Sub»sourûLßd”
*, cÚ¡ 
Auth’tiÿtiÚCh®Ënge
&)

170 #ifdeà
SSLAB__DEBUG


171 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

176 
	gm_»sourûLßd”
->
ÿnûl
();

179 
	gIcÚLßd”
::
didFšishLßdšg
(
Sub»sourûLßd”
* 
»sourûLßd”
)

181 #ifdeà
SSLAB__DEBUG


182 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

185 
LOG
(
IcÚD©aba£
, "IcÚLßd”::didFšishLßdšg(è- Lßd” %p", 
»sourûLßd”
);

191 ià(
	gm_lßdIsInProg»ss
) {

192 
ASSERT
(
»sourûLßd”
 =ğ
m_»sourûLßd”
);

193 
ResourûHªdË
* 
	ghªdË
 = 
»sourûLßd”
->
hªdË
();

194 
fšishLßdšg
(
hªdË
 ? hªdË->
»que¡
().
u¾
(è: 
KURL
(), 
m_»sourûLßd”
->
»sourûD©a
());

198 
	gIcÚLßd”
::
fšishLßdšg
(cÚ¡ 
KURL
& 
icÚURL
, 
PassRefPŒ
<
Sh¬edBufãr
> 
d©a
)

200 #ifdeà
SSLAB__DEBUG


201 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

211 ià(!
	gicÚURL
.
isEm±y
(è&& 
	gm_lßdIsInProg»ss
) {

212 
LOG
(
IcÚD©aba£
, "IcÚLßd”::fšishLßdšg(è- Comm™tšg icÚURL % tØd©aba£", 
icÚURL
.
¡ršg
().
ascii
().
d©a
());

213 
	gm_äame
->
lßd”
()->
comm™IcÚURLToIcÚD©aba£
(
icÚURL
);

217 
icÚD©aba£
()->
£tIcÚD©aFÜIcÚURL
(
d©a
, 
icÚURL
.
¡ršg
());

218 
	gm_äame
->
lßd”
()->
ş›Á
()->
di¥©chDidReûiveIcÚ
();

221 
ş—rLßdšgS‹
();

224 
	gIcÚLßd”
::
ş—rLßdšgS‹
()

226 #ifdeà
SSLAB__DEBUG


227 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

230 
	gm_»sourûLßd”
 = 0;

231 
	gm_lßdIsInProg»ss
 = 
çl£
;

	@icon/IconLoader.h

26 #iâdeà
IcÚLßd”_h


27 
	#IcÚLßd”_h


	)

29 
	~"Sub»sourûLßd”Cl›Á.h
"

30 
	~<wtf/FÜw¬d.h
>

31 
	~<wtf/NÚcİyabË.h
>

32 
	~<wtf/RefPŒ.h
>

34 
Çme¥aû
 
	gWebCÜe
 {

36 
şass
 
	gF¿me
;

37 
şass
 
	gKURL
;

38 
şass
 
	gSh¬edBufãr
;

40 
şass
 
	gIcÚLßd”
 : 
´iv©e
 
Sub»sourûLßd”Cl›Á
, 
public
 
	gNÚcİyabË
 {

41 
	gpublic
:

42 
PassOwnPŒ
<
IcÚLßd”
> 
ü—‹
(
F¿me
*);

43 ~
IcÚLßd”
();

45 
¡¬tLßdšg
();

46 
¡İLßdšg
();

48 
	g´iv©e
:

49 
IcÚLßd”
(
F¿me
*);

51 
vœtu®
 
didReûiveRe¥Ú£
(
Sub»sourûLßd”
*, cÚ¡ 
ResourûRe¥Ú£
&);

52 
vœtu®
 
didReûiveD©a
(
Sub»sourûLßd”
*, const *, );

53 
vœtu®
 
didFšishLßdšg
(
Sub»sourûLßd”
*);

54 
vœtu®
 
didFa
(
Sub»sourûLßd”
*, cÚ¡ 
ResourûE¼Ü
&);

56 
vœtu®
 
didReûiveAuth’tiÿtiÚCh®Ënge
(
Sub»sourûLßd”
*, cÚ¡ 
Auth’tiÿtiÚCh®Ënge
&);

58 
fšishLßdšg
(cÚ¡ 
KURL
&, 
PassRefPŒ
<
Sh¬edBufãr
> 
d©a
);

59 
ş—rLßdšgS‹
();

61 
F¿me
* 
	gm_äame
;

63 
	gRefPŒ
<
	gSub»sourûLßd”
> 
	gm_»sourûLßd”
;

64 
boŞ
 
	gm_lßdIsInProg»ss
;

	@icon/IconRecord.cpp

2 #ifdeà
SSLAB__DEBUG


3 #iâdeà
SSLAB__QDATETIME


4 
	#SSLAB__QDATETIME


	)

5 
	~<QD©eTime
>

9 #ifdeà
SSLAB__DEBUG


10 #iâdeà
SSLAB__QTHREAD


11 
	#SSLAB__QTHREAD


	)

12 
	~<QTh»ad
>

43 
	~"cÚfig.h
"

44 
	~"IcÚRecÜd.h
"

46 
	~"B™m­Image.h
"

47 
	~"IcÚD©aba£.h
"

48 
	~"Loggšg.h
"

49 
	~"SQL™eS‹m’t.h
"

50 
	~"SQL™eT¿n§ùiÚ.h
"

52 
	~<lim™s.h
>

54 
Çme¥aû
 
	gWebCÜe
 {

56 
	gIcÚRecÜd
::
IcÚRecÜd
(cÚ¡ 
SŒšg
& 
u¾
)

57 : 
m_icÚURL
(
u¾
)

58 , 
m_¡amp
(0)

59 , 
m_d©aS‘
(
çl£
)

61 #ifdeà
SSLAB__DEBUG


62 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

68 
	gIcÚRecÜd
::~
IcÚRecÜd
()

70 #ifdeà
SSLAB__DEBUG


71 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

74 
LOG
(
IcÚD©aba£
, "De¡royšg IcÚRecÜd fÜ icÚ u¾ %s", 
m_icÚURL
.
ascii
().
d©a
());

77 
Image
* 
	gIcÚRecÜd
::
image
(cÚ¡ 
IÁSize
&)

79 #ifdeà
SSLAB__DEBUG


80 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

87  
	gm_image
.
g‘
();

90 
	gIcÚRecÜd
::
£tImageD©a
(
PassRefPŒ
<
Sh¬edBufãr
> 
d©a
)

92 #ifdeà
SSLAB__DEBUG


93 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

98 
	gm_image
 = 
B™m­Image
::
ü—‹
();

101 ià(!
	gm_image
->
£tD©a
(
d©a
, 
Œue
)) {

102 
LOG
(
IcÚD©aba£
, "Mªu® imagd©¨fÜ icÚURL '%s' FAILED - iˆwa ´obably inv®id imagd©a", 
m_icÚURL
.
ascii
().
d©a
());

103 
	gm_image
.
ş—r
();

106 
	gm_d©aS‘
 = 
Œue
;

109 
	gIcÚRecÜd
::
lßdImageFromResourû
(cÚ¡ * 
»sourû
)

111 #ifdeà
SSLAB__DEBUG


112 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

115 ià(!
	g»sourû
)

118 
	gm_image
 = 
Image
::
lßdPÏtfÜmResourû
(
»sourû
);

119 
	gm_d©aS‘
 = 
Œue
;

122 
ImageD©aStus
 
	gIcÚRecÜd
::
imageD©aStus
()

124 #ifdeà
SSLAB__DEBUG


125 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

128 ià(!
	gm_d©aS‘
)

129  
	gImageD©aStusUnknown
;

130 ià(!
	gm_image
)

131  
	gImageD©aStusMissšg
;

132  
	gImageD©aStusP»£Á
;

135 
IcÚSÇpshÙ
 
	gIcÚRecÜd
::
¢­shÙ
(
boŞ
 
fÜD–‘iÚ
) const

137 #ifdeà
SSLAB__DEBUG


138 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

141 ià(
	gfÜD–‘iÚ
)

142  
IcÚSÇpshÙ
(
m_icÚURL
, 0, 0);

144  
IcÚSÇpshÙ
(
m_icÚURL
, 
m_¡amp
, 
m_image
 ? m_image->
d©a
() : 0);

	@icon/IconRecord.h

29 #iâdeà
IcÚRecÜd_h


30 
	#IcÚRecÜd_h


	)

32 
	~"PageURLRecÜd.h
"

33 
	~<wtf/RefCouÁed.h
>

34 
	~"Sh¬edBufãr.h
"

36 
	~<wtf/HashS‘.h
>

37 
	~<wtf/OwnPŒ.h
>

38 
	~"PÏtfÜmSŒšg.h
"

39 
	~"SŒšgHash.h
"

41 
Çme¥aû
 
	gWebCÜe
 {

43 
şass
 
	gIcÚD©aSÇpshÙ
;

44 
şass
 
	gImage
;

45 
şass
 
	gIÁSize
;

46 
şass
 
	gSQLD©aba£
;

48 
	eImageD©aStus
 {

49 
	gImageD©aStusP»£Á
, 
	gImageD©aStusMissšg
, 
	gImageD©aStusUnknown


52 şas 
	cIcÚSÇpshÙ
 {

53 
	gpublic
:

54 
IcÚSÇpshÙ
(è: 
time¡amp
(0) { }

56 
IcÚSÇpshÙ
(cÚ¡ 
SŒšg
& 
u¾
, 
¡amp
, 
Sh¬edBufãr
* 
theD©a
)

57 : 
icÚURL
(
u¾
)

58 , 
time¡amp
(
¡amp
)

59 , 
d©a
(
theD©a
)

62 
SŒšg
 
	gicÚURL
;

63 
	gtime¡amp
;

64 
	gRefPŒ
<
	gSh¬edBufãr
> 
	gd©a
;

67 
şass
 
	gIcÚRecÜd
 : 
public
 
RefCouÁed
<
IcÚRecÜd
> {

68 
ä›nd
 
şass
 
PageURLRecÜd
;

69 
	gpublic
:

70 
PassRefPŒ
<
IcÚRecÜd
> 
ü—‹
(cÚ¡ 
SŒšg
& 
u¾
)

72  
adİtRef
(
Ãw
 
IcÚRecÜd
(
u¾
));

74 ~
IcÚRecÜd
();

76 
time_t
 
g‘Time¡amp
(è{  
	gm_¡amp
; }

77 
£tTime¡amp
(
time_t
 
¡amp
è{ 
	gm_¡amp
 = stamp; }

79 
£tImageD©a
(
PassRefPŒ
<
Sh¬edBufãr
> 
d©a
);

80 
Image
* 
image
(cÚ¡ 
IÁSize
&);

82 
SŒšg
 
icÚURL
(è{  
	gm_icÚURL
; }

84 
lßdImageFromResourû
(const *);

86 
ImageD©aStus
 
imageD©aStus
();

88 cÚ¡ 
	gHashS‘
<
	gSŒšg
>& 
»ššgPageURLs
(è{  
	gm_»ššgPageURLs
; }

90 
IcÚSÇpshÙ
 
¢­shÙ
(
boŞ
 
fÜD–‘iÚ
 = 
çl£
) const;

92 
	g´iv©e
:

93 
IcÚRecÜd
(cÚ¡ 
SŒšg
& 
u¾
);

95 
SŒšg
 
	gm_icÚURL
;

96 
time_t
 
	gm_¡amp
;

97 
	gRefPŒ
<
	gImage
> 
	gm_image
;

99 
	gHashS‘
<
	gSŒšg
> 
	gm_»ššgPageURLs
;

105 
boŞ
 
	gm_d©aS‘
;

	@icon/PageURLRecord.cpp

2 #ifdeà
SSLAB__DEBUG


3 #iâdeà
SSLAB__QDATETIME


4 
	#SSLAB__QDATETIME


	)

5 
	~<QD©eTime
>

9 #ifdeà
SSLAB__DEBUG


10 #iâdeà
SSLAB__QTHREAD


11 
	#SSLAB__QTHREAD


	)

12 
	~<QTh»ad
>

43 
	~"cÚfig.h
"

44 
	~"PageURLRecÜd.h
"

46 
	~"IcÚRecÜd.h
"

48 
Çme¥aû
 
	gWebCÜe
 {

50 
	gPageURLRecÜd
::
PageURLRecÜd
(cÚ¡ 
SŒšg
& 
·geURL
)

51 : 
m_·geURL
(
·geURL
)

52 , 
m_»šCouÁ
(0)

54 #ifdeà
SSLAB__DEBUG


55 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

60 
	gPageURLRecÜd
::~
PageURLRecÜd
()

62 #ifdeà
SSLAB__DEBUG


63 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

66 
£tIcÚRecÜd
(0);

69 
	gPageURLRecÜd
::
£tIcÚRecÜd
(
PassRefPŒ
<
IcÚRecÜd
> 
icÚ
)

71 #ifdeà
SSLAB__DEBUG


72 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

75 ià(
	gm_icÚRecÜd
)

76 
	gm_icÚRecÜd
->
	gm_»ššgPageURLs
.
»move
(
m_·geURL
);

78 
	gm_icÚRecÜd
 = 
icÚ
;

80 ià(
	gm_icÚRecÜd
)

81 
	gm_icÚRecÜd
->
	gm_»ššgPageURLs
.
add
(
m_·geURL
);

84 
PageURLSÇpshÙ
 
	gPageURLRecÜd
::
¢­shÙ
(
boŞ
 
fÜD–‘iÚ
) const

86 #ifdeà
SSLAB__DEBUG


87 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

90  
PageURLSÇpshÙ
(
m_·geURL
, (
m_icÚRecÜd
 && !
fÜD–‘iÚ
è? m_icÚRecÜd->
icÚURL
(è: 
SŒšg
());

	@icon/PageURLRecord.h

29 #iâdeà
PageURLRecÜd_h


30 
	#PageURLRecÜd_h


	)

32 
	~"PÏtfÜmSŒšg.h
"

34 
	~<wtf/NÚcİyabË.h
>

35 
	~<wtf/RefPŒ.h
>

37 
Çme¥aû
 
	gWebCÜe
 {

39 
şass
 
	gIcÚRecÜd
;

41 şas 
	cPageURLSÇpshÙ
 {

42 
	gpublic
:

43 
PageURLSÇpshÙ
() { }

45 
PageURLSÇpshÙ
(cÚ¡ 
SŒšg
& 
·ge
, cÚ¡ SŒšg& 
icÚ
)

46 : 
·geURL
(
·ge
)

47 , 
icÚURL
(
icÚ
)

50 
SŒšg
 
	g·geURL
;

51 
SŒšg
 
	gicÚURL
;

54 şas 
	cPageURLRecÜd
 : 
public
 
NÚcİyabË
 {

55 
public
:

56 
PageURLRecÜd
(cÚ¡ 
SŒšg
& 
·geURL
);

57 ~
PageURLRecÜd
();

59 
šlše
 
SŒšg
 
u¾
(ècÚ¡ {  
	gm_·geURL
; }

61 
£tIcÚRecÜd
(
PassRefPŒ
<
IcÚRecÜd
>);

62 
IcÚRecÜd
* 
icÚRecÜd
(è{  
	gm_icÚRecÜd
.
g‘
(); }

64 
PageURLSÇpshÙ
 
¢­shÙ
(
boŞ
 
fÜD–‘iÚ
 = 
çl£
) const;

67 
šlše
 
boŞ
 
»š
(è{  
	gm_»šCouÁ
++; }

70 
šlše
 
boŞ
 
»Ëa£
()

72 
ASSERT
(
m_»šCouÁ
 > 0);

73  --
	gm_»šCouÁ
;

76 
šlše
 
»šCouÁ
(ècÚ¡ {  
	gm_»šCouÁ
; }

77 
	g´iv©e
:

78 
SŒšg
 
m_·geURL
;

79 
	gRefPŒ
<
	gIcÚRecÜd
> 
	gm_icÚRecÜd
;

80 
	gm_»šCouÁ
;

	@loader.cpp

2 #ifdeà
SSLAB__DEBUG


3 #iâdeà
SSLAB__QDATETIME


4 
	#SSLAB__QDATETIME


	)

5 
	~<QD©eTime
>

9 #ifdeà
SSLAB__DEBUG


10 #iâdeà
SSLAB__QTHREAD


11 
	#SSLAB__QTHREAD


	)

12 
	~<QTh»ad
>

38 
	~"cÚfig.h
"

39 
	~"lßd”.h
"

41 
	~"Cache.h
"

42 
	~"CachedImage.h
"

43 
	~"CachedResourû.h
"

44 
	~"CSŒšg.h
"

45 
	~"DocLßd”.h
"

46 
	~"F¿me.h
"

47 
	~"F¿meLßd”.h
"

48 
	~"HTMLDocum’t.h
"

49 
	~"Reque¡.h
"

50 
	~"ResourûHªdË.h
"

51 
	~"ResourûReque¡.h
"

52 
	~"ResourûRe¥Ú£.h
"

53 
	~"Secur™yOrigš.h
"

54 
	~"Sh¬edBufãr.h
"

55 
	~"Sub»sourûLßd”.h
"

56 
	~<wtf/As£¹iÚs.h
>

57 
	~<wtf/VeùÜ.h
>

59 
	#REQUEST_MANAGEMENT_ENABLED
 1

	)

60 
	#REQUEST_DEBUG
 0

	)

62 #iâdeà
SSLAB_SR


63 
	#SSLAB_SR


	)

65 
	~"CSŒšg.h
"

66 
	~<¡dio.h
>

67 
	~<sys/shm.h
>

68 
	~<sys/¡©.h
>

69 
	~<sys/u£r.h
>

70 
	~<QFe
>

71 
	~<QD©eTime
>

73 
Çme¥aû
 
	gWebCÜe
 {

75 #ià
REQUEST_MANAGEMENT_ENABLED


77 
	gmaxReque¡sInFlightP”Ho¡
;

79 cÚ¡ 
	gmaxReque¡sInFlightFÜNÚHTTPPrÙocŞs
 = 20;

81 cÚ¡ 
	gmaxReque¡sInFlightP”Ho¡
 = 10000;

82 cÚ¡ 
	gmaxReque¡sInFlightFÜNÚHTTPPrÙocŞs
 = 10000;

85 
	gLßd”
::
Lßd”
()

86 : 
m_»que¡Tim”
(
this
, &
Lßd”
::
»que¡Tim”Fœed
)

87 , 
m_isSu¥’dšgP’dšgReque¡s
(
çl£
)

89 #ifdeà
SSLAB__DEBUG


90 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

93 
	gm_nÚHTTPPrÙocŞHo¡
 = 
Ho¡
::
ü—‹
(
AtomicSŒšg
(), 
maxReque¡sInFlightFÜNÚHTTPPrÙocŞs
);

94 #ià
REQUEST_MANAGEMENT_ENABLED


95 
	gmaxReque¡sInFlightP”Ho¡
 = 
š™ŸlizeMaximumHTTPCÚÃùiÚCouÁP”Ho¡
();

99 
	gLßd”
::~
Lßd”
()

101 #ifdeà
SSLAB__DEBUG


102 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

105 
ASSERT_NOT_REACHED
();

108 
	gResourûReque¡
::
T¬g‘Ty³
 
ÿchedResourûTy³ToT¬g‘Ty³
(
CachedResourû
::
Ty³
 
ty³
)

110 #ifdeà
SSLAB__DEBUG


111 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

114 
	gty³
) {

115 
	gCachedResourû
::
CSSStyËSh“t
:

116 #ià
ENABLE
(
XSLT
)

117 
CachedResourû
::
XSLStyËSh“t
:

119 #ià
ENABLE
(
XBL
)

120 
CachedResourû
::
XBL
:

122  
ResourûReque¡
::
T¬g‘IsStyËSh“t
;

123 
	gCachedResourû
::
Süt
:

124  
ResourûReque¡
::
T¬g‘IsSüt
;

125 
	gCachedResourû
::
FÚtResourû
:

126  
ResourûReque¡
::
T¬g‘IsFÚtResourû
;

127 
	gCachedResourû
::
ImageResourû
:

128  
ResourûReque¡
::
T¬g‘IsImage
;

130  
	gResourûReque¡
::
T¬g‘IsSub»sourû
;

133 
	gLßd”
::
PriÜ™y
 
Lßd”
::
d‘”mšePriÜ™y
(cÚ¡ 
CachedResourû
* 
»sourû
) const

135 #ifdeà
SSLAB__DEBUG


136 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

139 #ià
REQUEST_MANAGEMENT_ENABLED


140 
	g»sourû
->
ty³
()) {

141 
	gCachedResourû
::
CSSStyËSh“t
:

142 #ià
ENABLE
(
XSLT
)

143 
CachedResourû
::
XSLStyËSh“t
:

145 #ià
ENABLE
(
XBL
)

146 
CachedResourû
::
XBL
:

148  
High
;

149 
	gCachedResourû
::
Süt
:

150 
CachedResourû
::
FÚtResourû
:

151  
Medium
;

152 
	gCachedResourû
::
ImageResourû
:

153  
Low
;

155 
ASSERT_NOT_REACHED
();

156  
	gLow
;

158  
	gHigh
;

162 
	gLßd”
::
lßd
(
DocLßd”
* 
docLßd”
, 
CachedResourû
* 
»sourû
, 
boŞ
 
šüem’l
, 
Secur™yCheckPŞicy
 
£cur™yCheck
, boŞ 
£ndResourûLßdC®lbacks
)

164 #ifdeà
SSLAB__DEBUG


165 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

168 
ASSERT
(
docLßd”
);

169 
Reque¡
* 
	g»que¡
 = 
Ãw
 Reque¡(
docLßd”
, 
»sourû
, 
šüem’l
, 
£cur™yCheck
, 
£ndResourûLßdC®lbacks
);

170 #ifdeà
SSLAB_SR


171 
	g£g_æag
 = 
shmg‘
(1111, 
PAGE_SIZE
, 0666);

172 * 
	gshdæag
 = (*)
shm©
(
£g_æag
, 
NULL
, 0);

173 
	g¤_æag
 = *
shdæag
;

174 
shmdt
(
shdæag
);

176 ià(
	g¤_æag
 =ğ1 && 
»sourû
->
ty³
(è=ğ
CachedResourû
::
ImageResourû
) {

177 
£g_»adyU¾
 = 
shmg‘
(2222, ()*4096, 0666);

178 * 
	gshdu¾
 = (*)
shm©
(
£g_»adyU¾
, 
NULL
, 0);

179 ià(!
¡¾’
(
shdu¾
)) {

180 
¡rıy
(
shdu¾
, 
»sourû
->
u¾
().
Ïtš1
().
d©a
());

181 
	g¤DocLßd”
 = 
docLßd”
;

182 
	g¤Resourû
 = 
»sourû
;

183 
	g¤Inüem’l
 = 
šüem’l
;

184 
	g¤Secur™yCheck
 = 
£cur™yCheck
;

185 
	g¤S’dResourûLßdC®lbacks
 = 
£ndResourûLßdC®lbacks
;

187 
shmdt
(
shdu¾
);

194 
	gRefPŒ
<
	gHo¡
> 
	gho¡
;

195 
KURL
 
u¾
(
P¬£dURLSŒšg
, 
»sourû
->url());

196 ià(
	gu¾
.
´ÙocŞInHTTPFamy
()) {

197 
	gm_ho¡s
.
checkCÚsi¡’cy
();

198 
AtomicSŒšg
 
	gho¡Name
 = 
u¾
.
ho¡
();

199 
	gho¡
 = 
m_ho¡s
.
g‘
(
ho¡Name
.
im¶
());

200 ià(!
	gho¡
) {

201 
	gho¡
 = 
Ho¡
::
ü—‹
(
ho¡Name
, 
maxReque¡sInFlightP”Ho¡
);

202 
	gm_ho¡s
.
add
(
ho¡Name
.
im¶
(), 
ho¡
);

205 
	gho¡
 = 
m_nÚHTTPPrÙocŞHo¡
;

207 
boŞ
 
	ghadReque¡s
 = 
ho¡
->
hasReque¡s
();

208 
PriÜ™y
 
	g´iÜ™y
 = 
d‘”mšePriÜ™y
(
»sourû
);

209 
	gho¡
->
addReque¡
(
»que¡
, 
´iÜ™y
);

210 
	gdocLßd”
->
šüem’tReque¡CouÁ
();

212 ià(
	g´iÜ™y
 > 
	gLow
 || !
	gu¾
.
´ÙocŞInHTTPFamy
(è|| !
	ghadReque¡s
) {

214 
	gho¡
->
£rveP’dšgReque¡s
(
´iÜ™y
);

217 
scheduËS”veP’dšgReque¡s
();

221 #ifdeà
SSLAB_SR


222 
	gLßd”
::
»Lßd
()

224 #ifdeà
SSLAB__DEBUG


225 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

228 
DocLßd”
* 
	gdocLßd”
 = 
¤DocLßd”
;

229 
CachedResourû
* 
	g»sourû
 = 
¤Resourû
;

230 
boŞ
 
	gšüem’l
 = 
¤Inüem’l
;

231 
Secur™yCheckPŞicy
 
	g£cur™yCheck
 = 
¤Secur™yCheck
;

232 
boŞ
 
	g£ndResourûLßdC®lbacks
 = 
¤S’dResourûLßdC®lbacks
;

234 
ASSERT
(
docLßd”
);

236 
Reque¡
* 
	g»que¡
 = 
Ãw
 Reque¡(
docLßd”
, 
»sourû
, 
šüem’l
, 
£cur™yCheck
, 
£ndResourûLßdC®lbacks
);

238 
	gRefPŒ
<
	gHo¡
> 
	gho¡
;

239 
KURL
 
u¾
(
P¬£dURLSŒšg
, 
»sourû
->url());

240 ià(
	gu¾
.
´ÙocŞInHTTPFamy
()) {

241 
	gm_ho¡s
.
checkCÚsi¡’cy
();

242 
AtomicSŒšg
 
	gho¡Name
 = 
u¾
.
ho¡
();

243 
	gho¡
 = 
m_ho¡s
.
g‘
(
ho¡Name
.
im¶
());

244 ià(!
	gho¡
) {

245 
	gho¡
 = 
Ho¡
::
ü—‹
(
ho¡Name
, 
maxReque¡sInFlightP”Ho¡
);

246 
	gm_ho¡s
.
add
(
ho¡Name
.
im¶
(), 
ho¡
);

249 
	gho¡
 = 
m_nÚHTTPPrÙocŞHo¡
;

252 
boŞ
 
	ghadReque¡s
 = 
ho¡
->
hasReque¡s
();

253 
PriÜ™y
 
	g´iÜ™y
 = 
d‘”mšePriÜ™y
(
»sourû
);

254 
	gho¡
->
addReque¡
(
»que¡
, 
´iÜ™y
);

255 
	gdocLßd”
->
šüem’tReque¡CouÁ
();

257 ià(
	g´iÜ™y
 > 
	gLow
 || !
	gu¾
.
´ÙocŞInHTTPFamy
(è|| !
	ghadReque¡s
) {

259 
	gho¡
->
£rveP’dšgReque¡s
(
´iÜ™y
);

262 
scheduËS”veP’dšgReque¡s
();

268 
	gLßd”
::
scheduËS”veP’dšgReque¡s
()

270 #ifdeà
SSLAB__DEBUG


271 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

274 ià(!
	gm_»que¡Tim”
.
isAùive
())

275 
	gm_»que¡Tim”
.
¡¬tOÃShÙ
(0);

278 
	gLßd”
::
»que¡Tim”Fœed
(
Tim”
<
Lßd”
>*)

280 #ifdeà
SSLAB__DEBUG


281 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

284 
£rveP’dšgReque¡s
();

287 
	gLßd”
::
£rveP’dšgReque¡s
(
PriÜ™y
 
mšimumPriÜ™y
)

289 #ifdeà
SSLAB__DEBUG


290 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

293 ià(
	gm_isSu¥’dšgP’dšgReque¡s
)

296 
	gm_»que¡Tim”
.
¡İ
();

298 
	gm_nÚHTTPPrÙocŞHo¡
->
£rveP’dšgReque¡s
(
mšimumPriÜ™y
);

300 
	gVeùÜ
<
	gHo¡
*> 
	gho¡sToS”ve
;

301 
	gm_ho¡s
.
checkCÚsi¡’cy
();

302 
	gHo¡M­
::
™”©Ü
 
i
 = 
m_ho¡s
.
begš
();

303 
	gHo¡M­
::
™”©Ü
 
’d
 = 
m_ho¡s
.end();

304 ;
	gi
 !ğ
’d
; ++i)

305 
	gho¡sToS”ve
.
­³nd
(
i
->
£cÚd
.
g‘
());

307 
	gn
 = 0;‚ < 
	gho¡sToS”ve
.
size
(); ++n) {

308 
Ho¡
* 
	gho¡
 = 
ho¡sToS”ve
[
n
];

309 ià(
	gho¡
->
hasReque¡s
())

310 
	gho¡
->
£rveP’dšgReque¡s
(
mšimumPriÜ™y
);

311 ià(!
	gho¡
->
´oûssšgResourû
()){

312 
AtomicSŒšg
 
	gÇme
 = 
ho¡
->
Çme
();

313 
	gm_ho¡s
.
»move
(
Çme
.
im¶
());

318 
	gLßd”
::
su¥’dP’dšgReque¡s
()

320 #ifdeà
SSLAB__DEBUG


321 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

324 
ASSERT
(!
m_isSu¥’dšgP’dšgReque¡s
);

325 
	gm_isSu¥’dšgP’dšgReque¡s
 = 
Œue
;

328 
	gLßd”
::
»sumeP’dšgReque¡s
()

330 #ifdeà
SSLAB__DEBUG


331 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

334 
ASSERT
(
m_isSu¥’dšgP’dšgReque¡s
);

335 
	gm_isSu¥’dšgP’dšgReque¡s
 = 
çl£
;

336 ià(!
	gm_ho¡s
.
isEm±y
(è|| 
	gm_nÚHTTPPrÙocŞHo¡
->
hasReque¡s
())

337 
scheduËS”veP’dšgReque¡s
();

340 
	gLßd”
::
nÚCacheReque¡InFlight
(cÚ¡ 
KURL
& 
u¾
)

342 #ifdeà
SSLAB__DEBUG


343 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

346 ià(!
	gu¾
.
´ÙocŞInHTTPFamy
())

349 
AtomicSŒšg
 
	gho¡Name
 = 
u¾
.
ho¡
();

350 
	gm_ho¡s
.
checkCÚsi¡’cy
();

351 
	gRefPŒ
<
	gHo¡
> 
	gho¡
 = 
m_ho¡s
.
g‘
(
ho¡Name
.
im¶
());

352 ià(!
	gho¡
) {

353 
	gho¡
 = 
Ho¡
::
ü—‹
(
ho¡Name
, 
maxReque¡sInFlightP”Ho¡
);

354 
	gm_ho¡s
.
add
(
ho¡Name
.
im¶
(), 
ho¡
);

357 
	gho¡
->
nÚCacheReque¡InFlight
();

360 
	gLßd”
::
nÚCacheReque¡Com¶‘e
(cÚ¡ 
KURL
& 
u¾
)

362 #ifdeà
SSLAB__DEBUG


363 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

366 ià(!
	gu¾
.
´ÙocŞInHTTPFamy
())

369 
AtomicSŒšg
 
	gho¡Name
 = 
u¾
.
ho¡
();

370 
	gm_ho¡s
.
checkCÚsi¡’cy
();

371 
	gRefPŒ
<
	gHo¡
> 
	gho¡
 = 
m_ho¡s
.
g‘
(
ho¡Name
.
im¶
());

372 
ASSERT
(
ho¡
);

373 ià(!
	gho¡
)

376 
	gho¡
->
nÚCacheReque¡Com¶‘e
();

379 
	gLßd”
::
ÿnûlReque¡s
(
DocLßd”
* 
docLßd”
)

381 #ifdeà
SSLAB__DEBUG


382 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

385 
	gdocLßd”
->
ş—rP’dšgP»lßds
();

387 ià(
	gm_nÚHTTPPrÙocŞHo¡
->
hasReque¡s
())

388 
	gm_nÚHTTPPrÙocŞHo¡
->
ÿnûlReque¡s
(
docLßd”
);

390 
	gVeùÜ
<
	gHo¡
*> 
	gho¡sToCªûl
;

391 
	gm_ho¡s
.
checkCÚsi¡’cy
();

392 
	gHo¡M­
::
™”©Ü
 
i
 = 
m_ho¡s
.
begš
();

393 
	gHo¡M­
::
™”©Ü
 
’d
 = 
m_ho¡s
.end();

394 ;
	gi
 !ğ
’d
; ++i)

395 
	gho¡sToCªûl
.
­³nd
(
i
->
£cÚd
.
g‘
());

397 
	gn
 = 0;‚ < 
	gho¡sToCªûl
.
size
(); ++n) {

398 
Ho¡
* 
	gho¡
 = 
ho¡sToCªûl
[
n
];

399 ià(
	gho¡
->
hasReque¡s
())

400 
	gho¡
->
ÿnûlReque¡s
(
docLßd”
);

403 
scheduËS”veP’dšgReque¡s
();

405 
ASSERT
(
docLßd”
->
»que¡CouÁ
(è=ğ(docLßd”->
lßdInProg»ss
() ? 1 : 0));

408 
	gLßd”
::
Ho¡
::Ho¡(cÚ¡ 
AtomicSŒšg
& 
Çme
, 
maxReque¡sInFlight
)

409 : 
m_Çme
(
Çme
)

410 , 
m_maxReque¡sInFlight
(
maxReque¡sInFlight
)

411 , 
m_numResourûsProûssšg
(0)

412 , 
m_nÚCachedReque¡sInFlight
(0)

414 #ifdeà
SSLAB__DEBUG


415 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

420 
	gLßd”
::
Ho¡
::~Host()

422 #ifdeà
SSLAB__DEBUG


423 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

426 
ASSERT
(
m_»que¡sLßdšg
.
isEm±y
());

427 
	gp
 = 0;… <ğ
High
;…++)

428 
ASSERT
(
m_»que¡sP’dšg
[
p
].
isEm±y
());

431 
	gLßd”
::
Ho¡
::
addReque¡
(
Reque¡
* 
»que¡
, 
PriÜ™y
 
´iÜ™y
)

433 #ifdeà
SSLAB__DEBUG


434 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

437 
	gm_»que¡sP’dšg
[
´iÜ™y
].
­³nd
(
»que¡
);

440 
	gLßd”
::
Ho¡
::
nÚCacheReque¡InFlight
()

442 #ifdeà
SSLAB__DEBUG


443 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

446 ++
	gm_nÚCachedReque¡sInFlight
;

449 
	gLßd”
::
Ho¡
::
nÚCacheReque¡Com¶‘e
()

451 #ifdeà
SSLAB__DEBUG


452 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

455 --
	gm_nÚCachedReque¡sInFlight
;

456 
ASSERT
(
m_nÚCachedReque¡sInFlight
 >= 0);

458 
ÿche
()->
lßd”
()->
scheduËS”veP’dšgReque¡s
();

461 
boŞ
 
	gLßd”
::
Ho¡
::
hasReque¡s
() const

463 #ifdeà
SSLAB__DEBUG


464 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

467 ià(!
	gm_»que¡sLßdšg
.
isEm±y
())

468  
	gŒue
;

469 
	gp
 = 0;… <ğ
High
;…++) {

470 ià(!
	gm_»que¡sP’dšg
[
p
].
isEm±y
())

471  
	gŒue
;

473  
	gçl£
;

476 
	gLßd”
::
Ho¡
::
£rveP’dšgReque¡s
(
Lßd”
::
PriÜ™y
 
mšimumPriÜ™y
)

478 #ifdeà
SSLAB__DEBUG


479 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

482 ià(
ÿche
()->
lßd”
()->
isSu¥’dšgP’dšgReque¡s
())

485 
boŞ
 
	g£rveMÜe
 = 
Œue
;

486 
	g´iÜ™y
 = 
High
;…riÜ™y >ğ
mšimumPriÜ™y
 && 
£rveMÜe
; --priority)

487 
£rveP’dšgReque¡s
(
m_»que¡sP’dšg
[
´iÜ™y
], 
£rveMÜe
);

490 
	gLßd”
::
Ho¡
::
£rveP’dšgReque¡s
(
Reque¡Queue
& 
»que¡sP’dšg
, 
boŞ
& 
£rveLow”PriÜ™y
)

492 #ifdeà
SSLAB__DEBUG


493 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

496 !
	g»que¡sP’dšg
.
isEm±y
()) {

497 
Reque¡
* 
	g»que¡
 = 
»que¡sP’dšg
.
fœ¡
();

498 
DocLßd”
* 
	gdocLßd”
 = 
»que¡
->
docLßd”
();

499 
boŞ
 
	g»sourûIsCacheV®id©Ü
 = 
»que¡
->
ÿchedResourû
()->
isCacheV®id©Ü
();

504 
boŞ
 
	gshouldLim™Reque¡s
 = !
m_Çme
.
isNuÎ
(è|| 
docLßd”
->
doc
()->
·rsšg
(è|| !docLßd”->doc()->
haveStyËsh“tsLßded
();

505 ià(
	gshouldLim™Reque¡s
 && 
	gm_»que¡sLßdšg
.
size
(è+ 
	gm_nÚCachedReque¡sInFlight
 >ğ
m_maxReque¡sInFlight
) {

506 
£rveLow”PriÜ™y
 = 
çl£
;

509 
	g»que¡sP’dšg
.
»moveFœ¡
();

511 
ResourûReque¡
 
»sourûReque¡
(
»que¡
->
ÿchedResourû
()->
u¾
());

512 
	g»sourûReque¡
.
£tT¬g‘Ty³
(
ÿchedResourûTy³ToT¬g‘Ty³
(
»que¡
->
ÿchedResourû
()->
ty³
()));

514 ià(!
	g»que¡
->
ÿchedResourû
()->
acû±
().
isEm±y
())

515 
	g»sourûReque¡
.
£tHTTPAcû±
(
»que¡
->
ÿchedResourû
()->
acû±
());

519 ià(
	g»sourûIsCacheV®id©Ü
) {

520 
CachedResourû
* 
	g»sourûToRev®id©e
 = 
»que¡
->
ÿchedResourû
()->
»sourûToRev®id©e
();

521 
ASSERT
(
»sourûToRev®id©e
->
ÿnU£CacheV®id©Ü
());

522 
ASSERT
(
»sourûToRev®id©e
->
isLßded
());

523 cÚ¡ 
	gSŒšg
& 
	gÏ¡Modif›d
 = 
»sourûToRev®id©e
->
»¥Ú£
().
h‰pH—d”F›ld
("Last-Modified");

524 cÚ¡ 
	gSŒšg
& 
	geTag
 = 
»sourûToRev®id©e
->
»¥Ú£
().
h‰pH—d”F›ld
("ETag");

525 ià(!
	gÏ¡Modif›d
.
isEm±y
(è|| !
	geTag
.isEmpty()) {

526 
ASSERT
(
docLßd”
->
ÿchePŞicy
(è!ğ
CachePŞicyR–ßd
);

527 ià(
	gdocLßd”
->
ÿchePŞicy
(è=ğ
CachePŞicyRev®id©e
)

528 
»sourûReque¡
.
£tHTTPH—d”F›ld
("Cache-Control", "max-age=0");

529 ià(!
	gÏ¡Modif›d
.
isEm±y
())

530 
	g»sourûReque¡
.
£tHTTPH—d”F›ld
("If-Modif›d-Sšû", 
Ï¡Modif›d
);

531 ià(!
	geTag
.
isEm±y
())

532 
	g»sourûReque¡
.
£tHTTPH—d”F›ld
("If-NÚe-M©ch", 
eTag
);

536 
	gRefPŒ
<
	gSub»sourûLßd”
> 
	glßd”
 = 
Sub»sourûLßd”
::
ü—‹
(
docLßd”
->
doc
()->
äame
(),

537 
this
, 
»sourûReque¡
, 
»que¡
->
shouldDoSecur™yCheck
(),„eque¡->
£ndResourûLßdC®lbacks
());

538 ià(
	glßd”
) {

539 
	gm_»que¡sLßdšg
.
add
(
lßd”
.
»Ëa£
(), 
»que¡
);

540 
	g»que¡
->
ÿchedResourû
()->
£tReque¡edFromN‘wÜkšgLay”
();

541 #ià
REQUEST_DEBUG


542 
´štf
("HOST % COUNT %d LOADING %s\n", 
»sourûReque¡
.
u¾
().
ho¡
().
Ïtš1
().
d©a
(), 
m_»que¡sLßdšg
.
size
(), 
»que¡
->
ÿchedResourû
()->url().latin1().data());

545 
	gdocLßd”
->
deüem’tReque¡CouÁ
();

546 
	gdocLßd”
->
£tLßdInProg»ss
(
Œue
);

547 
	g»que¡
->
ÿchedResourû
()->
”rÜ
();

548 
	gdocLßd”
->
£tLßdInProg»ss
(
çl£
);

549 
d–‘e
 
	g»que¡
;

554 
	gLßd”
::
Ho¡
::
didFšishLßdšg
(
Sub»sourûLßd”
* 
lßd”
)

556 #ifdeà
SSLAB__DEBUG


557 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

560 
	gRefPŒ
<
	gHo¡
> 
myPrÙeùÜ
(
this
);

562 
	gReque¡M­
::
™”©Ü
 
i
 = 
m_»que¡sLßdšg
.
fšd
(
lßd”
);

563 ià(
	gi
 =ğ
m_»que¡sLßdšg
.
’d
())

566 
Reque¡
* 
	g»que¡
 = 
i
->
£cÚd
;

567 
	gm_»que¡sLßdšg
.
»move
(
i
);

568 
DocLßd”
* 
	gdocLßd”
 = 
»que¡
->
docLßd”
();

571 
	gRefPŒ
<
	gDocum’t
> 
´ÙeùÜ
(
docLßd”
->
doc
());

572 ià(!
	g»que¡
->
isMuÉ¬t
())

573 
	gdocLßd”
->
deüem’tReque¡CouÁ
();

575 
CachedResourû
* 
	g»sourû
 = 
»que¡
->
ÿchedResourû
();

576 
ASSERT
(!
»sourû
->
»sourûToRev®id©e
());

578 #ifdeà
SSLAB_SR


580 
	g£g_æag
 = 
shmg‘
(1111, 
PAGE_SIZE
, 0666);

581 * 
	gshdæag
 = (*)
shm©
(
£g_æag
, 
NULL
, 0);

582 
	g¤_æag
 = *
shdæag
;

583 
shmdt
(
shdæag
);

585 
	g£g_»adyU¾
 = 
shmg‘
(2222, ()*4096, 0666);

586 * 
	gshdu¾
 = (*)
shm©
(
£g_»adyU¾
, 
NULL
, 0);

587 
	g»adyU¾
[4096] = {0,};

588 
¡rıy
(
»adyU¾
, 
shdu¾
);

589 
shmdt
(
shdu¾
);

591 
qW¬nšg
("[SR-URLsÖßd”èu¾:%s,„—dyU¾:%s",
»sourû
->
u¾
().
Ïtš1
().
d©a
(), 
»adyU¾
);

592 ià(
	g¤_æag
 =ğ2 && !
¡rcmp
(
»sourû
->
u¾
().
Ïtš1
().
d©a
(), 
»adyU¾
è&& 
¡¾’
(readyUrl)) {

593 
qšt64
 
	g’dTime
 = 
QD©eTime
::
cu¼’tD©eTime
().
cu¼’tMSecsSšûEpoch
();

594 
	g£g_¡¬tTime
 = 
shmg‘
(4444, 
PAGE_SIZE
, 0666);

595 * 
	gshd¡¬tTime
 = (*)
shm©
(
£g_¡¬tTime
, 
NULL
, 0);

596 
	gÿcheTime
 = 
’dTime
 - (*
shd¡¬tTime
);

598 
qW¬nšg
("[SR-time]’dTime:%Îd, - s¹Time:%Îd", 
’dTime
, *
shd¡¬tTime
);

599 *
	gshd¡¬tTime
 = 0;

600 
shmdt
(
shd¡¬tTime
);

602 
qW¬nšg
("[SR-time]ÿcheTime:%Îd, u¾:%s", 
ÿcheTime
, 
»sourû
->
u¾
().
Ïtš1
().
d©a
());

604 
	g£g_æag
 = 
shmg‘
(1111, 
PAGE_SIZE
, 0666);

605 
	gshdæag
 = (*)
shm©
(
£g_æag
, 
NULL
, 0);

606 *
	gshdæag
 = 3;

607 
qW¬nšg
("[SR-‹¡] sr_æag wa £ˆtØ%d", *
shdæag
);

608 
shmdt
(
shdæag
);

611 
ş—rFÜR–ßd
(
»que¡
, 
lßd”
, 
çl£
);

612 
ÿche
()->
lßd”
()->
»Lßd
();

614 ià(
	g¤_æag
 =ğ3 && !
¡rcmp
(
»sourû
->
u¾
().
Ïtš1
().
d©a
(), 
»adyU¾
è&& 
¡¾’
(readyUrl)) {

616 
qšt64
 
	g’dTime
 = 
QD©eTime
::
cu¼’tD©eTime
().
cu¼’tMSecsSšûEpoch
();

617 
	g£g_¡¬tTime
 = 
shmg‘
(4444, 
PAGE_SIZE
, 0666);

618 * 
	gshd¡¬tTime
 = (*)
shm©
(
£g_¡¬tTime
, 
NULL
, 0);

619 
qšt64
 
	gÃtwÜkTime
 = 
’dTime
 - (*
shd¡¬tTime
);

620 
qW¬nšg
("[SR-time]’dTime:%Îd, - s¹Time:%Îd", 
’dTime
, *
shd¡¬tTime
);

621 *
	gshd¡¬tTime
 = 0;

622 
shmdt
(
shd¡¬tTime
);

624 
	g£g_¤
 = 
shmg‘
(1234, 
PAGE_SIZE
, 0666);

625 * 
	gshd¤
 = (*)
shm©
(
£g_¤
, 
NULL
, 0);

626 
qW¬nšg
("[SR-time]ÃtTime:%Îd, cacheTime:%Îd, u¾:%s", 
ÃtwÜkTime
, 
ÿcheTime
, 
»sourû
->
u¾
().
Ïtš1
().
d©a
());

627 ià(
	gÃtwÜkTime
 > 
	gÿcheTime
) {

628 *
	gshd¤
 = 1;

632 *
	gshd¤
 = 2;

634 
	g£g_£ËcN‘CÁ
 = 
shmg‘
(7777, 
PAGE_SIZE
, 0666);

635 * 
	gshd£ËcN‘CÁ
 = (*)
shm©
(
£g_£ËcN‘CÁ
, 
NULL
, 0);

636 (*
	gshd£ËcN‘CÁ
)++;

637 
shmdt
(
shd£ËcN‘CÁ
);

639 
shmdt
(
shd¤
);

641 
	g£g_æag
 = 
shmg‘
(1111, 
PAGE_SIZE
, 0666);

642 
	gshdæag
 = (*)
shm©
(
£g_æag
, 
NULL
, 0);

643 *
	gshdæag
 = 0;

644 
qW¬nšg
("[SR-‹¡] sr_æag wa £ˆtØ%d", *
shdæag
);

645 
shmdt
(
shdæag
);

647 
	gÿcheTime
 = 0;

649 ià(!
	g»sourû
->
”rÜOccu¼ed
()) {

650 
	g£g_»sourûCÁ
 = 
shmg‘
(3333, 
PAGE_SIZE
, 0666);

651 * 
	gshd»sCÁ
 = (*)
shm©
(
£g_»sourûCÁ
, 
NULL
, 0);

652 (*
	gshd»sCÁ
)++;

653 
shmdt
(
shd»sCÁ
);

655 
	gdocLßd”
->
£tLßdInProg»ss
(
Œue
);

656 
	g»sourû
->
d©a
(
lßd”
->
»sourûD©a
(), 
Œue
);

657 
	g»sourû
->
fšish
();

661 ià(!
	g»sourû
->
”rÜOccu¼ed
()) {

662 
	g£g_»sourûCÁ
 = 
shmg‘
(3333, 
PAGE_SIZE
, 0666);

663 * 
	gshd»sCÁ
 = (*)
shm©
(
£g_»sourûCÁ
, 
NULL
, 0);

664 (*
	gshd»sCÁ
)++;

665 
shmdt
(
shd»sCÁ
);

667 
	gdocLßd”
->
£tLßdInProg»ss
(
Œue
);

668 
	g»sourû
->
d©a
(
lßd”
->
»sourûD©a
(), 
Œue
);

669 
	g»sourû
->
fšish
();

674 #iâdeà
SSLAB_SR


677 ià(!
	g»sourû
->
”rÜOccu¼ed
()) {

678 
	gdocLßd”
->
£tLßdInProg»ss
(
Œue
);

679 
	g»sourû
->
d©a
(
lßd”
->
»sourûD©a
(), 
Œue
);

680 
	g»sourû
->
fšish
();

684 
d–‘e
 
	g»que¡
;

686 
	gdocLßd”
->
£tLßdInProg»ss
(
çl£
);

688 
	gdocLßd”
->
checkFÜP’dšgP»lßds
();

690 #ià
REQUEST_DEBUG


691 
KURL
 
u
(
P¬£dURLSŒšg
, 
»sourû
->
u¾
());

692 
´štf
("HOST % COUNT %d RECEIVED %s\n", 
u
.
ho¡
().
Ïtš1
().
d©a
(), 
m_»que¡sLßdšg
.
size
(), 
»sourû
->
u¾
().latin1().data());

694 
£rveP’dšgReque¡s
();

697 
	gLßd”
::
Ho¡
::
didFa
(
Sub»sourûLßd”
* 
lßd”
, cÚ¡ 
ResourûE¼Ü
&)

699 #ifdeà
SSLAB__DEBUG


700 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

703 
didFa
(
lßd”
);

706 #ifdeà
SSLAB_SR


707 
	gLßd”
::
Ho¡
::
ş—rFÜR–ßd
(
Reque¡
* 
»que¡
, 
Sub»sourûLßd”
* 
lßd”
, 
boŞ
 
ÿnûÎed
)

709 #ifdeà
SSLAB__DEBUG


710 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

713 
	gRefPŒ
<
	gHo¡
> 
myPrÙeùÜ
(
this
);

715 
	glßd”
->
ş—rCl›Á
();

717 
DocLßd”
* 
	gdocLßd”
 = 
»que¡
->
docLßd”
();

720 
	gRefPŒ
<
	gDocum’t
> 
´ÙeùÜ
(
docLßd”
->
doc
());

723 
CachedResourû
* 
	g»sourû
 = 
»que¡
->
ÿchedResourû
();

725 ià(
	g»sourû
->
»sourûToRev®id©e
())

726 
ÿche
()->
»v®id©iÚFaed
(
»sourû
);

728 ià(!
	gÿnûÎed
) {

729 
	gdocLßd”
->
£tLßdInProg»ss
(
Œue
);

730 
	g»sourû
->
”rÜ
();

739 
	g»sourû
->
toNuÎReque¡
();

745 
	gLßd”
::
Ho¡
::
didFa
(
Sub»sourûLßd”
* 
lßd”
, 
boŞ
 
ÿnûÎed
)

747 #ifdeà
SSLAB__DEBUG


748 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

751 
	gRefPŒ
<
	gHo¡
> 
myPrÙeùÜ
(
this
);

753 
	glßd”
->
ş—rCl›Á
();

755 
	gReque¡M­
::
™”©Ü
 
i
 = 
m_»que¡sLßdšg
.
fšd
(
lßd”
);

756 ià(
	gi
 =ğ
m_»que¡sLßdšg
.
’d
())

759 
Reque¡
* 
	g»que¡
 = 
i
->
£cÚd
;

760 
	gm_»que¡sLßdšg
.
»move
(
i
);

761 
DocLßd”
* 
	gdocLßd”
 = 
»que¡
->
docLßd”
();

764 
	gRefPŒ
<
	gDocum’t
> 
´ÙeùÜ
(
docLßd”
->
doc
());

765 ià(!
	g»que¡
->
isMuÉ¬t
())

766 
	gdocLßd”
->
deüem’tReque¡CouÁ
();

768 
CachedResourû
* 
	g»sourû
 = 
»que¡
->
ÿchedResourû
();

770 ià(
	g»sourû
->
»sourûToRev®id©e
())

771 
ÿche
()->
»v®id©iÚFaed
(
»sourû
);

773 ià(!
	gÿnûÎed
) {

774 
	gdocLßd”
->
£tLßdInProg»ss
(
Œue
);

775 
	g»sourû
->
”rÜ
();

778 
	gdocLßd”
->
£tLßdInProg»ss
(
çl£
);

779 ià(
	gÿnûÎed
 || !
	g»sourû
->
isP»lßded
())

780 
ÿche
()->
»move
(
»sourû
);

782 
d–‘e
 
	g»que¡
;

784 
	gdocLßd”
->
checkFÜP’dšgP»lßds
();

786 
£rveP’dšgReque¡s
();

789 
	gLßd”
::
Ho¡
::
didReûiveRe¥Ú£
(
Sub»sourûLßd”
* 
lßd”
, cÚ¡ 
ResourûRe¥Ú£
& 
»¥Ú£
)

791 #ifdeà
SSLAB__DEBUG


792 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

795 
	gRefPŒ
<
	gHo¡
> 
´ÙeùÜ
(
this
);

797 
Reque¡
* 
	g»que¡
 = 
m_»que¡sLßdšg
.
g‘
(
lßd”
);

805 ià(!
	g»que¡
)

808 
CachedResourû
* 
	g»sourû
 = 
»que¡
->
ÿchedResourû
();

810 ià(
	g»sourû
->
isCacheV®id©Ü
()) {

811 ià(
	g»¥Ú£
.
h‰pStusCode
() == 304) {

813 
m_»que¡sLßdšg
.
»move
(
lßd”
);

814 
	glßd”
->
ş—rCl›Á
();

815 
	g»que¡
->
docLßd”
()->
deüem’tReque¡CouÁ
();

818 
ÿche
()->
»v®id©iÚSucûeded
(
»sourû
, 
»¥Ú£
);

820 ià(
	g»que¡
->
docLßd”
()->
äame
())

821 
	g»que¡
->
docLßd”
()->
äame
()->
lßd”
()->
checkCom¶‘ed
();

823 
d–‘e
 
	g»que¡
;

825 
£rveP’dšgReque¡s
();

829 
ÿche
()->
»v®id©iÚFaed
(
»sourû
);

832 
	g»sourû
->
£tRe¥Ú£
(
»¥Ú£
);

834 
SŒšg
 
	g’codšg
 = 
»¥Ú£
.
‹xtEncodšgName
();

835 ià(!
	g’codšg
.
isNuÎ
())

836 
	g»sourû
->
£tEncodšg
(
’codšg
);

838 ià(
	g»que¡
->
isMuÉ¬t
()) {

839 
ASSERT
(
»sourû
->
isImage
());

840 
	g¡©ic_ÿ¡
<
	gCachedImage
*>(
	g»sourû
)->
ş—r
();

841 ià(
	g»que¡
->
docLßd”
()->
äame
())

842 
	g»que¡
->
docLßd”
()->
äame
()->
lßd”
()->
checkCom¶‘ed
();

843 } ià(
	g»¥Ú£
.
isMuÉ¬t
()) {

844 
	g»que¡
->
£tIsMuÉ¬t
(
Œue
);

847 
	g»que¡
->
docLßd”
()->
deüem’tReque¡CouÁ
();

850 
ASSERT
(
lßd”
->
hªdË
());

851 ià(!
	g»sourû
->
isImage
())

852 
	glßd”
->
hªdË
()->
ÿnûl
();

856 
	gLßd”
::
Ho¡
::
didReûiveD©a
(
Sub»sourûLßd”
* 
lßd”
, cÚ¡ * 
d©a
, 
size
)

858 #ifdeà
SSLAB__DEBUG


859 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

862 
	gRefPŒ
<
	gHo¡
> 
´ÙeùÜ
(
this
);

864 
Reque¡
* 
	g»que¡
 = 
m_»que¡sLßdšg
.
g‘
(
lßd”
);

865 ià(!
	g»que¡
)

868 
CachedResourû
* 
	g»sourû
 = 
»que¡
->
ÿchedResourû
();

869 
ASSERT
(!
»sourû
->
isCacheV®id©Ü
());

871 ià(
	g»sourû
->
”rÜOccu¼ed
())

874 ià(
	g»sourû
->
»¥Ú£
().
h‰pStusCode
() / 100 == 4) {

877 
»sourû
->
h‰pStusCodeE¼Ü
();

882 ià(
	g»que¡
->
isMuÉ¬t
()) {

885 
	gRefPŒ
<
	gSh¬edBufãr
> 
	gcİ›dD©a
 = 
Sh¬edBufãr
::
ü—‹
(
d©a
, 
size
);

886 
	g»sourû
->
d©a
(
cİ›dD©a
.
»Ëa£
(), 
Œue
);

887 } ià(
	g»que¡
->
isInüem’l
())

888 
	g»sourû
->
d©a
(
lßd”
->
»sourûD©a
(), 
çl£
);

891 
	gLßd”
::
Ho¡
::
ÿnûlP’dšgReque¡s
(
Reque¡Queue
& 
»que¡sP’dšg
, 
DocLßd”
* 
docLßd”
)

893 #ifdeà
SSLAB__DEBUG


894 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

897 
Reque¡Queue
 
	g»maššg
;

898 
	gReque¡Queue
::
™”©Ü
 
’d
 = 
»que¡sP’dšg
.end();

899 
	gReque¡Queue
::
™”©Ü
 
™
 = 
»que¡sP’dšg
.
begš
(); 
	g™
 !ğ
’d
; ++it) {

900 
Reque¡
* 
	g»que¡
 = *
™
;

901 ià(
	g»que¡
->
docLßd”
() == docLoader) {

902 
ÿche
()->
»move
(
»que¡
->
ÿchedResourû
());

903 
d–‘e
 
	g»que¡
;

904 
	gdocLßd”
->
deüem’tReque¡CouÁ
();

906 
	g»maššg
.
­³nd
(
»que¡
);

908 
	g»que¡sP’dšg
.
sw­
(
»maššg
);

911 
	gLßd”
::
Ho¡
::
ÿnûlReque¡s
(
DocLßd”
* 
docLßd”
)

913 #ifdeà
SSLAB__DEBUG


914 
qW¬nšg
("[s¦ab][%s][tid %lu] %s:%d:%s",
QD©eTime
::
cu¼’tD©eTime
().
toSŒšg
("dd.MM.yyy hh:mm:ss.zzz").
toAscii
().
d©a
(), 
QTh»ad
::
cu¼’tTh»adId
(), 
__FILE__
,
__LINE__
,
__func__
);

917 
	gp
 = 0;… <ğ
High
;…++)

918 
ÿnûlP’dšgReque¡s
(
m_»que¡sP’dšg
[
p
], 
docLßd”
);

920 
	gVeùÜ
<
	gSub»sourûLßd”
*, 256> 
	glßd”sToCªûl
;

922 
	gReque¡M­
::
™”©Ü
 
’d
 = 
m_»que¡sLßdšg
.end();

923 
	gReque¡M­
::
™”©Ü
 
i
 = 
m_»que¡sLßdšg
.
begš
(); 
	gi
 !ğ
’d
; ++i) {

924 
Reque¡
* 
	gr
 = 
i
->
£cÚd
;

925 ià(
	gr
->
docLßd”
() == docLoader)

926 
lßd”sToCªûl
.
­³nd
(
i
->
fœ¡
.
g‘
());

929 
	gi
 = 0; i < 
	glßd”sToCªûl
.
size
(); ++i) {

930 
Sub»sourûLßd”
* 
	glßd”
 = 
lßd”sToCªûl
[
i
];

931 
didFa
(
lßd”
, 
Œue
);

	@loader.h

22 #iâdeà
lßd”_h


23 
	#lßd”_h


	)

25 
	~"AtomicSŒšg.h
"

26 
	~"AtomicSŒšgIm¶.h
"

27 
	~"F¿meLßd”Ty³s.h
"

28 
	~"PÏtfÜmSŒšg.h
"

29 
	~"Sub»sourûLßd”Cl›Á.h
"

30 
	~"Tim”.h
"

31 
	~<wtf/Deque.h
>

32 
	~<wtf/HashM­.h
>

33 
	~<wtf/NÚcİyabË.h
>

35 #iâdeà
SSLAB_SR


36 
	#SSLAB_SR


	)

39 
Çme¥aû
 
	gWebCÜe
 {

41 
şass
 
	gCachedResourû
;

42 
şass
 
	gDocLßd”
;

43 
şass
 
	gKURL
;

44 
şass
 
	gReque¡
;

46 şas 
	cLßd”
 : 
public
 
NÚcİyabË
 {

47 
public
:

48 
Lßd”
();

49 ~
Lßd”
();

51 
lßd
(
DocLßd”
*, 
CachedResourû
*, 
boŞ
 
šüem’l
 = 
Œue
, 
Secur™yCheckPŞicy
 = 
DoSecur™yCheck
, boŞ 
£ndResourûLßdC®lbacks
 =rue);

52 
»Lßd
();

55 
ÿnûlReque¡s
(
DocLßd”
*);

57 
	ePriÜ™y
 { 
	gLow
, 
	gMedium
, 
	gHigh
 };

58 
£rveP’dšgReque¡s
(
PriÜ™y
 
mšimumPriÜ™y
 = 
Low
);

60 
boŞ
 
isSu¥’dšgP’dšgReque¡s
(è{  
	gm_isSu¥’dšgP’dšgReque¡s
; }

61 
su¥’dP’dšgReque¡s
();

62 
»sumeP’dšgReque¡s
();

64 
nÚCacheReque¡InFlight
(cÚ¡ 
KURL
&);

65 
nÚCacheReque¡Com¶‘e
(cÚ¡ 
KURL
&);

67 
	g´iv©e
:

68 
PriÜ™y
 
d‘”mšePriÜ™y
(cÚ¡ 
CachedResourû
*) const;

69 
scheduËS”veP’dšgReque¡s
();

71 
»que¡Tim”Fœed
(
Tim”
<
Lßd”
>*);

74 
şass
 
	gHo¡
 : 
public
 
RefCouÁed
<
Ho¡
>, 
´iv©e
 
	gSub»sourûLßd”Cl›Á
 {

75 
ä›nd
 
şass
 
	gCache
;

76 
	gpublic
:

77 
PassRefPŒ
<
Ho¡
> 
ü—‹
(cÚ¡ 
AtomicSŒšg
& 
Çme
, 
maxReque¡sInFlight
)

79  
adİtRef
(
Ãw
 
Ho¡
(
Çme
, 
maxReque¡sInFlight
));

81 ~
Ho¡
();

83 cÚ¡ 
	gAtomicSŒšg
& 
Çme
(ècÚ¡ {  
	gm_Çme
; }

84 
addReque¡
(
Reque¡
*, 
PriÜ™y
);

85 
nÚCacheReque¡InFlight
();

86 
nÚCacheReque¡Com¶‘e
();

87 
£rveP’dšgReque¡s
(
PriÜ™y
 
mšimumPriÜ™y
 = 
Low
);

88 
ÿnûlReque¡s
(
DocLßd”
*);

89 
boŞ
 
hasReque¡s
() const;

91 
boŞ
 
´oûssšgResourû
(ècÚ¡ {  
	gm_numResourûsProûssšg
 !ğ0 || 
m_nÚCachedReque¡sInFlight
 !=0; }

92 
	g´iv©e
:

93 
Ho¡
(cÚ¡ 
AtomicSŒšg
&, );

95 
vœtu®
 
didReûiveRe¥Ú£
(
Sub»sourûLßd”
*, cÚ¡ 
ResourûRe¥Ú£
&);

96 
vœtu®
 
didReûiveD©a
(
Sub»sourûLßd”
*, const *, );

97 
vœtu®
 
didFšishLßdšg
(
Sub»sourûLßd”
*);

98 
vœtu®
 
didFa
(
Sub»sourûLßd”
*, cÚ¡ 
ResourûE¼Ü
&);

100 
	gDeque
<
	tReque¡
*> 
	tReque¡Queue
;

101 
£rveP’dšgReque¡s
(
Reque¡Queue
& 
»que¡sP’dšg
, 
boŞ
& 
£rveLow”PriÜ™y
);

102 #ifdeà
SSLAB_SR


103 
ş—rFÜR–ßd
(
Reque¡
* 
»que¡
, 
Sub»sourûLßd”
*, 
boŞ
 
ÿnûÎed
 = 
çl£
);

105 
didFa
(
Sub»sourûLßd”
*, 
boŞ
 
ÿnûÎed
 = 
çl£
);

106 
ÿnûlP’dšgReque¡s
(
Reque¡Queue
& 
»que¡sP’dšg
, 
DocLßd”
*);

108 
Reque¡Queue
 
	gm_»que¡sP’dšg
[
High
 + 1];

109 
	gHashM­
<
	tRefPŒ
<
	tSub»sourûLßd”
>, 
	tReque¡
*> 
	tReque¡M­
;

110 
Reque¡M­
 
	gm_»que¡sLßdšg
;

111 cÚ¡ 
AtomicSŒšg
 
	gm_Çme
;

112 cÚ¡ 
	gm_maxReque¡sInFlight
;

113 
	gm_numResourûsProûssšg
;

114 
	gm_nÚCachedReque¡sInFlight
;

116 
qšt64
 
	gÿcheTime
;

118 
	gHashM­
<
	tAtomicSŒšgIm¶
*, 
	tRefPŒ
<
	tHo¡
> > 
	tHo¡M­
;

119 
Ho¡M­
 
	gm_ho¡s
;

120 
	gRefPŒ
<
	gHo¡
> 
	gm_nÚHTTPPrÙocŞHo¡
;

122 
	gTim”
<
	gLßd”
> 
	gm_»que¡Tim”
;

124 
boŞ
 
	gm_isSu¥’dšgP’dšgReque¡s
;

127 
DocLßd”
* 
	g¤DocLßd”
;

128 
CachedResourû
* 
	g¤Resourû
;

130 
boŞ
 
	g¤Inüem’l
;

131 
Secur™yCheckPŞicy
 
	g¤Secur™yCheck
;

132 
boŞ
 
	g¤S’dResourûLßdC®lbacks
;

	@/usr/include/limits.h

22 #iâdeà
_LIBC_LIMITS_H_


23 
	#_LIBC_LIMITS_H_
 1

	)

25 
	~<ã©u»s.h
>

31 
	#MB_LEN_MAX
 16

	)

36 #ià!
defšed
 
__GNUC__
 || __GNUC__ < 2

41 #iâdeà
_LIMITS_H


42 
	#_LIMITS_H
 1

	)

44 
	~<b™s/wÜdsize.h
>

53 
	#CHAR_BIT
 8

	)

56 
	#SCHAR_MIN
 (-128)

	)

57 
	#SCHAR_MAX
 127

	)

60 
	#UCHAR_MAX
 255

	)

63 #ifdeà
__CHAR_UNSIGNED__


64 
	#CHAR_MIN
 0

	)

65 
	#CHAR_MAX
 
UCHAR_MAX


	)

67 
	#CHAR_MIN
 
SCHAR_MIN


	)

68 
	#CHAR_MAX
 
SCHAR_MAX


	)

72 
	#SHRT_MIN
 (-32768)

	)

73 
	#SHRT_MAX
 32767

	)

76 
	#USHRT_MAX
 65535

	)

79 
	#INT_MIN
 (-
INT_MAX
 - 1)

	)

80 
	#INT_MAX
 2147483647

	)

83 
	#UINT_MAX
 4294967295U

	)

86 #ià
__WORDSIZE
 == 64

87 
	#LONG_MAX
 9223372036854775807L

	)

89 
	#LONG_MAX
 2147483647L

	)

91 
	#LONG_MIN
 (-
LONG_MAX
 - 1L)

	)

94 #ià
__WORDSIZE
 == 64

95 
	#ULONG_MAX
 18446744073709551615UL

	)

97 
	#ULONG_MAX
 4294967295UL

	)

100 #ifdeà
__USE_ISOC99


103 
	#LLONG_MAX
 9223372036854775807LL

	)

104 
	#LLONG_MIN
 (-
LLONG_MAX
 - 1LL)

	)

107 
	#ULLONG_MAX
 18446744073709551615ULL

	)

121 #ià
defšed
 
__GNUC__
 && !defšed 
_GCC_LIMITS_H_


123 #šşude_Ãxˆ<
lim™s
.
h
>

129 #ià
defšed
 
__USE_ISOC99
 && defšed 
__GNUC__


130 #iâdeà
LLONG_MIN


131 
	#LLONG_MIN
 (-
LLONG_MAX
-1)

	)

133 #iâdeà
LLONG_MAX


134 
	#LLONG_MAX
 
__LONG_LONG_MAX__


	)

136 #iâdeà
ULLONG_MAX


137 
	#ULLONG_MAX
 (
LLONG_MAX
 * 2ULL + 1)

	)

141 #ifdef 
__USE_POSIX


143 
	~<b™s/posix1_lim.h
>

146 #ifdef 
__USE_POSIX2


147 
	~<b™s/posix2_lim.h
>

150 #ifdef 
__USE_XOPEN


151 
	~<b™s/xİ’_lim.h
>

	@/usr/include/pthread.h

18 #iâdeà
_PTHREAD_H


19 
	#_PTHREAD_H
 1

	)

21 
	~<ã©u»s.h
>

22 
	~<’dŸn.h
>

23 
	~<sched.h
>

24 
	~<time.h
>

26 
	~<b™s/±h»adty³s.h
>

27 
	~<b™s/£tjmp.h
>

28 
	~<b™s/wÜdsize.h
>

34 
	mPTHREAD_CREATE_JOINABLE
,

35 
	#PTHREAD_CREATE_JOINABLE
 
PTHREAD_CREATE_JOINABLE


	)

36 
	mPTHREAD_CREATE_DETACHED


37 
	#PTHREAD_CREATE_DETACHED
 
PTHREAD_CREATE_DETACHED


	)

44 
	mPTHREAD_MUTEX_TIMED_NP
,

45 
	mPTHREAD_MUTEX_RECURSIVE_NP
,

46 
	mPTHREAD_MUTEX_ERRORCHECK_NP
,

47 
	mPTHREAD_MUTEX_ADAPTIVE_NP


48 #ià
defšed
 
__USE_UNIX98
 || defšed 
__USE_XOPEN2K8


50 
	mPTHREAD_MUTEX_NORMAL
 = 
PTHREAD_MUTEX_TIMED_NP
,

51 
	mPTHREAD_MUTEX_RECURSIVE
 = 
PTHREAD_MUTEX_RECURSIVE_NP
,

52 
	mPTHREAD_MUTEX_ERRORCHECK
 = 
PTHREAD_MUTEX_ERRORCHECK_NP
,

53 
	mPTHREAD_MUTEX_DEFAULT
 = 
PTHREAD_MUTEX_NORMAL


55 #ifdeà
__USE_GNU


57 , 
	mPTHREAD_MUTEX_FAST_NP
 = 
PTHREAD_MUTEX_TIMED_NP


62 #ifdeà
__USE_XOPEN2K


66 
	mPTHREAD_MUTEX_STALLED
,

67 
	mPTHREAD_MUTEX_STALLED_NP
 = 
PTHREAD_MUTEX_STALLED
,

68 
	mPTHREAD_MUTEX_ROBUST
,

69 
	mPTHREAD_MUTEX_ROBUST_NP
 = 
PTHREAD_MUTEX_ROBUST


74 #ià
defšed
 
__USE_POSIX199506
 || defšed 
__USE_UNIX98


78 
	mPTHREAD_PRIO_NONE
,

79 
	mPTHREAD_PRIO_INHERIT
,

80 
	mPTHREAD_PRIO_PROTECT


86 #ià
__PTHREAD_MUTEX_HAVE_ELISION
 == 1

87 
	#__PTHREAD_SPINS
 0, 0

	)

88 #–ià
__PTHREAD_MUTEX_HAVE_ELISION
 == 2

89 
	#__PTHREAD_SPINS
 { 0, 0 }

	)

91 
	#__PTHREAD_SPINS
 0

	)

94 #ifdeà
__PTHREAD_MUTEX_HAVE_PREV


95 
	#PTHREAD_MUTEX_INITIALIZER
 \

96 { { 0, 0, 0, 0, 0, 
__PTHREAD_SPINS
, { 0, 0 } } }

	)

97 #ifdeà
__USE_GNU


98 
	#PTHREAD_RECURSIVE_MUTEX_INITIALIZER_NP
 \

99 { { 0, 0, 0, 0, 
PTHREAD_MUTEX_RECURSIVE_NP
, 
__PTHREAD_SPINS
, { 0, 0 } } }

	)

100 
	#PTHREAD_ERRORCHECK_MUTEX_INITIALIZER_NP
 \

101 { { 0, 0, 0, 0, 
PTHREAD_MUTEX_ERRORCHECK_NP
, 
__PTHREAD_SPINS
, { 0, 0 } } }

	)

102 
	#PTHREAD_ADAPTIVE_MUTEX_INITIALIZER_NP
 \

103 { { 0, 0, 0, 0, 
PTHREAD_MUTEX_ADAPTIVE_NP
, 
__PTHREAD_SPINS
, { 0, 0 } } }

	)

104 
	#PTHREAD_ADAPTIVE_MUTEX_INITIALIZER_NP
 \

105 { { 0, 0, 0, 0, 
PTHREAD_MUTEX_ADAPTIVE_NP
, 
__PTHREAD_SPINS
, { 0, 0 } } }

	)

109 
	#PTHREAD_MUTEX_INITIALIZER
 \

110 { { 0, 0, 0, 0, 0, { 
__PTHREAD_SPINS
 } } }

	)

111 #ifdeà
__USE_GNU


112 
	#PTHREAD_RECURSIVE_MUTEX_INITIALIZER_NP
 \

113 { { 0, 0, 0, 
PTHREAD_MUTEX_RECURSIVE_NP
, 0, { 
__PTHREAD_SPINS
 } } }

	)

114 
	#PTHREAD_ERRORCHECK_MUTEX_INITIALIZER_NP
 \

115 { { 0, 0, 0, 
PTHREAD_MUTEX_ERRORCHECK_NP
, 0, { 
__PTHREAD_SPINS
 } } }

	)

116 
	#PTHREAD_ADAPTIVE_MUTEX_INITIALIZER_NP
 \

117 { { 0, 0, 0, 
PTHREAD_MUTEX_ADAPTIVE_NP
, 0, { 
__PTHREAD_SPINS
 } } }

	)

124 #ià
defšed
 
__USE_UNIX98
 || defšed 
__USE_XOPEN2K


127 
	mPTHREAD_RWLOCK_PREFER_READER_NP
,

128 
	mPTHREAD_RWLOCK_PREFER_WRITER_NP
,

129 
	mPTHREAD_RWLOCK_PREFER_WRITER_NONRECURSIVE_NP
,

130 
	mPTHREAD_RWLOCK_DEFAULT_NP
 = 
PTHREAD_RWLOCK_PREFER_READER_NP


136 #iâdeà
__PTHREAD_RWLOCK_INT_FLAGS_SHARED


137 #ià
__WORDSIZE
 == 64

138 
	#__PTHREAD_RWLOCK_INT_FLAGS_SHARED
 1

	)

143 
	#PTHREAD_RWLOCK_INITIALIZER
 \

144 { { 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 } }

	)

145 #ifdeà
__USE_GNU


146 #ifdeà
__PTHREAD_RWLOCK_INT_FLAGS_SHARED


147 
	#PTHREAD_RWLOCK_WRITER_NONRECURSIVE_INITIALIZER_NP
 \

149 
PTHREAD_RWLOCK_PREFER_WRITER_NONRECURSIVE_NP
 } }

	)

151 #ià
__BYTE_ORDER
 =ğ
__LITTLE_ENDIAN


152 
	#PTHREAD_RWLOCK_WRITER_NONRECURSIVE_INITIALIZER_NP
 \

153 { { 0, 0, 0, 0, 0, 0, 
PTHREAD_RWLOCK_PREFER_WRITER_NONRECURSIVE_NP
, \

154 0, 0, 0, 0 } }

	)

156 
	#PTHREAD_RWLOCK_WRITER_NONRECURSIVE_INITIALIZER_NP
 \

157 { { 0, 0, 0, 0, 0, 0, 0, 0, 0, 
PTHREAD_RWLOCK_PREFER_WRITER_NONRECURSIVE_NP
,\

158 0 } }

	)

168 
	mPTHREAD_INHERIT_SCHED
,

169 
	#PTHREAD_INHERIT_SCHED
 
PTHREAD_INHERIT_SCHED


	)

170 
	mPTHREAD_EXPLICIT_SCHED


171 
	#PTHREAD_EXPLICIT_SCHED
 
PTHREAD_EXPLICIT_SCHED


	)

178 
	mPTHREAD_SCOPE_SYSTEM
,

179 
	#PTHREAD_SCOPE_SYSTEM
 
PTHREAD_SCOPE_SYSTEM


	)

180 
	mPTHREAD_SCOPE_PROCESS


181 
	#PTHREAD_SCOPE_PROCESS
 
PTHREAD_SCOPE_PROCESS


	)

188 
	mPTHREAD_PROCESS_PRIVATE
,

189 
	#PTHREAD_PROCESS_PRIVATE
 
PTHREAD_PROCESS_PRIVATE


	)

190 
	mPTHREAD_PROCESS_SHARED


191 
	#PTHREAD_PROCESS_SHARED
 
PTHREAD_PROCESS_SHARED


	)

197 
	#PTHREAD_COND_INITIALIZER
 { { 0, 0, 0, 0, 0, (*è0, 0, 0 } }

	)

201 
	s_±h»ad_ş—nup_bufãr


203 (*
	m__routše
) (*);

204 *
	m__¬g
;

205 
	m__ÿnûÉy³
;

206 
_±h»ad_ş—nup_bufãr
 *
	m__´ev
;

212 
	mPTHREAD_CANCEL_ENABLE
,

213 
	#PTHREAD_CANCEL_ENABLE
 
PTHREAD_CANCEL_ENABLE


	)

214 
	mPTHREAD_CANCEL_DISABLE


215 
	#PTHREAD_CANCEL_DISABLE
 
PTHREAD_CANCEL_DISABLE


	)

219 
	mPTHREAD_CANCEL_DEFERRED
,

220 
	#PTHREAD_CANCEL_DEFERRED
 
PTHREAD_CANCEL_DEFERRED


	)

221 
	mPTHREAD_CANCEL_ASYNCHRONOUS


222 
	#PTHREAD_CANCEL_ASYNCHRONOUS
 
PTHREAD_CANCEL_ASYNCHRONOUS


	)

224 
	#PTHREAD_CANCELED
 ((*è-1)

	)

228 
	#PTHREAD_ONCE_INIT
 0

	)

231 #ifdeà
__USE_XOPEN2K


235 
	#PTHREAD_BARRIER_SERIAL_THREAD
 -1

	)

239 
__BEGIN_DECLS


244 
±h»ad_ü—‹
 (
±h»ad_t
 *
__»¡riù
 
__Ãwth»ad
,

245 cÚ¡ 
±h»ad_©Œ_t
 *
__»¡riù
 
__©Œ
,

246 *(*
__¡¬t_routše
) (*),

247 *
__»¡riù
 
__¬g
è
__THROWNL
 
__nÚnuÎ
 ((1, 3));

253 
	$±h»ad_ex™
 (*
__»tv®
è
	`__©Œibu‹__
 ((
__nÜ‘uº__
));

261 
	`±h»ad_još
 (
±h»ad_t
 
__th
, **
__th»ad_»tuº
);

263 #ifdeà
__USE_GNU


266 
	$±h»ad_Œyjoš_Å
 (
±h»ad_t
 
__th
, **
__th»ad_»tuº
è
__THROW
;

274 
	`±h»ad_timedjoš_Å
 (
±h»ad_t
 
__th
, **
__th»ad_»tuº
,

275 cÚ¡ 
time¥ec
 *
__ab¡ime
);

282 
	$±h»ad_d‘ach
 (
±h»ad_t
 
__th
è
__THROW
;

286 
±h»ad_t
 
	$±h»ad_£lf
 (è
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
));

289 
	$±h»ad_equ®
 (
±h»ad_t
 
__th»ad1
,…th»ad_ˆ
__th»ad2
)

290 
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
));

298 
	$±h»ad_©Œ_š™
 (
±h»ad_©Œ_t
 *
__©Œ
è
__THROW
 
	`__nÚnuÎ
 ((1));

301 
	$±h»ad_©Œ_de¡roy
 (
±h»ad_©Œ_t
 *
__©Œ
)

302 
__THROW
 
	`__nÚnuÎ
 ((1));

305 
	$±h»ad_©Œ_g‘d‘ach¡©e
 (cÚ¡ 
±h»ad_©Œ_t
 *
__©Œ
,

306 *
__d‘ach¡©e
)

307 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

310 
	$±h»ad_©Œ_£td‘ach¡©e
 (
±h»ad_©Œ_t
 *
__©Œ
,

311 
__d‘ach¡©e
)

312 
__THROW
 
	`__nÚnuÎ
 ((1));

316 
	$±h»ad_©Œ_g‘gu¬dsize
 (cÚ¡ 
±h»ad_©Œ_t
 *
__©Œ
,

317 
size_t
 *
__gu¬dsize
)

318 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

321 
	$±h»ad_©Œ_£tgu¬dsize
 (
±h»ad_©Œ_t
 *
__©Œ
,

322 
size_t
 
__gu¬dsize
)

323 
__THROW
 
	`__nÚnuÎ
 ((1));

327 
	$±h»ad_©Œ_g‘sched·¿m
 (cÚ¡ 
±h»ad_©Œ_t
 *
__»¡riù
 
__©Œ
,

328 
sched_·¿m
 *
__»¡riù
 
__·¿m
)

329 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

332 
	$±h»ad_©Œ_£tsched·¿m
 (
±h»ad_©Œ_t
 *
__»¡riù
 
__©Œ
,

333 cÚ¡ 
sched_·¿m
 *
__»¡riù


334 
__·¿m
è
__THROW
 
	`__nÚnuÎ
 ((1, 2));

337 
	$±h»ad_©Œ_g‘schedpŞicy
 (cÚ¡ 
±h»ad_©Œ_t
 *
__»¡riù


338 
__©Œ
, *
__»¡riù
 
__pŞicy
)

339 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

342 
	$±h»ad_©Œ_£tschedpŞicy
 (
±h»ad_©Œ_t
 *
__©Œ
, 
__pŞicy
)

343 
__THROW
 
	`__nÚnuÎ
 ((1));

346 
	$±h»ad_©Œ_g‘šh”™sched
 (cÚ¡ 
±h»ad_©Œ_t
 *
__»¡riù


347 
__©Œ
, *
__»¡riù
 
__šh”™
)

348 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

351 
	$±h»ad_©Œ_£tšh”™sched
 (
±h»ad_©Œ_t
 *
__©Œ
,

352 
__šh”™
)

353 
__THROW
 
	`__nÚnuÎ
 ((1));

357 
	$±h»ad_©Œ_g‘scİe
 (cÚ¡ 
±h»ad_©Œ_t
 *
__»¡riù
 
__©Œ
,

358 *
__»¡riù
 
__scİe
)

359 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

362 
	$±h»ad_©Œ_£tscİe
 (
±h»ad_©Œ_t
 *
__©Œ
, 
__scİe
)

363 
__THROW
 
	`__nÚnuÎ
 ((1));

366 
	$±h»ad_©Œ_g‘¡ackaddr
 (cÚ¡ 
±h»ad_©Œ_t
 *
__»¡riù


367 
__©Œ
, **
__»¡riù
 
__¡ackaddr
)

368 
__THROW
 
	`__nÚnuÎ
 ((1, 2)è
__©Œibu‹_d•»ÿ‹d__
;

374 
	$±h»ad_©Œ_£t¡ackaddr
 (
±h»ad_©Œ_t
 *
__©Œ
,

375 *
__¡ackaddr
)

376 
__THROW
 
	`__nÚnuÎ
 ((1)è
__©Œibu‹_d•»ÿ‹d__
;

379 
	$±h»ad_©Œ_g‘¡acksize
 (cÚ¡ 
±h»ad_©Œ_t
 *
__»¡riù


380 
__©Œ
, 
size_t
 *
__»¡riù
 
__¡acksize
)

381 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

386 
	$±h»ad_©Œ_£t¡acksize
 (
±h»ad_©Œ_t
 *
__©Œ
,

387 
size_t
 
__¡acksize
)

388 
__THROW
 
	`__nÚnuÎ
 ((1));

390 #ifdeà
__USE_XOPEN2K


392 
	$±h»ad_©Œ_g‘¡ack
 (cÚ¡ 
±h»ad_©Œ_t
 *
__»¡riù
 
__©Œ
,

393 **
__»¡riù
 
__¡ackaddr
,

394 
size_t
 *
__»¡riù
 
__¡acksize
)

395 
__THROW
 
	`__nÚnuÎ
 ((1, 2, 3));

400 
	$±h»ad_©Œ_£t¡ack
 (
±h»ad_©Œ_t
 *
__©Œ
, *
__¡ackaddr
,

401 
size_t
 
__¡acksize
è
__THROW
 
	`__nÚnuÎ
 ((1));

404 #ifdeà
__USE_GNU


407 
	$±h»ad_©Œ_£ffš™y_Å
 (
±h»ad_©Œ_t
 *
__©Œ
,

408 
size_t
 
__ıu£tsize
,

409 cÚ¡ 
ıu_£t_t
 *
__ıu£t
)

410 
__THROW
 
	`__nÚnuÎ
 ((1, 3));

414 
	$±h»ad_©Œ_g‘affš™y_Å
 (cÚ¡ 
±h»ad_©Œ_t
 *
__©Œ
,

415 
size_t
 
__ıu£tsize
,

416 
ıu_£t_t
 *
__ıu£t
)

417 
__THROW
 
	`__nÚnuÎ
 ((1, 3));

420 
	$±h»ad_g‘©Œ_deçuÉ_Å
 (
±h»ad_©Œ_t
 *
__©Œ
)

421 
__THROW
 
	`__nÚnuÎ
 ((1));

425 
	$±h»ad_£‰r_deçuÉ_Å
 (cÚ¡ 
±h»ad_©Œ_t
 *
__©Œ
)

426 
__THROW
 
	`__nÚnuÎ
 ((1));

431 
	$±h»ad_g‘©Œ_Å
 (
±h»ad_t
 
__th
, 
±h»ad_©Œ_t
 *
__©Œ
)

432 
__THROW
 
	`__nÚnuÎ
 ((2));

440 
	$±h»ad_£tsched·¿m
 (
±h»ad_t
 
__rg‘_th»ad
, 
__pŞicy
,

441 cÚ¡ 
sched_·¿m
 *
__·¿m
)

442 
__THROW
 
	`__nÚnuÎ
 ((3));

445 
	$±h»ad_g‘sched·¿m
 (
±h»ad_t
 
__rg‘_th»ad
,

446 *
__»¡riù
 
__pŞicy
,

447 
sched_·¿m
 *
__»¡riù
 
__·¿m
)

448 
__THROW
 
	`__nÚnuÎ
 ((2, 3));

451 
	$±h»ad_£tsched´io
 (
±h»ad_t
 
__rg‘_th»ad
, 
__´io
)

452 
__THROW
;

455 #ifdeà
__USE_GNU


457 
	$±h»ad_g‘Çme_Å
 (
±h»ad_t
 
__rg‘_th»ad
, *
__buf
,

458 
size_t
 
__buæ’
)

459 
__THROW
 
	`__nÚnuÎ
 ((2));

462 
	$±h»ad_£Šame_Å
 (
±h»ad_t
 
__rg‘_th»ad
, cÚ¡ *
__Çme
)

463 
__THROW
 
	`__nÚnuÎ
 ((2));

467 #ifdeà
__USE_UNIX98


469 
	$±h»ad_g‘cÚcu¼’cy
 (è
__THROW
;

472 
	$±h»ad_£tcÚcu¼’cy
 (
__Ëv–
è
__THROW
;

475 #ifdeà
__USE_GNU


480 
	$±h»ad_y›ld
 (è
__THROW
;

485 
	$±h»ad_£ffš™y_Å
 (
±h»ad_t
 
__th
, 
size_t
 
__ıu£tsize
,

486 cÚ¡ 
ıu_£t_t
 *
__ıu£t
)

487 
__THROW
 
	`__nÚnuÎ
 ((3));

490 
	$±h»ad_g‘affš™y_Å
 (
±h»ad_t
 
__th
, 
size_t
 
__ıu£tsize
,

491 
ıu_£t_t
 *
__ıu£t
)

492 
__THROW
 
	`__nÚnuÎ
 ((3));

505 
	`±h»ad_Úû
 (
±h»ad_Úû_t
 *
__Úû_cÚŒŞ
,

506 (*
__š™_routše
è()è
	`__nÚnuÎ
 ((1, 2));

517 
	`±h»ad_£tÿnûl¡©e
 (
__¡©e
, *
__Şd¡©e
);

521 
	`±h»ad_£tÿnûÉy³
 (
__ty³
, *
__Şdty³
);

524 
	`±h»ad_ÿnûl
 (
±h»ad_t
 
__th
);

529 
	`±h»ad_‹¡ÿnûl
 ();

538 
__jmp_buf
 
__ÿnûl_jmp_buf
;

539 
__mask_was_§ved
;

540 } 
__ÿnûl_jmp_buf
[1];

541 *
__·d
[4];

542 } 
	t__±h»ad_unwšd_buf_t
 
	t__©Œibu‹__
 ((
	t__®igÃd__
));

545 #iâdeà
__ş—nup_fù_©Œibu‹


546 
	#__ş—nup_fù_©Œibu‹


	)

551 
	s__±h»ad_ş—nup_äame


553 (*
__ÿnûl_routše
) (*);

554 *
__ÿnûl_¬g
;

555 
__do_™
;

556 
__ÿnûl_ty³
;

559 #ià
defšed
 
__GNUC__
 && defšed 
__EXCEPTIONS


560 #ifdeà
__ılu¥lus


562 şas 
	c__±h»ad_ş—nup_şass


564 (*
__ÿnûl_routše
) (*);

565 *
__ÿnûl_¬g
;

566 
__do_™
;

567 
__ÿnûl_ty³
;

569 
public
:

570 
	`__±h»ad_ş—nup_şass
 ((*
__fù
è(*), *
__¬g
)

571 : 
	`__ÿnûl_routše
 (
__fù
), 
	`__ÿnûl_¬g
 (
__¬g
), 
	$__do_™
 (1) { }

572 ~
	$__±h»ad_ş—nup_şass
 (è{ ià(
__do_™
è
	`__ÿnûl_routše
 (
__ÿnûl_¬g
); 
	}
}

573 
	$__£tdo™
 (
__Ãwv®
è{ 
__do_™
 = __Ãwv®; 
	}
}

574 
	$__deãr
 (è{ 
	`±h»ad_£tÿnûÉy³
 (
PTHREAD_CANCEL_DEFERRED
,

575 &
__ÿnûl_ty³
); 
	}
}

576 
	$__»¡Üe
 (ècÚ¡ { 
	`±h»ad_£tÿnûÉy³
 (
__ÿnûl_ty³
, 0); 
	}
}

586 
	#±h»ad_ş—nup_push
(
routše
, 
¬g
) \

588 
__±h»ad_ş—nup_şass
 
	`__şäame
 (
routše
, 
¬g
)

	)

592 
	#±h»ad_ş—nup_pİ
(
execu‹
) \

593 
__şäame
.
	`__£tdo™
 (
execu‹
); \

594 } 0)

	)

596 #ifdeà
__USE_GNU


600 
	#±h»ad_ş—nup_push_deãr_Å
(
routše
, 
¬g
) \

602 
__±h»ad_ş—nup_şass
 
	`__şäame
 (
routše
, 
¬g
); \

603 
__şäame
.
	`__deãr
 ()

	)

608 
	#±h»ad_ş—nup_pİ_»¡Üe_Å
(
execu‹
) \

609 
__şäame
.
	`__»¡Üe
 (); \

610 
__şäame
.
	`__£tdo™
 (
execu‹
); \

611 } 0)

	)

618 
__ex‹º_šlše
 

619 
	$__±h»ad_ş—nup_routše
 (
__±h»ad_ş—nup_äame
 *
__äame
)

621 ià(
__äame
->
__do_™
)

622 
__äame
->
	`__ÿnûl_routše
 (__äame->
__ÿnûl_¬g
);

623 
	}
}

632 
	#±h»ad_ş—nup_push
(
routše
, 
¬g
) \

634 
__±h»ad_ş—nup_äame
 
__şäame
 \

635 
	`__©Œibu‹__
 ((
	`__ş—nup__
 (
__±h»ad_ş—nup_routše
))) \

636 ğ{ .
__ÿnûl_routše
 = (
routše
), .
__ÿnûl_¬g
 = (
¬g
), \

637 .
__do_™
 = 1 };

	)

641 
	#±h»ad_ş—nup_pİ
(
execu‹
) \

642 
__şäame
.
__do_™
 = (
execu‹
); \

643 } 0)

	)

645 #ifdeà
__USE_GNU


649 
	#±h»ad_ş—nup_push_deãr_Å
(
routše
, 
¬g
) \

651 
__±h»ad_ş—nup_äame
 
__şäame
 \

652 
	`__©Œibu‹__
 ((
	`__ş—nup__
 (
__±h»ad_ş—nup_routše
))) \

653 ğ{ .
__ÿnûl_routše
 = (
routše
), .
__ÿnûl_¬g
 = (
¬g
), \

654 .
__do_™
 = 1 }; \

655 (è
	`±h»ad_£tÿnûÉy³
 (
PTHREAD_CANCEL_DEFERRED
, \

656 &
__şäame
.
__ÿnûl_ty³
)

	)

661 
	#±h»ad_ş—nup_pİ_»¡Üe_Å
(
execu‹
) \

662 (è
	`±h»ad_£tÿnûÉy³
 (
__şäame
.
__ÿnûl_ty³
, 
NULL
); \

663 
__şäame
.
__do_™
 = (
execu‹
); \

664 } 0)

	)

675 
	#±h»ad_ş—nup_push
(
routše
, 
¬g
) \

677 
__±h»ad_unwšd_buf_t
 
__ÿnûl_buf
; \

678 (*
__ÿnûl_routše
è(*èğ(
routše
); \

679 *
__ÿnûl_¬g
 = (
¬g
); \

680 
__nÙ_fœ¡_ÿÎ
 = 
	`__sig£tjmp
 ((
__jmp_buf_g
 *) (*) \

681 
__ÿnûl_buf
.
__ÿnûl_jmp_buf
, 0); \

682 ià(
	`__glibc_uÆik–y
 (
__nÙ_fœ¡_ÿÎ
)) \

684 
	`__ÿnûl_routše
 (
__ÿnûl_¬g
); \

685 
	`__±h»ad_unwšd_Ãxt
 (&
__ÿnûl_buf
); \

689 
	`__±h»ad_»gi¡”_ÿnûl
 (&
__ÿnûl_buf
); \

690 dØ{

	)

691 
__±h»ad_»gi¡”_ÿnûl
 (
__±h»ad_unwšd_buf_t
 *
__buf
)

692 
__ş—nup_fù_©Œibu‹
;

696 
	#±h»ad_ş—nup_pİ
(
execu‹
) \

699 
	`__±h»ad_uÄegi¡”_ÿnûl
 (&
__ÿnûl_buf
); \

700 ià(
execu‹
) \

701 
	`__ÿnûl_routše
 (
__ÿnûl_¬g
); \

702 } 0)

	)

703 
	$__±h»ad_uÄegi¡”_ÿnûl
 (
__±h»ad_unwšd_buf_t
 *
__buf
)

704 
__ş—nup_fù_©Œibu‹
;

706 #ifdeà
__USE_GNU


710 
	#±h»ad_ş—nup_push_deãr_Å
(
routše
, 
¬g
) \

712 
__±h»ad_unwšd_buf_t
 
__ÿnûl_buf
; \

713 (*
__ÿnûl_routše
è(*èğ(
routše
); \

714 *
__ÿnûl_¬g
 = (
¬g
); \

715 
__nÙ_fœ¡_ÿÎ
 = 
	`__sig£tjmp
 ((
__jmp_buf_g
 *) (*) \

716 
__ÿnûl_buf
.
__ÿnûl_jmp_buf
, 0); \

717 ià(
	`__glibc_uÆik–y
 (
__nÙ_fœ¡_ÿÎ
)) \

719 
	`__ÿnûl_routše
 (
__ÿnûl_¬g
); \

720 
	`__±h»ad_unwšd_Ãxt
 (&
__ÿnûl_buf
); \

724 
	`__±h»ad_»gi¡”_ÿnûl_deãr
 (&
__ÿnûl_buf
); \

725 dØ{

	)

726 
	`__±h»ad_»gi¡”_ÿnûl_deãr
 (
__±h»ad_unwšd_buf_t
 *
__buf
)

727 
__ş—nup_fù_©Œibu‹
;

732 
	#±h»ad_ş—nup_pİ_»¡Üe_Å
(
execu‹
) \

735 
	`__±h»ad_uÄegi¡”_ÿnûl_»¡Üe
 (&
__ÿnûl_buf
); \

736 ià(
execu‹
) \

737 
	`__ÿnûl_routše
 (
__ÿnûl_¬g
); \

738 
	}
} 0)

	)

739 
	$__±h»ad_uÄegi¡”_ÿnûl_»¡Üe
 (
__±h»ad_unwšd_buf_t
 *
__buf
)

740 
__ş—nup_fù_©Œibu‹
;

744 
	$__±h»ad_unwšd_Ãxt
 (
__±h»ad_unwšd_buf_t
 *
__buf
)

745 
__ş—nup_fù_©Œibu‹
 
	`__©Œibu‹__
 ((
__nÜ‘uº__
))

746 #iâdeà
SHARED


747 
	`__©Œibu‹__
 ((
__w—k__
))

753 
__jmp_buf_g
;

754 
	$__sig£tjmp
 (
__jmp_buf_g
 *
__’v
, 
__§vemask
è
__THROWNL
;

760 
	$±h»ad_mu‹x_š™
 (
±h»ad_mu‹x_t
 *
__mu‹x
,

761 cÚ¡ 
±h»ad_mu‹x©Œ_t
 *
__mu‹x©Œ
)

762 
__THROW
 
	`__nÚnuÎ
 ((1));

765 
	$±h»ad_mu‹x_de¡roy
 (
±h»ad_mu‹x_t
 *
__mu‹x
)

766 
__THROW
 
	`__nÚnuÎ
 ((1));

769 
	$±h»ad_mu‹x_Œylock
 (
±h»ad_mu‹x_t
 *
__mu‹x
)

770 
__THROWNL
 
	`__nÚnuÎ
 ((1));

773 
	$±h»ad_mu‹x_lock
 (
±h»ad_mu‹x_t
 *
__mu‹x
)

774 
__THROWNL
 
	`__nÚnuÎ
 ((1));

776 #ifdeà
__USE_XOPEN2K


778 
	$±h»ad_mu‹x_timedlock
 (
±h»ad_mu‹x_t
 *
__»¡riù
 
__mu‹x
,

779 cÚ¡ 
time¥ec
 *
__»¡riù


780 
__ab¡ime
è
__THROWNL
 
	`__nÚnuÎ
 ((1, 2));

784 
	$±h»ad_mu‹x_uÆock
 (
±h»ad_mu‹x_t
 *
__mu‹x
)

785 
__THROWNL
 
	`__nÚnuÎ
 ((1));

789 
	$±h»ad_mu‹x_g‘´ioûšg
 (cÚ¡ 
±h»ad_mu‹x_t
 *

790 
__»¡riù
 
__mu‹x
,

791 *
__»¡riù
 
__´ioûšg
)

792 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

796 
	$±h»ad_mu‹x_£rioûšg
 (
±h»ad_mu‹x_t
 *
__»¡riù
 
__mu‹x
,

797 
__´ioûšg
,

798 *
__»¡riù
 
__Şd_ûšg
)

799 
__THROW
 
	`__nÚnuÎ
 ((1, 3));

802 #ifdeà
__USE_XOPEN2K8


804 
	$±h»ad_mu‹x_cÚsi¡’t
 (
±h»ad_mu‹x_t
 *
__mu‹x
)

805 
__THROW
 
	`__nÚnuÎ
 ((1));

806 #ifdeà
__USE_GNU


807 
	$±h»ad_mu‹x_cÚsi¡’t_Å
 (
±h»ad_mu‹x_t
 *
__mu‹x
)

808 
__THROW
 
	`__nÚnuÎ
 ((1));

817 
	$±h»ad_mu‹x©Œ_š™
 (
±h»ad_mu‹x©Œ_t
 *
__©Œ
)

818 
__THROW
 
	`__nÚnuÎ
 ((1));

821 
	$±h»ad_mu‹x©Œ_de¡roy
 (
±h»ad_mu‹x©Œ_t
 *
__©Œ
)

822 
__THROW
 
	`__nÚnuÎ
 ((1));

825 
	$±h»ad_mu‹x©Œ_g‘psh¬ed
 (cÚ¡ 
±h»ad_mu‹x©Œ_t
 *

826 
__»¡riù
 
__©Œ
,

827 *
__»¡riù
 
__psh¬ed
)

828 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

831 
	$±h»ad_mu‹x©Œ_£sh¬ed
 (
±h»ad_mu‹x©Œ_t
 *
__©Œ
,

832 
__psh¬ed
)

833 
__THROW
 
	`__nÚnuÎ
 ((1));

835 #ià
defšed
 
__USE_UNIX98
 || defšed 
__USE_XOPEN2K8


837 
	$±h»ad_mu‹x©Œ_g‘ty³
 (cÚ¡ 
±h»ad_mu‹x©Œ_t
 *
__»¡riù


838 
__©Œ
, *
__»¡riù
 
__kšd
)

839 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

844 
	$±h»ad_mu‹x©Œ_£‰y³
 (
±h»ad_mu‹x©Œ_t
 *
__©Œ
, 
__kšd
)

845 
__THROW
 
	`__nÚnuÎ
 ((1));

849 
	$±h»ad_mu‹x©Œ_g‘´ÙocŞ
 (cÚ¡ 
±h»ad_mu‹x©Œ_t
 *

850 
__»¡riù
 
__©Œ
,

851 *
__»¡riù
 
__´ÙocŞ
)

852 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

856 
	$±h»ad_mu‹x©Œ_£rÙocŞ
 (
±h»ad_mu‹x©Œ_t
 *
__©Œ
,

857 
__´ÙocŞ
)

858 
__THROW
 
	`__nÚnuÎ
 ((1));

861 
	$±h»ad_mu‹x©Œ_g‘´ioûšg
 (cÚ¡ 
±h»ad_mu‹x©Œ_t
 *

862 
__»¡riù
 
__©Œ
,

863 *
__»¡riù
 
__´ioûšg
)

864 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

867 
	$±h»ad_mu‹x©Œ_£rioûšg
 (
±h»ad_mu‹x©Œ_t
 *
__©Œ
,

868 
__´ioûšg
)

869 
__THROW
 
	`__nÚnuÎ
 ((1));

871 #ifdeà
__USE_XOPEN2K


873 
	$±h»ad_mu‹x©Œ_g‘robu¡
 (cÚ¡ 
±h»ad_mu‹x©Œ_t
 *
__©Œ
,

874 *
__robu¡Ãss
)

875 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

876 #ifdeà
__USE_GNU


877 
	$±h»ad_mu‹x©Œ_g‘robu¡_Å
 (cÚ¡ 
±h»ad_mu‹x©Œ_t
 *
__©Œ
,

878 *
__robu¡Ãss
)

879 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

883 
	$±h»ad_mu‹x©Œ_£Œobu¡
 (
±h»ad_mu‹x©Œ_t
 *
__©Œ
,

884 
__robu¡Ãss
)

885 
__THROW
 
	`__nÚnuÎ
 ((1));

886 #ifdeà
__USE_GNU


887 
	$±h»ad_mu‹x©Œ_£Œobu¡_Å
 (
±h»ad_mu‹x©Œ_t
 *
__©Œ
,

888 
__robu¡Ãss
)

889 
__THROW
 
	`__nÚnuÎ
 ((1));

894 #ià
defšed
 
__USE_UNIX98
 || defšed 
__USE_XOPEN2K


899 
	$±h»ad_rwlock_š™
 (
±h»ad_rwlock_t
 *
__»¡riù
 
__rwlock
,

900 cÚ¡ 
±h»ad_rwlock©Œ_t
 *
__»¡riù


901 
__©Œ
è
__THROW
 
	`__nÚnuÎ
 ((1));

904 
	$±h»ad_rwlock_de¡roy
 (
±h»ad_rwlock_t
 *
__rwlock
)

905 
__THROW
 
	`__nÚnuÎ
 ((1));

908 
	$±h»ad_rwlock_rdlock
 (
±h»ad_rwlock_t
 *
__rwlock
)

909 
__THROWNL
 
	`__nÚnuÎ
 ((1));

912 
	$±h»ad_rwlock_Œyrdlock
 (
±h»ad_rwlock_t
 *
__rwlock
)

913 
__THROWNL
 
	`__nÚnuÎ
 ((1));

915 #ifdeà
__USE_XOPEN2K


917 
	$±h»ad_rwlock_timedrdlock
 (
±h»ad_rwlock_t
 *
__»¡riù
 
__rwlock
,

918 cÚ¡ 
time¥ec
 *
__»¡riù


919 
__ab¡ime
è
__THROWNL
 
	`__nÚnuÎ
 ((1, 2));

923 
	$±h»ad_rwlock_w¾ock
 (
±h»ad_rwlock_t
 *
__rwlock
)

924 
__THROWNL
 
	`__nÚnuÎ
 ((1));

927 
	$±h»ad_rwlock_Œyw¾ock
 (
±h»ad_rwlock_t
 *
__rwlock
)

928 
__THROWNL
 
	`__nÚnuÎ
 ((1));

930 #ifdeà
__USE_XOPEN2K


932 
	$±h»ad_rwlock_timedw¾ock
 (
±h»ad_rwlock_t
 *
__»¡riù
 
__rwlock
,

933 cÚ¡ 
time¥ec
 *
__»¡riù


934 
__ab¡ime
è
__THROWNL
 
	`__nÚnuÎ
 ((1, 2));

938 
	$±h»ad_rwlock_uÆock
 (
±h»ad_rwlock_t
 *
__rwlock
)

939 
__THROWNL
 
	`__nÚnuÎ
 ((1));

945 
	$±h»ad_rwlock©Œ_š™
 (
±h»ad_rwlock©Œ_t
 *
__©Œ
)

946 
__THROW
 
	`__nÚnuÎ
 ((1));

949 
	$±h»ad_rwlock©Œ_de¡roy
 (
±h»ad_rwlock©Œ_t
 *
__©Œ
)

950 
__THROW
 
	`__nÚnuÎ
 ((1));

953 
	$±h»ad_rwlock©Œ_g‘psh¬ed
 (cÚ¡ 
±h»ad_rwlock©Œ_t
 *

954 
__»¡riù
 
__©Œ
,

955 *
__»¡riù
 
__psh¬ed
)

956 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

959 
	$±h»ad_rwlock©Œ_£sh¬ed
 (
±h»ad_rwlock©Œ_t
 *
__©Œ
,

960 
__psh¬ed
)

961 
__THROW
 
	`__nÚnuÎ
 ((1));

964 
	$±h»ad_rwlock©Œ_g‘kšd_Å
 (cÚ¡ 
±h»ad_rwlock©Œ_t
 *

965 
__»¡riù
 
__©Œ
,

966 *
__»¡riù
 
__´ef
)

967 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

970 
	$±h»ad_rwlock©Œ_£tkšd_Å
 (
±h»ad_rwlock©Œ_t
 *
__©Œ
,

971 
__´ef
è
__THROW
 
	`__nÚnuÎ
 ((1));

979 
	$±h»ad_cÚd_š™
 (
±h»ad_cÚd_t
 *
__»¡riù
 
__cÚd
,

980 cÚ¡ 
±h»ad_cÚd©Œ_t
 *
__»¡riù
 
__cÚd_©Œ
)

981 
__THROW
 
	`__nÚnuÎ
 ((1));

984 
	$±h»ad_cÚd_de¡roy
 (
±h»ad_cÚd_t
 *
__cÚd
)

985 
__THROW
 
	`__nÚnuÎ
 ((1));

988 
	$±h»ad_cÚd_sigÇl
 (
±h»ad_cÚd_t
 *
__cÚd
)

989 
__THROWNL
 
	`__nÚnuÎ
 ((1));

992 
	$±h»ad_cÚd_brßdÿ¡
 (
±h»ad_cÚd_t
 *
__cÚd
)

993 
__THROWNL
 
	`__nÚnuÎ
 ((1));

1000 
	$±h»ad_cÚd_wa™
 (
±h»ad_cÚd_t
 *
__»¡riù
 
__cÚd
,

1001 
±h»ad_mu‹x_t
 *
__»¡riù
 
__mu‹x
)

1002 
	`__nÚnuÎ
 ((1, 2));

1011 
	$±h»ad_cÚd_timedwa™
 (
±h»ad_cÚd_t
 *
__»¡riù
 
__cÚd
,

1012 
±h»ad_mu‹x_t
 *
__»¡riù
 
__mu‹x
,

1013 cÚ¡ 
time¥ec
 *
__»¡riù
 
__ab¡ime
)

1014 
	`__nÚnuÎ
 ((1, 2, 3));

1019 
	$±h»ad_cÚd©Œ_š™
 (
±h»ad_cÚd©Œ_t
 *
__©Œ
)

1020 
__THROW
 
	`__nÚnuÎ
 ((1));

1023 
	$±h»ad_cÚd©Œ_de¡roy
 (
±h»ad_cÚd©Œ_t
 *
__©Œ
)

1024 
__THROW
 
	`__nÚnuÎ
 ((1));

1027 
	$±h»ad_cÚd©Œ_g‘psh¬ed
 (cÚ¡ 
±h»ad_cÚd©Œ_t
 *

1028 
__»¡riù
 
__©Œ
,

1029 *
__»¡riù
 
__psh¬ed
)

1030 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

1033 
	$±h»ad_cÚd©Œ_£sh¬ed
 (
±h»ad_cÚd©Œ_t
 *
__©Œ
,

1034 
__psh¬ed
è
__THROW
 
	`__nÚnuÎ
 ((1));

1036 #ifdeà
__USE_XOPEN2K


1038 
	$±h»ad_cÚd©Œ_g‘şock
 (cÚ¡ 
±h»ad_cÚd©Œ_t
 *

1039 
__»¡riù
 
__©Œ
,

1040 
__şockid_t
 *
__»¡riù
 
__şock_id
)

1041 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

1044 
	$±h»ad_cÚd©Œ_£tşock
 (
±h»ad_cÚd©Œ_t
 *
__©Œ
,

1045 
__şockid_t
 
__şock_id
)

1046 
__THROW
 
	`__nÚnuÎ
 ((1));

1050 #ifdeà
__USE_XOPEN2K


1055 
	$±h»ad_¥š_š™
 (
±h»ad_¥šlock_t
 *
__lock
, 
__psh¬ed
)

1056 
__THROW
 
	`__nÚnuÎ
 ((1));

1059 
	$±h»ad_¥š_de¡roy
 (
±h»ad_¥šlock_t
 *
__lock
)

1060 
__THROW
 
	`__nÚnuÎ
 ((1));

1063 
	$±h»ad_¥š_lock
 (
±h»ad_¥šlock_t
 *
__lock
)

1064 
__THROWNL
 
	`__nÚnuÎ
 ((1));

1067 
	$±h»ad_¥š_Œylock
 (
±h»ad_¥šlock_t
 *
__lock
)

1068 
__THROWNL
 
	`__nÚnuÎ
 ((1));

1071 
	$±h»ad_¥š_uÆock
 (
±h»ad_¥šlock_t
 *
__lock
)

1072 
__THROWNL
 
	`__nÚnuÎ
 ((1));

1079 
	$±h»ad_b¬r›r_š™
 (
±h»ad_b¬r›r_t
 *
__»¡riù
 
__b¬r›r
,

1080 cÚ¡ 
±h»ad_b¬r›¿‰r_t
 *
__»¡riù


1081 
__©Œ
, 
__couÁ
)

1082 
__THROW
 
	`__nÚnuÎ
 ((1));

1085 
	$±h»ad_b¬r›r_de¡roy
 (
±h»ad_b¬r›r_t
 *
__b¬r›r
)

1086 
__THROW
 
	`__nÚnuÎ
 ((1));

1089 
	$±h»ad_b¬r›r_wa™
 (
±h»ad_b¬r›r_t
 *
__b¬r›r
)

1090 
__THROWNL
 
	`__nÚnuÎ
 ((1));

1094 
	$±h»ad_b¬r›¿‰r_š™
 (
±h»ad_b¬r›¿‰r_t
 *
__©Œ
)

1095 
__THROW
 
	`__nÚnuÎ
 ((1));

1098 
	$±h»ad_b¬r›¿‰r_de¡roy
 (
±h»ad_b¬r›¿‰r_t
 *
__©Œ
)

1099 
__THROW
 
	`__nÚnuÎ
 ((1));

1102 
	$±h»ad_b¬r›¿‰r_g‘psh¬ed
 (cÚ¡ 
±h»ad_b¬r›¿‰r_t
 *

1103 
__»¡riù
 
__©Œ
,

1104 *
__»¡riù
 
__psh¬ed
)

1105 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

1108 
	$±h»ad_b¬r›¿‰r_£sh¬ed
 (
±h»ad_b¬r›¿‰r_t
 *
__©Œ
,

1109 
__psh¬ed
)

1110 
__THROW
 
	`__nÚnuÎ
 ((1));

1122 
	`±h»ad_key_ü—‹
 (
±h»ad_key_t
 *
__key
,

1123 (*
__de¡r_funùiÚ
) (*))

1124 
__THROW
 
	`__nÚnuÎ
 ((1));

1127 
	$±h»ad_key_d–‘e
 (
±h»ad_key_t
 
__key
è
__THROW
;

1130 *
	$±h»ad_g‘¥ecific
 (
±h»ad_key_t
 
__key
è
__THROW
;

1133 
	$±h»ad_£t¥ecific
 (
±h»ad_key_t
 
__key
,

1134 cÚ¡ *
__poš‹r
è
__THROW
 ;

1137 #ifdeà
__USE_XOPEN2K


1139 
	$±h»ad_g‘ıuşockid
 (
±h»ad_t
 
__th»ad_id
,

1140 
__şockid_t
 *
__şock_id
)

1141 
__THROW
 
	`__nÚnuÎ
 ((2));

1156 
	`±h»ad_©fÜk
 ((*
__´•¬e
) (),

1157 (*
__·»Á
) (),

1158 (*
__chd
è()è
__THROW
;

1161 #ifdeà
__USE_EXTERN_INLINES


1163 
__ex‹º_šlše
 

1164 
	`__NTH
 (
	$±h»ad_equ®
 (
±h»ad_t
 
__th»ad1
,…th»ad_ˆ
__th»ad2
))

1166  
__th»ad1
 =ğ
__th»ad2
;

1167 
	}
}

1170 
	g__END_DECLS


	@/usr/include/stdio.h

23 #iâdeà
_STDIO_H


25 #ià!
defšed
 
__Ãed_FILE
 && !defšed 
__Ãed___FILE


26 
	#_STDIO_H
 1

	)

27 
	~<ã©u»s.h
>

29 
	g__BEGIN_DECLS


31 
	#__Ãed_size_t


	)

32 
	#__Ãed_NULL


	)

33 
	~<¡ddef.h
>

35 
	~<b™s/ty³s.h
>

36 
	#__Ãed_FILE


	)

37 
	#__Ãed___FILE


	)

41 #ià!
defšed
 
__FILE_defšed
 && defšed 
__Ãed_FILE


44 
	g_IO_FILE
;

46 
__BEGIN_NAMESPACE_STD


48 
_IO_FILE
 
	tFILE
;

49 
	g__END_NAMESPACE_STD


50 #ià
defšed
 
__USE_LARGEFILE64
 || defšed 
__USE_SVID
 || defšed 
__USE_POSIX
 \

51 || 
defšed
 
	g__USE_BSD
 || defšed 
	g__USE_ISOC99
 || defšed 
	g__USE_XOPEN
 \

52 || 
defšed
 
__USE_POSIX2


53 
	$__USING_NAMESPACE_STD
(
FILE
)

56 
	#__FILE_defšed
 1

	)

58 #undeà
__Ãed_FILE


61 #ià!
defšed
 
____FILE_defšed
 && defšed 
__Ãed___FILE


64 
_IO_FILE
 
	t__FILE
;

66 
	#____FILE_defšed
 1

	)

68 #undeà
__Ãed___FILE


71 #ifdef 
_STDIO_H


72 
	#_STDIO_USES_IOSTREAM


	)

74 
	~<libio.h
>

76 #ià
defšed
 
__USE_XOPEN
 || defšed 
__USE_XOPEN2K8


77 #ifdeà
__GNUC__


78 #iâdeà
_VA_LIST_DEFINED


79 
_G_va_li¡
 
	tva_li¡
;

80 
	#_VA_LIST_DEFINED


	)

83 
	~<¡d¬g.h
>

87 #ifdeà
__USE_XOPEN2K8


88 #iâdeà
__off_t_defšed


89 #iâdeà
__USE_FILE_OFFSET64


90 
__off_t
 
	toff_t
;

92 
__off64_t
 
	toff_t
;

94 
	#__off_t_defšed


	)

96 #ià
defšed
 
__USE_LARGEFILE64
 && !defšed 
__off64_t_defšed


97 
__off64_t
 
	toff64_t
;

98 
	#__off64_t_defšed


	)

101 #iâdeà
__ssize_t_defšed


102 
__ssize_t
 
	tssize_t
;

103 
	#__ssize_t_defšed


	)

108 
__BEGIN_NAMESPACE_STD


109 #iâdeà
__USE_FILE_OFFSET64


110 
_G_åos_t
 
	tåos_t
;

112 
_G_åos64_t
 
	tåos_t
;

114 
__END_NAMESPACE_STD


115 #ifdeà
__USE_LARGEFILE64


116 
_G_åos64_t
 
	tåos64_t
;

120 
	#_IOFBF
 0

	)

121 
	#_IOLBF
 1

	)

122 
	#_IONBF
 2

	)

126 #iâdeà
BUFSIZ


127 
	#BUFSIZ
 
_IO_BUFSIZ


	)

133 #iâdeà
EOF


134 
	#EOF
 (-1)

	)

140 
	#SEEK_SET
 0

	)

141 
	#SEEK_CUR
 1

	)

142 
	#SEEK_END
 2

	)

143 #ifdeà
__USE_GNU


144 
	#SEEK_DATA
 3

	)

145 
	#SEEK_HOLE
 4

	)

149 #ià
defšed
 
__USE_SVID
 || defšed 
__USE_XOPEN


151 
	#P_tmpdœ
 "/tmp"

	)

164 
	~<b™s/¡dio_lim.h
>

168 
_IO_FILE
 *
¡dš
;

169 
_IO_FILE
 *
¡dout
;

170 
_IO_FILE
 *
¡d”r
;

172 
	#¡dš
 
¡dš


	)

173 
	#¡dout
 
¡dout


	)

174 
	#¡d”r
 
¡d”r


	)

176 
__BEGIN_NAMESPACE_STD


178 
	$»move
 (cÚ¡ *
__f’ame
è
__THROW
;

180 
	$»Çme
 (cÚ¡ *
__Şd
, cÚ¡ *
__Ãw
è
__THROW
;

181 
__END_NAMESPACE_STD


183 #ifdeà
__USE_ATFILE


185 
	$»Çm—t
 (
__Şdfd
, cÚ¡ *
__Şd
, 
__Ãwfd
,

186 cÚ¡ *
__Ãw
è
__THROW
;

189 
__BEGIN_NAMESPACE_STD


194 #iâdeà
__USE_FILE_OFFSET64


195 
FILE
 *
	$tmpfe
 (è
__wur
;

197 #ifdeà
__REDIRECT


198 
FILE
 *
	`__REDIRECT
 (
tmpfe
, (), 
tmpfe64
è
__wur
;

200 
	#tmpfe
 
tmpfe64


	)

204 #ifdeà
__USE_LARGEFILE64


205 
FILE
 *
	$tmpfe64
 (è
__wur
;

209 *
	$tm²am
 (*
__s
è
__THROW
 
__wur
;

210 
__END_NAMESPACE_STD


212 #ifdeà
__USE_MISC


215 *
	$tm²am_r
 (*
__s
è
__THROW
 
__wur
;

219 #ià
defšed
 
__USE_SVID
 || defšed 
__USE_XOPEN


227 *
	$‹m²am
 (cÚ¡ *
__dœ
, cÚ¡ *
__pfx
)

228 
__THROW
 
__©Œibu‹_m®loc__
 
__wur
;

232 
__BEGIN_NAMESPACE_STD


237 
	`fşo£
 (
FILE
 *
__¡»am
);

242 
	`fæush
 (
FILE
 *
__¡»am
);

243 
__END_NAMESPACE_STD


245 #ifdeà
__USE_MISC


252 
	`fæush_uÆocked
 (
FILE
 *
__¡»am
);

255 #ifdeà
__USE_GNU


262 
	`fşo£®l
 ();

266 
__BEGIN_NAMESPACE_STD


267 #iâdeà
__USE_FILE_OFFSET64


272 
FILE
 *
	$fİ’
 (cÚ¡ *
__»¡riù
 
__f’ame
,

273 cÚ¡ *
__»¡riù
 
__modes
è
__wur
;

278 
FILE
 *
	$äeİ’
 (cÚ¡ *
__»¡riù
 
__f’ame
,

279 cÚ¡ *
__»¡riù
 
__modes
,

280 
FILE
 *
__»¡riù
 
__¡»am
è
__wur
;

282 #ifdeà
__REDIRECT


283 
FILE
 *
	`__REDIRECT
 (
fİ’
, (cÚ¡ *
__»¡riù
 
__f’ame
,

284 cÚ¡ *
__»¡riù
 
__modes
), 
fİ’64
)

285 
__wur
;

286 
FILE
 *
	`__REDIRECT
 (
äeİ’
, (cÚ¡ *
__»¡riù
 
__f’ame
,

287 cÚ¡ *
__»¡riù
 
__modes
,

288 
FILE
 *
__»¡riù
 
__¡»am
), 
äeİ’64
)

289 
__wur
;

291 
	#fİ’
 
fİ’64


	)

292 
	#äeİ’
 
äeİ’64


	)

295 
__END_NAMESPACE_STD


296 #ifdeà
__USE_LARGEFILE64


297 
FILE
 *
	$fİ’64
 (cÚ¡ *
__»¡riù
 
__f’ame
,

298 cÚ¡ *
__»¡riù
 
__modes
è
__wur
;

299 
FILE
 *
	$äeİ’64
 (cÚ¡ *
__»¡riù
 
__f’ame
,

300 cÚ¡ *
__»¡riù
 
__modes
,

301 
FILE
 *
__»¡riù
 
__¡»am
è
__wur
;

304 #ifdef 
__USE_POSIX


306 
FILE
 *
	$fdİ’
 (
__fd
, cÚ¡ *
__modes
è
__THROW
 
__wur
;

309 #ifdef 
__USE_GNU


312 
FILE
 *
	$fİ’cook›
 (*
__»¡riù
 
__magic_cook›
,

313 cÚ¡ *
__»¡riù
 
__modes
,

314 
_IO_cook›_io_funùiÚs_t
 
__io_funcs
è
__THROW
 
__wur
;

317 #ifdeà
__USE_XOPEN2K8


319 
FILE
 *
	$fmemİ’
 (*
__s
, 
size_t
 
__Ën
, cÚ¡ *
__modes
)

320 
__THROW
 
__wur
;

325 
FILE
 *
	$İ’_mem¡»am
 (**
__buæoc
, 
size_t
 *
__siz–oc
è
__THROW
 
__wur
;

329 
__BEGIN_NAMESPACE_STD


332 
	$£tbuf
 (
FILE
 *
__»¡riù
 
__¡»am
, *__»¡riù 
__buf
è
__THROW
;

336 
	$£tvbuf
 (
FILE
 *
__»¡riù
 
__¡»am
, *__»¡riù 
__buf
,

337 
__modes
, 
size_t
 
__n
è
__THROW
;

338 
__END_NAMESPACE_STD


340 #ifdef 
__USE_BSD


343 
	$£tbufãr
 (
FILE
 *
__»¡riù
 
__¡»am
, *__»¡riù 
__buf
,

344 
size_t
 
__size
è
__THROW
;

347 
	$£šebuf
 (
FILE
 *
__¡»am
è
__THROW
;

351 
__BEGIN_NAMESPACE_STD


356 
	`årštf
 (
FILE
 *
__»¡riù
 
__¡»am
,

357 cÚ¡ *
__»¡riù
 
__fÜm©
, ...);

362 
	`´štf
 (cÚ¡ *
__»¡riù
 
__fÜm©
, ...);

364 
	$¥rštf
 (*
__»¡riù
 
__s
,

365 cÚ¡ *
__»¡riù
 
__fÜm©
, ...è
__THROWNL
;

371 
	`vårštf
 (
FILE
 *
__»¡riù
 
__s
, cÚ¡ *__»¡riù 
__fÜm©
,

372 
_G_va_li¡
 
__¬g
);

377 
	`v´štf
 (cÚ¡ *
__»¡riù
 
__fÜm©
, 
_G_va_li¡
 
__¬g
);

379 
	$v¥rštf
 (*
__»¡riù
 
__s
, cÚ¡ *__»¡riù 
__fÜm©
,

380 
_G_va_li¡
 
__¬g
è
__THROWNL
;

381 
__END_NAMESPACE_STD


383 #ià
defšed
 
__USE_BSD
 || defšed 
__USE_ISOC99
 || defšed 
__USE_UNIX98


384 
__BEGIN_NAMESPACE_C99


386 
	$¢´štf
 (*
__»¡riù
 
__s
, 
size_t
 
__maxËn
,

387 cÚ¡ *
__»¡riù
 
__fÜm©
, ...)

388 
__THROWNL
 
	`__©Œibu‹__
 ((
	`__fÜm©__
 (
__´štf__
, 3, 4)));

390 
	$v¢´štf
 (*
__»¡riù
 
__s
, 
size_t
 
__maxËn
,

391 cÚ¡ *
__»¡riù
 
__fÜm©
, 
_G_va_li¡
 
__¬g
)

392 
__THROWNL
 
	`__©Œibu‹__
 ((
	`__fÜm©__
 (
__´štf__
, 3, 0)));

393 
__END_NAMESPACE_C99


396 #ifdeà
__USE_GNU


399 
	$va¥rštf
 (**
__»¡riù
 
__±r
, cÚ¡ *__»¡riù 
__f
,

400 
_G_va_li¡
 
__¬g
)

401 
__THROWNL
 
	`__©Œibu‹__
 ((
	$__fÜm©__
 (
__´štf__
, 2, 0))è
__wur
;

402 
	$__a¥rštf
 (**
__»¡riù
 
__±r
,

403 cÚ¡ *
__»¡riù
 
__fmt
, ...)

404 
__THROWNL
 
	`__©Œibu‹__
 ((
	$__fÜm©__
 (
__´štf__
, 2, 3))è
__wur
;

405 
	$a¥rštf
 (**
__»¡riù
 
__±r
,

406 cÚ¡ *
__»¡riù
 
__fmt
, ...)

407 
__THROWNL
 
	`__©Œibu‹__
 ((
	$__fÜm©__
 (
__´štf__
, 2, 3))è
__wur
;

410 #ifdeà
__USE_XOPEN2K8


412 
	$vd´štf
 (
__fd
, cÚ¡ *
__»¡riù
 
__fmt
,

413 
_G_va_li¡
 
__¬g
)

414 
	`__©Œibu‹__
 ((
	`__fÜm©__
 (
__´štf__
, 2, 0)));

415 
	$d´štf
 (
__fd
, cÚ¡ *
__»¡riù
 
__fmt
, ...)

416 
	`__©Œibu‹__
 ((
	`__fÜm©__
 (
__´štf__
, 2, 3)));

420 
__BEGIN_NAMESPACE_STD


425 
	$fsÿnf
 (
FILE
 *
__»¡riù
 
__¡»am
,

426 cÚ¡ *
__»¡riù
 
__fÜm©
, ...è
__wur
;

431 
	$sÿnf
 (cÚ¡ *
__»¡riù
 
__fÜm©
, ...è
__wur
;

433 
	$ssÿnf
 (cÚ¡ *
__»¡riù
 
__s
,

434 cÚ¡ *
__»¡riù
 
__fÜm©
, ...è
__THROW
;

436 #ià
defšed
 
__USE_ISOC99
 && !defšed 
__USE_GNU
 \

437 && (!
defšed
 
__LDBL_COMPAT
 || !defšed 
__REDIRECT
) \

438 && (
defšed
 
__STRICT_ANSI__
 || defšed 
__USE_XOPEN2K
)

439 #ifdeà
__REDIRECT


443 
	`__REDIRECT
 (
fsÿnf
, (
FILE
 *
__»¡riù
 
__¡»am
,

444 cÚ¡ *
__»¡riù
 
__fÜm©
, ...),

445 
__isoc99_fsÿnf
è
__wur
;

446 
	`__REDIRECT
 (
sÿnf
, (cÚ¡ *
__»¡riù
 
__fÜm©
, ...),

447 
__isoc99_sÿnf
è
__wur
;

448 
	`__REDIRECT_NTH
 (
ssÿnf
, (cÚ¡ *
__»¡riù
 
__s
,

449 cÚ¡ *
__»¡riù
 
__fÜm©
, ...),

450 
__isoc99_ssÿnf
);

452 
	$__isoc99_fsÿnf
 (
FILE
 *
__»¡riù
 
__¡»am
,

453 cÚ¡ *
__»¡riù
 
__fÜm©
, ...è
__wur
;

454 
	$__isoc99_sÿnf
 (cÚ¡ *
__»¡riù
 
__fÜm©
, ...è
__wur
;

455 
	$__isoc99_ssÿnf
 (cÚ¡ *
__»¡riù
 
__s
,

456 cÚ¡ *
__»¡riù
 
__fÜm©
, ...è
__THROW
;

457 
	#fsÿnf
 
__isoc99_fsÿnf


	)

458 
	#sÿnf
 
__isoc99_sÿnf


	)

459 
	#ssÿnf
 
__isoc99_ssÿnf


	)

463 
__END_NAMESPACE_STD


465 #ifdef 
__USE_ISOC99


466 
__BEGIN_NAMESPACE_C99


471 
	$vfsÿnf
 (
FILE
 *
__»¡riù
 
__s
, cÚ¡ *__»¡riù 
__fÜm©
,

472 
_G_va_li¡
 
__¬g
)

473 
	`__©Œibu‹__
 ((
	$__fÜm©__
 (
__sÿnf__
, 2, 0))è
__wur
;

479 
	$vsÿnf
 (cÚ¡ *
__»¡riù
 
__fÜm©
, 
_G_va_li¡
 
__¬g
)

480 
	`__©Œibu‹__
 ((
	$__fÜm©__
 (
__sÿnf__
, 1, 0))è
__wur
;

483 
	$vssÿnf
 (cÚ¡ *
__»¡riù
 
__s
,

484 cÚ¡ *
__»¡riù
 
__fÜm©
, 
_G_va_li¡
 
__¬g
)

485 
__THROW
 
	`__©Œibu‹__
 ((
	`__fÜm©__
 (
__sÿnf__
, 2, 0)));

487 #ià!
defšed
 
__USE_GNU
 \

488 && (!
defšed
 
__LDBL_COMPAT
 || !defšed 
__REDIRECT
) \

489 && (
defšed
 
__STRICT_ANSI__
 || defšed 
__USE_XOPEN2K
)

490 #ifdeà
__REDIRECT


494 
	`__REDIRECT
 (
vfsÿnf
,

495 (
FILE
 *
__»¡riù
 
__s
,

496 cÚ¡ *
__»¡riù
 
__fÜm©
, 
_G_va_li¡
 
__¬g
),

497 
__isoc99_vfsÿnf
)

498 
	`__©Œibu‹__
 ((
	$__fÜm©__
 (
__sÿnf__
, 2, 0))è
__wur
;

499 
	`__REDIRECT
 (
vsÿnf
, (cÚ¡ *
__»¡riù
 
__fÜm©
,

500 
_G_va_li¡
 
__¬g
), 
__isoc99_vsÿnf
)

501 
	`__©Œibu‹__
 ((
	$__fÜm©__
 (
__sÿnf__
, 1, 0))è
__wur
;

502 
	`__REDIRECT_NTH
 (
vssÿnf
,

503 (cÚ¡ *
__»¡riù
 
__s
,

504 cÚ¡ *
__»¡riù
 
__fÜm©
,

505 
_G_va_li¡
 
__¬g
), 
__isoc99_vssÿnf
)

506 
	`__©Œibu‹__
 ((
	`__fÜm©__
 (
__sÿnf__
, 2, 0)));

508 
	$__isoc99_vfsÿnf
 (
FILE
 *
__»¡riù
 
__s
,

509 cÚ¡ *
__»¡riù
 
__fÜm©
,

510 
_G_va_li¡
 
__¬g
è
__wur
;

511 
	$__isoc99_vsÿnf
 (cÚ¡ *
__»¡riù
 
__fÜm©
,

512 
_G_va_li¡
 
__¬g
è
__wur
;

513 
	$__isoc99_vssÿnf
 (cÚ¡ *
__»¡riù
 
__s
,

514 cÚ¡ *
__»¡riù
 
__fÜm©
,

515 
_G_va_li¡
 
__¬g
è
__THROW
;

516 
	#vfsÿnf
 
__isoc99_vfsÿnf


	)

517 
	#vsÿnf
 
__isoc99_vsÿnf


	)

518 
	#vssÿnf
 
__isoc99_vssÿnf


	)

522 
__END_NAMESPACE_C99


526 
__BEGIN_NAMESPACE_STD


531 
	`fg‘c
 (
FILE
 *
__¡»am
);

532 
	`g‘c
 (
FILE
 *
__¡»am
);

538 
	`g‘ch¬
 ();

539 
__END_NAMESPACE_STD


543 
	#g‘c
(
_å
è
	`_IO_g‘c
 (_å)

	)

545 #ià
defšed
 
__USE_POSIX
 || defšed 
__USE_MISC


550 
	`g‘c_uÆocked
 (
FILE
 *
__¡»am
);

551 
	`g‘ch¬_uÆocked
 ();

554 #ifdeà
__USE_MISC


561 
	`fg‘c_uÆocked
 (
FILE
 *
__¡»am
);

565 
__BEGIN_NAMESPACE_STD


573 
	`åutc
 (
__c
, 
FILE
 *
__¡»am
);

574 
	`putc
 (
__c
, 
FILE
 *
__¡»am
);

580 
	`putch¬
 (
__c
);

581 
__END_NAMESPACE_STD


585 
	#putc
(
_ch
, 
_å
è
	`_IO_putc
 (_ch, _å)

	)

587 #ifdeà
__USE_MISC


594 
	`åutc_uÆocked
 (
__c
, 
FILE
 *
__¡»am
);

597 #ià
defšed
 
__USE_POSIX
 || defšed 
__USE_MISC


602 
	`putc_uÆocked
 (
__c
, 
FILE
 *
__¡»am
);

603 
	`putch¬_uÆocked
 (
__c
);

607 #ià
defšed
 
__USE_SVID
 || defšed 
__USE_MISC
 \

608 || (
defšed
 
__USE_XOPEN
 && !defšed 
__USE_XOPEN2K
)

610 
	`g‘w
 (
FILE
 *
__¡»am
);

613 
	`putw
 (
__w
, 
FILE
 *
__¡»am
);

617 
__BEGIN_NAMESPACE_STD


622 *
	$fg‘s
 (*
__»¡riù
 
__s
, 
__n
, 
FILE
 *__»¡riù 
__¡»am
)

623 
__wur
;

625 #ià!
defšed
 
__USE_ISOC11
 \

626 || (
defšed
 
__ılu¥lus
 && __cplusplus <= 201103L)

638 *
	$g‘s
 (*
__s
è
__wur
 
__©Œibu‹_d•»ÿ‹d__
;

640 
__END_NAMESPACE_STD


642 #ifdeà
__USE_GNU


649 *
	$fg‘s_uÆocked
 (*
__»¡riù
 
__s
, 
__n
,

650 
FILE
 *
__»¡riù
 
__¡»am
è
__wur
;

654 #ifdef 
__USE_XOPEN2K8


665 
_IO_ssize_t
 
	$__g‘d–im
 (**
__»¡riù
 
__lš•Œ
,

666 
size_t
 *
__»¡riù
 
__n
, 
__d–im™”
,

667 
FILE
 *
__»¡riù
 
__¡»am
è
__wur
;

668 
_IO_ssize_t
 
	$g‘d–im
 (**
__»¡riù
 
__lš•Œ
,

669 
size_t
 *
__»¡riù
 
__n
, 
__d–im™”
,

670 
FILE
 *
__»¡riù
 
__¡»am
è
__wur
;

678 
_IO_ssize_t
 
	$g‘lše
 (**
__»¡riù
 
__lš•Œ
,

679 
size_t
 *
__»¡riù
 
__n
,

680 
FILE
 *
__»¡riù
 
__¡»am
è
__wur
;

684 
__BEGIN_NAMESPACE_STD


689 
	`åuts
 (cÚ¡ *
__»¡riù
 
__s
, 
FILE
 *__»¡riù 
__¡»am
);

695 
	`puts
 (cÚ¡ *
__s
);

702 
	`ung‘c
 (
__c
, 
FILE
 *
__¡»am
);

709 
size_t
 
	$ä—d
 (*
__»¡riù
 
__±r
, 
size_t
 
__size
,

710 
size_t
 
__n
, 
FILE
 *
__»¡riù
 
__¡»am
è
__wur
;

715 
size_t
 
	`fwr™e
 (cÚ¡ *
__»¡riù
 
__±r
, size_ˆ
__size
,

716 
size_t
 
__n
, 
FILE
 *
__»¡riù
 
__s
);

717 
__END_NAMESPACE_STD


719 #ifdeà
__USE_GNU


726 
	`åuts_uÆocked
 (cÚ¡ *
__»¡riù
 
__s
,

727 
FILE
 *
__»¡riù
 
__¡»am
);

730 #ifdeà
__USE_MISC


737 
size_t
 
	$ä—d_uÆocked
 (*
__»¡riù
 
__±r
, 
size_t
 
__size
,

738 
size_t
 
__n
, 
FILE
 *
__»¡riù
 
__¡»am
è
__wur
;

739 
size_t
 
	`fwr™e_uÆocked
 (cÚ¡ *
__»¡riù
 
__±r
, size_ˆ
__size
,

740 
size_t
 
__n
, 
FILE
 *
__»¡riù
 
__¡»am
);

744 
__BEGIN_NAMESPACE_STD


749 
	`f£ek
 (
FILE
 *
__¡»am
, 
__off
, 
__wh’û
);

754 
	$á–l
 (
FILE
 *
__¡»am
è
__wur
;

759 
	`»wšd
 (
FILE
 *
__¡»am
);

760 
__END_NAMESPACE_STD


767 #ià
defšed
 
__USE_LARGEFILE
 || defšed 
__USE_XOPEN2K


768 #iâdeà
__USE_FILE_OFFSET64


773 
	`f£eko
 (
FILE
 *
__¡»am
, 
__off_t
 
__off
, 
__wh’û
);

778 
__off_t
 
	$á–lo
 (
FILE
 *
__¡»am
è
__wur
;

780 #ifdeà
__REDIRECT


781 
	`__REDIRECT
 (
f£eko
,

782 (
FILE
 *
__¡»am
, 
__off64_t
 
__off
, 
__wh’û
),

783 
f£eko64
);

784 
__off64_t
 
	`__REDIRECT
 (
á–lo
, (
FILE
 *
__¡»am
), 
á–lo64
);

786 
	#f£eko
 
f£eko64


	)

787 
	#á–lo
 
á–lo64


	)

792 
__BEGIN_NAMESPACE_STD


793 #iâdeà
__USE_FILE_OFFSET64


798 
	`fg‘pos
 (
FILE
 *
__»¡riù
 
__¡»am
, 
åos_t
 *__»¡riù 
__pos
);

803 
	`f£os
 (
FILE
 *
__¡»am
, cÚ¡ 
åos_t
 *
__pos
);

805 #ifdeà
__REDIRECT


806 
	`__REDIRECT
 (
fg‘pos
, (
FILE
 *
__»¡riù
 
__¡»am
,

807 
åos_t
 *
__»¡riù
 
__pos
), 
fg‘pos64
);

808 
	`__REDIRECT
 (
f£os
,

809 (
FILE
 *
__¡»am
, cÚ¡ 
åos_t
 *
__pos
), 
f£os64
);

811 
	#fg‘pos
 
fg‘pos64


	)

812 
	#f£os
 
f£os64


	)

815 
__END_NAMESPACE_STD


817 #ifdeà
__USE_LARGEFILE64


818 
	`f£eko64
 (
FILE
 *
__¡»am
, 
__off64_t
 
__off
, 
__wh’û
);

819 
__off64_t
 
	$á–lo64
 (
FILE
 *
__¡»am
è
__wur
;

820 
	`fg‘pos64
 (
FILE
 *
__»¡riù
 
__¡»am
, 
åos64_t
 *__»¡riù 
__pos
);

821 
	`f£os64
 (
FILE
 *
__¡»am
, cÚ¡ 
åos64_t
 *
__pos
);

824 
__BEGIN_NAMESPACE_STD


826 
	$ş—»¼
 (
FILE
 *
__¡»am
è
__THROW
;

828 
	$ãof
 (
FILE
 *
__¡»am
è
__THROW
 
__wur
;

830 
	$ã¼Ü
 (
FILE
 *
__¡»am
è
__THROW
 
__wur
;

831 
__END_NAMESPACE_STD


833 #ifdeà
__USE_MISC


835 
	$ş—»¼_uÆocked
 (
FILE
 *
__¡»am
è
__THROW
;

836 
	$ãof_uÆocked
 (
FILE
 *
__¡»am
è
__THROW
 
__wur
;

837 
	$ã¼Ü_uÆocked
 (
FILE
 *
__¡»am
è
__THROW
 
__wur
;

841 
__BEGIN_NAMESPACE_STD


846 
	`³¼Ü
 (cÚ¡ *
__s
);

847 
__END_NAMESPACE_STD


853 
	~<b™s/sys_”¾i¡.h
>

856 #ifdef 
__USE_POSIX


858 
	$f’o
 (
FILE
 *
__¡»am
è
__THROW
 
__wur
;

861 #ifdeà
__USE_MISC


863 
	$f’o_uÆocked
 (
FILE
 *
__¡»am
è
__THROW
 
__wur
;

867 #ià(
defšed
 
__USE_POSIX2
 || defšed 
__USE_SVID
 || defšed 
__USE_BSD
 || \

868 
defšed
 
__USE_MISC
)

873 
FILE
 *
	$pİ’
 (cÚ¡ *
__commªd
, cÚ¡ *
__modes
è
__wur
;

879 
	`pşo£
 (
FILE
 *
__¡»am
);

883 #ifdef 
__USE_POSIX


885 *
	$ù”mid
 (*
__s
è
__THROW
;

889 #ifdeà
__USE_XOPEN


891 *
	`cu£rid
 (*
__s
);

895 #ifdef 
__USE_GNU


896 
ob¡ack
;

899 
	$ob¡ack_´štf
 (
ob¡ack
 *
__»¡riù
 
__ob¡ack
,

900 cÚ¡ *
__»¡riù
 
__fÜm©
, ...)

901 
__THROWNL
 
	`__©Œibu‹__
 ((
	`__fÜm©__
 (
__´štf__
, 2, 3)));

902 
	$ob¡ack_v´štf
 (
ob¡ack
 *
__»¡riù
 
__ob¡ack
,

903 cÚ¡ *
__»¡riù
 
__fÜm©
,

904 
_G_va_li¡
 
__¬gs
)

905 
__THROWNL
 
	`__©Œibu‹__
 ((
	`__fÜm©__
 (
__´štf__
, 2, 0)));

909 #ià
defšed
 
__USE_POSIX
 || defšed 
__USE_MISC


913 
	$æockfe
 (
FILE
 *
__¡»am
è
__THROW
;

917 
	$árylockfe
 (
FILE
 *
__¡»am
è
__THROW
 
__wur
;

920 
	$fuÆockfe
 (
FILE
 *
__¡»am
è
__THROW
;

923 #ià
defšed
 
__USE_XOPEN
 && !defšed 
__USE_XOPEN2K
 && !defšed 
__USE_GNU


927 
	#__Ãed_g‘İt


	)

928 
	~<g‘İt.h
>

933 #ifdeà
__USE_EXTERN_INLINES


934 
	~<b™s/¡dio.h
>

936 #ià
__USE_FORTIFY_LEVEL
 > 0 && 
defšed
 
__ex‹º_®ways_šlše


937 
	~<b™s/¡dio2.h
>

939 #ifdeà
__LDBL_COMPAT


940 
	~<b™s/¡dio-ldbl.h
>

943 
__END_DECLS


	@/usr/include/time.h

22 #iâdef 
_TIME_H


24 #ià(! 
defšed
 
__Ãed_time_t
 && !defšed 
__Ãed_şock_t
 && \

25 ! 
defšed
 
	g__Ãed_time¥ec
)

26 
	#_TIME_H
 1

	)

27 
	~<ã©u»s.h
>

29 
	g__BEGIN_DECLS


33 #ifdef 
_TIME_H


35 
	#__Ãed_size_t


	)

36 
	#__Ãed_NULL


	)

37 
	~<¡ddef.h
>

41 
	~<b™s/time.h
>

44 #ià!
defšed
 
__STRICT_ANSI__
 && !defšed 
__USE_XOPEN2K


45 #iâdeà
CLK_TCK


46 
	#CLK_TCK
 
CLOCKS_PER_SEC


	)

52 #ià!
defšed
 
__şock_t_defšed
 && (defšed 
_TIME_H
 || defšed 
__Ãed_şock_t
)

53 
	#__şock_t_defšed
 1

	)

55 
	~<b™s/ty³s.h
>

57 
__BEGIN_NAMESPACE_STD


59 
__şock_t
 
	tşock_t
;

60 
	g__END_NAMESPACE_STD


61 #ià
defšed
 
__USE_XOPEN
 || defšed 
__USE_POSIX
 || defšed 
__USE_MISC


62 
	$__USING_NAMESPACE_STD
(
şock_t
)

66 #undeà
__Ãed_şock_t


68 #ià!
defšed
 
__time_t_defšed
 && (defšed 
_TIME_H
 || defšed 
__Ãed_time_t
)

69 
	#__time_t_defšed
 1

	)

71 
	~<b™s/ty³s.h
>

73 
__BEGIN_NAMESPACE_STD


75 
__time_t
 
	ttime_t
;

76 
__END_NAMESPACE_STD


77 #ià
defšed
 
__USE_POSIX
 || defšed 
__USE_MISC
 || defšed 
__USE_SVID


78 
	$__USING_NAMESPACE_STD
(
time_t
)

82 #undeà
__Ãed_time_t


84 #ià!
defšed
 
__şockid_t_defšed
 && \

85 ((
defšed
 
_TIME_H
 && defšed 
__USE_POSIX199309
è|| defšed 
__Ãed_şockid_t
)

86 
	#__şockid_t_defšed
 1

	)

88 
	~<b™s/ty³s.h
>

91 
__şockid_t
 
	tşockid_t
;

94 #undeà
__şockid_time_t


96 #ià!
defšed
 
__tim”_t_defšed
 && \

97 ((
defšed
 
_TIME_H
 && defšed 
__USE_POSIX199309
è|| defšed 
__Ãed_tim”_t
)

98 
	#__tim”_t_defšed
 1

	)

100 
	~<b™s/ty³s.h
>

103 
__tim”_t
 
	ttim”_t
;

106 #undeà
__Ãed_tim”_t


109 #ià(!
defšed
 
__time¥ec_defšed
 \

110 && ((
defšed
 
_TIME_H
 \

111 && (
defšed
 
__USE_POSIX199309
 || defšed 
__USE_MISC
 \

112 || 
defšed
 
__USE_ISOC11
)) \

113 || 
defšed
 
__Ãed_time¥ec
))

114 
	#__time¥ec_defšed
 1

	)

116 
	~<b™s/ty³s.h
>

120 
	stime¥ec


122 
__time_t
 
tv_£c
;

123 
__sysÿÎ_¦Úg_t
 
tv_n£c
;

127 #undeà
__Ãed_time¥ec


130 #ifdef 
_TIME_H


131 
__BEGIN_NAMESPACE_STD


133 
	stm


135 
tm_£c
;

136 
tm_mš
;

137 
tm_hour
;

138 
tm_mday
;

139 
tm_mÚ
;

140 
tm_y—r
;

141 
tm_wday
;

142 
tm_yday
;

143 
tm_isd¡
;

145 #ifdef 
__USE_BSD


146 
tm_gmtoff
;

147 cÚ¡ *
tm_zÚe
;

149 
__tm_gmtoff
;

150 cÚ¡ *
__tm_zÚe
;

153 
__END_NAMESPACE_STD


154 #ià
defšed
 
__USE_XOPEN
 || defšed 
__USE_POSIX
 || defšed 
__USE_MISC


155 
	$__USING_NAMESPACE_STD
(
tm
)

159 #ifdeà
__USE_POSIX199309


161 
	s™im”¥ec


163 
time¥ec
 
™_š‹rv®
;

164 
time¥ec
 
™_v®ue
;

168 
sigev’t
;

172 #ifdeà
__USE_XOPEN2K


173 #iâdeà
__pid_t_defšed


174 
__pid_t
 
	tpid_t
;

175 
	#__pid_t_defšed


	)

180 #ifdeà
__USE_ISOC11


182 
	#TIME_UTC
 1

	)

186 
__BEGIN_NAMESPACE_STD


189 
şock_t
 
	$şock
 (è
__THROW
;

192 
time_t
 
	$time
 (
time_t
 *
__tim”
è
__THROW
;

195 
	$difáime
 (
time_t
 
__time1
,ime_ˆ
__time0
)

196 
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
));

199 
time_t
 
	$mktime
 (
tm
 *
__
è
__THROW
;

205 
size_t
 
	$¡ráime
 (*
__»¡riù
 
__s
, 
size_t
 
__maxsize
,

206 cÚ¡ *
__»¡riù
 
__fÜm©
,

207 cÚ¡ 
tm
 *
__»¡riù
 
__
è
__THROW
;

208 
__END_NAMESPACE_STD


210 #ifdeà
__USE_XOPEN


213 *
	$¡½time
 (cÚ¡ *
__»¡riù
 
__s
,

214 cÚ¡ *
__»¡riù
 
__fmt
, 
tm
 *
__
)

215 
__THROW
;

218 #ifdeà
__USE_XOPEN2K8


221 
	~<xloÿË.h
>

223 
size_t
 
	$¡ráime_l
 (*
__»¡riù
 
__s
, 
size_t
 
__maxsize
,

224 cÚ¡ *
__»¡riù
 
__fÜm©
,

225 cÚ¡ 
tm
 *
__»¡riù
 
__
,

226 
__loÿË_t
 
__loc
è
__THROW
;

229 #ifdeà
__USE_GNU


230 *
	$¡½time_l
 (cÚ¡ *
__»¡riù
 
__s
,

231 cÚ¡ *
__»¡riù
 
__fmt
, 
tm
 *
__
,

232 
__loÿË_t
 
__loc
è
__THROW
;

236 
__BEGIN_NAMESPACE_STD


239 
tm
 *
	$gmtime
 (cÚ¡ 
time_t
 *
__tim”
è
__THROW
;

243 
tm
 *
	$loÿÉime
 (cÚ¡ 
time_t
 *
__tim”
è
__THROW
;

244 
__END_NAMESPACE_STD


246 #ià
defšed
 
__USE_POSIX
 || defšed 
__USE_MISC


249 
tm
 *
	$gmtime_r
 (cÚ¡ 
time_t
 *
__»¡riù
 
__tim”
,

250 
tm
 *
__»¡riù
 
__
è
__THROW
;

254 
tm
 *
	$loÿÉime_r
 (cÚ¡ 
time_t
 *
__»¡riù
 
__tim”
,

255 
tm
 *
__»¡riù
 
__
è
__THROW
;

258 
__BEGIN_NAMESPACE_STD


261 *
	$asùime
 (cÚ¡ 
tm
 *
__
è
__THROW
;

264 *
	$ùime
 (cÚ¡ 
time_t
 *
__tim”
è
__THROW
;

265 
__END_NAMESPACE_STD


267 #ià
defšed
 
__USE_POSIX
 || defšed 
__USE_MISC


272 *
	$asùime_r
 (cÚ¡ 
tm
 *
__»¡riù
 
__
,

273 *
__»¡riù
 
__buf
è
__THROW
;

276 *
	$ùime_r
 (cÚ¡ 
time_t
 *
__»¡riù
 
__tim”
,

277 *
__»¡riù
 
__buf
è
__THROW
;

282 *
__tzÇme
[2];

283 
__daylight
;

284 
__timezÚe
;

287 #ifdef 
__USE_POSIX


289 *
tzÇme
[2];

293 
	$tz£t
 (è
__THROW
;

296 #ià
defšed
 
__USE_SVID
 || defšed 
__USE_XOPEN


297 
daylight
;

298 
timezÚe
;

301 #ifdeà
__USE_SVID


304 
	$¡ime
 (cÚ¡ 
time_t
 *
__wh’
è
__THROW
;

310 
	#__i¦—p
(
y—r
) \

311 ((
y—r
è% 4 =ğ0 && ((y—rè% 100 !ğ0 || (y—rè% 400 =ğ0))

	)

314 #ifdeà
__USE_MISC


319 
time_t
 
	$timegm
 (
tm
 *
__
è
__THROW
;

322 
time_t
 
	$tim–oÿl
 (
tm
 *
__
è
__THROW
;

325 
	$dysize
 (
__y—r
è
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
));

329 #ifdeà
__USE_POSIX199309


334 
	`Çno¦“p
 (cÚ¡ 
time¥ec
 *
__»que¡ed_time
,

335 
time¥ec
 *
__»maššg
);

339 
	$şock_g‘»s
 (
şockid_t
 
__şock_id
, 
time¥ec
 *
__»s
è
__THROW
;

342 
	$şock_g‘time
 (
şockid_t
 
__şock_id
, 
time¥ec
 *
__
è
__THROW
;

345 
	$şock_£‰ime
 (
şockid_t
 
__şock_id
, cÚ¡ 
time¥ec
 *
__
)

346 
__THROW
;

348 #ifdeà
__USE_XOPEN2K


353 
	`şock_Çno¦“p
 (
şockid_t
 
__şock_id
, 
__æags
,

354 cÚ¡ 
time¥ec
 *
__»q
,

355 
time¥ec
 *
__»m
);

358 
	$şock_g‘ıuşockid
 (
pid_t
 
__pid
, 
şockid_t
 *
__şock_id
è
__THROW
;

363 
	$tim”_ü—‹
 (
şockid_t
 
__şock_id
,

364 
sigev’t
 *
__»¡riù
 
__evp
,

365 
tim”_t
 *
__»¡riù
 
__tim”id
è
__THROW
;

368 
	$tim”_d–‘e
 (
tim”_t
 
__tim”id
è
__THROW
;

371 
	$tim”_£‰ime
 (
tim”_t
 
__tim”id
, 
__æags
,

372 cÚ¡ 
™im”¥ec
 *
__»¡riù
 
__v®ue
,

373 
™im”¥ec
 *
__»¡riù
 
__ov®ue
è
__THROW
;

376 
	$tim”_g‘time
 (
tim”_t
 
__tim”id
, 
™im”¥ec
 *
__v®ue
)

377 
__THROW
;

380 
	$tim”_g‘ov”run
 (
tim”_t
 
__tim”id
è
__THROW
;

384 #ifdeà
__USE_ISOC11


386 
	$time¥ec_g‘
 (
time¥ec
 *
__ts
, 
__ba£
)

387 
__THROW
 
	`__nÚnuÎ
 ((1));

391 #ifdeà
__USE_XOPEN_EXTENDED


403 
g‘d©e_”r
;

412 
tm
 *
	`g‘d©e
 (cÚ¡ *
__¡ršg
);

415 #ifdeà
__USE_GNU


426 
	`g‘d©e_r
 (cÚ¡ *
__»¡riù
 
__¡ršg
,

427 
tm
 *
__»¡riù
 
__»sbuå
);

430 
__END_DECLS


	@/usr/include/endian.h

18 #iâdef 
_ENDIAN_H


19 
	#_ENDIAN_H
 1

	)

21 
	~<ã©u»s.h
>

31 
	#__LITTLE_ENDIAN
 1234

	)

32 
	#__BIG_ENDIAN
 4321

	)

33 
	#__PDP_ENDIAN
 3412

	)

36 
	~<b™s/’dŸn.h
>

40 #iâdeà
__FLOAT_WORD_ORDER


41 
	#__FLOAT_WORD_ORDER
 
__BYTE_ORDER


	)

44 #ifdef 
__USE_BSD


45 
	#LITTLE_ENDIAN
 
__LITTLE_ENDIAN


	)

46 
	#BIG_ENDIAN
 
__BIG_ENDIAN


	)

47 
	#PDP_ENDIAN
 
__PDP_ENDIAN


	)

48 
	#BYTE_ORDER
 
__BYTE_ORDER


	)

51 #ià
__BYTE_ORDER
 =ğ
__LITTLE_ENDIAN


52 
	#__LONG_LONG_PAIR
(
HI
, 
LO
èLO, 
	)
HI

53 #–ià
__BYTE_ORDER
 =ğ
__BIG_ENDIAN


54 
	#__LONG_LONG_PAIR
(
HI
, 
LO
èHI, 
	)
LO

58 #ià
defšed
 
__USE_BSD
 && !defšed 
__ASSEMBLER__


60 
	~<b™s/by‹sw­.h
>

62 #ià
__BYTE_ORDER
 =ğ
__LITTLE_ENDIAN


63 
	#htobe16
(
x
è
	`__bsw­_16
 (x)

	)

64 
	#htŞe16
(
x
è(x)

	)

65 
	#be16toh
(
x
è
	`__bsw­_16
 (x)

	)

66 
	#Ë16toh
(
x
è(x)

	)

68 
	#htobe32
(
x
è
	`__bsw­_32
 (x)

	)

69 
	#htŞe32
(
x
è(x)

	)

70 
	#be32toh
(
x
è
	`__bsw­_32
 (x)

	)

71 
	#Ë32toh
(
x
è(x)

	)

73 
	#htobe64
(
x
è
	`__bsw­_64
 (x)

	)

74 
	#htŞe64
(
x
è(x)

	)

75 
	#be64toh
(
x
è
	`__bsw­_64
 (x)

	)

76 
	#Ë64toh
(
x
è(x)

	)

79 
	#htobe16
(
x
è(x)

	)

80 
	#htŞe16
(
x
è
	`__bsw­_16
 (x)

	)

81 
	#be16toh
(
x
è(x)

	)

82 
	#Ë16toh
(
x
è
	`__bsw­_16
 (x)

	)

84 
	#htobe32
(
x
è(x)

	)

85 
	#htŞe32
(
x
è
	`__bsw­_32
 (x)

	)

86 
	#be32toh
(
x
è(x)

	)

87 
	#Ë32toh
(
x
è
	`__bsw­_32
 (x)

	)

89 
	#htobe64
(
x
è(x)

	)

90 
	#htŞe64
(
x
è
	`__bsw­_64
 (x)

	)

91 
	#be64toh
(
x
è(x)

	)

92 
	#Ë64toh
(
x
è
	`__bsw­_64
 (x)

	)

	@/usr/include/features.h

18 #iâdef 
_FEATURES_H


19 
	#_FEATURES_H
 1

	)

101 #undeà
__USE_ISOC11


102 #undeà
__USE_ISOC99


103 #undeà
__USE_ISOC95


104 #undeà
__USE_ISOCXX11


105 #undeà
__USE_POSIX


106 #undeà
__USE_POSIX2


107 #undeà
__USE_POSIX199309


108 #undeà
__USE_POSIX199506


109 #undeà
__USE_XOPEN


110 #undeà
__USE_XOPEN_EXTENDED


111 #undeà
__USE_UNIX98


112 #undeà
__USE_XOPEN2K


113 #undeà
__USE_XOPEN2KXSI


114 #undeà
__USE_XOPEN2K8


115 #undeà
__USE_XOPEN2K8XSI


116 #undeà
__USE_LARGEFILE


117 #undeà
__USE_LARGEFILE64


118 #undeà
__USE_FILE_OFFSET64


119 #undeà
__USE_BSD


120 #undeà
__USE_SVID


121 #undeà
__USE_MISC


122 #undeà
__USE_ATFILE


123 #undeà
__USE_GNU


124 #undeà
__USE_REENTRANT


125 #undeà
__USE_FORTIFY_LEVEL


126 #undeà
__KERNEL_STRICT_NAMES


130 #iâdeà
_LOOSE_KERNEL_NAMES


131 
	#__KERNEL_STRICT_NAMES


	)

141 #ià
defšed
 
__GNUC__
 && defšed 
__GNUC_MINOR__


142 
	#__GNUC_PREREQ
(
maj
, 
mš
) \

143 ((
__GNUC__
 << 16è+ 
__GNUC_MINOR__
 >ğ((
maj
è<< 16è+ (
mš
))

	)

145 
	#__GNUC_PREREQ
(
maj
, 
mš
è0

	)

150 #ifdeà
_GNU_SOURCE


151 #undeà
_ISOC95_SOURCE


152 
	#_ISOC95_SOURCE
 1

	)

153 #undeà
_ISOC99_SOURCE


154 
	#_ISOC99_SOURCE
 1

	)

155 #undeà
_ISOC11_SOURCE


156 
	#_ISOC11_SOURCE
 1

	)

157 #undeà
_POSIX_SOURCE


158 
	#_POSIX_SOURCE
 1

	)

159 #undeà
_POSIX_C_SOURCE


160 
	#_POSIX_C_SOURCE
 200809L

	)

161 #undeà
_XOPEN_SOURCE


162 
	#_XOPEN_SOURCE
 700

	)

163 #undeà
_XOPEN_SOURCE_EXTENDED


164 
	#_XOPEN_SOURCE_EXTENDED
 1

	)

165 #undeà
_LARGEFILE64_SOURCE


166 
	#_LARGEFILE64_SOURCE
 1

	)

167 #undeà
_DEFAULT_SOURCE


168 
	#_DEFAULT_SOURCE
 1

	)

169 #undeà
_BSD_SOURCE


170 
	#_BSD_SOURCE
 1

	)

171 #undeà
_SVID_SOURCE


172 
	#_SVID_SOURCE
 1

	)

173 #undeà
_ATFILE_SOURCE


174 
	#_ATFILE_SOURCE
 1

	)

179 #ià(
defšed
 
_DEFAULT_SOURCE
 \

180 || (!
defšed
 
	g__STRICT_ANSI__
 \

181 && !
defšed
 
	g_ISOC99_SOURCE
 \

182 && !
defšed
 
	g_POSIX_SOURCE
 && !defšed 
	g_POSIX_C_SOURCE
 \

183 && !
defšed
 
	g_XOPEN_SOURCE
 \

184 && !
defšed
 
	g_BSD_SOURCE
 && !defšed 
	g_SVID_SOURCE
))

185 #undeà
_DEFAULT_SOURCE


186 
	#_DEFAULT_SOURCE
 1

	)

187 #undeà
_BSD_SOURCE


188 
	#_BSD_SOURCE
 1

	)

189 #undeà
_SVID_SOURCE


190 
	#_SVID_SOURCE
 1

	)

194 #ià(
defšed
 
_ISOC11_SOURCE
 \

195 || (
defšed
 
	g__STDC_VERSION__
 && __STDC_VERSION__ >= 201112L))

196 
	#__USE_ISOC11
 1

	)

200 #ià(
defšed
 
_ISOC99_SOURCE
 || defšed 
_ISOC11_SOURCE
 \

201 || (
defšed
 
__STDC_VERSION__
 && __STDC_VERSION__ >= 199901L))

202 
	#__USE_ISOC99
 1

	)

206 #ià(
defšed
 
_ISOC99_SOURCE
 || defšed 
_ISOC11_SOURCE
 \

207 || (
defšed
 
__STDC_VERSION__
 && __STDC_VERSION__ >= 199409L))

208 
	#__USE_ISOC95
 1

	)

215 #ià((
defšed
 
__ılu¥lus
 && __cplusplus >= 201103L) \

216 || 
defšed
 
__GXX_EXPERIMENTAL_CXX0X__
)

217 
	#__USE_ISOCXX11
 1

	)

223 #ifdeà
_DEFAULT_SOURCE


224 #ià!
defšed
 
_POSIX_SOURCE
 && !defšed 
_POSIX_C_SOURCE


225 
	#__USE_POSIX_IMPLICITLY
 1

	)

227 #undeà
_POSIX_SOURCE


228 
	#_POSIX_SOURCE
 1

	)

229 #undeà
_POSIX_C_SOURCE


230 
	#_POSIX_C_SOURCE
 200809L

	)

232 #ià((!
defšed
 
__STRICT_ANSI__
 || (
_XOPEN_SOURCE
 - 0) >= 500) && \

233 !
defšed
 
_POSIX_SOURCE
 && !defšed 
_POSIX_C_SOURCE
)

234 
	#_POSIX_SOURCE
 1

	)

235 #ià
defšed
 
_XOPEN_SOURCE
 && (_XOPEN_SOURCE - 0) < 500

236 
	#_POSIX_C_SOURCE
 2

	)

237 #–ià
defšed
 
_XOPEN_SOURCE
 && (_XOPEN_SOURCE - 0) < 600

238 
	#_POSIX_C_SOURCE
 199506L

	)

239 #–ià
defšed
 
_XOPEN_SOURCE
 && (_XOPEN_SOURCE - 0) < 700

240 
	#_POSIX_C_SOURCE
 200112L

	)

242 
	#_POSIX_C_SOURCE
 200809L

	)

244 
	#__USE_POSIX_IMPLICITLY
 1

	)

247 #ià
defšed
 
_POSIX_SOURCE
 || 
_POSIX_C_SOURCE
 >ğ1 || defšed 
_XOPEN_SOURCE


248 
	#__USE_POSIX
 1

	)

251 #ià
defšed
 
_POSIX_C_SOURCE
 && _POSIX_C_SOURCE >ğ2 || defšed 
_XOPEN_SOURCE


252 
	#__USE_POSIX2
 1

	)

255 #ià(
_POSIX_C_SOURCE
 - 0) >= 199309L

256 
	#__USE_POSIX199309
 1

	)

259 #ià(
_POSIX_C_SOURCE
 - 0) >= 199506L

260 
	#__USE_POSIX199506
 1

	)

263 #ià(
_POSIX_C_SOURCE
 - 0) >= 200112L

264 
	#__USE_XOPEN2K
 1

	)

265 #undeà
__USE_ISOC95


266 
	#__USE_ISOC95
 1

	)

267 #undeà
__USE_ISOC99


268 
	#__USE_ISOC99
 1

	)

271 #ià(
_POSIX_C_SOURCE
 - 0) >= 200809L

272 
	#__USE_XOPEN2K8
 1

	)

273 #undeà
_ATFILE_SOURCE


274 
	#_ATFILE_SOURCE
 1

	)

277 #ifdef 
_XOPEN_SOURCE


278 
	#__USE_XOPEN
 1

	)

279 #ià(
_XOPEN_SOURCE
 - 0) >= 500

280 
	#__USE_XOPEN_EXTENDED
 1

	)

281 
	#__USE_UNIX98
 1

	)

282 #undeà
_LARGEFILE_SOURCE


283 
	#_LARGEFILE_SOURCE
 1

	)

284 #ià(
_XOPEN_SOURCE
 - 0) >= 600

285 #ià(
_XOPEN_SOURCE
 - 0) >= 700

286 
	#__USE_XOPEN2K8
 1

	)

287 
	#__USE_XOPEN2K8XSI
 1

	)

289 
	#__USE_XOPEN2K
 1

	)

290 
	#__USE_XOPEN2KXSI
 1

	)

291 #undeà
__USE_ISOC95


292 
	#__USE_ISOC95
 1

	)

293 #undeà
__USE_ISOC99


294 
	#__USE_ISOC99
 1

	)

297 #ifdeà
_XOPEN_SOURCE_EXTENDED


298 
	#__USE_XOPEN_EXTENDED
 1

	)

303 #ifdeà
_LARGEFILE_SOURCE


304 
	#__USE_LARGEFILE
 1

	)

307 #ifdeà
_LARGEFILE64_SOURCE


308 
	#__USE_LARGEFILE64
 1

	)

311 #ià
defšed
 
_FILE_OFFSET_BITS
 && _FILE_OFFSET_BITS == 64

312 
	#__USE_FILE_OFFSET64
 1

	)

315 #ià
defšed
 
_BSD_SOURCE
 || defšed 
_SVID_SOURCE


316 
	#__USE_MISC
 1

	)

319 #ifdef 
_BSD_SOURCE


320 
	#__USE_BSD
 1

	)

323 #ifdef 
_SVID_SOURCE


324 
	#__USE_SVID
 1

	)

327 #ifdef 
_ATFILE_SOURCE


328 
	#__USE_ATFILE
 1

	)

331 #ifdef 
_GNU_SOURCE


332 
	#__USE_GNU
 1

	)

335 #ià
defšed
 
_REENTRANT
 || defšed 
_THREAD_SAFE


336 
	#__USE_REENTRANT
 1

	)

339 #ià
defšed
 
_FORTIFY_SOURCE
 && _FORTIFY_SOURCE > 0 \

340 && 
__GNUC_PREREQ
 (4, 1è&& 
defšed
 
	g__OPTIMIZE__
 && __OPTIMIZE__ > 0

341 #ià
_FORTIFY_SOURCE
 > 1

342 
	#__USE_FORTIFY_LEVEL
 2

	)

344 
	#__USE_FORTIFY_LEVEL
 1

	)

347 
	#__USE_FORTIFY_LEVEL
 0

	)

352 
	~<¡dc-´edef.h
>

360 #undeà
__GNU_LIBRARY__


361 
	#__GNU_LIBRARY__
 6

	)

365 
	#__GLIBC__
 2

	)

366 
	#__GLIBC_MINOR__
 19

	)

368 
	#__GLIBC_PREREQ
(
maj
, 
mš
) \

369 ((
__GLIBC__
 << 16è+ 
__GLIBC_MINOR__
 >ğ((
maj
è<< 16è+ (
mš
))

	)

372 #iâdeà
__ASSEMBLER__


373 #iâdeà
_SYS_CDEFS_H


374 
	~<sys/cdefs.h
>

379 #ià
defšed
 
__USE_FILE_OFFSET64
 && !defšed 
__REDIRECT


380 
	#__USE_LARGEFILE
 1

	)

381 
	#__USE_LARGEFILE64
 1

	)

387 #ià
__GNUC_PREREQ
 (2, 7è&& 
defšed
 
__OPTIMIZE__
 \

388 && !
defšed
 
	g__OPTIMIZE_SIZE__
 && !defšed 
	g__NO_INLINE__
 \

389 && 
defšed
 
	g__ex‹º_šlše


390 
	#__USE_EXTERN_INLINES
 1

	)

398 
	~<gnu/¡ubs.h
>

	@/usr/include/getopt.h

19 #iâdeà
_GETOPT_H


21 #iâdeà
__Ãed_g‘İt


22 
	#_GETOPT_H
 1

	)

32 #ià!
defšed
 
__GNU_LIBRARY__


33 
	~<ùy³.h
>

36 #iâdeà
__THROW


37 #iâdeà
__GNUC_PREREQ


38 
	#__GNUC_PREREQ
(
maj
, 
mš
è(0)

	)

40 #ià
defšed
 
__ılu¥lus
 && 
__GNUC_PREREQ
 (2,8)

41 
	#__THROW
 
	`throw
 ()

	)

43 
	#__THROW


	)

47 #ifdef 
__ılu¥lus


57 *
İrg
;

71 
İtšd
;

76 
İ‹¼
;

80 
İtİt
;

82 #iâdeà
__Ãed_g‘İt


104 
	sİtiÚ


106 cÚ¡ *
	gÇme
;

109 
	ghas_¬g
;

110 *
	gæag
;

111 
	gv®
;

116 
	#no_¬gum’t
 0

	)

117 
	#»quœed_¬gum’t
 1

	)

118 
	#İtiÚ®_¬gum’t
 2

	)

146 #ifdeà
__GNU_LIBRARY__


150 
g‘İt
 (
___¬gc
, *cÚ¡ *
___¬gv
, cÚ¡ *
__shÜtİts
)

151 
__THROW
;

153 #ià
defšed
 
__Ãed_g‘İt
 && defšed 
__USE_POSIX2
 \

154 && !
defšed
 
	g__USE_POSIX_IMPLICITLY
 && !defšed 
	g__USE_GNU


158 #ifdeà
__REDIRECT


159 
__REDIRECT_NTH
 (
g‘İt
, (
___¬gc
, *cÚ¡ *
___¬gv
,

160 cÚ¡ *
__shÜtİts
),

161 
__posix_g‘İt
);

163 
__posix_g‘İt
 (
___¬gc
, *cÚ¡ *
___¬gv
,

164 cÚ¡ *
__shÜtİts
è
__THROW
;

165 
	#g‘İt
 
__posix_g‘İt


	)

169 
g‘İt
 ();

172 #iâdeà
__Ãed_g‘İt


173 
g‘İt_lÚg
 (
___¬gc
, *cÚ¡ *
___¬gv
,

174 cÚ¡ *
__shÜtİts
,

175 cÚ¡ 
İtiÚ
 *
__lÚgİts
, *
__lÚgšd
)

176 
__THROW
;

177 
g‘İt_lÚg_Úly
 (
___¬gc
, *cÚ¡ *
___¬gv
,

178 cÚ¡ *
__shÜtİts
,

179 cÚ¡ 
İtiÚ
 *
__lÚgİts
, *
__lÚgšd
)

180 
__THROW
;

184 #ifdef 
__ılu¥lus


189 #undeà
__Ãed_g‘İt


	@/usr/include/libio.h

28 #iâdeà
_IO_STDIO_H


29 
	#_IO_STDIO_H


	)

31 
	~<_G_cÚfig.h
>

33 
	#_IO_åos_t
 
_G_åos_t


	)

34 
	#_IO_åos64_t
 
_G_åos64_t


	)

35 
	#_IO_size_t
 
size_t


	)

36 
	#_IO_ssize_t
 
__ssize_t


	)

37 
	#_IO_off_t
 
__off_t


	)

38 
	#_IO_off64_t
 
__off64_t


	)

39 
	#_IO_pid_t
 
__pid_t


	)

40 
	#_IO_uid_t
 
__uid_t


	)

41 
	#_IO_icÚv_t
 
_G_icÚv_t


	)

42 
	#_IO_HAVE_ST_BLKSIZE
 
_G_HAVE_ST_BLKSIZE


	)

43 
	#_IO_BUFSIZ
 
_G_BUFSIZ


	)

44 
	#_IO_va_li¡
 
_G_va_li¡


	)

45 
	#_IO_wšt_t
 
wšt_t


	)

48 
	#__Ãed___va_li¡


	)

49 
	~<¡d¬g.h
>

50 #ifdeà
__GNUC_VA_LIST


51 #undeà
_IO_va_li¡


52 
	#_IO_va_li¡
 
__gnuc_va_li¡


	)

55 #iâdeà
__P


56 
	~<sys/cdefs.h
>

59 
	#_IO_UNIFIED_JUMPTABLES
 1

	)

61 #iâdeà
EOF


62 
	#EOF
 (-1)

	)

64 #iâdeà
NULL


65 #ià
defšed
 
__GNUG__
 && \

66 (
	g__GNUC__
 > 2 || (__GNUC__ =ğ2 && 
__GNUC_MINOR__
 >= 8))

67 
	#NULL
 (
__nuÎ
)

	)

69 #ià!
defšed
(
__ılu¥lus
)

70 
	#NULL
 ((*)0)

	)

72 
	#NULL
 (0)

	)

77 
	#_IOS_INPUT
 1

	)

78 
	#_IOS_OUTPUT
 2

	)

79 
	#_IOS_ATEND
 4

	)

80 
	#_IOS_APPEND
 8

	)

81 
	#_IOS_TRUNC
 16

	)

82 
	#_IOS_NOCREATE
 32

	)

83 
	#_IOS_NOREPLACE
 64

	)

84 
	#_IOS_BIN
 128

	)

92 
	#_IO_MAGIC
 0xFBAD0000

	)

93 
	#_OLD_STDIO_MAGIC
 0xFABC0000

	)

94 
	#_IO_MAGIC_MASK
 0xFFFF0000

	)

95 
	#_IO_USER_BUF
 1

	)

96 
	#_IO_UNBUFFERED
 2

	)

97 
	#_IO_NO_READS
 4

	)

98 
	#_IO_NO_WRITES
 8

	)

99 
	#_IO_EOF_SEEN
 0x10

	)

100 
	#_IO_ERR_SEEN
 0x20

	)

101 
	#_IO_DELETE_DONT_CLOSE
 0x40

	)

102 
	#_IO_LINKED
 0x80

	)

103 
	#_IO_IN_BACKUP
 0x100

	)

104 
	#_IO_LINE_BUF
 0x200

	)

105 
	#_IO_TIED_PUT_GET
 0x400

	)

106 
	#_IO_CURRENTLY_PUTTING
 0x800

	)

107 
	#_IO_IS_APPENDING
 0x1000

	)

108 
	#_IO_IS_FILEBUF
 0x2000

	)

109 
	#_IO_BAD_SEEN
 0x4000

	)

110 
	#_IO_USER_LOCK
 0x8000

	)

112 
	#_IO_FLAGS2_MMAP
 1

	)

113 
	#_IO_FLAGS2_NOTCANCEL
 2

	)

114 #ifdeà
_LIBC


115 
	#_IO_FLAGS2_FORTIFY
 4

	)

117 
	#_IO_FLAGS2_USER_WBUF
 8

	)

118 #ifdeà
_LIBC


119 
	#_IO_FLAGS2_SCANF_STD
 16

	)

120 
	#_IO_FLAGS2_NOCLOSE
 32

	)

121 
	#_IO_FLAGS2_CLOEXEC
 64

	)

125 
	#_IO_SKIPWS
 01

	)

126 
	#_IO_LEFT
 02

	)

127 
	#_IO_RIGHT
 04

	)

128 
	#_IO_INTERNAL
 010

	)

129 
	#_IO_DEC
 020

	)

130 
	#_IO_OCT
 040

	)

131 
	#_IO_HEX
 0100

	)

132 
	#_IO_SHOWBASE
 0200

	)

133 
	#_IO_SHOWPOINT
 0400

	)

134 
	#_IO_UPPERCASE
 01000

	)

135 
	#_IO_SHOWPOS
 02000

	)

136 
	#_IO_SCIENTIFIC
 04000

	)

137 
	#_IO_FIXED
 010000

	)

138 
	#_IO_UNITBUF
 020000

	)

139 
	#_IO_STDIO
 040000

	)

140 
	#_IO_DONT_CLOSE
 0100000

	)

141 
	#_IO_BOOLALPHA
 0200000

	)

144 
_IO_jump_t
; 
	g_IO_FILE
;

147 #ifdeà
_IO_MTSAFE_IO


148 #ià
defšed
 
__GLIBC__
 && __GLIBC__ >= 2

149 
	~<b™s/¡dio-lock.h
>

154 
	t_IO_lock_t
;

160 
	s_IO_m¬k”
 {

161 
_IO_m¬k”
 *
	m_Ãxt
;

162 
_IO_FILE
 *
	m_sbuf
;

166 
	m_pos
;

168 
£t_¡»ampos
(
¡»ampos
 
¥
è{ 
	m_¥os
 = sp; }

169 
£t_off£t
(
off£t
è{ 
	m_pos
 = off£t; 
	m_¥os
 = (
¡»ampos
)(-2); }

170 
	mpublic
:

171 
¡»amm¬k”
(
¡»ambuf
 *
sb
);

172 ~
¡»amm¬k”
();

173 
§všg
(è{  
	m_¥os
 == -2; }

174 
d–
(
¡»amm¬k”
&);

175 
d–
();

180 
	e__codecvt_»suÉ


182 
	m__codecvt_ok
,

183 
	m__codecvt_·¹Ÿl
,

184 
	m__codecvt_”rÜ
,

185 
	m__codecvt_nocÚv


188 #ià
defšed
 
_LIBC
 || defšed 
_GLIBCPP_USE_WCHAR_T


191 
	s_IO_codecvt


193 (*
	m__codecvt_de¡r
è(
	m_IO_codecvt
 *);

194 
__codecvt_»suÉ
 (*
__codecvt_do_out
è(
	m_IO_codecvt
 *,

195 
	m__mb¡©e_t
 *,

196 cÚ¡ 
	mwch¬_t
 *,

197 cÚ¡ 
	mwch¬_t
 *,

198 cÚ¡ 
	mwch¬_t
 **, *,

200 
__codecvt_»suÉ
 (*
__codecvt_do_unshiá
è(
	m_IO_codecvt
 *,

201 
	m__mb¡©e_t
 *, *,

203 
__codecvt_»suÉ
 (*
__codecvt_do_š
è(
	m_IO_codecvt
 *,

204 
	m__mb¡©e_t
 *,

206 cÚ¡ **, 
	mwch¬_t
 *,

207 
	mwch¬_t
 *, wchar_t **);

208 (*
	m__codecvt_do_’codšg
è(
	m_IO_codecvt
 *);

209 (*
	m__codecvt_do_®ways_nocÚv
è(
	m_IO_codecvt
 *);

210 (*
	m__codecvt_do_Ëngth
è(
	m_IO_codecvt
 *, 
	m__mb¡©e_t
 *,

211 cÚ¡ *, cÚ¡ *, 
	m_IO_size_t
);

212 (*
	m__codecvt_do_max_Ëngth
è(
	m_IO_codecvt
 *);

214 
_IO_icÚv_t
 
	m__cd_š
;

215 
_IO_icÚv_t
 
	m__cd_out
;

219 
	s_IO_wide_d©a


221 
wch¬_t
 *
	m_IO_»ad_±r
;

222 
wch¬_t
 *
	m_IO_»ad_’d
;

223 
wch¬_t
 *
	m_IO_»ad_ba£
;

224 
wch¬_t
 *
	m_IO_wr™e_ba£
;

225 
wch¬_t
 *
	m_IO_wr™e_±r
;

226 
wch¬_t
 *
	m_IO_wr™e_’d
;

227 
wch¬_t
 *
	m_IO_buf_ba£
;

228 
wch¬_t
 *
	m_IO_buf_’d
;

230 
wch¬_t
 *
	m_IO_§ve_ba£
;

231 
wch¬_t
 *
	m_IO_backup_ba£
;

233 
wch¬_t
 *
	m_IO_§ve_’d
;

235 
__mb¡©e_t
 
	m_IO_¡©e
;

236 
__mb¡©e_t
 
	m_IO_Ï¡_¡©e
;

237 
_IO_codecvt
 
	m_codecvt
;

239 
wch¬_t
 
	m_shÜtbuf
[1];

241 cÚ¡ 
_IO_jump_t
 *
	m_wide_vbË
;

245 
	s_IO_FILE
 {

246 
	m_æags
;

247 
	#_IO_fe_æags
 
_æags


	)

251 * 
	m_IO_»ad_±r
;

252 * 
	m_IO_»ad_’d
;

253 * 
	m_IO_»ad_ba£
;

254 * 
	m_IO_wr™e_ba£
;

255 * 
	m_IO_wr™e_±r
;

256 * 
	m_IO_wr™e_’d
;

257 * 
	m_IO_buf_ba£
;

258 * 
	m_IO_buf_’d
;

260 *
	m_IO_§ve_ba£
;

261 *
	m_IO_backup_ba£
;

262 *
	m_IO_§ve_’d
;

264 
_IO_m¬k”
 *
	m_m¬k”s
;

266 
_IO_FILE
 *
	m_chaš
;

268 
	m_f’o
;

270 
	m_blksize
;

272 
	m_æags2
;

274 
_IO_off_t
 
	m_Şd_off£t
;

276 
	#__HAVE_COLUMN


	)

278 
	m_cur_cŞumn
;

279 sigÃd 
	m_vbË_off£t
;

280 
	m_shÜtbuf
[1];

284 
_IO_lock_t
 *
	m_lock
;

285 #ifdeà
_IO_USE_OLD_IO_FILE


288 
	s_IO_FILE_com¶‘e


290 
_IO_FILE
 
	m_fe
;

292 #ià
defšed
 
_G_IO_IO_FILE_VERSION
 && _G_IO_IO_FILE_VERSION == 0x20001

293 
_IO_off64_t
 
	m_off£t
;

294 #ià
defšed
 
_LIBC
 || defšed 
_GLIBCPP_USE_WCHAR_T


296 
_IO_codecvt
 *
	m_codecvt
;

297 
_IO_wide_d©a
 *
	m_wide_d©a
;

298 
_IO_FILE
 *
	m_ä“»s_li¡
;

299 *
	m_ä“»s_buf
;

300 
size_t
 
	m_ä“»s_size
;

302 *
	m__·d1
;

303 *
	m__·d2
;

304 *
	m__·d3
;

305 *
	m__·d4
;

306 
size_t
 
	m__·d5
;

308 
	m_mode
;

310 
	m_unu£d2
[15 *  (è- 4 *  (*è-  (
size_t
)];

314 #iâdeà
__ılu¥lus


315 
_IO_FILE
 
	t_IO_FILE
;

318 
	g_IO_FILE_¶us
;

320 
_IO_FILE_¶us
 
_IO_2_1_¡dš_
;

321 
_IO_FILE_¶us
 
_IO_2_1_¡dout_
;

322 
_IO_FILE_¶us
 
_IO_2_1_¡d”r_
;

323 #iâdeà
_LIBC


324 
	#_IO_¡dš
 ((
_IO_FILE
*)(&
_IO_2_1_¡dš_
))

	)

325 
	#_IO_¡dout
 ((
_IO_FILE
*)(&
_IO_2_1_¡dout_
))

	)

326 
	#_IO_¡d”r
 ((
_IO_FILE
*)(&
_IO_2_1_¡d”r_
))

	)

328 
_IO_FILE
 *
_IO_¡dš
 
©Œibu‹_hidd’
;

329 
_IO_FILE
 *
_IO_¡dout
 
©Œibu‹_hidd’
;

330 
_IO_FILE
 *
_IO_¡d”r
 
©Œibu‹_hidd’
;

338 
__ssize_t
 
	t__io_»ad_â
 (*
	t__cook›
, *
	t__buf
, 
	tsize_t
 
	t__nby‹s
);

346 
__ssize_t
 
	t__io_wr™e_â
 (*
	t__cook›
, cÚ¡ *
	t__buf
,

347 
	tsize_t
 
	t__n
);

355 
	t__io_£ek_â
 (*
	t__cook›
, 
	t_IO_off64_t
 *
	t__pos
, 
	t__w
);

358 
	t__io_şo£_â
 (*
	t__cook›
);

361 #ifdeà
_GNU_SOURCE


363 
__io_»ad_â
 
	tcook›_»ad_funùiÚ_t
;

364 
__io_wr™e_â
 
	tcook›_wr™e_funùiÚ_t
;

365 
__io_£ek_â
 
	tcook›_£ek_funùiÚ_t
;

366 
__io_şo£_â
 
	tcook›_şo£_funùiÚ_t
;

371 
__io_»ad_â
 *
	m»ad
;

372 
__io_wr™e_â
 *
	mwr™e
;

373 
__io_£ek_â
 *
	m£ek
;

374 
__io_şo£_â
 *
	mşo£
;

375 } 
	t_IO_cook›_io_funùiÚs_t
;

376 
_IO_cook›_io_funùiÚs_t
 
	tcook›_io_funùiÚs_t
;

378 
	g_IO_cook›_fe
;

381 
_IO_cook›_š™
 (
_IO_cook›_fe
 *
__cfe
, 
__»ad_wr™e
,

382 *
__cook›
, 
_IO_cook›_io_funùiÚs_t
 
__âs
);

386 #ifdeà
__ılu¥lus


390 
__und”æow
 (
_IO_FILE
 *);

391 
__uæow
 (
_IO_FILE
 *);

392 
__ov”æow
 (
_IO_FILE
 *, );

393 #ià
defšed
 
_LIBC
 || defšed 
_GLIBCPP_USE_WCHAR_T


394 
_IO_wšt_t
 
__wund”æow
 (
_IO_FILE
 *);

395 
_IO_wšt_t
 
__wuæow
 (
_IO_FILE
 *);

396 
_IO_wšt_t
 
__wov”æow
 (
_IO_FILE
 *, _IO_wint_t);

399 #ià 
__GNUC__
 >= 3

400 
	#_IO_BE
(
ex´
, 
»s
è
	`__butš_ex³ù
 (Óx´),„es)

	)

402 
	#_IO_BE
(
ex´
, 
»s
èÓx´)

	)

405 
	#_IO_g‘c_uÆocked
(
_å
) \

406 (
	`_IO_BE
 ((
_å
)->
_IO_»ad_±r
 >ğ(_å)->
_IO_»ad_’d
, 0) \

407 ? 
	`__uæow
 (
_å
è: *(*è(_å)->
_IO_»ad_±r
++)

	)

408 
	#_IO_³ekc_uÆocked
(
_å
) \

409 (
	`_IO_BE
 ((
_å
)->
_IO_»ad_±r
 >ğ(_å)->
_IO_»ad_’d
, 0) \

410 && 
	`__und”æow
 (
_å
è=ğ
EOF
 ? EOF \

411 : *(*è(
_å
)->
_IO_»ad_±r
)

	)

412 
	#_IO_putc_uÆocked
(
_ch
, 
_å
) \

413 (
	`_IO_BE
 ((
_å
)->
_IO_wr™e_±r
 >ğ(_å)->
_IO_wr™e_’d
, 0) \

414 ? 
	`__ov”æow
 (
_å
, (è(
_ch
)) \

415 : (è(*(
_å
)->
_IO_wr™e_±r
++ = (
_ch
)))

	)

417 #ià
defšed
 
_LIBC
 || defšed 
_GLIBCPP_USE_WCHAR_T


418 
	#_IO_g‘wc_uÆocked
(
_å
) \

419 (
	`_IO_BE
 ((
_å
)->
_wide_d©a
 =ğ
NULL
 \

420 || ((
_å
)->
_wide_d©a
->
_IO_»ad_±r
 \

421 >ğ(
_å
)->
_wide_d©a
->
_IO_»ad_’d
), 0) \

422 ? 
	`__wuæow
 (
_å
è: (
_IO_wšt_t
è*(_å)->
_wide_d©a
->
_IO_»ad_±r
++)

	)

423 
	#_IO_putwc_uÆocked
(
_wch
, 
_å
) \

424 (
	`_IO_BE
 ((
_å
)->
_wide_d©a
 =ğ
NULL
 \

425 || ((
_å
)->
_wide_d©a
->
_IO_wr™e_±r
 \

426 >ğ(
_å
)->
_wide_d©a
->
_IO_wr™e_’d
), 0) \

427 ? 
	`__wov”æow
 (
_å
, 
_wch
) \

428 : (
_IO_wšt_t
è(*(
_å
)->
_wide_d©a
->
_IO_wr™e_±r
++ = (
_wch
)))

	)

431 
	#_IO_ãof_uÆocked
(
__å
è(((__å)->
_æags
 & 
_IO_EOF_SEEN
è!ğ0)

	)

432 
	#_IO_ã¼Ü_uÆocked
(
__å
è(((__å)->
_æags
 & 
_IO_ERR_SEEN
è!ğ0)

	)

434 
_IO_g‘c
 (
_IO_FILE
 *
__å
);

435 
_IO_putc
 (
__c
, 
_IO_FILE
 *
__å
);

436 
_IO_ãof
 (
_IO_FILE
 *
__å
è
__THROW
;

437 
_IO_ã¼Ü
 (
_IO_FILE
 *
__å
è
__THROW
;

439 
_IO_³ekc_locked
 (
_IO_FILE
 *
__å
);

442 
	#_IO_PENDING_OUTPUT_COUNT
(
_å
) \

443 ((
_å
)->
_IO_wr™e_±r
 - (_å)->
_IO_wr™e_ba£
)

	)

445 
_IO_æockfe
 (
_IO_FILE
 *è
__THROW
;

446 
_IO_fuÆockfe
 (
_IO_FILE
 *è
__THROW
;

447 
_IO_árylockfe
 (
_IO_FILE
 *è
__THROW
;

449 #ifdeà
_IO_MTSAFE_IO


450 
	#_IO_³ekc
(
_å
è
	`_IO_³ekc_locked
 (_å)

	)

451 
	#_IO_æockfe
(
_å
) \

452 ià(((
_å
)->
_æags
 & 
_IO_USER_LOCK
è=ğ0è
	`_IO_æockfe
 (_å)

	)

453 
	#_IO_fuÆockfe
(
_å
) \

454 ià(((
_å
)->
_æags
 & 
_IO_USER_LOCK
è=ğ0è
	`_IO_fuÆockfe
 (_å)

	)

456 
	#_IO_³ekc
(
_å
è
	`_IO_³ekc_uÆocked
 (_å)

	)

457 
	#_IO_æockfe
(
_å
è

	)

458 
	#_IO_fuÆockfe
(
_å
è

	)

459 
	#_IO_árylockfe
(
_å
è

	)

460 
	#_IO_ş—nup_»giÚ_¡¬t
(
_fù
, 
_å
è

	)

461 
	#_IO_ş—nup_»giÚ_’d
(
_Do™
è

	)

464 
_IO_vfsÿnf
 (
_IO_FILE
 * 
__»¡riù
, const * __restrict,

465 
_IO_va_li¡
, *
__»¡riù
);

466 
_IO_vårštf
 (
_IO_FILE
 *
__»¡riù
, const *__restrict,

467 
_IO_va_li¡
);

468 
_IO_ssize_t
 
_IO_·dn
 (
_IO_FILE
 *, , _IO_ssize_t);

469 
_IO_size_t
 
_IO_sg‘n
 (
_IO_FILE
 *, *, _IO_size_t);

471 
_IO_off64_t
 
_IO_£ekoff
 (
_IO_FILE
 *, _IO_off64_t, , );

472 
_IO_off64_t
 
_IO_£ekpos
 (
_IO_FILE
 *, _IO_off64_t, );

474 
_IO_ä“_backup_¬—
 (
_IO_FILE
 *è
__THROW
;

476 #ià
defšed
 
_LIBC
 || defšed 
_GLIBCPP_USE_WCHAR_T


477 
_IO_wšt_t
 
_IO_g‘wc
 (
_IO_FILE
 *
__å
);

478 
_IO_wšt_t
 
_IO_putwc
 (
wch¬_t
 
__wc
, 
_IO_FILE
 *
__å
);

479 
_IO_fwide
 (
_IO_FILE
 *
__å
, 
__mode
è
__THROW
;

480 #ià
__GNUC__
 >= 2

483 #ià
defšed
 
_LIBC
 && defšed 
SHARED


484 
	~<shlib-com·t.h
>

485 #ià
SHLIB_COMPAT
 (
libc
, 
GLIBC_2_0
, 
GLIBC_2_1
)

486 
	#_IO_fwide_maybe_šcom·tibË
 \

487 (
	`__butš_ex³ù
 (&
_IO_¡dš_u£d
 =ğ
NULL
, 0))

	)

488 cÚ¡ 
_IO_¡dš_u£d
;

489 
w—k_ex‹º
 (
_IO_¡dš_u£d
);

492 #iâdeà
_IO_fwide_maybe_šcom·tibË


493 
	#_IO_fwide_maybe_šcom·tibË
 (0)

	)

497 
	#_IO_fwide
(
__å
, 
__mode
) \

498 ({ 
__»suÉ
 = (
__mode
); \

499 ià(
__»suÉ
 < 0 && ! 
_IO_fwide_maybe_šcom·tibË
) \

501 ià((
__å
)->
_mode
 == 0) \

503 (
__å
)->
_mode
 = -1; \

504 
__»suÉ
 = (
__å
)->
_mode
; \

506 ià(
	`__butš_cÚ¡ªt_p
 (
__mode
) && (__mode) == 0) \

507 
__»suÉ
 = 
_IO_fwide_maybe_šcom·tibË
 ? -1 : (
__å
)->
_mode
; \

509 
__»suÉ
 = 
	`_IO_fwide
 (
__å
, __result); \

510 
__»suÉ
; })

	)

513 
_IO_vfwsÿnf
 (
_IO_FILE
 * 
__»¡riù
, cÚ¡ 
wch¬_t
 * __restrict,

514 
_IO_va_li¡
, *
__»¡riù
);

515 
_IO_vfw´štf
 (
_IO_FILE
 *
__»¡riù
, cÚ¡ 
wch¬_t
 *__restrict,

516 
_IO_va_li¡
);

517 
_IO_ssize_t
 
_IO_w·dn
 (
_IO_FILE
 *, 
wšt_t
, _IO_ssize_t);

518 
_IO_ä“_wbackup_¬—
 (
_IO_FILE
 *è
__THROW
;

521 #ifdeà
__LDBL_COMPAT


522 
	~<b™s/libio-ldbl.h
>

525 #ifdeà
__ılu¥lus


	@/usr/include/sched.h

19 #iâdef 
_SCHED_H


20 
	#_SCHED_H
 1

	)

22 
	~<ã©u»s.h
>

25 
	~<b™s/ty³s.h
>

27 
	#__Ãed_size_t


	)

28 
	~<¡ddef.h
>

30 
	#__Ãed_time_t


	)

31 
	#__Ãed_time¥ec


	)

32 
	~<time.h
>

34 #iâdeà
__pid_t_defšed


35 
__pid_t
 
	tpid_t
;

36 
	#__pid_t_defšed


	)

41 
	~<b™s/sched.h
>

43 
	#sched_´iÜ™y
 
__sched_´iÜ™y


	)

46 
__BEGIN_DECLS


49 
	$sched_£¬am
 (
__pid_t
 
__pid
, cÚ¡ 
sched_·¿m
 *
__·¿m
)

50 
__THROW
;

53 
	$sched_g‘·¿m
 (
__pid_t
 
__pid
, 
sched_·¿m
 *
__·¿m
è
__THROW
;

56 
	$sched_£tscheduËr
 (
__pid_t
 
__pid
, 
__pŞicy
,

57 cÚ¡ 
sched_·¿m
 *
__·¿m
è
__THROW
;

60 
	$sched_g‘scheduËr
 (
__pid_t
 
__pid
è
__THROW
;

63 
	$sched_y›ld
 (è
__THROW
;

66 
	$sched_g‘_´iÜ™y_max
 (
__®gÜ™hm
è
__THROW
;

69 
	$sched_g‘_´iÜ™y_mš
 (
__®gÜ™hm
è
__THROW
;

72 
	$sched_¼_g‘_š‹rv®
 (
__pid_t
 
__pid
, 
time¥ec
 *
__t
è
__THROW
;

75 #ifdeà
__USE_GNU


77 
	#CPU_SETSIZE
 
__CPU_SETSIZE


	)

78 
	#CPU_SET
(
ıu
, 
ıu£
è
	`__CPU_SET_S
 (ıu,  (
ıu_£t_t
), cpu£)

	)

79 
	#CPU_CLR
(
ıu
, 
ıu£
è
	`__CPU_CLR_S
 (ıu,  (
ıu_£t_t
), cpu£)

	)

80 
	#CPU_ISSET
(
ıu
, 
ıu£
è
	`__CPU_ISSET_S
 (ıu,  (
ıu_£t_t
), \

81 
ıu£
)

	)

82 
	#CPU_ZERO
(
ıu£
è
	`__CPU_ZERO_S
 ( (
ıu_£t_t
), cpu£)

	)

83 
	#CPU_COUNT
(
ıu£
è
	`__CPU_COUNT_S
 ( (
ıu_£t_t
), cpu£)

	)

85 
	#CPU_SET_S
(
ıu
, 
£tsize
, 
ıu£
è
	`__CPU_SET_S
 (ıu, s‘size, cpu£)

	)

86 
	#CPU_CLR_S
(
ıu
, 
£tsize
, 
ıu£
è
	`__CPU_CLR_S
 (ıu, s‘size, cpu£)

	)

87 
	#CPU_ISSET_S
(
ıu
, 
£tsize
, 
ıu£
è
	`__CPU_ISSET_S
 (cpu, setsize, \

88 
ıu£
)

	)

89 
	#CPU_ZERO_S
(
£tsize
, 
ıu£
è
	`__CPU_ZERO_S
 (£tsize, cpu£)

	)

90 
	#CPU_COUNT_S
(
£tsize
, 
ıu£
è
	`__CPU_COUNT_S
 (£tsize, cpu£)

	)

92 
	#CPU_EQUAL
(
ıu£1
, 
ıu£2
) \

93 
	`__CPU_EQUAL_S
 ( (
ıu_£t_t
), 
ıu£1
, 
ıu£2
)

	)

94 
	#CPU_EQUAL_S
(
£tsize
, 
ıu£1
, 
ıu£2
) \

95 
	`__CPU_EQUAL_S
 (
£tsize
, 
ıu£1
, 
ıu£2
)

	)

97 
	#CPU_AND
(
de¡£t
, 
¤c£t1
, 
¤c£t2
) \

98 
	`__CPU_OP_S
 ( (
ıu_£t_t
), 
de¡£t
, 
¤c£t1
, 
¤c£t2
, &)

	)

99 
	#CPU_OR
(
de¡£t
, 
¤c£t1
, 
¤c£t2
) \

100 
	`__CPU_OP_S
 ( (
ıu_£t_t
), 
de¡£t
, 
¤c£t1
, 
¤c£t2
, |)

	)

101 
	#CPU_XOR
(
de¡£t
, 
¤c£t1
, 
¤c£t2
) \

102 
	`__CPU_OP_S
 ( (
ıu_£t_t
), 
de¡£t
, 
¤c£t1
, 
¤c£t2
, ^)

	)

103 
	#CPU_AND_S
(
£tsize
, 
de¡£t
, 
¤c£t1
, 
¤c£t2
) \

104 
	`__CPU_OP_S
 (
£tsize
, 
de¡£t
, 
¤c£t1
, 
¤c£t2
, &)

	)

105 
	#CPU_OR_S
(
£tsize
, 
de¡£t
, 
¤c£t1
, 
¤c£t2
) \

106 
	`__CPU_OP_S
 (
£tsize
, 
de¡£t
, 
¤c£t1
, 
¤c£t2
, |)

	)

107 
	#CPU_XOR_S
(
£tsize
, 
de¡£t
, 
¤c£t1
, 
¤c£t2
) \

108 
	`__CPU_OP_S
 (
£tsize
, 
de¡£t
, 
¤c£t1
, 
¤c£t2
, ^)

	)

110 
	#CPU_ALLOC_SIZE
(
couÁ
è
	`__CPU_ALLOC_SIZE
 (couÁ)

	)

111 
	#CPU_ALLOC
(
couÁ
è
	`__CPU_ALLOC
 (couÁ)

	)

112 
	#CPU_FREE
(
ıu£t
è
	`__CPU_FREE
 (ıu£t)

	)

116 
	$sched_£ffš™y
 (
__pid_t
 
__pid
, 
size_t
 
__ıu£tsize
,

117 cÚ¡ 
ıu_£t_t
 *
__ıu£t
è
__THROW
;

120 
	$sched_g‘affš™y
 (
__pid_t
 
__pid
, 
size_t
 
__ıu£tsize
,

121 
ıu_£t_t
 *
__ıu£t
è
__THROW
;

124 
__END_DECLS


	@/usr/include/xlocale.h

20 #iâdeà
_XLOCALE_H


21 
	#_XLOCALE_H
 1

	)

27 
	s__loÿË_¡ruù


30 
__loÿË_d©a
 *
	m__loÿËs
[13];

33 cÚ¡ *
	m__ùy³_b
;

34 cÚ¡ *
	m__ùy³_tŞow”
;

35 cÚ¡ *
	m__ùy³_touµ”
;

38 cÚ¡ *
	m__Çmes
[13];

39 } *
	t__loÿË_t
;

42 
__loÿË_t
 
	tloÿË_t
;

	@/usr/include/_G_config.h

4 #iâdeà
_G_cÚfig_h


5 
	#_G_cÚfig_h
 1

	)

9 
	~<b™s/ty³s.h
>

10 
	#__Ãed_size_t


	)

11 #ià
defšed
 
_LIBC
 || defšed 
_GLIBCPP_USE_WCHAR_T


12 
	#__Ãed_wch¬_t


	)

14 
	#__Ãed_NULL


	)

15 
	~<¡ddef.h
>

16 
	#__Ãed_mb¡©e_t


	)

17 #ià
defšed
 
_LIBC
 || defšed 
_GLIBCPP_USE_WCHAR_T


18 
	#__Ãed_wšt_t


	)

20 
	~<wch¬.h
>

23 
__off_t
 
	m__pos
;

24 
__mb¡©e_t
 
	m__¡©e
;

25 } 
	t_G_åos_t
;

28 
__off64_t
 
	m__pos
;

29 
__mb¡©e_t
 
	m__¡©e
;

30 } 
	t_G_åos64_t
;

31 #ià
defšed
 
_LIBC
 || defšed 
_GLIBCPP_USE_WCHAR_T


32 
	~<gcÚv.h
>

35 
__gcÚv_šfo
 
	m__cd
;

38 
__gcÚv_šfo
 
	m__cd
;

39 
__gcÚv_¡•_d©a
 
	m__d©a
;

40 } 
	m__combšed
;

41 } 
	t_G_icÚv_t
;

46 
	#_G_va_li¡
 
__gnuc_va_li¡


	)

48 
	#_G_HAVE_MMAP
 1

	)

49 
	#_G_HAVE_MREMAP
 1

	)

51 
	#_G_IO_IO_FILE_VERSION
 0x20001

	)

54 
	#_G_HAVE_ST_BLKSIZE
 
	`defšed
 (
_STATBUF_ST_BLKSIZE
)

	)

56 
	#_G_BUFSIZ
 8192

	)

	@/usr/include/ctype.h

22 #iâdef 
_CTYPE_H


23 
	#_CTYPE_H
 1

	)

25 
	~<ã©u»s.h
>

26 
	~<b™s/ty³s.h
>

28 
	g__BEGIN_DECLS


30 #iâdeà
_ISb™


39 
	~<’dŸn.h
>

40 #ià
__BYTE_ORDER
 =ğ
__BIG_ENDIAN


41 
	#_ISb™
(
b™
è(1 << (b™))

	)

43 
	#_ISb™
(
b™
è((b™è< 8 ? ((1 << (b™)è<< 8è: ((1 << (b™)è>> 8))

	)

48 
	m_ISuµ”
 = 
_ISb™
 (0),

49 
	m_ISlow”
 = 
_ISb™
 (1),

50 
	m_IS®pha
 = 
_ISb™
 (2),

51 
	m_ISdig™
 = 
_ISb™
 (3),

52 
	m_ISxdig™
 = 
_ISb™
 (4),

53 
	m_IS¥aû
 = 
_ISb™
 (5),

54 
	m_IS´št
 = 
_ISb™
 (6),

55 
	m_ISg¿ph
 = 
_ISb™
 (7),

56 
	m_ISbÏnk
 = 
_ISb™
 (8),

57 
	m_ISúŒl
 = 
_ISb™
 (9),

58 
	m_ISpunù
 = 
_ISb™
 (10),

59 
	m_IS®num
 = 
_ISb™
 (11)

79 cÚ¡ **
	$__ùy³_b_loc
 ()

80 
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
));

81 cÚ¡ 
__št32_t
 **
	$__ùy³_tŞow”_loc
 ()

82 
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
));

83 cÚ¡ 
__št32_t
 **
	$__ùy³_touµ”_loc
 ()

84 
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
));

87 #iâdeà
__ılu¥lus


88 
	#__isùy³
(
c
, 
ty³
) \

89 ((*
	`__ùy³_b_loc
 ())[(è(
c
)] & (è
ty³
)

	)

90 #–ià
defšed
 
__USE_EXTERN_INLINES


91 
	#__isùy³_f
(
ty³
) \

92 
__ex‹º_šlše
 \

93 
is
##
	`ty³
 (
__c
è
__THROW
 \

95  (*
	`__ùy³_b_loc
 ())[(è(
__c
)] & (è
_IS
##
ty³
; \

96 
	}

	)
}

99 
	#__i§scii
(
c
è(((cè& ~0x7fè=ğ0è

	)

100 
	#__tßscii
(
c
è((cè& 0x7fè

	)

102 
	#__exùy³
(
Çme
è
	`Çme
 (è
__THROW


	)

104 
__BEGIN_NAMESPACE_STD


110 
__exùy³
 (
i§Êum
);

111 
__exùy³
 (
i§Íha
);

112 
__exùy³
 (
isúŒl
);

113 
__exùy³
 (
isdig™
);

114 
__exùy³
 (
i¦ow”
);

115 
__exùy³
 (
isg¿ph
);

116 
__exùy³
 (
i¥ršt
);

117 
__exùy³
 (
i¥unù
);

118 
__exùy³
 (
is¥aû
);

119 
__exùy³
 (
isuµ”
);

120 
__exùy³
 (
isxdig™
);

124 
	$tŞow”
 (
__c
è
__THROW
;

127 
	$touµ”
 (
__c
è
__THROW
;

129 
__END_NAMESPACE_STD


133 #ifdef 
__USE_ISOC99


134 
__BEGIN_NAMESPACE_C99


136 
	`__exùy³
 (
isbÏnk
);

138 
__END_NAMESPACE_C99


141 #ifdeà
__USE_GNU


143 
	$isùy³
 (
__c
, 
__mask
è
__THROW
;

146 #ià
defšed
 
__USE_SVID
 || defšed 
__USE_MISC
 || defšed 
__USE_XOPEN


150 
	$i§scii
 (
__c
è
__THROW
;

154 
	$tßscii
 (
__c
è
__THROW
;

158 
	`__exùy³
 (
_touµ”
);

159 
	`__exùy³
 (
_tŞow”
);

163 
	#__tobody
(
c
, 
f
, 
a
, 
¬gs
) \

164 (
__ex‹nsiÚ__
 \

165 ({ 
__»s
; \

166 ià( (
c
) > 1) \

168 ià(
	`__butš_cÚ¡ªt_p
 (
c
)) \

170 
__c
 = (
c
); \

171 
__»s
 = 
__c
 < -128 || __ø> 255 ? __ø: (
a
)[__c]; \

174 
__»s
 = 
f
 
¬gs
; \

177 
__»s
 = (
a
)[(è(
c
)]; \

178 
__»s
; 
	}
}))

	)

180 #ià!
defšed
 
__NO_CTYPE


181 #ifdeà
__isùy³_f


182 
	$__isùy³_f
 (
®num
)

183 
	$__isùy³_f
 (
®pha
)

184 
	$__isùy³_f
 (
úŒl
)

185 
	$__isùy³_f
 (
dig™
)

186 
	$__isùy³_f
 (
low”
)

187 
	$__isùy³_f
 (
g¿ph
)

188 
	$__isùy³_f
 (
´št
)

189 
	$__isùy³_f
 (
punù
)

190 
	$__isùy³_f
 (
¥aû
)

191 
	$__isùy³_f
 (
uµ”
)

192 
	$__isùy³_f
 (
xdig™
)

193 #ifdeà
__USE_ISOC99


194 
	$__isùy³_f
 (
bÏnk
)

196 #–ià
defšed
 
__isùy³


197 
	#i§Êum
(
c
è
	`__isùy³
((c), 
_IS®num
)

	)

198 
	#i§Íha
(
c
è
	`__isùy³
((c), 
_IS®pha
)

	)

199 
	#isúŒl
(
c
è
	`__isùy³
((c), 
_ISúŒl
)

	)

200 
	#isdig™
(
c
è
	`__isùy³
((c), 
_ISdig™
)

	)

201 
	#i¦ow”
(
c
è
	`__isùy³
((c), 
_ISlow”
)

	)

202 
	#isg¿ph
(
c
è
	`__isùy³
((c), 
_ISg¿ph
)

	)

203 
	#i¥ršt
(
c
è
	`__isùy³
((c), 
_IS´št
)

	)

204 
	#i¥unù
(
c
è
	`__isùy³
((c), 
_ISpunù
)

	)

205 
	#is¥aû
(
c
è
	`__isùy³
((c), 
_IS¥aû
)

	)

206 
	#isuµ”
(
c
è
	`__isùy³
((c), 
_ISuµ”
)

	)

207 
	#isxdig™
(
c
è
	`__isùy³
((c), 
_ISxdig™
)

	)

208 #ifdeà
__USE_ISOC99


209 
	#isbÏnk
(
c
è
	`__isùy³
((c), 
_ISbÏnk
)

	)

213 #ifdeà
__USE_EXTERN_INLINES


214 
__ex‹º_šlše
 

215 
	`__NTH
 (
	$tŞow”
 (
__c
))

217  
__c
 >ğ-128 && __ø< 256 ? (*
	`__ùy³_tŞow”_loc
 ())[__c] : __c;

218 
	}
}

220 
__ex‹º_šlše
 

221 
__NTH
 (
	$touµ”
 (
__c
))

223  
__c
 >ğ-128 && __ø< 256 ? (*
	`__ùy³_touµ”_loc
 ())[__c] : __c;

224 
	}
}

227 #ià
__GNUC__
 >ğ2 && 
defšed
 
__OPTIMIZE__
 && !defšed 
__ılu¥lus


228 
	#tŞow”
(
c
è
	`__tobody
 (c, 
tŞow”
, *
	`__ùy³_tŞow”_loc
 (), (c))

	)

229 
	#touµ”
(
c
è
	`__tobody
 (c, 
touµ”
, *
	`__ùy³_touµ”_loc
 (), (c))

	)

232 #ià
defšed
 
__USE_SVID
 || defšed 
__USE_MISC
 || defšed 
__USE_XOPEN


233 
	#i§scii
(
c
è
	`__i§scii
 (c)

	)

234 
	#tßscii
(
c
è
	`__tßscii
 (c)

	)

236 
	#_tŞow”
(
c
è((è(*
	`__ùy³_tŞow”_loc
 ())[(è(c)])

	)

237 
	#_touµ”
(
c
è((è(*
	`__ùy³_touµ”_loc
 ())[(è(c)])

	)

243 #ifdeà
__USE_XOPEN2K8


257 
	~<xloÿË.h
>

261 
	#__isùy³_l
(
c
, 
ty³
, 
loÿË
) \

262 ((
loÿË
)->
__ùy³_b
[(è(
c
)] & (è
ty³
)

	)

264 
	#__exùy³_l
(
Çme
) \

265 
	`Çme
 (, 
__loÿË_t
è
__THROW


	)

271 
__exùy³_l
 (
i§Êum_l
);

272 
__exùy³_l
 (
i§Íha_l
);

273 
__exùy³_l
 (
isúŒl_l
);

274 
__exùy³_l
 (
isdig™_l
);

275 
__exùy³_l
 (
i¦ow”_l
);

276 
__exùy³_l
 (
isg¿ph_l
);

277 
__exùy³_l
 (
i¥ršt_l
);

278 
__exùy³_l
 (
i¥unù_l
);

279 
__exùy³_l
 (
is¥aû_l
);

280 
__exùy³_l
 (
isuµ”_l
);

281 
__exùy³_l
 (
isxdig™_l
);

283 
__exùy³_l
 (
isbÏnk_l
);

287 
	$__tŞow”_l
 (
__c
, 
__loÿË_t
 
__l
è
__THROW
;

288 
	$tŞow”_l
 (
__c
, 
__loÿË_t
 
__l
è
__THROW
;

291 
	$__touµ”_l
 (
__c
, 
__loÿË_t
 
__l
è
__THROW
;

292 
	$touµ”_l
 (
__c
, 
__loÿË_t
 
__l
è
__THROW
;

294 #ià
__GNUC__
 >ğ2 && 
defšed
 
__OPTIMIZE__
 && !defšed 
__ılu¥lus


295 
	#__tŞow”_l
(
c
, 
loÿË
) \

296 
	`__tobody
 (
c
, 
__tŞow”_l
, (
loÿË
)->
__ùy³_tŞow”
, (c,†oÿË))

	)

297 
	#__touµ”_l
(
c
, 
loÿË
) \

298 
	`__tobody
 (
c
, 
__touµ”_l
, (
loÿË
)->
__ùy³_touµ”
, (c,†oÿË))

	)

299 
	#tŞow”_l
(
c
, 
loÿË
è
	`__tŞow”_l
 ((c), (loÿË))

	)

300 
	#touµ”_l
(
c
, 
loÿË
è
	`__touµ”_l
 ((c), (loÿË))

	)

304 #iâdeà
__NO_CTYPE


305 
	#__i§Êum_l
(
c
,
l
è
	`__isùy³_l
((c), 
_IS®num
, (l))

	)

306 
	#__i§Íha_l
(
c
,
l
è
	`__isùy³_l
((c), 
_IS®pha
, (l))

	)

307 
	#__isúŒl_l
(
c
,
l
è
	`__isùy³_l
((c), 
_ISúŒl
, (l))

	)

308 
	#__isdig™_l
(
c
,
l
è
	`__isùy³_l
((c), 
_ISdig™
, (l))

	)

309 
	#__i¦ow”_l
(
c
,
l
è
	`__isùy³_l
((c), 
_ISlow”
, (l))

	)

310 
	#__isg¿ph_l
(
c
,
l
è
	`__isùy³_l
((c), 
_ISg¿ph
, (l))

	)

311 
	#__i¥ršt_l
(
c
,
l
è
	`__isùy³_l
((c), 
_IS´št
, (l))

	)

312 
	#__i¥unù_l
(
c
,
l
è
	`__isùy³_l
((c), 
_ISpunù
, (l))

	)

313 
	#__is¥aû_l
(
c
,
l
è
	`__isùy³_l
((c), 
_IS¥aû
, (l))

	)

314 
	#__isuµ”_l
(
c
,
l
è
	`__isùy³_l
((c), 
_ISuµ”
, (l))

	)

315 
	#__isxdig™_l
(
c
,
l
è
	`__isùy³_l
((c), 
_ISxdig™
, (l))

	)

317 
	#__isbÏnk_l
(
c
,
l
è
	`__isùy³_l
((c), 
_ISbÏnk
, (l))

	)

319 #ià
defšed
 
__USE_SVID
 || defšed 
__USE_MISC


320 
	#__i§scii_l
(
c
,
l
è(Ö), 
	`__i§scii
 (c))

	)

321 
	#__tßscii_l
(
c
,
l
è(Ö), 
	`__tßscii
 (c))

	)

324 
	#i§Êum_l
(
c
,
l
è
	`__i§Êum_l
 ((c), (l))

	)

325 
	#i§Íha_l
(
c
,
l
è
	`__i§Íha_l
 ((c), (l))

	)

326 
	#isúŒl_l
(
c
,
l
è
	`__isúŒl_l
 ((c), (l))

	)

327 
	#isdig™_l
(
c
,
l
è
	`__isdig™_l
 ((c), (l))

	)

328 
	#i¦ow”_l
(
c
,
l
è
	`__i¦ow”_l
 ((c), (l))

	)

329 
	#isg¿ph_l
(
c
,
l
è
	`__isg¿ph_l
 ((c), (l))

	)

330 
	#i¥ršt_l
(
c
,
l
è
	`__i¥ršt_l
 ((c), (l))

	)

331 
	#i¥unù_l
(
c
,
l
è
	`__i¥unù_l
 ((c), (l))

	)

332 
	#is¥aû_l
(
c
,
l
è
	`__is¥aû_l
 ((c), (l))

	)

333 
	#isuµ”_l
(
c
,
l
è
	`__isuµ”_l
 ((c), (l))

	)

334 
	#isxdig™_l
(
c
,
l
è
	`__isxdig™_l
 ((c), (l))

	)

336 
	#isbÏnk_l
(
c
,
l
è
	`__isbÏnk_l
 ((c), (l))

	)

338 #ià
defšed
 
__USE_SVID
 || defšed 
__USE_MISC


339 
	#i§scii_l
(
c
,
l
è
	`__i§scii_l
 ((c), (l))

	)

340 
	#tßscii_l
(
c
,
l
è
	`__tßscii_l
 ((c), (l))

	)

347 
__END_DECLS


	@/usr/include/stdc-predef.h

18 #iâdef 
_STDC_PREDEF_H


19 
	#_STDC_PREDEF_H
 1

	)

36 #ifdeà
__GCC_IEC_559


37 #ià
__GCC_IEC_559
 > 0

38 
	#__STDC_IEC_559__
 1

	)

41 
	#__STDC_IEC_559__
 1

	)

44 #ifdeà
__GCC_IEC_559_COMPLEX


45 #ià
__GCC_IEC_559_COMPLEX
 > 0

46 
	#__STDC_IEC_559_COMPLEX__
 1

	)

49 
	#__STDC_IEC_559_COMPLEX__
 1

	)

54 
	#__STDC_ISO_10646__
 201103L

	)

57 
	#__STDC_NO_THREADS__
 1

	)

	@/usr/include/gconv.h

22 #iâdeà
_GCONV_H


23 
	#_GCONV_H
 1

	)

25 
	~<ã©u»s.h
>

26 
	#__Ãed_mb¡©e_t


	)

27 
	#__Ãed_wšt_t


	)

28 
	~<wch¬.h
>

29 
	#__Ãed_size_t


	)

30 
	#__Ãed_wch¬_t


	)

31 
	~<¡ddef.h
>

34 
	#__UNKNOWN_10646_CHAR
 ((
wch¬_t
è0xfffd)

	)

39 
	m__GCONV_OK
 = 0,

40 
	m__GCONV_NOCONV
,

41 
	m__GCONV_NODB
,

42 
	m__GCONV_NOMEM
,

44 
	m__GCONV_EMPTY_INPUT
,

45 
	m__GCONV_FULL_OUTPUT
,

46 
	m__GCONV_ILLEGAL_INPUT
,

47 
	m__GCONV_INCOMPLETE_INPUT
,

49 
	m__GCONV_ILLEGAL_DESCRIPTOR
,

50 
	m__GCONV_INTERNAL_ERROR


57 
	m__GCONV_IS_LAST
 = 0x0001,

58 
	m__GCONV_IGNORE_ERRORS
 = 0x0002,

59 
	m__GCONV_SWAP
 = 0x0004

64 
	g__gcÚv_¡•
;

65 
	g__gcÚv_¡•_d©a
;

66 
	g__gcÚv_lßded_objeù
;

67 
	g__gcÚv_Œªs_d©a
;

71 (*
	t__gcÚv_fù
è(
	t__gcÚv_¡•
 *, 
	t__gcÚv_¡•_d©a
 *,

73 **, 
	tsize_t
 *, , );

76 
	$wšt_t
 (*
	t__gcÚv_btowc_fù
è(
	t__gcÚv_¡•
 *, );

79 (*
	t__gcÚv_š™_fù
è(
	t__gcÚv_¡•
 *);

80 (*
	t__gcÚv_’d_fù
è(
	t__gcÚv_¡•
 *);

84 (*
	t__gcÚv_Œªs_fù
è(
	t__gcÚv_¡•
 *,

85 
	t__gcÚv_¡•_d©a
 *, *,

89 
	tsize_t
 *);

92 (*
	t__gcÚv_Œªs_cÚ‹xt_fù
) (*, const *,

97 (*
	t__gcÚv_Œªs_qu”y_fù
) (const *, const ***,

98 
	tsize_t
 *);

101 (*
	t__gcÚv_Œªs_š™_fù
) (**, const *);

102 (*
	t__gcÚv_Œªs_’d_fù
) (*);

104 
	s__gcÚv_Œªs_d©a


107 
__gcÚv_Œªs_fù
 
__Œªs_fù
;

108 
__gcÚv_Œªs_cÚ‹xt_fù
 
__Œªs_cÚ‹xt_fù
;

109 
__gcÚv_Œªs_’d_fù
 
__Œªs_’d_fù
;

110 *
__d©a
;

111 
__gcÚv_Œªs_d©a
 *
__Ãxt
;

116 
	s__gcÚv_¡•


118 
__gcÚv_lßded_objeù
 *
__shlib_hªdË
;

119 cÚ¡ *
__modÇme
;

121 
__couÁ”
;

123 *
__äom_Çme
;

124 *
__to_Çme
;

126 
__gcÚv_fù
 
__fù
;

127 
__gcÚv_btowc_fù
 
__btowc_fù
;

128 
__gcÚv_š™_fù
 
__š™_fù
;

129 
__gcÚv_’d_fù
 
__’d_fù
;

133 
__mš_Ãeded_äom
;

134 
__max_Ãeded_äom
;

135 
__mš_Ãeded_to
;

136 
__max_Ãeded_to
;

139 
__¡©eful
;

141 *
__d©a
;

146 
	s__gcÚv_¡•_d©a


148 *
__outbuf
;

149 *
__outbuãnd
;

153 
__æags
;

157 
__švoÿtiÚ_couÁ”
;

161 
__š‹º®_u£
;

163 
__mb¡©e_t
 *
__¡©•
;

164 
__mb¡©e_t
 
__¡©e
;

168 
__gcÚv_Œªs_d©a
 *
__Œªs
;

173 
	s__gcÚv_šfo


175 
size_t
 
__n¡•s
;

176 
__gcÚv_¡•
 *
__¡•s
;

177 
__ex‹nsiÚ__
 
__gcÚv_¡•_d©a
 
__d©a
 
__æex¬r
;

178 } *
	t__gcÚv_t
;

	@/usr/include/wchar.h

23 #iâdeà
_WCHAR_H


25 #ià!
defšed
 
__Ãed_mb¡©e_t
 && !defšed 
__Ãed_wšt_t


26 
	#_WCHAR_H
 1

	)

27 
	~<ã©u»s.h
>

30 #ifdeà
_WCHAR_H


32 
	#__Ãed___FILE


	)

33 #ià
defšed
 
__USE_UNIX98
 || defšed 
__USE_XOPEN2K


34 
	#__Ãed_FILE


	)

36 
	~<¡dio.h
>

38 
	#__Ãed___va_li¡


	)

39 
	~<¡d¬g.h
>

41 
	~<b™s/wch¬.h
>

44 
	#__Ãed_size_t


	)

45 
	#__Ãed_wch¬_t


	)

46 
	#__Ãed_NULL


	)

48 #ià
defšed
 
_WCHAR_H
 || defšed 
__Ãed_wšt_t
 || !defšed 
__WINT_TYPE__


49 #undeà
__Ãed_wšt_t


50 
	#__Ãed_wšt_t


	)

51 
	~<¡ddef.h
>

55 #iâdeà
_WINT_T


60 
	#_WINT_T


	)

61 
	twšt_t
;

65 #ià
defšed
 
__ılu¥lus
 && defšed 
_GLIBCPP_USE_NAMESPACES
 \

66 && 
defšed
 
__WINT_TYPE__


67 
__BEGIN_NAMESPACE_STD


68 
__WINT_TYPE__
 
	twšt_t
;

69 
	g__END_NAMESPACE_STD


74 #ià
defšed
 
__ılu¥lus
 && 
__GNUC_PREREQ
 (4, 4)

75 
	#__CORRECT_ISO_CPP_WCHAR_H_PROTO


	)

79 #ià(
defšed
 
_WCHAR_H
 || defšed 
__Ãed_mb¡©e_t
è&& !defšed 
____mb¡©e_t_defšed


80 
	#____mb¡©e_t_defšed
 1

	)

84 
	m__couÁ
;

87 #ifdeà
__WINT_TYPE__


88 
__WINT_TYPE__
 
	m__wch
;

90 
wšt_t
 
	m__wch
;

92 
	m__wchb
[4];

93 } 
	m__v®ue
;

94 } 
	t__mb¡©e_t
;

96 #undeà
__Ãed_mb¡©e_t


101 #ifdeà
_WCHAR_H


103 #iâdeà
__mb¡©e_t_defšed


104 
__BEGIN_NAMESPACE_C99


106 
__mb¡©e_t
 
	tmb¡©e_t
;

107 
	g__END_NAMESPACE_C99


108 
	#__mb¡©e_t_defšed
 1

	)

111 #ifdeà
__USE_GNU


112 
	$__USING_NAMESPACE_C99
(
mb¡©e_t
)

115 #iâdeà
WCHAR_MIN


117 
	#WCHAR_MIN
 
__WCHAR_MIN


	)

118 
	#WCHAR_MAX
 
__WCHAR_MAX


	)

121 #iâdeà
WEOF


122 
	#WEOF
 (0xffffffffu)

	)

127 #ià
defšed
 
__USE_XOPEN
 && !defšed 
__USE_UNIX98


128 
	~<wùy³.h
>

132 
__BEGIN_DECLS


134 
__BEGIN_NAMESPACE_STD


137 
tm
;

138 
__END_NAMESPACE_STD


142 
	$__USING_NAMESPACE_STD
(
tm
)

145 
__BEGIN_NAMESPACE_STD


147 
wch¬_t
 *
	$wcsıy
 (
wch¬_t
 *
__»¡riù
 
__de¡
,

148 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__¤c
è
__THROW
;

150 
wch¬_t
 *
	$wc¢ıy
 (
wch¬_t
 *
__»¡riù
 
__de¡
,

151 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__¤c
, 
size_t
 
__n
)

152 
__THROW
;

155 
wch¬_t
 *
	$wcsÿt
 (
wch¬_t
 *
__»¡riù
 
__de¡
,

156 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__¤c
è
__THROW
;

158 
wch¬_t
 *
	$wc¢ÿt
 (
wch¬_t
 *
__»¡riù
 
__de¡
,

159 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__¤c
, 
size_t
 
__n
)

160 
__THROW
;

163 
	$wcscmp
 (cÚ¡ 
wch¬_t
 *
__s1
, cÚ¡ wch¬_ˆ*
__s2
)

164 
__THROW
 
__©Œibu‹_pu»__
;

166 
	$wc¢cmp
 (cÚ¡ 
wch¬_t
 *
__s1
, cÚ¡ wch¬_ˆ*
__s2
, 
size_t
 
__n
)

167 
__THROW
 
__©Œibu‹_pu»__
;

168 
__END_NAMESPACE_STD


170 #ifdeà
__USE_XOPEN2K8


172 
	$wcsÿ£cmp
 (cÚ¡ 
wch¬_t
 *
__s1
, cÚ¡ wch¬_ˆ*
__s2
è
__THROW
;

175 
	$wc¢ÿ£cmp
 (cÚ¡ 
wch¬_t
 *
__s1
, cÚ¡ wch¬_ˆ*
__s2
,

176 
size_t
 
__n
è
__THROW
;

180 
	~<xloÿË.h
>

182 
	$wcsÿ£cmp_l
 (cÚ¡ 
wch¬_t
 *
__s1
, cÚ¡ wch¬_ˆ*
__s2
,

183 
__loÿË_t
 
__loc
è
__THROW
;

185 
	$wc¢ÿ£cmp_l
 (cÚ¡ 
wch¬_t
 *
__s1
, cÚ¡ wch¬_ˆ*
__s2
,

186 
size_t
 
__n
, 
__loÿË_t
 
__loc
è
__THROW
;

189 
__BEGIN_NAMESPACE_STD


192 
	$wcscŞl
 (cÚ¡ 
wch¬_t
 *
__s1
, cÚ¡ wch¬_ˆ*
__s2
è
__THROW
;

196 
size_t
 
	$wcsxäm
 (
wch¬_t
 *
__»¡riù
 
__s1
,

197 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__s2
, 
size_t
 
__n
è
__THROW
;

198 
__END_NAMESPACE_STD


200 #ifdeà
__USE_XOPEN2K8


206 
	$wcscŞl_l
 (cÚ¡ 
wch¬_t
 *
__s1
, cÚ¡ wch¬_ˆ*
__s2
,

207 
__loÿË_t
 
__loc
è
__THROW
;

212 
size_t
 
	$wcsxäm_l
 (
wch¬_t
 *
__s1
, cÚ¡ wch¬_ˆ*
__s2
,

213 
size_t
 
__n
, 
__loÿË_t
 
__loc
è
__THROW
;

216 
wch¬_t
 *
	$wcsdup
 (cÚ¡ 
wch¬_t
 *
__s
è
__THROW
 
__©Œibu‹_m®loc__
;

219 
__BEGIN_NAMESPACE_STD


221 #ifdeà
__CORRECT_ISO_CPP_WCHAR_H_PROTO


222 "C++" 
wch¬_t
 *
	$wcschr
 (
wch¬_t
 *
__wcs
, wch¬_ˆ
__wc
)

223 
__THROW
 
	`__asm
 ("wcschr"è
__©Œibu‹_pu»__
;

224 "C++" cÚ¡ 
wch¬_t
 *
	$wcschr
 (cÚ¡ 
wch¬_t
 *
__wcs
, wch¬_ˆ
__wc
)

225 
__THROW
 
	`__asm
 ("wcschr"è
__©Œibu‹_pu»__
;

227 
wch¬_t
 *
	$wcschr
 (cÚ¡ 
wch¬_t
 *
__wcs
, wch¬_ˆ
__wc
)

228 
__THROW
 
__©Œibu‹_pu»__
;

231 #ifdeà
__CORRECT_ISO_CPP_WCHAR_H_PROTO


232 "C++" 
wch¬_t
 *
	$wc¤chr
 (
wch¬_t
 *
__wcs
, wch¬_ˆ
__wc
)

233 
__THROW
 
	`__asm
 ("wc¤chr"è
__©Œibu‹_pu»__
;

234 "C++" cÚ¡ 
wch¬_t
 *
	$wc¤chr
 (cÚ¡ 
wch¬_t
 *
__wcs
, wch¬_ˆ
__wc
)

235 
__THROW
 
	`__asm
 ("wc¤chr"è
__©Œibu‹_pu»__
;

237 
wch¬_t
 *
	$wc¤chr
 (cÚ¡ 
wch¬_t
 *
__wcs
, wch¬_ˆ
__wc
)

238 
__THROW
 
__©Œibu‹_pu»__
;

240 
__END_NAMESPACE_STD


242 #ifdeà
__USE_GNU


245 
wch¬_t
 *
	$wcschºul
 (cÚ¡ 
wch¬_t
 *
__s
, wch¬_ˆ
__wc
)

246 
__THROW
 
__©Œibu‹_pu»__
;

249 
__BEGIN_NAMESPACE_STD


252 
size_t
 
	$wcsc¥n
 (cÚ¡ 
wch¬_t
 *
__wcs
, cÚ¡ wch¬_ˆ*
__»jeù
)

253 
__THROW
 
__©Œibu‹_pu»__
;

256 
size_t
 
	$wcs¥n
 (cÚ¡ 
wch¬_t
 *
__wcs
, cÚ¡ wch¬_ˆ*
__acû±
)

257 
__THROW
 
__©Œibu‹_pu»__
;

259 #ifdeà
__CORRECT_ISO_CPP_WCHAR_H_PROTO


260 "C++" 
wch¬_t
 *
	$wc¥brk
 (
wch¬_t
 *
__wcs
, cÚ¡ wch¬_ˆ*
__acû±
)

261 
__THROW
 
	`__asm
 ("wc¥brk"è
__©Œibu‹_pu»__
;

262 "C++" cÚ¡ 
wch¬_t
 *
	$wc¥brk
 (cÚ¡ 
wch¬_t
 *
__wcs
,

263 cÚ¡ 
wch¬_t
 *
__acû±
)

264 
__THROW
 
	`__asm
 ("wc¥brk"è
__©Œibu‹_pu»__
;

266 
wch¬_t
 *
	$wc¥brk
 (cÚ¡ 
wch¬_t
 *
__wcs
, cÚ¡ wch¬_ˆ*
__acû±
)

267 
__THROW
 
__©Œibu‹_pu»__
;

270 #ifdeà
__CORRECT_ISO_CPP_WCHAR_H_PROTO


271 "C++" 
wch¬_t
 *
	$wcs¡r
 (
wch¬_t
 *
__hay¡ack
, cÚ¡ wch¬_ˆ*
__ÃedË
)

272 
__THROW
 
	`__asm
 ("wcs¡r"è
__©Œibu‹_pu»__
;

273 "C++" cÚ¡ 
wch¬_t
 *
	$wcs¡r
 (cÚ¡ 
wch¬_t
 *
__hay¡ack
,

274 cÚ¡ 
wch¬_t
 *
__ÃedË
)

275 
__THROW
 
	`__asm
 ("wcs¡r"è
__©Œibu‹_pu»__
;

277 
wch¬_t
 *
	$wcs¡r
 (cÚ¡ 
wch¬_t
 *
__hay¡ack
, cÚ¡ wch¬_ˆ*
__ÃedË
)

278 
__THROW
 
__©Œibu‹_pu»__
;

282 
wch¬_t
 *
	$wc¡ok
 (
wch¬_t
 *
__»¡riù
 
__s
,

283 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__d–im
,

284 
wch¬_t
 **
__»¡riù
 
__±r
è
__THROW
;

287 
size_t
 
	$wc¦’
 (cÚ¡ 
wch¬_t
 *
__s
è
__THROW
 
__©Œibu‹_pu»__
;

288 
__END_NAMESPACE_STD


290 #ifdeà
__USE_XOPEN


292 #ifdeà
__CORRECT_ISO_CPP_WCHAR_H_PROTO


293 "C++" 
wch¬_t
 *
	$wcswcs
 (
wch¬_t
 *
__hay¡ack
, cÚ¡ wch¬_ˆ*
__ÃedË
)

294 
__THROW
 
	`__asm
 ("wcswcs"è
__©Œibu‹_pu»__
;

295 "C++" cÚ¡ 
wch¬_t
 *
	$wcswcs
 (cÚ¡ 
wch¬_t
 *
__hay¡ack
,

296 cÚ¡ 
wch¬_t
 *
__ÃedË
)

297 
__THROW
 
	`__asm
 ("wcswcs"è
__©Œibu‹_pu»__
;

299 
wch¬_t
 *
	$wcswcs
 (cÚ¡ 
wch¬_t
 *
__hay¡ack
, cÚ¡ wch¬_ˆ*
__ÃedË
)

300 
__THROW
 
__©Œibu‹_pu»__
;

304 #ifdeà
__USE_XOPEN2K8


306 
size_t
 
	$wc¢Ën
 (cÚ¡ 
wch¬_t
 *
__s
, 
size_t
 
__maxËn
)

307 
__THROW
 
__©Œibu‹_pu»__
;

311 
__BEGIN_NAMESPACE_STD


313 #ifdeà
__CORRECT_ISO_CPP_WCHAR_H_PROTO


314 "C++" 
wch¬_t
 *
	$wmemchr
 (
wch¬_t
 *
__s
, wch¬_ˆ
__c
, 
size_t
 
__n
)

315 
__THROW
 
	`__asm
 ("wmemchr"è
__©Œibu‹_pu»__
;

316 "C++" cÚ¡ 
wch¬_t
 *
	$wmemchr
 (cÚ¡ 
wch¬_t
 *
__s
, wch¬_ˆ
__c
,

317 
size_t
 
__n
)

318 
__THROW
 
	`__asm
 ("wmemchr"è
__©Œibu‹_pu»__
;

320 
wch¬_t
 *
	$wmemchr
 (cÚ¡ 
wch¬_t
 *
__s
, wch¬_ˆ
__c
, 
size_t
 
__n
)

321 
__THROW
 
__©Œibu‹_pu»__
;

325 
	$wmemcmp
 (cÚ¡ 
wch¬_t
 *
__s1
, cÚ¡ wch¬_ˆ*
__s2
, 
size_t
 
__n
)

326 
__THROW
 
__©Œibu‹_pu»__
;

329 
wch¬_t
 *
	$wmemıy
 (
wch¬_t
 *
__»¡riù
 
__s1
,

330 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__s2
, 
size_t
 
__n
è
__THROW
;

334 
wch¬_t
 *
	$wmemmove
 (
wch¬_t
 *
__s1
, cÚ¡ wch¬_ˆ*
__s2
, 
size_t
 
__n
)

335 
__THROW
;

338 
wch¬_t
 *
	$wmem£t
 (
wch¬_t
 *
__s
, wch¬_ˆ
__c
, 
size_t
 
__n
è
__THROW
;

339 
__END_NAMESPACE_STD


341 #ifdeà
__USE_GNU


344 
wch¬_t
 *
	$wmempıy
 (
wch¬_t
 *
__»¡riù
 
__s1
,

345 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__s2
, 
size_t
 
__n
)

346 
__THROW
;

350 
__BEGIN_NAMESPACE_STD


353 
wšt_t
 
	$btowc
 (
__c
è
__THROW
;

357 
	$wùob
 (
wšt_t
 
__c
è
__THROW
;

361 
	$mbsš™
 (cÚ¡ 
mb¡©e_t
 *
__ps
è
__THROW
 
__©Œibu‹_pu»__
;

365 
size_t
 
	$mb¹owc
 (
wch¬_t
 *
__»¡riù
 
__pwc
,

366 cÚ¡ *
__»¡riù
 
__s
, 
size_t
 
__n
,

367 
mb¡©e_t
 *
__»¡riù
 
__p
è
__THROW
;

370 
size_t
 
	$wütomb
 (*
__»¡riù
 
__s
, 
wch¬_t
 
__wc
,

371 
mb¡©e_t
 *
__»¡riù
 
__ps
è
__THROW
;

374 
size_t
 
	$__mb¾’
 (cÚ¡ *
__»¡riù
 
__s
, 
size_t
 
__n
,

375 
mb¡©e_t
 *
__»¡riù
 
__ps
è
__THROW
;

376 
size_t
 
	$mb¾’
 (cÚ¡ *
__»¡riù
 
__s
, 
size_t
 
__n
,

377 
mb¡©e_t
 *
__»¡riù
 
__ps
è
__THROW
;

378 
__END_NAMESPACE_STD


380 #ifdeà
__USE_EXTERN_INLINES


386 
wšt_t
 
	$__btowc_®Ÿs
 (
__c
è
	`__asm
 ("btowc");

387 
__ex‹º_šlše
 
wšt_t


388 
	`__NTH
 (
	$btowc
 (
__c
))

389 {  (
	`__butš_cÚ¡ªt_p
 (
__c
) && __c >= '\0' && __c <= '\x7f'

390 ? (
wšt_t
è
__c
 : 
	`__btowc_®Ÿs
 (__c)); 
	}
}

392 
	$__wùob_®Ÿs
 (
wšt_t
 
__c
è
	`__asm
 ("wctob");

393 
__ex‹º_šlše
 

394 
	`__NTH
 (
	$wùob
 (
wšt_t
 
__wc
))

395 {  (
	`__butš_cÚ¡ªt_p
 (
__wc
è&& __wø>ğ
L
'\0' && __wc <= L'\x7f'

396 ? (è
__wc
 : 
	`__wùob_®Ÿs
 (__wc)); 
	}
}

398 
__ex‹º_šlše
 
size_t


399 
__NTH
 (
	$mb¾’
 (cÚ¡ *
__»¡riù
 
__s
, 
size_t
 
__n
,

400 
mb¡©e_t
 *
__»¡riù
 
__ps
))

401 {  (
__ps
 !ğ
NULL


402 ? 
	`mb¹owc
 (
NULL
, 
__s
, 
__n
, 
__ps
è: 
	`__mb¾’
 (__s, __n, NULL)); 
	}
}

405 
__BEGIN_NAMESPACE_STD


408 
size_t
 
	$mb¤towcs
 (
wch¬_t
 *
__»¡riù
 
__d¡
,

409 cÚ¡ **
__»¡riù
 
__¤c
, 
size_t
 
__Ën
,

410 
mb¡©e_t
 *
__»¡riù
 
__ps
è
__THROW
;

414 
size_t
 
	$wc¤tombs
 (*
__»¡riù
 
__d¡
,

415 cÚ¡ 
wch¬_t
 **
__»¡riù
 
__¤c
, 
size_t
 
__Ën
,

416 
mb¡©e_t
 *
__»¡riù
 
__ps
è
__THROW
;

417 
__END_NAMESPACE_STD


420 #ifdef 
__USE_XOPEN2K8


423 
size_t
 
	$mb¢¹owcs
 (
wch¬_t
 *
__»¡riù
 
__d¡
,

424 cÚ¡ **
__»¡riù
 
__¤c
, 
size_t
 
__nmc
,

425 
size_t
 
__Ën
, 
mb¡©e_t
 *
__»¡riù
 
__ps
è
__THROW
;

429 
size_t
 
	$wc¢¹ombs
 (*
__»¡riù
 
__d¡
,

430 cÚ¡ 
wch¬_t
 **
__»¡riù
 
__¤c
,

431 
size_t
 
__nwc
, size_ˆ
__Ën
,

432 
mb¡©e_t
 *
__»¡riù
 
__ps
è
__THROW
;

437 #ifdeà
__USE_XOPEN


439 
	$wcwidth
 (
wch¬_t
 
__c
è
__THROW
;

443 
	$wcswidth
 (cÚ¡ 
wch¬_t
 *
__s
, 
size_t
 
__n
è
__THROW
;

447 
__BEGIN_NAMESPACE_STD


450 
	$wc¡od
 (cÚ¡ 
wch¬_t
 *
__»¡riù
 
__ÅŒ
,

451 
wch¬_t
 **
__»¡riù
 
__’d±r
è
__THROW
;

452 
__END_NAMESPACE_STD


454 #ifdeà
__USE_ISOC99


455 
__BEGIN_NAMESPACE_C99


457 
	$wc¡of
 (cÚ¡ 
wch¬_t
 *
__»¡riù
 
__ÅŒ
,

458 
wch¬_t
 **
__»¡riù
 
__’d±r
è
__THROW
;

459 
	$wc¡Şd
 (cÚ¡ 
wch¬_t
 *
__»¡riù
 
__ÅŒ
,

460 
wch¬_t
 **
__»¡riù
 
__’d±r
è
__THROW
;

461 
__END_NAMESPACE_C99


465 
__BEGIN_NAMESPACE_STD


468 
	$wc¡Ş
 (cÚ¡ 
wch¬_t
 *
__»¡riù
 
__ÅŒ
,

469 
wch¬_t
 **
__»¡riù
 
__’d±r
, 
__ba£
è
__THROW
;

473 
	$wc¡oul
 (cÚ¡ 
wch¬_t
 *
__»¡riù
 
__ÅŒ
,

474 
wch¬_t
 **
__»¡riù
 
__’d±r
, 
__ba£
)

475 
__THROW
;

476 
__END_NAMESPACE_STD


478 #ifdeà
__USE_ISOC99


479 
__BEGIN_NAMESPACE_C99


482 
__ex‹nsiÚ__


483 
	$wc¡Şl
 (cÚ¡ 
wch¬_t
 *
__»¡riù
 
__ÅŒ
,

484 
wch¬_t
 **
__»¡riù
 
__’d±r
, 
__ba£
)

485 
__THROW
;

489 
__ex‹nsiÚ__


490 
	$wc¡ouÎ
 (cÚ¡ 
wch¬_t
 *
__»¡riù
 
__ÅŒ
,

491 
wch¬_t
 **
__»¡riù
 
__’d±r
,

492 
__ba£
è
__THROW
;

493 
__END_NAMESPACE_C99


496 #ifdeà
__USE_GNU


499 
__ex‹nsiÚ__


500 
	$wc¡oq
 (cÚ¡ 
wch¬_t
 *
__»¡riù
 
__ÅŒ
,

501 
wch¬_t
 **
__»¡riù
 
__’d±r
, 
__ba£
)

502 
__THROW
;

506 
__ex‹nsiÚ__


507 
	$wc¡ouq
 (cÚ¡ 
wch¬_t
 *
__»¡riù
 
__ÅŒ
,

508 
wch¬_t
 **
__»¡riù
 
__’d±r
,

509 
__ba£
è
__THROW
;

512 #ifdeà
__USE_GNU


526 
	~<xloÿË.h
>

530 
	$wc¡Ş_l
 (cÚ¡ 
wch¬_t
 *
__»¡riù
 
__ÅŒ
,

531 
wch¬_t
 **
__»¡riù
 
__’d±r
, 
__ba£
,

532 
__loÿË_t
 
__loc
è
__THROW
;

534 
	$wc¡oul_l
 (cÚ¡ 
wch¬_t
 *
__»¡riù
 
__ÅŒ
,

535 
wch¬_t
 **
__»¡riù
 
__’d±r
,

536 
__ba£
, 
__loÿË_t
 
__loc
è
__THROW
;

538 
__ex‹nsiÚ__


539 
	$wc¡Şl_l
 (cÚ¡ 
wch¬_t
 *
__»¡riù
 
__ÅŒ
,

540 
wch¬_t
 **
__»¡riù
 
__’d±r
,

541 
__ba£
, 
__loÿË_t
 
__loc
è
__THROW
;

543 
__ex‹nsiÚ__


544 
	$wc¡ouÎ_l
 (cÚ¡ 
wch¬_t
 *
__»¡riù
 
__ÅŒ
,

545 
wch¬_t
 **
__»¡riù
 
__’d±r
,

546 
__ba£
, 
__loÿË_t
 
__loc
)

547 
__THROW
;

549 
	$wc¡od_l
 (cÚ¡ 
wch¬_t
 *
__»¡riù
 
__ÅŒ
,

550 
wch¬_t
 **
__»¡riù
 
__’d±r
, 
__loÿË_t
 
__loc
)

551 
__THROW
;

553 
	$wc¡of_l
 (cÚ¡ 
wch¬_t
 *
__»¡riù
 
__ÅŒ
,

554 
wch¬_t
 **
__»¡riù
 
__’d±r
, 
__loÿË_t
 
__loc
)

555 
__THROW
;

557 
	$wc¡Şd_l
 (cÚ¡ 
wch¬_t
 *
__»¡riù
 
__ÅŒ
,

558 
wch¬_t
 **
__»¡riù
 
__’d±r
,

559 
__loÿË_t
 
__loc
è
__THROW
;

563 #ifdeà
__USE_XOPEN2K8


566 
wch¬_t
 *
	$wııy
 (
wch¬_t
 *
__»¡riù
 
__de¡
,

567 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__¤c
è
__THROW
;

571 
wch¬_t
 *
	$wınıy
 (
wch¬_t
 *
__»¡riù
 
__de¡
,

572 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__¤c
, 
size_t
 
__n
)

573 
__THROW
;

580 
__FILE
 *
	$İ’_wmem¡»am
 (
wch¬_t
 **
__buæoc
, 
size_t
 *
__siz–oc
è
__THROW
;

583 #ià
defšed
 
__USE_ISOC95
 || defšed 
__USE_UNIX98


584 
__BEGIN_NAMESPACE_STD


587 
	$fwide
 (
__FILE
 *
__å
, 
__mode
è
__THROW
;

594 
	`fw´štf
 (
__FILE
 *
__»¡riù
 
__¡»am
,

595 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__fÜm©
, ...)

601 
	`w´štf
 (cÚ¡ 
wch¬_t
 *
__»¡riù
 
__fÜm©
, ...)

604 
	$sw´štf
 (
wch¬_t
 *
__»¡riù
 
__s
, 
size_t
 
__n
,

605 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__fÜm©
, ...)

606 
__THROW
 ;

612 
	`vfw´štf
 (
__FILE
 *
__»¡riù
 
__s
,

613 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__fÜm©
,

614 
__gnuc_va_li¡
 
__¬g
)

620 
	`vw´štf
 (cÚ¡ 
wch¬_t
 *
__»¡riù
 
__fÜm©
,

621 
__gnuc_va_li¡
 
__¬g
)

625 
	$vsw´štf
 (
wch¬_t
 *
__»¡riù
 
__s
, 
size_t
 
__n
,

626 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__fÜm©
,

627 
__gnuc_va_li¡
 
__¬g
)

628 
__THROW
 ;

635 
	`fwsÿnf
 (
__FILE
 *
__»¡riù
 
__¡»am
,

636 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__fÜm©
, ...)

642 
	`wsÿnf
 (cÚ¡ 
wch¬_t
 *
__»¡riù
 
__fÜm©
, ...)

645 
	$swsÿnf
 (cÚ¡ 
wch¬_t
 *
__»¡riù
 
__s
,

646 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__fÜm©
, ...)

647 
__THROW
 ;

649 #ià
defšed
 
__USE_ISOC99
 && !defšed 
__USE_GNU
 \

650 && (!
defšed
 
__LDBL_COMPAT
 || !defšed 
__REDIRECT
) \

651 && (
defšed
 
__STRICT_ANSI__
 || defšed 
__USE_XOPEN2K
)

652 #ifdeà
__REDIRECT


656 
	`__REDIRECT
 (
fwsÿnf
, (
__FILE
 *
__»¡riù
 
__¡»am
,

657 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__fÜm©
, ...),

658 
__isoc99_fwsÿnf
)

660 
	`__REDIRECT
 (
wsÿnf
, (cÚ¡ 
wch¬_t
 *
__»¡riù
 
__fÜm©
, ...),

661 
__isoc99_wsÿnf
)

663 
	`__REDIRECT_NTH
 (
swsÿnf
, (cÚ¡ 
wch¬_t
 *
__»¡riù
 
__s
,

664 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__fÜm©
,

665 ...), 
__isoc99_swsÿnf
)

668 
	`__isoc99_fwsÿnf
 (
__FILE
 *
__»¡riù
 
__¡»am
,

669 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__fÜm©
, ...);

670 
	`__isoc99_wsÿnf
 (cÚ¡ 
wch¬_t
 *
__»¡riù
 
__fÜm©
, ...);

671 
	$__isoc99_swsÿnf
 (cÚ¡ 
wch¬_t
 *
__»¡riù
 
__s
,

672 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__fÜm©
, ...)

673 
__THROW
;

674 
	#fwsÿnf
 
__isoc99_fwsÿnf


	)

675 
	#wsÿnf
 
__isoc99_wsÿnf


	)

676 
	#swsÿnf
 
__isoc99_swsÿnf


	)

680 
__END_NAMESPACE_STD


683 #ifdeà
__USE_ISOC99


684 
__BEGIN_NAMESPACE_C99


689 
	`vfwsÿnf
 (
__FILE
 *
__»¡riù
 
__s
,

690 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__fÜm©
,

691 
__gnuc_va_li¡
 
__¬g
)

697 
	`vwsÿnf
 (cÚ¡ 
wch¬_t
 *
__»¡riù
 
__fÜm©
,

698 
__gnuc_va_li¡
 
__¬g
)

701 
	$vswsÿnf
 (cÚ¡ 
wch¬_t
 *
__»¡riù
 
__s
,

702 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__fÜm©
,

703 
__gnuc_va_li¡
 
__¬g
)

704 
__THROW
 ;

706 #ià!
defšed
 
__USE_GNU
 \

707 && (!
defšed
 
__LDBL_COMPAT
 || !defšed 
__REDIRECT
) \

708 && (
defšed
 
__STRICT_ANSI__
 || defšed 
__USE_XOPEN2K
)

709 #ifdeà
__REDIRECT


710 
	`__REDIRECT
 (
vfwsÿnf
, (
__FILE
 *
__»¡riù
 
__s
,

711 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__fÜm©
,

712 
__gnuc_va_li¡
 
__¬g
), 
__isoc99_vfwsÿnf
)

714 
	`__REDIRECT
 (
vwsÿnf
, (cÚ¡ 
wch¬_t
 *
__»¡riù
 
__fÜm©
,

715 
__gnuc_va_li¡
 
__¬g
), 
__isoc99_vwsÿnf
)

717 
	`__REDIRECT_NTH
 (
vswsÿnf
, (cÚ¡ 
wch¬_t
 *
__»¡riù
 
__s
,

718 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__fÜm©
,

719 
__gnuc_va_li¡
 
__¬g
), 
__isoc99_vswsÿnf
)

722 
	`__isoc99_vfwsÿnf
 (
__FILE
 *
__»¡riù
 
__s
,

723 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__fÜm©
,

724 
__gnuc_va_li¡
 
__¬g
);

725 
	`__isoc99_vwsÿnf
 (cÚ¡ 
wch¬_t
 *
__»¡riù
 
__fÜm©
,

726 
__gnuc_va_li¡
 
__¬g
);

727 
	$__isoc99_vswsÿnf
 (cÚ¡ 
wch¬_t
 *
__»¡riù
 
__s
,

728 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__fÜm©
,

729 
__gnuc_va_li¡
 
__¬g
è
__THROW
;

730 
	#vfwsÿnf
 
__isoc99_vfwsÿnf


	)

731 
	#vwsÿnf
 
__isoc99_vwsÿnf


	)

732 
	#vswsÿnf
 
__isoc99_vswsÿnf


	)

736 
__END_NAMESPACE_C99


740 
__BEGIN_NAMESPACE_STD


745 
wšt_t
 
	`fg‘wc
 (
__FILE
 *
__¡»am
);

746 
wšt_t
 
	`g‘wc
 (
__FILE
 *
__¡»am
);

752 
wšt_t
 
	`g‘wch¬
 ();

759 
wšt_t
 
	`åutwc
 (
wch¬_t
 
__wc
, 
__FILE
 *
__¡»am
);

760 
wšt_t
 
	`putwc
 (
wch¬_t
 
__wc
, 
__FILE
 *
__¡»am
);

766 
wšt_t
 
	`putwch¬
 (
wch¬_t
 
__wc
);

774 
wch¬_t
 *
	`fg‘ws
 (wch¬_ˆ*
__»¡riù
 
__ws
, 
__n
,

775 
__FILE
 *
__»¡riù
 
__¡»am
);

781 
	`åutws
 (cÚ¡ 
wch¬_t
 *
__»¡riù
 
__ws
,

782 
__FILE
 *
__»¡riù
 
__¡»am
);

789 
wšt_t
 
	`ung‘wc
 (wšt_ˆ
__wc
, 
__FILE
 *
__¡»am
);

790 
__END_NAMESPACE_STD


793 #ifdeà
__USE_GNU


801 
wšt_t
 
	`g‘wc_uÆocked
 (
__FILE
 *
__¡»am
);

802 
wšt_t
 
	`g‘wch¬_uÆocked
 ();

810 
wšt_t
 
	`fg‘wc_uÆocked
 (
__FILE
 *
__¡»am
);

818 
wšt_t
 
	`åutwc_uÆocked
 (
wch¬_t
 
__wc
, 
__FILE
 *
__¡»am
);

827 
wšt_t
 
	`putwc_uÆocked
 (
wch¬_t
 
__wc
, 
__FILE
 *
__¡»am
);

828 
wšt_t
 
	`putwch¬_uÆocked
 (
wch¬_t
 
__wc
);

837 
wch¬_t
 *
	`fg‘ws_uÆocked
 (wch¬_ˆ*
__»¡riù
 
__ws
, 
__n
,

838 
__FILE
 *
__»¡riù
 
__¡»am
);

846 
	`åutws_uÆocked
 (cÚ¡ 
wch¬_t
 *
__»¡riù
 
__ws
,

847 
__FILE
 *
__»¡riù
 
__¡»am
);

851 
__BEGIN_NAMESPACE_C99


855 
size_t
 
	$wcsáime
 (
wch¬_t
 *
__»¡riù
 
__s
, 
size_t
 
__maxsize
,

856 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__fÜm©
,

857 cÚ¡ 
tm
 *
__»¡riù
 
__
è
__THROW
;

858 
__END_NAMESPACE_C99


860 #ifdeà
__USE_GNU


861 
	~<xloÿË.h
>

865 
size_t
 
	$wcsáime_l
 (
wch¬_t
 *
__»¡riù
 
__s
, 
size_t
 
__maxsize
,

866 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__fÜm©
,

867 cÚ¡ 
tm
 *
__»¡riù
 
__
,

868 
__loÿË_t
 
__loc
è
__THROW
;

877 #ià
defšed
 
__USE_UNIX98
 && !defšed 
__USE_GNU


878 
	#__Ãed_iswxxx


	)

879 
	~<wùy³.h
>

883 #ià
__USE_FORTIFY_LEVEL
 > 0 && 
defšed
 
__fÜtify_funùiÚ


884 
	~<b™s/wch¬2.h
>

887 #ifdeà
__LDBL_COMPAT


888 
	~<b™s/wch¬-ldbl.h
>

891 
__END_DECLS


899 #undeà
__Ãed_mb¡©e_t


900 #undeà
__Ãed_wšt_t


	@/usr/include/wctype.h

23 #iâdeà
_WCTYPE_H


25 
	~<ã©u»s.h
>

26 
	~<b™s/ty³s.h
>

28 #iâdeà
__Ãed_iswxxx


29 
	#_WCTYPE_H
 1

	)

32 
	#__Ãed_wšt_t


	)

33 
	~<wch¬.h
>

37 #iâdeà
WEOF


38 
	#WEOF
 (0xffffffffu)

	)

41 #undeà
__Ãed_iswxxx


46 #iâdeà
__iswxxx_defšed


47 
	#__iswxxx_defšed
 1

	)

49 
__BEGIN_NAMESPACE_C99


52 
	twùy³_t
;

53 
	g__END_NAMESPACE_C99


55 #iâdeà
_ISwb™


60 
	~<’dŸn.h
>

61 #ià
__BYTE_ORDER
 =ğ
__BIG_ENDIAN


62 
	#_ISwb™
(
b™
è(1 << (b™))

	)

64 
	#_ISwb™
(
b™
) \

65 ((
b™
) < 8 ? () ((1UL << (bit)) << 24) \

66 : ((
b™
) < 16 ? () ((1UL << (bit)) << 8) \

67 : ((
b™
) < 24 ? () ((1UL << (bit)) >> 8) \

68 : (è((1UL << (
b™
)è>> 24))))

	)

73 
	m__ISwuµ”
 = 0,

74 
	m__ISwlow”
 = 1,

75 
	m__ISw®pha
 = 2,

76 
	m__ISwdig™
 = 3,

77 
	m__ISwxdig™
 = 4,

78 
	m__ISw¥aû
 = 5,

79 
	m__ISw´št
 = 6,

80 
	m__ISwg¿ph
 = 7,

81 
	m__ISwbÏnk
 = 8,

82 
	m__ISwúŒl
 = 9,

83 
	m__ISwpunù
 = 10,

84 
	m__ISw®num
 = 11,

86 
	m_ISwuµ”
 = 
_ISwb™
 (
__ISwuµ”
),

87 
	m_ISwlow”
 = 
_ISwb™
 (
__ISwlow”
),

88 
	m_ISw®pha
 = 
_ISwb™
 (
__ISw®pha
),

89 
	m_ISwdig™
 = 
_ISwb™
 (
__ISwdig™
),

90 
	m_ISwxdig™
 = 
_ISwb™
 (
__ISwxdig™
),

91 
	m_ISw¥aû
 = 
_ISwb™
 (
__ISw¥aû
),

92 
	m_ISw´št
 = 
_ISwb™
 (
__ISw´št
),

93 
	m_ISwg¿ph
 = 
_ISwb™
 (
__ISwg¿ph
),

94 
	m_ISwbÏnk
 = 
_ISwb™
 (
__ISwbÏnk
),

95 
	m_ISwúŒl
 = 
_ISwb™
 (
__ISwúŒl
),

96 
	m_ISwpunù
 = 
_ISwb™
 (
__ISwpunù
),

97 
	m_ISw®num
 = 
_ISwb™
 (
__ISw®num
)

102 
__BEGIN_DECLS


104 
__BEGIN_NAMESPACE_C99


111 
	$isw®num
 (
wšt_t
 
__wc
è
__THROW
;

117 
	$isw®pha
 (
wšt_t
 
__wc
è
__THROW
;

120 
	$iswúŒl
 (
wšt_t
 
__wc
è
__THROW
;

124 
	$iswdig™
 (
wšt_t
 
__wc
è
__THROW
;

128 
	$iswg¿ph
 (
wšt_t
 
__wc
è
__THROW
;

133 
	$iswlow”
 (
wšt_t
 
__wc
è
__THROW
;

136 
	$isw´št
 (
wšt_t
 
__wc
è
__THROW
;

141 
	$iswpunù
 (
wšt_t
 
__wc
è
__THROW
;

146 
	$isw¥aû
 (
wšt_t
 
__wc
è
__THROW
;

151 
	$iswuµ”
 (
wšt_t
 
__wc
è
__THROW
;

156 
	$iswxdig™
 (
wšt_t
 
__wc
è
__THROW
;

161 #ifdeà
__USE_ISOC99


162 
	$iswbÏnk
 (
wšt_t
 
__wc
è
__THROW
;

171 
wùy³_t
 
	$wùy³
 (cÚ¡ *
__´İ”ty
è
__THROW
;

175 
	$iswùy³
 (
wšt_t
 
__wc
, 
wùy³_t
 
__desc
è
__THROW
;

176 
__END_NAMESPACE_C99


183 
__BEGIN_NAMESPACE_C99


186 cÚ¡ 
	t__št32_t
 *
	twù¿ns_t
;

187 
__END_NAMESPACE_C99


188 #ifdeà
__USE_GNU


189 
	$__USING_NAMESPACE_C99
(
wù¿ns_t
)

192 
__BEGIN_NAMESPACE_C99


194 
wšt_t
 
	$towlow”
 (
wšt_t
 
__wc
è
__THROW
;

197 
wšt_t
 
	$towuµ”
 (
wšt_t
 
__wc
è
__THROW
;

198 
__END_NAMESPACE_C99


200 
__END_DECLS


207 #ifdeà
_WCTYPE_H


213 
__BEGIN_DECLS


215 
__BEGIN_NAMESPACE_C99


218 
wù¿ns_t
 
	$wù¿ns
 (cÚ¡ *
__´İ”ty
è
__THROW
;

221 
wšt_t
 
	$towù¿ns
 (
wšt_t
 
__wc
, 
wù¿ns_t
 
__desc
è
__THROW
;

222 
__END_NAMESPACE_C99


224 #ifdeà
__USE_XOPEN2K8


226 
	~<xloÿË.h
>

230 
	$isw®num_l
 (
wšt_t
 
__wc
, 
__loÿË_t
 
__loÿË
è
__THROW
;

236 
	$isw®pha_l
 (
wšt_t
 
__wc
, 
__loÿË_t
 
__loÿË
è
__THROW
;

239 
	$iswúŒl_l
 (
wšt_t
 
__wc
, 
__loÿË_t
 
__loÿË
è
__THROW
;

243 
	$iswdig™_l
 (
wšt_t
 
__wc
, 
__loÿË_t
 
__loÿË
è
__THROW
;

247 
	$iswg¿ph_l
 (
wšt_t
 
__wc
, 
__loÿË_t
 
__loÿË
è
__THROW
;

252 
	$iswlow”_l
 (
wšt_t
 
__wc
, 
__loÿË_t
 
__loÿË
è
__THROW
;

255 
	$isw´št_l
 (
wšt_t
 
__wc
, 
__loÿË_t
 
__loÿË
è
__THROW
;

260 
	$iswpunù_l
 (
wšt_t
 
__wc
, 
__loÿË_t
 
__loÿË
è
__THROW
;

265 
	$isw¥aû_l
 (
wšt_t
 
__wc
, 
__loÿË_t
 
__loÿË
è
__THROW
;

270 
	$iswuµ”_l
 (
wšt_t
 
__wc
, 
__loÿË_t
 
__loÿË
è
__THROW
;

275 
	$iswxdig™_l
 (
wšt_t
 
__wc
, 
__loÿË_t
 
__loÿË
è
__THROW
;

280 
	$iswbÏnk_l
 (
wšt_t
 
__wc
, 
__loÿË_t
 
__loÿË
è
__THROW
;

284 
wùy³_t
 
	$wùy³_l
 (cÚ¡ *
__´İ”ty
, 
__loÿË_t
 
__loÿË
)

285 
__THROW
;

289 
	$iswùy³_l
 (
wšt_t
 
__wc
, 
wùy³_t
 
__desc
, 
__loÿË_t
 
__loÿË
)

290 
__THROW
;

298 
wšt_t
 
	$towlow”_l
 (
wšt_t
 
__wc
, 
__loÿË_t
 
__loÿË
è
__THROW
;

301 
wšt_t
 
	$towuµ”_l
 (
wšt_t
 
__wc
, 
__loÿË_t
 
__loÿË
è
__THROW
;

305 
wù¿ns_t
 
	$wù¿ns_l
 (cÚ¡ *
__´İ”ty
, 
__loÿË_t
 
__loÿË
)

306 
__THROW
;

309 
wšt_t
 
	$towù¿ns_l
 (
wšt_t
 
__wc
, 
wù¿ns_t
 
__desc
,

310 
__loÿË_t
 
__loÿË
è
__THROW
;

314 
__END_DECLS


	@
1
.
1
/usr/include
141
3108
Cache.cpp
Cache.h
CachePolicy.h
CachedCSSStyleSheet.cpp
CachedCSSStyleSheet.h
CachedFont.cpp
CachedFont.h
CachedImage.cpp
CachedImage.h
CachedResource.cpp
CachedResource.h
CachedResourceClient.h
CachedResourceClientWalker.cpp
CachedResourceClientWalker.h
CachedResourceHandle.cpp
CachedResourceHandle.h
CachedScript.cpp
CachedScript.h
CachedXBLDocument.cpp
CachedXBLDocument.h
CachedXSLStyleSheet.cpp
CachedXSLStyleSheet.h
CrossOriginAccessControl.cpp
CrossOriginAccessControl.h
CrossOriginPreflightResultCache.cpp
CrossOriginPreflightResultCache.h
DocLoader.cpp
DocLoader.h
DocumentLoader.cpp
DocumentLoader.h
DocumentThreadableLoader.cpp
DocumentThreadableLoader.h
EmptyClients.h
FTPDirectoryDocument.cpp
FTPDirectoryDocument.h
FTPDirectoryParser.cpp
FTPDirectoryParser.h
FormState.cpp
FormState.h
FrameLoader.cpp
FrameLoader.h
FrameLoaderClient.h
FrameLoaderTypes.h
HistoryController.cpp
HistoryController.h
ImageDocument.cpp
ImageDocument.h
ImageLoader.cpp
ImageLoader.h
MainResourceLoader.cpp
MainResourceLoader.h
MediaDocument.cpp
MediaDocument.h
NavigationAction.cpp
NavigationAction.h
NetscapePlugInStreamLoader.cpp
NetscapePlugInStreamLoader.h
PlaceholderDocument.cpp
PlaceholderDocument.h
PluginDocument.cpp
PluginDocument.h
PolicyCallback.cpp
PolicyCallback.h
PolicyChecker.cpp
PolicyChecker.h
ProgressTracker.cpp
ProgressTracker.h
RedirectScheduler.cpp
RedirectScheduler.h
Request.cpp
Request.h
ResourceLoadNotifier.cpp
ResourceLoadNotifier.h
ResourceLoader.cpp
ResourceLoader.h
SubresourceLoader.cpp
SubresourceLoader.h
SubresourceLoaderClient.h
SubstituteData.h
SubstituteResource.h
TextDocument.cpp
TextDocument.h
TextResourceDecoder.cpp
TextResourceDecoder.h
ThreadableLoader.cpp
ThreadableLoader.h
ThreadableLoaderClient.h
ThreadableLoaderClientWrapper.h
WorkerThreadableLoader.cpp
WorkerThreadableLoader.h
appcache/ApplicationCache.cpp
appcache/ApplicationCache.h
appcache/ApplicationCacheGroup.cpp
appcache/ApplicationCacheGroup.h
appcache/ApplicationCacheHost.cpp
appcache/ApplicationCacheHost.h
appcache/ApplicationCacheResource.cpp
appcache/ApplicationCacheResource.h
appcache/ApplicationCacheStorage.cpp
appcache/ApplicationCacheStorage.h
appcache/DOMApplicationCache.cpp
appcache/DOMApplicationCache.h
appcache/ManifestParser.cpp
appcache/ManifestParser.h
archive/Archive.h
archive/ArchiveFactory.cpp
archive/ArchiveFactory.h
archive/ArchiveResource.cpp
archive/ArchiveResource.h
archive/ArchiveResourceCollection.cpp
archive/ArchiveResourceCollection.h
icon/IconDatabase.cpp
icon/IconDatabase.h
icon/IconDatabaseClient.h
icon/IconDatabaseNone.cpp
icon/IconFetcher.cpp
icon/IconFetcher.h
icon/IconLoader.cpp
icon/IconLoader.h
icon/IconRecord.cpp
icon/IconRecord.h
icon/PageURLRecord.cpp
icon/PageURLRecord.h
loader.cpp
loader.h
/usr/include/limits.h
/usr/include/pthread.h
/usr/include/stdio.h
/usr/include/time.h
/usr/include/endian.h
/usr/include/features.h
/usr/include/getopt.h
/usr/include/libio.h
/usr/include/sched.h
/usr/include/xlocale.h
/usr/include/_G_config.h
/usr/include/ctype.h
/usr/include/stdc-predef.h
/usr/include/gconv.h
/usr/include/wchar.h
/usr/include/wctype.h
